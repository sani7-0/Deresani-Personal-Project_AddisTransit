(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))w(E);new MutationObserver(E=>{for(const P of E)if(P.type==="childList")for(const j of P.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&w(j)}).observe(document,{childList:!0,subtree:!0});function g(E){const P={};return E.integrity&&(P.integrity=E.integrity),E.referrerPolicy&&(P.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?P.credentials="include":E.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function w(E){if(E.ep)return;E.ep=!0;const P=g(E);fetch(E.href,P)}})();function Gy(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Gg={exports:{}},df={},Wg={exports:{}},Xr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lx;function CT(){if(lx)return Xr;lx=1;var u=Symbol.for("react.element"),p=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),P=Symbol.for("react.provider"),j=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),s=Symbol.for("react.suspense"),U=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),J=Symbol.iterator;function Y(Te){return Te===null||typeof Te!="object"?null:(Te=J&&Te[J]||Te["@@iterator"],typeof Te=="function"?Te:null)}var me={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ae=Object.assign,Ee={};function Re(Te,st,Gt){this.props=Te,this.context=st,this.refs=Ee,this.updater=Gt||me}Re.prototype.isReactComponent={},Re.prototype.setState=function(Te,st){if(typeof Te!="object"&&typeof Te!="function"&&Te!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Te,st,"setState")},Re.prototype.forceUpdate=function(Te){this.updater.enqueueForceUpdate(this,Te,"forceUpdate")};function Ue(){}Ue.prototype=Re.prototype;function He(Te,st,Gt){this.props=Te,this.context=st,this.refs=Ee,this.updater=Gt||me}var Me=He.prototype=new Ue;Me.constructor=He,Ae(Me,Re.prototype),Me.isPureReactComponent=!0;var lt=Array.isArray,kt=Object.prototype.hasOwnProperty,$e={current:null},Ye={key:!0,ref:!0,__self:!0,__source:!0};function tt(Te,st,Gt){var Ot,xr={},sr=null,Ur=null;if(st!=null)for(Ot in st.ref!==void 0&&(Ur=st.ref),st.key!==void 0&&(sr=""+st.key),st)kt.call(st,Ot)&&!Ye.hasOwnProperty(Ot)&&(xr[Ot]=st[Ot]);var jr=arguments.length-2;if(jr===1)xr.children=Gt;else if(1<jr){for(var Qr=Array(jr),Ln=0;Ln<jr;Ln++)Qr[Ln]=arguments[Ln+2];xr.children=Qr}if(Te&&Te.defaultProps)for(Ot in jr=Te.defaultProps,jr)xr[Ot]===void 0&&(xr[Ot]=jr[Ot]);return{$$typeof:u,type:Te,key:sr,ref:Ur,props:xr,_owner:$e.current}}function it(Te,st){return{$$typeof:u,type:Te.type,key:st,ref:Te.ref,props:Te.props,_owner:Te._owner}}function De(Te){return typeof Te=="object"&&Te!==null&&Te.$$typeof===u}function $t(Te){var st={"=":"=0",":":"=2"};return"$"+Te.replace(/[=:]/g,function(Gt){return st[Gt]})}var ut=/\/+/g;function vt(Te,st){return typeof Te=="object"&&Te!==null&&Te.key!=null?$t(""+Te.key):st.toString(36)}function nr(Te,st,Gt,Ot,xr){var sr=typeof Te;(sr==="undefined"||sr==="boolean")&&(Te=null);var Ur=!1;if(Te===null)Ur=!0;else switch(sr){case"string":case"number":Ur=!0;break;case"object":switch(Te.$$typeof){case u:case p:Ur=!0}}if(Ur)return Ur=Te,xr=xr(Ur),Te=Ot===""?"."+vt(Ur,0):Ot,lt(xr)?(Gt="",Te!=null&&(Gt=Te.replace(ut,"$&/")+"/"),nr(xr,st,Gt,"",function(Ln){return Ln})):xr!=null&&(De(xr)&&(xr=it(xr,Gt+(!xr.key||Ur&&Ur.key===xr.key?"":(""+xr.key).replace(ut,"$&/")+"/")+Te)),st.push(xr)),1;if(Ur=0,Ot=Ot===""?".":Ot+":",lt(Te))for(var jr=0;jr<Te.length;jr++){sr=Te[jr];var Qr=Ot+vt(sr,jr);Ur+=nr(sr,st,Gt,Qr,xr)}else if(Qr=Y(Te),typeof Qr=="function")for(Te=Qr.call(Te),jr=0;!(sr=Te.next()).done;)sr=sr.value,Qr=Ot+vt(sr,jr++),Ur+=nr(sr,st,Gt,Qr,xr);else if(sr==="object")throw st=String(Te),Error("Objects are not valid as a React child (found: "+(st==="[object Object]"?"object with keys {"+Object.keys(Te).join(", ")+"}":st)+"). If you meant to render a collection of children, use an array instead.");return Ur}function Jr(Te,st,Gt){if(Te==null)return Te;var Ot=[],xr=0;return nr(Te,Ot,"","",function(sr){return st.call(Gt,sr,xr++)}),Ot}function ir(Te){if(Te._status===-1){var st=Te._result;st=st(),st.then(function(Gt){(Te._status===0||Te._status===-1)&&(Te._status=1,Te._result=Gt)},function(Gt){(Te._status===0||Te._status===-1)&&(Te._status=2,Te._result=Gt)}),Te._status===-1&&(Te._status=0,Te._result=st)}if(Te._status===1)return Te._result.default;throw Te._result}var cr={current:null},St={transition:null},Fe={ReactCurrentDispatcher:cr,ReactCurrentBatchConfig:St,ReactCurrentOwner:$e};function _t(){throw Error("act(...) is not supported in production builds of React.")}return Xr.Children={map:Jr,forEach:function(Te,st,Gt){Jr(Te,function(){st.apply(this,arguments)},Gt)},count:function(Te){var st=0;return Jr(Te,function(){st++}),st},toArray:function(Te){return Jr(Te,function(st){return st})||[]},only:function(Te){if(!De(Te))throw Error("React.Children.only expected to receive a single React element child.");return Te}},Xr.Component=Re,Xr.Fragment=g,Xr.Profiler=E,Xr.PureComponent=He,Xr.StrictMode=w,Xr.Suspense=s,Xr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Fe,Xr.act=_t,Xr.cloneElement=function(Te,st,Gt){if(Te==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Te+".");var Ot=Ae({},Te.props),xr=Te.key,sr=Te.ref,Ur=Te._owner;if(st!=null){if(st.ref!==void 0&&(sr=st.ref,Ur=$e.current),st.key!==void 0&&(xr=""+st.key),Te.type&&Te.type.defaultProps)var jr=Te.type.defaultProps;for(Qr in st)kt.call(st,Qr)&&!Ye.hasOwnProperty(Qr)&&(Ot[Qr]=st[Qr]===void 0&&jr!==void 0?jr[Qr]:st[Qr])}var Qr=arguments.length-2;if(Qr===1)Ot.children=Gt;else if(1<Qr){jr=Array(Qr);for(var Ln=0;Ln<Qr;Ln++)jr[Ln]=arguments[Ln+2];Ot.children=jr}return{$$typeof:u,type:Te.type,key:xr,ref:sr,props:Ot,_owner:Ur}},Xr.createContext=function(Te){return Te={$$typeof:j,_currentValue:Te,_currentValue2:Te,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Te.Provider={$$typeof:P,_context:Te},Te.Consumer=Te},Xr.createElement=tt,Xr.createFactory=function(Te){var st=tt.bind(null,Te);return st.type=Te,st},Xr.createRef=function(){return{current:null}},Xr.forwardRef=function(Te){return{$$typeof:F,render:Te}},Xr.isValidElement=De,Xr.lazy=function(Te){return{$$typeof:G,_payload:{_status:-1,_result:Te},_init:ir}},Xr.memo=function(Te,st){return{$$typeof:U,type:Te,compare:st===void 0?null:st}},Xr.startTransition=function(Te){var st=St.transition;St.transition={};try{Te()}finally{St.transition=st}},Xr.unstable_act=_t,Xr.useCallback=function(Te,st){return cr.current.useCallback(Te,st)},Xr.useContext=function(Te){return cr.current.useContext(Te)},Xr.useDebugValue=function(){},Xr.useDeferredValue=function(Te){return cr.current.useDeferredValue(Te)},Xr.useEffect=function(Te,st){return cr.current.useEffect(Te,st)},Xr.useId=function(){return cr.current.useId()},Xr.useImperativeHandle=function(Te,st,Gt){return cr.current.useImperativeHandle(Te,st,Gt)},Xr.useInsertionEffect=function(Te,st){return cr.current.useInsertionEffect(Te,st)},Xr.useLayoutEffect=function(Te,st){return cr.current.useLayoutEffect(Te,st)},Xr.useMemo=function(Te,st){return cr.current.useMemo(Te,st)},Xr.useReducer=function(Te,st,Gt){return cr.current.useReducer(Te,st,Gt)},Xr.useRef=function(Te){return cr.current.useRef(Te)},Xr.useState=function(Te){return cr.current.useState(Te)},Xr.useSyncExternalStore=function(Te,st,Gt){return cr.current.useSyncExternalStore(Te,st,Gt)},Xr.useTransition=function(){return cr.current.useTransition()},Xr.version="18.3.1",Xr}var cx;function Wy(){return cx||(cx=1,Wg.exports=CT()),Wg.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ux;function AT(){if(ux)return df;ux=1;var u=Wy(),p=Symbol.for("react.element"),g=Symbol.for("react.fragment"),w=Object.prototype.hasOwnProperty,E=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,P={key:!0,ref:!0,__self:!0,__source:!0};function j(F,s,U){var G,J={},Y=null,me=null;U!==void 0&&(Y=""+U),s.key!==void 0&&(Y=""+s.key),s.ref!==void 0&&(me=s.ref);for(G in s)w.call(s,G)&&!P.hasOwnProperty(G)&&(J[G]=s[G]);if(F&&F.defaultProps)for(G in s=F.defaultProps,s)J[G]===void 0&&(J[G]=s[G]);return{$$typeof:p,type:F,key:Y,ref:me,props:J,_owner:E.current}}return df.Fragment=g,df.jsx=j,df.jsxs=j,df}var hx;function MT(){return hx||(hx=1,Gg.exports=AT()),Gg.exports}var v=MT(),ee=Wy();const Vv=Gy(ee);var Am={},qg={exports:{}},uo={},Zg={exports:{}},Hg={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dx;function PT(){return dx||(dx=1,(function(u){function p(St,Fe){var _t=St.length;St.push(Fe);e:for(;0<_t;){var Te=_t-1>>>1,st=St[Te];if(0<E(st,Fe))St[Te]=Fe,St[_t]=st,_t=Te;else break e}}function g(St){return St.length===0?null:St[0]}function w(St){if(St.length===0)return null;var Fe=St[0],_t=St.pop();if(_t!==Fe){St[0]=_t;e:for(var Te=0,st=St.length,Gt=st>>>1;Te<Gt;){var Ot=2*(Te+1)-1,xr=St[Ot],sr=Ot+1,Ur=St[sr];if(0>E(xr,_t))sr<st&&0>E(Ur,xr)?(St[Te]=Ur,St[sr]=_t,Te=sr):(St[Te]=xr,St[Ot]=_t,Te=Ot);else if(sr<st&&0>E(Ur,_t))St[Te]=Ur,St[sr]=_t,Te=sr;else break e}}return Fe}function E(St,Fe){var _t=St.sortIndex-Fe.sortIndex;return _t!==0?_t:St.id-Fe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var P=performance;u.unstable_now=function(){return P.now()}}else{var j=Date,F=j.now();u.unstable_now=function(){return j.now()-F}}var s=[],U=[],G=1,J=null,Y=3,me=!1,Ae=!1,Ee=!1,Re=typeof setTimeout=="function"?setTimeout:null,Ue=typeof clearTimeout=="function"?clearTimeout:null,He=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Me(St){for(var Fe=g(U);Fe!==null;){if(Fe.callback===null)w(U);else if(Fe.startTime<=St)w(U),Fe.sortIndex=Fe.expirationTime,p(s,Fe);else break;Fe=g(U)}}function lt(St){if(Ee=!1,Me(St),!Ae)if(g(s)!==null)Ae=!0,ir(kt);else{var Fe=g(U);Fe!==null&&cr(lt,Fe.startTime-St)}}function kt(St,Fe){Ae=!1,Ee&&(Ee=!1,Ue(tt),tt=-1),me=!0;var _t=Y;try{for(Me(Fe),J=g(s);J!==null&&(!(J.expirationTime>Fe)||St&&!$t());){var Te=J.callback;if(typeof Te=="function"){J.callback=null,Y=J.priorityLevel;var st=Te(J.expirationTime<=Fe);Fe=u.unstable_now(),typeof st=="function"?J.callback=st:J===g(s)&&w(s),Me(Fe)}else w(s);J=g(s)}if(J!==null)var Gt=!0;else{var Ot=g(U);Ot!==null&&cr(lt,Ot.startTime-Fe),Gt=!1}return Gt}finally{J=null,Y=_t,me=!1}}var $e=!1,Ye=null,tt=-1,it=5,De=-1;function $t(){return!(u.unstable_now()-De<it)}function ut(){if(Ye!==null){var St=u.unstable_now();De=St;var Fe=!0;try{Fe=Ye(!0,St)}finally{Fe?vt():($e=!1,Ye=null)}}else $e=!1}var vt;if(typeof He=="function")vt=function(){He(ut)};else if(typeof MessageChannel<"u"){var nr=new MessageChannel,Jr=nr.port2;nr.port1.onmessage=ut,vt=function(){Jr.postMessage(null)}}else vt=function(){Re(ut,0)};function ir(St){Ye=St,$e||($e=!0,vt())}function cr(St,Fe){tt=Re(function(){St(u.unstable_now())},Fe)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(St){St.callback=null},u.unstable_continueExecution=function(){Ae||me||(Ae=!0,ir(kt))},u.unstable_forceFrameRate=function(St){0>St||125<St?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):it=0<St?Math.floor(1e3/St):5},u.unstable_getCurrentPriorityLevel=function(){return Y},u.unstable_getFirstCallbackNode=function(){return g(s)},u.unstable_next=function(St){switch(Y){case 1:case 2:case 3:var Fe=3;break;default:Fe=Y}var _t=Y;Y=Fe;try{return St()}finally{Y=_t}},u.unstable_pauseExecution=function(){},u.unstable_requestPaint=function(){},u.unstable_runWithPriority=function(St,Fe){switch(St){case 1:case 2:case 3:case 4:case 5:break;default:St=3}var _t=Y;Y=St;try{return Fe()}finally{Y=_t}},u.unstable_scheduleCallback=function(St,Fe,_t){var Te=u.unstable_now();switch(typeof _t=="object"&&_t!==null?(_t=_t.delay,_t=typeof _t=="number"&&0<_t?Te+_t:Te):_t=Te,St){case 1:var st=-1;break;case 2:st=250;break;case 5:st=1073741823;break;case 4:st=1e4;break;default:st=5e3}return st=_t+st,St={id:G++,callback:Fe,priorityLevel:St,startTime:_t,expirationTime:st,sortIndex:-1},_t>Te?(St.sortIndex=_t,p(U,St),g(s)===null&&St===g(U)&&(Ee?(Ue(tt),tt=-1):Ee=!0,cr(lt,_t-Te))):(St.sortIndex=st,p(s,St),Ae||me||(Ae=!0,ir(kt))),St},u.unstable_shouldYield=$t,u.unstable_wrapCallback=function(St){var Fe=Y;return function(){var _t=Y;Y=Fe;try{return St.apply(this,arguments)}finally{Y=_t}}}})(Hg)),Hg}var px;function IT(){return px||(px=1,Zg.exports=PT()),Zg.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fx;function DT(){if(fx)return uo;fx=1;var u=Wy(),p=IT();function g(o){for(var c="https://reactjs.org/docs/error-decoder.html?invariant="+o,_=1;_<arguments.length;_++)c+="&args[]="+encodeURIComponent(arguments[_]);return"Minified React error #"+o+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var w=new Set,E={};function P(o,c){j(o,c),j(o+"Capture",c)}function j(o,c){for(E[o]=c,o=0;o<c.length;o++)w.add(c[o])}var F=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),s=Object.prototype.hasOwnProperty,U=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,G={},J={};function Y(o){return s.call(J,o)?!0:s.call(G,o)?!1:U.test(o)?J[o]=!0:(G[o]=!0,!1)}function me(o,c,_,k){if(_!==null&&_.type===0)return!1;switch(typeof c){case"function":case"symbol":return!0;case"boolean":return k?!1:_!==null?!_.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function Ae(o,c,_,k){if(c===null||typeof c>"u"||me(o,c,_,k))return!0;if(k)return!1;if(_!==null)switch(_.type){case 3:return!c;case 4:return c===!1;case 5:return isNaN(c);case 6:return isNaN(c)||1>c}return!1}function Ee(o,c,_,k,D,B,X){this.acceptsBooleans=c===2||c===3||c===4,this.attributeName=k,this.attributeNamespace=D,this.mustUseProperty=_,this.propertyName=o,this.type=c,this.sanitizeURL=B,this.removeEmptyString=X}var Re={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){Re[o]=new Ee(o,0,!1,o,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var c=o[0];Re[c]=new Ee(c,1,!1,o[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(o){Re[o]=new Ee(o,2,!1,o.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){Re[o]=new Ee(o,2,!1,o,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){Re[o]=new Ee(o,3,!1,o.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(o){Re[o]=new Ee(o,3,!0,o,null,!1,!1)}),["capture","download"].forEach(function(o){Re[o]=new Ee(o,4,!1,o,null,!1,!1)}),["cols","rows","size","span"].forEach(function(o){Re[o]=new Ee(o,6,!1,o,null,!1,!1)}),["rowSpan","start"].forEach(function(o){Re[o]=new Ee(o,5,!1,o.toLowerCase(),null,!1,!1)});var Ue=/[\-:]([a-z])/g;function He(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var c=o.replace(Ue,He);Re[c]=new Ee(c,1,!1,o,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var c=o.replace(Ue,He);Re[c]=new Ee(c,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(o){var c=o.replace(Ue,He);Re[c]=new Ee(c,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(o){Re[o]=new Ee(o,1,!1,o.toLowerCase(),null,!1,!1)}),Re.xlinkHref=new Ee("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(o){Re[o]=new Ee(o,1,!1,o.toLowerCase(),null,!0,!0)});function Me(o,c,_,k){var D=Re.hasOwnProperty(c)?Re[c]:null;(D!==null?D.type!==0:k||!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(Ae(c,_,D,k)&&(_=null),k||D===null?Y(c)&&(_===null?o.removeAttribute(c):o.setAttribute(c,""+_)):D.mustUseProperty?o[D.propertyName]=_===null?D.type===3?!1:"":_:(c=D.attributeName,k=D.attributeNamespace,_===null?o.removeAttribute(c):(D=D.type,_=D===3||D===4&&_===!0?"":""+_,k?o.setAttributeNS(k,c,_):o.setAttribute(c,_))))}var lt=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,kt=Symbol.for("react.element"),$e=Symbol.for("react.portal"),Ye=Symbol.for("react.fragment"),tt=Symbol.for("react.strict_mode"),it=Symbol.for("react.profiler"),De=Symbol.for("react.provider"),$t=Symbol.for("react.context"),ut=Symbol.for("react.forward_ref"),vt=Symbol.for("react.suspense"),nr=Symbol.for("react.suspense_list"),Jr=Symbol.for("react.memo"),ir=Symbol.for("react.lazy"),cr=Symbol.for("react.offscreen"),St=Symbol.iterator;function Fe(o){return o===null||typeof o!="object"?null:(o=St&&o[St]||o["@@iterator"],typeof o=="function"?o:null)}var _t=Object.assign,Te;function st(o){if(Te===void 0)try{throw Error()}catch(_){var c=_.stack.trim().match(/\n( *(at )?)/);Te=c&&c[1]||""}return`
`+Te+o}var Gt=!1;function Ot(o,c){if(!o||Gt)return"";Gt=!0;var _=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(c)if(c=function(){throw Error()},Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(c,[])}catch(Ke){var k=Ke}Reflect.construct(o,[],c)}else{try{c.call()}catch(Ke){k=Ke}o.call(c.prototype)}else{try{throw Error()}catch(Ke){k=Ke}o()}}catch(Ke){if(Ke&&k&&typeof Ke.stack=="string"){for(var D=Ke.stack.split(`
`),B=k.stack.split(`
`),X=D.length-1,fe=B.length-1;1<=X&&0<=fe&&D[X]!==B[fe];)fe--;for(;1<=X&&0<=fe;X--,fe--)if(D[X]!==B[fe]){if(X!==1||fe!==1)do if(X--,fe--,0>fe||D[X]!==B[fe]){var ke=`
`+D[X].replace(" at new "," at ");return o.displayName&&ke.includes("<anonymous>")&&(ke=ke.replace("<anonymous>",o.displayName)),ke}while(1<=X&&0<=fe);break}}}finally{Gt=!1,Error.prepareStackTrace=_}return(o=o?o.displayName||o.name:"")?st(o):""}function xr(o){switch(o.tag){case 5:return st(o.type);case 16:return st("Lazy");case 13:return st("Suspense");case 19:return st("SuspenseList");case 0:case 2:case 15:return o=Ot(o.type,!1),o;case 11:return o=Ot(o.type.render,!1),o;case 1:return o=Ot(o.type,!0),o;default:return""}}function sr(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case Ye:return"Fragment";case $e:return"Portal";case it:return"Profiler";case tt:return"StrictMode";case vt:return"Suspense";case nr:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case $t:return(o.displayName||"Context")+".Consumer";case De:return(o._context.displayName||"Context")+".Provider";case ut:var c=o.render;return o=o.displayName,o||(o=c.displayName||c.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case Jr:return c=o.displayName||null,c!==null?c:sr(o.type)||"Memo";case ir:c=o._payload,o=o._init;try{return sr(o(c))}catch{}}return null}function Ur(o){var c=o.type;switch(o.tag){case 24:return"Cache";case 9:return(c.displayName||"Context")+".Consumer";case 10:return(c._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=c.render,o=o.displayName||o.name||"",c.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return c;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return sr(c);case 8:return c===tt?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c}return null}function jr(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function Qr(o){var c=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Ln(o){var c=Qr(o)?"checked":"value",_=Object.getOwnPropertyDescriptor(o.constructor.prototype,c),k=""+o[c];if(!o.hasOwnProperty(c)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var D=_.get,B=_.set;return Object.defineProperty(o,c,{configurable:!0,get:function(){return D.call(this)},set:function(X){k=""+X,B.call(this,X)}}),Object.defineProperty(o,c,{enumerable:_.enumerable}),{getValue:function(){return k},setValue:function(X){k=""+X},stopTracking:function(){o._valueTracker=null,delete o[c]}}}}function Hi(o){o._valueTracker||(o._valueTracker=Ln(o))}function Cr(o){if(!o)return!1;var c=o._valueTracker;if(!c)return!0;var _=c.getValue(),k="";return o&&(k=Qr(o)?o.checked?"true":"false":o.value),o=k,o!==_?(c.setValue(o),!0):!1}function us(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function di(o,c){var _=c.checked;return _t({},c,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:_??o._wrapperState.initialChecked})}function Fo(o,c){var _=c.defaultValue==null?"":c.defaultValue,k=c.checked!=null?c.checked:c.defaultChecked;_=jr(c.value!=null?c.value:_),o._wrapperState={initialChecked:k,initialValue:_,controlled:c.type==="checkbox"||c.type==="radio"?c.checked!=null:c.value!=null}}function nn(o,c){c=c.checked,c!=null&&Me(o,"checked",c,!1)}function yi(o,c){nn(o,c);var _=jr(c.value),k=c.type;if(_!=null)k==="number"?(_===0&&o.value===""||o.value!=_)&&(o.value=""+_):o.value!==""+_&&(o.value=""+_);else if(k==="submit"||k==="reset"){o.removeAttribute("value");return}c.hasOwnProperty("value")?vr(o,c.type,_):c.hasOwnProperty("defaultValue")&&vr(o,c.type,jr(c.defaultValue)),c.checked==null&&c.defaultChecked!=null&&(o.defaultChecked=!!c.defaultChecked)}function Mt(o,c,_){if(c.hasOwnProperty("value")||c.hasOwnProperty("defaultValue")){var k=c.type;if(!(k!=="submit"&&k!=="reset"||c.value!==void 0&&c.value!==null))return;c=""+o._wrapperState.initialValue,_||c===o.value||(o.value=c),o.defaultValue=c}_=o.name,_!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,_!==""&&(o.name=_)}function vr(o,c,_){(c!=="number"||us(o.ownerDocument)!==o)&&(_==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+_&&(o.defaultValue=""+_))}var Mr=Array.isArray;function Wt(o,c,_,k){if(o=o.options,c){c={};for(var D=0;D<_.length;D++)c["$"+_[D]]=!0;for(_=0;_<o.length;_++)D=c.hasOwnProperty("$"+o[_].value),o[_].selected!==D&&(o[_].selected=D),D&&k&&(o[_].defaultSelected=!0)}else{for(_=""+jr(_),c=null,D=0;D<o.length;D++){if(o[D].value===_){o[D].selected=!0,k&&(o[D].defaultSelected=!0);return}c!==null||o[D].disabled||(c=o[D])}c!==null&&(c.selected=!0)}}function Fn(o,c){if(c.dangerouslySetInnerHTML!=null)throw Error(g(91));return _t({},c,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function hs(o,c){var _=c.value;if(_==null){if(_=c.children,c=c.defaultValue,_!=null){if(c!=null)throw Error(g(92));if(Mr(_)){if(1<_.length)throw Error(g(93));_=_[0]}c=_}c==null&&(c=""),_=c}o._wrapperState={initialValue:jr(_)}}function Ci(o,c){var _=jr(c.value),k=jr(c.defaultValue);_!=null&&(_=""+_,_!==o.value&&(o.value=_),c.defaultValue==null&&o.defaultValue!==_&&(o.defaultValue=_)),k!=null&&(o.defaultValue=""+k)}function Zn(o){var c=o.textContent;c===o._wrapperState.initialValue&&c!==""&&c!==null&&(o.value=c)}function On(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ha(o,c){return o==null||o==="http://www.w3.org/1999/xhtml"?On(c):o==="http://www.w3.org/2000/svg"&&c==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var Ai,mo=(function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(c,_,k,D){MSApp.execUnsafeLocalFunction(function(){return o(c,_,k,D)})}:o})(function(o,c){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=c;else{for(Ai=Ai||document.createElement("div"),Ai.innerHTML="<svg>"+c.valueOf().toString()+"</svg>",c=Ai.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;c.firstChild;)o.appendChild(c.firstChild)}});function go(o,c){if(c){var _=o.firstChild;if(_&&_===o.lastChild&&_.nodeType===3){_.nodeValue=c;return}}o.textContent=c}var Is={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Xa=["Webkit","ms","Moz","O"];Object.keys(Is).forEach(function(o){Xa.forEach(function(c){c=c+o.charAt(0).toUpperCase()+o.substring(1),Is[c]=Is[o]})});function Ka(o,c,_){return c==null||typeof c=="boolean"||c===""?"":_||typeof c!="number"||c===0||Is.hasOwnProperty(o)&&Is[o]?(""+c).trim():c+"px"}function Oo(o,c){o=o.style;for(var _ in c)if(c.hasOwnProperty(_)){var k=_.indexOf("--")===0,D=Ka(_,c[_],k);_==="float"&&(_="cssFloat"),k?o.setProperty(_,D):o[_]=D}}var Uo=_t({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yo(o,c){if(c){if(Uo[o]&&(c.children!=null||c.dangerouslySetInnerHTML!=null))throw Error(g(137,o));if(c.dangerouslySetInnerHTML!=null){if(c.children!=null)throw Error(g(60));if(typeof c.dangerouslySetInnerHTML!="object"||!("__html"in c.dangerouslySetInnerHTML))throw Error(g(61))}if(c.style!=null&&typeof c.style!="object")throw Error(g(62))}}function _o(o,c){if(o.indexOf("-")===-1)return typeof c.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Vo=null;function Ya(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var he=null,Z=null,H=null;function ue(o){if(o=Tl(o)){if(typeof he!="function")throw Error(g(280));var c=o.stateNode;c&&(c=au(c),he(o.stateNode,o.type,c))}}function _e(o){Z?H?H.push(o):H=[o]:Z=o}function Se(){if(Z){var o=Z,c=H;if(H=Z=null,ue(o),c)for(o=0;o<c.length;o++)ue(c[o])}}function ze(o,c){return o(c)}function Le(){}var we=!1;function qe(o,c,_){if(we)return o(c,_);we=!0;try{return ze(o,c,_)}finally{we=!1,(Z!==null||H!==null)&&(Le(),Se())}}function xt(o,c){var _=o.stateNode;if(_===null)return null;var k=au(_);if(k===null)return null;_=k[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(k=!k.disabled)||(o=o.type,k=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!k;break e;default:o=!1}if(o)return null;if(_&&typeof _!="function")throw Error(g(231,c,typeof _));return _}var Ct=!1;if(F)try{var mt={};Object.defineProperty(mt,"passive",{get:function(){Ct=!0}}),window.addEventListener("test",mt,mt),window.removeEventListener("test",mt,mt)}catch{Ct=!1}function hr(o,c,_,k,D,B,X,fe,ke){var Ke=Array.prototype.slice.call(arguments,3);try{c.apply(_,Ke)}catch(Et){this.onError(Et)}}var dr=!1,ur=null,fr=!1,Pr=null,_n={onError:function(o){dr=!0,ur=o}};function jn(o,c,_,k,D,B,X,fe,ke){dr=!1,ur=null,hr.apply(_n,arguments)}function _i(o,c,_,k,D,B,X,fe,ke){if(jn.apply(this,arguments),dr){if(dr){var Ke=ur;dr=!1,ur=null}else throw Error(g(198));fr||(fr=!0,Pr=Ke)}}function fn(o){var c=o,_=o;if(o.alternate)for(;c.return;)c=c.return;else{o=c;do c=o,(c.flags&4098)!==0&&(_=c.return),o=c.return;while(o)}return c.tag===3?_:null}function Ds(o){if(o.tag===13){var c=o.memoizedState;if(c===null&&(o=o.alternate,o!==null&&(c=o.memoizedState)),c!==null)return c.dehydrated}return null}function Hn(o){if(fn(o)!==o)throw Error(g(188))}function Mi(o){var c=o.alternate;if(!c){if(c=fn(o),c===null)throw Error(g(188));return c!==o?null:o}for(var _=o,k=c;;){var D=_.return;if(D===null)break;var B=D.alternate;if(B===null){if(k=D.return,k!==null){_=k;continue}break}if(D.child===B.child){for(B=D.child;B;){if(B===_)return Hn(D),o;if(B===k)return Hn(D),c;B=B.sibling}throw Error(g(188))}if(_.return!==k.return)_=D,k=B;else{for(var X=!1,fe=D.child;fe;){if(fe===_){X=!0,_=D,k=B;break}if(fe===k){X=!0,k=D,_=B;break}fe=fe.sibling}if(!X){for(fe=B.child;fe;){if(fe===_){X=!0,_=B,k=D;break}if(fe===k){X=!0,k=B,_=D;break}fe=fe.sibling}if(!X)throw Error(g(189))}}if(_.alternate!==k)throw Error(g(190))}if(_.tag!==3)throw Error(g(188));return _.stateNode.current===_?o:c}function ya(o){return o=Mi(o),o!==null?Yh(o):null}function Yh(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var c=Yh(o);if(c!==null)return c;o=o.sibling}return null}var Fu=p.unstable_scheduleCallback,Vr=p.unstable_cancelCallback,Ou=p.unstable_shouldYield,Hl=p.unstable_requestPaint,Tn=p.unstable_now,Vc=p.unstable_getCurrentPriorityLevel,ds=p.unstable_ImmediatePriority,Hs=p.unstable_UserBlockingPriority,Ja=p.unstable_NormalPriority,Uu=p.unstable_LowPriority,$o=p.unstable_IdlePriority,ps=null,Ni=null;function rt(o){if(Ni&&typeof Ni.onCommitFiberRoot=="function")try{Ni.onCommitFiberRoot(ps,o,void 0,(o.current.flags&128)===128)}catch{}}var Xn=Math.clz32?Math.clz32:Jh,Rn=Math.log,ri=Math.LN2;function Jh(o){return o>>>=0,o===0?32:31-(Rn(o)/ri|0)|0}var Xi=64,Qa=4194304;function el(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function xo(o,c){var _=o.pendingLanes;if(_===0)return 0;var k=0,D=o.suspendedLanes,B=o.pingedLanes,X=_&268435455;if(X!==0){var fe=X&~D;fe!==0?k=el(fe):(B&=X,B!==0&&(k=el(B)))}else X=_&~D,X!==0?k=el(X):B!==0&&(k=el(B));if(k===0)return 0;if(c!==0&&c!==k&&(c&D)===0&&(D=k&-k,B=c&-c,D>=B||D===16&&(B&4194240)!==0))return c;if((k&4)!==0&&(k|=_&16),c=o.entangledLanes,c!==0)for(o=o.entanglements,c&=k;0<c;)_=31-Xn(c),D=1<<_,k|=o[_],c&=~D;return k}function Rt(o,c){switch(o){case 1:case 2:case 4:return c+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Dr(o,c){for(var _=o.suspendedLanes,k=o.pingedLanes,D=o.expirationTimes,B=o.pendingLanes;0<B;){var X=31-Xn(B),fe=1<<X,ke=D[X];ke===-1?((fe&_)===0||(fe&k)!==0)&&(D[X]=Rt(fe,c)):ke<=c&&(o.expiredLanes|=fe),B&=~fe}}function Sr(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function Bi(){var o=Xi;return Xi<<=1,(Xi&4194240)===0&&(Xi=64),o}function Ki(o){for(var c=[],_=0;31>_;_++)c.push(o);return c}function mr(o,c,_){o.pendingLanes|=c,c!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,c=31-Xn(c),o[c]=_}function Yi(o,c){var _=o.pendingLanes&~c;o.pendingLanes=c,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=c,o.mutableReadLanes&=c,o.entangledLanes&=c,c=o.entanglements;var k=o.eventTimes;for(o=o.expirationTimes;0<_;){var D=31-Xn(_),B=1<<D;c[D]=0,k[D]=-1,o[D]=-1,_&=~B}}function _a(o,c){var _=o.entangledLanes|=c;for(o=o.entanglements;_;){var k=31-Xn(_),D=1<<k;D&c|o[k]&c&&(o[k]|=c),_&=~D}}var $r=0;function Ji(o){return o&=-o,1<o?4<o?(o&268435455)!==0?16:536870912:4:1}var ln,$c,Xs,tl,rl,Xl=!1,Kl=[],fs=null,ms=null,Ls=null,Ks=new Map,ni=new Map,tn=[],Vu="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Gc(o,c){switch(o){case"focusin":case"focusout":fs=null;break;case"dragenter":case"dragleave":ms=null;break;case"mouseover":case"mouseout":Ls=null;break;case"pointerover":case"pointerout":Ks.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":ni.delete(c.pointerId)}}function ii(o,c,_,k,D,B){return o===null||o.nativeEvent!==B?(o={blockedOn:c,domEventName:_,eventSystemFlags:k,nativeEvent:B,targetContainers:[D]},c!==null&&(c=Tl(c),c!==null&&$c(c)),o):(o.eventSystemFlags|=k,c=o.targetContainers,D!==null&&c.indexOf(D)===-1&&c.push(D),o)}function gs(o,c,_,k,D){switch(c){case"focusin":return fs=ii(fs,o,c,_,k,D),!0;case"dragenter":return ms=ii(ms,o,c,_,k,D),!0;case"mouseover":return Ls=ii(Ls,o,c,_,k,D),!0;case"pointerover":var B=D.pointerId;return Ks.set(B,ii(Ks.get(B)||null,o,c,_,k,D)),!0;case"gotpointercapture":return B=D.pointerId,ni.set(B,ii(ni.get(B)||null,o,c,_,k,D)),!0}return!1}function $u(o){var c=$i(o.target);if(c!==null){var _=fn(c);if(_!==null){if(c=_.tag,c===13){if(c=Ds(_),c!==null){o.blockedOn=c,rl(o.priority,function(){Xs(_)});return}}else if(c===3&&_.stateNode.current.memoizedState.isDehydrated){o.blockedOn=_.tag===3?_.stateNode.containerInfo:null;return}}}o.blockedOn=null}function Go(o){if(o.blockedOn!==null)return!1;for(var c=o.targetContainers;0<c.length;){var _=Wu(o.domEventName,o.eventSystemFlags,c[0],o.nativeEvent);if(_===null){_=o.nativeEvent;var k=new _.constructor(_.type,_);Vo=k,_.target.dispatchEvent(k),Vo=null}else return c=Tl(_),c!==null&&$c(c),o.blockedOn=_,!1;c.shift()}return!0}function bn(o,c,_){Go(o)&&_.delete(c)}function Yl(){Xl=!1,fs!==null&&Go(fs)&&(fs=null),ms!==null&&Go(ms)&&(ms=null),Ls!==null&&Go(Ls)&&(Ls=null),Ks.forEach(bn),ni.forEach(bn)}function xa(o,c){o.blockedOn===c&&(o.blockedOn=null,Xl||(Xl=!0,p.unstable_scheduleCallback(p.unstable_NormalPriority,Yl)))}function js(o){function c(D){return xa(D,o)}if(0<Kl.length){xa(Kl[0],o);for(var _=1;_<Kl.length;_++){var k=Kl[_];k.blockedOn===o&&(k.blockedOn=null)}}for(fs!==null&&xa(fs,o),ms!==null&&xa(ms,o),Ls!==null&&xa(Ls,o),Ks.forEach(c),ni.forEach(c),_=0;_<tn.length;_++)k=tn[_],k.blockedOn===o&&(k.blockedOn=null);for(;0<tn.length&&(_=tn[0],_.blockedOn===null);)$u(_),_.blockedOn===null&&tn.shift()}var An=lt.ReactCurrentBatchConfig,nl=!0;function Gu(o,c,_,k){var D=$r,B=An.transition;An.transition=null;try{$r=1,Ys(o,c,_,k)}finally{$r=D,An.transition=B}}function vo(o,c,_,k){var D=$r,B=An.transition;An.transition=null;try{$r=4,Ys(o,c,_,k)}finally{$r=D,An.transition=B}}function Ys(o,c,_,k){if(nl){var D=Wu(o,c,_,k);if(D===null)gl(o,c,k,va,_),Gc(o,k);else if(gs(D,o,c,_,k))k.stopPropagation();else if(Gc(o,k),c&4&&-1<Vu.indexOf(o)){for(;D!==null;){var B=Tl(D);if(B!==null&&ln(B),B=Wu(o,c,_,k),B===null&&gl(o,c,k,va,_),B===D)break;D=B}D!==null&&k.stopPropagation()}else gl(o,c,k,null,_)}}var va=null;function Wu(o,c,_,k){if(va=null,o=Ya(k),o=$i(o),o!==null)if(c=fn(o),c===null)o=null;else if(_=c.tag,_===13){if(o=Ds(c),o!==null)return o;o=null}else if(_===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;o=null}else c!==o&&(o=null);return va=o,null}function Wc(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Vc()){case ds:return 1;case Hs:return 4;case Ja:case Uu:return 16;case $o:return 536870912;default:return 16}default:return 16}}var Qi=null,ys=null,il=null;function Wo(){if(il)return il;var o,c=ys,_=c.length,k,D="value"in Qi?Qi.value:Qi.textContent,B=D.length;for(o=0;o<_&&c[o]===D[o];o++);var X=_-o;for(k=1;k<=X&&c[_-k]===D[B-k];k++);return il=D.slice(o,1<k?1-k:void 0)}function _s(o){var c=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&c===13&&(o=13)):o=c,o===10&&(o=13),32<=o||o===13?o:0}function qo(){return!0}function Js(){return!1}function xi(o){function c(_,k,D,B,X){this._reactName=_,this._targetInst=D,this.type=k,this.nativeEvent=B,this.target=X,this.currentTarget=null;for(var fe in o)o.hasOwnProperty(fe)&&(_=o[fe],this[fe]=_?_(B):B[fe]);return this.isDefaultPrevented=(B.defaultPrevented!=null?B.defaultPrevented:B.returnValue===!1)?qo:Js,this.isPropagationStopped=Js,this}return _t(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var _=this.nativeEvent;_&&(_.preventDefault?_.preventDefault():typeof _.returnValue!="unknown"&&(_.returnValue=!1),this.isDefaultPrevented=qo)},stopPropagation:function(){var _=this.nativeEvent;_&&(_.stopPropagation?_.stopPropagation():typeof _.cancelBubble!="unknown"&&(_.cancelBubble=!0),this.isPropagationStopped=qo)},persist:function(){},isPersistent:qo}),c}var Rs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ba=xi(Rs),sl=_t({},Rs,{view:0,detail:0}),qc=xi(sl),Jl,Ql,Qs,Nr=_t({},sl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:tc,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Qs&&(Qs&&o.type==="mousemove"?(Jl=o.screenX-Qs.screenX,Ql=o.screenY-Qs.screenY):Ql=Jl=0,Qs=o),Jl)},movementY:function(o){return"movementY"in o?o.movementY:Ql}}),Qh=xi(Nr),qu=_t({},Nr,{dataTransfer:0}),ed=xi(qu),Zu=_t({},sl,{relatedTarget:0}),Zc=xi(Zu),Hu=_t({},Rs,{animationName:0,elapsedTime:0,pseudoElement:0}),ol=xi(Hu),Hc=_t({},Rs,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),al=xi(Hc),bo=_t({},Rs,{data:0}),Zo=xi(bo),Xc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},td={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ec={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Xu(o){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(o):(o=ec[o])?!!c[o]:!1}function tc(){return Xu}var Kc=_t({},sl,{key:function(o){if(o.key){var c=Xc[o.key]||o.key;if(c!=="Unidentified")return c}return o.type==="keypress"?(o=_s(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?td[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:tc,charCode:function(o){return o.type==="keypress"?_s(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?_s(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),Yc=xi(Kc),Ku=_t({},Nr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Rr=xi(Ku),rc=_t({},sl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:tc}),rd=xi(rc),Yu=_t({},Rs,{propertyName:0,elapsedTime:0,pseudoElement:0}),nd=xi(Yu),wa=_t({},Nr,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),Ju=xi(wa),mp=[9,13,27,32],Qu=F&&"CompositionEvent"in window,nc=null;F&&"documentMode"in document&&(nc=document.documentMode);var eh=F&&"TextEvent"in window&&!nc,Jc=F&&(!Qu||nc&&8<nc&&11>=nc),Qc=" ",ic=!1;function th(o,c){switch(o){case"keyup":return mp.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rh(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var ll=!1;function sc(o,c){switch(o){case"compositionend":return rh(c);case"keypress":return c.which!==32?null:(ic=!0,Qc);case"textInput":return o=c.data,o===Qc&&ic?null:o;default:return null}}function cl(o,c){if(ll)return o==="compositionend"||!Qu&&th(o,c)?(o=Wo(),il=ys=Qi=null,ll=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return Jc&&c.locale!=="ko"?null:c.data;default:return null}}var nh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ul(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c==="input"?!!nh[o.type]:c==="textarea"}function eu(o,c,_,k){_e(k),c=Ui(c,"onChange"),0<c.length&&(_=new ba("onChange","change",null,_,k),o.push({event:_,listeners:c}))}var Fi=null,Ho=null;function ih(o){Ca(o,0)}function Ta(o){var c=Pa(o);if(Cr(c))return o}function id(o,c){if(o==="change")return c}var tu=!1;if(F){var sh;if(F){var oc="oninput"in document;if(!oc){var ac=document.createElement("div");ac.setAttribute("oninput","return;"),oc=typeof ac.oninput=="function"}sh=oc}else sh=!1;tu=sh&&(!document.documentMode||9<document.documentMode)}function hl(){Fi&&(Fi.detachEvent("onpropertychange",oh),Ho=Fi=null)}function oh(o){if(o.propertyName==="value"&&Ta(Ho)){var c=[];eu(c,Ho,o,Ya(o)),qe(ih,c)}}function ah(o,c,_){o==="focusin"?(hl(),Fi=c,Ho=_,Fi.attachEvent("onpropertychange",oh)):o==="focusout"&&hl()}function gp(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Ta(Ho)}function lh(o,c){if(o==="click")return Ta(c)}function sd(o,c){if(o==="input"||o==="change")return Ta(c)}function lc(o,c){return o===c&&(o!==0||1/o===1/c)||o!==o&&c!==c}var xs=typeof Object.is=="function"?Object.is:lc;function Xo(o,c){if(xs(o,c))return!0;if(typeof o!="object"||o===null||typeof c!="object"||c===null)return!1;var _=Object.keys(o),k=Object.keys(c);if(_.length!==k.length)return!1;for(k=0;k<_.length;k++){var D=_[k];if(!s.call(c,D)||!xs(o[D],c[D]))return!1}return!0}function ch(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Sa(o,c){var _=ch(o);o=0;for(var k;_;){if(_.nodeType===3){if(k=o+_.textContent.length,o<=c&&k>=c)return{node:_,offset:c-o};o=k}e:{for(;_;){if(_.nextSibling){_=_.nextSibling;break e}_=_.parentNode}_=void 0}_=ch(_)}}function od(o,c){return o&&c?o===c?!0:o&&o.nodeType===3?!1:c&&c.nodeType===3?od(o,c.parentNode):"contains"in o?o.contains(c):o.compareDocumentPosition?!!(o.compareDocumentPosition(c)&16):!1:!1}function ad(){for(var o=window,c=us();c instanceof o.HTMLIFrameElement;){try{var _=typeof c.contentWindow.location.href=="string"}catch{_=!1}if(_)o=c.contentWindow;else break;c=us(o.document)}return c}function uh(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c&&(c==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||c==="textarea"||o.contentEditable==="true")}function yp(o){var c=ad(),_=o.focusedElem,k=o.selectionRange;if(c!==_&&_&&_.ownerDocument&&od(_.ownerDocument.documentElement,_)){if(k!==null&&uh(_)){if(c=k.start,o=k.end,o===void 0&&(o=c),"selectionStart"in _)_.selectionStart=c,_.selectionEnd=Math.min(o,_.value.length);else if(o=(c=_.ownerDocument||document)&&c.defaultView||window,o.getSelection){o=o.getSelection();var D=_.textContent.length,B=Math.min(k.start,D);k=k.end===void 0?B:Math.min(k.end,D),!o.extend&&B>k&&(D=k,k=B,B=D),D=Sa(_,B);var X=Sa(_,k);D&&X&&(o.rangeCount!==1||o.anchorNode!==D.node||o.anchorOffset!==D.offset||o.focusNode!==X.node||o.focusOffset!==X.offset)&&(c=c.createRange(),c.setStart(D.node,D.offset),o.removeAllRanges(),B>k?(o.addRange(c),o.extend(X.node,X.offset)):(c.setEnd(X.node,X.offset),o.addRange(c)))}}for(c=[],o=_;o=o.parentNode;)o.nodeType===1&&c.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof _.focus=="function"&&_.focus(),_=0;_<c.length;_++)o=c[_],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var _p=F&&"documentMode"in document&&11>=document.documentMode,Ea=null,dl=null,eo=null,ru=!1;function hh(o,c,_){var k=_.window===_?_.document:_.nodeType===9?_:_.ownerDocument;ru||Ea==null||Ea!==us(k)||(k=Ea,"selectionStart"in k&&uh(k)?k={start:k.selectionStart,end:k.selectionEnd}:(k=(k.ownerDocument&&k.ownerDocument.defaultView||window).getSelection(),k={anchorNode:k.anchorNode,anchorOffset:k.anchorOffset,focusNode:k.focusNode,focusOffset:k.focusOffset}),eo&&Xo(eo,k)||(eo=k,k=Ui(dl,"onSelect"),0<k.length&&(c=new ba("onSelect","select",null,c,_),o.push({event:c,listeners:k}),c.target=Ea)))}function vs(o,c){var _={};return _[o.toLowerCase()]=c.toLowerCase(),_["Webkit"+o]="webkit"+c,_["Moz"+o]="moz"+c,_}var wo={animationend:vs("Animation","AnimationEnd"),animationiteration:vs("Animation","AnimationIteration"),animationstart:vs("Animation","AnimationStart"),transitionend:vs("Transition","TransitionEnd")},Oi={},pl={};F&&(pl=document.createElement("div").style,"AnimationEvent"in window||(delete wo.animationend.animation,delete wo.animationiteration.animation,delete wo.animationstart.animation),"TransitionEvent"in window||delete wo.transitionend.transition);function cc(o){if(Oi[o])return Oi[o];if(!wo[o])return o;var c=wo[o],_;for(_ in c)if(c.hasOwnProperty(_)&&_ in pl)return Oi[o]=c[_];return o}var Ko=cc("animationend"),ka=cc("animationiteration"),uc=cc("animationstart"),hc=cc("transitionend"),Br=new Map,fl="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function To(o,c){Br.set(o,c),P(c,[o])}for(var ml=0;ml<fl.length;ml++){var Yo=fl[ml],ld=Yo.toLowerCase(),nu=Yo[0].toUpperCase()+Yo.slice(1);To(ld,"on"+nu)}To(Ko,"onAnimationEnd"),To(ka,"onAnimationIteration"),To(uc,"onAnimationStart"),To("dblclick","onDoubleClick"),To("focusin","onFocus"),To("focusout","onBlur"),To(hc,"onTransitionEnd"),j("onMouseEnter",["mouseout","mouseover"]),j("onMouseLeave",["mouseout","mouseover"]),j("onPointerEnter",["pointerout","pointerover"]),j("onPointerLeave",["pointerout","pointerover"]),P("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),P("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),P("onBeforeInput",["compositionend","keypress","textInput","paste"]),P("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),P("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),P("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var es="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),cd=new Set("cancel close invalid load scroll toggle".split(" ").concat(es));function dc(o,c,_){var k=o.type||"unknown-event";o.currentTarget=_,_i(k,c,void 0,o),o.currentTarget=null}function Ca(o,c){c=(c&4)!==0;for(var _=0;_<o.length;_++){var k=o[_],D=k.event;k=k.listeners;e:{var B=void 0;if(c)for(var X=k.length-1;0<=X;X--){var fe=k[X],ke=fe.instance,Ke=fe.currentTarget;if(fe=fe.listener,ke!==B&&D.isPropagationStopped())break e;dc(D,fe,Ke),B=ke}else for(X=0;X<k.length;X++){if(fe=k[X],ke=fe.instance,Ke=fe.currentTarget,fe=fe.listener,ke!==B&&D.isPropagationStopped())break e;dc(D,fe,Ke),B=ke}}}if(fr)throw o=Pr,fr=!1,Pr=null,o}function en(o,c){var _=c[ou];_===void 0&&(_=c[ou]=new Set);var k=o+"__bubble";_.has(k)||(fc(c,o,2,!1),_.add(k))}function pc(o,c,_){var k=0;c&&(k|=4),fc(_,o,k,c)}var Jo="_reactListening"+Math.random().toString(36).slice(2);function So(o){if(!o[Jo]){o[Jo]=!0,w.forEach(function(_){_!=="selectionchange"&&(cd.has(_)||pc(_,!1,o),pc(_,!0,o))});var c=o.nodeType===9?o:o.ownerDocument;c===null||c[Jo]||(c[Jo]=!0,pc("selectionchange",!1,c))}}function fc(o,c,_,k){switch(Wc(c)){case 1:var D=Gu;break;case 4:D=vo;break;default:D=Ys}_=D.bind(null,c,_,o),D=void 0,!Ct||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(D=!0),k?D!==void 0?o.addEventListener(c,_,{capture:!0,passive:D}):o.addEventListener(c,_,!0):D!==void 0?o.addEventListener(c,_,{passive:D}):o.addEventListener(c,_,!1)}function gl(o,c,_,k,D){var B=k;if((c&1)===0&&(c&2)===0&&k!==null)e:for(;;){if(k===null)return;var X=k.tag;if(X===3||X===4){var fe=k.stateNode.containerInfo;if(fe===D||fe.nodeType===8&&fe.parentNode===D)break;if(X===4)for(X=k.return;X!==null;){var ke=X.tag;if((ke===3||ke===4)&&(ke=X.stateNode.containerInfo,ke===D||ke.nodeType===8&&ke.parentNode===D))return;X=X.return}for(;fe!==null;){if(X=$i(fe),X===null)return;if(ke=X.tag,ke===5||ke===6){k=B=X;continue e}fe=fe.parentNode}}k=k.return}qe(function(){var Ke=B,Et=Ya(_),At=[];e:{var bt=Br.get(o);if(bt!==void 0){var qt=ba,Yt=o;switch(o){case"keypress":if(_s(_)===0)break e;case"keydown":case"keyup":qt=Yc;break;case"focusin":Yt="focus",qt=Zc;break;case"focusout":Yt="blur",qt=Zc;break;case"beforeblur":case"afterblur":qt=Zc;break;case"click":if(_.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qt=Qh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qt=ed;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qt=rd;break;case Ko:case ka:case uc:qt=ol;break;case hc:qt=nd;break;case"scroll":qt=qc;break;case"wheel":qt=Ju;break;case"copy":case"cut":case"paste":qt=al;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qt=Rr}var Jt=(c&4)!==0,Wn=!Jt&&o==="scroll",We=Jt?bt!==null?bt+"Capture":null:bt;Jt=[];for(var Ie=Ke,Xe;Ie!==null;){Xe=Ie;var jt=Xe.stateNode;if(Xe.tag===5&&jt!==null&&(Xe=jt,We!==null&&(jt=xt(Ie,We),jt!=null&&Jt.push(It(Ie,jt,Xe)))),Wn)break;Ie=Ie.return}0<Jt.length&&(bt=new qt(bt,Yt,null,_,Et),At.push({event:bt,listeners:Jt}))}}if((c&7)===0){e:{if(bt=o==="mouseover"||o==="pointerover",qt=o==="mouseout"||o==="pointerout",bt&&_!==Vo&&(Yt=_.relatedTarget||_.fromElement)&&($i(Yt)||Yt[zs]))break e;if((qt||bt)&&(bt=Et.window===Et?Et:(bt=Et.ownerDocument)?bt.defaultView||bt.parentWindow:window,qt?(Yt=_.relatedTarget||_.toElement,qt=Ke,Yt=Yt?$i(Yt):null,Yt!==null&&(Wn=fn(Yt),Yt!==Wn||Yt.tag!==5&&Yt.tag!==6)&&(Yt=null)):(qt=null,Yt=Ke),qt!==Yt)){if(Jt=Qh,jt="onMouseLeave",We="onMouseEnter",Ie="mouse",(o==="pointerout"||o==="pointerover")&&(Jt=Rr,jt="onPointerLeave",We="onPointerEnter",Ie="pointer"),Wn=qt==null?bt:Pa(qt),Xe=Yt==null?bt:Pa(Yt),bt=new Jt(jt,Ie+"leave",qt,_,Et),bt.target=Wn,bt.relatedTarget=Xe,jt=null,$i(Et)===Ke&&(Jt=new Jt(We,Ie+"enter",Yt,_,Et),Jt.target=Xe,Jt.relatedTarget=Wn,jt=Jt),Wn=jt,qt&&Yt)t:{for(Jt=qt,We=Yt,Ie=0,Xe=Jt;Xe;Xe=Aa(Xe))Ie++;for(Xe=0,jt=We;jt;jt=Aa(jt))Xe++;for(;0<Ie-Xe;)Jt=Aa(Jt),Ie--;for(;0<Xe-Ie;)We=Aa(We),Xe--;for(;Ie--;){if(Jt===We||We!==null&&Jt===We.alternate)break t;Jt=Aa(Jt),We=Aa(We)}Jt=null}else Jt=null;qt!==null&&yl(At,bt,qt,Jt,!1),Yt!==null&&Wn!==null&&yl(At,Wn,Yt,Jt,!0)}}e:{if(bt=Ke?Pa(Ke):window,qt=bt.nodeName&&bt.nodeName.toLowerCase(),qt==="select"||qt==="input"&&bt.type==="file")var Qt=id;else if(ul(bt))if(tu)Qt=sd;else{Qt=gp;var or=ah}else(qt=bt.nodeName)&&qt.toLowerCase()==="input"&&(bt.type==="checkbox"||bt.type==="radio")&&(Qt=lh);if(Qt&&(Qt=Qt(o,Ke))){eu(At,Qt,_,Et);break e}or&&or(o,bt,Ke),o==="focusout"&&(or=bt._wrapperState)&&or.controlled&&bt.type==="number"&&vr(bt,"number",bt.value)}switch(or=Ke?Pa(Ke):window,o){case"focusin":(ul(or)||or.contentEditable==="true")&&(Ea=or,dl=Ke,eo=null);break;case"focusout":eo=dl=Ea=null;break;case"mousedown":ru=!0;break;case"contextmenu":case"mouseup":case"dragend":ru=!1,hh(At,_,Et);break;case"selectionchange":if(_p)break;case"keydown":case"keyup":hh(At,_,Et)}var ar;if(Qu)e:{switch(o){case"compositionstart":var kr="onCompositionStart";break e;case"compositionend":kr="onCompositionEnd";break e;case"compositionupdate":kr="onCompositionUpdate";break e}kr=void 0}else ll?th(o,_)&&(kr="onCompositionEnd"):o==="keydown"&&_.keyCode===229&&(kr="onCompositionStart");kr&&(Jc&&_.locale!=="ko"&&(ll||kr!=="onCompositionStart"?kr==="onCompositionEnd"&&ll&&(ar=Wo()):(Qi=Et,ys="value"in Qi?Qi.value:Qi.textContent,ll=!0)),or=Ui(Ke,kr),0<or.length&&(kr=new Zo(kr,o,null,_,Et),At.push({event:kr,listeners:or}),ar?kr.data=ar:(ar=rh(_),ar!==null&&(kr.data=ar)))),(ar=eh?sc(o,_):cl(o,_))&&(Ke=Ui(Ke,"onBeforeInput"),0<Ke.length&&(Et=new Zo("onBeforeInput","beforeinput",null,_,Et),At.push({event:Et,listeners:Ke}),Et.data=ar))}Ca(At,c)})}function It(o,c,_){return{instance:o,listener:c,currentTarget:_}}function Ui(o,c){for(var _=c+"Capture",k=[];o!==null;){var D=o,B=D.stateNode;D.tag===5&&B!==null&&(D=B,B=xt(o,_),B!=null&&k.unshift(It(o,B,D)),B=xt(o,c),B!=null&&k.push(It(o,B,D))),o=o.return}return k}function Aa(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function yl(o,c,_,k,D){for(var B=c._reactName,X=[];_!==null&&_!==k;){var fe=_,ke=fe.alternate,Ke=fe.stateNode;if(ke!==null&&ke===k)break;fe.tag===5&&Ke!==null&&(fe=Ke,D?(ke=xt(_,B),ke!=null&&X.unshift(It(_,ke,fe))):D||(ke=xt(_,B),ke!=null&&X.push(It(_,ke,fe)))),_=_.return}X.length!==0&&o.push({event:c,listeners:X})}var mc=/\r\n?/g,si=/\u0000|\uFFFD/g;function _l(o){return(typeof o=="string"?o:""+o).replace(mc,`
`).replace(si,"")}function Ma(o,c,_){if(c=_l(c),_l(o)!==c&&_)throw Error(g(425))}function xl(){}var vl=null,iu=null;function bl(o,c){return o==="textarea"||o==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var Qo=typeof setTimeout=="function"?setTimeout:void 0,dh=typeof clearTimeout=="function"?clearTimeout:void 0,ud=typeof Promise=="function"?Promise:void 0,hd=typeof queueMicrotask=="function"?queueMicrotask:typeof ud<"u"?function(o){return ud.resolve(null).then(o).catch(wl)}:Qo;function wl(o){setTimeout(function(){throw o})}function gc(o,c){var _=c,k=0;do{var D=_.nextSibling;if(o.removeChild(_),D&&D.nodeType===8)if(_=D.data,_==="/$"){if(k===0){o.removeChild(D),js(c);return}k--}else _!=="$"&&_!=="$?"&&_!=="$!"||k++;_=D}while(_);js(c)}function to(o){for(;o!=null;o=o.nextSibling){var c=o.nodeType;if(c===1||c===3)break;if(c===8){if(c=o.data,c==="$"||c==="$!"||c==="$?")break;if(c==="/$")return null}}return o}function su(o){o=o.previousSibling;for(var c=0;o;){if(o.nodeType===8){var _=o.data;if(_==="$"||_==="$!"||_==="$?"){if(c===0)return o;c--}else _==="/$"&&c++}o=o.previousSibling}return null}var Eo=Math.random().toString(36).slice(2),Vi="__reactFiber$"+Eo,ko="__reactProps$"+Eo,zs="__reactContainer$"+Eo,ou="__reactEvents$"+Eo,ph="__reactListeners$"+Eo,dd="__reactHandles$"+Eo;function $i(o){var c=o[Vi];if(c)return c;for(var _=o.parentNode;_;){if(c=_[zs]||_[Vi]){if(_=c.alternate,c.child!==null||_!==null&&_.child!==null)for(o=su(o);o!==null;){if(_=o[Vi])return _;o=su(o)}return c}o=_,_=o.parentNode}return null}function Tl(o){return o=o[Vi]||o[zs],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function Pa(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(g(33))}function au(o){return o[ko]||null}var lu=[],ea=-1;function Co(o){return{current:o}}function mn(o){0>ea||(o.current=lu[ea],lu[ea]=null,ea--)}function Lr(o,c){ea++,lu[ea]=o.current,o.current=c}var ta={},pi=Co(ta),Gi=Co(!1),Ia=ta;function fi(o,c){var _=o.type.contextTypes;if(!_)return ta;var k=o.stateNode;if(k&&k.__reactInternalMemoizedUnmaskedChildContext===c)return k.__reactInternalMemoizedMaskedChildContext;var D={},B;for(B in _)D[B]=c[B];return k&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=c,o.__reactInternalMemoizedMaskedChildContext=D),D}function Pi(o){return o=o.childContextTypes,o!=null}function cu(){mn(Gi),mn(pi)}function bs(o,c,_){if(pi.current!==ta)throw Error(g(168));Lr(pi,c),Lr(Gi,_)}function Ns(o,c,_){var k=o.stateNode;if(c=c.childContextTypes,typeof k.getChildContext!="function")return _;k=k.getChildContext();for(var D in k)if(!(D in c))throw Error(g(108,Ur(o)||"Unknown",D));return _t({},_,k)}function ro(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||ta,Ia=pi.current,Lr(pi,o),Lr(Gi,Gi.current),!0}function yc(o,c,_){var k=o.stateNode;if(!k)throw Error(g(169));_?(o=Ns(o,c,Ia),k.__reactInternalMemoizedMergedChildContext=o,mn(Gi),mn(pi),Lr(pi,o)):mn(Gi),Lr(Gi,_)}var Lt=null,Sl=!1,_c=!1;function Da(o){Lt===null?Lt=[o]:Lt.push(o)}function La(o){Sl=!0,Da(o)}function Pt(){if(!_c&&Lt!==null){_c=!0;var o=0,c=$r;try{var _=Lt;for($r=1;o<_.length;o++){var k=_[o];do k=k(!0);while(k!==null)}Lt=null,Sl=!1}catch(D){throw Lt!==null&&(Lt=Lt.slice(o+1)),Fu(ds,Pt),D}finally{$r=c,_c=!1}}return null}var ra=[],El=0,xc=null,kl=0,ts=[],rs=0,ja=null,Ao=1,Bs="";function Mo(o,c){ra[El++]=kl,ra[El++]=xc,xc=o,kl=c}function uu(o,c,_){ts[rs++]=Ao,ts[rs++]=Bs,ts[rs++]=ja,ja=o;var k=Ao;o=Bs;var D=32-Xn(k)-1;k&=~(1<<D),_+=1;var B=32-Xn(c)+D;if(30<B){var X=D-D%5;B=(k&(1<<X)-1).toString(32),k>>=X,D-=X,Ao=1<<32-Xn(c)+D|_<<D|k,Bs=B+o}else Ao=1<<B|_<<D|k,Bs=o}function na(o){o.return!==null&&(Mo(o,1),uu(o,1,0))}function h(o){for(;o===xc;)xc=ra[--El],ra[El]=null,kl=ra[--El],ra[El]=null;for(;o===ja;)ja=ts[--rs],ts[rs]=null,Bs=ts[--rs],ts[rs]=null,Ao=ts[--rs],ts[rs]=null}var n=null,a=null,f=!1,y=null;function b(o,c){var _=wi(5,null,null,0);_.elementType="DELETED",_.stateNode=c,_.return=o,c=o.deletions,c===null?(o.deletions=[_],o.flags|=16):c.push(_)}function C(o,c){switch(o.tag){case 5:var _=o.type;return c=c.nodeType!==1||_.toLowerCase()!==c.nodeName.toLowerCase()?null:c,c!==null?(o.stateNode=c,n=o,a=to(c.firstChild),!0):!1;case 6:return c=o.pendingProps===""||c.nodeType!==3?null:c,c!==null?(o.stateNode=c,n=o,a=null,!0):!1;case 13:return c=c.nodeType!==8?null:c,c!==null?(_=ja!==null?{id:Ao,overflow:Bs}:null,o.memoizedState={dehydrated:c,treeContext:_,retryLane:1073741824},_=wi(18,null,null,0),_.stateNode=c,_.return=o,o.child=_,n=o,a=null,!0):!1;default:return!1}}function A(o){return(o.mode&1)!==0&&(o.flags&128)===0}function I(o){if(f){var c=a;if(c){var _=c;if(!C(o,c)){if(A(o))throw Error(g(418));c=to(_.nextSibling);var k=n;c&&C(o,c)?b(k,_):(o.flags=o.flags&-4097|2,f=!1,n=o)}}else{if(A(o))throw Error(g(418));o.flags=o.flags&-4097|2,f=!1,n=o}}}function N(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;n=o}function z(o){if(o!==n)return!1;if(!f)return N(o),f=!0,!1;var c;if((c=o.tag!==3)&&!(c=o.tag!==5)&&(c=o.type,c=c!=="head"&&c!=="body"&&!bl(o.type,o.memoizedProps)),c&&(c=a)){if(A(o))throw $(),Error(g(418));for(;c;)b(o,c),c=to(c.nextSibling)}if(N(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(g(317));e:{for(o=o.nextSibling,c=0;o;){if(o.nodeType===8){var _=o.data;if(_==="/$"){if(c===0){a=to(o.nextSibling);break e}c--}else _!=="$"&&_!=="$!"&&_!=="$?"||c++}o=o.nextSibling}a=null}}else a=n?to(o.stateNode.nextSibling):null;return!0}function $(){for(var o=a;o;)o=to(o.nextSibling)}function K(){a=n=null,f=!1}function re(o){y===null?y=[o]:y.push(o)}var ie=lt.ReactCurrentBatchConfig;function ne(o,c,_){if(o=_.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(_._owner){if(_=_._owner,_){if(_.tag!==1)throw Error(g(309));var k=_.stateNode}if(!k)throw Error(g(147,o));var D=k,B=""+o;return c!==null&&c.ref!==null&&typeof c.ref=="function"&&c.ref._stringRef===B?c.ref:(c=function(X){var fe=D.refs;X===null?delete fe[B]:fe[B]=X},c._stringRef=B,c)}if(typeof o!="string")throw Error(g(284));if(!_._owner)throw Error(g(290,o))}return o}function se(o,c){throw o=Object.prototype.toString.call(c),Error(g(31,o==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":o))}function W(o){var c=o._init;return c(o._payload)}function te(o){function c(We,Ie){if(o){var Xe=We.deletions;Xe===null?(We.deletions=[Ie],We.flags|=16):Xe.push(Ie)}}function _(We,Ie){if(!o)return null;for(;Ie!==null;)c(We,Ie),Ie=Ie.sibling;return null}function k(We,Ie){for(We=new Map;Ie!==null;)Ie.key!==null?We.set(Ie.key,Ie):We.set(Ie.index,Ie),Ie=Ie.sibling;return We}function D(We,Ie){return We=Nl(We,Ie),We.index=0,We.sibling=null,We}function B(We,Ie,Xe){return We.index=Xe,o?(Xe=We.alternate,Xe!==null?(Xe=Xe.index,Xe<Ie?(We.flags|=2,Ie):Xe):(We.flags|=2,Ie)):(We.flags|=1048576,Ie)}function X(We){return o&&We.alternate===null&&(We.flags|=2),We}function fe(We,Ie,Xe,jt){return Ie===null||Ie.tag!==6?(Ie=Vp(Xe,We.mode,jt),Ie.return=We,Ie):(Ie=D(Ie,Xe),Ie.return=We,Ie)}function ke(We,Ie,Xe,jt){var Qt=Xe.type;return Qt===Ye?Et(We,Ie,Xe.props.children,jt,Xe.key):Ie!==null&&(Ie.elementType===Qt||typeof Qt=="object"&&Qt!==null&&Qt.$$typeof===ir&&W(Qt)===Ie.type)?(jt=D(Ie,Xe.props),jt.ref=ne(We,Ie,Xe),jt.return=We,jt):(jt=jd(Xe.type,Xe.key,Xe.props,null,We.mode,jt),jt.ref=ne(We,Ie,Xe),jt.return=We,jt)}function Ke(We,Ie,Xe,jt){return Ie===null||Ie.tag!==4||Ie.stateNode.containerInfo!==Xe.containerInfo||Ie.stateNode.implementation!==Xe.implementation?(Ie=$p(Xe,We.mode,jt),Ie.return=We,Ie):(Ie=D(Ie,Xe.children||[]),Ie.return=We,Ie)}function Et(We,Ie,Xe,jt,Qt){return Ie===null||Ie.tag!==7?(Ie=Dc(Xe,We.mode,jt,Qt),Ie.return=We,Ie):(Ie=D(Ie,Xe),Ie.return=We,Ie)}function At(We,Ie,Xe){if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number")return Ie=Vp(""+Ie,We.mode,Xe),Ie.return=We,Ie;if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case kt:return Xe=jd(Ie.type,Ie.key,Ie.props,null,We.mode,Xe),Xe.ref=ne(We,null,Ie),Xe.return=We,Xe;case $e:return Ie=$p(Ie,We.mode,Xe),Ie.return=We,Ie;case ir:var jt=Ie._init;return At(We,jt(Ie._payload),Xe)}if(Mr(Ie)||Fe(Ie))return Ie=Dc(Ie,We.mode,Xe,null),Ie.return=We,Ie;se(We,Ie)}return null}function bt(We,Ie,Xe,jt){var Qt=Ie!==null?Ie.key:null;if(typeof Xe=="string"&&Xe!==""||typeof Xe=="number")return Qt!==null?null:fe(We,Ie,""+Xe,jt);if(typeof Xe=="object"&&Xe!==null){switch(Xe.$$typeof){case kt:return Xe.key===Qt?ke(We,Ie,Xe,jt):null;case $e:return Xe.key===Qt?Ke(We,Ie,Xe,jt):null;case ir:return Qt=Xe._init,bt(We,Ie,Qt(Xe._payload),jt)}if(Mr(Xe)||Fe(Xe))return Qt!==null?null:Et(We,Ie,Xe,jt,null);se(We,Xe)}return null}function qt(We,Ie,Xe,jt,Qt){if(typeof jt=="string"&&jt!==""||typeof jt=="number")return We=We.get(Xe)||null,fe(Ie,We,""+jt,Qt);if(typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case kt:return We=We.get(jt.key===null?Xe:jt.key)||null,ke(Ie,We,jt,Qt);case $e:return We=We.get(jt.key===null?Xe:jt.key)||null,Ke(Ie,We,jt,Qt);case ir:var or=jt._init;return qt(We,Ie,Xe,or(jt._payload),Qt)}if(Mr(jt)||Fe(jt))return We=We.get(Xe)||null,Et(Ie,We,jt,Qt,null);se(Ie,jt)}return null}function Yt(We,Ie,Xe,jt){for(var Qt=null,or=null,ar=Ie,kr=Ie=0,Ti=null;ar!==null&&kr<Xe.length;kr++){ar.index>kr?(Ti=ar,ar=null):Ti=ar.sibling;var Zr=bt(We,ar,Xe[kr],jt);if(Zr===null){ar===null&&(ar=Ti);break}o&&ar&&Zr.alternate===null&&c(We,ar),Ie=B(Zr,Ie,kr),or===null?Qt=Zr:or.sibling=Zr,or=Zr,ar=Ti}if(kr===Xe.length)return _(We,ar),f&&Mo(We,kr),Qt;if(ar===null){for(;kr<Xe.length;kr++)ar=At(We,Xe[kr],jt),ar!==null&&(Ie=B(ar,Ie,kr),or===null?Qt=ar:or.sibling=ar,or=ar);return f&&Mo(We,kr),Qt}for(ar=k(We,ar);kr<Xe.length;kr++)Ti=qt(ar,We,kr,Xe[kr],jt),Ti!==null&&(o&&Ti.alternate!==null&&ar.delete(Ti.key===null?kr:Ti.key),Ie=B(Ti,Ie,kr),or===null?Qt=Ti:or.sibling=Ti,or=Ti);return o&&ar.forEach(function(ao){return c(We,ao)}),f&&Mo(We,kr),Qt}function Jt(We,Ie,Xe,jt){var Qt=Fe(Xe);if(typeof Qt!="function")throw Error(g(150));if(Xe=Qt.call(Xe),Xe==null)throw Error(g(151));for(var or=Qt=null,ar=Ie,kr=Ie=0,Ti=null,Zr=Xe.next();ar!==null&&!Zr.done;kr++,Zr=Xe.next()){ar.index>kr?(Ti=ar,ar=null):Ti=ar.sibling;var ao=bt(We,ar,Zr.value,jt);if(ao===null){ar===null&&(ar=Ti);break}o&&ar&&ao.alternate===null&&c(We,ar),Ie=B(ao,Ie,kr),or===null?Qt=ao:or.sibling=ao,or=ao,ar=Ti}if(Zr.done)return _(We,ar),f&&Mo(We,kr),Qt;if(ar===null){for(;!Zr.done;kr++,Zr=Xe.next())Zr=At(We,Zr.value,jt),Zr!==null&&(Ie=B(Zr,Ie,kr),or===null?Qt=Zr:or.sibling=Zr,or=Zr);return f&&Mo(We,kr),Qt}for(ar=k(We,ar);!Zr.done;kr++,Zr=Xe.next())Zr=qt(ar,We,kr,Zr.value,jt),Zr!==null&&(o&&Zr.alternate!==null&&ar.delete(Zr.key===null?kr:Zr.key),Ie=B(Zr,Ie,kr),or===null?Qt=Zr:or.sibling=Zr,or=Zr);return o&&ar.forEach(function(lm){return c(We,lm)}),f&&Mo(We,kr),Qt}function Wn(We,Ie,Xe,jt){if(typeof Xe=="object"&&Xe!==null&&Xe.type===Ye&&Xe.key===null&&(Xe=Xe.props.children),typeof Xe=="object"&&Xe!==null){switch(Xe.$$typeof){case kt:e:{for(var Qt=Xe.key,or=Ie;or!==null;){if(or.key===Qt){if(Qt=Xe.type,Qt===Ye){if(or.tag===7){_(We,or.sibling),Ie=D(or,Xe.props.children),Ie.return=We,We=Ie;break e}}else if(or.elementType===Qt||typeof Qt=="object"&&Qt!==null&&Qt.$$typeof===ir&&W(Qt)===or.type){_(We,or.sibling),Ie=D(or,Xe.props),Ie.ref=ne(We,or,Xe),Ie.return=We,We=Ie;break e}_(We,or);break}else c(We,or);or=or.sibling}Xe.type===Ye?(Ie=Dc(Xe.props.children,We.mode,jt,Xe.key),Ie.return=We,We=Ie):(jt=jd(Xe.type,Xe.key,Xe.props,null,We.mode,jt),jt.ref=ne(We,Ie,Xe),jt.return=We,We=jt)}return X(We);case $e:e:{for(or=Xe.key;Ie!==null;){if(Ie.key===or)if(Ie.tag===4&&Ie.stateNode.containerInfo===Xe.containerInfo&&Ie.stateNode.implementation===Xe.implementation){_(We,Ie.sibling),Ie=D(Ie,Xe.children||[]),Ie.return=We,We=Ie;break e}else{_(We,Ie);break}else c(We,Ie);Ie=Ie.sibling}Ie=$p(Xe,We.mode,jt),Ie.return=We,We=Ie}return X(We);case ir:return or=Xe._init,Wn(We,Ie,or(Xe._payload),jt)}if(Mr(Xe))return Yt(We,Ie,Xe,jt);if(Fe(Xe))return Jt(We,Ie,Xe,jt);se(We,Xe)}return typeof Xe=="string"&&Xe!==""||typeof Xe=="number"?(Xe=""+Xe,Ie!==null&&Ie.tag===6?(_(We,Ie.sibling),Ie=D(Ie,Xe),Ie.return=We,We=Ie):(_(We,Ie),Ie=Vp(Xe,We.mode,jt),Ie.return=We,We=Ie),X(We)):_(We,Ie)}return Wn}var le=te(!0),ce=te(!1),xe=Co(null),be=null,ve=null,Pe=null;function Ce(){Pe=ve=be=null}function Oe(o){var c=xe.current;mn(xe),o._currentValue=c}function ft(o,c,_){for(;o!==null;){var k=o.alternate;if((o.childLanes&c)!==c?(o.childLanes|=c,k!==null&&(k.childLanes|=c)):k!==null&&(k.childLanes&c)!==c&&(k.childLanes|=c),o===_)break;o=o.return}}function je(o,c){be=o,Pe=ve=null,o=o.dependencies,o!==null&&o.firstContext!==null&&((o.lanes&c)!==0&&(vi=!0),o.firstContext=null)}function Je(o){var c=o._currentValue;if(Pe!==o)if(o={context:o,memoizedValue:c,next:null},ve===null){if(be===null)throw Error(g(308));ve=o,be.dependencies={lanes:0,firstContext:o}}else ve=ve.next=o;return c}var Ve=null;function dt(o){Ve===null?Ve=[o]:Ve.push(o)}function Be(o,c,_,k){var D=c.interleaved;return D===null?(_.next=_,dt(c)):(_.next=D.next,D.next=_),c.interleaved=_,Qe(o,k)}function Qe(o,c){o.lanes|=c;var _=o.alternate;for(_!==null&&(_.lanes|=c),_=o,o=o.return;o!==null;)o.childLanes|=c,_=o.alternate,_!==null&&(_.childLanes|=c),_=o,o=o.return;return _.tag===3?_.stateNode:null}var ht=!1;function ct(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function gt(o,c){o=o.updateQueue,c.updateQueue===o&&(c.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function Ut(o,c){return{eventTime:o,lane:c,tag:0,payload:null,callback:null,next:null}}function er(o,c,_){var k=o.updateQueue;if(k===null)return null;if(k=k.shared,(Kt&2)!==0){var D=k.pending;return D===null?c.next=c:(c.next=D.next,D.next=c),k.pending=c,Qe(o,_)}return D=k.interleaved,D===null?(c.next=c,dt(k)):(c.next=D.next,D.next=c),k.interleaved=c,Qe(o,_)}function Nt(o,c,_){if(c=c.updateQueue,c!==null&&(c=c.shared,(_&4194240)!==0)){var k=c.lanes;k&=o.pendingLanes,_|=k,c.lanes=_,_a(o,_)}}function Xt(o,c){var _=o.updateQueue,k=o.alternate;if(k!==null&&(k=k.updateQueue,_===k)){var D=null,B=null;if(_=_.firstBaseUpdate,_!==null){do{var X={eventTime:_.eventTime,lane:_.lane,tag:_.tag,payload:_.payload,callback:_.callback,next:null};B===null?D=B=X:B=B.next=X,_=_.next}while(_!==null);B===null?D=B=c:B=B.next=c}else D=B=c;_={baseState:k.baseState,firstBaseUpdate:D,lastBaseUpdate:B,shared:k.shared,effects:k.effects},o.updateQueue=_;return}o=_.lastBaseUpdate,o===null?_.firstBaseUpdate=c:o.next=c,_.lastBaseUpdate=c}function br(o,c,_,k){var D=o.updateQueue;ht=!1;var B=D.firstBaseUpdate,X=D.lastBaseUpdate,fe=D.shared.pending;if(fe!==null){D.shared.pending=null;var ke=fe,Ke=ke.next;ke.next=null,X===null?B=Ke:X.next=Ke,X=ke;var Et=o.alternate;Et!==null&&(Et=Et.updateQueue,fe=Et.lastBaseUpdate,fe!==X&&(fe===null?Et.firstBaseUpdate=Ke:fe.next=Ke,Et.lastBaseUpdate=ke))}if(B!==null){var At=D.baseState;X=0,Et=Ke=ke=null,fe=B;do{var bt=fe.lane,qt=fe.eventTime;if((k&bt)===bt){Et!==null&&(Et=Et.next={eventTime:qt,lane:0,tag:fe.tag,payload:fe.payload,callback:fe.callback,next:null});e:{var Yt=o,Jt=fe;switch(bt=c,qt=_,Jt.tag){case 1:if(Yt=Jt.payload,typeof Yt=="function"){At=Yt.call(qt,At,bt);break e}At=Yt;break e;case 3:Yt.flags=Yt.flags&-65537|128;case 0:if(Yt=Jt.payload,bt=typeof Yt=="function"?Yt.call(qt,At,bt):Yt,bt==null)break e;At=_t({},At,bt);break e;case 2:ht=!0}}fe.callback!==null&&fe.lane!==0&&(o.flags|=64,bt=D.effects,bt===null?D.effects=[fe]:bt.push(fe))}else qt={eventTime:qt,lane:bt,tag:fe.tag,payload:fe.payload,callback:fe.callback,next:null},Et===null?(Ke=Et=qt,ke=At):Et=Et.next=qt,X|=bt;if(fe=fe.next,fe===null){if(fe=D.shared.pending,fe===null)break;bt=fe,fe=bt.next,bt.next=null,D.lastBaseUpdate=bt,D.shared.pending=null}}while(!0);if(Et===null&&(ke=At),D.baseState=ke,D.firstBaseUpdate=Ke,D.lastBaseUpdate=Et,c=D.shared.interleaved,c!==null){D=c;do X|=D.lane,D=D.next;while(D!==c)}else B===null&&(D.shared.lanes=0);Pn|=X,o.lanes=X,o.memoizedState=At}}function Er(o,c,_){if(o=c.effects,c.effects=null,o!==null)for(c=0;c<o.length;c++){var k=o[c],D=k.callback;if(D!==null){if(k.callback=null,k=_,typeof D!="function")throw Error(g(191,D));D.call(k)}}}var Vt={},Ir=Co(Vt),Gr=Co(Vt),Wr=Co(Vt);function Or(o){if(o===Vt)throw Error(g(174));return o}function oi(o,c){switch(Lr(Wr,c),Lr(Gr,o),Lr(Ir,Vt),o=c.nodeType,o){case 9:case 11:c=(c=c.documentElement)?c.namespaceURI:Ha(null,"");break;default:o=o===8?c.parentNode:c,c=o.namespaceURI||null,o=o.tagName,c=Ha(c,o)}mn(Ir),Lr(Ir,c)}function Sn(){mn(Ir),mn(Gr),mn(Wr)}function ns(o){Or(Wr.current);var c=Or(Ir.current),_=Ha(c,o.type);c!==_&&(Lr(Gr,o),Lr(Ir,_))}function ws(o){Gr.current===o&&(mn(Ir),mn(Gr))}var pr=Co(0);function Kr(o){for(var c=o;c!==null;){if(c.tag===13){var _=c.memoizedState;if(_!==null&&(_=_.dehydrated,_===null||_.data==="$?"||_.data==="$!"))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var Fr=[];function En(){for(var o=0;o<Fr.length;o++)Fr[o]._workInProgressVersionPrimary=null;Fr.length=0}var ai=lt.ReactCurrentDispatcher,rn=lt.ReactCurrentBatchConfig,Un=0,gn=null,xn=null,Mn=null,Ts=!1,Ss=!1,Fs=0,hu=0;function Vn(){throw Error(g(321))}function vc(o,c){if(c===null)return!1;for(var _=0;_<c.length&&_<o.length;_++)if(!xs(o[_],c[_]))return!1;return!0}function pd(o,c,_,k,D,B){if(Un=B,gn=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,ai.current=o===null||o.memoizedState===null?Hf:Xf,o=_(k,D),Ss){B=0;do{if(Ss=!1,Fs=0,25<=B)throw Error(g(301));B+=1,Mn=xn=null,c.updateQueue=null,ai.current=Io,o=_(k,D)}while(Ss)}if(ai.current=Ii,c=xn!==null&&xn.next!==null,Un=0,Mn=xn=gn=null,Ts=!1,c)throw Error(g(300));return o}function fd(){var o=Fs!==0;return Fs=0,o}function ia(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mn===null?gn.memoizedState=Mn=o:Mn=Mn.next=o,Mn}function Es(){if(xn===null){var o=gn.alternate;o=o!==null?o.memoizedState:null}else o=xn.next;var c=Mn===null?gn.memoizedState:Mn.next;if(c!==null)Mn=c,xn=o;else{if(o===null)throw Error(g(310));xn=o,o={memoizedState:xn.memoizedState,baseState:xn.baseState,baseQueue:xn.baseQueue,queue:xn.queue,next:null},Mn===null?gn.memoizedState=Mn=o:Mn=Mn.next=o}return Mn}function Cl(o,c){return typeof c=="function"?c(o):c}function md(o){var c=Es(),_=c.queue;if(_===null)throw Error(g(311));_.lastRenderedReducer=o;var k=xn,D=k.baseQueue,B=_.pending;if(B!==null){if(D!==null){var X=D.next;D.next=B.next,B.next=X}k.baseQueue=D=B,_.pending=null}if(D!==null){B=D.next,k=k.baseState;var fe=X=null,ke=null,Ke=B;do{var Et=Ke.lane;if((Un&Et)===Et)ke!==null&&(ke=ke.next={lane:0,action:Ke.action,hasEagerState:Ke.hasEagerState,eagerState:Ke.eagerState,next:null}),k=Ke.hasEagerState?Ke.eagerState:o(k,Ke.action);else{var At={lane:Et,action:Ke.action,hasEagerState:Ke.hasEagerState,eagerState:Ke.eagerState,next:null};ke===null?(fe=ke=At,X=k):ke=ke.next=At,gn.lanes|=Et,Pn|=Et}Ke=Ke.next}while(Ke!==null&&Ke!==B);ke===null?X=k:ke.next=fe,xs(k,c.memoizedState)||(vi=!0),c.memoizedState=k,c.baseState=X,c.baseQueue=ke,_.lastRenderedState=k}if(o=_.interleaved,o!==null){D=o;do B=D.lane,gn.lanes|=B,Pn|=B,D=D.next;while(D!==o)}else D===null&&(_.lanes=0);return[c.memoizedState,_.dispatch]}function fh(o){var c=Es(),_=c.queue;if(_===null)throw Error(g(311));_.lastRenderedReducer=o;var k=_.dispatch,D=_.pending,B=c.memoizedState;if(D!==null){_.pending=null;var X=D=D.next;do B=o(B,X.action),X=X.next;while(X!==D);xs(B,c.memoizedState)||(vi=!0),c.memoizedState=B,c.baseQueue===null&&(c.baseState=B),_.lastRenderedState=B}return[B,k]}function mh(){}function sa(o,c){var _=gn,k=Es(),D=c(),B=!xs(k.memoizedState,D);if(B&&(k.memoizedState=D,vi=!0),k=k.queue,oa(vp.bind(null,_,k,o),[o]),k.getSnapshot!==c||B||Mn!==null&&Mn.memoizedState.tag&1){if(_.flags|=2048,bc(9,xp.bind(null,_,k,D,c),void 0,null),ci===null)throw Error(g(349));(Un&30)!==0||gh(_,c,D)}return D}function gh(o,c,_){o.flags|=16384,o={getSnapshot:c,value:_},c=gn.updateQueue,c===null?(c={lastEffect:null,stores:null},gn.updateQueue=c,c.stores=[o]):(_=c.stores,_===null?c.stores=[o]:_.push(o))}function xp(o,c,_,k){c.value=_,c.getSnapshot=k,Uf(c)&&Vf(o)}function vp(o,c,_){return _(function(){Uf(c)&&Vf(o)})}function Uf(o){var c=o.getSnapshot;o=o.value;try{var _=c();return!xs(o,_)}catch{return!0}}function Vf(o){var c=Qe(o,1);c!==null&&Ro(c,o,1,-1)}function $f(o){var c=ia();return typeof o=="function"&&(o=o()),c.memoizedState=c.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Cl,lastRenderedState:o},c.queue=o,o=o.dispatch=zn.bind(null,gn,o),[c.memoizedState,o]}function bc(o,c,_,k){return o={tag:o,create:c,destroy:_,deps:k,next:null},c=gn.updateQueue,c===null?(c={lastEffect:null,stores:null},gn.updateQueue=c,c.lastEffect=o.next=o):(_=c.lastEffect,_===null?c.lastEffect=o.next=o:(k=_.next,_.next=o,o.next=k,c.lastEffect=o)),o}function du(){return Es().memoizedState}function Ra(o,c,_,k){var D=ia();gn.flags|=o,D.memoizedState=bc(1|c,_,void 0,k===void 0?null:k)}function no(o,c,_,k){var D=Es();k=k===void 0?null:k;var B=void 0;if(xn!==null){var X=xn.memoizedState;if(B=X.destroy,k!==null&&vc(k,X.deps)){D.memoizedState=bc(c,_,B,k);return}}gn.flags|=o,D.memoizedState=bc(1|c,_,B,k)}function io(o,c){return Ra(8390656,8,o,c)}function oa(o,c){return no(2048,8,o,c)}function za(o,c){return no(4,2,o,c)}function Al(o,c){return no(4,4,o,c)}function Gf(o,c){if(typeof c=="function")return o=o(),c(o),function(){c(null)};if(c!=null)return o=o(),c.current=o,function(){c.current=null}}function Wf(o,c,_){return _=_!=null?_.concat([o]):null,no(4,4,Gf.bind(null,c,o),_)}function bp(){}function qf(o,c){var _=Es();c=c===void 0?null:c;var k=_.memoizedState;return k!==null&&c!==null&&vc(c,k[1])?k[0]:(_.memoizedState=[o,c],o)}function wp(o,c){var _=Es();c=c===void 0?null:c;var k=_.memoizedState;return k!==null&&c!==null&&vc(c,k[1])?k[0]:(o=o(),_.memoizedState=[o,c],o)}function Tp(o,c,_){return(Un&21)===0?(o.baseState&&(o.baseState=!1,vi=!0),o.memoizedState=_):(xs(_,c)||(_=Bi(),gn.lanes|=_,Pn|=_,o.baseState=!0),c)}function Po(o,c){var _=$r;$r=_!==0&&4>_?_:4,o(!0);var k=rn.transition;rn.transition={};try{o(!1),c()}finally{$r=_,rn.transition=k}}function Zf(){return Es().memoizedState}function ig(o,c,_){var k=da(o);if(_={lane:k,action:_,hasEagerState:!1,eagerState:null,next:null},Zt(o))Na(c,_);else if(_=Be(o,c,_,k),_!==null){var D=os();Ro(_,o,k,D),yh(_,c,k)}}function zn(o,c,_){var k=da(o),D={lane:k,action:_,hasEagerState:!1,eagerState:null,next:null};if(Zt(o))Na(c,D);else{var B=o.alternate;if(o.lanes===0&&(B===null||B.lanes===0)&&(B=c.lastRenderedReducer,B!==null))try{var X=c.lastRenderedState,fe=B(X,_);if(D.hasEagerState=!0,D.eagerState=fe,xs(fe,X)){var ke=c.interleaved;ke===null?(D.next=D,dt(c)):(D.next=ke.next,ke.next=D),c.interleaved=D;return}}catch{}finally{}_=Be(o,c,D,k),_!==null&&(D=os(),Ro(_,o,k,D),yh(_,c,k))}}function Zt(o){var c=o.alternate;return o===gn||c!==null&&c===gn}function Na(o,c){Ss=Ts=!0;var _=o.pending;_===null?c.next=c:(c.next=_.next,_.next=c),o.pending=c}function yh(o,c,_){if((_&4194240)!==0){var k=c.lanes;k&=o.pendingLanes,_|=k,c.lanes=_,_a(o,_)}}var Ii={readContext:Je,useCallback:Vn,useContext:Vn,useEffect:Vn,useImperativeHandle:Vn,useInsertionEffect:Vn,useLayoutEffect:Vn,useMemo:Vn,useReducer:Vn,useRef:Vn,useState:Vn,useDebugValue:Vn,useDeferredValue:Vn,useTransition:Vn,useMutableSource:Vn,useSyncExternalStore:Vn,useId:Vn,unstable_isNewReconciler:!1},Hf={readContext:Je,useCallback:function(o,c){return ia().memoizedState=[o,c===void 0?null:c],o},useContext:Je,useEffect:io,useImperativeHandle:function(o,c,_){return _=_!=null?_.concat([o]):null,Ra(4194308,4,Gf.bind(null,c,o),_)},useLayoutEffect:function(o,c){return Ra(4194308,4,o,c)},useInsertionEffect:function(o,c){return Ra(4,2,o,c)},useMemo:function(o,c){var _=ia();return c=c===void 0?null:c,o=o(),_.memoizedState=[o,c],o},useReducer:function(o,c,_){var k=ia();return c=_!==void 0?_(c):c,k.memoizedState=k.baseState=c,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:c},k.queue=o,o=o.dispatch=ig.bind(null,gn,o),[k.memoizedState,o]},useRef:function(o){var c=ia();return o={current:o},c.memoizedState=o},useState:$f,useDebugValue:bp,useDeferredValue:function(o){return ia().memoizedState=o},useTransition:function(){var o=$f(!1),c=o[0];return o=Po.bind(null,o[1]),ia().memoizedState=o,[c,o]},useMutableSource:function(){},useSyncExternalStore:function(o,c,_){var k=gn,D=ia();if(f){if(_===void 0)throw Error(g(407));_=_()}else{if(_=c(),ci===null)throw Error(g(349));(Un&30)!==0||gh(k,c,_)}D.memoizedState=_;var B={value:_,getSnapshot:c};return D.queue=B,io(vp.bind(null,k,B,o),[o]),k.flags|=2048,bc(9,xp.bind(null,k,B,_,c),void 0,null),_},useId:function(){var o=ia(),c=ci.identifierPrefix;if(f){var _=Bs,k=Ao;_=(k&~(1<<32-Xn(k)-1)).toString(32)+_,c=":"+c+"R"+_,_=Fs++,0<_&&(c+="H"+_.toString(32)),c+=":"}else _=hu++,c=":"+c+"r"+_.toString(32)+":";return o.memoizedState=c},unstable_isNewReconciler:!1},Xf={readContext:Je,useCallback:qf,useContext:Je,useEffect:oa,useImperativeHandle:Wf,useInsertionEffect:za,useLayoutEffect:Al,useMemo:wp,useReducer:md,useRef:du,useState:function(){return md(Cl)},useDebugValue:bp,useDeferredValue:function(o){var c=Es();return Tp(c,xn.memoizedState,o)},useTransition:function(){var o=md(Cl)[0],c=Es().memoizedState;return[o,c]},useMutableSource:mh,useSyncExternalStore:sa,useId:Zf,unstable_isNewReconciler:!1},Io={readContext:Je,useCallback:qf,useContext:Je,useEffect:oa,useImperativeHandle:Wf,useInsertionEffect:za,useLayoutEffect:Al,useMemo:wp,useReducer:fh,useRef:du,useState:function(){return fh(Cl)},useDebugValue:bp,useDeferredValue:function(o){var c=Es();return xn===null?c.memoizedState=o:Tp(c,xn.memoizedState,o)},useTransition:function(){var o=fh(Cl)[0],c=Es().memoizedState;return[o,c]},useMutableSource:mh,useSyncExternalStore:sa,useId:Zf,unstable_isNewReconciler:!1};function Os(o,c){if(o&&o.defaultProps){c=_t({},c),o=o.defaultProps;for(var _ in o)c[_]===void 0&&(c[_]=o[_]);return c}return c}function Ba(o,c,_,k){c=o.memoizedState,_=_(k,c),_=_==null?c:_t({},c,_),o.memoizedState=_,o.lanes===0&&(o.updateQueue.baseState=_)}var Ml={isMounted:function(o){return(o=o._reactInternals)?fn(o)===o:!1},enqueueSetState:function(o,c,_){o=o._reactInternals;var k=os(),D=da(o),B=Ut(k,D);B.payload=c,_!=null&&(B.callback=_),c=er(o,B,D),c!==null&&(Ro(c,o,D,k),Nt(c,o,D))},enqueueReplaceState:function(o,c,_){o=o._reactInternals;var k=os(),D=da(o),B=Ut(k,D);B.tag=1,B.payload=c,_!=null&&(B.callback=_),c=er(o,B,D),c!==null&&(Ro(c,o,D,k),Nt(c,o,D))},enqueueForceUpdate:function(o,c){o=o._reactInternals;var _=os(),k=da(o),D=Ut(_,k);D.tag=2,c!=null&&(D.callback=c),c=er(o,D,k),c!==null&&(Ro(c,o,k,_),Nt(c,o,k))}};function Pl(o,c,_,k,D,B,X){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(k,B,X):c.prototype&&c.prototype.isPureReactComponent?!Xo(_,k)||!Xo(D,B):!0}function gd(o,c,_){var k=!1,D=ta,B=c.contextType;return typeof B=="object"&&B!==null?B=Je(B):(D=Pi(c)?Ia:pi.current,k=c.contextTypes,B=(k=k!=null)?fi(o,D):ta),c=new c(_,B),o.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=Ml,o.stateNode=c,c._reactInternals=o,k&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=D,o.__reactInternalMemoizedMaskedChildContext=B),c}function _h(o,c,_,k){o=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(_,k),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(_,k),c.state!==o&&Ml.enqueueReplaceState(c,c.state,null)}function yd(o,c,_,k){var D=o.stateNode;D.props=_,D.state=o.memoizedState,D.refs={},ct(o);var B=c.contextType;typeof B=="object"&&B!==null?D.context=Je(B):(B=Pi(c)?Ia:pi.current,D.context=fi(o,B)),D.state=o.memoizedState,B=c.getDerivedStateFromProps,typeof B=="function"&&(Ba(o,c,B,_),D.state=o.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof D.getSnapshotBeforeUpdate=="function"||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(c=D.state,typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount(),c!==D.state&&Ml.enqueueReplaceState(D,D.state,null),br(o,_,D,k),D.state=o.memoizedState),typeof D.componentDidMount=="function"&&(o.flags|=4194308)}function wc(o,c){try{var _="",k=c;do _+=xr(k),k=k.return;while(k);var D=_}catch(B){D=`
Error generating stack: `+B.message+`
`+B.stack}return{value:o,source:c,stack:D,digest:null}}function Sp(o,c,_){return{value:o,source:null,stack:_??null,digest:c??null}}function xh(o,c){try{console.error(c.value)}catch(_){setTimeout(function(){throw _})}}var Kf=typeof WeakMap=="function"?WeakMap:Map;function pu(o,c,_){_=Ut(-1,_),_.tag=3,_.payload={element:null};var k=c.value;return _.callback=function(){Mh||(Mh=!0,jp=k),xh(o,c)},_}function Tc(o,c,_){_=Ut(-1,_),_.tag=3;var k=o.type.getDerivedStateFromError;if(typeof k=="function"){var D=c.value;_.payload=function(){return k(D)},_.callback=function(){xh(o,c)}}var B=o.stateNode;return B!==null&&typeof B.componentDidCatch=="function"&&(_.callback=function(){xh(o,c),typeof k!="function"&&(qi===null?qi=new Set([this]):qi.add(this));var X=c.stack;this.componentDidCatch(c.value,{componentStack:X!==null?X:""})}),_}function aa(o,c,_){var k=o.pingCache;if(k===null){k=o.pingCache=new Kf;var D=new Set;k.set(c,D)}else D=k.get(c),D===void 0&&(D=new Set,k.set(c,D));D.has(_)||(D.add(_),o=Up.bind(null,o,c,_),c.then(o,o))}function _d(o){do{var c;if((c=o.tag===13)&&(c=o.memoizedState,c=c!==null?c.dehydrated!==null:!0),c)return o;o=o.return}while(o!==null);return null}function Ep(o,c,_,k,D){return(o.mode&1)===0?(o===c?o.flags|=65536:(o.flags|=128,_.flags|=131072,_.flags&=-52805,_.tag===1&&(_.alternate===null?_.tag=17:(c=Ut(-1,1),c.tag=2,er(_,c,1))),_.lanes|=1),o):(o.flags|=65536,o.lanes=D,o)}var vh=lt.ReactCurrentOwner,vi=!1;function vn(o,c,_,k){c.child=o===null?ce(c,null,_,k):le(c,o.child,_,k)}function fu(o,c,_,k,D){_=_.render;var B=c.ref;return je(c,D),k=pd(o,c,_,k,B,D),_=fd(),o!==null&&!vi?(c.updateQueue=o.updateQueue,c.flags&=-2053,o.lanes&=~D,la(o,c,D)):(f&&_&&na(c),c.flags|=1,vn(o,c,k,D),c.child)}function Di(o,c,_,k,D){if(o===null){var B=_.type;return typeof B=="function"&&!Ic(B)&&B.defaultProps===void 0&&_.compare===null&&_.defaultProps===void 0?(c.tag=15,c.type=B,Us(o,c,B,k,D)):(o=jd(_.type,null,k,c,c.mode,D),o.ref=c.ref,o.return=c,c.child=o)}if(B=o.child,(o.lanes&D)===0){var X=B.memoizedProps;if(_=_.compare,_=_!==null?_:Xo,_(X,k)&&o.ref===c.ref)return la(o,c,D)}return c.flags|=1,o=Nl(B,k),o.ref=c.ref,o.return=c,c.child=o}function Us(o,c,_,k,D){if(o!==null){var B=o.memoizedProps;if(Xo(B,k)&&o.ref===c.ref)if(vi=!1,c.pendingProps=k=B,(o.lanes&D)!==0)(o.flags&131072)!==0&&(vi=!0);else return c.lanes=o.lanes,la(o,c,D)}return vd(o,c,_,k,D)}function xd(o,c,_){var k=c.pendingProps,D=k.children,B=o!==null?o.memoizedState:null;if(k.mode==="hidden")if((c.mode&1)===0)c.memoizedState={baseLanes:0,cachePool:null,transitions:null},Lr(bi,Nn),Nn|=_;else{if((_&1073741824)===0)return o=B!==null?B.baseLanes|_:_,c.lanes=c.childLanes=1073741824,c.memoizedState={baseLanes:o,cachePool:null,transitions:null},c.updateQueue=null,Lr(bi,Nn),Nn|=o,null;c.memoizedState={baseLanes:0,cachePool:null,transitions:null},k=B!==null?B.baseLanes:_,Lr(bi,Nn),Nn|=k}else B!==null?(k=B.baseLanes|_,c.memoizedState=null):k=_,Lr(bi,Nn),Nn|=k;return vn(o,c,D,_),c.child}function kn(o,c){var _=c.ref;(o===null&&_!==null||o!==null&&o.ref!==_)&&(c.flags|=512,c.flags|=2097152)}function vd(o,c,_,k,D){var B=Pi(_)?Ia:pi.current;return B=fi(c,B),je(c,D),_=pd(o,c,_,k,B,D),k=fd(),o!==null&&!vi?(c.updateQueue=o.updateQueue,c.flags&=-2053,o.lanes&=~D,la(o,c,D)):(f&&k&&na(c),c.flags|=1,vn(o,c,_,D),c.child)}function mu(o,c,_,k,D){if(Pi(_)){var B=!0;ro(c)}else B=!1;if(je(c,D),c.stateNode===null)wh(o,c),gd(c,_,k),yd(c,_,k,D),k=!0;else if(o===null){var X=c.stateNode,fe=c.memoizedProps;X.props=fe;var ke=X.context,Ke=_.contextType;typeof Ke=="object"&&Ke!==null?Ke=Je(Ke):(Ke=Pi(_)?Ia:pi.current,Ke=fi(c,Ke));var Et=_.getDerivedStateFromProps,At=typeof Et=="function"||typeof X.getSnapshotBeforeUpdate=="function";At||typeof X.UNSAFE_componentWillReceiveProps!="function"&&typeof X.componentWillReceiveProps!="function"||(fe!==k||ke!==Ke)&&_h(c,X,k,Ke),ht=!1;var bt=c.memoizedState;X.state=bt,br(c,k,X,D),ke=c.memoizedState,fe!==k||bt!==ke||Gi.current||ht?(typeof Et=="function"&&(Ba(c,_,Et,k),ke=c.memoizedState),(fe=ht||Pl(c,_,fe,k,bt,ke,Ke))?(At||typeof X.UNSAFE_componentWillMount!="function"&&typeof X.componentWillMount!="function"||(typeof X.componentWillMount=="function"&&X.componentWillMount(),typeof X.UNSAFE_componentWillMount=="function"&&X.UNSAFE_componentWillMount()),typeof X.componentDidMount=="function"&&(c.flags|=4194308)):(typeof X.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=k,c.memoizedState=ke),X.props=k,X.state=ke,X.context=Ke,k=fe):(typeof X.componentDidMount=="function"&&(c.flags|=4194308),k=!1)}else{X=c.stateNode,gt(o,c),fe=c.memoizedProps,Ke=c.type===c.elementType?fe:Os(c.type,fe),X.props=Ke,At=c.pendingProps,bt=X.context,ke=_.contextType,typeof ke=="object"&&ke!==null?ke=Je(ke):(ke=Pi(_)?Ia:pi.current,ke=fi(c,ke));var qt=_.getDerivedStateFromProps;(Et=typeof qt=="function"||typeof X.getSnapshotBeforeUpdate=="function")||typeof X.UNSAFE_componentWillReceiveProps!="function"&&typeof X.componentWillReceiveProps!="function"||(fe!==At||bt!==ke)&&_h(c,X,k,ke),ht=!1,bt=c.memoizedState,X.state=bt,br(c,k,X,D);var Yt=c.memoizedState;fe!==At||bt!==Yt||Gi.current||ht?(typeof qt=="function"&&(Ba(c,_,qt,k),Yt=c.memoizedState),(Ke=ht||Pl(c,_,Ke,k,bt,Yt,ke)||!1)?(Et||typeof X.UNSAFE_componentWillUpdate!="function"&&typeof X.componentWillUpdate!="function"||(typeof X.componentWillUpdate=="function"&&X.componentWillUpdate(k,Yt,ke),typeof X.UNSAFE_componentWillUpdate=="function"&&X.UNSAFE_componentWillUpdate(k,Yt,ke)),typeof X.componentDidUpdate=="function"&&(c.flags|=4),typeof X.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof X.componentDidUpdate!="function"||fe===o.memoizedProps&&bt===o.memoizedState||(c.flags|=4),typeof X.getSnapshotBeforeUpdate!="function"||fe===o.memoizedProps&&bt===o.memoizedState||(c.flags|=1024),c.memoizedProps=k,c.memoizedState=Yt),X.props=k,X.state=Yt,X.context=ke,k=Ke):(typeof X.componentDidUpdate!="function"||fe===o.memoizedProps&&bt===o.memoizedState||(c.flags|=4),typeof X.getSnapshotBeforeUpdate!="function"||fe===o.memoizedProps&&bt===o.memoizedState||(c.flags|=1024),k=!1)}return Vs(o,c,_,k,B,D)}function Vs(o,c,_,k,D,B){kn(o,c);var X=(c.flags&128)!==0;if(!k&&!X)return D&&yc(c,_,!1),la(o,c,B);k=c.stateNode,vh.current=c;var fe=X&&typeof _.getDerivedStateFromError!="function"?null:k.render();return c.flags|=1,o!==null&&X?(c.child=le(c,o.child,null,B),c.child=le(c,null,fe,B)):vn(o,c,fe,B),c.memoizedState=k.state,D&&yc(c,_,!0),c.child}function Yf(o){var c=o.stateNode;c.pendingContext?bs(o,c.pendingContext,c.pendingContext!==c.context):c.context&&bs(o,c.context,!1),oi(o,c.containerInfo)}function Jf(o,c,_,k,D){return K(),re(D),c.flags|=256,vn(o,c,_,k),c.child}var bd={dehydrated:null,treeContext:null,retryLane:0};function wd(o){return{baseLanes:o,cachePool:null,transitions:null}}function Il(o,c,_){var k=c.pendingProps,D=pr.current,B=!1,X=(c.flags&128)!==0,fe;if((fe=X)||(fe=o!==null&&o.memoizedState===null?!1:(D&2)!==0),fe?(B=!0,c.flags&=-129):(o===null||o.memoizedState!==null)&&(D|=1),Lr(pr,D&1),o===null)return I(c),o=c.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?((c.mode&1)===0?c.lanes=1:o.data==="$!"?c.lanes=8:c.lanes=1073741824,null):(X=k.children,o=k.fallback,B?(k=c.mode,B=c.child,X={mode:"hidden",children:X},(k&1)===0&&B!==null?(B.childLanes=0,B.pendingProps=X):B=Rd(X,k,0,null),o=Dc(o,k,_,null),B.return=c,o.return=c,B.sibling=o,c.child=B,c.child.memoizedState=wd(_),c.memoizedState=bd,o):Td(c,X));if(D=o.memoizedState,D!==null&&(fe=D.dehydrated,fe!==null))return Qf(o,c,X,k,fe,D,_);if(B){B=k.fallback,X=c.mode,D=o.child,fe=D.sibling;var ke={mode:"hidden",children:k.children};return(X&1)===0&&c.child!==D?(k=c.child,k.childLanes=0,k.pendingProps=ke,c.deletions=null):(k=Nl(D,ke),k.subtreeFlags=D.subtreeFlags&14680064),fe!==null?B=Nl(fe,B):(B=Dc(B,X,_,null),B.flags|=2),B.return=c,k.return=c,k.sibling=B,c.child=k,k=B,B=c.child,X=o.child.memoizedState,X=X===null?wd(_):{baseLanes:X.baseLanes|_,cachePool:null,transitions:X.transitions},B.memoizedState=X,B.childLanes=o.childLanes&~_,c.memoizedState=bd,k}return B=o.child,o=B.sibling,k=Nl(B,{mode:"visible",children:k.children}),(c.mode&1)===0&&(k.lanes=_),k.return=c,k.sibling=null,o!==null&&(_=c.deletions,_===null?(c.deletions=[o],c.flags|=16):_.push(o)),c.child=k,c.memoizedState=null,k}function Td(o,c){return c=Rd({mode:"visible",children:c},o.mode,0,null),c.return=o,o.child=c}function bh(o,c,_,k){return k!==null&&re(k),le(c,o.child,null,_),o=Td(c,c.pendingProps.children),o.flags|=2,c.memoizedState=null,o}function Qf(o,c,_,k,D,B,X){if(_)return c.flags&256?(c.flags&=-257,k=Sp(Error(g(422))),bh(o,c,X,k)):c.memoizedState!==null?(c.child=o.child,c.flags|=128,null):(B=k.fallback,D=c.mode,k=Rd({mode:"visible",children:k.children},D,0,null),B=Dc(B,D,X,null),B.flags|=2,k.return=c,B.return=c,k.sibling=B,c.child=k,(c.mode&1)!==0&&le(c,o.child,null,X),c.child.memoizedState=wd(X),c.memoizedState=bd,B);if((c.mode&1)===0)return bh(o,c,X,null);if(D.data==="$!"){if(k=D.nextSibling&&D.nextSibling.dataset,k)var fe=k.dgst;return k=fe,B=Error(g(419)),k=Sp(B,k,void 0),bh(o,c,X,k)}if(fe=(X&o.childLanes)!==0,vi||fe){if(k=ci,k!==null){switch(X&-X){case 4:D=2;break;case 16:D=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:D=32;break;case 536870912:D=268435456;break;default:D=0}D=(D&(k.suspendedLanes|X))!==0?0:D,D!==0&&D!==B.retryLane&&(B.retryLane=D,Qe(o,D),Ro(k,o,D,-1))}return Np(),k=Sp(Error(g(421))),bh(o,c,X,k)}return D.data==="$?"?(c.flags|=128,c.child=o.child,c=ug.bind(null,o),D._reactRetry=c,null):(o=B.treeContext,a=to(D.nextSibling),n=c,f=!0,y=null,o!==null&&(ts[rs++]=Ao,ts[rs++]=Bs,ts[rs++]=ja,Ao=o.id,Bs=o.overflow,ja=c),c=Td(c,k.children),c.flags|=4096,c)}function kp(o,c,_){o.lanes|=c;var k=o.alternate;k!==null&&(k.lanes|=c),ft(o.return,c,_)}function Cp(o,c,_,k,D){var B=o.memoizedState;B===null?o.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:k,tail:_,tailMode:D}:(B.isBackwards=c,B.rendering=null,B.renderingStartTime=0,B.last=k,B.tail=_,B.tailMode=D)}function em(o,c,_){var k=c.pendingProps,D=k.revealOrder,B=k.tail;if(vn(o,c,k.children,_),k=pr.current,(k&2)!==0)k=k&1|2,c.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=c.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&kp(o,_,c);else if(o.tag===19)kp(o,_,c);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===c)break e;for(;o.sibling===null;){if(o.return===null||o.return===c)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}k&=1}if(Lr(pr,k),(c.mode&1)===0)c.memoizedState=null;else switch(D){case"forwards":for(_=c.child,D=null;_!==null;)o=_.alternate,o!==null&&Kr(o)===null&&(D=_),_=_.sibling;_=D,_===null?(D=c.child,c.child=null):(D=_.sibling,_.sibling=null),Cp(c,!1,D,_,B);break;case"backwards":for(_=null,D=c.child,c.child=null;D!==null;){if(o=D.alternate,o!==null&&Kr(o)===null){c.child=D;break}o=D.sibling,D.sibling=_,_=D,D=o}Cp(c,!0,_,null,B);break;case"together":Cp(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function wh(o,c){(c.mode&1)===0&&o!==null&&(o.alternate=null,c.alternate=null,c.flags|=2)}function la(o,c,_){if(o!==null&&(c.dependencies=o.dependencies),Pn|=c.lanes,(_&c.childLanes)===0)return null;if(o!==null&&c.child!==o.child)throw Error(g(153));if(c.child!==null){for(o=c.child,_=Nl(o,o.pendingProps),c.child=_,_.return=c;o.sibling!==null;)o=o.sibling,_=_.sibling=Nl(o,o.pendingProps),_.return=c;_.sibling=null}return c.child}function Th(o,c,_){switch(c.tag){case 3:Yf(c),K();break;case 5:ns(c);break;case 1:Pi(c.type)&&ro(c);break;case 4:oi(c,c.stateNode.containerInfo);break;case 10:var k=c.type._context,D=c.memoizedProps.value;Lr(xe,k._currentValue),k._currentValue=D;break;case 13:if(k=c.memoizedState,k!==null)return k.dehydrated!==null?(Lr(pr,pr.current&1),c.flags|=128,null):(_&c.child.childLanes)!==0?Il(o,c,_):(Lr(pr,pr.current&1),o=la(o,c,_),o!==null?o.sibling:null);Lr(pr,pr.current&1);break;case 19:if(k=(_&c.childLanes)!==0,(o.flags&128)!==0){if(k)return em(o,c,_);c.flags|=128}if(D=c.memoizedState,D!==null&&(D.rendering=null,D.tail=null,D.lastEffect=null),Lr(pr,pr.current),k)break;return null;case 22:case 23:return c.lanes=0,xd(o,c,_)}return la(o,c,_)}var Sd,Sh,Ed,Li;Sd=function(o,c){for(var _=c.child;_!==null;){if(_.tag===5||_.tag===6)o.appendChild(_.stateNode);else if(_.tag!==4&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===c)break;for(;_.sibling===null;){if(_.return===null||_.return===c)return;_=_.return}_.sibling.return=_.return,_=_.sibling}},Sh=function(){},Ed=function(o,c,_,k){var D=o.memoizedProps;if(D!==k){o=c.stateNode,Or(Ir.current);var B=null;switch(_){case"input":D=di(o,D),k=di(o,k),B=[];break;case"select":D=_t({},D,{value:void 0}),k=_t({},k,{value:void 0}),B=[];break;case"textarea":D=Fn(o,D),k=Fn(o,k),B=[];break;default:typeof D.onClick!="function"&&typeof k.onClick=="function"&&(o.onclick=xl)}yo(_,k);var X;_=null;for(Ke in D)if(!k.hasOwnProperty(Ke)&&D.hasOwnProperty(Ke)&&D[Ke]!=null)if(Ke==="style"){var fe=D[Ke];for(X in fe)fe.hasOwnProperty(X)&&(_||(_={}),_[X]="")}else Ke!=="dangerouslySetInnerHTML"&&Ke!=="children"&&Ke!=="suppressContentEditableWarning"&&Ke!=="suppressHydrationWarning"&&Ke!=="autoFocus"&&(E.hasOwnProperty(Ke)?B||(B=[]):(B=B||[]).push(Ke,null));for(Ke in k){var ke=k[Ke];if(fe=D?.[Ke],k.hasOwnProperty(Ke)&&ke!==fe&&(ke!=null||fe!=null))if(Ke==="style")if(fe){for(X in fe)!fe.hasOwnProperty(X)||ke&&ke.hasOwnProperty(X)||(_||(_={}),_[X]="");for(X in ke)ke.hasOwnProperty(X)&&fe[X]!==ke[X]&&(_||(_={}),_[X]=ke[X])}else _||(B||(B=[]),B.push(Ke,_)),_=ke;else Ke==="dangerouslySetInnerHTML"?(ke=ke?ke.__html:void 0,fe=fe?fe.__html:void 0,ke!=null&&fe!==ke&&(B=B||[]).push(Ke,ke)):Ke==="children"?typeof ke!="string"&&typeof ke!="number"||(B=B||[]).push(Ke,""+ke):Ke!=="suppressContentEditableWarning"&&Ke!=="suppressHydrationWarning"&&(E.hasOwnProperty(Ke)?(ke!=null&&Ke==="onScroll"&&en("scroll",o),B||fe===ke||(B=[])):(B=B||[]).push(Ke,ke))}_&&(B=B||[]).push("style",_);var Ke=B;(c.updateQueue=Ke)&&(c.flags|=4)}},Li=function(o,c,_,k){_!==k&&(c.flags|=4)};function Sc(o,c){if(!f)switch(o.tailMode){case"hidden":c=o.tail;for(var _=null;c!==null;)c.alternate!==null&&(_=c),c=c.sibling;_===null?o.tail=null:_.sibling=null;break;case"collapsed":_=o.tail;for(var k=null;_!==null;)_.alternate!==null&&(k=_),_=_.sibling;k===null?c||o.tail===null?o.tail=null:o.tail.sibling=null:k.sibling=null}}function ji(o){var c=o.alternate!==null&&o.alternate.child===o.child,_=0,k=0;if(c)for(var D=o.child;D!==null;)_|=D.lanes|D.childLanes,k|=D.subtreeFlags&14680064,k|=D.flags&14680064,D.return=o,D=D.sibling;else for(D=o.child;D!==null;)_|=D.lanes|D.childLanes,k|=D.subtreeFlags,k|=D.flags,D.return=o,D=D.sibling;return o.subtreeFlags|=k,o.childLanes=_,c}function ca(o,c,_){var k=c.pendingProps;switch(h(c),c.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ji(c),null;case 1:return Pi(c.type)&&cu(),ji(c),null;case 3:return k=c.stateNode,Sn(),mn(Gi),mn(pi),En(),k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(o===null||o.child===null)&&(z(c)?c.flags|=4:o===null||o.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,y!==null&&(Oa(y),y=null))),Sh(o,c),ji(c),null;case 5:ws(c);var D=Or(Wr.current);if(_=c.type,o!==null&&c.stateNode!=null)Ed(o,c,_,k,D),o.ref!==c.ref&&(c.flags|=512,c.flags|=2097152);else{if(!k){if(c.stateNode===null)throw Error(g(166));return ji(c),null}if(o=Or(Ir.current),z(c)){k=c.stateNode,_=c.type;var B=c.memoizedProps;switch(k[Vi]=c,k[ko]=B,o=(c.mode&1)!==0,_){case"dialog":en("cancel",k),en("close",k);break;case"iframe":case"object":case"embed":en("load",k);break;case"video":case"audio":for(D=0;D<es.length;D++)en(es[D],k);break;case"source":en("error",k);break;case"img":case"image":case"link":en("error",k),en("load",k);break;case"details":en("toggle",k);break;case"input":Fo(k,B),en("invalid",k);break;case"select":k._wrapperState={wasMultiple:!!B.multiple},en("invalid",k);break;case"textarea":hs(k,B),en("invalid",k)}yo(_,B),D=null;for(var X in B)if(B.hasOwnProperty(X)){var fe=B[X];X==="children"?typeof fe=="string"?k.textContent!==fe&&(B.suppressHydrationWarning!==!0&&Ma(k.textContent,fe,o),D=["children",fe]):typeof fe=="number"&&k.textContent!==""+fe&&(B.suppressHydrationWarning!==!0&&Ma(k.textContent,fe,o),D=["children",""+fe]):E.hasOwnProperty(X)&&fe!=null&&X==="onScroll"&&en("scroll",k)}switch(_){case"input":Hi(k),Mt(k,B,!0);break;case"textarea":Hi(k),Zn(k);break;case"select":case"option":break;default:typeof B.onClick=="function"&&(k.onclick=xl)}k=D,c.updateQueue=k,k!==null&&(c.flags|=4)}else{X=D.nodeType===9?D:D.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=On(_)),o==="http://www.w3.org/1999/xhtml"?_==="script"?(o=X.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof k.is=="string"?o=X.createElement(_,{is:k.is}):(o=X.createElement(_),_==="select"&&(X=o,k.multiple?X.multiple=!0:k.size&&(X.size=k.size))):o=X.createElementNS(o,_),o[Vi]=c,o[ko]=k,Sd(o,c,!1,!1),c.stateNode=o;e:{switch(X=_o(_,k),_){case"dialog":en("cancel",o),en("close",o),D=k;break;case"iframe":case"object":case"embed":en("load",o),D=k;break;case"video":case"audio":for(D=0;D<es.length;D++)en(es[D],o);D=k;break;case"source":en("error",o),D=k;break;case"img":case"image":case"link":en("error",o),en("load",o),D=k;break;case"details":en("toggle",o),D=k;break;case"input":Fo(o,k),D=di(o,k),en("invalid",o);break;case"option":D=k;break;case"select":o._wrapperState={wasMultiple:!!k.multiple},D=_t({},k,{value:void 0}),en("invalid",o);break;case"textarea":hs(o,k),D=Fn(o,k),en("invalid",o);break;default:D=k}yo(_,D),fe=D;for(B in fe)if(fe.hasOwnProperty(B)){var ke=fe[B];B==="style"?Oo(o,ke):B==="dangerouslySetInnerHTML"?(ke=ke?ke.__html:void 0,ke!=null&&mo(o,ke)):B==="children"?typeof ke=="string"?(_!=="textarea"||ke!=="")&&go(o,ke):typeof ke=="number"&&go(o,""+ke):B!=="suppressContentEditableWarning"&&B!=="suppressHydrationWarning"&&B!=="autoFocus"&&(E.hasOwnProperty(B)?ke!=null&&B==="onScroll"&&en("scroll",o):ke!=null&&Me(o,B,ke,X))}switch(_){case"input":Hi(o),Mt(o,k,!1);break;case"textarea":Hi(o),Zn(o);break;case"option":k.value!=null&&o.setAttribute("value",""+jr(k.value));break;case"select":o.multiple=!!k.multiple,B=k.value,B!=null?Wt(o,!!k.multiple,B,!1):k.defaultValue!=null&&Wt(o,!!k.multiple,k.defaultValue,!0);break;default:typeof D.onClick=="function"&&(o.onclick=xl)}switch(_){case"button":case"input":case"select":case"textarea":k=!!k.autoFocus;break e;case"img":k=!0;break e;default:k=!1}}k&&(c.flags|=4)}c.ref!==null&&(c.flags|=512,c.flags|=2097152)}return ji(c),null;case 6:if(o&&c.stateNode!=null)Li(o,c,o.memoizedProps,k);else{if(typeof k!="string"&&c.stateNode===null)throw Error(g(166));if(_=Or(Wr.current),Or(Ir.current),z(c)){if(k=c.stateNode,_=c.memoizedProps,k[Vi]=c,(B=k.nodeValue!==_)&&(o=n,o!==null))switch(o.tag){case 3:Ma(k.nodeValue,_,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&Ma(k.nodeValue,_,(o.mode&1)!==0)}B&&(c.flags|=4)}else k=(_.nodeType===9?_:_.ownerDocument).createTextNode(k),k[Vi]=c,c.stateNode=k}return ji(c),null;case 13:if(mn(pr),k=c.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(f&&a!==null&&(c.mode&1)!==0&&(c.flags&128)===0)$(),K(),c.flags|=98560,B=!1;else if(B=z(c),k!==null&&k.dehydrated!==null){if(o===null){if(!B)throw Error(g(318));if(B=c.memoizedState,B=B!==null?B.dehydrated:null,!B)throw Error(g(317));B[Vi]=c}else K(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;ji(c),B=!1}else y!==null&&(Oa(y),y=null),B=!0;if(!B)return c.flags&65536?c:null}return(c.flags&128)!==0?(c.lanes=_,c):(k=k!==null,k!==(o!==null&&o.memoizedState!==null)&&k&&(c.child.flags|=8192,(c.mode&1)!==0&&(o===null||(pr.current&1)!==0?qr===0&&(qr=3):Np())),c.updateQueue!==null&&(c.flags|=4),ji(c),null);case 4:return Sn(),Sh(o,c),o===null&&So(c.stateNode.containerInfo),ji(c),null;case 10:return Oe(c.type._context),ji(c),null;case 17:return Pi(c.type)&&cu(),ji(c),null;case 19:if(mn(pr),B=c.memoizedState,B===null)return ji(c),null;if(k=(c.flags&128)!==0,X=B.rendering,X===null)if(k)Sc(B,!1);else{if(qr!==0||o!==null&&(o.flags&128)!==0)for(o=c.child;o!==null;){if(X=Kr(o),X!==null){for(c.flags|=128,Sc(B,!1),k=X.updateQueue,k!==null&&(c.updateQueue=k,c.flags|=4),c.subtreeFlags=0,k=_,_=c.child;_!==null;)B=_,o=k,B.flags&=14680066,X=B.alternate,X===null?(B.childLanes=0,B.lanes=o,B.child=null,B.subtreeFlags=0,B.memoizedProps=null,B.memoizedState=null,B.updateQueue=null,B.dependencies=null,B.stateNode=null):(B.childLanes=X.childLanes,B.lanes=X.lanes,B.child=X.child,B.subtreeFlags=0,B.deletions=null,B.memoizedProps=X.memoizedProps,B.memoizedState=X.memoizedState,B.updateQueue=X.updateQueue,B.type=X.type,o=X.dependencies,B.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),_=_.sibling;return Lr(pr,pr.current&1|2),c.child}o=o.sibling}B.tail!==null&&Tn()>bu&&(c.flags|=128,k=!0,Sc(B,!1),c.lanes=4194304)}else{if(!k)if(o=Kr(X),o!==null){if(c.flags|=128,k=!0,_=o.updateQueue,_!==null&&(c.updateQueue=_,c.flags|=4),Sc(B,!0),B.tail===null&&B.tailMode==="hidden"&&!X.alternate&&!f)return ji(c),null}else 2*Tn()-B.renderingStartTime>bu&&_!==1073741824&&(c.flags|=128,k=!0,Sc(B,!1),c.lanes=4194304);B.isBackwards?(X.sibling=c.child,c.child=X):(_=B.last,_!==null?_.sibling=X:c.child=X,B.last=X)}return B.tail!==null?(c=B.tail,B.rendering=c,B.tail=c.sibling,B.renderingStartTime=Tn(),c.sibling=null,_=pr.current,Lr(pr,k?_&1|2:_&1),c):(ji(c),null);case 22:case 23:return Dd(),k=c.memoizedState!==null,o!==null&&o.memoizedState!==null!==k&&(c.flags|=8192),k&&(c.mode&1)!==0?(Nn&1073741824)!==0&&(ji(c),c.subtreeFlags&6&&(c.flags|=8192)):ji(c),null;case 24:return null;case 25:return null}throw Error(g(156,c.tag))}function sg(o,c){switch(h(c),c.tag){case 1:return Pi(c.type)&&cu(),o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 3:return Sn(),mn(Gi),mn(pi),En(),o=c.flags,(o&65536)!==0&&(o&128)===0?(c.flags=o&-65537|128,c):null;case 5:return ws(c),null;case 13:if(mn(pr),o=c.memoizedState,o!==null&&o.dehydrated!==null){if(c.alternate===null)throw Error(g(340));K()}return o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 19:return mn(pr),null;case 4:return Sn(),null;case 10:return Oe(c.type._context),null;case 22:case 23:return Dd(),null;case 24:return null;default:return null}}var ua=!1,li=!1,so=typeof WeakSet=="function"?WeakSet:Set,Bt=null;function gu(o,c){var _=o.ref;if(_!==null)if(typeof _=="function")try{_(null)}catch(k){Gn(o,c,k)}else _.current=null}function yu(o,c,_){try{_()}catch(k){Gn(o,c,k)}}var Ap=!1;function og(o,c){if(vl=nl,o=ad(),uh(o)){if("selectionStart"in o)var _={start:o.selectionStart,end:o.selectionEnd};else e:{_=(_=o.ownerDocument)&&_.defaultView||window;var k=_.getSelection&&_.getSelection();if(k&&k.rangeCount!==0){_=k.anchorNode;var D=k.anchorOffset,B=k.focusNode;k=k.focusOffset;try{_.nodeType,B.nodeType}catch{_=null;break e}var X=0,fe=-1,ke=-1,Ke=0,Et=0,At=o,bt=null;t:for(;;){for(var qt;At!==_||D!==0&&At.nodeType!==3||(fe=X+D),At!==B||k!==0&&At.nodeType!==3||(ke=X+k),At.nodeType===3&&(X+=At.nodeValue.length),(qt=At.firstChild)!==null;)bt=At,At=qt;for(;;){if(At===o)break t;if(bt===_&&++Ke===D&&(fe=X),bt===B&&++Et===k&&(ke=X),(qt=At.nextSibling)!==null)break;At=bt,bt=At.parentNode}At=qt}_=fe===-1||ke===-1?null:{start:fe,end:ke}}else _=null}_=_||{start:0,end:0}}else _=null;for(iu={focusedElem:o,selectionRange:_},nl=!1,Bt=c;Bt!==null;)if(c=Bt,o=c.child,(c.subtreeFlags&1028)!==0&&o!==null)o.return=c,Bt=o;else for(;Bt!==null;){c=Bt;try{var Yt=c.alternate;if((c.flags&1024)!==0)switch(c.tag){case 0:case 11:case 15:break;case 1:if(Yt!==null){var Jt=Yt.memoizedProps,Wn=Yt.memoizedState,We=c.stateNode,Ie=We.getSnapshotBeforeUpdate(c.elementType===c.type?Jt:Os(c.type,Jt),Wn);We.__reactInternalSnapshotBeforeUpdate=Ie}break;case 3:var Xe=c.stateNode.containerInfo;Xe.nodeType===1?Xe.textContent="":Xe.nodeType===9&&Xe.documentElement&&Xe.removeChild(Xe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(g(163))}}catch(jt){Gn(c,c.return,jt)}if(o=c.sibling,o!==null){o.return=c.return,Bt=o;break}Bt=c.return}return Yt=Ap,Ap=!1,Yt}function Ec(o,c,_){var k=c.updateQueue;if(k=k!==null?k.lastEffect:null,k!==null){var D=k=k.next;do{if((D.tag&o)===o){var B=D.destroy;D.destroy=void 0,B!==void 0&&yu(c,_,B)}D=D.next}while(D!==k)}}function $s(o,c){if(c=c.updateQueue,c=c!==null?c.lastEffect:null,c!==null){var _=c=c.next;do{if((_.tag&o)===o){var k=_.create;_.destroy=k()}_=_.next}while(_!==c)}}function Fa(o){var c=o.ref;if(c!==null){var _=o.stateNode;switch(o.tag){case 5:o=_;break;default:o=_}typeof c=="function"?c(o):c.current=o}}function Mp(o){var c=o.alternate;c!==null&&(o.alternate=null,Mp(c)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(c=o.stateNode,c!==null&&(delete c[Vi],delete c[ko],delete c[ou],delete c[ph],delete c[dd])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function Pp(o){return o.tag===5||o.tag===3||o.tag===4}function tm(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||Pp(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function _u(o,c,_){var k=o.tag;if(k===5||k===6)o=o.stateNode,c?_.nodeType===8?_.parentNode.insertBefore(o,c):_.insertBefore(o,c):(_.nodeType===8?(c=_.parentNode,c.insertBefore(o,_)):(c=_,c.appendChild(o)),_=_._reactRootContainer,_!=null||c.onclick!==null||(c.onclick=xl));else if(k!==4&&(o=o.child,o!==null))for(_u(o,c,_),o=o.sibling;o!==null;)_u(o,c,_),o=o.sibling}function Eh(o,c,_){var k=o.tag;if(k===5||k===6)o=o.stateNode,c?_.insertBefore(o,c):_.appendChild(o);else if(k!==4&&(o=o.child,o!==null))for(Eh(o,c,_),o=o.sibling;o!==null;)Eh(o,c,_),o=o.sibling}var $n=null,Wi=!1;function oo(o,c,_){for(_=_.child;_!==null;)kh(o,c,_),_=_.sibling}function kh(o,c,_){if(Ni&&typeof Ni.onCommitFiberUnmount=="function")try{Ni.onCommitFiberUnmount(ps,_)}catch{}switch(_.tag){case 5:li||gu(_,c);case 6:var k=$n,D=Wi;$n=null,oo(o,c,_),$n=k,Wi=D,$n!==null&&(Wi?(o=$n,_=_.stateNode,o.nodeType===8?o.parentNode.removeChild(_):o.removeChild(_)):$n.removeChild(_.stateNode));break;case 18:$n!==null&&(Wi?(o=$n,_=_.stateNode,o.nodeType===8?gc(o.parentNode,_):o.nodeType===1&&gc(o,_),js(o)):gc($n,_.stateNode));break;case 4:k=$n,D=Wi,$n=_.stateNode.containerInfo,Wi=!0,oo(o,c,_),$n=k,Wi=D;break;case 0:case 11:case 14:case 15:if(!li&&(k=_.updateQueue,k!==null&&(k=k.lastEffect,k!==null))){D=k=k.next;do{var B=D,X=B.destroy;B=B.tag,X!==void 0&&((B&2)!==0||(B&4)!==0)&&yu(_,c,X),D=D.next}while(D!==k)}oo(o,c,_);break;case 1:if(!li&&(gu(_,c),k=_.stateNode,typeof k.componentWillUnmount=="function"))try{k.props=_.memoizedProps,k.state=_.memoizedState,k.componentWillUnmount()}catch(fe){Gn(_,c,fe)}oo(o,c,_);break;case 21:oo(o,c,_);break;case 22:_.mode&1?(li=(k=li)||_.memoizedState!==null,oo(o,c,_),li=k):oo(o,c,_);break;default:oo(o,c,_)}}function Ip(o){var c=o.updateQueue;if(c!==null){o.updateQueue=null;var _=o.stateNode;_===null&&(_=o.stateNode=new so),c.forEach(function(k){var D=hg.bind(null,o,k);_.has(k)||(_.add(k),k.then(D,D))})}}function is(o,c){var _=c.deletions;if(_!==null)for(var k=0;k<_.length;k++){var D=_[k];try{var B=o,X=c,fe=X;e:for(;fe!==null;){switch(fe.tag){case 5:$n=fe.stateNode,Wi=!1;break e;case 3:$n=fe.stateNode.containerInfo,Wi=!0;break e;case 4:$n=fe.stateNode.containerInfo,Wi=!0;break e}fe=fe.return}if($n===null)throw Error(g(160));kh(B,X,D),$n=null,Wi=!1;var ke=D.alternate;ke!==null&&(ke.return=null),D.return=null}catch(Ke){Gn(D,c,Ke)}}if(c.subtreeFlags&12854)for(c=c.child;c!==null;)kd(c,o),c=c.sibling}function kd(o,c){var _=o.alternate,k=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(is(c,o),Do(o),k&4){try{Ec(3,o,o.return),$s(3,o)}catch(Jt){Gn(o,o.return,Jt)}try{Ec(5,o,o.return)}catch(Jt){Gn(o,o.return,Jt)}}break;case 1:is(c,o),Do(o),k&512&&_!==null&&gu(_,_.return);break;case 5:if(is(c,o),Do(o),k&512&&_!==null&&gu(_,_.return),o.flags&32){var D=o.stateNode;try{go(D,"")}catch(Jt){Gn(o,o.return,Jt)}}if(k&4&&(D=o.stateNode,D!=null)){var B=o.memoizedProps,X=_!==null?_.memoizedProps:B,fe=o.type,ke=o.updateQueue;if(o.updateQueue=null,ke!==null)try{fe==="input"&&B.type==="radio"&&B.name!=null&&nn(D,B),_o(fe,X);var Ke=_o(fe,B);for(X=0;X<ke.length;X+=2){var Et=ke[X],At=ke[X+1];Et==="style"?Oo(D,At):Et==="dangerouslySetInnerHTML"?mo(D,At):Et==="children"?go(D,At):Me(D,Et,At,Ke)}switch(fe){case"input":yi(D,B);break;case"textarea":Ci(D,B);break;case"select":var bt=D._wrapperState.wasMultiple;D._wrapperState.wasMultiple=!!B.multiple;var qt=B.value;qt!=null?Wt(D,!!B.multiple,qt,!1):bt!==!!B.multiple&&(B.defaultValue!=null?Wt(D,!!B.multiple,B.defaultValue,!0):Wt(D,!!B.multiple,B.multiple?[]:"",!1))}D[ko]=B}catch(Jt){Gn(o,o.return,Jt)}}break;case 6:if(is(c,o),Do(o),k&4){if(o.stateNode===null)throw Error(g(162));D=o.stateNode,B=o.memoizedProps;try{D.nodeValue=B}catch(Jt){Gn(o,o.return,Jt)}}break;case 3:if(is(c,o),Do(o),k&4&&_!==null&&_.memoizedState.isDehydrated)try{js(c.containerInfo)}catch(Jt){Gn(o,o.return,Jt)}break;case 4:is(c,o),Do(o);break;case 13:is(c,o),Do(o),D=o.child,D.flags&8192&&(B=D.memoizedState!==null,D.stateNode.isHidden=B,!B||D.alternate!==null&&D.alternate.memoizedState!==null||(Ah=Tn())),k&4&&Ip(o);break;case 22:if(Et=_!==null&&_.memoizedState!==null,o.mode&1?(li=(Ke=li)||Et,is(c,o),li=Ke):is(c,o),Do(o),k&8192){if(Ke=o.memoizedState!==null,(o.stateNode.isHidden=Ke)&&!Et&&(o.mode&1)!==0)for(Bt=o,Et=o.child;Et!==null;){for(At=Bt=Et;Bt!==null;){switch(bt=Bt,qt=bt.child,bt.tag){case 0:case 11:case 14:case 15:Ec(4,bt,bt.return);break;case 1:gu(bt,bt.return);var Yt=bt.stateNode;if(typeof Yt.componentWillUnmount=="function"){k=bt,_=bt.return;try{c=k,Yt.props=c.memoizedProps,Yt.state=c.memoizedState,Yt.componentWillUnmount()}catch(Jt){Gn(k,_,Jt)}}break;case 5:gu(bt,bt.return);break;case 22:if(bt.memoizedState!==null){Lp(At);continue}}qt!==null?(qt.return=bt,Bt=qt):Lp(At)}Et=Et.sibling}e:for(Et=null,At=o;;){if(At.tag===5){if(Et===null){Et=At;try{D=At.stateNode,Ke?(B=D.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none"):(fe=At.stateNode,ke=At.memoizedProps.style,X=ke!=null&&ke.hasOwnProperty("display")?ke.display:null,fe.style.display=Ka("display",X))}catch(Jt){Gn(o,o.return,Jt)}}}else if(At.tag===6){if(Et===null)try{At.stateNode.nodeValue=Ke?"":At.memoizedProps}catch(Jt){Gn(o,o.return,Jt)}}else if((At.tag!==22&&At.tag!==23||At.memoizedState===null||At===o)&&At.child!==null){At.child.return=At,At=At.child;continue}if(At===o)break e;for(;At.sibling===null;){if(At.return===null||At.return===o)break e;Et===At&&(Et=null),At=At.return}Et===At&&(Et=null),At.sibling.return=At.return,At=At.sibling}}break;case 19:is(c,o),Do(o),k&4&&Ip(o);break;case 21:break;default:is(c,o),Do(o)}}function Do(o){var c=o.flags;if(c&2){try{e:{for(var _=o.return;_!==null;){if(Pp(_)){var k=_;break e}_=_.return}throw Error(g(160))}switch(k.tag){case 5:var D=k.stateNode;k.flags&32&&(go(D,""),k.flags&=-33);var B=tm(o);Eh(o,B,D);break;case 3:case 4:var X=k.stateNode.containerInfo,fe=tm(o);_u(o,fe,X);break;default:throw Error(g(161))}}catch(ke){Gn(o,o.return,ke)}o.flags&=-3}c&4096&&(o.flags&=-4097)}function xu(o,c,_){Bt=o,Dp(o)}function Dp(o,c,_){for(var k=(o.mode&1)!==0;Bt!==null;){var D=Bt,B=D.child;if(D.tag===22&&k){var X=D.memoizedState!==null||ua;if(!X){var fe=D.alternate,ke=fe!==null&&fe.memoizedState!==null||li;fe=ua;var Ke=li;if(ua=X,(li=ke)&&!Ke)for(Bt=D;Bt!==null;)X=Bt,ke=X.child,X.tag===22&&X.memoizedState!==null?rm(D):ke!==null?(ke.return=X,Bt=ke):rm(D);for(;B!==null;)Bt=B,Dp(B),B=B.sibling;Bt=D,ua=fe,li=Ke}Cd(o)}else(D.subtreeFlags&8772)!==0&&B!==null?(B.return=D,Bt=B):Cd(o)}}function Cd(o){for(;Bt!==null;){var c=Bt;if((c.flags&8772)!==0){var _=c.alternate;try{if((c.flags&8772)!==0)switch(c.tag){case 0:case 11:case 15:li||$s(5,c);break;case 1:var k=c.stateNode;if(c.flags&4&&!li)if(_===null)k.componentDidMount();else{var D=c.elementType===c.type?_.memoizedProps:Os(c.type,_.memoizedProps);k.componentDidUpdate(D,_.memoizedState,k.__reactInternalSnapshotBeforeUpdate)}var B=c.updateQueue;B!==null&&Er(c,B,k);break;case 3:var X=c.updateQueue;if(X!==null){if(_=null,c.child!==null)switch(c.child.tag){case 5:_=c.child.stateNode;break;case 1:_=c.child.stateNode}Er(c,X,_)}break;case 5:var fe=c.stateNode;if(_===null&&c.flags&4){_=fe;var ke=c.memoizedProps;switch(c.type){case"button":case"input":case"select":case"textarea":ke.autoFocus&&_.focus();break;case"img":ke.src&&(_.src=ke.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(c.memoizedState===null){var Ke=c.alternate;if(Ke!==null){var Et=Ke.memoizedState;if(Et!==null){var At=Et.dehydrated;At!==null&&js(At)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(g(163))}li||c.flags&512&&Fa(c)}catch(bt){Gn(c,c.return,bt)}}if(c===o){Bt=null;break}if(_=c.sibling,_!==null){_.return=c.return,Bt=_;break}Bt=c.return}}function Lp(o){for(;Bt!==null;){var c=Bt;if(c===o){Bt=null;break}var _=c.sibling;if(_!==null){_.return=c.return,Bt=_;break}Bt=c.return}}function rm(o){for(;Bt!==null;){var c=Bt;try{switch(c.tag){case 0:case 11:case 15:var _=c.return;try{$s(4,c)}catch(ke){Gn(c,_,ke)}break;case 1:var k=c.stateNode;if(typeof k.componentDidMount=="function"){var D=c.return;try{k.componentDidMount()}catch(ke){Gn(c,D,ke)}}var B=c.return;try{Fa(c)}catch(ke){Gn(c,B,ke)}break;case 5:var X=c.return;try{Fa(c)}catch(ke){Gn(c,X,ke)}}}catch(ke){Gn(c,c.return,ke)}if(c===o){Bt=null;break}var fe=c.sibling;if(fe!==null){fe.return=c.return,Bt=fe;break}Bt=c.return}}var ag=Math.ceil,Dl=lt.ReactCurrentDispatcher,Ad=lt.ReactCurrentOwner,mi=lt.ReactCurrentBatchConfig,Kt=0,ci=null,cn=null,wn=0,Nn=0,bi=Co(0),qr=0,vu=null,Pn=0,Ch=0,Ll=0,kc=null,ss=null,Ah=0,bu=1/0,Lo=null,Mh=!1,jp=null,qi=null,ha=!1,jo=null,Cc=0,Ac=0,Md=null,Pd=-1,Ph=0;function os(){return(Kt&6)!==0?Tn():Pd!==-1?Pd:Pd=Tn()}function da(o){return(o.mode&1)===0?1:(Kt&2)!==0&&wn!==0?wn&-wn:ie.transition!==null?(Ph===0&&(Ph=Bi()),Ph):(o=$r,o!==0||(o=window.event,o=o===void 0?16:Wc(o.type)),o)}function Ro(o,c,_,k){if(50<Ac)throw Ac=0,Md=null,Error(g(185));mr(o,_,k),((Kt&2)===0||o!==ci)&&(o===ci&&((Kt&2)===0&&(Ch|=_),qr===4&&jl(o,wn)),Zi(o,k),_===1&&Kt===0&&(c.mode&1)===0&&(bu=Tn()+500,Sl&&Pt()))}function Zi(o,c){var _=o.callbackNode;Dr(o,c);var k=xo(o,o===ci?wn:0);if(k===0)_!==null&&Vr(_),o.callbackNode=null,o.callbackPriority=0;else if(c=k&-k,o.callbackPriority!==c){if(_!=null&&Vr(_),c===1)o.tag===0?La(Mc.bind(null,o)):Da(Mc.bind(null,o)),hd(function(){(Kt&6)===0&&Pt()}),_=null;else{switch(Ji(k)){case 1:_=ds;break;case 4:_=Hs;break;case 16:_=Ja;break;case 536870912:_=$o;break;default:_=Ja}_=Dh(_,Rp.bind(null,o))}o.callbackPriority=c,o.callbackNode=_}}function Rp(o,c){if(Pd=-1,Ph=0,(Kt&6)!==0)throw Error(g(327));var _=o.callbackNode;if(ks()&&o.callbackNode!==_)return null;var k=xo(o,o===ci?wn:0);if(k===0)return null;if((k&30)!==0||(k&o.expiredLanes)!==0||c)c=Ih(o,k);else{c=k;var D=Kt;Kt|=2;var B=zp();(ci!==o||wn!==c)&&(Lo=null,bu=Tn()+500,Pc(o,c));do try{cg();break}catch(fe){im(o,fe)}while(!0);Ce(),Dl.current=B,Kt=D,cn!==null?c=0:(ci=null,wn=0,c=qr)}if(c!==0){if(c===2&&(D=Sr(o),D!==0&&(k=D,c=Id(o,D))),c===1)throw _=vu,Pc(o,0),jl(o,k),Zi(o,Tn()),_;if(c===6)jl(o,k);else{if(D=o.current.alternate,(k&30)===0&&!nm(D)&&(c=Ih(o,k),c===2&&(B=Sr(o),B!==0&&(k=B,c=Id(o,B))),c===1))throw _=vu,Pc(o,0),jl(o,k),Zi(o,Tn()),_;switch(o.finishedWork=D,o.finishedLanes=k,c){case 0:case 1:throw Error(g(345));case 2:zl(o,ss,Lo);break;case 3:if(jl(o,k),(k&130023424)===k&&(c=Ah+500-Tn(),10<c)){if(xo(o,0)!==0)break;if(D=o.suspendedLanes,(D&k)!==k){os(),o.pingedLanes|=o.suspendedLanes&D;break}o.timeoutHandle=Qo(zl.bind(null,o,ss,Lo),c);break}zl(o,ss,Lo);break;case 4:if(jl(o,k),(k&4194240)===k)break;for(c=o.eventTimes,D=-1;0<k;){var X=31-Xn(k);B=1<<X,X=c[X],X>D&&(D=X),k&=~B}if(k=D,k=Tn()-k,k=(120>k?120:480>k?480:1080>k?1080:1920>k?1920:3e3>k?3e3:4320>k?4320:1960*ag(k/1960))-k,10<k){o.timeoutHandle=Qo(zl.bind(null,o,ss,Lo),k);break}zl(o,ss,Lo);break;case 5:zl(o,ss,Lo);break;default:throw Error(g(329))}}}return Zi(o,Tn()),o.callbackNode===_?Rp.bind(null,o):null}function Id(o,c){var _=kc;return o.current.memoizedState.isDehydrated&&(Pc(o,c).flags|=256),o=Ih(o,c),o!==2&&(c=ss,ss=_,c!==null&&Oa(c)),o}function Oa(o){ss===null?ss=o:ss.push.apply(ss,o)}function nm(o){for(var c=o;;){if(c.flags&16384){var _=c.updateQueue;if(_!==null&&(_=_.stores,_!==null))for(var k=0;k<_.length;k++){var D=_[k],B=D.getSnapshot;D=D.value;try{if(!xs(B(),D))return!1}catch{return!1}}}if(_=c.child,c.subtreeFlags&16384&&_!==null)_.return=c,c=_;else{if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function jl(o,c){for(c&=~Ll,c&=~Ch,o.suspendedLanes|=c,o.pingedLanes&=~c,o=o.expirationTimes;0<c;){var _=31-Xn(c),k=1<<_;o[_]=-1,c&=~k}}function Mc(o){if((Kt&6)!==0)throw Error(g(327));ks();var c=xo(o,0);if((c&1)===0)return Zi(o,Tn()),null;var _=Ih(o,c);if(o.tag!==0&&_===2){var k=Sr(o);k!==0&&(c=k,_=Id(o,k))}if(_===1)throw _=vu,Pc(o,0),jl(o,c),Zi(o,Tn()),_;if(_===6)throw Error(g(345));return o.finishedWork=o.current.alternate,o.finishedLanes=c,zl(o,ss,Lo),Zi(o,Tn()),null}function wu(o,c){var _=Kt;Kt|=1;try{return o(c)}finally{Kt=_,Kt===0&&(bu=Tn()+500,Sl&&Pt())}}function Rl(o){jo!==null&&jo.tag===0&&(Kt&6)===0&&ks();var c=Kt;Kt|=1;var _=mi.transition,k=$r;try{if(mi.transition=null,$r=1,o)return o()}finally{$r=k,mi.transition=_,Kt=c,(Kt&6)===0&&Pt()}}function Dd(){Nn=bi.current,mn(bi)}function Pc(o,c){o.finishedWork=null,o.finishedLanes=0;var _=o.timeoutHandle;if(_!==-1&&(o.timeoutHandle=-1,dh(_)),cn!==null)for(_=cn.return;_!==null;){var k=_;switch(h(k),k.tag){case 1:k=k.type.childContextTypes,k!=null&&cu();break;case 3:Sn(),mn(Gi),mn(pi),En();break;case 5:ws(k);break;case 4:Sn();break;case 13:mn(pr);break;case 19:mn(pr);break;case 10:Oe(k.type._context);break;case 22:case 23:Dd()}_=_.return}if(ci=o,cn=o=Nl(o.current,null),wn=Nn=c,qr=0,vu=null,Ll=Ch=Pn=0,ss=kc=null,Ve!==null){for(c=0;c<Ve.length;c++)if(_=Ve[c],k=_.interleaved,k!==null){_.interleaved=null;var D=k.next,B=_.pending;if(B!==null){var X=B.next;B.next=D,k.next=X}_.pending=k}Ve=null}return o}function im(o,c){do{var _=cn;try{if(Ce(),ai.current=Ii,Ts){for(var k=gn.memoizedState;k!==null;){var D=k.queue;D!==null&&(D.pending=null),k=k.next}Ts=!1}if(Un=0,Mn=xn=gn=null,Ss=!1,Fs=0,Ad.current=null,_===null||_.return===null){qr=1,vu=c,cn=null;break}e:{var B=o,X=_.return,fe=_,ke=c;if(c=wn,fe.flags|=32768,ke!==null&&typeof ke=="object"&&typeof ke.then=="function"){var Ke=ke,Et=fe,At=Et.tag;if((Et.mode&1)===0&&(At===0||At===11||At===15)){var bt=Et.alternate;bt?(Et.updateQueue=bt.updateQueue,Et.memoizedState=bt.memoizedState,Et.lanes=bt.lanes):(Et.updateQueue=null,Et.memoizedState=null)}var qt=_d(X);if(qt!==null){qt.flags&=-257,Ep(qt,X,fe,B,c),qt.mode&1&&aa(B,Ke,c),c=qt,ke=Ke;var Yt=c.updateQueue;if(Yt===null){var Jt=new Set;Jt.add(ke),c.updateQueue=Jt}else Yt.add(ke);break e}else{if((c&1)===0){aa(B,Ke,c),Np();break e}ke=Error(g(426))}}else if(f&&fe.mode&1){var Wn=_d(X);if(Wn!==null){(Wn.flags&65536)===0&&(Wn.flags|=256),Ep(Wn,X,fe,B,c),re(wc(ke,fe));break e}}B=ke=wc(ke,fe),qr!==4&&(qr=2),kc===null?kc=[B]:kc.push(B),B=X;do{switch(B.tag){case 3:B.flags|=65536,c&=-c,B.lanes|=c;var We=pu(B,ke,c);Xt(B,We);break e;case 1:fe=ke;var Ie=B.type,Xe=B.stateNode;if((B.flags&128)===0&&(typeof Ie.getDerivedStateFromError=="function"||Xe!==null&&typeof Xe.componentDidCatch=="function"&&(qi===null||!qi.has(Xe)))){B.flags|=65536,c&=-c,B.lanes|=c;var jt=Tc(B,fe,c);Xt(B,jt);break e}}B=B.return}while(B!==null)}Fp(_)}catch(Qt){c=Qt,cn===_&&_!==null&&(cn=_=_.return);continue}break}while(!0)}function zp(){var o=Dl.current;return Dl.current=Ii,o===null?Ii:o}function Np(){(qr===0||qr===3||qr===2)&&(qr=4),ci===null||(Pn&268435455)===0&&(Ch&268435455)===0||jl(ci,wn)}function Ih(o,c){var _=Kt;Kt|=2;var k=zp();(ci!==o||wn!==c)&&(Lo=null,Pc(o,c));do try{lg();break}catch(D){im(o,D)}while(!0);if(Ce(),Kt=_,Dl.current=k,cn!==null)throw Error(g(261));return ci=null,wn=0,qr}function lg(){for(;cn!==null;)Bp(cn)}function cg(){for(;cn!==null&&!Ou();)Bp(cn)}function Bp(o){var c=Ld(o.alternate,o,Nn);o.memoizedProps=o.pendingProps,c===null?Fp(o):cn=c,Ad.current=null}function Fp(o){var c=o;do{var _=c.alternate;if(o=c.return,(c.flags&32768)===0){if(_=ca(_,c,Nn),_!==null){cn=_;return}}else{if(_=sg(_,c),_!==null){_.flags&=32767,cn=_;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{qr=6,cn=null;return}}if(c=c.sibling,c!==null){cn=c;return}cn=c=o}while(c!==null);qr===0&&(qr=5)}function zl(o,c,_){var k=$r,D=mi.transition;try{mi.transition=null,$r=1,Op(o,c,_,k)}finally{mi.transition=D,$r=k}return null}function Op(o,c,_,k){do ks();while(jo!==null);if((Kt&6)!==0)throw Error(g(327));_=o.finishedWork;var D=o.finishedLanes;if(_===null)return null;if(o.finishedWork=null,o.finishedLanes=0,_===o.current)throw Error(g(177));o.callbackNode=null,o.callbackPriority=0;var B=_.lanes|_.childLanes;if(Yi(o,B),o===ci&&(cn=ci=null,wn=0),(_.subtreeFlags&2064)===0&&(_.flags&2064)===0||ha||(ha=!0,Dh(Ja,function(){return ks(),null})),B=(_.flags&15990)!==0,(_.subtreeFlags&15990)!==0||B){B=mi.transition,mi.transition=null;var X=$r;$r=1;var fe=Kt;Kt|=4,Ad.current=null,og(o,_),kd(_,o),yp(iu),nl=!!vl,iu=vl=null,o.current=_,xu(_),Hl(),Kt=fe,$r=X,mi.transition=B}else o.current=_;if(ha&&(ha=!1,jo=o,Cc=D),B=o.pendingLanes,B===0&&(qi=null),rt(_.stateNode),Zi(o,Tn()),c!==null)for(k=o.onRecoverableError,_=0;_<c.length;_++)D=c[_],k(D.value,{componentStack:D.stack,digest:D.digest});if(Mh)throw Mh=!1,o=jp,jp=null,o;return(Cc&1)!==0&&o.tag!==0&&ks(),B=o.pendingLanes,(B&1)!==0?o===Md?Ac++:(Ac=0,Md=o):Ac=0,Pt(),null}function ks(){if(jo!==null){var o=Ji(Cc),c=mi.transition,_=$r;try{if(mi.transition=null,$r=16>o?16:o,jo===null)var k=!1;else{if(o=jo,jo=null,Cc=0,(Kt&6)!==0)throw Error(g(331));var D=Kt;for(Kt|=4,Bt=o.current;Bt!==null;){var B=Bt,X=B.child;if((Bt.flags&16)!==0){var fe=B.deletions;if(fe!==null){for(var ke=0;ke<fe.length;ke++){var Ke=fe[ke];for(Bt=Ke;Bt!==null;){var Et=Bt;switch(Et.tag){case 0:case 11:case 15:Ec(8,Et,B)}var At=Et.child;if(At!==null)At.return=Et,Bt=At;else for(;Bt!==null;){Et=Bt;var bt=Et.sibling,qt=Et.return;if(Mp(Et),Et===Ke){Bt=null;break}if(bt!==null){bt.return=qt,Bt=bt;break}Bt=qt}}}var Yt=B.alternate;if(Yt!==null){var Jt=Yt.child;if(Jt!==null){Yt.child=null;do{var Wn=Jt.sibling;Jt.sibling=null,Jt=Wn}while(Jt!==null)}}Bt=B}}if((B.subtreeFlags&2064)!==0&&X!==null)X.return=B,Bt=X;else e:for(;Bt!==null;){if(B=Bt,(B.flags&2048)!==0)switch(B.tag){case 0:case 11:case 15:Ec(9,B,B.return)}var We=B.sibling;if(We!==null){We.return=B.return,Bt=We;break e}Bt=B.return}}var Ie=o.current;for(Bt=Ie;Bt!==null;){X=Bt;var Xe=X.child;if((X.subtreeFlags&2064)!==0&&Xe!==null)Xe.return=X,Bt=Xe;else e:for(X=Ie;Bt!==null;){if(fe=Bt,(fe.flags&2048)!==0)try{switch(fe.tag){case 0:case 11:case 15:$s(9,fe)}}catch(Qt){Gn(fe,fe.return,Qt)}if(fe===X){Bt=null;break e}var jt=fe.sibling;if(jt!==null){jt.return=fe.return,Bt=jt;break e}Bt=fe.return}}if(Kt=D,Pt(),Ni&&typeof Ni.onPostCommitFiberRoot=="function")try{Ni.onPostCommitFiberRoot(ps,o)}catch{}k=!0}return k}finally{$r=_,mi.transition=c}}return!1}function as(o,c,_){c=wc(_,c),c=pu(o,c,1),o=er(o,c,1),c=os(),o!==null&&(mr(o,1,c),Zi(o,c))}function Gn(o,c,_){if(o.tag===3)as(o,o,_);else for(;c!==null;){if(c.tag===3){as(c,o,_);break}else if(c.tag===1){var k=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof k.componentDidCatch=="function"&&(qi===null||!qi.has(k))){o=wc(_,o),o=Tc(c,o,1),c=er(c,o,1),o=os(),c!==null&&(mr(c,1,o),Zi(c,o));break}}c=c.return}}function Up(o,c,_){var k=o.pingCache;k!==null&&k.delete(c),c=os(),o.pingedLanes|=o.suspendedLanes&_,ci===o&&(wn&_)===_&&(qr===4||qr===3&&(wn&130023424)===wn&&500>Tn()-Ah?Pc(o,0):Ll|=_),Zi(o,c)}function sm(o,c){c===0&&((o.mode&1)===0?c=1:(c=Qa,Qa<<=1,(Qa&130023424)===0&&(Qa=4194304)));var _=os();o=Qe(o,c),o!==null&&(mr(o,c,_),Zi(o,_))}function ug(o){var c=o.memoizedState,_=0;c!==null&&(_=c.retryLane),sm(o,_)}function hg(o,c){var _=0;switch(o.tag){case 13:var k=o.stateNode,D=o.memoizedState;D!==null&&(_=D.retryLane);break;case 19:k=o.stateNode;break;default:throw Error(g(314))}k!==null&&k.delete(c),sm(o,_)}var Ld;Ld=function(o,c,_){if(o!==null)if(o.memoizedProps!==c.pendingProps||Gi.current)vi=!0;else{if((o.lanes&_)===0&&(c.flags&128)===0)return vi=!1,Th(o,c,_);vi=(o.flags&131072)!==0}else vi=!1,f&&(c.flags&1048576)!==0&&uu(c,kl,c.index);switch(c.lanes=0,c.tag){case 2:var k=c.type;wh(o,c),o=c.pendingProps;var D=fi(c,pi.current);je(c,_),D=pd(null,c,k,o,D,_);var B=fd();return c.flags|=1,typeof D=="object"&&D!==null&&typeof D.render=="function"&&D.$$typeof===void 0?(c.tag=1,c.memoizedState=null,c.updateQueue=null,Pi(k)?(B=!0,ro(c)):B=!1,c.memoizedState=D.state!==null&&D.state!==void 0?D.state:null,ct(c),D.updater=Ml,c.stateNode=D,D._reactInternals=c,yd(c,k,o,_),c=Vs(null,c,k,!0,B,_)):(c.tag=0,f&&B&&na(c),vn(null,c,D,_),c=c.child),c;case 16:k=c.elementType;e:{switch(wh(o,c),o=c.pendingProps,D=k._init,k=D(k._payload),c.type=k,D=c.tag=dg(k),o=Os(k,o),D){case 0:c=vd(null,c,k,o,_);break e;case 1:c=mu(null,c,k,o,_);break e;case 11:c=fu(null,c,k,o,_);break e;case 14:c=Di(null,c,k,Os(k.type,o),_);break e}throw Error(g(306,k,""))}return c;case 0:return k=c.type,D=c.pendingProps,D=c.elementType===k?D:Os(k,D),vd(o,c,k,D,_);case 1:return k=c.type,D=c.pendingProps,D=c.elementType===k?D:Os(k,D),mu(o,c,k,D,_);case 3:e:{if(Yf(c),o===null)throw Error(g(387));k=c.pendingProps,B=c.memoizedState,D=B.element,gt(o,c),br(c,k,null,_);var X=c.memoizedState;if(k=X.element,B.isDehydrated)if(B={element:k,isDehydrated:!1,cache:X.cache,pendingSuspenseBoundaries:X.pendingSuspenseBoundaries,transitions:X.transitions},c.updateQueue.baseState=B,c.memoizedState=B,c.flags&256){D=wc(Error(g(423)),c),c=Jf(o,c,k,_,D);break e}else if(k!==D){D=wc(Error(g(424)),c),c=Jf(o,c,k,_,D);break e}else for(a=to(c.stateNode.containerInfo.firstChild),n=c,f=!0,y=null,_=ce(c,null,k,_),c.child=_;_;)_.flags=_.flags&-3|4096,_=_.sibling;else{if(K(),k===D){c=la(o,c,_);break e}vn(o,c,k,_)}c=c.child}return c;case 5:return ns(c),o===null&&I(c),k=c.type,D=c.pendingProps,B=o!==null?o.memoizedProps:null,X=D.children,bl(k,D)?X=null:B!==null&&bl(k,B)&&(c.flags|=32),kn(o,c),vn(o,c,X,_),c.child;case 6:return o===null&&I(c),null;case 13:return Il(o,c,_);case 4:return oi(c,c.stateNode.containerInfo),k=c.pendingProps,o===null?c.child=le(c,null,k,_):vn(o,c,k,_),c.child;case 11:return k=c.type,D=c.pendingProps,D=c.elementType===k?D:Os(k,D),fu(o,c,k,D,_);case 7:return vn(o,c,c.pendingProps,_),c.child;case 8:return vn(o,c,c.pendingProps.children,_),c.child;case 12:return vn(o,c,c.pendingProps.children,_),c.child;case 10:e:{if(k=c.type._context,D=c.pendingProps,B=c.memoizedProps,X=D.value,Lr(xe,k._currentValue),k._currentValue=X,B!==null)if(xs(B.value,X)){if(B.children===D.children&&!Gi.current){c=la(o,c,_);break e}}else for(B=c.child,B!==null&&(B.return=c);B!==null;){var fe=B.dependencies;if(fe!==null){X=B.child;for(var ke=fe.firstContext;ke!==null;){if(ke.context===k){if(B.tag===1){ke=Ut(-1,_&-_),ke.tag=2;var Ke=B.updateQueue;if(Ke!==null){Ke=Ke.shared;var Et=Ke.pending;Et===null?ke.next=ke:(ke.next=Et.next,Et.next=ke),Ke.pending=ke}}B.lanes|=_,ke=B.alternate,ke!==null&&(ke.lanes|=_),ft(B.return,_,c),fe.lanes|=_;break}ke=ke.next}}else if(B.tag===10)X=B.type===c.type?null:B.child;else if(B.tag===18){if(X=B.return,X===null)throw Error(g(341));X.lanes|=_,fe=X.alternate,fe!==null&&(fe.lanes|=_),ft(X,_,c),X=B.sibling}else X=B.child;if(X!==null)X.return=B;else for(X=B;X!==null;){if(X===c){X=null;break}if(B=X.sibling,B!==null){B.return=X.return,X=B;break}X=X.return}B=X}vn(o,c,D.children,_),c=c.child}return c;case 9:return D=c.type,k=c.pendingProps.children,je(c,_),D=Je(D),k=k(D),c.flags|=1,vn(o,c,k,_),c.child;case 14:return k=c.type,D=Os(k,c.pendingProps),D=Os(k.type,D),Di(o,c,k,D,_);case 15:return Us(o,c,c.type,c.pendingProps,_);case 17:return k=c.type,D=c.pendingProps,D=c.elementType===k?D:Os(k,D),wh(o,c),c.tag=1,Pi(k)?(o=!0,ro(c)):o=!1,je(c,_),gd(c,k,D),yd(c,k,D,_),Vs(null,c,k,!0,o,_);case 19:return em(o,c,_);case 22:return xd(o,c,_)}throw Error(g(156,c.tag))};function Dh(o,c){return Fu(o,c)}function om(o,c,_,k){this.tag=o,this.key=_,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=k,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wi(o,c,_,k){return new om(o,c,_,k)}function Ic(o){return o=o.prototype,!(!o||!o.isReactComponent)}function dg(o){if(typeof o=="function")return Ic(o)?1:0;if(o!=null){if(o=o.$$typeof,o===ut)return 11;if(o===Jr)return 14}return 2}function Nl(o,c){var _=o.alternate;return _===null?(_=wi(o.tag,c,o.key,o.mode),_.elementType=o.elementType,_.type=o.type,_.stateNode=o.stateNode,_.alternate=o,o.alternate=_):(_.pendingProps=c,_.type=o.type,_.flags=0,_.subtreeFlags=0,_.deletions=null),_.flags=o.flags&14680064,_.childLanes=o.childLanes,_.lanes=o.lanes,_.child=o.child,_.memoizedProps=o.memoizedProps,_.memoizedState=o.memoizedState,_.updateQueue=o.updateQueue,c=o.dependencies,_.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},_.sibling=o.sibling,_.index=o.index,_.ref=o.ref,_}function jd(o,c,_,k,D,B){var X=2;if(k=o,typeof o=="function")Ic(o)&&(X=1);else if(typeof o=="string")X=5;else e:switch(o){case Ye:return Dc(_.children,D,B,c);case tt:X=8,D|=8;break;case it:return o=wi(12,_,c,D|2),o.elementType=it,o.lanes=B,o;case vt:return o=wi(13,_,c,D),o.elementType=vt,o.lanes=B,o;case nr:return o=wi(19,_,c,D),o.elementType=nr,o.lanes=B,o;case cr:return Rd(_,D,B,c);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case De:X=10;break e;case $t:X=9;break e;case ut:X=11;break e;case Jr:X=14;break e;case ir:X=16,k=null;break e}throw Error(g(130,o==null?o:typeof o,""))}return c=wi(X,_,c,D),c.elementType=o,c.type=k,c.lanes=B,c}function Dc(o,c,_,k){return o=wi(7,o,k,c),o.lanes=_,o}function Rd(o,c,_,k){return o=wi(22,o,k,c),o.elementType=cr,o.lanes=_,o.stateNode={isHidden:!1},o}function Vp(o,c,_){return o=wi(6,o,null,c),o.lanes=_,o}function $p(o,c,_){return c=wi(4,o.children!==null?o.children:[],o.key,c),c.lanes=_,c.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},c}function Gp(o,c,_,k,D){this.tag=c,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ki(0),this.expirationTimes=Ki(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ki(0),this.identifierPrefix=k,this.onRecoverableError=D,this.mutableSourceEagerHydrationData=null}function Wp(o,c,_,k,D,B,X,fe,ke){return o=new Gp(o,c,_,fe,ke),c===1?(c=1,B===!0&&(c|=8)):c=0,B=wi(3,null,null,c),o.current=B,B.stateNode=o,B.memoizedState={element:k,isDehydrated:_,cache:null,transitions:null,pendingSuspenseBoundaries:null},ct(B),o}function Tu(o,c,_){var k=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$e,key:k==null?null:""+k,children:o,containerInfo:c,implementation:_}}function am(o){if(!o)return ta;o=o._reactInternals;e:{if(fn(o)!==o||o.tag!==1)throw Error(g(170));var c=o;do{switch(c.tag){case 3:c=c.stateNode.context;break e;case 1:if(Pi(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break e}}c=c.return}while(c!==null);throw Error(g(171))}if(o.tag===1){var _=o.type;if(Pi(_))return Ns(o,_,c)}return c}function In(o,c,_,k,D,B,X,fe,ke){return o=Wp(_,k,!0,o,D,B,X,fe,ke),o.context=am(null),_=o.current,k=os(),D=da(_),B=Ut(k,D),B.callback=c??null,er(_,B,D),o.current.lanes=D,mr(o,D,k),Zi(o,k),o}function Lc(o,c,_,k){var D=c.current,B=os(),X=da(D);return _=am(_),c.context===null?c.context=_:c.pendingContext=_,c=Ut(B,X),c.payload={element:o},k=k===void 0?null:k,k!==null&&(c.callback=k),o=er(D,c,X),o!==null&&(Ro(o,D,X,B),Nt(o,D,X)),X}function Lh(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function jh(o,c){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var _=o.retryLane;o.retryLane=_!==0&&_<c?_:c}}function Su(o,c){jh(o,c),(o=o.alternate)&&jh(o,c)}function Rh(){return null}var qp=typeof reportError=="function"?reportError:function(o){console.error(o)};function zd(o){this._internalRoot=o}Bl.prototype.render=zd.prototype.render=function(o){var c=this._internalRoot;if(c===null)throw Error(g(409));Lc(o,c,null,null)},Bl.prototype.unmount=zd.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var c=o.containerInfo;Rl(function(){Lc(null,o,null,null)}),c[zs]=null}};function Bl(o){this._internalRoot=o}Bl.prototype.unstable_scheduleHydration=function(o){if(o){var c=tl();o={blockedOn:null,target:o,priority:c};for(var _=0;_<tn.length&&c!==0&&c<tn[_].priority;_++);tn.splice(_,0,o),_===0&&$u(o)}};function zh(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function Eu(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function Nd(){}function pg(o,c,_,k,D){if(D){if(typeof k=="function"){var B=k;k=function(){var Ke=Lh(X);B.call(Ke)}}var X=In(c,k,o,0,null,!1,!1,"",Nd);return o._reactRootContainer=X,o[zs]=X.current,So(o.nodeType===8?o.parentNode:o),Rl(),X}for(;D=o.lastChild;)o.removeChild(D);if(typeof k=="function"){var fe=k;k=function(){var Ke=Lh(ke);fe.call(Ke)}}var ke=Wp(o,0,!1,null,null,!1,!1,"",Nd);return o._reactRootContainer=ke,o[zs]=ke.current,So(o.nodeType===8?o.parentNode:o),Rl(function(){Lc(c,ke,_,k)}),ke}function Nh(o,c,_,k,D){var B=_._reactRootContainer;if(B){var X=B;if(typeof D=="function"){var fe=D;D=function(){var ke=Lh(X);fe.call(ke)}}Lc(c,X,o,D)}else X=pg(_,c,o,D,k);return Lh(X)}ln=function(o){switch(o.tag){case 3:var c=o.stateNode;if(c.current.memoizedState.isDehydrated){var _=el(c.pendingLanes);_!==0&&(_a(c,_|1),Zi(c,Tn()),(Kt&6)===0&&(bu=Tn()+500,Pt()))}break;case 13:Rl(function(){var k=Qe(o,1);if(k!==null){var D=os();Ro(k,o,1,D)}}),Su(o,1)}},$c=function(o){if(o.tag===13){var c=Qe(o,134217728);if(c!==null){var _=os();Ro(c,o,134217728,_)}Su(o,134217728)}},Xs=function(o){if(o.tag===13){var c=da(o),_=Qe(o,c);if(_!==null){var k=os();Ro(_,o,c,k)}Su(o,c)}},tl=function(){return $r},rl=function(o,c){var _=$r;try{return $r=o,c()}finally{$r=_}},he=function(o,c,_){switch(c){case"input":if(yi(o,_),c=_.name,_.type==="radio"&&c!=null){for(_=o;_.parentNode;)_=_.parentNode;for(_=_.querySelectorAll("input[name="+JSON.stringify(""+c)+'][type="radio"]'),c=0;c<_.length;c++){var k=_[c];if(k!==o&&k.form===o.form){var D=au(k);if(!D)throw Error(g(90));Cr(k),yi(k,D)}}}break;case"textarea":Ci(o,_);break;case"select":c=_.value,c!=null&&Wt(o,!!_.multiple,c,!1)}},ze=wu,Le=Rl;var Bh={usingClientEntryPoint:!1,Events:[Tl,Pa,au,_e,Se,wu]},Fh={findFiberByHostInstance:$i,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Zp={bundleType:Fh.bundleType,version:Fh.version,rendererPackageName:Fh.rendererPackageName,rendererConfig:Fh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:lt.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=ya(o),o===null?null:o.stateNode},findFiberByHostInstance:Fh.findFiberByHostInstance||Rh,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Bd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bd.isDisabled&&Bd.supportsFiber)try{ps=Bd.inject(Zp),Ni=Bd}catch{}}return uo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Bh,uo.createPortal=function(o,c){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!zh(c))throw Error(g(200));return Tu(o,c,null,_)},uo.createRoot=function(o,c){if(!zh(o))throw Error(g(299));var _=!1,k="",D=qp;return c!=null&&(c.unstable_strictMode===!0&&(_=!0),c.identifierPrefix!==void 0&&(k=c.identifierPrefix),c.onRecoverableError!==void 0&&(D=c.onRecoverableError)),c=Wp(o,1,!1,null,null,_,!1,k,D),o[zs]=c.current,So(o.nodeType===8?o.parentNode:o),new zd(c)},uo.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var c=o._reactInternals;if(c===void 0)throw typeof o.render=="function"?Error(g(188)):(o=Object.keys(o).join(","),Error(g(268,o)));return o=ya(c),o=o===null?null:o.stateNode,o},uo.flushSync=function(o){return Rl(o)},uo.hydrate=function(o,c,_){if(!Eu(c))throw Error(g(200));return Nh(null,o,c,!0,_)},uo.hydrateRoot=function(o,c,_){if(!zh(o))throw Error(g(405));var k=_!=null&&_.hydratedSources||null,D=!1,B="",X=qp;if(_!=null&&(_.unstable_strictMode===!0&&(D=!0),_.identifierPrefix!==void 0&&(B=_.identifierPrefix),_.onRecoverableError!==void 0&&(X=_.onRecoverableError)),c=In(c,null,o,1,_??null,D,!1,B,X),o[zs]=c.current,So(o),k)for(o=0;o<k.length;o++)_=k[o],D=_._getVersion,D=D(_._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[_,D]:c.mutableSourceEagerHydrationData.push(_,D);return new Bl(c)},uo.render=function(o,c,_){if(!Eu(c))throw Error(g(200));return Nh(null,o,c,!1,_)},uo.unmountComponentAtNode=function(o){if(!Eu(o))throw Error(g(40));return o._reactRootContainer?(Rl(function(){Nh(null,null,o,!1,function(){o._reactRootContainer=null,o[zs]=null})}),!0):!1},uo.unstable_batchedUpdates=wu,uo.unstable_renderSubtreeIntoContainer=function(o,c,_,k){if(!Eu(_))throw Error(g(200));if(o==null||o._reactInternals===void 0)throw Error(g(38));return Nh(o,c,_,!1,k)},uo.version="18.3.1-next-f1338f8080-20240426",uo}var mx;function $v(){if(mx)return qg.exports;mx=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(p){console.error(p)}}return u(),qg.exports=DT(),qg.exports}var gx;function LT(){if(gx)return Am;gx=1;var u=$v();return Am.createRoot=u.createRoot,Am.hydrateRoot=u.hydrateRoot,Am}var jT=LT();const RT=Gy(jT);/**
 * react-router v7.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var yx="popstate";function zT(u={}){function p(w,E){let{pathname:P,search:j,hash:F}=w.location;return gy("",{pathname:P,search:j,hash:F},E.state&&E.state.usr||null,E.state&&E.state.key||"default")}function g(w,E){return typeof E=="string"?E:wf(E)}return BT(p,g,null,u)}function ti(u,p){if(u===!1||u===null||typeof u>"u")throw new Error(p)}function ql(u,p){if(!u){typeof console<"u"&&console.warn(p);try{throw new Error(p)}catch{}}}function NT(){return Math.random().toString(36).substring(2,10)}function _x(u,p){return{usr:u.state,key:u.key,idx:p}}function gy(u,p,g=null,w){return{pathname:typeof u=="string"?u:u.pathname,search:"",hash:"",...typeof p=="string"?cp(p):p,state:g,key:p&&p.key||w||NT()}}function wf({pathname:u="/",search:p="",hash:g=""}){return p&&p!=="?"&&(u+=p.charAt(0)==="?"?p:"?"+p),g&&g!=="#"&&(u+=g.charAt(0)==="#"?g:"#"+g),u}function cp(u){let p={};if(u){let g=u.indexOf("#");g>=0&&(p.hash=u.substring(g),u=u.substring(0,g));let w=u.indexOf("?");w>=0&&(p.search=u.substring(w),u=u.substring(0,w)),u&&(p.pathname=u)}return p}function BT(u,p,g,w={}){let{window:E=document.defaultView,v5Compat:P=!1}=w,j=E.history,F="POP",s=null,U=G();U==null&&(U=0,j.replaceState({...j.state,idx:U},""));function G(){return(j.state||{idx:null}).idx}function J(){F="POP";let Re=G(),Ue=Re==null?null:Re-U;U=Re,s&&s({action:F,location:Ee.location,delta:Ue})}function Y(Re,Ue){F="PUSH";let He=gy(Ee.location,Re,Ue);U=G()+1;let Me=_x(He,U),lt=Ee.createHref(He);try{j.pushState(Me,"",lt)}catch(kt){if(kt instanceof DOMException&&kt.name==="DataCloneError")throw kt;E.location.assign(lt)}P&&s&&s({action:F,location:Ee.location,delta:1})}function me(Re,Ue){F="REPLACE";let He=gy(Ee.location,Re,Ue);U=G();let Me=_x(He,U),lt=Ee.createHref(He);j.replaceState(Me,"",lt),P&&s&&s({action:F,location:Ee.location,delta:0})}function Ae(Re){return FT(Re)}let Ee={get action(){return F},get location(){return u(E,j)},listen(Re){if(s)throw new Error("A history only accepts one active listener");return E.addEventListener(yx,J),s=Re,()=>{E.removeEventListener(yx,J),s=null}},createHref(Re){return p(E,Re)},createURL:Ae,encodeLocation(Re){let Ue=Ae(Re);return{pathname:Ue.pathname,search:Ue.search,hash:Ue.hash}},push:Y,replace:me,go(Re){return j.go(Re)}};return Ee}function FT(u,p=!1){let g="http://localhost";typeof window<"u"&&(g=window.location.origin!=="null"?window.location.origin:window.location.href),ti(g,"No window.location.(origin|href) available to create URL");let w=typeof u=="string"?u:wf(u);return w=w.replace(/ $/,"%20"),!p&&w.startsWith("//")&&(w=g+w),new URL(w,g)}function Gv(u,p,g="/"){return OT(u,p,g,!1)}function OT(u,p,g,w){let E=typeof p=="string"?cp(p):p,P=Nc(E.pathname||"/",g);if(P==null)return null;let j=Wv(u);UT(j);let F=null;for(let s=0;F==null&&s<j.length;++s){let U=JT(P);F=KT(j[s],U,w)}return F}function Wv(u,p=[],g=[],w="",E=!1){let P=(j,F,s=E,U)=>{let G={relativePath:U===void 0?j.path||"":U,caseSensitive:j.caseSensitive===!0,childrenIndex:F,route:j};if(G.relativePath.startsWith("/")){if(!G.relativePath.startsWith(w)&&s)return;ti(G.relativePath.startsWith(w),`Absolute route path "${G.relativePath}" nested under path "${w}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),G.relativePath=G.relativePath.slice(w.length)}let J=zc([w,G.relativePath]),Y=g.concat(G);j.children&&j.children.length>0&&(ti(j.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${J}".`),Wv(j.children,p,Y,J,s)),!(j.path==null&&!j.index)&&p.push({path:J,score:HT(J,j.index),routesMeta:Y})};return u.forEach((j,F)=>{if(j.path===""||!j.path?.includes("?"))P(j,F);else for(let s of qv(j.path))P(j,F,!0,s)}),p}function qv(u){let p=u.split("/");if(p.length===0)return[];let[g,...w]=p,E=g.endsWith("?"),P=g.replace(/\?$/,"");if(w.length===0)return E?[P,""]:[P];let j=qv(w.join("/")),F=[];return F.push(...j.map(s=>s===""?P:[P,s].join("/"))),E&&F.push(...j),F.map(s=>u.startsWith("/")&&s===""?"/":s)}function UT(u){u.sort((p,g)=>p.score!==g.score?g.score-p.score:XT(p.routesMeta.map(w=>w.childrenIndex),g.routesMeta.map(w=>w.childrenIndex)))}var VT=/^:[\w-]+$/,$T=3,GT=2,WT=1,qT=10,ZT=-2,xx=u=>u==="*";function HT(u,p){let g=u.split("/"),w=g.length;return g.some(xx)&&(w+=ZT),p&&(w+=GT),g.filter(E=>!xx(E)).reduce((E,P)=>E+(VT.test(P)?$T:P===""?WT:qT),w)}function XT(u,p){return u.length===p.length&&u.slice(0,-1).every((w,E)=>w===p[E])?u[u.length-1]-p[p.length-1]:0}function KT(u,p,g=!1){let{routesMeta:w}=u,E={},P="/",j=[];for(let F=0;F<w.length;++F){let s=w[F],U=F===w.length-1,G=P==="/"?p:p.slice(P.length)||"/",J=$m({path:s.relativePath,caseSensitive:s.caseSensitive,end:U},G),Y=s.route;if(!J&&U&&g&&!w[w.length-1].route.index&&(J=$m({path:s.relativePath,caseSensitive:s.caseSensitive,end:!1},G)),!J)return null;Object.assign(E,J.params),j.push({params:E,pathname:zc([P,J.pathname]),pathnameBase:rS(zc([P,J.pathnameBase])),route:Y}),J.pathnameBase!=="/"&&(P=zc([P,J.pathnameBase]))}return j}function $m(u,p){typeof u=="string"&&(u={path:u,caseSensitive:!1,end:!0});let[g,w]=YT(u.path,u.caseSensitive,u.end),E=p.match(g);if(!E)return null;let P=E[0],j=P.replace(/(.)\/+$/,"$1"),F=E.slice(1);return{params:w.reduce((U,{paramName:G,isOptional:J},Y)=>{if(G==="*"){let Ae=F[Y]||"";j=P.slice(0,P.length-Ae.length).replace(/(.)\/+$/,"$1")}const me=F[Y];return J&&!me?U[G]=void 0:U[G]=(me||"").replace(/%2F/g,"/"),U},{}),pathname:P,pathnameBase:j,pattern:u}}function YT(u,p=!1,g=!0){ql(u==="*"||!u.endsWith("*")||u.endsWith("/*"),`Route path "${u}" will be treated as if it were "${u.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${u.replace(/\*$/,"/*")}".`);let w=[],E="^"+u.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(j,F,s)=>(w.push({paramName:F,isOptional:s!=null}),s?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return u.endsWith("*")?(w.push({paramName:"*"}),E+=u==="*"||u==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):g?E+="\\/*$":u!==""&&u!=="/"&&(E+="(?:(?=\\/|$))"),[new RegExp(E,p?void 0:"i"),w]}function JT(u){try{return u.split("/").map(p=>decodeURIComponent(p).replace(/\//g,"%2F")).join("/")}catch(p){return ql(!1,`The URL path "${u}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${p}).`),u}}function Nc(u,p){if(p==="/")return u;if(!u.toLowerCase().startsWith(p.toLowerCase()))return null;let g=p.endsWith("/")?p.length-1:p.length,w=u.charAt(g);return w&&w!=="/"?null:u.slice(g)||"/"}function QT(u,p="/"){let{pathname:g,search:w="",hash:E=""}=typeof u=="string"?cp(u):u;return{pathname:g?g.startsWith("/")?g:eS(g,p):p,search:nS(w),hash:iS(E)}}function eS(u,p){let g=p.replace(/\/+$/,"").split("/");return u.split("/").forEach(E=>{E===".."?g.length>1&&g.pop():E!=="."&&g.push(E)}),g.length>1?g.join("/"):"/"}function Xg(u,p,g,w){return`Cannot include a '${u}' character in a manually specified \`to.${p}\` field [${JSON.stringify(w)}].  Please separate it out to the \`to.${g}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function tS(u){return u.filter((p,g)=>g===0||p.route.path&&p.route.path.length>0)}function Zv(u){let p=tS(u);return p.map((g,w)=>w===p.length-1?g.pathname:g.pathnameBase)}function Hv(u,p,g,w=!1){let E;typeof u=="string"?E=cp(u):(E={...u},ti(!E.pathname||!E.pathname.includes("?"),Xg("?","pathname","search",E)),ti(!E.pathname||!E.pathname.includes("#"),Xg("#","pathname","hash",E)),ti(!E.search||!E.search.includes("#"),Xg("#","search","hash",E)));let P=u===""||E.pathname==="",j=P?"/":E.pathname,F;if(j==null)F=g;else{let J=p.length-1;if(!w&&j.startsWith("..")){let Y=j.split("/");for(;Y[0]==="..";)Y.shift(),J-=1;E.pathname=Y.join("/")}F=J>=0?p[J]:"/"}let s=QT(E,F),U=j&&j!=="/"&&j.endsWith("/"),G=(P||j===".")&&g.endsWith("/");return!s.pathname.endsWith("/")&&(U||G)&&(s.pathname+="/"),s}var zc=u=>u.join("/").replace(/\/\/+/g,"/"),rS=u=>u.replace(/\/+$/,"").replace(/^\/*/,"/"),nS=u=>!u||u==="?"?"":u.startsWith("?")?u:"?"+u,iS=u=>!u||u==="#"?"":u.startsWith("#")?u:"#"+u;function sS(u){return u!=null&&typeof u.status=="number"&&typeof u.statusText=="string"&&typeof u.internal=="boolean"&&"data"in u}var Xv=["POST","PUT","PATCH","DELETE"];new Set(Xv);var oS=["GET",...Xv];new Set(oS);var up=ee.createContext(null);up.displayName="DataRouter";var Km=ee.createContext(null);Km.displayName="DataRouterState";ee.createContext(!1);var Kv=ee.createContext({isTransitioning:!1});Kv.displayName="ViewTransition";var aS=ee.createContext(new Map);aS.displayName="Fetchers";var lS=ee.createContext(null);lS.displayName="Await";var Zl=ee.createContext(null);Zl.displayName="Navigation";var Df=ee.createContext(null);Df.displayName="Location";var Uc=ee.createContext({outlet:null,matches:[],isDataRoute:!1});Uc.displayName="Route";var qy=ee.createContext(null);qy.displayName="RouteError";function cS(u,{relative:p}={}){ti(Lf(),"useHref() may be used only in the context of a <Router> component.");let{basename:g,navigator:w}=ee.useContext(Zl),{hash:E,pathname:P,search:j}=Rf(u,{relative:p}),F=P;return g!=="/"&&(F=P==="/"?g:zc([g,P])),w.createHref({pathname:F,search:j,hash:E})}function Lf(){return ee.useContext(Df)!=null}function Nu(){return ti(Lf(),"useLocation() may be used only in the context of a <Router> component."),ee.useContext(Df).location}var Yv="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Jv(u){ee.useContext(Zl).static||ee.useLayoutEffect(u)}function jf(){let{isDataRoute:u}=ee.useContext(Uc);return u?wS():uS()}function uS(){ti(Lf(),"useNavigate() may be used only in the context of a <Router> component.");let u=ee.useContext(up),{basename:p,navigator:g}=ee.useContext(Zl),{matches:w}=ee.useContext(Uc),{pathname:E}=Nu(),P=JSON.stringify(Zv(w)),j=ee.useRef(!1);return Jv(()=>{j.current=!0}),ee.useCallback((s,U={})=>{if(ql(j.current,Yv),!j.current)return;if(typeof s=="number"){g.go(s);return}let G=Hv(s,JSON.parse(P),E,U.relative==="path");u==null&&p!=="/"&&(G.pathname=G.pathname==="/"?p:zc([p,G.pathname])),(U.replace?g.replace:g.push)(G,U.state,U)},[p,g,P,E,u])}ee.createContext(null);function Rf(u,{relative:p}={}){let{matches:g}=ee.useContext(Uc),{pathname:w}=Nu(),E=JSON.stringify(Zv(g));return ee.useMemo(()=>Hv(u,JSON.parse(E),w,p==="path"),[u,E,w,p])}function hS(u,p){return Qv(u,p)}function Qv(u,p,g,w,E){ti(Lf(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:P}=ee.useContext(Zl),{matches:j}=ee.useContext(Uc),F=j[j.length-1],s=F?F.params:{},U=F?F.pathname:"/",G=F?F.pathnameBase:"/",J=F&&F.route;{let He=J&&J.path||"";e1(U,!J||He.endsWith("*")||He.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${U}" (under <Route path="${He}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${He}"> to <Route path="${He==="/"?"*":`${He}/*`}">.`)}let Y=Nu(),me;if(p){let He=typeof p=="string"?cp(p):p;ti(G==="/"||He.pathname?.startsWith(G),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${G}" but pathname "${He.pathname}" was given in the \`location\` prop.`),me=He}else me=Y;let Ae=me.pathname||"/",Ee=Ae;if(G!=="/"){let He=G.replace(/^\//,"").split("/");Ee="/"+Ae.replace(/^\//,"").split("/").slice(He.length).join("/")}let Re=Gv(u,{pathname:Ee});ql(J||Re!=null,`No routes matched location "${me.pathname}${me.search}${me.hash}" `),ql(Re==null||Re[Re.length-1].route.element!==void 0||Re[Re.length-1].route.Component!==void 0||Re[Re.length-1].route.lazy!==void 0,`Matched leaf route at location "${me.pathname}${me.search}${me.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Ue=gS(Re&&Re.map(He=>Object.assign({},He,{params:Object.assign({},s,He.params),pathname:zc([G,P.encodeLocation?P.encodeLocation(He.pathname).pathname:He.pathname]),pathnameBase:He.pathnameBase==="/"?G:zc([G,P.encodeLocation?P.encodeLocation(He.pathnameBase).pathname:He.pathnameBase])})),j,g,w,E);return p&&Ue?ee.createElement(Df.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...me},navigationType:"POP"}},Ue):Ue}function dS(){let u=bS(),p=sS(u)?`${u.status} ${u.statusText}`:u instanceof Error?u.message:JSON.stringify(u),g=u instanceof Error?u.stack:null,w="rgba(200,200,200, 0.5)",E={padding:"0.5rem",backgroundColor:w},P={padding:"2px 4px",backgroundColor:w},j=null;return console.error("Error handled by React Router default ErrorBoundary:",u),j=ee.createElement(ee.Fragment,null,ee.createElement("p",null,"💿 Hey developer 👋"),ee.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ee.createElement("code",{style:P},"ErrorBoundary")," or"," ",ee.createElement("code",{style:P},"errorElement")," prop on your route.")),ee.createElement(ee.Fragment,null,ee.createElement("h2",null,"Unexpected Application Error!"),ee.createElement("h3",{style:{fontStyle:"italic"}},p),g?ee.createElement("pre",{style:E},g):null,j)}var pS=ee.createElement(dS,null),fS=class extends ee.Component{constructor(u){super(u),this.state={location:u.location,revalidation:u.revalidation,error:u.error}}static getDerivedStateFromError(u){return{error:u}}static getDerivedStateFromProps(u,p){return p.location!==u.location||p.revalidation!=="idle"&&u.revalidation==="idle"?{error:u.error,location:u.location,revalidation:u.revalidation}:{error:u.error!==void 0?u.error:p.error,location:p.location,revalidation:u.revalidation||p.revalidation}}componentDidCatch(u,p){this.props.unstable_onError?this.props.unstable_onError(u,p):console.error("React Router caught the following error during render",u)}render(){return this.state.error!==void 0?ee.createElement(Uc.Provider,{value:this.props.routeContext},ee.createElement(qy.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function mS({routeContext:u,match:p,children:g}){let w=ee.useContext(up);return w&&w.static&&w.staticContext&&(p.route.errorElement||p.route.ErrorBoundary)&&(w.staticContext._deepestRenderedBoundaryId=p.route.id),ee.createElement(Uc.Provider,{value:u},g)}function gS(u,p=[],g=null,w=null,E=null){if(u==null){if(!g)return null;if(g.errors)u=g.matches;else if(p.length===0&&!g.initialized&&g.matches.length>0)u=g.matches;else return null}let P=u,j=g?.errors;if(j!=null){let U=P.findIndex(G=>G.route.id&&j?.[G.route.id]!==void 0);ti(U>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(j).join(",")}`),P=P.slice(0,Math.min(P.length,U+1))}let F=!1,s=-1;if(g)for(let U=0;U<P.length;U++){let G=P[U];if((G.route.HydrateFallback||G.route.hydrateFallbackElement)&&(s=U),G.route.id){let{loaderData:J,errors:Y}=g,me=G.route.loader&&!J.hasOwnProperty(G.route.id)&&(!Y||Y[G.route.id]===void 0);if(G.route.lazy||me){F=!0,s>=0?P=P.slice(0,s+1):P=[P[0]];break}}}return P.reduceRight((U,G,J)=>{let Y,me=!1,Ae=null,Ee=null;g&&(Y=j&&G.route.id?j[G.route.id]:void 0,Ae=G.route.errorElement||pS,F&&(s<0&&J===0?(e1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),me=!0,Ee=null):s===J&&(me=!0,Ee=G.route.hydrateFallbackElement||null)));let Re=p.concat(P.slice(0,J+1)),Ue=()=>{let He;return Y?He=Ae:me?He=Ee:G.route.Component?He=ee.createElement(G.route.Component,null):G.route.element?He=G.route.element:He=U,ee.createElement(mS,{match:G,routeContext:{outlet:U,matches:Re,isDataRoute:g!=null},children:He})};return g&&(G.route.ErrorBoundary||G.route.errorElement||J===0)?ee.createElement(fS,{location:g.location,revalidation:g.revalidation,component:Ae,error:Y,children:Ue(),routeContext:{outlet:null,matches:Re,isDataRoute:!0},unstable_onError:w}):Ue()},null)}function Zy(u){return`${u} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function yS(u){let p=ee.useContext(up);return ti(p,Zy(u)),p}function _S(u){let p=ee.useContext(Km);return ti(p,Zy(u)),p}function xS(u){let p=ee.useContext(Uc);return ti(p,Zy(u)),p}function Hy(u){let p=xS(u),g=p.matches[p.matches.length-1];return ti(g.route.id,`${u} can only be used on routes that contain a unique "id"`),g.route.id}function vS(){return Hy("useRouteId")}function bS(){let u=ee.useContext(qy),p=_S("useRouteError"),g=Hy("useRouteError");return u!==void 0?u:p.errors?.[g]}function wS(){let{router:u}=yS("useNavigate"),p=Hy("useNavigate"),g=ee.useRef(!1);return Jv(()=>{g.current=!0}),ee.useCallback(async(E,P={})=>{ql(g.current,Yv),g.current&&(typeof E=="number"?u.navigate(E):await u.navigate(E,{fromRouteId:p,...P}))},[u,p])}var vx={};function e1(u,p,g){!p&&!vx[u]&&(vx[u]=!0,ql(!1,g))}ee.memo(TS);function TS({routes:u,future:p,state:g,unstable_onError:w}){return Qv(u,void 0,g,w,p)}function ho(u){ti(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function SS({basename:u="/",children:p=null,location:g,navigationType:w="POP",navigator:E,static:P=!1}){ti(!Lf(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let j=u.replace(/^\/*/,"/"),F=ee.useMemo(()=>({basename:j,navigator:E,static:P,future:{}}),[j,E,P]);typeof g=="string"&&(g=cp(g));let{pathname:s="/",search:U="",hash:G="",state:J=null,key:Y="default"}=g,me=ee.useMemo(()=>{let Ae=Nc(s,j);return Ae==null?null:{location:{pathname:Ae,search:U,hash:G,state:J,key:Y},navigationType:w}},[j,s,U,G,J,Y,w]);return ql(me!=null,`<Router basename="${j}"> is not able to match the URL "${s}${U}${G}" because it does not start with the basename, so the <Router> won't render anything.`),me==null?null:ee.createElement(Zl.Provider,{value:F},ee.createElement(Df.Provider,{children:p,value:me}))}function ES({children:u,location:p}){return hS(yy(u),p)}function yy(u,p=[]){let g=[];return ee.Children.forEach(u,(w,E)=>{if(!ee.isValidElement(w))return;let P=[...p,E];if(w.type===ee.Fragment){g.push.apply(g,yy(w.props.children,P));return}ti(w.type===ho,`[${typeof w.type=="string"?w.type:w.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ti(!w.props.index||!w.props.children,"An index route cannot have child routes.");let j={id:w.props.id||P.join("-"),caseSensitive:w.props.caseSensitive,element:w.props.element,Component:w.props.Component,index:w.props.index,path:w.props.path,loader:w.props.loader,action:w.props.action,hydrateFallbackElement:w.props.hydrateFallbackElement,HydrateFallback:w.props.HydrateFallback,errorElement:w.props.errorElement,ErrorBoundary:w.props.ErrorBoundary,hasErrorBoundary:w.props.hasErrorBoundary===!0||w.props.ErrorBoundary!=null||w.props.errorElement!=null,shouldRevalidate:w.props.shouldRevalidate,handle:w.props.handle,lazy:w.props.lazy};w.props.children&&(j.children=yy(w.props.children,P)),g.push(j)}),g}var zm="get",Nm="application/x-www-form-urlencoded";function Ym(u){return u!=null&&typeof u.tagName=="string"}function kS(u){return Ym(u)&&u.tagName.toLowerCase()==="button"}function CS(u){return Ym(u)&&u.tagName.toLowerCase()==="form"}function AS(u){return Ym(u)&&u.tagName.toLowerCase()==="input"}function MS(u){return!!(u.metaKey||u.altKey||u.ctrlKey||u.shiftKey)}function PS(u,p){return u.button===0&&(!p||p==="_self")&&!MS(u)}var Mm=null;function IS(){if(Mm===null)try{new FormData(document.createElement("form"),0),Mm=!1}catch{Mm=!0}return Mm}var DS=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Kg(u){return u!=null&&!DS.has(u)?(ql(!1,`"${u}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Nm}"`),null):u}function LS(u,p){let g,w,E,P,j;if(CS(u)){let F=u.getAttribute("action");w=F?Nc(F,p):null,g=u.getAttribute("method")||zm,E=Kg(u.getAttribute("enctype"))||Nm,P=new FormData(u)}else if(kS(u)||AS(u)&&(u.type==="submit"||u.type==="image")){let F=u.form;if(F==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let s=u.getAttribute("formaction")||F.getAttribute("action");if(w=s?Nc(s,p):null,g=u.getAttribute("formmethod")||F.getAttribute("method")||zm,E=Kg(u.getAttribute("formenctype"))||Kg(F.getAttribute("enctype"))||Nm,P=new FormData(F,u),!IS()){let{name:U,type:G,value:J}=u;if(G==="image"){let Y=U?`${U}.`:"";P.append(`${Y}x`,"0"),P.append(`${Y}y`,"0")}else U&&P.append(U,J)}}else{if(Ym(u))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');g=zm,w=null,E=Nm,j=u}return P&&E==="text/plain"&&(j=P,P=void 0),{action:w,method:g.toLowerCase(),encType:E,formData:P,body:j}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Xy(u,p){if(u===!1||u===null||typeof u>"u")throw new Error(p)}function jS(u,p,g){let w=typeof u=="string"?new URL(u,typeof window>"u"?"server://singlefetch/":window.location.origin):u;return w.pathname==="/"?w.pathname=`_root.${g}`:p&&Nc(w.pathname,p)==="/"?w.pathname=`${p.replace(/\/$/,"")}/_root.${g}`:w.pathname=`${w.pathname.replace(/\/$/,"")}.${g}`,w}async function RS(u,p){if(u.id in p)return p[u.id];try{let g=await import(u.module);return p[u.id]=g,g}catch(g){return console.error(`Error loading route module \`${u.module}\`, reloading page...`),console.error(g),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function zS(u){return u==null?!1:u.href==null?u.rel==="preload"&&typeof u.imageSrcSet=="string"&&typeof u.imageSizes=="string":typeof u.rel=="string"&&typeof u.href=="string"}async function NS(u,p,g){let w=await Promise.all(u.map(async E=>{let P=p.routes[E.route.id];if(P){let j=await RS(P,g);return j.links?j.links():[]}return[]}));return US(w.flat(1).filter(zS).filter(E=>E.rel==="stylesheet"||E.rel==="preload").map(E=>E.rel==="stylesheet"?{...E,rel:"prefetch",as:"style"}:{...E,rel:"prefetch"}))}function bx(u,p,g,w,E,P){let j=(s,U)=>g[U]?s.route.id!==g[U].route.id:!0,F=(s,U)=>g[U].pathname!==s.pathname||g[U].route.path?.endsWith("*")&&g[U].params["*"]!==s.params["*"];return P==="assets"?p.filter((s,U)=>j(s,U)||F(s,U)):P==="data"?p.filter((s,U)=>{let G=w.routes[s.route.id];if(!G||!G.hasLoader)return!1;if(j(s,U)||F(s,U))return!0;if(s.route.shouldRevalidate){let J=s.route.shouldRevalidate({currentUrl:new URL(E.pathname+E.search+E.hash,window.origin),currentParams:g[0]?.params||{},nextUrl:new URL(u,window.origin),nextParams:s.params,defaultShouldRevalidate:!0});if(typeof J=="boolean")return J}return!0}):[]}function BS(u,p,{includeHydrateFallback:g}={}){return FS(u.map(w=>{let E=p.routes[w.route.id];if(!E)return[];let P=[E.module];return E.clientActionModule&&(P=P.concat(E.clientActionModule)),E.clientLoaderModule&&(P=P.concat(E.clientLoaderModule)),g&&E.hydrateFallbackModule&&(P=P.concat(E.hydrateFallbackModule)),E.imports&&(P=P.concat(E.imports)),P}).flat(1))}function FS(u){return[...new Set(u)]}function OS(u){let p={},g=Object.keys(u).sort();for(let w of g)p[w]=u[w];return p}function US(u,p){let g=new Set;return new Set(p),u.reduce((w,E)=>{let P=JSON.stringify(OS(E));return g.has(P)||(g.add(P),w.push({key:P,link:E})),w},[])}function t1(){let u=ee.useContext(up);return Xy(u,"You must render this element inside a <DataRouterContext.Provider> element"),u}function VS(){let u=ee.useContext(Km);return Xy(u,"You must render this element inside a <DataRouterStateContext.Provider> element"),u}var Ky=ee.createContext(void 0);Ky.displayName="FrameworkContext";function r1(){let u=ee.useContext(Ky);return Xy(u,"You must render this element inside a <HydratedRouter> element"),u}function $S(u,p){let g=ee.useContext(Ky),[w,E]=ee.useState(!1),[P,j]=ee.useState(!1),{onFocus:F,onBlur:s,onMouseEnter:U,onMouseLeave:G,onTouchStart:J}=p,Y=ee.useRef(null);ee.useEffect(()=>{if(u==="render"&&j(!0),u==="viewport"){let Ee=Ue=>{Ue.forEach(He=>{j(He.isIntersecting)})},Re=new IntersectionObserver(Ee,{threshold:.5});return Y.current&&Re.observe(Y.current),()=>{Re.disconnect()}}},[u]),ee.useEffect(()=>{if(w){let Ee=setTimeout(()=>{j(!0)},100);return()=>{clearTimeout(Ee)}}},[w]);let me=()=>{E(!0)},Ae=()=>{E(!1),j(!1)};return g?u!=="intent"?[P,Y,{}]:[P,Y,{onFocus:pf(F,me),onBlur:pf(s,Ae),onMouseEnter:pf(U,me),onMouseLeave:pf(G,Ae),onTouchStart:pf(J,me)}]:[!1,Y,{}]}function pf(u,p){return g=>{u&&u(g),g.defaultPrevented||p(g)}}function GS({page:u,...p}){let{router:g}=t1(),w=ee.useMemo(()=>Gv(g.routes,u,g.basename),[g.routes,u,g.basename]);return w?ee.createElement(qS,{page:u,matches:w,...p}):null}function WS(u){let{manifest:p,routeModules:g}=r1(),[w,E]=ee.useState([]);return ee.useEffect(()=>{let P=!1;return NS(u,p,g).then(j=>{P||E(j)}),()=>{P=!0}},[u,p,g]),w}function qS({page:u,matches:p,...g}){let w=Nu(),{manifest:E,routeModules:P}=r1(),{basename:j}=t1(),{loaderData:F,matches:s}=VS(),U=ee.useMemo(()=>bx(u,p,s,E,w,"data"),[u,p,s,E,w]),G=ee.useMemo(()=>bx(u,p,s,E,w,"assets"),[u,p,s,E,w]),J=ee.useMemo(()=>{if(u===w.pathname+w.search+w.hash)return[];let Ae=new Set,Ee=!1;if(p.forEach(Ue=>{let He=E.routes[Ue.route.id];!He||!He.hasLoader||(!U.some(Me=>Me.route.id===Ue.route.id)&&Ue.route.id in F&&P[Ue.route.id]?.shouldRevalidate||He.hasClientLoader?Ee=!0:Ae.add(Ue.route.id))}),Ae.size===0)return[];let Re=jS(u,j,"data");return Ee&&Ae.size>0&&Re.searchParams.set("_routes",p.filter(Ue=>Ae.has(Ue.route.id)).map(Ue=>Ue.route.id).join(",")),[Re.pathname+Re.search]},[j,F,w,E,U,p,u,P]),Y=ee.useMemo(()=>BS(G,E),[G,E]),me=WS(G);return ee.createElement(ee.Fragment,null,J.map(Ae=>ee.createElement("link",{key:Ae,rel:"prefetch",as:"fetch",href:Ae,...g})),Y.map(Ae=>ee.createElement("link",{key:Ae,rel:"modulepreload",href:Ae,...g})),me.map(({key:Ae,link:Ee})=>ee.createElement("link",{key:Ae,nonce:g.nonce,...Ee})))}function ZS(...u){return p=>{u.forEach(g=>{typeof g=="function"?g(p):g!=null&&(g.current=p)})}}var n1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{n1&&(window.__reactRouterVersion="7.8.2")}catch{}function HS({basename:u,children:p,window:g}){let w=ee.useRef();w.current==null&&(w.current=zT({window:g,v5Compat:!0}));let E=w.current,[P,j]=ee.useState({action:E.action,location:E.location}),F=ee.useCallback(s=>{ee.startTransition(()=>j(s))},[j]);return ee.useLayoutEffect(()=>E.listen(F),[E,F]),ee.createElement(SS,{basename:u,children:p,location:P.location,navigationType:P.action,navigator:E})}var i1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,s1=ee.forwardRef(function({onClick:p,discover:g="render",prefetch:w="none",relative:E,reloadDocument:P,replace:j,state:F,target:s,to:U,preventScrollReset:G,viewTransition:J,...Y},me){let{basename:Ae}=ee.useContext(Zl),Ee=typeof U=="string"&&i1.test(U),Re,Ue=!1;if(typeof U=="string"&&Ee&&(Re=U,n1))try{let it=new URL(window.location.href),De=U.startsWith("//")?new URL(it.protocol+U):new URL(U),$t=Nc(De.pathname,Ae);De.origin===it.origin&&$t!=null?U=$t+De.search+De.hash:Ue=!0}catch{ql(!1,`<Link to="${U}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let He=cS(U,{relative:E}),[Me,lt,kt]=$S(w,Y),$e=YS(U,{replace:j,state:F,target:s,preventScrollReset:G,relative:E,viewTransition:J});function Ye(it){p&&p(it),it.defaultPrevented||$e(it)}let tt=ee.createElement("a",{...Y,...kt,href:Re||He,onClick:Ue||P?p:Ye,ref:ZS(me,lt),target:s,"data-discover":!Ee&&g==="render"?"true":void 0});return Me&&!Ee?ee.createElement(ee.Fragment,null,tt,ee.createElement(GS,{page:He})):tt});s1.displayName="Link";var o1=ee.forwardRef(function({"aria-current":p="page",caseSensitive:g=!1,className:w="",end:E=!1,style:P,to:j,viewTransition:F,children:s,...U},G){let J=Rf(j,{relative:U.relative}),Y=Nu(),me=ee.useContext(Km),{navigator:Ae,basename:Ee}=ee.useContext(Zl),Re=me!=null&&rE(J)&&F===!0,Ue=Ae.encodeLocation?Ae.encodeLocation(J).pathname:J.pathname,He=Y.pathname,Me=me&&me.navigation&&me.navigation.location?me.navigation.location.pathname:null;g||(He=He.toLowerCase(),Me=Me?Me.toLowerCase():null,Ue=Ue.toLowerCase()),Me&&Ee&&(Me=Nc(Me,Ee)||Me);const lt=Ue!=="/"&&Ue.endsWith("/")?Ue.length-1:Ue.length;let kt=He===Ue||!E&&He.startsWith(Ue)&&He.charAt(lt)==="/",$e=Me!=null&&(Me===Ue||!E&&Me.startsWith(Ue)&&Me.charAt(Ue.length)==="/"),Ye={isActive:kt,isPending:$e,isTransitioning:Re},tt=kt?p:void 0,it;typeof w=="function"?it=w(Ye):it=[w,kt?"active":null,$e?"pending":null,Re?"transitioning":null].filter(Boolean).join(" ");let De=typeof P=="function"?P(Ye):P;return ee.createElement(s1,{...U,"aria-current":tt,className:it,ref:G,style:De,to:j,viewTransition:F},typeof s=="function"?s(Ye):s)});o1.displayName="NavLink";var XS=ee.forwardRef(({discover:u="render",fetcherKey:p,navigate:g,reloadDocument:w,replace:E,state:P,method:j=zm,action:F,onSubmit:s,relative:U,preventScrollReset:G,viewTransition:J,...Y},me)=>{let Ae=eE(),Ee=tE(F,{relative:U}),Re=j.toLowerCase()==="get"?"get":"post",Ue=typeof F=="string"&&i1.test(F),He=Me=>{if(s&&s(Me),Me.defaultPrevented)return;Me.preventDefault();let lt=Me.nativeEvent.submitter,kt=lt?.getAttribute("formmethod")||j;Ae(lt||Me.currentTarget,{fetcherKey:p,method:kt,navigate:g,replace:E,state:P,relative:U,preventScrollReset:G,viewTransition:J})};return ee.createElement("form",{ref:me,method:Re,action:Ee,onSubmit:w?s:He,...Y,"data-discover":!Ue&&u==="render"?"true":void 0})});XS.displayName="Form";function KS(u){return`${u} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function a1(u){let p=ee.useContext(up);return ti(p,KS(u)),p}function YS(u,{target:p,replace:g,state:w,preventScrollReset:E,relative:P,viewTransition:j}={}){let F=jf(),s=Nu(),U=Rf(u,{relative:P});return ee.useCallback(G=>{if(PS(G,p)){G.preventDefault();let J=g!==void 0?g:wf(s)===wf(U);F(u,{replace:J,state:w,preventScrollReset:E,relative:P,viewTransition:j})}},[s,F,U,g,w,p,u,E,P,j])}var JS=0,QS=()=>`__${String(++JS)}__`;function eE(){let{router:u}=a1("useSubmit"),{basename:p}=ee.useContext(Zl),g=vS();return ee.useCallback(async(w,E={})=>{let{action:P,method:j,encType:F,formData:s,body:U}=LS(w,p);if(E.navigate===!1){let G=E.fetcherKey||QS();await u.fetch(G,g,E.action||P,{preventScrollReset:E.preventScrollReset,formData:s,body:U,formMethod:E.method||j,formEncType:E.encType||F,flushSync:E.flushSync})}else await u.navigate(E.action||P,{preventScrollReset:E.preventScrollReset,formData:s,body:U,formMethod:E.method||j,formEncType:E.encType||F,replace:E.replace,state:E.state,fromRouteId:g,flushSync:E.flushSync,viewTransition:E.viewTransition})},[u,p,g])}function tE(u,{relative:p}={}){let{basename:g}=ee.useContext(Zl),w=ee.useContext(Uc);ti(w,"useFormAction must be used inside a RouteContext");let[E]=w.matches.slice(-1),P={...Rf(u||".",{relative:p})},j=Nu();if(u==null){P.search=j.search;let F=new URLSearchParams(P.search),s=F.getAll("index");if(s.some(G=>G==="")){F.delete("index"),s.filter(J=>J).forEach(J=>F.append("index",J));let G=F.toString();P.search=G?`?${G}`:""}}return(!u||u===".")&&E.route.index&&(P.search=P.search?P.search.replace(/^\?/,"?index&"):"?index"),g!=="/"&&(P.pathname=P.pathname==="/"?g:zc([g,P.pathname])),wf(P)}function rE(u,{relative:p}={}){let g=ee.useContext(Kv);ti(g!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:w}=a1("useViewTransitionState"),E=Rf(u,{relative:p});if(!g.isTransitioning)return!1;let P=Nc(g.currentLocation.pathname,w)||g.currentLocation.pathname,j=Nc(g.nextLocation.pathname,w)||g.nextLocation.pathname;return $m(E.pathname,j)!=null||$m(E.pathname,P)!=null}var l1=$v();/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nE=u=>u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),c1=(...u)=>u.filter((p,g,w)=>!!p&&p.trim()!==""&&w.indexOf(p)===g).join(" ").trim();/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var iE={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sE=ee.forwardRef(({color:u="currentColor",size:p=24,strokeWidth:g=2,absoluteStrokeWidth:w,className:E="",children:P,iconNode:j,...F},s)=>ee.createElement("svg",{ref:s,...iE,width:p,height:p,stroke:u,strokeWidth:w?Number(g)*24/Number(p):g,className:c1("lucide",E),...F},[...j.map(([U,G])=>ee.createElement(U,G)),...Array.isArray(P)?P:[P]]));/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=(u,p)=>{const g=ee.forwardRef(({className:w,...E},P)=>ee.createElement(sE,{ref:P,iconNode:p,className:c1(`lucide-${nE(u)}`,w),...E}));return g.displayName=`${u}`,g};/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oE=lr("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aE=lr("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lE=lr("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cE=lr("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tf=lr("Bus",[["path",{d:"M8 6v6",key:"18i7km"}],["path",{d:"M15 6v6",key:"1sg6z9"}],["path",{d:"M2 12h19.6",key:"de5uta"}],["path",{d:"M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.4-.1-.8-.2-1.2l-1.4-5C20.1 6.8 19.1 6 18 6H4a2 2 0 0 0-2 2v10h3",key:"1wwztk"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M9 18h5",key:"lrx6i"}],["circle",{cx:"16",cy:"18",r:"2",key:"1v4tcr"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uE=lr("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hE=lr("CarFront",[["path",{d:"m21 8-2 2-1.5-3.7A2 2 0 0 0 15.646 5H8.4a2 2 0 0 0-1.903 1.257L5 10 3 8",key:"1imjwt"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 14h.01",key:"7oqj8z"}],["rect",{width:"18",height:"8",x:"3",y:"10",rx:"2",key:"a7itu8"}],["path",{d:"M5 18v2",key:"ppbyun"}],["path",{d:"M19 18v2",key:"gy7782"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dE=lr("ChartNoAxesColumn",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pE=lr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _y=lr("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xy=lr("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fE=lr("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bc=lr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mE=lr("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gE=lr("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yE=lr("Construction",[["rect",{x:"2",y:"6",width:"20",height:"8",rx:"1",key:"1estib"}],["path",{d:"M17 14v7",key:"7m2elx"}],["path",{d:"M7 14v7",key:"1cm7wv"}],["path",{d:"M17 3v3",key:"1v4jwn"}],["path",{d:"M7 3v3",key:"7o6guu"}],["path",{d:"M10 14 2.3 6.3",key:"1023jk"}],["path",{d:"m14 6 7.7 7.7",key:"1s8pl2"}],["path",{d:"m8 6 8 8",key:"hl96qh"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _E=lr("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u1=lr("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h1=lr("Footprints",[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xE=lr("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vE=lr("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bE=lr("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wE=lr("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d1=lr("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p1=lr("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TE=lr("Languages",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yg=lr("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wx=lr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SE=lr("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f1=lr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EE=lr("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bo=lr("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yy=lr("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kE=lr("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tx=lr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CE=lr("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jm=lr("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m1=lr("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g1=lr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sf=lr("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y1=lr("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ef=lr("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vy=lr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const by=lr("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AE=lr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ME=lr("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PE=lr("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wy=lr("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IE=lr("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sx=lr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zf=lr("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DE=lr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const op=lr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LE=lr("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jE=lr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _1=lr("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);class RE extends Vv.Component{constructor(p){super(p),this.state={hasError:!1,error:null}}static getDerivedStateFromError(p){return{hasError:!0,error:p}}componentDidCatch(p,g){console.error("Transit App Error:",p,g)}render(){return this.state.hasError?v.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:v.jsxs("div",{className:"max-w-md w-full glass-effect rounded-xl p-6 text-center",children:[v.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center",children:v.jsx(zf,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),v.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Something went wrong"}),v.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"We're having trouble loading the transit data. Please try refreshing the page."}),v.jsxs("button",{onClick:()=>window.location.reload(),className:"btn-primary inline-flex items-center space-x-2",children:[v.jsx(Sf,{className:"w-4 h-4"}),v.jsx("span",{children:"Refresh Page"})]})]})}):this.props.children}}var Bm={exports:{}},zE=Bm.exports,Ex;function NE(){return Ex||(Ex=1,(function(u,p){var g={ALLUSERSPROFILE:"C:\\ProgramData",APPDATA:"C:\\Users\\DK\\AppData\\Roaming",ChocolateyInstall:"C:\\ProgramData\\chocolatey",ChocolateyLastPathUpdate:"134009603195713645",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\crashpad_26152_KMQVOLCUWIWRQUQA",COLOR:"1",COLORTERM:"truecolor",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"DESKTOP-GKT5TG1",ComSpec:"C:\\WINDOWS\\system32\\cmd.exe",CURL_CA_BUNDLE:"C:\\Program Files\\PostgreSQL\\17\\ssl\\certs\\ca-bundle.crt",CURSOR_TRACE_ID:"43a261425b304ec2a18c5563efcda905",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EDITOR:"C:\\WINDOWS\\notepad.exe",EFC_11596_1262719628:"1",EFC_11596_1592913036:"1",EFC_11596_2283032206:"1",EFC_11596_2775293581:"1",EFC_11596_3789132940:"1",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GDAL_DATA:"C:\\Program Files\\PostgreSQL\\17\\gdal-data",GIT_ASKPASS:"c:\\Users\\DK\\AppData\\Local\\Programs\\cursor\\resources\\app\\extensions\\git\\dist\\askpass.sh",HOME:"C:\\Users\\DK",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\DK",IGCCSVC_DB:"AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAA91WVuDPDmk+kgwcxL/CSmwQAAAACAAAAAAAQZgAAAAEAACAAAABf9GYnmTfhdV0P3u95zORhisnCpjH240/TlBGeInLgygAAAAAOgAAAAAIAACAAAABjZCZjCeCOmIpvBJkyJh8QmCm7VuqZ5b78lJUJSGtV1GAAAAAv3IIqG/iIK0zRuglW41eS5aHT8TH0ijVRg70hVeI7gUfflHQj0wlDlS31se30pdUf8uldMeJAiV+K9ExHg6El0J2GMwuW4Ufy3PqCrv5OD3IEhyvcaXfpSRRLWbOaZPJAAAAAd+y2NK8MnoTZiOGMGi0RnMisEEs/DZPqXd68qTmm6htOEyeTPLJHWpZ7iWx21v/l4t0FagkC93FNe4alD1W2yA==",INIT_CWD:"C:\\AddisTransit","IntelliJ IDEA":"C:\\Program Files\\JetBrains\\IntelliJ IDEA 2024.2\\bin;","IntelliJ IDEA Community Edition":"C:\\Program Files\\JetBrains\\IntelliJ IDEA Community Edition 2024.2.0.1\\bin;",INTEL_DEV_REDIST:"C:\\Program Files (x86)\\Common Files\\Intel\\Shared Libraries\\",Java:"C:\\Program Files\\Java\\jdk-15.0.1",LANG:"en_US.UTF-8",LOCALAPPDATA:"C:\\Users\\DK\\AppData\\Local",LOGONSERVER:"\\\\DESKTOP-GKT5TG1",MIC_LD_LIBRARY_PATH:"C:\\Program Files (x86)\\Common Files\\Intel\\Shared Libraries\\compiler\\lib\\mic",NODE:"C:\\Program Files\\nodejs\\node.exe",NODE_ENV:"production",NODE_EXE:"C:\\Program Files\\nodejs\\\\node.exe",NPM_CLI_JS:"C:\\Program Files\\nodejs\\\\node_modules\\npm\\bin\\npm-cli.js",npm_command:"run-script",npm_config_cache:"C:\\Users\\DK\\AppData\\Local\\npm-cache",npm_config_globalconfig:"C:\\Users\\DK\\AppData\\Roaming\\npm\\etc\\npmrc",npm_config_global_prefix:"C:\\Users\\DK\\AppData\\Roaming\\npm",npm_config_init_module:"C:\\Users\\DK\\.npm-init.js",npm_config_local_prefix:"C:\\AddisTransit",npm_config_node_gyp:"C:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js",npm_config_noproxy:"",npm_config_npm_version:"10.8.2",npm_config_prefix:"C:\\Users\\DK\\AppData\\Roaming\\npm",npm_config_userconfig:"C:\\Users\\DK\\.npmrc",npm_config_user_agent:"npm/10.8.2 node/v20.19.4 win32 x64 workspaces/false",npm_execpath:"C:\\Program Files\\nodejs\\node_modules\\npm\\bin\\npm-cli.js",npm_lifecycle_event:"build",npm_lifecycle_script:"vite build",npm_node_execpath:"C:\\Program Files\\nodejs\\node.exe",npm_package_json:"C:\\AddisTransit\\package.json",npm_package_name:"my-v0-project",npm_package_version:"0.1.0",NPM_PREFIX_JS:"C:\\Program Files\\nodejs\\\\node_modules\\npm\\bin\\npm-prefix.js",NPM_PREFIX_NPM_CLI_JS:"C:\\Users\\DK\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npm-cli.js",NUMBER_OF_PROCESSORS:"8",OneDrive:"C:\\Users\\DK\\OneDrive",OPENSSL_CONF:"C:\\Program Files\\PostgreSQL\\psqlODBC\\etc\\openssl.cnf",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",Path:"C:\\AddisTransit\\node_modules\\.bin;C:\\node_modules\\.bin;C:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Program Files\\PowerShell\\7;C:\\Python313\\Scripts\\;C:\\Python313\\;C:\\Program Files (x86)\\Common Files\\Intel\\Shared Libraries\\redist\\intel64\\compiler;C:\\Users\\DK\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\python\\Scripts\\;C:\\Users\\DK\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\python\\;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Program Files\\dotnet\\;C:\\Program Files\\PostgreSQL\\16\\bin;C:\\Program Files\\PostgreSQL\\16\\lib;C:\\xampp\\php;C:\\Python;C:\\ProgramData\\ComposerSetup\\bin;C:\\Program Files\\OpenSSL-Win64\\bin;C:\\Program Files\\Git\\cmd;C:\\Program Files\\Git\\mingw64\\bin;C:\\Program Files\\Git\\usr\\bin;C:\\Program Files\\nodejs\\;C:\\ProgramData\\chocolatey\\bin;C:\\Program Files\\PowerShell\\7\\;c:\\Users\\DK\\AppData\\Local\\Programs\\cursor\\resources\\app\\codeBin;C:\\Users\\DK\\AppData\\Local\\Programs\\Python\\Python312\\Scripts\\;C:\\Users\\DK\\AppData\\Local\\Programs\\Python\\Python312\\;C:\\Users\\DK\\AppData\\Local\\Programs\\Python\\Python311\\Scripts\\;C:\\Users\\DK\\AppData\\Local\\Programs\\Python\\Python311\\;C:\\Program Files\\MySQL\\MySQL Shell 8.0\\bin\\;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\Program Files\\Python311\\Scripts\\;C:\\Program Files\\Python311\\;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Program Files\\dotnet\\;C:\\Users\\DK\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\DK\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Program Files\\nodejs;C:\\Program Files\\JetBrains\\PyCharm 2024.1.1\\bin;;C:\\Users\\DK\\AppData\\Local\\JetBrains\\PyCharm Community Edition 2024.1.1\\bin;;C:\\Users\\DK\\AppData\\Roaming\\Composer\\vendor\\bin;C:\\Program Files\\JetBrains\\IntelliJ IDEA 2024.2\\bin;;C:\\Program Files\\JetBrains\\IntelliJ IDEA Community Edition 2024.2.0.1\\bin;;C:\\Users\\DK\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\DK\\AppData\\Local\\GitHubDesktop\\bin;C:\\Users\\DK\\AppData\\Roaming\\npm;C:\\Users\\DK\\AppData\\Local\\Programs\\cursor\\resources\\app\\bin",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.PY;.PYW;.CPL",POSTGIS_ENABLE_OUTDB_RASTERS:"1",POSTGIS_GDAL_ENABLED_DRIVERS:"GTiff PNG JPEG GIF XYZ DTED USGSDEM AAIGrid",POWERSHELL_DISTRIBUTION_CHANNEL:"MSI:Windows 10 Home",POWERSHELL_TELEMETRY_OPTOUT:"1",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 140 Stepping 2, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"8c02",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROJ_LIB:"C:\\Program Files\\PostgreSQL\\17\\share\\contrib\\postgis-3.5\\proj",PROMPT:"$P$G",PSModulePath:"C:\\Users\\DK\\OneDrive\\Documents\\PowerShell\\Modules;C:\\Program Files\\PowerShell\\Modules;c:\\program files\\powershell\\7\\Modules;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",PyCharm:"C:\\Program Files\\JetBrains\\PyCharm 2024.1.1\\bin;","PyCharm Community Edition":"C:\\Users\\DK\\AppData\\Local\\JetBrains\\PyCharm Community Edition 2024.1.1\\bin;","Pyhton 3.12.2":"C:\\Users\\DK\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python312\\Scripts",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\WINDOWS",TEMP:"C:\\Users\\DK\\AppData\\Local\\Temp",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"1.5.11",TMP:"C:\\Users\\DK\\AppData\\Local\\Temp",USERDOMAIN:"DESKTOP-GKT5TG1",USERDOMAIN_ROAMINGPROFILE:"DESKTOP-GKT5TG1",USERNAME:"DK",USERPROFILE:"C:\\Users\\DK",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\DK\\AppData\\Local\\Programs\\cursor\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\DK\\AppData\\Local\\Programs\\cursor\\Cursor.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-30b0400085-sock",VSCODE_INJECTION:"1",windir:"C:\\WINDOWS",ZES_ENABLE_SYSMAN:"1"};(function(w,E){u.exports=E()})(zE,(function(){var w,E,P;function j(s,U){if(!w)w=U;else if(!E)E=U;else{var G="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+w+")(sharedChunk); ("+E+")(sharedChunk); self.onerror = null;",J={};w(J),P=U(J),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(P.workerUrl=window.URL.createObjectURL(new Blob([G],{type:"text/javascript"})))}}j(["exports"],(function(s){var U=typeof self<"u"?self:{},G="2.15.0";let J;const Y={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(J==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{J=g.API_URL_REGEX!=null?new RegExp(g.API_URL_REGEX):t}catch{J=t}}return J},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Y.API_URL)return null;try{const t=new URL(Y.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},me={supported:!1,testSupport:function(t){!Re&&Ee&&(Ue?He(t):Ae=t)}};let Ae,Ee,Re=!1,Ue=!1;function He(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Ee),t.isContextLost())return;me.supported=!0}catch{}t.deleteTexture(e),Re=!0}U.document&&(Ee=U.document.createElement("img"),Ee.onload=function(){Ae&&He(Ae),Ae=null,Ue=!0},Ee.onerror=function(){Re=!0,Ae=null},Ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Me="01";function lt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var kt=$e;function $e(t,e,r,i){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=r,this.p2y=i}$e.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var r=t,i=0;i<8;i++){var l=this.sampleCurveX(r)-t;if(Math.abs(l)<e)return r;var d=this.sampleCurveDerivativeX(r);if(Math.abs(d)<1e-6)break;r-=l/d}var m=0,x=1;for(r=t,i=0;i<20&&(l=this.sampleCurveX(r),!(Math.abs(l-t)<e));i++)t>l?m=r:x=r,r=.5*(x-m)+m;return r},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Ye=lt(kt),tt=it;function it(t,e){this.x=t,this.y=e}it.prototype={clone:function(){return new it(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=i,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),l=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-i*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},it.convert=function(t){return t instanceof it?t:Array.isArray(t)?new it(t[0],t[1]):t};var De=lt(tt);const $t=Math.PI/180,ut=180/Math.PI;function vt(t){return t*$t}function nr(t){return t*ut}const Jr=[[0,0],[1,0],[1,1],[0,1]];function ir(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function cr(t,e,r,i){const l=new Ye(t,e,r,i);return function(d){return l.solve(d)}}const St=cr(.25,.1,.25,1);function Fe(t,e,r){return Math.min(r,Math.max(e,t))}function _t(t,e,r){return(r=Fe((r-t)/(e-t),0,1))*r*(3-2*r)}function Te(t,e,r){const i=r-e,l=((t-e)%i+i)%i+e;return l===e?r:l}function st(t,e,r){if(!t.length)return r(null,[]);let i=t.length;const l=new Array(t.length);let d=null;t.forEach(((m,x)=>{e(m,((T,S)=>{T&&(d=T),l[x]=S,--i==0&&r(d,l)}))}))}function Gt(t){const e=[];for(const r in t)e.push(t[r]);return e}function Ot(t,...e){for(const r of e)for(const i in r)t[i]=r[i];return t}let xr=1;function sr(){return xr++}function Ur(){return(function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)})()}function jr(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Qr(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Ln(t,e){t.forEach((r=>{e[r]&&(e[r]=e[r].bind(e))}))}function Hi(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Cr(t,e,r){const i={};for(const l in t)i[l]=e.call(this,t[l],l,t);return i}function us(t,e,r){const i={};for(const l in t)e.call(r||this,t[l],l,t)&&(i[l]=t[l]);return i}function di(t){return Array.isArray(t)?t.map(di):typeof t=="object"&&t?Cr(t,di):t}const Fo={};function nn(t){Fo[t]||(typeof console<"u"&&console.warn(t),Fo[t]=!0)}function yi(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function Mt(t){let e=0;for(let r,i,l=0,d=t.length,m=d-1;l<d;m=l++)r=t[l],i=t[m],e+=(i.x-r.x)*(r.y+i.y);return e}function vr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Mr(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,i,l,d)=>{const m=l||d;return e[i]=!m||m.toLowerCase(),""})),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Wt=null;function Fn(t){if(Wt==null){const e=t.navigator?t.navigator.userAgent:null;Wt=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Wt}function hs(t){try{const e=U[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ci(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const Zn="mapbox-tiles";let On=500,Ha=50,Ai,mo;function go(){try{return U.caches}catch{}}function Is(){go()&&!Ai&&(Ai=U.caches.open(Zn))}function Xa(t){const e=t.indexOf("?");if(e<0)return t;const r=(function(l){const d=l.indexOf("?");return d>0?l.slice(d+1).split("&"):[]})(t),i=r.filter((l=>{const d=l.split("=");return d[0]==="language"||d[0]==="worldview"}));return i.length?`${t.slice(0,e)}?${i.join("&")}`:t.slice(0,e)}let Ka=1/0;const Oo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Oo);class Uo extends Error{constructor(e,r,i){r===401&&ze(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const yo=vr()?()=>self.worker&&self.worker.referrer:()=>(U.location.protocol==="blob:"?U.parent:U).location.href,_o=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(yo())&&!/^\w+:/.test(r))){if(U.fetch&&U.Request&&U.AbortController&&U.Request.prototype.hasOwnProperty("signal"))return(function(i,l){const d=new U.AbortController,m=new U.Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:yo(),referrerPolicy:i.referrerPolicy,signal:d.signal});let x=!1,T=!1;const S=(M=m.url).indexOf("sku=")>0&&ze(M);var M;i.type==="json"&&m.headers.set("Accept","application/json");const L=(O,V,q)=>{if(T)return;if(O&&O.message!=="SecurityError"&&nn(O.toString()),V&&q)return R(V);const Q=Date.now();U.fetch(m).then((oe=>{if(oe.ok){const pe=S?oe.clone():null;return R(oe,pe,Q)}return l(new Uo(oe.statusText,oe.status,i.url))})).catch((oe=>{oe.name!=="AbortError"&&l(new Error(`${oe.message} ${i.url}`))}))},R=(O,V,q)=>{(i.type==="arrayBuffer"?O.arrayBuffer():i.type==="json"?O.json():O.text()).then((Q=>{T||(V&&q&&(function(oe,pe,ae){if(Is(),!Ai)return;const de={status:pe.status,statusText:pe.statusText,headers:new U.Headers};pe.headers.forEach(((Ge,Ne)=>de.headers.set(Ne,Ge)));const ye=Mr(pe.headers.get("Cache-Control")||"");if(ye["no-store"])return;ye["max-age"]&&de.headers.set("Expires",new Date(ae+1e3*ye["max-age"]).toUTCString());const ge=de.headers.get("Expires");ge&&(new Date(ge).getTime()-ae<42e4||(function(Ge,Ne){if(mo===void 0)try{new Response(new ReadableStream),mo=!0}catch{mo=!1}mo?Ne(Ge.body):Ge.blob().then(Ne)})(pe,(Ge=>{const Ne=new U.Response(Ge,de);Is(),Ai&&Ai.then((nt=>nt.put(Xa(oe.url),Ne))).catch((nt=>nn(nt.message)))})))})(m,V,q),x=!0,l(null,Q,O.headers.get("Cache-Control"),O.headers.get("Expires")))})).catch((Q=>{T||l(new Error(Q.message))}))};return S?(function(O,V){if(Is(),!Ai)return V(null);const q=Xa(O.url);Ai.then((Q=>{Q.match(q).then((oe=>{const pe=(function(ae){if(!ae)return!1;const de=new Date(ae.headers.get("Expires")||0),ye=Mr(ae.headers.get("Cache-Control")||"");return de>Date.now()&&!ye["no-cache"]})(oe);Q.delete(q),pe&&Q.put(q,oe.clone()),V(null,oe,pe)})).catch(V)})).catch(V)})(m,L):L(null,null),{cancel:()=>{T=!0,x||d.abort()}}})(t,e);if(vr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return(function(i,l){const d=new U.XMLHttpRequest;d.open(i.method||"GET",i.url,!0),i.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const m in i.headers)d.setRequestHeader(m,i.headers[m]);return i.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=i.credentials==="include",d.onerror=()=>{l(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let m=d.response;if(i.type==="json")try{m=JSON.parse(d.response)}catch(x){return l(x)}l(null,m,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else l(new Uo(d.statusText,d.status,i.url))},d.send(i.body),{cancel:()=>d.abort()}})(t,e)},Vo=function(t,e){return _o(Ot(t,{type:"arrayBuffer"}),e)};function Ya(t){const e=U.document.createElement("a");return e.href=t,e.protocol===U.document.location.protocol&&e.host===U.document.location.host}const he="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Z,H;Z=[],H=0;const ue=function(t,e){if(me.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),H>=Y.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Z.push(d),d}H++;let r=!1;const i=()=>{if(!r)for(r=!0,H--;Z.length&&H<Y.MAX_PARALLEL_IMAGE_REQUESTS;){const d=Z.shift(),{requestParameters:m,callback:x,cancelled:T}=d;T||(d.cancel=ue(m,x).cancel)}},l=Vo(t,((d,m,x,T)=>{i(),d?e(d):m&&(U.createImageBitmap?(function(S,M){const L=new U.Blob([new Uint8Array(S)],{type:"image/png"});U.createImageBitmap(L).then((R=>{M(null,R)})).catch((R=>{M(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(m,((S,M)=>e(S,M,x,T))):(function(S,M){const L=new U.Image,R=U.URL;L.onload=()=>{M(null,L),R.revokeObjectURL(L.src),L.onload=null,U.requestAnimationFrame((()=>{L.src=he}))},L.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const O=new U.Blob([new Uint8Array(S)],{type:"image/png"});L.src=S.byteLength?R.createObjectURL(O):he})(m,((S,M)=>e(S,M,x,T))))}));return{cancel:()=>{l.cancel(),i()}}},_e="NO_ACCESS_TOKEN";function Se(t){return t.indexOf("mapbox:")===0}function ze(t){return Y.API_URL_REGEX.test(t)}function Le(t){return Y.API_CDN_URL_REGEX.test(t)}function we(t){return Y.API_STYLE_REGEX.test(t)&&!qe(t)}function qe(t){return Y.API_SPRITE_REGEX.test(t)}const xt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ct(t){const e=t.match(xt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function mt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const hr="mapbox.eventData";function dr(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(U.atob(e[1]).split("").map((r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch{return null}}class ur{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=dr(Y.ACCESS_TOKEN);let i="";return i=r&&r.u?U.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,((l,d)=>String.fromCharCode(+("0x"+d))))):Y.ACCESS_TOKEN||"",e?`${hr}.${e}:${i}`:`${hr}:${i}`}fetchEventData(){const e=hs("localStorage"),r=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{const l=U.localStorage.getItem(r);l&&(this.eventData=JSON.parse(l));const d=U.localStorage.getItem(i);d&&(this.anonId=d)}catch{nn("Unable to read from LocalStorage")}}saveEventData(){const e=hs("localStorage"),r=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{U.localStorage.setItem(i,this.anonId),Object.keys(this.eventData).length>=1&&U.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{nn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,i,l){if(!Y.EVENTS_URL)return;const d=Ct(Y.EVENTS_URL);d.params.push(`access_token=${l||Y.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString()},x=r?Ot(m,r):m,T={url:mt(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=(function(S,M){return _o(Ot(S,{method:"POST"}),M)})(T,(S=>{this.pendingRequest=null,i(S),this.saveEventData(),this.processRequests(l)}))}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const fr=new class extends ur{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Y.EVENTS_URL&&Y.ACCESS_TOKEN&&Array.isArray(t)&&t.some((r=>Se(r)||ze(r)))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=dr(Y.ACCESS_TOKEN),r=e?e.u:Y.ACCESS_TOKEN;let i=r!==this.eventData.tokenU;Qr(this.anonId)||(this.anonId=Ur(),i=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),m=new Date(l),x=(l-this.eventData.lastSuccess)/864e5;i=i||x>=1||x<-1||d.getDate()!==m.getDate()}else i=!0;i?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:Me,"enabled.telemetry":!1,userId:this.anonId},(d=>{d||(this.eventData.lastSuccess=l,this.eventData.tokenU=r)}),t):this.processRequests()}},Pr=fr.postTurnstileEvent.bind(fr),_n=new class extends ur{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,i){this.skuToken=e,this.errorCb=i,Y.EVENTS_URL&&(r||Y.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(_e)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Qr(this.anonId)||(this.anonId=Ur()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:Me,skuToken:this.skuToken,userId:this.anonId},(i=>{i?this.errorCb(i):e&&(this.success[e]=!0)}),t))}},jn=_n.postMapLoadEvent.bind(_n),_i=new class extends ur{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Y.EVENTS_URL&&(t||Y.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:r}=this.queue.shift(),i=(function(l){const d=U.performance.getEntriesByType("resource"),m=U.performance.getEntriesByType("mark"),x=(function(R){const O={};if(R){for(const V in R)if(V!=="other")for(const q of R[V]){const Q=`${V}ResolveRangeMin`,oe=`${V}ResolveRangeMax`,pe=`${V}RequestCount`,ae=`${V}RequestCachedCount`;O[Q]=Math.min(O[Q]||1/0,q.startTime),O[oe]=Math.max(O[oe]||-1/0,q.responseEnd);const de=ye=>{O[ye]===void 0&&(O[ye]=0),++O[ye]};q.transferSize!==void 0&&q.transferSize===0&&de(ae),de(pe)}}return O})((function(R,O){const V={};if(R)for(const q of R){const Q=O(q);V[Q]===void 0&&(V[Q]=[]),V[Q].push(q)}return V})(d,Fu)),T=U.devicePixelRatio,S=U.navigator.connection||U.navigator.mozConnection||U.navigator.webkitConnection,M={counters:[],metadata:[],attributes:[]},L=(R,O,V)=>{V!=null&&R.push({name:O,value:V.toString()})};for(const R in x)L(M.counters,R,x[R]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(L(M.counters,"interactionRangeMin",l.interactionRange[0]),L(M.counters,"interactionRangeMax",l.interactionRange[1])),m)for(const R of Object.keys(ya)){const O=ya[R],V=m.find((q=>q.name===O));V&&L(M.counters,O,V.startTime)}return L(M.counters,"visibilityHidden",l.visibilityHidden),L(M.attributes,"style",(function(R){if(R)for(const O of R){const V=O.name.split("?")[0];if(we(V)){const q=V.split("/").slice(-2);if(q.length===2)return`mapbox://styles/${q[0]}/${q[1]}`}}})(d)),L(M.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),L(M.attributes,"fogEnabled",l.fogEnabled?"true":"false"),L(M.attributes,"projection",l.projection),L(M.attributes,"zoom",l.zoom),L(M.metadata,"devicePixelRatio",T),L(M.metadata,"connectionEffectiveType",S?S.effectiveType:void 0),L(M.metadata,"navigatorUserAgent",U.navigator.userAgent),L(M.metadata,"screenWidth",U.screen.width),L(M.metadata,"screenHeight",U.screen.height),L(M.metadata,"windowWidth",U.innerWidth),L(M.metadata,"windowHeight",U.innerHeight),L(M.metadata,"mapWidth",l.width/T),L(M.metadata,"mapHeight",l.height/T),L(M.metadata,"webglRenderer",l.renderer),L(M.metadata,"webglVendor",l.vendor),L(M.metadata,"sdkVersion",G),L(M.metadata,"sdkIdentifier","mapbox-gl-js"),M})(r);for(const l of i.metadata);for(const l of i.counters);for(const l of i.attributes);this.postEvent(e,i,(()=>{}),t)}},fn=_i.postPerformanceEvent.bind(_i),Ds=new class extends ur{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,i){if(!Y.API_URL||!Y.SESSION_PATH)return;const l=Ct(Y.API_URL+Y.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${i||Y.ACCESS_TOKEN||""}`);const d={url:mt(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=(function(m,x){return _o(Ot(m,{method:"GET"}),x)})(d,(m=>{this.pendingRequest=null,r(m),this.saveEventData(),this.processRequests(i)}))}getSessionAPI(t,e,r,i){this.skuToken=e,this.errorCb=i,Y.SESSION_PATH&&Y.API_URL&&(r||Y.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(_e)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,(i=>{i?this.errorCb(i):e&&(this.success[e]=!0)}),t)}},Hn=Ds.getSessionAPI.bind(Ds),Mi=new Set,ya={create:"create",load:"load",fullLoad:"fullLoad"},Yh={mark(t){U.performance.mark(t)},measure(t,e,r){U.performance.measure(t,e,r)}};function Fu(t){const e=t.name.split("?")[0];return Le(e)&&e.includes("mapbox-gl.js")?"javascript":Le(e)&&e.includes("mapbox-gl.css")?"css":(function(r){return Y.API_FONTS_REGEX.test(r)})(e)?"fontRange":qe(e)?"sprite":we(e)?"style":(function(r){return Y.API_TILEJSON_REGEX.test(r)})(e)?"tilejson":"other"}const Vr=U.performance;function Ou(t){const e=t?t.url.toString():void 0;return Vr.getEntriesByName(e)}let Hl,Tn,Vc,ds;const Hs={now:()=>Vc!==void 0?Vc:U.performance.now(),setNow(t){Vc=t},restoreNow(){Vc=void 0},frame(t){const e=U.requestAnimationFrame(t);return{cancel:()=>U.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:r,height:i}=t;ds||(ds=U.document.createElement("canvas"));const l=ds.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(r>ds.width||i>ds.height)&&(ds.width=r,ds.height=i),l.clearRect(-e,-e,r+2*e,i+2*e),l.drawImage(t,0,0,r,i),l.getImageData(-e,-e,r+2*e,i+2*e)},resolveURL:t=>(Hl||(Hl=U.document.createElement("a")),Hl.href=t,Hl.href),get devicePixelRatio(){return U.devicePixelRatio},get prefersReducedMotion(){return!!U.matchMedia&&(Tn==null&&(Tn=U.matchMedia("(prefers-reduced-motion: reduce)")),Tn.matches)}};function Ja(t,e,r){r[t]&&r[t].indexOf(e)!==-1||(r[t]=r[t]||[],r[t].push(e))}function Uu(t,e,r){if(r&&r[t]){const i=r[t].indexOf(e);i!==-1&&r[t].splice(i,1)}}class $o{constructor(e,r={}){Ot(this,r),this.type=e}}class ps extends $o{constructor(e,r={}){super("error",Ot({error:e},r))}}class Ni{on(e,r){return this._listeners=this._listeners||{},Ja(e,r,this._listeners),this}off(e,r){return Uu(e,r,this._listeners),Uu(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ja(e,r,this._oneTimeListeners),this):new Promise((i=>this.once(e,i)))}fire(e,r){typeof e=="string"&&(e=new $o(e,r||{}));const i=e.type;if(this.listens(i)){e.target=this;const l=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const x of l)x.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const x of d)Uu(i,x,this._oneTimeListeners),x.call(this,e);const m=this._eventedParent;m&&(Ot(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof ps&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var rt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Xn(t,...e){for(const r of e)for(const i in r)t[i]=r[i];return t}function Rn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function ri(t){if(Array.isArray(t))return t.map(ri);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=ri(t[r]);return e}return Rn(t)}class Jh extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var Xi=Jh;class Qa{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[i,l]of r)this.bindings[i]=l}concat(e){return new Qa(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var el=Qa;const xo={kind:"null"},Rt={kind:"number"},Dr={kind:"string"},Sr={kind:"boolean"},Bi={kind:"color"},Ki={kind:"object"},mr={kind:"value"},Yi={kind:"collator"},_a={kind:"formatted"},$r={kind:"resolvedImage"};function Ji(t,e){return{kind:"array",itemType:t,N:e}}function ln(t){if(t.kind==="array"){const e=ln(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const $c=[xo,Rt,Dr,Sr,Bi,_a,Ki,Ji(mr),$r];function Xs(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Xs(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const r of $c)if(!Xs(r,e))return null}}return`Expected ${ln(t)} but found ${ln(e)} instead.`}function tl(t,e){return e.some((r=>r.kind===t.kind))}function rl(t,e){return e.some((r=>r==="null"?t===null:r==="array"?Array.isArray(t):r==="object"?t&&!Array.isArray(t)&&typeof t=="object":r===typeof t))}var Xl,Kl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function fs(t){return(t=Math.round(t))<0?0:t>255?255:t}function ms(t){return fs(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Ls(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Ks(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{Xl={}.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in Kl)return Kl[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var i=r.indexOf("("),l=r.indexOf(")");if(i!==-1&&l+1===r.length){var d=r.substr(0,i),m=r.substr(i+1,l-(i+1)).split(","),x=1;switch(d){case"rgba":if(m.length!==4)return null;x=Ls(m.pop());case"rgb":return m.length!==3?null:[ms(m[0]),ms(m[1]),ms(m[2]),x];case"hsla":if(m.length!==4)return null;x=Ls(m.pop());case"hsl":if(m.length!==3)return null;var T=(parseFloat(m[0])%360+360)%360/360,S=Ls(m[1]),M=Ls(m[2]),L=M<=.5?M*(S+1):M+S-M*S,R=2*M-L;return[fs(255*Ks(R,L,T+1/3)),fs(255*Ks(R,L,T)),fs(255*Ks(R,L,T-1/3)),x];default:return null}}return null}}catch{}class ni{constructor(e,r,i,l=1){this.r=e,this.g=r,this.b=i,this.a=l}static parse(e){if(!e)return;if(e instanceof ni)return e;if(typeof e!="string")return;const r=Xl(e);return r?new ni(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,i,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(i)},${l})`}toArray(){const{r:e,g:r,b:i,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*r/l,255*i/l,l]}toArray01(){const{r:e,g:r,b:i,a:l}=this;return l===0?[0,0,0,0]:[e/l,r/l,i/l,l]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:i,a:l}=this;return[e,r,i,l]}}ni.black=new ni(0,0,0,1),ni.white=new ni(1,1,1,1),ni.transparent=new ni(0,0,0,0),ni.red=new ni(1,0,0,1),ni.blue=new ni(0,0,1,1);var tn=ni;class Vu{constructor(e,r,i){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Gc{constructor(e,r,i,l,d){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=i,this.fontStack=l,this.textColor=d}}class ii{constructor(e){this.sections=e}static fromString(e){return new ii([new Gc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof ii?e:ii.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const i={};r.fontStack&&(i["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(i["font-scale"]=r.scale),r.textColor&&(i["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(i)}return e}}class gs{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new gs({name:e,available:!1}):null}serialize(){return["image",this.name]}}function $u(t,e,r,i){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?i===void 0||typeof i=="number"&&i>=0&&i<=1?null:`Invalid rgba value [${[t,e,r,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof i=="number"?[t,e,r,i]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Go(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof tn||t instanceof Vu||t instanceof ii||t instanceof gs)return!0;if(Array.isArray(t)){for(const e of t)if(!Go(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Go(t[e]))return!1;return!0}return!1}function bn(t){if(t===null)return xo;if(typeof t=="string")return Dr;if(typeof t=="boolean")return Sr;if(typeof t=="number")return Rt;if(t instanceof tn)return Bi;if(t instanceof Vu)return Yi;if(t instanceof ii)return _a;if(t instanceof gs)return $r;if(Array.isArray(t)){const e=t.length;let r;for(const i of t){const l=bn(i);if(r){if(r===l)continue;r=mr;break}r=l}return Ji(r||mr,e)}return Ki}function Yl(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof tn||t instanceof ii||t instanceof gs?t.toString():JSON.stringify(t)}class xa{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Go(e[1]))return r.error("invalid value");const i=e[1];let l=bn(i);const d=r.expectedType;return l.kind!=="array"||l.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(l=d),new xa(l,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof tn?["rgba"].concat(this.value.toArray()):this.value instanceof ii?this.value.serialize():this.value}}var js=xa,An=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const nl={string:Dr,number:Rt,boolean:Sr,object:Ki};class Gu{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let i,l=1;const d=e[0];if(d==="array"){let x,T;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in nl)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);x=nl[S],l++}else x=mr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);T=e[2],l++}i=Ji(x,T)}else i=nl[d];const m=[];for(;l<e.length;l++){const x=r.parse(e[l],l,mr);if(!x)return null;m.push(x)}return new Gu(i,m)}evaluate(e){for(let r=0;r<this.args.length;r++){const i=this.args[r].evaluate(e);if(!Xs(this.type,bn(i)))return i;if(r===this.args.length-1)throw new An(`Expected value to be of type ${ln(this.type)}, but found ${ln(bn(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const i=e.itemType;if(i.kind==="string"||i.kind==="number"||i.kind==="boolean"){r.push(i.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&r.push(l)}}return r.concat(this.args.map((i=>i.serialize())))}}var vo=Gu;class Ys{constructor(e){this.type=_a,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&typeof i=="object")return r.error("First argument must be an image or text section.");const l=[];let d=!1;for(let m=1;m<=e.length-1;++m){const x=e[m];if(d&&typeof x=="object"&&!Array.isArray(x)){d=!1;let T=null;if(x["font-scale"]&&(T=r.parse(x["font-scale"],1,Rt),!T))return null;let S=null;if(x["text-font"]&&(S=r.parse(x["text-font"],1,Ji(Dr)),!S))return null;let M=null;if(x["text-color"]&&(M=r.parse(x["text-color"],1,Bi),!M))return null;const L=l[l.length-1];L.scale=T,L.font=S,L.textColor=M}else{const T=r.parse(e[m],1,mr);if(!T)return null;const S=T.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,l.push({content:T,scale:null,font:null,textColor:null})}}return new Ys(l)}evaluate(e){return new ii(this.sections.map((r=>{const i=r.content.evaluate(e);return bn(i)===$r?new Gc("",i,null,null,null):new Gc(Yl(i),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)})))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const i={};r.scale&&(i["font-scale"]=r.scale.serialize()),r.font&&(i["text-font"]=r.font.serialize()),r.textColor&&(i["text-color"]=r.textColor.serialize()),e.push(i)}return e}}class va{constructor(e){this.type=$r,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const i=r.parse(e[1],1,Dr);return i?new va(i):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),i=gs.fromString(r);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(r)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Wu={"to-boolean":Sr,"to-color":Bi,"to-number":Rt,"to-string":Dr};class Wc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const i=e[0];if((i==="to-boolean"||i==="to-string")&&e.length!==2)return r.error("Expected one argument.");const l=Wu[i],d=[];for(let m=1;m<e.length;m++){const x=r.parse(e[m],m,mr);if(!x)return null;d.push(x)}return new Wc(l,d)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,i;for(const l of this.args){if(r=l.evaluate(e),i=null,r instanceof tn)return r;if(typeof r=="string"){const d=e.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(i=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:$u(r[0],r[1],r[2],r[3]),!i))return new tn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new An(i||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const i of this.args){if(r=i.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new An(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?ii.fromString(Yl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?gs.fromString(Yl(this.args[0].evaluate(e))):Yl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Ys([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new va(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((r=>{e.push(r.serialize())})),e}}var Qi=Wc;const ys=["Unknown","Point","LineString","Polygon"];var il=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ys[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-t[0])+this.featureDistanceData.bearing[1]*(i*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=tn.parse(t)),e}};class Wo{constructor(e,r,i,l){this.name=e,this.type=r,this._evaluate=i,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,r){const i=e[0],l=Wo.definitions[i];if(!l)return r.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(l)?l[0]:l.type,m=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,x=m.filter((([S])=>!Array.isArray(S)||S.length===e.length-1));let T=null;for(const[S,M]of x){T=new Xu(r.registry,r.path,null,r.scope);const L=[];let R=!1;for(let O=1;O<e.length;O++){const V=e[O],q=Array.isArray(S)?S[O-1]:S.type,Q=T.parse(V,1+L.length,q);if(!Q){R=!0;break}L.push(Q)}if(!R)if(Array.isArray(S)&&S.length!==L.length)T.error(`Expected ${S.length} arguments, but found ${L.length} instead.`);else{for(let O=0;O<L.length;O++){const V=Array.isArray(S)?S[O]:S.type,q=L[O];T.concat(O+1).checkSubtype(V,q.type)}if(T.errors.length===0)return new Wo(i,d,M,L)}}if(x.length===1)r.errors.push(...T.errors);else{const S=(x.length?x:m).map((([L])=>{return R=L,Array.isArray(R)?`(${R.map(ln).join(", ")})`:`(${ln(R.type)}...)`;var R})).join(" | "),M=[];for(let L=1;L<e.length;L++){const R=r.parse(e[L],1+M.length);if(!R)return null;M.push(ln(R.type))}r.error(`Expected arguments of type ${S}, but found (${M.join(", ")}) instead.`)}return null}static register(e,r){Wo.definitions=r;for(const i in r)e[i]=Wo}}var _s=Wo;class qo{constructor(e,r,i){this.type=Yi,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const i=e[1];if(typeof i!="object"||Array.isArray(i))return r.error("Collator options argument must be an object.");const l=r.parse(i["case-sensitive"]!==void 0&&i["case-sensitive"],1,Sr);if(!l)return null;const d=r.parse(i["diacritic-sensitive"]!==void 0&&i["diacritic-sensitive"],1,Sr);if(!d)return null;let m=null;return i.locale&&(m=r.parse(i.locale,1,Dr),!m)?null:new qo(l,d,m)}evaluate(e){return new Vu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Js=8192;function xi(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Rs(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function ba(t,e){const r=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*Js),Math.round(i*l*Js)]}function sl(t,e,r){const i=t[0]-e[0],l=t[1]-e[1],d=t[0]-r[0],m=t[1]-r[1];return i*m-d*l==0&&i*d<=0&&l*m<=0}function qc(t,e){let r=!1;for(let m=0,x=e.length;m<x;m++){const T=e[m];for(let S=0,M=T.length;S<M-1;S++){if(sl(t,T[S],T[S+1]))return!1;(l=T[S])[1]>(i=t)[1]!=(d=T[S+1])[1]>i[1]&&i[0]<(d[0]-l[0])*(i[1]-l[1])/(d[1]-l[1])+l[0]&&(r=!r)}}var i,l,d;return r}function Jl(t,e){for(let r=0;r<e.length;r++)if(qc(t,e[r]))return!0;return!1}function Ql(t,e,r,i){const l=i[0]-r[0],d=i[1]-r[1],m=(t[0]-r[0])*d-l*(t[1]-r[1]),x=(e[0]-r[0])*d-l*(e[1]-r[1]);return m>0&&x<0||m<0&&x>0}function Qs(t,e,r){for(const S of r)for(let M=0;M<S.length-1;++M)if((x=[(m=S[M+1])[0]-(d=S[M])[0],m[1]-d[1]])[0]*(T=[(l=e)[0]-(i=t)[0],l[1]-i[1]])[1]-x[1]*T[0]!=0&&Ql(i,l,d,m)&&Ql(d,m,i,l))return!0;var i,l,d,m,x,T;return!1}function Nr(t,e){for(let r=0;r<t.length;++r)if(!qc(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(Qs(t[r],t[r+1],e))return!1;return!0}function Qh(t,e){for(let r=0;r<e.length;r++)if(Nr(t,e[r]))return!0;return!1}function qu(t,e,r){const i=[];for(let l=0;l<t.length;l++){const d=[];for(let m=0;m<t[l].length;m++){const x=ba(t[l][m],r);xi(e,x),d.push(x)}i.push(d)}return i}function ed(t,e,r){const i=[];for(let l=0;l<t.length;l++){const d=qu(t[l],e,r);i.push(d)}return i}function Zu(t,e,r,i){if(t[0]<r[0]||t[0]>r[2]){const l=.5*i;let d=t[0]-r[0]>l?-i:r[0]-t[0]>l?i:0;d===0&&(d=t[0]-r[2]>l?-i:r[2]-t[0]>l?i:0),t[0]+=d}xi(e,t)}function Zc(t,e,r,i){const l=Math.pow(2,i.z)*Js,d=[i.x*Js,i.y*Js],m=[];if(!t)return m;for(const x of t)for(const T of x){const S=[T.x+d[0],T.y+d[1]];Zu(S,e,r,l),m.push(S)}return m}function Hu(t,e,r,i){const l=Math.pow(2,i.z)*Js,d=[i.x*Js,i.y*Js],m=[];if(!t)return m;for(const T of t){const S=[];for(const M of T){const L=[M.x+d[0],M.y+d[1]];xi(e,L),S.push(L)}m.push(S)}if(e[2]-e[0]<=l/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const T of m)for(const S of T)Zu(S,e,r,l)}var x;return m}class ol{constructor(e,r){this.type=Sr,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Go(e[1])){const i=e[1];if(i.type==="FeatureCollection")for(let l=0;l<i.features.length;++l){const d=i.features[l].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new ol(i,i.features[l].geometry)}else if(i.type==="Feature"){const l=i.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new ol(i,i.geometry)}else if(i.type==="Polygon"||i.type==="MultiPolygon")return new ol(i,i)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(r,i){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(i.type==="Polygon"){const x=qu(i.coordinates,d,m),T=Zc(r.geometry(),l,d,m);if(!Rs(l,d))return!1;for(const S of T)if(!qc(S,x))return!1}if(i.type==="MultiPolygon"){const x=ed(i.coordinates,d,m),T=Zc(r.geometry(),l,d,m);if(!Rs(l,d))return!1;for(const S of T)if(!Jl(S,x))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(r,i){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(i.type==="Polygon"){const x=qu(i.coordinates,d,m),T=Hu(r.geometry(),l,d,m);if(!Rs(l,d))return!1;for(const S of T)if(!Nr(S,x))return!1}if(i.type==="MultiPolygon"){const x=ed(i.coordinates,d,m),T=Hu(r.geometry(),l,d,m);if(!Rs(l,d))return!1;for(const S of T)if(!Qh(S,x))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Hc=ol;function al(t){if(t instanceof _s&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Hc)return!1;let e=!0;return t.eachChild((r=>{e&&!al(r)&&(e=!1)})),e}function bo(t){if(t instanceof _s&&t.name==="feature-state")return!1;let e=!0;return t.eachChild((r=>{e&&!bo(r)&&(e=!1)})),e}function Zo(t,e){if(t instanceof _s&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild((i=>{r&&!Zo(i,e)&&(r=!1)})),r}class Xc{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const i=e[1];return r.scope.has(i)?new Xc(i,r.scope.get(i)):r.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var td=Xc;class ec{constructor(e,r=[],i,l=new el,d=[]){this.registry=e,this.path=r,this.key=r.map((m=>`[${m}]`)).join(""),this.scope=l,this.errors=d,this.expectedType=i}parse(e,r,i,l,d={}){return r?this.concat(r,i,l)._parse(e,d):this._parse(e,d)}_parse(e,r){function i(l,d,m){return m==="assert"?new vo(d,[l]):m==="coerce"?new Qi(d,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[l];if(d){let m=d.parse(e,this);if(!m)return null;if(this.expectedType){const x=this.expectedType,T=m.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||T.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(x,T))return null}else m=i(m,x,r.typeAnnotation||"coerce");else m=i(m,x,r.typeAnnotation||"assert")}if(!(m instanceof js)&&m.type.kind!=="resolvedImage"&&tc(m)){const x=new il;try{m=new js(m.type,m.evaluate(x))}catch(T){return this.error(T.message),null}}return m}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,i){const l=typeof e=="number"?this.path.concat(e):this.path,d=i?this.scope.concat(i):this.scope;return new ec(this.registry,l,r||null,d,this.errors)}error(e,...r){const i=`${this.key}${r.map((l=>`[${l}]`)).join("")}`;this.errors.push(new Xi(i,e))}checkSubtype(e,r){const i=Xs(e,r);return i&&this.error(i),i}}var Xu=ec;function tc(t){if(t instanceof td)return tc(t.boundExpression);if(t instanceof _s&&t.name==="error"||t instanceof qo||t instanceof Hc)return!1;const e=t instanceof Qi||t instanceof vo;let r=!0;return t.eachChild((i=>{r=e?r&&tc(i):r&&i instanceof js})),!!r&&al(t)&&Zo(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Kc(t,e){const r=t.length-1;let i,l,d=0,m=r,x=0;for(;d<=m;)if(x=Math.floor((d+m)/2),i=t[x],l=t[x+1],i<=e){if(x===r||e<l)return x;d=x+1}else{if(!(i>e))throw new An("Input is not a number.");m=x-1}return 0}class Yc{constructor(e,r,i){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,d]of i)this.labels.push(l),this.outputs.push(d)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const i=r.parse(e[1],1,Rt);if(!i)return null;const l=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let m=1;m<e.length;m+=2){const x=m===1?-1/0:e[m],T=e[m+1],S=m,M=m+1;if(typeof x!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(l.length&&l[l.length-1][0]>=x)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const L=r.parse(T,M,d);if(!L)return null;d=d||L.type,l.push([x,L])}return new Yc(d,i,l)}evaluate(e){const r=this.labels,i=this.outputs;if(r.length===1)return i[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return i[0].evaluate(e);const d=r.length;return l>=r[d-1]?i[d-1].evaluate(e):i[Kc(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var Ku=Yc;function Rr(t,e,r){return t*(1-r)+e*r}var rc=Object.freeze({__proto__:null,array:function(t,e,r){return t.map(((i,l)=>Rr(i,e[l],r)))},color:function(t,e,r){return new tn(Rr(t.r,e.r,r),Rr(t.g,e.g,r),Rr(t.b,e.b,r),Rr(t.a,e.a,r))},number:Rr});const rd=.95047,Yu=1.08883,nd=4/29,wa=6/29,Ju=3*wa*wa,mp=wa*wa*wa,Qu=Math.PI/180,nc=180/Math.PI;function eh(t){return t>mp?Math.pow(t,1/3):t/Ju+nd}function Jc(t){return t>wa?t*t*t:Ju*(t-nd)}function Qc(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function ic(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function th(t){const e=ic(t.r),r=ic(t.g),i=ic(t.b),l=eh((.4124564*e+.3575761*r+.1804375*i)/rd),d=eh((.2126729*e+.7151522*r+.072175*i)/1);return{l:116*d-16,a:500*(l-d),b:200*(d-eh((.0193339*e+.119192*r+.9503041*i)/Yu)),alpha:t.a}}function rh(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*Jc(e),r=rd*Jc(r),i=Yu*Jc(i),new tn(Qc(3.2404542*r-1.5371385*e-.4985314*i),Qc(-.969266*r+1.8760108*e+.041556*i),Qc(.0556434*r-.2040259*e+1.0572252*i),t.alpha)}function ll(t,e,r){const i=e-t;return t+r*(i>180||i<-180?i-360*Math.round(i/360):i)}const sc={forward:th,reverse:rh,interpolate:function(t,e,r){return{l:Rr(t.l,e.l,r),a:Rr(t.a,e.a,r),b:Rr(t.b,e.b,r),alpha:Rr(t.alpha,e.alpha,r)}}},cl={forward:function(t){const{l:e,a:r,b:i}=th(t),l=Math.atan2(i,r)*nc;return{h:l<0?l+360:l,c:Math.sqrt(r*r+i*i),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Qu,r=t.c;return rh({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:ll(t.h,e.h,r),c:Rr(t.c,e.c,r),l:Rr(t.l,e.l,r),alpha:Rr(t.alpha,e.alpha,r)}}};var nh=Object.freeze({__proto__:null,hcl:cl,lab:sc});class ul{constructor(e,r,i,l,d){this.type=e,this.operator=r,this.interpolation=i,this.input=l,this.labels=[],this.outputs=[];for(const[m,x]of d)this.labels.push(m),this.outputs.push(x)}static interpolationFactor(e,r,i,l){let d=0;if(e.name==="exponential")d=eu(r,e.base,i,l);else if(e.name==="linear")d=eu(r,1,i,l);else if(e.name==="cubic-bezier"){const m=e.controlPoints;d=new Ye(m[0],m[1],m[2],m[3]).solve(eu(r,1,i,l))}return d}static parse(e,r){let[i,l,d,...m]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const S=l[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:S}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const S=l.slice(1);if(S.length!==4||S.some((M=>typeof M!="number"||M<0||M>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,Rt),!d)return null;const x=[];let T=null;i==="interpolate-hcl"||i==="interpolate-lab"?T=Bi:r.expectedType&&r.expectedType.kind!=="value"&&(T=r.expectedType);for(let S=0;S<m.length;S+=2){const M=m[S],L=m[S+1],R=S+3,O=S+4;if(typeof M!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(x.length&&x[x.length-1][0]>=M)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const V=r.parse(L,O,T);if(!V)return null;T=T||V.type,x.push([M,V])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new ul(T,i,l,d,x):r.error(`Type ${ln(T)} is not interpolatable.`)}evaluate(e){const r=this.labels,i=this.outputs;if(r.length===1)return i[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return i[0].evaluate(e);const d=r.length;if(l>=r[d-1])return i[d-1].evaluate(e);const m=Kc(r,l),x=ul.interpolationFactor(this.interpolation,l,r[m],r[m+1]),T=i[m].evaluate(e),S=i[m+1].evaluate(e);return this.operator==="interpolate"?rc[this.type.kind.toLowerCase()](T,S,x):this.operator==="interpolate-hcl"?cl.reverse(cl.interpolate(cl.forward(T),cl.forward(S),x)):sc.reverse(sc.interpolate(sc.forward(T),sc.forward(S),x))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let i=0;i<this.labels.length;i++)r.push(this.labels[i],this.outputs[i].serialize());return r}}function eu(t,e,r,i){const l=i-r,d=t-r;return l===0?0:e===1?d/l:(Math.pow(e,d)-1)/(Math.pow(e,l)-1)}var Fi=ul;class Ho{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let i=null;const l=r.expectedType;l&&l.kind!=="value"&&(i=l);const d=[];for(const x of e.slice(1)){const T=r.parse(x,1+d.length,i,void 0,{typeAnnotation:"omit"});if(!T)return null;i=i||T.type,d.push(T)}const m=l&&d.some((x=>Xs(l,x.type)));return new Ho(m?mr:i,d)}evaluate(e){let r,i=null,l=0;for(const d of this.args){if(l++,i=d.evaluate(e),i&&i instanceof gs&&!i.available&&(r||(r=i),i=null,l===this.args.length))return r;if(i!==null)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((r=>{e.push(r.serialize())})),e}}var ih=Ho;class Ta{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let d=1;d<e.length-1;d+=2){const m=e[d];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,d);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const x=r.parse(e[d+1],d+1);if(!x)return null;i.push([m,x])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,i);return l?new Ta(i,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,i]of this.bindings)e.push(r,i.serialize());return e.push(this.result.serialize()),e}}var id=Ta;class tu{constructor(e,r,i){this.type=e,this.index=r,this.input=i}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=r.parse(e[1],1,Rt),l=r.parse(e[2],2,Ji(r.expectedType||mr));return i&&l?new tu(l.type.itemType,i,l):null}evaluate(e){const r=this.index.evaluate(e),i=this.input.evaluate(e);if(r<0)throw new An(`Array index out of bounds: ${r} < 0.`);if(r>=i.length)throw new An(`Array index out of bounds: ${r} > ${i.length-1}.`);if(r!==Math.floor(r))throw new An(`Array index must be an integer, but found ${r} instead.`);return i[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var sh=tu;class oc{constructor(e,r){this.type=Sr,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=r.parse(e[1],1,mr),l=r.parse(e[2],2,mr);return i&&l?tl(i.type,[Sr,Dr,Rt,xo,mr])?new oc(i,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ln(i.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(i==null)return!1;if(!rl(r,["boolean","string","number","null"]))throw new An(`Expected first argument to be of type boolean, string, number or null, but found ${ln(bn(r))} instead.`);if(!rl(i,["string","array"]))throw new An(`Expected second argument to be of type array or string, but found ${ln(bn(i))} instead.`);return i.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ac=oc;class hl{constructor(e,r,i){this.type=Rt,this.needle=e,this.haystack=r,this.fromIndex=i}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=r.parse(e[1],1,mr),l=r.parse(e[2],2,mr);if(!i||!l)return null;if(!tl(i.type,[Sr,Dr,Rt,xo,mr]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ln(i.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,Rt);return d?new hl(i,l,d):null}return new hl(i,l)}evaluate(e){const r=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!rl(r,["boolean","string","number","null"]))throw new An(`Expected first argument to be of type boolean, string, number or null, but found ${ln(bn(r))} instead.`);if(!rl(i,["string","array"]))throw new An(`Expected second argument to be of type array or string, but found ${ln(bn(i))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return i.indexOf(r,l)}return i.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var oh=hl;class ah{constructor(e,r,i,l,d,m){this.inputType=e,this.type=r,this.input=i,this.cases=l,this.outputs=d,this.otherwise=m}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let i,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const d={},m=[];for(let S=2;S<e.length-1;S+=2){let M=e[S];const L=e[S+1];Array.isArray(M)||(M=[M]);const R=r.concat(S);if(M.length===0)return R.error("Expected at least one branch label.");for(const V of M){if(typeof V!="number"&&typeof V!="string")return R.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return R.error("Numeric branch labels must be integer values.");if(i){if(R.checkSubtype(i,bn(V)))return null}else i=bn(V);if(d[String(V)]!==void 0)return R.error("Branch labels must be unique.");d[String(V)]=m.length}const O=r.parse(L,S,l);if(!O)return null;l=l||O.type,m.push(O)}const x=r.parse(e[1],1,mr);if(!x)return null;const T=r.parse(e[e.length-1],e.length-1,l);return T?x.type.kind!=="value"&&r.concat(1).checkSubtype(i,x.type)?null:new ah(i,l,x,d,m,T):null}evaluate(e){const r=this.input.evaluate(e);return(bn(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),i=[],l={};for(const m of r){const x=l[this.cases[m]];x===void 0?(l[this.cases[m]]=i.length,i.push([this.cases[m],[m]])):i[x][1].push(m)}const d=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,x]of i)e.push(x.length===1?d(x[0]):x.map(d)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}var gp=ah;class lh{constructor(e,r,i){this.type=e,this.branches=r,this.otherwise=i}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let i;r.expectedType&&r.expectedType.kind!=="value"&&(i=r.expectedType);const l=[];for(let m=1;m<e.length-1;m+=2){const x=r.parse(e[m],m,Sr);if(!x)return null;const T=r.parse(e[m+1],m+1,i);if(!T)return null;l.push([x,T]),i=i||T.type}const d=r.parse(e[e.length-1],e.length-1,i);return d?new lh(i,l,d):null}evaluate(e){for(const[r,i]of this.branches)if(r.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,i]of this.branches)e(r),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((r=>{e.push(r.serialize())})),e}}var sd=lh;class lc{constructor(e,r,i,l){this.type=e,this.input=r,this.beginIndex=i,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=r.parse(e[1],1,mr),l=r.parse(e[2],2,Rt);if(!i||!l)return null;if(!tl(i.type,[Ji(mr),Dr,mr]))return r.error(`Expected first argument to be of type array or string, but found ${ln(i.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,Rt);return d?new lc(i.type,i,l,d):null}return new lc(i.type,i,l)}evaluate(e){const r=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!rl(r,["string","array"]))throw new An(`Expected first argument to be of type array or string, but found ${ln(bn(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(i,l)}return r.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var xs=lc;function Xo(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ch(t,e,r,i){return i.compare(e,r)===0}function Sa(t,e,r){const i=t!=="=="&&t!=="!=";return class x1{constructor(d,m,x){this.type=Sr,this.lhs=d,this.rhs=m,this.collator=x,this.hasUntypedArgument=d.type.kind==="value"||m.type.kind==="value"}static parse(d,m){if(d.length!==3&&d.length!==4)return m.error("Expected two or three arguments.");const x=d[0];let T=m.parse(d[1],1,mr);if(!T)return null;if(!Xo(x,T.type))return m.concat(1).error(`"${x}" comparisons are not supported for type '${ln(T.type)}'.`);let S=m.parse(d[2],2,mr);if(!S)return null;if(!Xo(x,S.type))return m.concat(2).error(`"${x}" comparisons are not supported for type '${ln(S.type)}'.`);if(T.type.kind!==S.type.kind&&T.type.kind!=="value"&&S.type.kind!=="value")return m.error(`Cannot compare types '${ln(T.type)}' and '${ln(S.type)}'.`);i&&(T.type.kind==="value"&&S.type.kind!=="value"?T=new vo(S.type,[T]):T.type.kind!=="value"&&S.type.kind==="value"&&(S=new vo(T.type,[S])));let M=null;if(d.length===4){if(T.type.kind!=="string"&&S.type.kind!=="string"&&T.type.kind!=="value"&&S.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(M=m.parse(d[3],3,Yi),!M)return null}return new x1(T,S,M)}evaluate(d){const m=this.lhs.evaluate(d),x=this.rhs.evaluate(d);if(i&&this.hasUntypedArgument){const T=bn(m),S=bn(x);if(T.kind!==S.kind||T.kind!=="string"&&T.kind!=="number")throw new An(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${T.kind}, ${S.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const T=bn(m),S=bn(x);if(T.kind!=="string"||S.kind!=="string")return e(d,m,x)}return this.collator?r(d,m,x,this.collator.evaluate(d)):e(d,m,x)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[t];return this.eachChild((m=>{d.push(m.serialize())})),d}}}const od=Sa("==",(function(t,e,r){return e===r}),ch),ad=Sa("!=",(function(t,e,r){return e!==r}),(function(t,e,r,i){return!ch(0,e,r,i)})),uh=Sa("<",(function(t,e,r){return e<r}),(function(t,e,r,i){return i.compare(e,r)<0})),yp=Sa(">",(function(t,e,r){return e>r}),(function(t,e,r,i){return i.compare(e,r)>0})),_p=Sa("<=",(function(t,e,r){return e<=r}),(function(t,e,r,i){return i.compare(e,r)<=0})),Ea=Sa(">=",(function(t,e,r){return e>=r}),(function(t,e,r,i){return i.compare(e,r)>=0}));class dl{constructor(e,r,i,l,d,m){this.type=Dr,this.number=e,this.locale=r,this.currency=i,this.unit=l,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const i=r.parse(e[1],1,Rt);if(!i)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let d=null;if(l.locale&&(d=r.parse(l.locale,1,Dr),!d))return null;let m=null;if(l.currency&&(m=r.parse(l.currency,1,Dr),!m))return null;let x=null;if(l.unit&&(x=r.parse(l.unit,1,Dr),!x))return null;let T=null;if(l["min-fraction-digits"]&&(T=r.parse(l["min-fraction-digits"],1,Rt),!T))return null;let S=null;return l["max-fraction-digits"]&&(S=r.parse(l["max-fraction-digits"],1,Rt),!S)?null:new dl(i,d,m,x,T,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class eo{constructor(e){this.type=Rt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=r.parse(e[1],1);return i?i.type.kind!=="array"&&i.type.kind!=="string"&&i.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${ln(i.type)} instead.`):new eo(i):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new An(`Expected value to be of type string or array, but found ${ln(bn(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((r=>{e.push(r.serialize())})),e}}const ru={"==":od,"!=":ad,">":yp,"<":uh,">=":Ea,"<=":_p,array:vo,at:sh,boolean:vo,case:sd,coalesce:ih,collator:qo,format:Ys,image:va,in:ac,"index-of":oh,interpolate:Fi,"interpolate-hcl":Fi,"interpolate-lab":Fi,length:eo,let:id,literal:js,match:gp,number:vo,"number-format":dl,object:vo,slice:xs,step:Ku,string:vo,"to-boolean":Qi,"to-color":Qi,"to-number":Qi,"to-string":Qi,var:td,within:Hc};function hh(t,[e,r,i,l]){e=e.evaluate(t),r=r.evaluate(t),i=i.evaluate(t);const d=l?l.evaluate(t):1,m=$u(e,r,i,d);if(m)throw new An(m);return new tn(e/255*d,r/255*d,i/255*d,d)}function vs(t,e){return t in e}function wo(t,e){const r=e[t];return r===void 0?null:r}function Oi(t){return{type:t}}_s.register(ru,{error:[{kind:"error"},[Dr],(t,[e])=>{throw new An(e.evaluate(t))}],typeof:[Dr,[mr],(t,[e])=>ln(bn(e.evaluate(t)))],"to-rgba":[Ji(Rt,4),[Bi],(t,[e])=>e.evaluate(t).toArray()],rgb:[Bi,[Rt,Rt,Rt],hh],rgba:[Bi,[Rt,Rt,Rt,Rt],hh],has:{type:Sr,overloads:[[[Dr],(t,[e])=>vs(e.evaluate(t),t.properties())],[[Dr,Ki],(t,[e,r])=>vs(e.evaluate(t),r.evaluate(t))]]},get:{type:mr,overloads:[[[Dr],(t,[e])=>wo(e.evaluate(t),t.properties())],[[Dr,Ki],(t,[e,r])=>wo(e.evaluate(t),r.evaluate(t))]]},"feature-state":[mr,[Dr],(t,[e])=>wo(e.evaluate(t),t.featureState||{})],properties:[Ki,[],t=>t.properties()],"geometry-type":[Dr,[],t=>t.geometryType()],id:[mr,[],t=>t.id()],zoom:[Rt,[],t=>t.globals.zoom],pitch:[Rt,[],t=>t.globals.pitch||0],"distance-from-center":[Rt,[],t=>t.distanceFromCenter()],"heatmap-density":[Rt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Rt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Rt,[],t=>t.globals.skyRadialProgress||0],accumulated:[mr,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Rt,Oi(Rt),(t,e)=>{let r=0;for(const i of e)r+=i.evaluate(t);return r}],"*":[Rt,Oi(Rt),(t,e)=>{let r=1;for(const i of e)r*=i.evaluate(t);return r}],"-":{type:Rt,overloads:[[[Rt,Rt],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[Rt],(t,[e])=>-e.evaluate(t)]]},"/":[Rt,[Rt,Rt],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[Rt,[Rt,Rt],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[Rt,[],()=>Math.LN2],pi:[Rt,[],()=>Math.PI],e:[Rt,[],()=>Math.E],"^":[Rt,[Rt,Rt],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[Rt,[Rt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Rt,[Rt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Rt,[Rt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Rt,[Rt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Rt,[Rt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Rt,[Rt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Rt,[Rt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Rt,[Rt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Rt,[Rt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Rt,[Rt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Rt,Oi(Rt),(t,e)=>Math.min(...e.map((r=>r.evaluate(t))))],max:[Rt,Oi(Rt),(t,e)=>Math.max(...e.map((r=>r.evaluate(t))))],abs:[Rt,[Rt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Rt,[Rt],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[Rt,[Rt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Rt,[Rt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Sr,[Dr,mr],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[Sr,[mr],(t,[e])=>t.id()===e.value],"filter-type-==":[Sr,[Dr],(t,[e])=>t.geometryType()===e.value],"filter-<":[Sr,[Dr,mr],(t,[e,r])=>{const i=t.properties()[e.value],l=r.value;return typeof i==typeof l&&i<l}],"filter-id-<":[Sr,[mr],(t,[e])=>{const r=t.id(),i=e.value;return typeof r==typeof i&&r<i}],"filter->":[Sr,[Dr,mr],(t,[e,r])=>{const i=t.properties()[e.value],l=r.value;return typeof i==typeof l&&i>l}],"filter-id->":[Sr,[mr],(t,[e])=>{const r=t.id(),i=e.value;return typeof r==typeof i&&r>i}],"filter-<=":[Sr,[Dr,mr],(t,[e,r])=>{const i=t.properties()[e.value],l=r.value;return typeof i==typeof l&&i<=l}],"filter-id-<=":[Sr,[mr],(t,[e])=>{const r=t.id(),i=e.value;return typeof r==typeof i&&r<=i}],"filter->=":[Sr,[Dr,mr],(t,[e,r])=>{const i=t.properties()[e.value],l=r.value;return typeof i==typeof l&&i>=l}],"filter-id->=":[Sr,[mr],(t,[e])=>{const r=t.id(),i=e.value;return typeof r==typeof i&&r>=i}],"filter-has":[Sr,[mr],(t,[e])=>e.value in t.properties()],"filter-has-id":[Sr,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Sr,[Ji(Dr)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Sr,[Ji(mr)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Sr,[Dr,Ji(mr)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Sr,[Dr,Ji(mr)],(t,[e,r])=>(function(i,l,d,m){for(;d<=m;){const x=d+m>>1;if(l[x]===i)return!0;l[x]>i?m=x-1:d=x+1}return!1})(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Sr,overloads:[[[Sr,Sr],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[Oi(Sr),(t,e)=>{for(const r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:Sr,overloads:[[[Sr,Sr],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[Oi(Sr),(t,e)=>{for(const r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[Sr,[Sr],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Sr,[Dr],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[Dr,[Dr],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Dr,[Dr],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Dr,Oi(mr),(t,e)=>e.map((r=>Yl(r.evaluate(t)))).join("")],"resolved-locale":[Dr,[Yi],(t,[e])=>e.evaluate(t).resolvedLocale()]});var pl=ru;function cc(t){return{result:"success",value:t}}function Ko(t){return{result:"error",value:t}}function ka(t){return t["property-type"]==="data-driven"}function uc(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function hc(t){return!!t.expression&&t.expression.interpolated}function Br(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function fl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function To(t){return t}function ml(t,e){const r=e.type==="color",i=t.stops&&typeof t.stops[0][0]=="object",l=i||!(i||t.property!==void 0),d=t.type||(hc(e)?"exponential":"interval");if(r&&((t=Xn({},t)).stops&&(t.stops=t.stops.map((S=>[S[0],tn.parse(S[1])]))),t.default=tn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!nh[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let m,x,T;if(d==="exponential")m=es;else if(d==="interval")m=nu;else if(d==="categorical"){m=ld,x=Object.create(null);for(const S of t.stops)x[S[0]]=S[1];T=typeof t.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);m=cd}if(i){const S={},M=[];for(let O=0;O<t.stops.length;O++){const V=t.stops[O],q=V[0].zoom;S[q]===void 0&&(S[q]={zoom:q,type:t.type,property:t.property,default:t.default,stops:[]},M.push(q)),S[q].stops.push([V[0].value,V[1]])}const L=[];for(const O of M)L.push([S[O].zoom,ml(S[O],e)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Fi.interpolationFactor.bind(void 0,R),zoomStops:L.map((O=>O[0])),evaluate:({zoom:O},V)=>es({stops:L,base:t.base},e,O).evaluate(O,V)}}if(l){const S=d==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Fi.interpolationFactor.bind(void 0,S),zoomStops:t.stops.map((M=>M[0])),evaluate:({zoom:M})=>m(t,e,M,x,T)}}return{kind:"source",evaluate(S,M){const L=M&&M.properties?M.properties[t.property]:void 0;return L===void 0?Yo(t.default,e.default):m(t,e,L,x,T)}}}function Yo(t,e,r){return t!==void 0?t:e!==void 0?e:r!==void 0?r:void 0}function ld(t,e,r,i,l){return Yo(typeof r===l?i[r]:void 0,t.default,e.default)}function nu(t,e,r){if(Br(r)!=="number")return Yo(t.default,e.default);const i=t.stops.length;if(i===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];const l=Kc(t.stops.map((d=>d[0])),r);return t.stops[l][1]}function es(t,e,r){const i=t.base!==void 0?t.base:1;if(Br(r)!=="number")return Yo(t.default,e.default);const l=t.stops.length;if(l===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[l-1][0])return t.stops[l-1][1];const d=Kc(t.stops.map((M=>M[0])),r),m=(function(M,L,R,O){const V=O-R,q=M-R;return V===0?0:L===1?q/V:(Math.pow(L,q)-1)/(Math.pow(L,V)-1)})(r,i,t.stops[d][0],t.stops[d+1][0]),x=t.stops[d][1],T=t.stops[d+1][1];let S=rc[e.type]||To;if(t.colorSpace&&t.colorSpace!=="rgb"){const M=nh[t.colorSpace];S=(L,R)=>M.reverse(M.interpolate(M.forward(L),M.forward(R),m))}return typeof x.evaluate=="function"?{evaluate(...M){const L=x.evaluate.apply(void 0,M),R=T.evaluate.apply(void 0,M);if(L!==void 0&&R!==void 0)return S(L,R,m)}}:S(x,T,m)}function cd(t,e,r){return e.type==="color"?r=tn.parse(r):e.type==="formatted"?r=ii.fromString(r.toString()):e.type==="resolvedImage"?r=gs.fromString(r.toString()):Br(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Yo(r,t.default,e.default)}class dc{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new il,this._defaultValue=r?(function(i){return i.type==="color"&&(fl(i.default)||Array.isArray(i.default))?new tn(0,0,0,0):i.type==="color"?tn.parse(i.default)||null:i.default===void 0?null:i.default})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,i,l,d,m,x,T){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=i,this._evaluator.canonical=l||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,i,l,d,m,x,T){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=i||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=T||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new An(`Expected value to be one of ${Object.keys(this._enumValues).map((M=>JSON.stringify(M))).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function Ca(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in pl}function en(t,e){const r=new Xu(pl,[],e?(function(l){const d={color:Bi,string:Dr,number:Rt,enum:Dr,boolean:Sr,formatted:_a,resolvedImage:$r};return l.type==="array"?Ji(d[l.value]||mr,l.length):d[l.type]})(e):void 0),i=r.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return i?cc(new dc(i,e)):Ko(r.errors)}class pc{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!bo(r.expression)}evaluateWithoutErrorHandling(e,r,i,l,d,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,i,l,d,m)}evaluate(e,r,i,l,d,m){return this._styleExpression.evaluate(e,r,i,l,d,m)}}class Jo{constructor(e,r,i,l){this.kind=e,this.zoomStops=i,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!bo(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,i,l,d,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,i,l,d,m)}evaluate(e,r,i,l,d,m){return this._styleExpression.evaluate(e,r,i,l,d,m)}interpolationFactor(e,r,i){return this.interpolationType?Fi.interpolationFactor(this.interpolationType,e,r,i):0}}function So(t,e){if((t=en(t,e)).result==="error")return t;const r=t.value.expression,i=al(r);if(!i&&!ka(e))return Ko([new Xi("","data expressions not supported")]);const l=Zo(r,["zoom","pitch","distance-from-center"]);if(!l&&!uc(e))return Ko([new Xi("","zoom expressions not supported")]);const d=gl(r);return d||l?d instanceof Xi?Ko([d]):d instanceof Fi&&!hc(e)?Ko([new Xi("",'"interpolate" expressions cannot be used with this property')]):cc(d?new Jo(i?"camera":"composite",t.value,d.labels,d instanceof Fi?d.interpolation:void 0):new pc(i?"constant":"source",t.value)):Ko([new Xi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class fc{constructor(e,r){this._parameters=e,this._specification=r,Xn(this,ml(this._parameters,this._specification))}static deserialize(e){return new fc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function gl(t){let e=null;if(t instanceof id)e=gl(t.result);else if(t instanceof ih){for(const r of t.args)if(e=gl(r),e)break}else(t instanceof Ku||t instanceof Fi)&&t.input instanceof _s&&t.input.name==="zoom"&&(e=t);return e instanceof Xi||t.eachChild((r=>{const i=gl(r);i instanceof Xi?e=i:!e&&i?e=new Xi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&i&&e!==i&&(e=new Xi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}class It{constructor(e,r,i,l){this.message=(e?`${e}: `:"")+i,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function Ui(t){const e=t.key,r=t.value,i=t.valueSpec||{},l=t.objectElementValidators||{},d=t.style,m=t.styleSpec;let x=[];const T=Br(r);if(T!=="object")return[new It(e,r,`object expected, ${T} found`)];for(const S in r){const M=S.split(".")[0];let L;l[M]?L=l[M]:i[M]?L=Lr:l["*"]?L=l["*"]:i["*"]&&(L=Lr),L?x=x.concat(L({key:(e&&`${e}.`)+S,value:r[S],valueSpec:i[M]||i["*"],style:d,styleSpec:m,object:r,objectKey:S},r)):x.push(new It(e,r[S],`unknown property "${S}"`))}for(const S in i)l[S]||i[S].required&&i[S].default===void 0&&r[S]===void 0&&x.push(new It(e,r,`missing required property "${S}"`));return x}function Aa(t){const e=t.value,r=t.valueSpec,i=t.style,l=t.styleSpec,d=t.key,m=t.arrayElementValidator||Lr;if(Br(e)!=="array")return[new It(d,e,`array expected, ${Br(e)} found`)];if(r.length&&e.length!==r.length)return[new It(d,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new It(d,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let x={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};l.$version<7&&(x.function=r.function),Br(r.value)==="object"&&(x=r.value);let T=[];for(let S=0;S<e.length;S++)T=T.concat(m({array:e,arrayIndex:S,value:e[S],valueSpec:x,style:i,styleSpec:l,key:`${d}[${S}]`}));return T}function yl(t){const e=t.key,r=t.value,i=t.valueSpec;let l=Br(r);if(l==="number"&&r!=r&&(l="NaN"),l!=="number")return[new It(e,r,`number expected, ${l} found`)];if("minimum"in i){let d=i.minimum;if(Br(i.minimum)==="array"&&(d=i.minimum[t.arrayIndex]),r<d)return[new It(e,r,`${r} is less than the minimum value ${d}`)]}if("maximum"in i){let d=i.maximum;if(Br(i.maximum)==="array"&&(d=i.maximum[t.arrayIndex]),r>d)return[new It(e,r,`${r} is greater than the maximum value ${d}`)]}return[]}function mc(t){const e=t.valueSpec,r=Rn(t.value.type);let i,l,d,m={};const x=r!=="categorical"&&t.value.property===void 0,T=!x,S=Br(t.value.stops)==="array"&&Br(t.value.stops[0])==="array"&&Br(t.value.stops[0][0])==="object",M=Ui({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(O){if(r==="identity")return[new It(O.key,O.value,'identity function may not have a "stops" property')];let V=[];const q=O.value;return V=V.concat(Aa({key:O.key,value:q,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:L})),Br(q)==="array"&&q.length===0&&V.push(new It(O.key,q,"array must have at least one stop")),V},default:function(O){return Lr({key:O.key,value:O.value,valueSpec:e,style:O.style,styleSpec:O.styleSpec})}}});return r==="identity"&&x&&M.push(new It(t.key,t.value,'missing required property "property"')),r==="identity"||t.value.stops||M.push(new It(t.key,t.value,'missing required property "stops"')),r==="exponential"&&t.valueSpec.expression&&!hc(t.valueSpec)&&M.push(new It(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(T&&!ka(t.valueSpec)?M.push(new It(t.key,t.value,"property functions not supported")):x&&!uc(t.valueSpec)&&M.push(new It(t.key,t.value,"zoom functions not supported"))),r!=="categorical"&&!S||t.value.property!==void 0||M.push(new It(t.key,t.value,'"property" property is required')),M;function L(O){let V=[];const q=O.value,Q=O.key;if(Br(q)!=="array")return[new It(Q,q,`array expected, ${Br(q)} found`)];if(q.length!==2)return[new It(Q,q,`array length 2 expected, length ${q.length} found`)];if(S){if(Br(q[0])!=="object")return[new It(Q,q,`object expected, ${Br(q[0])} found`)];if(q[0].zoom===void 0)return[new It(Q,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new It(Q,q,"object stop key must have value")];const oe=Rn(q[0].zoom);if(typeof oe!="number")return[new It(Q,q[0].zoom,"stop zoom values must be numbers")];if(d&&d>oe)return[new It(Q,q[0].zoom,"stop zoom values must appear in ascending order")];oe!==d&&(d=oe,l=void 0,m={}),V=V.concat(Ui({key:`${Q}[0]`,value:q[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:yl,value:R}}))}else V=V.concat(R({key:`${Q}[0]`,value:q[0],style:O.style,styleSpec:O.styleSpec},q));return Ca(ri(q[1]))?V.concat([new It(`${Q}[1]`,q[1],"expressions are not allowed in function stops.")]):V.concat(Lr({key:`${Q}[1]`,value:q[1],valueSpec:e,style:O.style,styleSpec:O.styleSpec}))}function R(O,V){const q=Br(O.value),Q=Rn(O.value),oe=O.value!==null?O.value:V;if(i){if(q!==i)return[new It(O.key,oe,`${q} stop domain type must match previous stop domain type ${i}`)]}else i=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof Q!="number"&&typeof Q!="string"&&typeof Q!="boolean")return[new It(O.key,oe,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&r!=="categorical"){let pe=`number expected, ${q} found`;return ka(e)&&r===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new It(O.key,oe,pe)]}return r!=="categorical"||q!=="number"||typeof Q=="number"&&isFinite(Q)&&Math.floor(Q)===Q?r!=="categorical"&&q==="number"&&typeof Q=="number"&&typeof l=="number"&&l!==void 0&&Q<l?[new It(O.key,oe,"stop domain values must appear in ascending order")]:(l=Q,r==="categorical"&&Q in m?[new It(O.key,oe,"stop domain values must be unique")]:(m[Q]=!0,[])):[new It(O.key,oe,`integer expected, found ${String(Q)}`)]}}function si(t){const e=(t.expressionContext==="property"?So:en)(ri(t.value),t.valueSpec);if(e.result==="error")return e.value.map((i=>new It(`${t.key}${i.key}`,t.value,i.message)));const r=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!r.outputDefined())return[new It(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!bo(r))return[new It(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return _l(r,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Zo(r,["zoom","feature-state"]))return[new It(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!al(r))return[new It(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function _l(t,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const l of e.valueSpec.expression.parameters)r.delete(l);if(r.size===0)return[];const i=[];return t instanceof _s&&r.has(t.name)?[new It(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild((l=>{i.push(..._l(l,e))})),i)}function Ma(t){const e=t.key,r=t.value,i=t.valueSpec,l=[];return Array.isArray(i.values)?i.values.indexOf(Rn(r))===-1&&l.push(new It(e,r,`expected one of [${i.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(i.values).indexOf(Rn(r))===-1&&l.push(new It(e,r,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function xl(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!xl(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function vl(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};xl(t)||(t=wl(t));const r=t;let i=!0;try{i=(function(S){if(!Qo(S))return S;let M=ri(S);return bl(M),M=iu(M),M})(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const l=rt[`filter_${e}`],d=en(i,l);let m=null;if(d.result==="error")throw new Error(d.value.map((S=>`${S.key}: ${S.message}`)).join(", "));m=(S,M,L)=>d.value.evaluate(S,M,{},L);let x=null,T=null;if(i!==r){const S=en(r,l);if(S.result==="error")throw new Error(S.value.map((M=>`${M.key}: ${M.message}`)).join(", "));x=(M,L,R,O,V)=>S.value.evaluate(M,L,{},R,void 0,void 0,O,V),T=!al(S.value.expression)}return{filter:m,dynamicFilter:x||void 0,needGeometry:hd(i),needFeature:!!T}}function iu(t){if(!Array.isArray(t))return t;const e=(function(r){if(dh.has(r[0])){for(let i=1;i<r.length;i++)if(Qo(r[i]))return!0}return r})(t);return e===!0?e:e.map((r=>iu(r)))}function bl(t){let e=!1;const r=[];if(t[0]==="case"){for(let i=1;i<t.length-1;i+=2)e=e||Qo(t[i]),r.push(t[i+1]);r.push(t[t.length-1])}else if(t[0]==="match"){e=e||Qo(t[1]);for(let i=2;i<t.length-1;i+=2)r.push(t[i+1]);r.push(t[t.length-1])}else if(t[0]==="step"){e=e||Qo(t[1]);for(let i=1;i<t.length-1;i+=2)r.push(t[i+1])}e&&(t.length=0,t.push("any",...r));for(let i=1;i<t.length;i++)bl(t[i])}function Qo(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<t.length;r++)if(Qo(t[r]))return!0;return!1}const dh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ud(t,e){return t<e?-1:t>e?1:0}function hd(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(hd(t[e]))return!0;return!1}function wl(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?gc(t[1],t[2],"=="):e==="!="?Eo(gc(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?gc(t[1],t[2],e):e==="any"?(r=t.slice(1),["any"].concat(r.map(wl))):e==="all"?["all"].concat(t.slice(1).map(wl)):e==="none"?["all"].concat(t.slice(1).map(wl).map(Eo)):e==="in"?to(t[1],t.slice(2)):e==="!in"?Eo(to(t[1],t.slice(2))):e==="has"?su(t[1]):e==="!has"?Eo(su(t[1])):e!=="within"||t;var r}function gc(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function to(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((r=>typeof r!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(ud)]]:["filter-in-small",t,["literal",e]]}}function su(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Eo(t){return["!",t]}function Vi(t){return xl(ri(t.value))?si(Xn({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):ko(t)}function ko(t){const e=t.value,r=t.key;if(Br(e)!=="array")return[new It(r,e,`array expected, ${Br(e)} found`)];const i=t.styleSpec;let l,d=[];if(e.length<1)return[new It(r,e,"filter array must have at least 1 element")];switch(d=d.concat(Ma({key:`${r}[0]`,value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),Rn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Rn(e[1])==="$type"&&d.push(new It(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new It(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=Br(e[1]),l!=="string"&&d.push(new It(`${r}[1]`,e[1],`string expected, ${l} found`)));for(let m=2;m<e.length;m++)l=Br(e[m]),Rn(e[1])==="$type"?d=d.concat(Ma({key:`${r}[${m}]`,value:e[m],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&d.push(new It(`${r}[${m}]`,e[m],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)d=d.concat(ko({key:`${r}[${m}]`,value:e[m],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":l=Br(e[1]),e.length!==2?d.push(new It(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&d.push(new It(`${r}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=Br(e[1]),e.length!==2?d.push(new It(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&d.push(new It(`${r}[1]`,e[1],`object expected, ${l} found`))}return d}function zs(t,e){const r=t.key,i=t.style,l=t.styleSpec,d=t.value,m=t.objectKey,x=l[`${e}_${t.layerType}`];if(!x)return[];const T=m.match(/^(.*)-transition$/);if(e==="paint"&&T&&x[T[1]]&&x[T[1]].transition)return Lr({key:r,value:d,valueSpec:l.transition,style:i,styleSpec:l});const S=t.valueSpec||x[m];if(!S)return[new It(r,d,`unknown property "${m}"`)];let M;if(Br(d)==="string"&&ka(S)&&!S.tokens&&(M=/^{([^}]+)}$/.exec(d))){const R=`\`{ "type": "identity", "property": ${M?JSON.stringify(M[1]):'"_"'} }\``;return[new It(r,d,`"${m}" does not support interpolation syntax
Use an identity property function instead: ${R}.`)]}const L=[];return t.layerType==="symbol"&&(m==="text-field"&&i&&!i.glyphs&&L.push(new It(r,d,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&fl(ri(d))&&Rn(d.type)==="identity"&&L.push(new It(r,d,'"text-font" does not support identity functions'))),L.concat(Lr({key:t.key,value:d,valueSpec:S,style:i,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:m}))}function ou(t){return zs(t,"paint")}function ph(t){return zs(t,"layout")}function dd(t){let e=[];const r=t.value,i=t.key,l=t.style,d=t.styleSpec;r.type||r.ref||e.push(new It(i,r,'either "type" or "ref" is required'));let m=Rn(r.type);const x=Rn(r.ref);if(r.id){const T=Rn(r.id);for(let S=0;S<t.arrayIndex;S++){const M=l.layers[S];Rn(M.id)===T&&e.push(new It(i,r.id,`duplicate layer id "${r.id}", previously used at line ${M.id.__line__}`))}}if("ref"in r){let T;["type","source","source-layer","filter","layout"].forEach((S=>{S in r&&e.push(new It(i,r[S],`"${S}" is prohibited for ref layers`))})),l.layers.forEach((S=>{Rn(S.id)===x&&(T=S)})),T?T.ref?e.push(new It(i,r.ref,"ref cannot reference another ref layer")):m=Rn(T.type):typeof x=="string"&&e.push(new It(i,r.ref,`ref layer "${x}" not found`))}else if(m!=="background"&&m!=="sky")if(r.source){const T=l.sources&&l.sources[r.source],S=T&&Rn(T.type);T?S==="vector"&&m==="raster"?e.push(new It(i,r.source,`layer "${r.id}" requires a raster source`)):S==="raster"&&m!=="raster"?e.push(new It(i,r.source,`layer "${r.id}" requires a vector source`)):S!=="vector"||r["source-layer"]?S==="raster-dem"&&m!=="hillshade"?e.push(new It(i,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||S==="geojson"&&T.lineMetrics||e.push(new It(i,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new It(i,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new It(i,r.source,`source "${r.source}" not found`))}else e.push(new It(i,r,'missing required property "source"'));return e=e.concat(Ui({key:i,value:r,valueSpec:d.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Lr({key:`${i}.type`,value:r.type,valueSpec:d.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"}),filter:T=>Vi(Xn({layerType:m},T)),layout:T=>Ui({layer:r,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":S=>ph(Xn({layerType:m},S))}}),paint:T=>Ui({layer:r,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":S=>ou(Xn({layerType:m},S))}})}})),e}function $i(t){const e=t.value,r=t.key,i=Br(e);return i!=="string"?[new It(r,e,`string expected, ${i} found`)]:[]}const Tl={promoteId:function({key:t,value:e}){if(Br(e)==="string")return $i({key:t,value:e});{const r=[];for(const i in e)r.push(...$i({key:`${t}.${i}`,value:e[i]}));return r}}};function Pa(t){const e=t.value,r=t.key,i=t.styleSpec,l=t.style;if(!e.type)return[new It(r,e,'"type" is required')];const d=Rn(e.type);let m;switch(d){case"vector":case"raster":case"raster-dem":return m=Ui({key:r,value:e,valueSpec:i[`source_${d.replace("-","_")}`],style:t.style,styleSpec:i,objectElementValidators:Tl}),m;case"geojson":if(m=Ui({key:r,value:e,valueSpec:i.source_geojson,style:l,styleSpec:i,objectElementValidators:Tl}),e.cluster)for(const x in e.clusterProperties){const[T,S]=e.clusterProperties[x],M=typeof T=="string"?[T,["accumulated"],["get",x]]:T;m.push(...si({key:`${r}.${x}.map`,value:S,expressionContext:"cluster-map"})),m.push(...si({key:`${r}.${x}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return m;case"video":return Ui({key:r,value:e,valueSpec:i.source_video,style:l,styleSpec:i});case"image":return Ui({key:r,value:e,valueSpec:i.source_image,style:l,styleSpec:i});case"canvas":return[new It(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ma({key:`${r}.type`,value:e.type,valueSpec:{values:au(i)}})}}function au(t){return t.source.reduce(((e,r)=>{const i=t[r];return i.type.type==="enum"&&(e=e.concat(Object.keys(i.type.values))),e}),[])}function lu(t){const e=t.value,r=t.styleSpec,i=r.light,l=t.style;let d=[];const m=Br(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new It("light",e,`object expected, ${m} found`)]),d;for(const x in e){const T=x.match(/^(.*)-transition$/);d=d.concat(T&&i[T[1]]&&i[T[1]].transition?Lr({key:x,value:e[x],valueSpec:r.transition,style:l,styleSpec:r}):i[x]?Lr({key:x,value:e[x],valueSpec:i[x],style:l,styleSpec:r}):[new It(x,e[x],`unknown property "${x}"`)])}return d}function ea(t){const e=t.value,r=t.key,i=t.style,l=t.styleSpec,d=l.terrain;let m=[];const x=Br(e);if(e===void 0)return m;if(x!=="object")return m=m.concat([new It("terrain",e,`object expected, ${x} found`)]),m;for(const T in e){const S=T.match(/^(.*)-transition$/);m=m.concat(S&&d[S[1]]&&d[S[1]].transition?Lr({key:T,value:e[T],valueSpec:l.transition,style:i,styleSpec:l}):d[T]?Lr({key:T,value:e[T],valueSpec:d[T],style:i,styleSpec:l}):[new It(T,e[T],`unknown property "${T}"`)])}if(e.source){const T=i.sources&&i.sources[e.source],S=T&&Rn(T.type);T?S!=="raster-dem"&&m.push(new It(r,e.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):m.push(new It(r,e.source,`source "${e.source}" not found`))}else m.push(new It(r,e,'terrain is missing required property "source"'));return m}function Co(t){const e=t.value,r=t.style,i=t.styleSpec,l=i.fog;let d=[];const m=Br(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new It("fog",e,`object expected, ${m} found`)]),d;for(const x in e){const T=x.match(/^(.*)-transition$/);d=d.concat(T&&l[T[1]]&&l[T[1]].transition?Lr({key:x,value:e[x],valueSpec:i.transition,style:r,styleSpec:i}):l[x]?Lr({key:x,value:e[x],valueSpec:l[x],style:r,styleSpec:i}):[new It(x,e[x],`unknown property "${x}"`)])}return d}const mn={"*":()=>[],array:Aa,boolean:function(t){const e=t.value,r=t.key,i=Br(e);return i!=="boolean"?[new It(r,e,`boolean expected, ${i} found`)]:[]},number:yl,color:function(t){const e=t.key,r=t.value,i=Br(r);return i!=="string"?[new It(e,r,`color expected, ${i} found`)]:Xl(r)===null?[new It(e,r,`color expected, "${r}" found`)]:[]},enum:Ma,filter:Vi,function:mc,layer:dd,object:Ui,source:Pa,light:lu,terrain:ea,fog:Co,string:$i,formatted:function(t){return $i(t).length===0?[]:si(t)},resolvedImage:function(t){return $i(t).length===0?[]:si(t)},projection:function(t){const e=t.value,r=t.styleSpec,i=r.projection,l=t.style;let d=[];const m=Br(e);if(m==="object")for(const x in e)d=d.concat(Lr({key:x,value:e[x],valueSpec:i[x],style:l,styleSpec:r}));else m!=="string"&&(d=d.concat([new It("projection",e,`object or string expected, ${m} found`)]));return d}};function Lr(t){const e=t.value,r=t.valueSpec,i=t.styleSpec;return r.expression&&fl(Rn(e))?mc(t):r.expression&&Ca(ri(e))?si(t):r.type&&mn[r.type]?mn[r.type](t):Ui(Xn({},t,{valueSpec:r.type?i[r.type]:r}))}function ta(t){const e=t.value,r=t.key,i=$i(t);return i.length||(e.indexOf("{fontstack}")===-1&&i.push(new It(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&i.push(new It(r,e,'"glyphs" url must include a "{range}" token'))),i}function pi(t,e=rt){return fi(Lr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:ta,"*":()=>[]}}))}const Gi=t=>fi(ou(t)),Ia=t=>fi(ph(t));function fi(t){return t.slice().sort(((e,r)=>e.line&&r.line?e.line-r.line:0))}function Pi(t,e){let r=!1;if(e&&e.length)for(const i of e)t.fire(new ps(new Error(i.message))),r=!0;return r}var cu=Ns,bs=3;function Ns(t,e,r){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var l=new Int32Array(this.arrayBuffer);t=l[0],this.d=(e=l[1])+2*(r=l[2]);for(var d=0;d<this.d*this.d;d++){var m=l[bs+d],x=l[bs+d+1];i.push(m===x?null:l.subarray(m,x))}var T=l[bs+i.length+1];this.keys=l.subarray(l[bs+i.length],T),this.bboxes=l.subarray(T),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var S=0;S<this.d*this.d;S++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var M=r/e*t;this.min=-M,this.max=t+M}Ns.prototype.insert=function(t,e,r,i,l){this._forEachCell(e,r,i,l,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(l)},Ns.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ns.prototype._insertCell=function(t,e,r,i,l,d){this.cells[l].push(d)},Ns.prototype.query=function(t,e,r,i,l){var d=this.min,m=this.max;if(t<=d&&e<=d&&m<=r&&m<=i&&!l)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(t,e,r,i,this._queryCell,x,{},l),x},Ns.prototype._queryCell=function(t,e,r,i,l,d,m,x){var T=this.cells[l];if(T!==null)for(var S=this.keys,M=this.bboxes,L=0;L<T.length;L++){var R=T[L];if(m[R]===void 0){var O=4*R;(x?x(M[O+0],M[O+1],M[O+2],M[O+3]):t<=M[O+2]&&e<=M[O+3]&&r>=M[O+0]&&i>=M[O+1])?(m[R]=!0,d.push(S[R])):m[R]=!1}}},Ns.prototype._forEachCell=function(t,e,r,i,l,d,m,x){for(var T=this._convertToCellCoord(t),S=this._convertToCellCoord(e),M=this._convertToCellCoord(r),L=this._convertToCellCoord(i),R=T;R<=M;R++)for(var O=S;O<=L;O++){var V=this.d*O+R;if((!x||x(this._convertFromCellCoord(R),this._convertFromCellCoord(O),this._convertFromCellCoord(R+1),this._convertFromCellCoord(O+1)))&&l.call(this,t,e,r,i,V,d,m,x))return}},Ns.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Ns.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Ns.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=bs+this.cells.length+1+1,r=0,i=0;i<this.cells.length;i++)r+=this.cells[i].length;var l=new Int32Array(e+r+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var d=e,m=0;m<t.length;m++){var x=t[m];l[bs+m]=d,l.set(x,d),d+=x.length}return l[bs+t.length]=d,l.set(this.keys,d),l[bs+t.length+1]=d+=this.keys.length,l.set(this.bboxes,d),d+=this.bboxes.length,l.buffer};var ro=lt(cu);const yc={};function Lt(t,e,r={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),yc[e]={klass:t,omit:r.omit||[]}}Lt(Object,"Object"),ro.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},ro.deserialize=function(t){return new ro(t.buffer)},Object.defineProperty(ro,"name",{value:"Grid"}),Lt(ro,"Grid"),Lt(tn,"Color"),Lt(Error,"Error"),Lt(Uo,"AJAXError"),Lt(gs,"ResolvedImage"),Lt(fc,"StylePropertyFunction"),Lt(dc,"StyleExpression",{omit:["_evaluator"]}),Lt(Jo,"ZoomDependentExpression"),Lt(pc,"ZoomConstantExpression"),Lt(_s,"CompoundExpression",{omit:["_evaluate"]});for(const t in pl)yc[pl[t]._classRegistryKey]||Lt(pl[t],`Expression${t}`);function Sl(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function _c(t){return U.ImageBitmap&&t instanceof U.ImageBitmap}function Da(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Sl(t)||_c(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const r=t;return e&&e.push(r.buffer),r}if(t instanceof U.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const i of t)r.push(Da(i,e));return r}if(typeof t=="object"){const r=t.constructor,i=r._classRegistryKey;if(!i)throw new Error(`can't serialize object of unregistered class ${i}`);const l=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const d in t)t.hasOwnProperty(d)&&(yc[i].omit.indexOf(d)>=0||(l[d]=Da(t[d],e)));t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(l.$name=i),l}throw new Error("can't serialize object of type "+typeof t)}function La(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Sl(t)||_c(t)||ArrayBuffer.isView(t)||t instanceof U.ImageData)return t;if(Array.isArray(t))return t.map(La);if(typeof t=="object"){const e=t.$name||"Object",{klass:r}=yc[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);const i=Object.create(r.prototype);for(const l of Object.keys(t))l!=="$name"&&(i[l]=La(t[l]));return i}throw new Error("can't deserialize object of type "+typeof t)}const Pt={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function ra(t){for(const e of t)if(kl(e.charCodeAt(0)))return!0;return!1}function El(t){for(const e of t)if(!xc(e.charCodeAt(0)))return!1;return!0}function xc(t){return!(Pt.Arabic(t)||Pt["Arabic Supplement"](t)||Pt["Arabic Extended-A"](t)||Pt["Arabic Presentation Forms-A"](t)||Pt["Arabic Presentation Forms-B"](t))}function kl(t){return!(t!==746&&t!==747&&(t<4352||!(Pt["Bopomofo Extended"](t)||Pt.Bopomofo(t)||Pt["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Pt["CJK Compatibility Ideographs"](t)||Pt["CJK Compatibility"](t)||Pt["CJK Radicals Supplement"](t)||Pt["CJK Strokes"](t)||!(!Pt["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Pt["CJK Unified Ideographs Extension A"](t)||Pt["CJK Unified Ideographs"](t)||Pt["Enclosed CJK Letters and Months"](t)||Pt["Hangul Compatibility Jamo"](t)||Pt["Hangul Jamo Extended-A"](t)||Pt["Hangul Jamo Extended-B"](t)||Pt["Hangul Jamo"](t)||Pt["Hangul Syllables"](t)||Pt.Hiragana(t)||Pt["Ideographic Description Characters"](t)||Pt.Kanbun(t)||Pt["Kangxi Radicals"](t)||Pt["Katakana Phonetic Extensions"](t)||Pt.Katakana(t)&&t!==12540||!(!Pt["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Pt["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Pt["Unified Canadian Aboriginal Syllabics"](t)||Pt["Unified Canadian Aboriginal Syllabics Extended"](t)||Pt["Vertical Forms"](t)||Pt["Yijing Hexagram Symbols"](t)||Pt["Yi Syllables"](t)||Pt["Yi Radicals"](t))))}function ts(t){return!(kl(t)||(function(e){return!!(Pt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Pt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Pt["Letterlike Symbols"](e)||Pt["Number Forms"](e)||Pt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Pt["Control Pictures"](e)&&e!==9251||Pt["Optical Character Recognition"](e)||Pt["Enclosed Alphanumerics"](e)||Pt["Geometric Shapes"](e)||Pt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Pt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Pt["CJK Symbols and Punctuation"](e)||Pt.Katakana(e)||Pt["Private Use Area"](e)||Pt["CJK Compatibility Forms"](e)||Pt["Small Form Variants"](e)||Pt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(t))}function rs(t){return t>=1424&&t<=2303||Pt["Arabic Presentation Forms-A"](t)||Pt["Arabic Presentation Forms-B"](t)}function ja(t,e){return!(!e&&rs(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Pt.Khmer(t))}function Ao(t){for(const e of t)if(rs(e.charCodeAt(0)))return!0;return!1}const Bs="deferred",Mo="loading",uu="loaded";let na=null,h="unavailable",n=null;const a=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(h="error"),na&&na(t)};function f(){y.fire(new $o("pluginStateChange",{pluginStatus:h,pluginURL:n}))}const y=new Ni,b=function(){return h},C=function(){if(h!==Bs||!n)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");h=Mo,f(),n&&Vo({url:n},(t=>{t?a(t):(h=uu,f())}))},A={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>h===uu||A.applyArabicShaping!=null,isLoading:()=>h===Mo,setState(t){h=t.pluginStatus,n=t.pluginURL},isParsed:()=>A.applyArabicShaping!=null&&A.processBidirectionalText!=null&&A.processStyledBidirectionalText!=null,getPluginURL:()=>n};class I{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return(function(r,i){for(const l of r)if(!ja(l.charCodeAt(0),i))return!1;return!0})(e,A.isLoaded())}}class N{constructor(e,r){this.property=e,this.value=r,this.expression=(function(i,l){if(fl(i))return new fc(i,l);if(Ca(i)){const d=So(i,l);if(d.result==="error")throw new Error(d.value.map((m=>`${m.key}: ${m.message}`)).join(", "));return d.value}{let d=i;return typeof i=="string"&&l.type==="color"&&(d=tn.parse(i)),{kind:"constant",evaluate:()=>d}}})(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,i){return this.property.possiblyEvaluate(this,e,r,i)}}class z{constructor(e){this.property=e,this.value=new N(e,void 0)}transitioned(e,r){return new K(this.property,this.value,r,Ot({},e.transition,this.transition),e.now)}untransitioned(){return new K(this.property,this.value,null,{},0)}}class ${constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return di(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new z(this._values[e].property)),this._values[e].value=new N(this._values[e].property,r===null?void 0:di(r))}getTransition(e){return di(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new z(this._values[e].property)),this._values[e].transition=di(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const i=this.getValue(r);i!==void 0&&(e[r]=i);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const i=new re(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].transitioned(e,r._values[l]);return i}untransitioned(){const e=new re(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class K{constructor(e,r,i,l,d){const m=l.delay||0,x=l.duration||0;d=d||0,this.property=e,this.value=r,this.begin=d+m,this.end=this.begin+x,e.specification.transition&&(l.delay||l.duration)&&(this.prior=i)}possiblyEvaluate(e,r,i){const l=e.now||0,d=this.value.possiblyEvaluate(e,r,i),m=this.prior;if(m){if(l>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(l<this.begin)return m.possiblyEvaluate(e,r,i);{const x=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,r,i),d,ir(x))}}return d}}class re{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,i){const l=new se(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(e,r,i);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ie{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return di(this._values[e].value)}setValue(e,r){this._values[e]=new N(this._values[e].property,r===null?void 0:di(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const i=this.getValue(r);i!==void 0&&(e[r]=i)}return e}possiblyEvaluate(e,r,i){const l=new se(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(e,r,i);return l}}class ne{constructor(e,r,i){this.property=e,this.value=r,this.parameters=i}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,i,l){return this.property.evaluate(this.value,this.parameters,e,r,i,l)}}class se{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class W{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,i){const l=rc[this.specification.type];return l?l(e,r,i):e}}class te{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,i,l){return new ne(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},i,l)}:e.expression,r)}interpolate(e,r,i){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new ne(this,{kind:"constant",value:void 0},e.parameters);const l=rc[this.specification.type];return l?new ne(this,{kind:"constant",value:l(e.value.value,r.value.value,i)},e.parameters):e}evaluate(e,r,i,l,d,m){return e.kind==="constant"?e.value:e.evaluate(r,i,l,d,m)}}class le{constructor(e){this.specification=e}possiblyEvaluate(e,r,i,l){return!!e.expression.evaluate(r,null,{},i,l)}interpolate(){return!1}}class ce{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new I(0,{});for(const i in e){const l=e[i];l.specification.overridable&&this.overridableProperties.push(i);const d=this.defaultPropertyValues[i]=new N(l,void 0),m=this.defaultTransitionablePropertyValues[i]=new z(l);this.defaultTransitioningPropertyValues[i]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=d.possiblyEvaluate(r)}}}function xe(t,e){return 256*(t=Fe(Math.floor(t),0,255))+Fe(Math.floor(e),0,255)}Lt(te,"DataDrivenProperty"),Lt(W,"DataConstantProperty"),Lt(le,"ColorRampProperty");const be={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ve{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pe{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ce(t,e=1){let r=0,i=0;return{members:t.map((l=>{const d=be[l.type].BYTES_PER_ELEMENT,m=r=Oe(r,Math.max(e,d)),x=l.components||1;return i=Math.max(i,d),r+=d*x,{name:l.name,type:l.type,components:x,offset:m}})),size:Oe(r,Math.max(i,e)),alignment:e}}function Oe(t,e){return Math.ceil(t/e)*e}class ft extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,r)}emplace(e,r,i){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=i,e}}ft.prototype.bytesPerElement=4,Lt(ft,"StructArrayLayout2i4");class je extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,i)}emplace(e,r,i,l){const d=3*e;return this.int16[d+0]=r,this.int16[d+1]=i,this.int16[d+2]=l,e}}je.prototype.bytesPerElement=6,Lt(je,"StructArrayLayout3i6");class Je extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,i,l)}emplace(e,r,i,l,d){const m=4*e;return this.int16[m+0]=r,this.int16[m+1]=i,this.int16[m+2]=l,this.int16[m+3]=d,e}}Je.prototype.bytesPerElement=8,Lt(Je,"StructArrayLayout4i8");class Ve extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,i,l,d,m,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,i,l,d,m,x)}emplace(e,r,i,l,d,m,x,T){const S=6*e,M=12*e,L=3*e;return this.int16[S+0]=r,this.int16[S+1]=i,this.uint8[M+4]=l,this.uint8[M+5]=d,this.uint8[M+6]=m,this.uint8[M+7]=x,this.float32[L+2]=T,e}}Ve.prototype.bytesPerElement=12,Lt(Ve,"StructArrayLayout2i4ub1f12");class dt extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,i,l)}emplace(e,r,i,l,d){const m=4*e;return this.float32[m+0]=r,this.float32[m+1]=i,this.float32[m+2]=l,this.float32[m+3]=d,e}}dt.prototype.bytesPerElement=16,Lt(dt,"StructArrayLayout4f16");class Be extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,i,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,i,l,d)}emplace(e,r,i,l,d,m){const x=6*e,T=3*e;return this.uint16[x+0]=r,this.uint16[x+1]=i,this.uint16[x+2]=l,this.uint16[x+3]=d,this.float32[T+2]=m,e}}Be.prototype.bytesPerElement=12,Lt(Be,"StructArrayLayout4ui1f12");class Qe extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,i,l)}emplace(e,r,i,l,d){const m=4*e;return this.uint16[m+0]=r,this.uint16[m+1]=i,this.uint16[m+2]=l,this.uint16[m+3]=d,e}}Qe.prototype.bytesPerElement=8,Lt(Qe,"StructArrayLayout4ui8");class ht extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,i,l,d,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,i,l,d,m)}emplace(e,r,i,l,d,m,x){const T=6*e;return this.int16[T+0]=r,this.int16[T+1]=i,this.int16[T+2]=l,this.int16[T+3]=d,this.int16[T+4]=m,this.int16[T+5]=x,e}}ht.prototype.bytesPerElement=12,Lt(ht,"StructArrayLayout6i12");class ct extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,i,l,d,m,x,T,S,M,L,R){const O=this.length;return this.resize(O+1),this.emplace(O,e,r,i,l,d,m,x,T,S,M,L,R)}emplace(e,r,i,l,d,m,x,T,S,M,L,R,O){const V=12*e;return this.int16[V+0]=r,this.int16[V+1]=i,this.int16[V+2]=l,this.int16[V+3]=d,this.uint16[V+4]=m,this.uint16[V+5]=x,this.uint16[V+6]=T,this.uint16[V+7]=S,this.int16[V+8]=M,this.int16[V+9]=L,this.int16[V+10]=R,this.int16[V+11]=O,e}}ct.prototype.bytesPerElement=24,Lt(ct,"StructArrayLayout4i4ui4i24");class gt extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,i,l,d,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,i,l,d,m)}emplace(e,r,i,l,d,m,x){const T=10*e,S=5*e;return this.int16[T+0]=r,this.int16[T+1]=i,this.int16[T+2]=l,this.float32[S+2]=d,this.float32[S+3]=m,this.float32[S+4]=x,e}}gt.prototype.bytesPerElement=20,Lt(gt,"StructArrayLayout3i3f20");class Ut extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Ut.prototype.bytesPerElement=4,Lt(Ut,"StructArrayLayout1ul4");class er extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,i,l,d,m,x,T,S,M,L,R,O){const V=this.length;return this.resize(V+1),this.emplace(V,e,r,i,l,d,m,x,T,S,M,L,R,O)}emplace(e,r,i,l,d,m,x,T,S,M,L,R,O,V){const q=20*e,Q=10*e;return this.int16[q+0]=r,this.int16[q+1]=i,this.int16[q+2]=l,this.int16[q+3]=d,this.int16[q+4]=m,this.float32[Q+3]=x,this.float32[Q+4]=T,this.float32[Q+5]=S,this.float32[Q+6]=M,this.int16[q+14]=L,this.uint32[Q+8]=R,this.uint16[q+18]=O,this.uint16[q+19]=V,e}}er.prototype.bytesPerElement=40,Lt(er,"StructArrayLayout5i4f1i1ul2ui40");class Nt extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,i,l,d,m,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,i,l,d,m,x)}emplace(e,r,i,l,d,m,x,T){const S=8*e;return this.int16[S+0]=r,this.int16[S+1]=i,this.int16[S+2]=l,this.int16[S+4]=d,this.int16[S+5]=m,this.int16[S+6]=x,this.int16[S+7]=T,e}}Nt.prototype.bytesPerElement=16,Lt(Nt,"StructArrayLayout3i2i2i16");class Xt extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,i,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,i,l,d)}emplace(e,r,i,l,d,m){const x=4*e,T=8*e;return this.float32[x+0]=r,this.float32[x+1]=i,this.float32[x+2]=l,this.int16[T+6]=d,this.int16[T+7]=m,e}}Xt.prototype.bytesPerElement=16,Lt(Xt,"StructArrayLayout2f1f2i16");class br extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,i,l)}emplace(e,r,i,l,d){const m=12*e,x=3*e;return this.uint8[m+0]=r,this.uint8[m+1]=i,this.float32[x+1]=l,this.float32[x+2]=d,e}}br.prototype.bytesPerElement=12,Lt(br,"StructArrayLayout2ub2f12");class Er extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,i)}emplace(e,r,i,l){const d=3*e;return this.float32[d+0]=r,this.float32[d+1]=i,this.float32[d+2]=l,e}}Er.prototype.bytesPerElement=12,Lt(Er,"StructArrayLayout3f12");class Vt extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,i)}emplace(e,r,i,l){const d=3*e;return this.uint16[d+0]=r,this.uint16[d+1]=i,this.uint16[d+2]=l,e}}Vt.prototype.bytesPerElement=6,Lt(Vt,"StructArrayLayout3ui6");class Ir extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,i,l,d,m,x,T,S,M,L,R,O,V,q,Q,oe,pe,ae,de,ye){const ge=this.length;return this.resize(ge+1),this.emplace(ge,e,r,i,l,d,m,x,T,S,M,L,R,O,V,q,Q,oe,pe,ae,de,ye)}emplace(e,r,i,l,d,m,x,T,S,M,L,R,O,V,q,Q,oe,pe,ae,de,ye,ge){const Ge=30*e,Ne=15*e,nt=60*e;return this.int16[Ge+0]=r,this.int16[Ge+1]=i,this.int16[Ge+2]=l,this.float32[Ne+2]=d,this.float32[Ne+3]=m,this.uint16[Ge+8]=x,this.uint16[Ge+9]=T,this.uint32[Ne+5]=S,this.uint32[Ne+6]=M,this.uint32[Ne+7]=L,this.uint16[Ge+16]=R,this.uint16[Ge+17]=O,this.uint16[Ge+18]=V,this.float32[Ne+10]=q,this.float32[Ne+11]=Q,this.uint8[nt+48]=oe,this.uint8[nt+49]=pe,this.uint8[nt+50]=ae,this.uint32[Ne+13]=de,this.int16[Ge+28]=ye,this.uint8[nt+58]=ge,e}}Ir.prototype.bytesPerElement=60,Lt(Ir,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Gr extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,i,l,d,m,x,T,S,M,L,R,O,V,q,Q,oe,pe,ae,de,ye,ge,Ge,Ne,nt,yt,Ze,ot,at,pt){const wt=this.length;return this.resize(wt+1),this.emplace(wt,e,r,i,l,d,m,x,T,S,M,L,R,O,V,q,Q,oe,pe,ae,de,ye,ge,Ge,Ne,nt,yt,Ze,ot,at,pt)}emplace(e,r,i,l,d,m,x,T,S,M,L,R,O,V,q,Q,oe,pe,ae,de,ye,ge,Ge,Ne,nt,yt,Ze,ot,at,pt,wt){const et=38*e,Dt=19*e;return this.int16[et+0]=r,this.int16[et+1]=i,this.int16[et+2]=l,this.float32[Dt+2]=d,this.float32[Dt+3]=m,this.int16[et+8]=x,this.int16[et+9]=T,this.int16[et+10]=S,this.int16[et+11]=M,this.int16[et+12]=L,this.int16[et+13]=R,this.uint16[et+14]=O,this.uint16[et+15]=V,this.uint16[et+16]=q,this.uint16[et+17]=Q,this.uint16[et+18]=oe,this.uint16[et+19]=pe,this.uint16[et+20]=ae,this.uint16[et+21]=de,this.uint16[et+22]=ye,this.uint16[et+23]=ge,this.uint16[et+24]=Ge,this.uint16[et+25]=Ne,this.uint16[et+26]=nt,this.uint16[et+27]=yt,this.uint16[et+28]=Ze,this.uint32[Dt+15]=ot,this.float32[Dt+16]=at,this.float32[Dt+17]=pt,this.float32[Dt+18]=wt,e}}Gr.prototype.bytesPerElement=76,Lt(Gr,"StructArrayLayout3i2f6i15ui1ul3f76");class Wr extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Wr.prototype.bytesPerElement=4,Lt(Wr,"StructArrayLayout1f4");class Or extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,i,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,i,l,d)}emplace(e,r,i,l,d,m){const x=5*e;return this.float32[x+0]=r,this.float32[x+1]=i,this.float32[x+2]=l,this.float32[x+3]=d,this.float32[x+4]=m,e}}Or.prototype.bytesPerElement=20,Lt(Or,"StructArrayLayout5f20");class oi extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,i,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,i,l)}emplace(e,r,i,l,d){const m=6*e;return this.uint32[3*e+0]=r,this.uint16[m+2]=i,this.uint16[m+3]=l,this.uint16[m+4]=d,e}}oi.prototype.bytesPerElement=12,Lt(oi,"StructArrayLayout1ul3ui12");class Sn extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,r)}emplace(e,r,i){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=i,e}}Sn.prototype.bytesPerElement=4,Lt(Sn,"StructArrayLayout2ui4");class ns extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}ns.prototype.bytesPerElement=2,Lt(ns,"StructArrayLayout1ui2");class ws extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,r)}emplace(e,r,i){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=i,e}}ws.prototype.bytesPerElement=8,Lt(ws,"StructArrayLayout2f8");class pr extends ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}pr.prototype.size=40;class Kr extends er{get(e){return new pr(this,e)}}Lt(Kr,"CollisionBoxArray");class Fr extends ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Fr.prototype.size=60;class En extends Ir{get(e){return new Fr(this,e)}}Lt(En,"PlacedSymbolArray");class ai extends ve{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ai.prototype.size=76;class rn extends Gr{get(e){return new ai(this,e)}}Lt(rn,"SymbolInstanceArray");class Un extends Wr{getoffsetX(e){return this.float32[1*e+0]}}Lt(Un,"GlyphOffsetArray");class gn extends ft{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Lt(gn,"SymbolLineVertexArray");class xn extends ve{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}xn.prototype.size=12;class Mn extends oi{get(e){return new xn(this,e)}}Lt(Mn,"FeatureIndexArray");class Ts extends Sn{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Lt(Ts,"FillExtrusionCentroidArray");const Ss=Ce([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Fs=Ce([{name:"a_dash",components:4,type:"Uint16"}]);var hu={exports:{}},Vn={exports:{}};Vn.exports=function(t,e){var r,i,l,d,m,x,T,S;for(i=t.length-(r=3&t.length),l=e,m=3432918353,x=461845907,S=0;S<i;)T=255&t.charCodeAt(S)|(255&t.charCodeAt(++S))<<8|(255&t.charCodeAt(++S))<<16|(255&t.charCodeAt(++S))<<24,++S,l=27492+(65535&(d=5*(65535&(l=(l^=T=(65535&(T=(T=(65535&T)*m+(((T>>>16)*m&65535)<<16)&4294967295)<<15|T>>>17))*x+(((T>>>16)*x&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(T=0,r){case 3:T^=(255&t.charCodeAt(S+2))<<16;case 2:T^=(255&t.charCodeAt(S+1))<<8;case 1:l^=T=(65535&(T=(T=(65535&(T^=255&t.charCodeAt(S)))*m+(((T>>>16)*m&65535)<<16)&4294967295)<<15|T>>>17))*x+(((T>>>16)*x&65535)<<16)&4294967295}return l^=t.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var vc=Vn.exports,pd={exports:{}};pd.exports=function(t,e){for(var r,i=t.length,l=e^i,d=0;i>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(d)|(255&t.charCodeAt(++d))<<8|(255&t.charCodeAt(++d))<<16|(255&t.charCodeAt(++d))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),i-=4,++d;switch(i){case 3:l^=(255&t.charCodeAt(d+2))<<16;case 2:l^=(255&t.charCodeAt(d+1))<<8;case 1:l=1540483477*(65535&(l^=255&t.charCodeAt(d)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var fd=vc,ia=pd.exports;hu.exports=fd,hu.exports.murmur3=fd,hu.exports.murmur2=ia;var Es=lt(hu.exports);class Cl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,i,l){this.ids.push(md(e)),this.positions.push(r,i,l)}getPositions(e){const r=md(e);let i=0,l=this.ids.length-1;for(;i<l;){const m=i+l>>1;this.ids[m]>=r?l=m:i=m+1}const d=[];for(;this.ids[i]===r;)d.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return d}static serialize(e,r){const i=new Float64Array(e.ids),l=new Uint32Array(e.positions);return fh(i,l,0,i.length-1),r&&r.push(i.buffer,l.buffer),{ids:i,positions:l}}static deserialize(e){const r=new Cl;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function md(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Es(String(t))}function fh(t,e,r,i){for(;r<i;){const l=t[r+i>>1];let d=r-1,m=i+1;for(;;){do d++;while(t[d]<l);do m--;while(t[m]>l);if(d>=m)break;mh(t,d,m),mh(e,3*d,3*m),mh(e,3*d+1,3*m+1),mh(e,3*d+2,3*m+2)}m-r<i-m?(fh(t,e,r,m),r=m+1):(fh(t,e,m+1,i),i=m)}}function mh(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}Lt(Cl,"FeaturePositionMap");class sa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class gh extends sa{constructor(e){super(e),this.current=0}set(e,r,i){this.fetchUniformLocation(e,r)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class xp extends sa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,i){this.fetchUniformLocation(e,r)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class vp extends sa{constructor(e){super(e),this.current=tn.transparent}set(e,r,i){this.fetchUniformLocation(e,r)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const Uf=new Float32Array(16),Vf=new Float32Array(9),$f=new Float32Array(4);function bc(t){return[xe(255*t.r,255*t.g),xe(255*t.b,255*t.a)]}class du{constructor(e,r,i){this.value=e,this.uniformNames=r.map((l=>`u_${l}`)),this.type=i}setUniform(e,r,i,l,d){r.set(e,d,l.constantOr(this.value))}getBinding(e,r){return this.type==="color"?new vp(e):new gh(e)}}class Ra{constructor(e,r){this.uniformNames=r.map((i=>`u_${i}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,i,l,d){const m=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;m&&r.set(e,d,m)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new xp(e):new gh(e)}}class no{constructor(e,r,i,l){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=r.map((d=>({name:`a_${d}`,type:"Float32",components:i==="color"?2:1,offset:0}))),this.paintVertexArray=new l}populatePaintArray(e,r,i,l,d,m){const x=this.paintVertexArray.length,T=this.expression.evaluate(new I(0),r,{},d,l,m);this.paintVertexArray.resize(e),this._setPaintValue(x,e,T)}updatePaintArray(e,r,i,l,d){const m=this.expression.evaluate({zoom:0},i,l,void 0,d);this._setPaintValue(e,r,m)}_setPaintValue(e,r,i){if(this.type==="color"){const l=bc(i);for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class io{constructor(e,r,i,l,d,m){this.expression=e,this.uniformNames=r.map((x=>`u_${x}_t`)),this.type=i,this.useIntegerZoom=l,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map((x=>({name:`a_${x}`,type:"Float32",components:i==="color"?4:2,offset:0}))),this.paintVertexArray=new m}populatePaintArray(e,r,i,l,d,m){const x=this.expression.evaluate(new I(this.zoom),r,{},d,l,m),T=this.expression.evaluate(new I(this.zoom+1),r,{},d,l,m),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,x,T)}updatePaintArray(e,r,i,l,d){const m=this.expression.evaluate({zoom:this.zoom},i,l,void 0,d),x=this.expression.evaluate({zoom:this.zoom+1},i,l,void 0,d);this._setPaintValue(e,r,m,x)}_setPaintValue(e,r,i,l){if(this.type==="color"){const d=bc(i),m=bc(l);for(let x=e;x<r;x++)this.paintVertexArray.emplace(x,d[0],d[1],m[0],m[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,i,l);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,i,l,d){const m=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,x=Fe(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);r.set(e,d,x)}getBinding(e,r){return new gh(e)}}class oa{constructor(e,r,i,l,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(i==="array"?Fs:Ss).members;for(let m=0;m<r.length;++m);this.paintVertexArray=new l}populatePaintArray(e,r,i){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],i)}updatePaintArray(e,r,i,l,d,m){this._setPaintValues(e,r,i.patterns&&i.patterns[this.layerId],m)}_setPaintValues(e,r,i,l){if(!l||!i)return;const d=l[i];if(!d)return;const{tl:m,br:x,pixelRatio:T}=d;for(let S=e;S<r;S++)this.paintVertexArray.emplace(S,m[0],m[1],x[0],x[1],T)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class za{constructor(e,r,i=(()=>!0)){this.binders={},this._buffers=[];const l=[];for(const d in e.paint._values){if(!i(d))continue;const m=e.paint.get(d);if(!(m instanceof ne&&ka(m.property.specification)))continue;const x=Wf(d,e.type),T=m.value,S=m.property.specification.type,M=!!m.property.useIntegerZoom,L=d==="line-dasharray"||d.endsWith("pattern"),R=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(T.kind!=="constant"||R)if(T.kind==="source"||R||L){const O=wp(d,S,"source");this.binders[d]=L?new oa(T,x,S,O,e.id):new no(T,x,S,O),l.push(`/a_${d}`)}else{const O=wp(d,S,"composite");this.binders[d]=new io(T,x,S,M,r,O),l.push(`/z_${d}`)}else this.binders[d]=L?new Ra(T.value,x):new du(T.value,x,S),l.push(`/u_${d}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof no||r instanceof io?r.maxValue:0}populatePaintArrays(e,r,i,l,d,m){for(const x in this.binders){const T=this.binders[x];(T instanceof no||T instanceof io||T instanceof oa)&&T.populatePaintArray(e,r,i,l,d,m)}}setConstantPatternPositions(e){for(const r in this.binders){const i=this.binders[r];i instanceof Ra&&i.setConstantPatternPositions(e)}}updatePaintArrays(e,r,i,l,d,m){let x=!1;for(const T in e){const S=r.getPositions(T);for(const M of S){const L=i.feature(M.index);for(const R in this.binders){const O=this.binders[R];if((O instanceof no||O instanceof io||O instanceof oa)&&O.expression.isStateDependent===!0){const V=l.paint.get(R);O.expression=V.value,O.updatePaintArray(M.start,M.end,L,e[T],d,m),x=!0}}}}return x}defines(){const e=[];for(const r in this.binders){const i=this.binders[r];(i instanceof du||i instanceof Ra)&&e.push(...i.uniformNames.map((l=>`#define HAS_UNIFORM_${l}`)))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const i=this.binders[r];if(i instanceof no||i instanceof io||i instanceof oa)for(let l=0;l<i.paintVertexAttributes.length;l++)e.push(i.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const i=this.binders[r];if(i instanceof du||i instanceof Ra||i instanceof io)for(const l of i.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof du||l instanceof Ra||l instanceof io)for(const d of l.uniformNames)r.push({name:d,property:i,binding:l.getBinding(e,d)})}return r}setUniforms(e,r,i,l,d){for(const{name:m,property:x,binding:T}of i)this.binders[x].setUniform(e,T,d,l.get(x),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof no||r instanceof io||r instanceof oa)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const i=this.binders[r];(i instanceof no||i instanceof io||i instanceof oa)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof no||r instanceof io||r instanceof oa)&&r.destroy()}}}class Al{constructor(e,r,i=(()=>!0)){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new za(l,r,i);this.needsUpload=!1,this._featureMap=new Cl,this._bufferOffset=0}populatePaintArrays(e,r,i,l,d,m,x){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,r,l,d,m,x);r.id!==void 0&&this._featureMap.add(r.id,i,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,i,l,d){for(const m of i)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,r,m,l,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Gf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Wf(t,e){return Gf[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const bp={"line-pattern":{source:Be,composite:Be},"fill-pattern":{source:Be,composite:Be},"fill-extrusion-pattern":{source:Be,composite:Be},"line-dasharray":{source:Qe,composite:Qe}},qf={color:{source:ws,composite:dt},number:{source:Wr,composite:ws}};function wp(t,e,r){const i=bp[t];return i&&i[r]||qf[e][r]}Lt(du,"ConstantBinder"),Lt(Ra,"PatternConstantBinder"),Lt(no,"SourceExpressionBinder"),Lt(oa,"PatternCompositeBinder"),Lt(io,"CompositeExpressionBinder"),Lt(za,"ProgramConfiguration",{omit:["_buffers"]}),Lt(Al,"ProgramConfigurationSet");const Tp="-transition";class Po extends Ni{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new ie(r.layout)),r.paint)){this._transitionablePaint=new $(r.paint);for(const i in e.paint)this.setPaintProperty(i,e.paint[i],{validate:!1});for(const i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new se(r.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,i={}){r!=null&&this._validate(Ia,`layers.${this.id}.layout.${e}`,e,r,i)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return Hi(e,Tp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,i={}){if(r!=null&&this._validate(Gi,`layers.${this.id}.paint.${e}`,e,r,i))return!1;if(Hi(e,Tp))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[e],d=l.value.isDataDriven(),m=l.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value,T=x.isDataDriven(),S=Hi(e,"pattern")||e==="line-dasharray";return T||d||S||this._handleOverridablePaintPropertyUpdate(e,m,x)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),us(e,((r,i)=>!(r===void 0||i==="layout"&&!Object.keys(r).length||i==="paint"&&!Object.keys(r).length)))}_validate(e,r,i,l,d={}){return(!d||d.validate!==!1)&&Pi(this,e.call(pi,{key:r,layerType:this.type,objectKey:i,value:l,styleSpec:rt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof ne&&ka(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=vl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Zf=Ce([{name:"a_pos",components:2,type:"Int16"}],4),ig=Ce([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class zn{constructor(e=[]){this.segments=e}prepareSegment(e,r,i,l){let d=this.segments[this.segments.length-1];return e>zn.MAX_VERTEX_ARRAY_LENGTH&&nn(`Max vertices per segment is ${zn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>zn.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==l)&&(d={vertexOffset:r.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},l!==void 0&&(d.sortKey=l),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,i,l){return new zn([{vertexOffset:e,primitiveOffset:r,vertexLength:i,primitiveLength:l,vaos:{},sortKey:0}])}}zn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Lt(zn,"SegmentVector");var Zt=8192;class Na{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Kt?new Kt(e.lng,e.lat):Kt.convert(e),this}setSouthWest(e){return this._sw=e instanceof Kt?new Kt(e.lng,e.lat):Kt.convert(e),this}extend(e){const r=this._sw,i=this._ne;let l,d;if(e instanceof Kt)l=e,d=e;else{if(!(e instanceof Na))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Na.convert(e)):this.extend(Kt.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Kt.convert(e)):this;if(l=e._sw,d=e._ne,!l||!d)return this}return r||i?(r.lng=Math.min(l.lng,r.lng),r.lat=Math.min(l.lat,r.lat),i.lng=Math.max(d.lng,i.lng),i.lat=Math.max(d.lat,i.lat)):(this._sw=new Kt(l.lng,l.lat),this._ne=new Kt(d.lng,d.lat)),this}getCenter(){return new Kt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Kt(this.getWest(),this.getNorth())}getSouthEast(){return new Kt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:i}=Kt.convert(e);let l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&l}static convert(e){return!e||e instanceof Na?e:new Na(e)}}var yh=1e-6,Ii=typeof Float32Array<"u"?Float32Array:Array;function Hf(){var t=new Ii(9);return Ii!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Xf(t,e,r){var i=e[0],l=e[1],d=e[2],m=e[3],x=e[4],T=e[5],S=e[6],M=e[7],L=e[8],R=r[0],O=r[1],V=r[2],q=r[3],Q=r[4],oe=r[5],pe=r[6],ae=r[7],de=r[8];return t[0]=R*i+O*m+V*S,t[1]=R*l+O*x+V*M,t[2]=R*d+O*T+V*L,t[3]=q*i+Q*m+oe*S,t[4]=q*l+Q*x+oe*M,t[5]=q*d+Q*T+oe*L,t[6]=pe*i+ae*m+de*S,t[7]=pe*l+ae*x+de*M,t[8]=pe*d+ae*T+de*L,t}function Io(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Os(t,e){var r=e[0],i=e[1],l=e[2],d=e[3],m=e[4],x=e[5],T=e[6],S=e[7],M=e[8],L=e[9],R=e[10],O=e[11],V=e[12],q=e[13],Q=e[14],oe=e[15],pe=r*x-i*m,ae=r*T-l*m,de=r*S-d*m,ye=i*T-l*x,ge=i*S-d*x,Ge=l*S-d*T,Ne=M*q-L*V,nt=M*Q-R*V,yt=M*oe-O*V,Ze=L*Q-R*q,ot=L*oe-O*q,at=R*oe-O*Q,pt=pe*at-ae*ot+de*Ze+ye*yt-ge*nt+Ge*Ne;return pt?(t[0]=(x*at-T*ot+S*Ze)*(pt=1/pt),t[1]=(l*ot-i*at-d*Ze)*pt,t[2]=(q*Ge-Q*ge+oe*ye)*pt,t[3]=(R*ge-L*Ge-O*ye)*pt,t[4]=(T*yt-m*at-S*nt)*pt,t[5]=(r*at-l*yt+d*nt)*pt,t[6]=(Q*de-V*Ge-oe*ae)*pt,t[7]=(M*Ge-R*de+O*ae)*pt,t[8]=(m*ot-x*yt+S*Ne)*pt,t[9]=(i*yt-r*ot-d*Ne)*pt,t[10]=(V*ge-q*de+oe*pe)*pt,t[11]=(L*de-M*ge-O*pe)*pt,t[12]=(x*nt-m*Ze-T*Ne)*pt,t[13]=(r*Ze-i*nt+l*Ne)*pt,t[14]=(q*ae-V*ye-Q*pe)*pt,t[15]=(M*ye-L*ae+R*pe)*pt,t):null}function Ba(t,e,r){var i=e[0],l=e[1],d=e[2],m=e[3],x=e[4],T=e[5],S=e[6],M=e[7],L=e[8],R=e[9],O=e[10],V=e[11],q=e[12],Q=e[13],oe=e[14],pe=e[15],ae=r[0],de=r[1],ye=r[2],ge=r[3];return t[0]=ae*i+de*x+ye*L+ge*q,t[1]=ae*l+de*T+ye*R+ge*Q,t[2]=ae*d+de*S+ye*O+ge*oe,t[3]=ae*m+de*M+ye*V+ge*pe,t[4]=(ae=r[4])*i+(de=r[5])*x+(ye=r[6])*L+(ge=r[7])*q,t[5]=ae*l+de*T+ye*R+ge*Q,t[6]=ae*d+de*S+ye*O+ge*oe,t[7]=ae*m+de*M+ye*V+ge*pe,t[8]=(ae=r[8])*i+(de=r[9])*x+(ye=r[10])*L+(ge=r[11])*q,t[9]=ae*l+de*T+ye*R+ge*Q,t[10]=ae*d+de*S+ye*O+ge*oe,t[11]=ae*m+de*M+ye*V+ge*pe,t[12]=(ae=r[12])*i+(de=r[13])*x+(ye=r[14])*L+(ge=r[15])*q,t[13]=ae*l+de*T+ye*R+ge*Q,t[14]=ae*d+de*S+ye*O+ge*oe,t[15]=ae*m+de*M+ye*V+ge*pe,t}function Ml(t,e,r){var i,l,d,m,x,T,S,M,L,R,O,V,q=r[0],Q=r[1],oe=r[2];return e===t?(t[12]=e[0]*q+e[4]*Q+e[8]*oe+e[12],t[13]=e[1]*q+e[5]*Q+e[9]*oe+e[13],t[14]=e[2]*q+e[6]*Q+e[10]*oe+e[14],t[15]=e[3]*q+e[7]*Q+e[11]*oe+e[15]):(l=e[1],d=e[2],m=e[3],x=e[4],T=e[5],S=e[6],M=e[7],L=e[8],R=e[9],O=e[10],V=e[11],t[0]=i=e[0],t[1]=l,t[2]=d,t[3]=m,t[4]=x,t[5]=T,t[6]=S,t[7]=M,t[8]=L,t[9]=R,t[10]=O,t[11]=V,t[12]=i*q+x*Q+L*oe+e[12],t[13]=l*q+T*Q+R*oe+e[13],t[14]=d*q+S*Q+O*oe+e[14],t[15]=m*q+M*Q+V*oe+e[15]),t}function Pl(t,e,r){var i=r[0],l=r[1],d=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*l,t[5]=e[5]*l,t[6]=e[6]*l,t[7]=e[7]*l,t[8]=e[8]*d,t[9]=e[9]*d,t[10]=e[10]*d,t[11]=e[11]*d,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function gd(t,e,r){var i=Math.sin(r),l=Math.cos(r),d=e[4],m=e[5],x=e[6],T=e[7],S=e[8],M=e[9],L=e[10],R=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=d*l+S*i,t[5]=m*l+M*i,t[6]=x*l+L*i,t[7]=T*l+R*i,t[8]=S*l-d*i,t[9]=M*l-m*i,t[10]=L*l-x*i,t[11]=R*l-T*i,t}function _h(t,e,r){var i=Math.sin(r),l=Math.cos(r),d=e[0],m=e[1],x=e[2],T=e[3],S=e[8],M=e[9],L=e[10],R=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*l-S*i,t[1]=m*l-M*i,t[2]=x*l-L*i,t[3]=T*l-R*i,t[8]=d*i+S*l,t[9]=m*i+M*l,t[10]=x*i+L*l,t[11]=T*i+R*l,t}function yd(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function wc(t,e,r){var i,l,d,m=r[0],x=r[1],T=r[2],S=Math.hypot(m,x,T);return S<yh?null:(m*=S=1/S,x*=S,T*=S,i=Math.sin(e),l=Math.cos(e),t[0]=m*m*(d=1-l)+l,t[1]=x*m*d+T*i,t[2]=T*m*d-x*i,t[3]=0,t[4]=m*x*d-T*i,t[5]=x*x*d+l,t[6]=T*x*d+m*i,t[7]=0,t[8]=m*T*d+x*i,t[9]=x*T*d-m*i,t[10]=T*T*d+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Sp=Ba;function xh(){var t=new Ii(3);return Ii!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Kf(t){var e=new Ii(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function pu(t){return Math.hypot(t[0],t[1],t[2])}function Tc(t,e,r){var i=new Ii(3);return i[0]=t,i[1]=e,i[2]=r,i}function aa(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function _d(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Ep(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function vh(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function vi(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function vn(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function fu(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function Di(t,e){var r=e[0],i=e[1],l=e[2],d=r*r+i*i+l*l;return d>0&&(d=1/Math.sqrt(d)),t[0]=e[0]*d,t[1]=e[1]*d,t[2]=e[2]*d,t}function Us(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function xd(t,e,r){var i=e[0],l=e[1],d=e[2],m=r[0],x=r[1],T=r[2];return t[0]=l*T-d*x,t[1]=d*m-i*T,t[2]=i*x-l*m,t}function kn(t,e,r){var i=e[0],l=e[1],d=e[2],m=r[3]*i+r[7]*l+r[11]*d+r[15];return t[0]=(r[0]*i+r[4]*l+r[8]*d+r[12])/(m=m||1),t[1]=(r[1]*i+r[5]*l+r[9]*d+r[13])/m,t[2]=(r[2]*i+r[6]*l+r[10]*d+r[14])/m,t}function vd(t,e,r){var i=r[0],l=r[1],d=r[2],m=e[0],x=e[1],T=e[2],S=l*T-d*x,M=d*m-i*T,L=i*x-l*m,R=l*L-d*M,O=d*S-i*L,V=i*M-l*S,q=2*r[3];return M*=q,L*=q,O*=2,V*=2,t[0]=m+(S*=q)+(R*=2),t[1]=x+M+O,t[2]=T+L+V,t}var mu,Vs=_d,Yf=Ep,Jf=pu;function bd(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function wd(t,e){var r=e[0],i=e[1],l=e[2],d=e[3],m=r*r+i*i+l*l+d*d;return m>0&&(m=1/Math.sqrt(m)),t[0]=r*m,t[1]=i*m,t[2]=l*m,t[3]=d*m,t}function Il(t,e,r){var i=e[0],l=e[1],d=e[2],m=e[3];return t[0]=r[0]*i+r[4]*l+r[8]*d+r[12]*m,t[1]=r[1]*i+r[5]*l+r[9]*d+r[13]*m,t[2]=r[2]*i+r[6]*l+r[10]*d+r[14]*m,t[3]=r[3]*i+r[7]*l+r[11]*d+r[15]*m,t}function Td(){var t=new Ii(4);return Ii!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function bh(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Qf(t,e,r){r*=.5;var i=e[0],l=e[1],d=e[2],m=e[3],x=Math.sin(r),T=Math.cos(r);return t[0]=i*T+m*x,t[1]=l*T+d*x,t[2]=d*T-l*x,t[3]=m*T-i*x,t}function kp(t,e,r){r*=.5;var i=e[0],l=e[1],d=e[2],m=e[3],x=Math.sin(r),T=Math.cos(r);return t[0]=i*T-d*x,t[1]=l*T+m*x,t[2]=d*T+i*x,t[3]=m*T-l*x,t}xh(),mu=new Ii(4),Ii!=Float32Array&&(mu[0]=0,mu[1]=0,mu[2]=0,mu[3]=0);var Cp=wd;xh(),Tc(1,0,0),Tc(0,1,0),Td(),Td(),Hf();const em=Ce([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:wh}=em,la=Ce([{name:"a_pos_3",components:3,type:"Int16"}]);var Th=Ce([{name:"a_pos",type:"Int16",components:2}]);class Sd{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,i){const l=Us(r,this.dir);if(Math.abs(l)<1e-6)return!1;const d=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/l;return i[0]=this.pos[0]+this.dir[0]*d,i[1]=this.pos[1]+this.dir[1]*d,i[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,r,i){if((function(O,V){var q=O[0],Q=O[1],oe=O[2],pe=V[0],ae=V[1],de=V[2];return Math.abs(q-pe)<=yh*Math.max(1,Math.abs(q),Math.abs(pe))&&Math.abs(Q-ae)<=yh*Math.max(1,Math.abs(Q),Math.abs(ae))&&Math.abs(oe-de)<=yh*Math.max(1,Math.abs(oe),Math.abs(de))})(this.pos,e)||r===0)return i[0]=i[1]=i[2]=0,!1;const[l,d,m]=this.dir,x=this.pos[0]-e[0],T=this.pos[1]-e[1],S=this.pos[2]-e[2],M=l*l+d*d+m*m,L=2*(x*l+T*d+S*m),R=L*L-4*M*(x*x+T*T+S*S-r*r);if(R<0){const O=Math.max(-L/2,0),V=x+l*O,q=T+d*O,Q=S+m*O,oe=Math.hypot(V,q,Q);return i[0]=V*r/oe,i[1]=q*r/oe,i[2]=Q*r/oe,!1}{const O=(-L-Math.sqrt(R))/(2*M);if(O<0){const V=Math.hypot(x,T,S);return i[0]=x*r/V,i[1]=T*r/V,i[2]=S*r/V,!1}return i[0]=x+l*O,i[1]=T+d*O,i[2]=S+m*O,!0}}}class Sh{constructor(e,r,i,l,d){this.TL=e,this.TR=r,this.BR=i,this.BL=l,this.horizon=d}static fromInvProjectionMatrix(e,r,i){const l=[-1,1,1],d=[1,1,1],m=[1,-1,1],x=[-1,-1,1],T=kn(l,l,e),S=kn(d,d,e),M=kn(m,m,e),L=kn(x,x,e);return new Sh(T,S,M,L,r/i)}}class Ed{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,i,l){const d=Math.pow(2,i),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((T=>{const S=Il([],T,e),M=1/S[3]/r*d;return(function(L,R,O){return L[0]=R[0]*O[0],L[1]=R[1]*O[1],L[2]=R[2]*O[2],L[3]=R[3]*O[3],L})(S,S,[M,M,l?1/S[3]:M,M])})),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((T=>{const S=Di([],xd([],Vs([],m[T[0]],m[T[1]]),Vs([],m[T[2]],m[T[1]]))),M=-Us(S,m[T[1]]);return S.concat(M)}));return new Ed(m,x)}}class Li{static fromPoints(e){const r=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const l of e)vh(r,r,l),vi(i,i,l);return new Li(r,i)}static applyTransform(e,r){const i=e.getCorners();for(let l=0;l<i.length;++l)kn(i[l],i[l],r);return Li.fromPoints(i)}constructor(e,r){this.min=e,this.max=r,this.center=vn([],aa([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],i=Kf(this.min),l=Kf(this.max);for(let d=0;d<r.length;d++)i[d]=r[d]?this.min[d]:this.center[d],l[d]=r[d]?this.center[d]:this.max[d];return l[2]=this.max[2],new Li(i,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let i=!0;for(let l=0;l<e.planes.length;l++){const d=e.planes[l];let m=0;for(let x=0;x<r.length;x++)m+=Us(d,r[x])+d[3]>=0;if(m===0)return 0;m!==r.length&&(i=!1)}if(i)return 2;for(let l=0;l<3;l++){let d=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let x=0;x<e.points.length;x++){const T=e.points[x][l]-this.min[l];d=Math.min(d,T),m=Math.max(m,T)}if(m<0||d>this.max[l]-this.min[l])return 0}return 1}}const Sc=5,ji=6,ca=Zt/Math.PI/2,sg=16383,ua=64,li=[ua,32,16],so=-ca,Bt=ca,gu=[new Li([so,so,so],[Bt,Bt,Bt]),new Li([so,so,so],[0,0,Bt]),new Li([0,so,so],[Bt,0,Bt]),new Li([so,0,so],[0,Bt,Bt]),new Li([0,0,so],[Bt,Bt,Bt])];function yu(t){return t*ca/Dl}function Ap(t,e,r,i=!0){const l=vn([],t._camera.position,t.worldSize),d=[e,r,1,1];Il(d,d,t.pixelMatrixInverse),bd(d,d,1/d[3]);const m=Di([],Vs([],d,l)),x=t.globeMatrix,T=[x[12],x[13],x[14]],S=Vs([],T,l),M=pu(S),L=Di([],S),R=t.worldSize/(2*Math.PI),O=Us(L,m),V=Math.asin(R/M);if(V<Math.acos(O)){if(!i)return null;const yt=[],Ze=[];vn(yt,m,M/O),Di(Ze,Vs(Ze,yt,S)),Di(m,aa(m,S,vn(m,Ze,Math.tan(V)*M)))}const q=[];new Sd(l,m).closestPointOnSphere(T,R,q);const Q=Di([],Ci(x,0)),oe=Di([],Ci(x,1)),pe=Di([],Ci(x,2)),ae=Us(Q,q),de=Us(oe,q),ye=Us(pe,q),ge=nr(Math.asin(-de/R));let Ge=nr(Math.atan2(ae,ye));Ge=t.center.lng+(function(yt,Ze){const ot=(Ze-yt+180)%360-180;return ot<-180?ot+360:ot})(t.center.lng,Ge);const Ne=cn(Ge),nt=Fe(wn(ge),0,1);return new Ll(Ne,nt)}class og{constructor(e,r,i){this.a=Vs([],e,i),this.b=Vs([],r,i),this.center=i;const l=Di([],this.a),d=Di([],this.b);this.angle=Math.acos(Us(l,d))}}function Ec(t,e){if(t.angle===0)return null;let r;return r=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),r<0||r>1?null:(function(i,l,d,m){const x=Math.sin(d);return i*(Math.sin((1-m)*d)/x)+l*(Math.sin(m*d)/x)})(t.a[e],t.b[e],t.angle,Fe(r,0,1))+t.center[e]}function $s(t){if(t.z<=1)return gu[t.z+2*t.y+t.x];const e=Eh(_u(t));return Li.fromPoints(e)}function Fa(t,e,r){return vn(t,t,1-r),fu(t,t,e,r)}function Mp(t,e){const r=xu(e.zoom);if(r===0)return $s(t);const i=_u(t),l=Eh(i),d=cn(i.getWest())*e.worldSize,m=cn(i.getEast())*e.worldSize,x=wn(i.getNorth())*e.worldSize,T=wn(i.getSouth())*e.worldSize,S=[d,x,0],M=[m,x,0],L=[d,T,0],R=[m,T,0],O=Os([],e.globeMatrix);return kn(S,S,O),kn(M,M,O),kn(L,L,O),kn(R,R,O),l[0]=Fa(l[0],L,r),l[1]=Fa(l[1],R,r),l[2]=Fa(l[2],M,r),l[3]=Fa(l[3],S,r),Li.fromPoints(l)}function Pp(t,e,r){for(const i of t)kn(i,i,e),vn(i,i,r)}function tm(t,e,r){const i=e/t.worldSize,l=t.globeMatrix;if(r.z<=1){const Ne=$s(r).getCorners();return Pp(Ne,l,i),Li.fromPoints(Ne)}const d=_u(r),m=Eh(d);Pp(m,l,i);const x=Number.MAX_VALUE,T=[-x,-x,-x],S=[x,x,x];if(d.contains(t.center)){for(const yt of m)vh(S,S,yt),vi(T,T,yt);T[2]=0;const Ne=t.point,nt=[Ne.x*i,Ne.y*i,0];return vh(S,S,nt),vi(T,T,nt),new Li(S,T)}const M=[l[12]*i,l[13]*i,l[14]*i],L=d.getCenter(),R=Fe(t.center.lat,-Pn,Pn),O=Fe(L.lat,-Pn,Pn),V=cn(t.center.lng),q=wn(R);let Q=V-cn(L.lng);const oe=q-wn(O);Q>.5?Q-=1:Q<-.5&&(Q+=1);let pe=0;Math.abs(Q)>Math.abs(oe)?pe=Q>=0?1:3:(pe=oe>=0?0:2,fu(M,M,[l[4]*i,l[5]*i,l[6]*i],-Math.sin(vt(oe>=0?d.getSouth():d.getNorth()))*ca));const ae=m[pe],de=m[(pe+1)%4],ye=new og(ae,de,M),ge=[Ec(ye,0)||ae[0],Ec(ye,1)||ae[1],Ec(ye,2)||ae[2]],Ge=xu(t.zoom);if(Ge>0){const Ne=(function({x:yt,y:Ze,z:ot},at,pt,wt,et){const Dt=1/(1<<ot);let Ft=yt*Dt,zt=Ft+Dt,gr=Ze*Dt,Tt=gr+Dt,Ht=0;const yr=(Ft+zt)/2-wt;return yr>.5?Ht=-1:yr<-.5&&(Ht=1),Ft=((Ft+Ht)*at-(wt*=at))*pt+wt,zt=((zt+Ht)*at-wt)*pt+wt,gr=(gr*at-(et*=at))*pt+et,Tt=(Tt*at-et)*pt+et,[[Ft,Tt,0],[zt,Tt,0],[zt,gr,0],[Ft,gr,0]]})(r,e,t._pixelsPerMercatorPixel,V,q);for(let yt=0;yt<m.length;yt++)Fa(m[yt],Ne[yt],Ge);const nt=aa([],Ne[pe],Ne[(pe+1)%4]);vn(nt,nt,.5),Fa(ge,nt,Ge)}for(const Ne of m)vh(S,S,Ne),vi(T,T,Ne);return S[2]=Math.min(ae[2],de[2]),vh(S,S,ge),vi(T,T,ge),new Li(S,T)}function _u({x:t,y:e,z:r}){const i=1/(1<<r),l=new Kt(bi(t*i),qr((e+1)*i)),d=new Kt(bi((t+1)*i),qr(e*i));return new Na(l,d)}function Eh(t){const e=vt(t.getNorth()),r=vt(t.getSouth()),i=Math.cos(e),l=Math.cos(r),d=Math.sin(e),m=Math.sin(r),x=t.getWest(),T=t.getEast();return[$n(l,m,x),$n(l,m,T),$n(i,d,T),$n(i,d,x)]}function $n(t,e,r,i=ca){return r=vt(r),[t*Math.sin(r)*i,-e*i,t*Math.cos(r)*i]}function Wi(t,e,r){return $n(Math.cos(vt(t)),Math.sin(vt(t)),e,r)}function oo(t,e,r,i){const l=1<<r.z,d=(t/Zt+r.x)/l;return Wi(qr((e/Zt+r.y)/l),bi(d),i)}function kh({min:t,max:e}){return sg/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Ip=new Float64Array(16);function is(t){const e=kh(t),r=yd(Ip,[e,e,e]);return Ml(r,r,((i=[])[0]=-(l=t.min)[0],i[1]=-l[1],i[2]=-l[2],i));var i,l}function kd(t){const e=(i=t.min,(r=Ip)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r);var r,i;const l=1/kh(t);return Pl(e,e,[l,l,l])}function Do(t,e,r,i,l){const d=(function(T){const S=Zt/(2*Math.PI);return T/(2*Math.PI)/S})(r),m=[t,e,-r/(2*Math.PI)],x=Io(new Float64Array(16));return Ml(x,x,m),Pl(x,x,[d,d,d]),gd(x,x,vt(-l)),_h(x,x,vt(-i)),x}function xu(t){return _t(Sc,ji,t)}function Dp(t,e){const r=Wi(e.lat,e.lng),i=(function(V){const q=Wi(V._center.lat,V._center.lng);let Q=xd([],Tc(0,1,0),q);const oe=wc([],-V.angle,q);Q=kn(Q,Q,oe),wc(oe,-V._pitch,Q);const pe=Di([],q);return vn(pe,pe,yu(V.cameraToCenterDistance/V.pixelsPerMeter)),kn(pe,pe,oe),aa([],q,pe)})(t);return m=(l=_d([],i,r))[0],x=l[1],T=l[2],S=(d=r)[0],M=d[1],L=d[2],O=(R=Math.sqrt(m*m+x*x+T*T)*Math.sqrt(S*S+M*M+L*L))&&Us(l,d)/R,Math.acos(Math.min(Math.max(O,-1),1));var l,d,m,x,T,S,M,L,R,O}function Cd(t,e){return Dp(t,e)>Math.PI/2*1.01}const Lp=vt(85),rm=Math.cos(Lp),ag=Math.sin(Lp),Dl=63710088e-1,Ad=2*Math.PI*Dl;class mi{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new mi(Te(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,i=this.lat*r,l=e.lat*r,d=Math.sin(i)*Math.sin(l)+Math.cos(i)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return Dl*Math.acos(Math.min(d,1))}toBounds(e=0){const r=360*e/40075017,i=r/Math.cos(Math.PI/180*this.lat);return new Na(new mi(this.lng-i,this.lat-r),new mi(this.lng+i,this.lat+r))}toEcef(e){const r=yu(e);return Wi(this.lat,this.lng,ca+r)}static convert(e){if(e instanceof mi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new mi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new mi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Kt=mi;function ci(t){return Ad*Math.cos(t*Math.PI/180)}function cn(t){return(180+t)/360}function wn(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Nn(t,e){return t/ci(e)}function bi(t){return 360*t-180}function qr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function vu(t,e){return t*ci(qr(e))}const Pn=85.051129;function Ch(t){return 1/Math.cos(t*Math.PI/180)}class Ll{constructor(e,r,i=0){this.x=+e,this.y=+r,this.z=+i}static fromLngLat(e,r=0){const i=Kt.convert(e);return new Ll(cn(i.lng),wn(i.lat),Nn(r,i.lat))}toLngLat(){return new Kt(bi(this.x),qr(this.y))}toAltitude(){return vu(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ad*Ch(qr(this.y))}}function kc(t,e,r,i,l,d,m,x,T){const S=(e+i)/2,M=(r+l)/2,L=new De(S,M);x(L),(function(R,O,V,q,Q,oe){const pe=V-Q,ae=q-oe;return Math.abs((q-O)*pe-(V-R)*ae)/Math.hypot(pe,ae)})(L.x,L.y,d.x,d.y,m.x,m.y)>=T?(kc(t,e,r,S,M,d,L,x,T),kc(t,S,M,i,l,L,m,x,T)):t.push(m)}function ss(t,e,r){let i=t[0],l=i.x,d=i.y;e(i);const m=[i];for(let x=1;x<t.length;x++){const T=t[x],{x:S,y:M}=T;e(T),kc(m,l,d,S,M,i,T,e,r),l=S,d=M,i=T}return m}function Ah(t,e,r,i){if(i(e,r)){const l=e.add(r)._mult(.5);Ah(t,e,l,i),Ah(t,l,r,i)}else t.push(r)}function bu(t,e){let r=t[0];const i=[r];for(let l=1;l<t.length;l++){const d=t[l];Ah(i,r,d,e),r=d}return i}const Lo=Math.pow(2,14)-1,Mh=-Lo-1;function jp(t,e){const r=Math.round(t.x*e),i=Math.round(t.y*e);return t.x=Fe(r,Mh,Lo),t.y=Fe(i,Mh,Lo),(r<t.x||r>t.x+1||i<t.y||i>t.y+1)&&nn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function qi(t,e,r){const i=t.loadGeometry(),l=t.extent,d=Zt/l;if(e&&r&&r.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:x,x:T,y:S,projection:M}=r,L=R=>{const O=bi((e.x+R.x/l)/m),V=qr((e.y+R.y/l)/m),q=M.project(O,V);R.x=(q.x*x-T)*l,R.y=(q.y*x-S)*l};for(let R=0;R<i.length;R++)if(t.type!==1)i[R]=ss(i[R],L,1);else{const O=[];for(const V of i[R])V.x<0||V.x>=l||V.y<0||V.y>=l||(L(V),O.push(V));i[R]=O}}for(const m of i)for(const x of m)jp(x,d);return i}function ha(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?qi(t):[]}}function jo(t,e,r,i,l){t.emplaceBack(2*e+(i+1)/2,2*r+(l+1)/2)}function Cc(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Ac{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ft,this.indexArray=new Vt,this.segments=new zn,this.programConfigurations=new Al(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,i,l){const d=this.layers[0],m=[];let x=null;d.type==="circle"&&(x=d.layout.get("circle-sort-key"));for(const{feature:S,id:M,index:L,sourceLayerIndex:R}of e){const O=this.layers[0]._featureFilter.needGeometry,V=ha(S,O);if(!this.layers[0]._featureFilter.filter(new I(this.zoom),V,i))continue;const q=x?x.evaluate(V,{},i):void 0,Q={id:M,properties:S.properties,type:S.type,sourceLayerIndex:R,index:L,geometry:O?V.geometry:qi(S,i,l),patterns:{},sortKey:q};m.push(Q)}x&&m.sort(((S,M)=>S.sortKey-M.sortKey));let T=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new ht,T=l.projection);for(const S of m){const{geometry:M,index:L,sourceLayerIndex:R}=S,O=e[L].feature;this.addFeature(S,M,L,r.availableImages,i,T),r.featureIndex.insert(O,M,L,R,this.index)}}update(e,r,i,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,i,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ig.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,i,l,d,m){for(const x of r)for(const T of x){const S=T.x,M=T.y;if(S<0||S>=Zt||M<0||M>=Zt)continue;if(m){const O=m.projectTilePoint(S,M,d),V=m.upVector(d,S,M),q=this.globeExtVertexArray;Cc(q,O,V),Cc(q,O,V),Cc(q,O,V),Cc(q,O,V)}const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=L.vertexLength;jo(this.layoutVertexArray,S,M,-1,-1),jo(this.layoutVertexArray,S,M,1,-1),jo(this.layoutVertexArray,S,M,1,1),jo(this.layoutVertexArray,S,M,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},l,d)}}function Md(t,e){for(let r=0;r<t.length;r++)if(Oa(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(Oa(t,e[r]))return!0;return!!da(t,e)}function Pd(t,e,r){return!!Oa(t,e)||!!Zi(e,t,r)}function Ph(t,e){if(t.length===1)return Id(e,t[0]);for(let r=0;r<e.length;r++){const i=e[r];for(let l=0;l<i.length;l++)if(Oa(t,i[l]))return!0}for(let r=0;r<t.length;r++)if(Id(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(da(t,e[r]))return!0;return!1}function os(t,e,r){if(t.length>1){if(da(t,e))return!0;for(let i=0;i<e.length;i++)if(Zi(e[i],t,r))return!0}for(let i=0;i<t.length;i++)if(Zi(t[i],e,r))return!0;return!1}function da(t,e){if(t.length===0||e.length===0)return!1;for(let r=0;r<t.length-1;r++){const i=t[r],l=t[r+1];for(let d=0;d<e.length-1;d++)if(Ro(i,l,e[d],e[d+1]))return!0}return!1}function Ro(t,e,r,i){return yi(t,r,i)!==yi(e,r,i)&&yi(t,e,r)!==yi(t,e,i)}function Zi(t,e,r){const i=r*r;if(e.length===1)return t.distSqr(e[0])<i;for(let l=1;l<e.length;l++)if(Rp(t,e[l-1],e[l])<i)return!0;return!1}function Rp(t,e,r){const i=e.distSqr(r);if(i===0)return t.distSqr(e);const l=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/i;return t.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function Id(t,e){let r,i,l,d=!1;for(let m=0;m<t.length;m++){r=t[m];for(let x=0,T=r.length-1;x<r.length;T=x++)i=r[x],l=r[T],i.y>e.y!=l.y>e.y&&e.x<(l.x-i.x)*(e.y-i.y)/(l.y-i.y)+i.x&&(d=!d)}return d}function Oa(t,e){let r=!1;for(let i=0,l=t.length-1;i<t.length;l=i++){const d=t[i],m=t[l];d.y>e.y!=m.y>e.y&&e.x<(m.x-d.x)*(e.y-d.y)/(m.y-d.y)+d.x&&(r=!r)}return r}function nm(t,e,r,i,l){for(const m of t)if(e<=m.x&&r<=m.y&&i>=m.x&&l>=m.y)return!0;const d=[new De(e,r),new De(e,l),new De(i,l),new De(i,r)];if(t.length>2){for(const m of d)if(Oa(t,m))return!0}for(let m=0;m<t.length-1;m++)if(jl(t[m],t[m+1],d))return!0;return!1}function jl(t,e,r){const i=r[0],l=r[2];if(t.x<i.x&&e.x<i.x||t.x>l.x&&e.x>l.x||t.y<i.y&&e.y<i.y||t.y>l.y&&e.y>l.y)return!1;const d=yi(t,e,r[0]);return d!==yi(t,e,r[1])||d!==yi(t,e,r[2])||d!==yi(t,e,r[3])}function Mc(t,e,r){const i=e.paint.get(t).value;return i.kind==="constant"?i.value:r.programConfigurations.get(e.id).getMaxValue(t)}function wu(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Rl(t,e,r,i,l){if(!e[0]&&!e[1])return t;const d=De.convert(e)._mult(l);r==="viewport"&&d._rotate(-i);const m=[];for(let x=0;x<t.length;x++)m.push(t[x].sub(d));return m}function Dd(t,e,r,i){const l=De.convert(t)._mult(i);return e==="viewport"&&l._rotate(-r),l}Lt(Ac,"CircleBucket",{omit:["layers"]});const Pc=new ce({"circle-sort-key":new te(rt.layout_circle["circle-sort-key"])});var im={paint:new ce({"circle-radius":new te(rt.paint_circle["circle-radius"]),"circle-color":new te(rt.paint_circle["circle-color"]),"circle-blur":new te(rt.paint_circle["circle-blur"]),"circle-opacity":new te(rt.paint_circle["circle-opacity"]),"circle-translate":new W(rt.paint_circle["circle-translate"]),"circle-translate-anchor":new W(rt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new W(rt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new W(rt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new te(rt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new te(rt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new te(rt.paint_circle["circle-stroke-opacity"])}),layout:Pc};function zp(t,e,r,i,l,d,m,x,T){if(d&&t.queryGeometry.isAboveHorizon)return!1;d&&(T*=t.pixelToTileUnitsFactor);const S=t.tileID.canonical,M=r.projection.upVectorScale(S,r.center.lat,r.worldSize).metersToTile;for(const L of e)for(const R of L){const O=R.add(x),V=l&&r.elevation?r.elevation.exaggeration()*l.getElevationAt(O.x,O.y,!0):0,q=r.projection.projectTilePoint(O.x,O.y,S);if(V>0){const ae=r.projection.upVector(S,O.x,O.y);q.x+=ae[0]*M*V,q.y+=ae[1]*M*V,q.z+=ae[2]*M*V}const Q=d?O:Np(q.x,q.y,q.z,i),oe=d?t.tilespaceRays.map((ae=>cg(ae,V))):t.queryGeometry.screenGeometry,pe=Il([],[q.x,q.y,q.z,1],i);if(!m&&d?T*=pe[3]/r.cameraToCenterDistance:m&&!d&&(T*=r.cameraToCenterDistance/pe[3]),d){const ae=qr((R.y/Zt+S.y)/(1<<S.z));T/=r.projection.pixelsPerMeter(ae,1)/Nn(1,ae)}if(Pd(oe,Q,T))return!0}return!1}function Np(t,e,r,i){const l=Il([],[t,e,r,1],i);return new De(l[0]/l[3],l[1]/l[3])}const Ih=Tc(0,0,0),lg=Tc(0,0,1);function cg(t,e){const r=xh();return Ih[2]=e,t.intersectsPlane(Ih,lg,r),new De(r[0],r[1])}class Bp extends Ac{}function Fp(t,{width:e,height:r},i,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*i)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*r*i);return t.width=e,t.height=r,t.data=l,t}function zl(t,e,r){const{width:i,height:l}=e;i===t.width&&l===t.height||(Op(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,l)},r),t.width=i,t.height=l,t.data=e.data)}function Op(t,e,r,i,l,d){if(l.width===0||l.height===0)return e;if(l.width>t.width||l.height>t.height||r.x>t.width-l.width||r.y>t.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||i.x>e.width-l.width||i.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const m=t.data,x=e.data;for(let T=0;T<l.height;T++){const S=((r.y+T)*t.width+r.x)*d,M=((i.y+T)*e.width+i.x)*d;for(let L=0;L<l.width*d;L++)x[M+L]=m[S+L]}return e}Lt(Bp,"HeatmapBucket",{omit:["layers"]});class ks{constructor(e,r){Fp(this,e,1,r)}resize(e){zl(this,new ks(e),1)}clone(){return new ks({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,i,l,d){Op(e,r,i,l,d,1)}}class as{constructor(e,r){Fp(this,e,4,r)}resize(e){zl(this,new as(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new as({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,i,l,d){Op(e,r,i,l,d,4)}}Lt(ks,"AlphaImage"),Lt(as,"RGBAImage");var Gn={paint:new ce({"heatmap-radius":new te(rt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new te(rt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new W(rt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new le(rt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new W(rt.paint_heatmap["heatmap-opacity"])})};function Up(t){const e={},r=t.resolution||256,i=t.clips?t.clips.length:1,l=t.image||new as({width:r,height:i}),d=(m,x,T)=>{e[t.evaluationKey]=T;const S=t.expression.evaluate(e);l.data[m+x+0]=Math.floor(255*S.r/S.a),l.data[m+x+1]=Math.floor(255*S.g/S.a),l.data[m+x+2]=Math.floor(255*S.b/S.a),l.data[m+x+3]=Math.floor(255*S.a)};if(t.clips)for(let m=0,x=0;m<i;++m,x+=4*r)for(let T=0,S=0;T<r;T++,S+=4){const M=T/(r-1),{start:L,end:R}=t.clips[m];d(x,S,L*(1-M)+R*M)}else for(let m=0,x=0;m<r;m++,x+=4)d(0,x,m/(r-1));return l}var sm={paint:new ce({"hillshade-illumination-direction":new W(rt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new W(rt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new W(rt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new W(rt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new W(rt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new W(rt.paint_hillshade["hillshade-accent-color"])})};const ug=Ce([{name:"a_pos",components:2,type:"Int16"}],4),{members:hg}=ug;var Ld={exports:{}};function Dh(t,e,r){r=r||2;var i,l,d,m,x,T,S,M=e&&e.length,L=M?e[0]*r:t.length,R=om(t,0,L,r,!0),O=[];if(!R||R.next===R.prev)return O;if(M&&(R=(function(q,Q,oe,pe){var ae,de,ye,ge=[];for(ae=0,de=Q.length;ae<de;ae++)(ye=om(q,Q[ae]*pe,ae<de-1?Q[ae+1]*pe:q.length,pe,!1))===ye.next&&(ye.steiner=!0),ge.push(Wp(ye));for(ge.sort(Rd),ae=0;ae<ge.length;ae++)oe=Vp(ge[ae],oe);return oe})(t,e,R,r)),t.length>80*r){i=d=t[0],l=m=t[1];for(var V=r;V<L;V+=r)(x=t[V])<i&&(i=x),(T=t[V+1])<l&&(l=T),x>d&&(d=x),T>m&&(m=T);S=(S=Math.max(d-i,m-l))!==0?32767/S:0}return Ic(R,O,r,i,l,S,0),O}function om(t,e,r,i,l){var d,m;if(l===Eu(t,e,r,i)>0)for(d=e;d<r;d+=i)m=zd(d,t[d],t[d+1],m);else for(d=r-i;d>=e;d-=i)m=zd(d,t[d],t[d+1],m);return m&&Lc(m,m.next)&&(Bl(m),m=m.next),m}function wi(t,e){if(!t)return t;e||(e=t);var r,i=t;do if(r=!1,i.steiner||!Lc(i,i.next)&&In(i.prev,i,i.next)!==0)i=i.next;else{if(Bl(i),(i=e=i.prev)===i.next)break;r=!0}while(r||i!==e);return e}function Ic(t,e,r,i,l,d,m){if(t){!m&&d&&(function(M,L,R,O){var V=M;do V.z===0&&(V.z=Gp(V.x,V.y,L,R,O)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==M);V.prevZ.nextZ=null,V.prevZ=null,(function(q){var Q,oe,pe,ae,de,ye,ge,Ge,Ne=1;do{for(oe=q,q=null,de=null,ye=0;oe;){for(ye++,pe=oe,ge=0,Q=0;Q<Ne&&(ge++,pe=pe.nextZ);Q++);for(Ge=Ne;ge>0||Ge>0&&pe;)ge!==0&&(Ge===0||!pe||oe.z<=pe.z)?(ae=oe,oe=oe.nextZ,ge--):(ae=pe,pe=pe.nextZ,Ge--),de?de.nextZ=ae:q=ae,ae.prevZ=de,de=ae;oe=pe}de.nextZ=null,Ne*=2}while(ye>1)})(V)})(t,i,l,d);for(var x,T,S=t;t.prev!==t.next;)if(x=t.prev,T=t.next,d?Nl(t,i,l,d):dg(t))e.push(x.i/r|0),e.push(t.i/r|0),e.push(T.i/r|0),Bl(t),t=T.next,S=T.next;else if((t=T)===S){m?m===1?Ic(t=jd(wi(t),e,r),e,r,i,l,d,2):m===2&&Dc(t,e,r,i,l,d):Ic(wi(t),e,r,i,l,d,1);break}}}function dg(t){var e=t.prev,r=t,i=t.next;if(In(e,r,i)>=0)return!1;for(var l=e.x,d=r.x,m=i.x,x=e.y,T=r.y,S=i.y,M=l<d?l<m?l:m:d<m?d:m,L=x<T?x<S?x:S:T<S?T:S,R=l>d?l>m?l:m:d>m?d:m,O=x>T?x>S?x:S:T>S?T:S,V=i.next;V!==e;){if(V.x>=M&&V.x<=R&&V.y>=L&&V.y<=O&&Tu(l,x,d,T,m,S,V.x,V.y)&&In(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function Nl(t,e,r,i){var l=t.prev,d=t,m=t.next;if(In(l,d,m)>=0)return!1;for(var x=l.x,T=d.x,S=m.x,M=l.y,L=d.y,R=m.y,O=x<T?x<S?x:S:T<S?T:S,V=M<L?M<R?M:R:L<R?L:R,q=x>T?x>S?x:S:T>S?T:S,Q=M>L?M>R?M:R:L>R?L:R,oe=Gp(O,V,e,r,i),pe=Gp(q,Q,e,r,i),ae=t.prevZ,de=t.nextZ;ae&&ae.z>=oe&&de&&de.z<=pe;){if(ae.x>=O&&ae.x<=q&&ae.y>=V&&ae.y<=Q&&ae!==l&&ae!==m&&Tu(x,M,T,L,S,R,ae.x,ae.y)&&In(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,de.x>=O&&de.x<=q&&de.y>=V&&de.y<=Q&&de!==l&&de!==m&&Tu(x,M,T,L,S,R,de.x,de.y)&&In(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ae&&ae.z>=oe;){if(ae.x>=O&&ae.x<=q&&ae.y>=V&&ae.y<=Q&&ae!==l&&ae!==m&&Tu(x,M,T,L,S,R,ae.x,ae.y)&&In(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;de&&de.z<=pe;){if(de.x>=O&&de.x<=q&&de.y>=V&&de.y<=Q&&de!==l&&de!==m&&Tu(x,M,T,L,S,R,de.x,de.y)&&In(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function jd(t,e,r){var i=t;do{var l=i.prev,d=i.next.next;!Lc(l,d)&&Lh(l,i,i.next,d)&&Rh(l,d)&&Rh(d,l)&&(e.push(l.i/r|0),e.push(i.i/r|0),e.push(d.i/r|0),Bl(i),Bl(i.next),i=t=d),i=i.next}while(i!==t);return wi(i)}function Dc(t,e,r,i,l,d){var m=t;do{for(var x=m.next.next;x!==m.prev;){if(m.i!==x.i&&am(m,x)){var T=qp(m,x);return m=wi(m,m.next),T=wi(T,T.next),Ic(m,e,r,i,l,d,0),void Ic(T,e,r,i,l,d,0)}x=x.next}m=m.next}while(m!==t)}function Rd(t,e){return t.x-e.x}function Vp(t,e){var r=(function(l,d){var m,x=d,T=l.x,S=l.y,M=-1/0;do{if(S<=x.y&&S>=x.next.y&&x.next.y!==x.y){var L=x.x+(S-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(L<=T&&L>M&&(M=L,m=x.x<x.next.x?x:x.next,L===T))return m}x=x.next}while(x!==d);if(!m)return null;var R,O=m,V=m.x,q=m.y,Q=1/0;x=m;do T>=x.x&&x.x>=V&&T!==x.x&&Tu(S<q?T:M,S,V,q,S<q?M:T,S,x.x,x.y)&&(R=Math.abs(S-x.y)/(T-x.x),Rh(x,l)&&(R<Q||R===Q&&(x.x>m.x||x.x===m.x&&$p(m,x)))&&(m=x,Q=R)),x=x.next;while(x!==O);return m})(t,e);if(!r)return e;var i=qp(r,t);return wi(i,i.next),wi(r,r.next)}function $p(t,e){return In(t.prev,t,e.prev)<0&&In(e.next,t,t.next)<0}function Gp(t,e,r,i,l){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Wp(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Tu(t,e,r,i,l,d,m,x){return(l-m)*(e-x)>=(t-m)*(d-x)&&(t-m)*(i-x)>=(r-m)*(e-x)&&(r-m)*(d-x)>=(l-m)*(i-x)}function am(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!(function(r,i){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==i.i&&l.next.i!==i.i&&Lh(l,l.next,r,i))return!0;l=l.next}while(l!==r);return!1})(t,e)&&(Rh(t,e)&&Rh(e,t)&&(function(r,i){var l=r,d=!1,m=(r.x+i.x)/2,x=(r.y+i.y)/2;do l.y>x!=l.next.y>x&&l.next.y!==l.y&&m<(l.next.x-l.x)*(x-l.y)/(l.next.y-l.y)+l.x&&(d=!d),l=l.next;while(l!==r);return d})(t,e)&&(In(t.prev,t,e.prev)||In(t,e.prev,e))||Lc(t,e)&&In(t.prev,t,t.next)>0&&In(e.prev,e,e.next)>0)}function In(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Lc(t,e){return t.x===e.x&&t.y===e.y}function Lh(t,e,r,i){var l=Su(In(t,e,r)),d=Su(In(t,e,i)),m=Su(In(r,i,t)),x=Su(In(r,i,e));return l!==d&&m!==x||!(l!==0||!jh(t,r,e))||!(d!==0||!jh(t,i,e))||!(m!==0||!jh(r,t,i))||!(x!==0||!jh(r,e,i))}function jh(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Su(t){return t>0?1:t<0?-1:0}function Rh(t,e){return In(t.prev,t,t.next)<0?In(t,e,t.next)>=0&&In(t,t.prev,e)>=0:In(t,e,t.prev)<0||In(t,t.next,e)<0}function qp(t,e){var r=new zh(t.i,t.x,t.y),i=new zh(e.i,e.x,e.y),l=t.next,d=e.prev;return t.next=e,e.prev=t,r.next=l,l.prev=r,i.next=r,r.prev=i,d.next=i,i.prev=d,i}function zd(t,e,r,i){var l=new zh(t,e,r);return i?(l.next=i.next,l.prev=i,i.next.prev=l,i.next=l):(l.prev=l,l.next=l),l}function Bl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function zh(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Eu(t,e,r,i){for(var l=0,d=e,m=r-i;d<r;d+=i)l+=(t[m]-t[d])*(t[d+1]+t[m+1]),m=d;return l}Ld.exports=Dh,Ld.exports.default=Dh,Dh.deviation=function(t,e,r,i){var l=e&&e.length,d=Math.abs(Eu(t,0,l?e[0]*r:t.length,r));if(l)for(var m=0,x=e.length;m<x;m++)d-=Math.abs(Eu(t,e[m]*r,m<x-1?e[m+1]*r:t.length,r));var T=0;for(m=0;m<i.length;m+=3){var S=i[m]*r,M=i[m+1]*r,L=i[m+2]*r;T+=Math.abs((t[S]-t[L])*(t[M+1]-t[S+1])-(t[S]-t[M])*(t[L+1]-t[S+1]))}return d===0&&T===0?0:Math.abs((T-d)/d)},Dh.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,l=0;l<t.length;l++){for(var d=0;d<t[l].length;d++)for(var m=0;m<e;m++)r.vertices.push(t[l][d][m]);l>0&&r.holes.push(i+=t[l-1].length)}return r};var Nd=lt(Ld.exports);function pg(t,e,r,i,l){Nh(t,e,r,i||t.length-1,l||Fh)}function Nh(t,e,r,i,l){for(;i>r;){if(i-r>600){var d=i-r+1,m=e-r+1,x=Math.log(d),T=.5*Math.exp(2*x/3),S=.5*Math.sqrt(x*T*(d-T)/d)*(m-d/2<0?-1:1);Nh(t,e,Math.max(r,Math.floor(e-m*T/d+S)),Math.min(i,Math.floor(e+(d-m)*T/d+S)),l)}var M=t[e],L=r,R=i;for(Bh(t,r,e),l(t[i],M)>0&&Bh(t,r,i);L<R;){for(Bh(t,L,R),L++,R--;l(t[L],M)<0;)L++;for(;l(t[R],M)>0;)R--}l(t[r],M)===0?Bh(t,r,R):Bh(t,++R,i),R<=e&&(r=R+1),e<=R&&(i=R-1)}}function Bh(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function Fh(t,e){return t<e?-1:t>e?1:0}function Zp(t,e){const r=t.length;if(r<=1)return[t];const i=[];let l,d;for(let m=0;m<r;m++){const x=Mt(t[m]);x!==0&&(t[m].area=Math.abs(x),d===void 0&&(d=x<0),d===x<0?(l&&i.push(l),l=[t[m]]):l.push(t[m]))}if(l&&i.push(l),e>1)for(let m=0;m<i.length;m++)i[m].length<=e||(pg(i[m],e,1,i[m].length-1,Bd),i[m]=i[m].slice(0,e));return i}function Bd(t,e){return e.area-t.area}function o(t,e,r){const i=r.patternDependencies;let l=!1;for(const d of e){const m=d.paint.get(`${t}-pattern`);m.isConstant()||(l=!0);const x=m.constantOr(null);x&&(l=!0,i[x]=!0)}return l}function c(t,e,r,i,l){const d=l.patternDependencies;for(const m of e){const x=m.paint.get(`${t}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:i},r,{},l.availableImages);T=T&&T.name?T.name:T,d[T]=!0,r.patterns[m.id]=T}}return r}class _{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ft,this.indexArray=new Vt,this.indexArray2=new Sn,this.programConfigurations=new Al(e.layers,e.zoom),this.segments=new zn,this.segments2=new zn,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id)),this.projection=e.projection}populate(e,r,i,l){this.hasPattern=o("fill",this.layers,r);const d=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:x,id:T,index:S,sourceLayerIndex:M}of e){const L=this.layers[0]._featureFilter.needGeometry,R=ha(x,L);if(!this.layers[0]._featureFilter.filter(new I(this.zoom),R,i))continue;const O=d?d.evaluate(R,{},i,r.availableImages):void 0,V={id:T,properties:x.properties,type:x.type,sourceLayerIndex:M,index:S,geometry:L?R.geometry:qi(x,i,l),patterns:{},sortKey:O};m.push(V)}d&&m.sort(((x,T)=>x.sortKey-T.sortKey));for(const x of m){const{geometry:T,index:S,sourceLayerIndex:M}=x;if(this.hasPattern){const L=c("fill",this.layers,x,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(x,T,S,i,{},r.availableImages);r.featureIndex.insert(e[S].feature,T,S,M,this.index)}}update(e,r,i,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,i,l)}addFeatures(e,r,i,l,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,i,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hg),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,i,l,d,m=[]){for(const x of Zp(r,500)){let T=0;for(const V of x)T+=V.length;const S=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),M=S.vertexLength,L=[],R=[];for(const V of x){if(V.length===0)continue;V!==x[0]&&R.push(L.length/2);const q=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),Q=q.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(Q+V.length-1,Q),L.push(V[0].x),L.push(V[0].y);for(let oe=1;oe<V.length;oe++)this.layoutVertexArray.emplaceBack(V[oe].x,V[oe].y),this.indexArray2.emplaceBack(Q+oe-1,Q+oe),L.push(V[oe].x),L.push(V[oe].y);q.vertexLength+=V.length,q.primitiveLength+=V.length}const O=Nd(L,R);for(let V=0;V<O.length;V+=3)this.indexArray.emplaceBack(M+O[V],M+O[V+1],M+O[V+2]);S.vertexLength+=T,S.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,d,m,l)}}Lt(_,"FillBucket",{omit:["layers","patternFeatures"]});const k=new ce({"fill-sort-key":new te(rt.layout_fill["fill-sort-key"])});var D={paint:new ce({"fill-antialias":new W(rt.paint_fill["fill-antialias"]),"fill-opacity":new te(rt.paint_fill["fill-opacity"]),"fill-color":new te(rt.paint_fill["fill-color"]),"fill-outline-color":new te(rt.paint_fill["fill-outline-color"]),"fill-translate":new W(rt.paint_fill["fill-translate"]),"fill-translate-anchor":new W(rt.paint_fill["fill-translate-anchor"]),"fill-pattern":new te(rt.paint_fill["fill-pattern"])}),layout:k};const B=Ce([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),X=Ce([{name:"a_centroid_pos",components:2,type:"Uint16"}]),fe=Ce([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:ke}=B;var Ke={},Et=tt,At=bt;function bt(t,e,r,i,l){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=l,t.readFields(qt,this,e)}function qt(t,e,r){t==1?e.id=r.readVarint():t==2?(function(i,l){for(var d=i.readVarint()+i.pos;i.pos<d;){var m=l._keys[i.readVarint()],x=l._values[i.readVarint()];l.properties[m]=x}})(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function Yt(t){for(var e,r,i=0,l=0,d=t.length,m=d-1;l<d;m=l++)i+=((r=t[m]).x-(e=t[l]).x)*(e.y+r.y);return i}bt.types=["Unknown","Point","LineString","Polygon"],bt.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,l=0,d=0,m=0,x=[];t.pos<r;){if(l<=0){var T=t.readVarint();i=7&T,l=T>>3}if(l--,i===1||i===2)d+=t.readSVarint(),m+=t.readSVarint(),i===1&&(e&&x.push(e),e=[]),e.push(new Et(d,m));else{if(i!==7)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&x.push(e),x},bt.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,l=0,d=0,m=1/0,x=-1/0,T=1/0,S=-1/0;t.pos<e;){if(i<=0){var M=t.readVarint();r=7&M,i=M>>3}if(i--,r===1||r===2)(l+=t.readSVarint())<m&&(m=l),l>x&&(x=l),(d+=t.readSVarint())<T&&(T=d),d>S&&(S=d);else if(r!==7)throw new Error("unknown command "+r)}return[m,T,x,S]},bt.prototype.toGeoJSON=function(t,e,r){var i,l,d=this.extent*Math.pow(2,r),m=this.extent*t,x=this.extent*e,T=this.loadGeometry(),S=bt.types[this.type];function M(O){for(var V=0;V<O.length;V++){var q=O[V];O[V]=[360*(q.x+m)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+x)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(i=0;i<T.length;i++)L[i]=T[i][0];M(T=L);break;case 2:for(i=0;i<T.length;i++)M(T[i]);break;case 3:for(T=(function(O){var V=O.length;if(V<=1)return[O];for(var q,Q,oe=[],pe=0;pe<V;pe++){var ae=Yt(O[pe]);ae!==0&&(Q===void 0&&(Q=ae<0),Q===ae<0?(q&&oe.push(q),q=[O[pe]]):q.push(O[pe]))}return q&&oe.push(q),oe})(T),i=0;i<T.length;i++)for(l=0;l<T[i].length;l++)M(T[i][l])}T.length===1?T=T[0]:S="Multi"+S;var R={type:"Feature",geometry:{type:S,coordinates:T},properties:this.properties};return"id"in this&&(R.id=this.id),R};var Jt=At,Wn=We;function We(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ie,this,e),this.length=this._features.length}function Ie(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push((function(i){for(var l=null,d=i.readVarint()+i.pos;i.pos<d;){var m=i.readVarint()>>3;l=m===1?i.readString():m===2?i.readFloat():m===3?i.readDouble():m===4?i.readVarint64():m===5?i.readVarint():m===6?i.readSVarint():m===7?i.readBoolean():null}return l})(r))}We.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Jt(this._pbf,e,this.extent,this._keys,this._values)};var Xe=Wn;function jt(t,e,r){if(t===3){var i=new Xe(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i)}}var Qt=Ke.VectorTile=function(t,e){this.layers=t.readFields(jt,{},e)},or=Ke.VectorTileFeature=At;function ar(t,e,r,i){const l=[],d=i===0?(m,x,T,S,M,L)=>{m.push(new De(L,T+(L-x)/(S-x)*(M-T)))}:(m,x,T,S,M,L)=>{m.push(new De(x+(L-T)/(M-T)*(S-x),L))};for(const m of t){const x=[];for(const T of m){if(T.length<=2)continue;const S=[];for(let R=0;R<T.length-1;R++){const O=T[R].x,V=T[R].y,q=T[R+1].x,Q=T[R+1].y,oe=i===0?O:V,pe=i===0?q:Q;oe<e?pe>e&&d(S,O,V,q,Q,e):oe>r?pe<r&&d(S,O,V,q,Q,r):S.push(T[R]),pe<e&&oe>=e&&d(S,O,V,q,Q,e),pe>r&&oe<=r&&d(S,O,V,q,Q,r)}let M=T[T.length-1];const L=i===0?M.x:M.y;L>=e&&L<=r&&S.push(M),S.length&&(M=S[S.length-1],S[0].x===M.x&&S[0].y===M.y||S.push(S[0]),x.push(S))}x.length&&l.push(x)}return l}Ke.VectorTileLayer=Wn;const kr=or.types,Ti=Math.pow(2,13);function Zr(t,e,r,i,l,d,m,x){t.emplaceBack((e<<1)+m,(r<<1)+d,(Math.floor(i*Ti)<<1)+l,Math.round(x))}function ao(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class lm{constructor(){this.acc=new De(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new De(e.x,e.y),this.max=new De(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const i=this.min,l=this.max;e.x<i.x?i.x=e.x:e.x>l.x&&(l.x=e.x),e.y<i.y?i.y=e.y:e.y>l.y&&(l.y=e.y),((e.x===0||e.x===Zt)&&e.x===r.x)!=((e.y===0||e.y===Zt)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,Rr(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Zt!=e.x>Zt&&this.addBorderIntersection(1,Rr(r.y,e.y,(Zt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Rr(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Zt!=e.y>Zt&&this.addBorderIntersection(3,Rr(r.x,e.x,(Zt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[e];r<i[0]&&(i[0]=r),r>i[1]&&(i[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const i=e.x===0?0:1;this.addBorderIntersection(i,r.y),this.addBorderIntersection(i,e.y)}else{const i=e.y===0?2:3;this.addBorderIntersection(i,r.x),this.addBorderIntersection(i,e.x)}}centroid(){const e=this.polyCount.reduce(((r,i)=>r+i.edges),0);return e!==0?this.acc.div(e)._round():new De(0,0)}span(){return new De(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((e,r)=>e+ +(r[0]!==Number.MAX_VALUE)),0)}}class Hp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Je,this.centroidVertexArray=new Ts,this.indexArray=new Vt,this.programConfigurations=new Al(e.layers,e.zoom),this.segments=new zn,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id)),this.enableTerrain=e.enableTerrain}populate(e,r,i,l){this.features=[],this.hasPattern=o("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=(function(d){const m=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*m/(m*m+1)/Zt/(1<<d.z)})(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:d,id:m,index:x,sourceLayerIndex:T}of e){const S=this.layers[0]._featureFilter.needGeometry,M=ha(d,S);if(!this.layers[0]._featureFilter.filter(new I(this.zoom),M,i))continue;const L={id:m,sourceLayerIndex:T,index:x,geometry:S?M.geometry:qi(d,i,l),properties:d.properties,type:d.type,patterns:{}},R=this.layoutVertexArray.length;this.hasPattern?this.features.push(c("fill-extrusion",this.layers,L,this.zoom,r)):this.addFeature(L,L.geometry,x,i,{},r.availableImages,l),r.featureIndex.insert(d,L.geometry,x,T,this.index,R)}this.sortBorders()}addFeatures(e,r,i,l,d){for(const m of this.features){const{geometry:x}=m;this.addFeature(m,x,m.index,r,i,l,d)}this.sortBorders()}update(e,r,i,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,i,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ke),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,fe.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,X.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,i,l,d,m,x){const T=[new De(0,0),new De(Zt,Zt)],S=x.projection,M=S.name==="globe",L=this.enableTerrain&&!M?new lm:null,R=kr[e.type]==="Polygon";M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ht);const O=Zp(r,500);for(let oe=O.length-1;oe>=0;oe--){const pe=O[oe];(pe.length===0||(V=pe[0]).every((ae=>ae.x<=0))||V.every((ae=>ae.x>=Zt))||V.every((ae=>ae.y<=0))||V.every((ae=>ae.y>=Zt)))&&O.splice(oe,1)}var V;let q;if(M)q=O0(O,T,l);else{q=[];for(const oe of O)q.push({polygon:oe,bounds:T})}const Q=R?this.edgeRadius:0;for(const{polygon:oe,bounds:pe}of q){let ae=0,de=0;for(const ge of oe)R&&!ge[0].equals(ge[ge.length-1])&&ge.push(ge[0]),de+=R?ge.length-1:ge.length;const ye=this.segments.prepareSegment((R?5:4)*de,this.layoutVertexArray,this.indexArray);if(R){const ge=[],Ge=[];ae=ye.vertexLength;for(const nt of oe){let yt,Ze;nt.length&&nt!==oe[0]&&Ge.push(ge.length/2),yt=nt[1].sub(nt[0])._perp()._unit();for(let ot=1;ot<nt.length;ot++){const at=nt[ot],pt=nt[ot===nt.length-1?1:ot+1];let{x:wt,y:et}=at;if(Q){Ze=pt.sub(at)._perp()._unit();const Dt=yt.add(Ze)._unit(),Ft=Q*Math.min(4,1/(yt.x*Dt.x+yt.y*Dt.y));wt+=Ft*Dt.x,et+=Ft*Dt.y,yt=Ze}Zr(this.layoutVertexArray,wt,et,0,0,1,1,0),ye.vertexLength++,ge.push(at.x,at.y),M&&ao(this.layoutVertexExtArray,S.projectTilePoint(wt,et,l),S.upVector(l,wt,et))}}const Ne=Nd(ge,Ge);for(let nt=0;nt<Ne.length;nt+=3)this.indexArray.emplaceBack(ae+Ne[nt],ae+Ne[nt+2],ae+Ne[nt+1]),ye.primitiveLength++}for(const ge of oe){L&&ge.length&&L.startRing(ge[0]);let Ge,Ne,nt,yt=ge.length>4&&N0(ge[ge.length-2],ge[0],ge[1]),Ze=Q?lw(ge[ge.length-2],ge[0],ge[1],Q):0;Ne=ge[1].sub(ge[0])._perp()._unit();let ot=!0;for(let at=1,pt=0;at<ge.length;at++){let wt=ge[at-1],et=ge[at];const Dt=ge[at===ge.length-1?1:at+1];if(L&&R&&L.currentPolyCount.top++,z0(et,wt,pe)){Q&&(Ne=Dt.sub(et)._perp()._unit(),ot=!ot);continue}L&&L.append(et,wt);const Ft=et.sub(wt)._perp(),zt=Ft.x/(Math.abs(Ft.x)+Math.abs(Ft.y)),gr=Ft.y>0?1:0,Tt=wt.dist(et);if(pt+Tt>32768&&(pt=0),Q){nt=Dt.sub(et)._perp()._unit();let _r=R0(wt,et,Dt,j0(Ne,nt),Q);isNaN(_r)&&(_r=0);const tr=et.sub(wt)._unit();wt=wt.add(tr.mult(Ze))._round(),et=et.add(tr.mult(-_r))._round(),Ze=_r,Ne=nt}const Ht=ye.vertexLength,yr=ge.length>4&&N0(wt,et,Dt);let Hr=B0(pt,yt,ot);if(Zr(this.layoutVertexArray,wt.x,wt.y,zt,gr,0,0,Hr),Zr(this.layoutVertexArray,wt.x,wt.y,zt,gr,0,1,Hr),pt+=Tt,Hr=B0(pt,yr,!ot),yt=yr,Zr(this.layoutVertexArray,et.x,et.y,zt,gr,0,0,Hr),Zr(this.layoutVertexArray,et.x,et.y,zt,gr,0,1,Hr),ye.vertexLength+=4,this.indexArray.emplaceBack(Ht+0,Ht+1,Ht+2),this.indexArray.emplaceBack(Ht+1,Ht+3,Ht+2),ye.primitiveLength+=2,Q){const _r=ae+(at===1?ge.length-2:at-2),tr=at===1?ae:_r+1;if(this.indexArray.emplaceBack(Ht+1,_r,Ht+3),this.indexArray.emplaceBack(_r,tr,Ht+3),ye.primitiveLength+=2,Ge===void 0&&(Ge=Ht),!z0(Dt,ge[at],pe)){const yn=at===ge.length-1?Ge:ye.vertexLength;this.indexArray.emplaceBack(Ht+2,Ht+3,yn),this.indexArray.emplaceBack(Ht+3,yn+1,yn),this.indexArray.emplaceBack(Ht+3,tr,yn+1),ye.primitiveLength+=3}ot=!ot}if(M){const _r=this.layoutVertexExtArray,tr=S.projectTilePoint(wt.x,wt.y,l),yn=S.projectTilePoint(et.x,et.y,l),wr=S.upVector(l,wt.x,wt.y),Tr=S.upVector(l,et.x,et.y);ao(_r,tr,wr),ao(_r,tr,wr),ao(_r,yn,Tr),ao(_r,yn,Tr)}}R&&(ae+=ge.length-1)}}if(L&&L.polyCount.length>0){if(L.borders){L.vertexArrayOffset=this.centroidVertexArray.length;const oe=L.borders,pe=this.featuresOnBorder.push(L)-1;for(let ae=0;ae<4;ae++)oe[ae][0]!==Number.MAX_VALUE&&this.borders[ae].push(pe)}this.encodeCentroid(L.borders?void 0:L.centroid(),L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,d,m,l)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort(((r,i)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[i].borders[e][0]))}encodeCentroid(e,r,i=!0){let l,d;if(e)if(e.y!==0){const x=r.span()._mult(this.tileToMeter);l=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(x.x/10)),d=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else l=Math.ceil(7*(e.x+450)),d=0;else l=0,d=+i;let m=i?this.centroidVertexArray.length:r.vertexArrayOffset;for(const x of r.polyCount){i&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let T=0;T<x.top;T++)this.centroidVertexArray.emplace(m++,l,d);for(let T=0;T<2*x.edges;T++)this.centroidVertexArray.emplace(m++,0,d),this.centroidVertexArray.emplace(m++,l,d)}}}function j0(t,e){const r=t.add(e)._unit();return t.x*r.x+t.y*r.y}function lw(t,e,r,i){const l=e.sub(t)._perp()._unit(),d=r.sub(e)._perp()._unit();return R0(t,e,r,j0(l,d),i)}function R0(t,e,r,i,l){const d=Math.sqrt(1-i*i);return Math.min(t.dist(e)/3,e.dist(r)/3,l*d/i)}function z0(t,e,r){return t.x<r[0].x&&e.x<r[0].x||t.x>r[1].x&&e.x>r[1].x||t.y<r[0].y&&e.y<r[0].y||t.y>r[1].y&&e.y>r[1].y}function N0(t,e,r){if(t.x<0||t.x>=Zt||e.x<0||e.x>=Zt||r.x<0||r.x>=Zt)return!1;const i=r.sub(e),l=i.perp(),d=t.sub(e);return(i.x*d.x+i.y*d.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(d.x*d.x+d.y*d.y))>-.866&&l.x*d.x+l.y*d.y<0}function B0(t,e,r){const i=e?2|t:-3&t;return r?1|i:-2&i}function F0(){const t=Math.PI/32,e=Math.tan(t),r=Dl;return r*Math.sqrt(1+2*e*e)-r}function O0(t,e,r){const i=1<<r.z,l=bi(r.x/i),d=bi((r.x+1)/i),m=qr(r.y/i),x=qr((r.y+1)/i);return(function(T,S,M,L,R=0,O){const V=[];if(!T.length||!M||!L)return V;const q=(ge,Ge)=>{for(const Ne of ge)V.push({polygon:Ne,bounds:Ge})},Q=Math.ceil(Math.log2(M)),oe=Math.ceil(Math.log2(L)),pe=Q-oe,ae=[];for(let ge=0;ge<Math.abs(pe);ge++)ae.push(pe>0?0:1);for(let ge=0;ge<Math.min(Q,oe);ge++)ae.push(0),ae.push(1);let de=T;if(de=ar(de,S[0].y-R,S[1].y+R,1),de=ar(de,S[0].x-R,S[1].x+R,0),!de.length)return V;const ye=[];for(ae.length?ye.push({polygons:de,bounds:S,depth:0}):q(de,S);ye.length;){const ge=ye.pop(),Ge=ge.depth,Ne=ae[Ge],nt=ge.bounds[0],yt=ge.bounds[1],Ze=Ne===0?nt.x:nt.y,ot=Ne===0?yt.x:yt.y,at=O?O(Ne,Ze,ot):.5*(Ze+ot),pt=ar(ge.polygons,Ze-R,at+R,Ne),wt=ar(ge.polygons,at-R,ot+R,Ne);if(pt.length){const et=[nt,new De(Ne===0?at:yt.x,Ne===1?at:yt.y)];ae.length>Ge+1?ye.push({polygons:pt,bounds:et,depth:Ge+1}):q(pt,et)}if(wt.length){const et=[new De(Ne===0?at:nt.x,Ne===1?at:nt.y),yt];ae.length>Ge+1?ye.push({polygons:wt,bounds:et,depth:Ge+1}):q(wt,et)}}return V})(t,e,Math.ceil((d-l)/11.25),Math.ceil((m-x)/11.25),1,((T,S,M)=>{if(T===0)return .5*(S+M);{const L=qr((r.y+S/Zt)/i);return(wn(.5*(qr((r.y+M/Zt)/i)+L))*i-r.y)*Zt}}))}Lt(Hp,"FillExtrusionBucket",{omit:["layers","features"]}),Lt(lm,"PartMetadata");const cw=new ce({"fill-extrusion-edge-radius":new W(rt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var uw={paint:new ce({"fill-extrusion-opacity":new W(rt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new te(rt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new W(rt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new W(rt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new te(rt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new te(rt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new te(rt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new W(rt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new W(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new W(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new W(rt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:cw};function U0(t,e,r){var i=2*Math.PI*6378137/256/Math.pow(2,r);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}class cm{constructor(e,r,i){this.z=e,this.x=r,this.y=i,this.key=Xp(0,e,e,r,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const i=(function(d,m,x){var T=U0(256*d,256*(m=Math.pow(2,x)-m-1),x),S=U0(256*(d+1),256*(m+1),x);return T[0]+","+T[1]+","+S[0]+","+S[1]})(this.x,this.y,this.z),l=(function(d,m,x){let T,S="";for(let M=d;M>0;M--)T=1<<M-1,S+=(m&T?1:0)+(x&T?2:0);return S})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class V0{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Xp(e,r.z,r.z,r.x,r.y)}}class Cs{constructor(e,r,i,l,d){this.overscaledZ=e,this.wrap=r,this.canonical=new cm(i,+l,+d),this.key=r===0&&e===i?this.canonical.key:Xp(r,e,i,l,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Cs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Cs(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Xp(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-e;return Xp(this.wrap*+r,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Cs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,i=2*this.canonical.x,l=2*this.canonical.y;return[new Cs(r,this.wrap,r,i,l),new Cs(r,this.wrap,r,i+1,l),new Cs(r,this.wrap,r,i,l+1),new Cs(r,this.wrap,r,i+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Cs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Cs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new V0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Xp(t,e,r,i,l){const d=1<<Math.min(r,22);let m=d*(l%d)+i%d;return t&&r<22&&(m+=d*d*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*m+r)+(e-r)}Lt(cm,"CanonicalTileID"),Lt(Cs,"OverscaledTileID",{omit:["projMatrix"]});class Fd extends De{constructor(e,r,i){super(e,r),this.z=i}}function Kp(t,e){return t.x*e.x+t.y*e.y}function $0(t,e){if(t.length===1){let r=0;const i=e[r++];let l;for(;!l||i.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const d=e[r],m=t[0],x=l.sub(i),T=d.sub(i),S=m.sub(i),M=Kp(x,x),L=Kp(x,T),R=Kp(T,T),O=Kp(S,x),V=Kp(S,T),q=M*R-L*L,Q=(R*O-L*V)/q,oe=(M*V-L*O)/q,pe=i.z*(1-Q-oe)+l.z*Q+d.z*oe;if(isFinite(pe))return pe}return 1/0}{let r=1/0;for(const i of e)r=Math.min(r,i.z);return r}}function G0(t,e,r,i,l,d,m,x){const T=m*l.getElevationAt(t,e,!0,!0),S=d[0]!==0,M=S?d[1]===0?m*(d[0]/7-450):m*(function(L,R,O){const V=Math.floor(R[0]/8),q=Math.floor(R[1]/8),Q=10*(R[0]-8*V),oe=10*(R[1]-8*q),pe=L.getElevationAt(V,q,!0,!0),ae=L.getMeterToDEM(O),de=Math.floor(.5*(Q*ae-1)),ye=Math.floor(.5*(oe*ae-1)),ge=L.tileCoordToPixel(V,q),Ge=2*de+1,Ne=2*ye+1,nt=(function(wt,et,Dt,Ft,zt){return[wt.getElevationAtPixel(et,Dt,!0),wt.getElevationAtPixel(et+zt,Dt,!0),wt.getElevationAtPixel(et,Dt+zt,!0),wt.getElevationAtPixel(et+Ft,Dt+zt,!0)]})(L,ge.x-de,ge.y-ye,Ge,Ne),yt=Math.abs(nt[0]-nt[1]),Ze=Math.abs(nt[2]-nt[3]),ot=Math.abs(nt[0]-nt[2])+Math.abs(nt[1]-nt[3]),at=Math.min(.25,.5*ae*(yt+Ze)/Ge),pt=Math.min(.25,.5*ae*ot/Ne);return pe+Math.max(at*Q,pt*oe)})(l,d,x):T;return{base:T+(r===0)?-1:r,top:S?Math.max(M+i,T+r+2):T+i}}const hw=Ce([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:dw}=hw,pw=Ce([{name:"a_packed",components:4,type:"Float32"}]),{members:fw}=pw,mw=or.types,gw=Math.cos(Math.PI/180*37.5);class um{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new Ve,this.layoutVertexArray2=new dt,this.indexArray=new Vt,this.programConfigurations=new Al(e.layers,e.zoom),this.segments=new zn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,i,l){this.hasPattern=o("line",this.layers,r);const d=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:M,id:L,index:R,sourceLayerIndex:O}of e){const V=this.layers[0]._featureFilter.needGeometry,q=ha(M,V);if(!this.layers[0]._featureFilter.filter(new I(this.zoom),q,i))continue;const Q=d?d.evaluate(q,{},i):void 0,oe={id:L,properties:M.properties,type:M.type,sourceLayerIndex:O,index:R,geometry:V?q.geometry:qi(M,i,l),patterns:{},sortKey:Q};m.push(oe)}d&&m.sort(((M,L)=>M.sortKey-L.sortKey));const{lineAtlas:x,featureIndex:T}=r,S=this.addConstantDashes(x);for(const M of m){const{geometry:L,index:R,sourceLayerIndex:O}=M;if(S&&this.addFeatureDashes(M,x),this.hasPattern){const V=c("line",this.layers,M,this.zoom,r);this.patternFeatures.push(V)}else this.addFeature(M,L,R,i,x.positions,r.availableImages);T.insert(e[R].feature,L,R,O,this.index)}}addConstantDashes(e){let r=!1;for(const i of this.layers){const l=i.paint.get("line-dasharray").value,d=i.layout.get("line-cap").value;if(l.kind!=="constant"||d.kind!=="constant")r=!0;else{const m=d.value,x=l.value;if(!x)continue;e.addDash(x,m)}}return r}addFeatureDashes(e,r){const i=this.zoom;for(const l of this.layers){const d=l.paint.get("line-dasharray").value,m=l.layout.get("line-cap").value;if(d.kind==="constant"&&m.kind==="constant")continue;let x,T;if(d.kind==="constant"){if(x=d.value,!x)continue}else x=d.evaluate({zoom:i},e);T=m.kind==="constant"?m.value:m.evaluate({zoom:i},e),r.addDash(x,T),e.patterns[l.id]=r.getKey(x,T)}}update(e,r,i,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,i,l)}addFeatures(e,r,i,l,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,i,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,fw)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dw),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,i,l,d,m){const x=this.layers[0].layout,T=x.get("line-join").evaluate(e,{}),S=x.get("line-cap").evaluate(e,{}),M=x.get("line-miter-limit"),L=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const R of r)this.addLine(R,e,T,S,M,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,d,m,l)}addLine(e,r,i,l,d,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let oe=0;oe<e.length-1;oe++)this.totalDistance+=e[oe].dist(e[oe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=mw[r.type]==="Polygon";let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let S=0;for(;S<T-1&&e[S].equals(e[S+1]);)S++;if(T<(x?3:2))return;i==="bevel"&&(d=1.05);const M=this.overscaling<=16?15*Zt/(512*this.overscaling):0,L=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let R,O,V,q,Q;this.e1=this.e2=-1,x&&(R=e[T-2],Q=e[S].sub(R)._unit()._perp());for(let oe=S;oe<T;oe++){if(V=oe===T-1?x?e[S+1]:void 0:e[oe+1],V&&e[oe].equals(V))continue;Q&&(q=Q),R&&(O=R),R=e[oe],Q=V?V.sub(R)._unit()._perp():q,q=q||Q;let pe=q.add(Q);pe.x===0&&pe.y===0||pe._unit();const ae=q.x*Q.x+q.y*Q.y,de=pe.x*Q.x+pe.y*Q.y,ye=de!==0?1/de:1/0,ge=2*Math.sqrt(2-2*de),Ge=de<gw&&O&&V,Ne=q.x*Q.y-q.y*Q.x>0;if(Ge&&oe>S){const Ze=R.dist(O);if(Ze>2*M){const ot=R.sub(R.sub(O)._mult(M/Ze)._round());this.updateDistance(O,ot),this.addCurrentVertex(ot,q,0,0,L),O=ot}}const nt=O&&V;let yt=nt?i:x?"butt":l;if(nt&&yt==="round"&&(ye<m?yt="miter":ye<=2&&(yt="fakeround")),yt==="miter"&&ye>d&&(yt="bevel"),yt==="bevel"&&(ye>2&&(yt="flipbevel"),ye<d&&(yt="miter")),O&&this.updateDistance(O,R),yt==="miter")pe._mult(ye),this.addCurrentVertex(R,pe,0,0,L);else if(yt==="flipbevel"){if(ye>100)pe=Q.mult(-1);else{const Ze=ye*q.add(Q).mag()/q.sub(Q).mag();pe._perp()._mult(Ze*(Ne?-1:1))}this.addCurrentVertex(R,pe,0,0,L),this.addCurrentVertex(R,pe.mult(-1),0,0,L)}else if(yt==="bevel"||yt==="fakeround"){const Ze=-Math.sqrt(ye*ye-1),ot=Ne?Ze:0,at=Ne?0:Ze;if(O&&this.addCurrentVertex(R,q,ot,at,L),yt==="fakeround"){const pt=Math.round(180*ge/Math.PI/20);for(let wt=1;wt<pt;wt++){let et=wt/pt;if(et!==.5){const Ft=et-.5;et+=et*Ft*(et-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*Ft*Ft+(.848013+ae*(.215638*ae-1.06021)))}const Dt=Q.sub(q)._mult(et)._add(q)._unit()._mult(Ne?-1:1);this.addHalfVertex(R,Dt.x,Dt.y,!1,Ne,0,L)}}V&&this.addCurrentVertex(R,Q,-ot,-at,L)}else if(yt==="butt")this.addCurrentVertex(R,pe,0,0,L);else if(yt==="square"){const Ze=O?1:-1;O||this.addCurrentVertex(R,pe,Ze,Ze,L),this.addCurrentVertex(R,pe,0,0,L),O&&this.addCurrentVertex(R,pe,Ze,Ze,L)}else yt==="round"&&(O&&(this.addCurrentVertex(R,q,0,0,L),this.addCurrentVertex(R,q,1,1,L,!0)),V&&(this.addCurrentVertex(R,Q,-1,-1,L,!0),this.addCurrentVertex(R,Q,0,0,L)));if(Ge&&oe<T-1){const Ze=R.dist(V);if(Ze>2*M){const ot=R.add(V.sub(R)._mult(M/Ze)._round());this.updateDistance(R,ot),this.addCurrentVertex(ot,Q,0,0,L),R=ot}}}}addCurrentVertex(e,r,i,l,d,m=!1){const x=r.y*l-r.x,T=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*i,r.y-r.x*i,m,!1,i,d),this.addHalfVertex(e,x,T,m,!0,-l,d)}addHalfVertex({x:e,y:r},i,l,d,m,x,T){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(r<<1)+(m?1:0),Math.round(63*i)+128,Math.round(63*l)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const S=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),T.primitiveLength++),m?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Lt(um,"LineBucket",{omit:["layers","patternFeatures"]});const yw=new ce({"line-cap":new te(rt.layout_line["line-cap"]),"line-join":new te(rt.layout_line["line-join"]),"line-miter-limit":new W(rt.layout_line["line-miter-limit"]),"line-round-limit":new W(rt.layout_line["line-round-limit"]),"line-sort-key":new te(rt.layout_line["line-sort-key"])});var W0={paint:new ce({"line-opacity":new te(rt.paint_line["line-opacity"]),"line-color":new te(rt.paint_line["line-color"]),"line-translate":new W(rt.paint_line["line-translate"]),"line-translate-anchor":new W(rt.paint_line["line-translate-anchor"]),"line-width":new te(rt.paint_line["line-width"]),"line-gap-width":new te(rt.paint_line["line-gap-width"]),"line-offset":new te(rt.paint_line["line-offset"]),"line-blur":new te(rt.paint_line["line-blur"]),"line-dasharray":new te(rt.paint_line["line-dasharray"]),"line-pattern":new te(rt.paint_line["line-pattern"]),"line-gradient":new le(rt.paint_line["line-gradient"]),"line-trim-offset":new W(rt.paint_line["line-trim-offset"])}),layout:yw};const q0=new class extends te{possiblyEvaluate(t,e){return e=new I(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,i){return e=Ot({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,i)}}(W0.paint.properties["line-width"].specification);function Z0(t,e){return e>0?e+2*t:t}q0.useIntegerZoom=!0;const _w=Ce([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),xw=Ce([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),vw=Ce([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ce([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const bw=Ce([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ww=Ce([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ce([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const H0=Ce([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Tw=Ce([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ce([{name:"triangle",components:3,type:"Uint16"}]),Ce([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ce([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ce([{type:"Float32",name:"offsetX"}]),Ce([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ri=24;const Ua=128;function fg(t,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new I(t+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:i,interpolationType:l}=r;let d=0;for(;d<i.length&&i[d]<=t;)d++;d=Math.max(0,d-1);let m=d;for(;m<i.length&&i[m]<t+1;)m++;m=Math.min(i.length-1,m);const x=i[d],T=i[m];return r.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:T,interpolationType:l}:{kind:"camera",minZoom:x,maxZoom:T,minSize:r.evaluate(new I(x)),maxSize:r.evaluate(new I(T)),interpolationType:l}}}function hm(t,{uSize:e,uSizeT:r},{lowerSize:i,upperSize:l}){return t.kind==="source"?i/Ua:t.kind==="composite"?Rr(i/Ua,l/Ua,r):e}function Od(t,e){let r=0,i=0;if(t.kind==="constant")i=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:l,minZoom:d,maxZoom:m}=t,x=l?Fe(Fi.interpolationFactor(l,e,d,m),0,1):0;t.kind==="camera"?i=Rr(t.minSize,t.maxSize,x):r=x}return{uSizeT:r,uSize:i}}var Sw=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ua,evaluateSizeForFeature:hm,evaluateSizeForZoom:Od,getSizeData:fg});function Ew(t,e,r){return t.sections.forEach((i=>{i.text=(function(l,d,m){const x=d.layout.get("text-transform").evaluate(m,{});return x==="uppercase"?l=l.toLocaleUpperCase():x==="lowercase"&&(l=l.toLocaleLowerCase()),A.applyArabicShaping&&(l=A.applyArabicShaping(l)),l})(i.text,e,r)})),t}const Yp={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function kw(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function Cw(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}var X0=un,K0=function(t,e,r,i,l){var d,m,x=8*l-i-1,T=(1<<x)-1,S=T>>1,M=-7,L=l-1,R=-1,O=t[e+L];for(L+=R,d=O&(1<<-M)-1,O>>=-M,M+=x;M>0;d=256*d+t[e+L],L+=R,M-=8);for(m=d&(1<<-M)-1,d>>=-M,M+=i;M>0;m=256*m+t[e+L],L+=R,M-=8);if(d===0)d=1-S;else{if(d===T)return m?NaN:1/0*(O?-1:1);m+=Math.pow(2,i),d-=S}return(O?-1:1)*m*Math.pow(2,d-i)},Y0=function(t,e,r,i,l,d){var m,x,T,S=8*d-l-1,M=(1<<S)-1,L=M>>1,R=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=0,V=1,q=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,m=M):(m=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-m))<1&&(m--,T*=2),(e+=m+L>=1?R/T:R*Math.pow(2,1-L))*T>=2&&(m++,T/=2),m+L>=M?(x=0,m=M):m+L>=1?(x=(e*T-1)*Math.pow(2,l),m+=L):(x=e*Math.pow(2,L-1)*Math.pow(2,l),m=0));l>=8;t[r+O]=255&x,O+=V,x/=256,l-=8);for(m=m<<l|x,S+=l;S>0;t[r+O]=255&m,O+=V,m/=256,S-=8);t[r+O-V]|=128*q};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function un(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}un.Varint=0,un.Fixed64=1,un.Bytes=2,un.Fixed32=5;var mg=4294967296,J0=1/mg,Q0=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function jc(t){return t.type===un.Bytes?t.readVarint()+t.pos:t.pos+1}function Ud(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function e_(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(i);for(var l=r.pos-1;l>=t;l--)r.buf[l+i]=r.buf[l]}function Aw(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Mw(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function Pw(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Iw(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Dw(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Lw(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function jw(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function Rw(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function zw(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function dm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Vd(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function t_(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}un.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),l=i>>3,d=this.pos;this.type=7&i,t(l,e,this),this.pos===d&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=dm(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=t_(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=dm(this.buf,this.pos)+dm(this.buf,this.pos+4)*mg;return this.pos+=8,t},readSFixed64:function(){var t=dm(this.buf,this.pos)+t_(this.buf,this.pos+4)*mg;return this.pos+=8,t},readFloat:function(){var t=K0(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=K0(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,i=this.buf;return e=127&(r=i[this.pos++]),r<128?e:(e|=(127&(r=i[this.pos++]))<<7,r<128?e:(e|=(127&(r=i[this.pos++]))<<14,r<128?e:(e|=(127&(r=i[this.pos++]))<<21,r<128?e:(function(l,d,m){var x,T,S=m.buf;if(x=(112&(T=S[m.pos++]))>>4,T<128||(x|=(127&(T=S[m.pos++]))<<3,T<128)||(x|=(127&(T=S[m.pos++]))<<10,T<128)||(x|=(127&(T=S[m.pos++]))<<17,T<128)||(x|=(127&(T=S[m.pos++]))<<24,T<128)||(x|=(1&(T=S[m.pos++]))<<31,T<128))return Ud(l,x,d);throw new Error("Expected varint not more than 10 bytes")})(e|=(15&(r=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Q0?(function(r,i,l){return Q0.decode(r.subarray(i,l))})(this.buf,e,t):(function(r,i,l){for(var d="",m=i;m<l;){var x,T,S,M=r[m],L=null,R=M>239?4:M>223?3:M>191?2:1;if(m+R>l)break;R===1?M<128&&(L=M):R===2?(192&(x=r[m+1]))==128&&(L=(31&M)<<6|63&x)<=127&&(L=null):R===3?(T=r[m+2],(192&(x=r[m+1]))==128&&(192&T)==128&&((L=(15&M)<<12|(63&x)<<6|63&T)<=2047||L>=55296&&L<=57343)&&(L=null)):R===4&&(T=r[m+2],S=r[m+3],(192&(x=r[m+1]))==128&&(192&T)==128&&(192&S)==128&&((L=(15&M)<<18|(63&x)<<12|(63&T)<<6|63&S)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,R=1):L>65535&&(L-=65536,d+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),d+=String.fromCharCode(L),m+=R}return d})(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==un.Bytes)return t.push(this.readVarint(e));var r=jc(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==un.Bytes)return t.push(this.readSVarint());var e=jc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==un.Bytes)return t.push(this.readBoolean());var e=jc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==un.Bytes)return t.push(this.readFloat());var e=jc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==un.Bytes)return t.push(this.readDouble());var e=jc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==un.Bytes)return t.push(this.readFixed32());var e=jc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==un.Bytes)return t.push(this.readSFixed32());var e=jc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==un.Bytes)return t.push(this.readFixed64());var e=jc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==un.Bytes)return t.push(this.readSFixed64());var e=jc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===un.Varint)for(;this.buf[this.pos++]>127;);else if(e===un.Bytes)this.pos=this.readVarint()+this.pos;else if(e===un.Fixed32)this.pos+=4;else{if(e!==un.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Vd(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Vd(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Vd(this.buf,-1&t,this.pos),Vd(this.buf,Math.floor(t*J0),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Vd(this.buf,-1&t,this.pos),Vd(this.buf,Math.floor(t*J0),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?(function(e,r){var i,l;if(e>=0?(i=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),(function(d,m,x){x.buf[x.pos++]=127&d|128,d>>>=7,x.buf[x.pos++]=127&d|128,d>>>=7,x.buf[x.pos++]=127&d|128,d>>>=7,x.buf[x.pos++]=127&d|128,x.buf[x.pos]=127&(d>>>=7)})(i,0,r),(function(d,m){var x=(7&d)<<4;m.buf[m.pos++]|=x|((d>>>=3)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d)))))})(l,r)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=(function(i,l,d){for(var m,x,T=0;T<l.length;T++){if((m=l.charCodeAt(T))>55295&&m<57344){if(!x){m>56319||T+1===l.length?(i[d++]=239,i[d++]=191,i[d++]=189):x=m;continue}if(m<56320){i[d++]=239,i[d++]=191,i[d++]=189,x=m;continue}m=x-55296<<10|m-56320|65536,x=null}else x&&(i[d++]=239,i[d++]=191,i[d++]=189,x=null);m<128?i[d++]=m:(m<2048?i[d++]=m>>6|192:(m<65536?i[d++]=m>>12|224:(i[d++]=m>>18|240,i[d++]=m>>12&63|128),i[d++]=m>>6&63|128),i[d++]=63&m|128)}return d})(this.buf,t,this.pos);var r=this.pos-e;r>=128&&e_(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Y0(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Y0(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&e_(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,un.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Aw,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Mw,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Dw,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Pw,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Iw,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Lw,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,jw,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Rw,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,zw,e)},writeBytesField:function(t,e){this.writeTag(t,un.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,un.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,un.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,un.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,un.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,un.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,un.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,un.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,un.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,un.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var pm=lt(X0);const gg=3;function Nw(t,e,r){e.glyphs=[],t===1&&r.readMessage(Bw,e)}function Bw(t,e,r){if(t===3){const{id:i,bitmap:l,width:d,height:m,left:x,top:T,advance:S}=r.readMessage(Fw,{});e.glyphs.push({id:i,bitmap:new ks({width:d+2*gg,height:m+2*gg},l),metrics:{width:d,height:m,left:x,top:T,advance:S}})}else t===4?e.ascender=r.readSVarint():t===5&&(e.descender=r.readSVarint())}function Fw(t,e,r){t===1?e.id=r.readVarint():t===2?e.bitmap=r.readBytes():t===3?e.width=r.readVarint():t===4?e.height=r.readVarint():t===5?e.left=r.readSVarint():t===6?e.top=r.readSVarint():t===7&&(e.advance=r.readVarint())}const r_=gg;function yg(t){let e=0,r=0;for(const m of t)e+=m.w*m.h,r=Math.max(r,m.w);t.sort(((m,x)=>x.h-m.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,d=0;for(const m of t)for(let x=i.length-1;x>=0;x--){const T=i[x];if(!(m.w>T.w||m.h>T.h)){if(m.x=T.x,m.y=T.y,d=Math.max(d,m.y+m.h),l=Math.max(l,m.x+m.w),m.w===T.w&&m.h===T.h){const S=i.pop();x<i.length&&(i[x]=S)}else m.h===T.h?(T.x+=m.w,T.w-=m.w):m.w===T.w?(T.y+=m.h,T.h-=m.h):(i.push({x:T.x+m.w,y:T.y,w:T.w-m.w,h:m.h}),T.y+=m.h,T.h-=m.h);break}}return{w:l,h:d,fill:e/(l*d)||0}}const Gs=1;class _g{constructor(e,{pixelRatio:r,version:i,stretchX:l,stretchY:d,content:m}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=d,this.content=m,this.version=i}get tl(){return[this.paddedRect.x+Gs,this.paddedRect.y+Gs]}get br(){return[this.paddedRect.x+this.paddedRect.w-Gs,this.paddedRect.y+this.paddedRect.h-Gs]}get displaySize(){return[(this.paddedRect.w-2*Gs)/this.pixelRatio,(this.paddedRect.h-2*Gs)/this.pixelRatio]}}class n_{constructor(e,r){const i={},l={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,i,d),this.addImages(r,l,d);const{w:m,h:x}=yg(d),T=new as({width:m||1,height:x||1});for(const S in e){const M=e[S],L=i[S].paddedRect;as.copy(M.data,T,{x:0,y:0},{x:L.x+Gs,y:L.y+Gs},M.data)}for(const S in r){const M=r[S],L=l[S].paddedRect,R=L.x+Gs,O=L.y+Gs,V=M.data.width,q=M.data.height;as.copy(M.data,T,{x:0,y:0},{x:R,y:O},M.data),as.copy(M.data,T,{x:0,y:q-1},{x:R,y:O-1},{width:V,height:1}),as.copy(M.data,T,{x:0,y:0},{x:R,y:O+q},{width:V,height:1}),as.copy(M.data,T,{x:V-1,y:0},{x:R-1,y:O},{width:1,height:q}),as.copy(M.data,T,{x:0,y:0},{x:R+V,y:O},{width:1,height:q})}this.image=T,this.iconPositions=i,this.patternPositions=l}addImages(e,r,i){for(const l in e){const d=e[l],m={x:0,y:0,w:d.data.width+2*Gs,h:d.data.height+2*Gs};i.push(m),r[l]=new _g(m,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((i=>e.hasImage(i))),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in e.updatedImages)this.patchUpdatedImage(this.iconPositions[i],e.getImage(i),r),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i),r)}patchUpdatedImage(e,r,i){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,d]=e.tl;i.update(r.data,void 0,{x:l,y:d})}}Lt(_g,"ImagePosition"),Lt(n_,"ImageAtlas");const zo={horizontal:1,vertical:2,horizontalOnly:3},i_=-17;class Jp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const i=new Jp;return i.scale=e||1,i.fontStack=r,i}static forImage(e){const r=new Jp;return r.imageName=e,r}}class $d{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const i=new $d;for(let l=0;l<e.sections.length;l++){const d=e.sections[l];d.image?i.addImageSection(d):i.addTextSection(d,r)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=(function(r,i){let l="";for(let d=0;d<r.length;d++){const m=r.charCodeAt(d+1)||null,x=r.charCodeAt(d-1)||null;l+=!i&&(m&&ts(m)&&!Yp[r[d+1]]||x&&ts(x)&&!Yp[r[d-1]])||!Yp[r[d]]?r[d]:Yp[r[d]]}return l})(this.text,e)}trim(){let e=0;for(let i=0;i<this.text.length&&fm[this.text.charCodeAt(i)];i++)e++;let r=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&fm[this.text.charCodeAt(i)];i--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const i=new $d;return i.text=this.text.substring(e,r),i.sectionIndex=this.sectionIndex.slice(e,r),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,r)=>Math.max(e,this.sections[r].scale)),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Jp.forText(e.scale,e.fontStack||r));const i=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(i)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void nn("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(Jp.forImage(r)),this.sectionIndex.push(this.sections.length-1)):nn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function xg(t,e,r,i,l,d,m,x,T,S,M,L,R,O,V){const q=$d.fromFeature(t,l);L===zo.vertical&&q.verticalizePunctuation(R);let Q=[];const oe=(function(ge,Ge,Ne,nt,yt,Ze){if(!ge)return[];const ot=[],at=(function(Dt,Ft,zt,gr,Tt,Ht){let yr=0;for(let Hr=0;Hr<Dt.length();Hr++){const _r=Dt.getSection(Hr);yr+=s_(Dt.getCharCode(Hr),_r,gr,Tt,Ft,Ht)}return yr/Math.max(1,Math.ceil(yr/zt))})(ge,Ge,Ne,nt,yt,Ze),pt=ge.text.indexOf("​")>=0;let wt=0;for(let Dt=0;Dt<ge.length();Dt++){const Ft=ge.getSection(Dt),zt=ge.getCharCode(Dt);if(fm[zt]||(wt+=s_(zt,Ft,nt,yt,Ge,Ze)),Dt<ge.length()-1){const gr=!((et=zt)<11904||!(Pt["Bopomofo Extended"](et)||Pt.Bopomofo(et)||Pt["CJK Compatibility Forms"](et)||Pt["CJK Compatibility Ideographs"](et)||Pt["CJK Compatibility"](et)||Pt["CJK Radicals Supplement"](et)||Pt["CJK Strokes"](et)||Pt["CJK Symbols and Punctuation"](et)||Pt["CJK Unified Ideographs Extension A"](et)||Pt["CJK Unified Ideographs"](et)||Pt["Enclosed CJK Letters and Months"](et)||Pt["Halfwidth and Fullwidth Forms"](et)||Pt.Hiragana(et)||Pt["Ideographic Description Characters"](et)||Pt["Kangxi Radicals"](et)||Pt["Katakana Phonetic Extensions"](et)||Pt.Katakana(et)||Pt["Vertical Forms"](et)||Pt["Yi Radicals"](et)||Pt["Yi Syllables"](et)));(Ow[zt]||gr||Ft.imageName)&&ot.push(a_(Dt+1,wt,at,ot,Uw(zt,ge.getCharCode(Dt+1),gr&&pt),!1))}}var et;return l_(a_(ge.length(),wt,at,ot,0,!0))})(q,S,d,e,i,O),{processBidirectionalText:pe,processStyledBidirectionalText:ae}=A;if(pe&&q.sections.length===1){const ge=pe(q.toString(),oe);for(const Ge of ge){const Ne=new $d;Ne.text=Ge,Ne.sections=q.sections;for(let nt=0;nt<Ge.length;nt++)Ne.sectionIndex.push(0);Q.push(Ne)}}else if(ae){const ge=ae(q.text,q.sectionIndex,oe);for(const Ge of ge){const Ne=new $d;Ne.text=Ge[0],Ne.sectionIndex=Ge[1],Ne.sections=q.sections,Q.push(Ne)}}else Q=(function(ge,Ge){const Ne=[],nt=ge.text;let yt=0;for(const Ze of Ge)Ne.push(ge.substring(yt,Ze)),yt=Ze;return yt<nt.length&&Ne.push(ge.substring(yt,nt.length)),Ne})(q,oe);const de=[],ye={positionedLines:de,text:q.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:L,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return(function(ge,Ge,Ne,nt,yt,Ze,ot,at,pt,wt,et,Dt){let Ft=0,zt=0,gr=0;const Tt=at==="right"?1:at==="left"?0:.5;let Ht=!1;for(const wr of yt){const Tr=wr.getSections();for(const sn of Tr){if(sn.imageName)continue;const hn=Ge[sn.fontStack];if(hn&&(Ht=hn.ascender!==void 0&&hn.descender!==void 0,!Ht))break}if(!Ht)break}let yr=0;for(const wr of yt){wr.trim();const Tr=wr.getMaxScale(),sn=(Tr-1)*Ri,hn={positionedGlyphs:[],lineOffset:0};ge.positionedLines[yr]=hn;const dn=hn.positionedGlyphs;let on=0;if(!wr.length()){zt+=Ze,++yr;continue}let Cn=0,Bn=0;for(let an=0;an<wr.length();an++){const ui=wr.getSection(an),Yn=wr.getSectionIndex(an),Dn=wr.getCharCode(an);let Yr=ui.scale,Jn=null,pn=null,As=null,Qn=Ri,zi=0;const Si=!(pt===zo.horizontal||!et&&!kl(Dn)||et&&(fm[Dn]||(Hr=Dn,Pt.Arabic(Hr)||Pt["Arabic Supplement"](Hr)||Pt["Arabic Extended-A"](Hr)||Pt["Arabic Presentation Forms-A"](Hr)||Pt["Arabic Presentation Forms-B"](Hr))));if(ui.imageName){const Ms=nt[ui.imageName];if(!Ms)continue;As=ui.imageName,ge.iconsInText=ge.iconsInText||!0,pn=Ms.paddedRect;const Ei=Ms.displaySize;Yr=Yr*Ri/Dt,Jn={width:Ei[0],height:Ei[1],left:Gs,top:-r_,advance:Si?Ei[1]:Ei[0],localGlyph:!1},zi=Ht?-Jn.height*Yr:i_+Tr*Ri-Ei[1]*Yr,Qn=Jn.advance;const Ga=(Si?Ei[0]:Ei[1])*Yr-Ri*Tr;Ga>0&&Ga>on&&(on=Ga)}else{const Ms=Ne[ui.fontStack];if(!Ms)continue;Ms[Dn]&&(pn=Ms[Dn]);const Ei=Ge[ui.fontStack];if(!Ei)continue;const Ga=Ei.glyphs[Dn];if(!Ga)continue;if(Jn=Ga.metrics,Qn=Dn!==8203?Ri:0,Ht){const Kd=Ei.ascender!==void 0?Math.abs(Ei.ascender):0,cf=Ei.descender!==void 0?Math.abs(Ei.descender):0,uf=(Kd+cf)*Yr;Cn<uf&&(Cn=uf,Bn=(Kd-cf)/2*Yr),zi=-Kd*Yr}else zi=i_+(Tr-Yr)*Ri}Si?(ge.verticalizable=!0,dn.push({glyph:Dn,imageName:As,x:Ft,y:zt+zi,vertical:Si,scale:Yr,localGlyph:Jn.localGlyph,fontStack:ui.fontStack,sectionIndex:Yn,metrics:Jn,rect:pn}),Ft+=Qn*Yr+wt):(dn.push({glyph:Dn,imageName:As,x:Ft,y:zt+zi,vertical:Si,scale:Yr,localGlyph:Jn.localGlyph,fontStack:ui.fontStack,sectionIndex:Yn,metrics:Jn,rect:pn}),Ft+=Jn.advance*Yr+wt)}dn.length!==0&&(gr=Math.max(Ft-wt,gr),Ht?c_(dn,Tt,on,Bn,Ze*Tr/2):c_(dn,Tt,on,0,Ze/2)),Ft=0;const Kn=Ze*Tr+on;hn.lineOffset=Math.max(on,sn),zt+=Kn,++yr}var Hr;const _r=zt,{horizontalAlign:tr,verticalAlign:yn}=vg(ot);(function(wr,Tr,sn,hn,dn,on){const Cn=(Tr-sn)*dn,Bn=-on*hn;for(const Kn of wr)for(const an of Kn.positionedGlyphs)an.x+=Cn,an.y+=Bn})(ge.positionedLines,Tt,tr,yn,gr,_r),ge.top+=-yn*_r,ge.bottom=ge.top+_r,ge.left+=-tr*gr,ge.right=ge.left+gr,ge.hasBaseline=Ht})(ye,e,r,i,Q,m,x,T,L,S,R,V),!(function(ge){for(const Ge of ge)if(Ge.positionedGlyphs.length!==0)return!1;return!0})(de)&&ye}const fm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ow={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function s_(t,e,r,i,l,d){if(e.imageName){const m=i[e.imageName];return m?m.displaySize[0]*e.scale*Ri/d+l:0}{const m=r[e.fontStack],x=m&&m.glyphs[t];return x?x.metrics.advance*e.scale+l:0}}function o_(t,e,r,i){const l=Math.pow(t-e,2);return i?t<e?l/2:2*l:l+Math.abs(r)*r}function Uw(t,e,r){let i=0;return t===10&&(i-=1e4),r&&(i+=150),t!==40&&t!==65288||(i+=50),e!==41&&e!==65289||(i+=50),i}function a_(t,e,r,i,l,d){let m=null,x=o_(e,r,l,d);for(const T of i){const S=o_(e-T.x,r,l,d)+T.badness;S<=x&&(m=T,x=S)}return{index:t,x:e,priorBreak:m,badness:x}}function l_(t){return t?l_(t.priorBreak).concat(t.index):[]}function vg(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function c_(t,e,r,i,l){if(!(e||r||i||l))return;const d=t.length-1,m=t[d],x=(m.x+m.metrics.advance*m.scale)*e;for(let T=0;T<=d;T++)t[T].x-=x,t[T].y+=r+i+l}function Vw(t,e,r){const{horizontalAlign:i,verticalAlign:l}=vg(r),d=e[0]-t.displaySize[0]*i,m=e[1]-t.displaySize[1]*l;return{image:t,top:m,bottom:m+t.displaySize[1],left:d,right:d+t.displaySize[0]}}function u_(t,e,r,i,l,d){const m=t.image;let x;if(m.content){const Q=m.content,oe=m.pixelRatio||1;x=[Q[0]/oe,Q[1]/oe,m.displaySize[0]-Q[2]/oe,m.displaySize[1]-Q[3]/oe]}const T=e.left*d,S=e.right*d;let M,L,R,O;r==="width"||r==="both"?(O=l[0]+T-i[3],L=l[0]+S+i[1]):(O=l[0]+(T+S-m.displaySize[0])/2,L=O+m.displaySize[0]);const V=e.top*d,q=e.bottom*d;return r==="height"||r==="both"?(M=l[1]+V-i[0],R=l[1]+q+i[2]):(M=l[1]+(V+q-m.displaySize[1])/2,R=M+m.displaySize[1]),{image:m,top:M,right:L,bottom:R,left:O,collisionPadding:x}}class Rc extends De{constructor(e,r,i,l,d){super(e,r),this.angle=l,this.z=i,d!==void 0&&(this.segment=d)}clone(){return new Rc(this.x,this.y,this.z,this.angle,this.segment)}}function h_(t,e,r,i,l){if(e.segment===void 0)return!0;let d=e,m=e.segment+1,x=0;for(;x>-r/2;){if(m--,m<0)return!1;x-=t[m].dist(d),d=t[m]}x+=t[m].dist(t[m+1]),m++;const T=[];let S=0;for(;x<r/2;){const M=t[m],L=t[m+1];if(!L)return!1;let R=t[m-1].angleTo(M)-M.angleTo(L);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:x,angleDelta:R}),S+=R;x-T[0].distance>i;)S-=T.shift().angleDelta;if(S>l)return!1;m++,x+=M.dist(L)}return!0}function d_(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function p_(t,e,r){return t?.6*e*r:0}function f_(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function $w(t,e,r,i,l,d){const m=p_(r,l,d),x=f_(r,i)*d;let T=0;const S=d_(t)/2;for(let M=0;M<t.length-1;M++){const L=t[M],R=t[M+1],O=L.dist(R);if(T+O>S){const V=(S-T)/O,q=Rr(L.x,R.x,V),Q=Rr(L.y,R.y,V),oe=new Rc(q,Q,0,R.angleTo(L),M);return!m||h_(t,oe,x,m,e)?oe:void 0}T+=O}}function Gw(t,e,r,i,l,d,m,x,T){const S=p_(i,d,m),M=f_(i,l),L=M*m,R=t[0].x===0||t[0].x===T||t[0].y===0||t[0].y===T;return e-L<e/4&&(e=L+e/4),m_(t,R?e/2*x%e:(M/2+2*d)*m*x%e,e,S,r,L,R,!1,T)}function m_(t,e,r,i,l,d,m,x,T){const S=d/2,M=d_(t);let L=0,R=e-r,O=[];for(let V=0;V<t.length-1;V++){const q=t[V],Q=t[V+1],oe=q.dist(Q),pe=Q.angleTo(q);for(;R+r<L+oe;){R+=r;const ae=(R-L)/oe,de=Rr(q.x,Q.x,ae),ye=Rr(q.y,Q.y,ae);if(de>=0&&de<T&&ye>=0&&ye<T&&R-S>=0&&R+S<=M){const ge=new Rc(de,ye,0,pe,V);ge._round(),i&&!h_(t,ge,d,i,l)||O.push(ge)}}L+=oe}return x||O.length||m||(O=m_(t,L/2,r,i,l,d,m,!0,T)),O}function g_(t,e,r,i,l){const d=[];for(let m=0;m<t.length;m++){const x=t[m];let T;for(let S=0;S<x.length-1;S++){let M=x[S],L=x[S+1];M.x<e&&L.x<e||(M.x<e?M=new De(e,M.y+(e-M.x)/(L.x-M.x)*(L.y-M.y))._round():L.x<e&&(L=new De(e,M.y+(e-M.x)/(L.x-M.x)*(L.y-M.y))._round()),M.y<r&&L.y<r||(M.y<r?M=new De(M.x+(r-M.y)/(L.y-M.y)*(L.x-M.x),r)._round():L.y<r&&(L=new De(M.x+(r-M.y)/(L.y-M.y)*(L.x-M.x),r)._round()),M.x>=i&&L.x>=i||(M.x>=i?M=new De(i,M.y+(i-M.x)/(L.x-M.x)*(L.y-M.y))._round():L.x>=i&&(L=new De(i,M.y+(i-M.x)/(L.x-M.x)*(L.y-M.y))._round()),M.y>=l&&L.y>=l||(M.y>=l?M=new De(M.x+(l-M.y)/(L.y-M.y)*(L.x-M.x),l)._round():L.y>=l&&(L=new De(M.x+(l-M.y)/(L.y-M.y)*(L.x-M.x),l)._round()),T&&M.equals(T[T.length-1])||(T=[M],d.push(T)),T.push(L)))))}}return d}Lt(Rc,"Anchor");const Qp=1e20;function y_(t,e,r,i,l,d,m,x,T){for(let S=e;S<e+i;S++)__(t,r*d+S,d,l,m,x,T);for(let S=r;S<r+l;S++)__(t,S*d+e,1,i,m,x,T)}function __(t,e,r,i,l,d,m){d[0]=0,m[0]=-Qp,m[1]=Qp,l[0]=t[e];for(let x=1,T=0,S=0;x<i;x++){l[x]=t[e+x*r];const M=x*x;do{const L=d[T];S=(l[x]-l[L]+M-L*L)/(x-L)/2}while(S<=m[T]&&--T>-1);T++,d[T]=x,m[T]=S,m[T+1]=Qp}for(let x=0,T=0;x<i;x++){for(;m[T+1]<x;)T++;const S=d[T],M=x-S;t[e+x*r]=l[S]+M*M}}const Va=2,bg={none:0,ideographs:1,all:2};class Gd{constructor(e,r,i){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=i,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const i=[];for(const l in e)for(const d of e[l])i.push({stack:l,id:d});st(i,(({stack:l,id:d},m)=>{let x=this.entries[l];x||(x=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=x.glyphs[d];if(T!==void 0)return void m(null,{stack:l,id:d,glyph:T});if(T=this._tinySDF(x,l,d),T)return x.glyphs[d]=T,void m(null,{stack:l,id:d,glyph:T});const S=Math.floor(d/256);if(256*S>65535)return void m(new Error("glyphs > 65535 not supported"));if(x.ranges[S])return void m(null,{stack:l,id:d,glyph:T});let M=x.requests[S];M||(M=x.requests[S]=[],Gd.loadGlyphRange(l,S,this.url,this.requestManager,((L,R)=>{if(R){x.ascender=R.ascender,x.descender=R.descender;for(const O in R.glyphs)this._doesCharSupportLocalGlyph(+O)||(x.glyphs[+O]=R.glyphs[+O]);x.ranges[S]=!0}for(const O of M)O(L,R);delete x.requests[S]}))),M.push(((L,R)=>{L?m(L):R&&m(null,{stack:l,id:d,glyph:R.glyphs[d]||null})}))}),((l,d)=>{if(l)r(l);else if(d){const m={};for(const{stack:x,id:T,glyph:S}of d)m[x]===void 0&&(m[x]={}),m[x].glyphs===void 0&&(m[x].glyphs={}),m[x].glyphs[T]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},m[x].ascender=this.entries[x].ascender,m[x].descender=this.entries[x].descender;r(null,m)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==bg.none&&(this.localGlyphMode===bg.all?!!this.localFontFamily:!!this.localFontFamily&&(Pt["CJK Unified Ideographs"](e)||Pt["Hangul Syllables"](e)||Pt.Hiragana(e)||Pt.Katakana(e)||Pt["CJK Symbols and Punctuation"](e)))}_tinySDF(e,r,i){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(i))return;let d=e.tinySDF;if(!d){let q="400";/bold/i.test(r)?q="900":/medium/i.test(r)?q="500":/light/i.test(r)&&(q="200"),d=e.tinySDF=new Gd.TinySDF({fontFamily:l,fontWeight:q,fontSize:24*Va,buffer:3*Va,radius:8*Va}),d.fontWeight=q}if(this.localGlyphs[d.fontWeight][i])return this.localGlyphs[d.fontWeight][i];const m=String.fromCharCode(i),{data:x,width:T,height:S,glyphWidth:M,glyphHeight:L,glyphLeft:R,glyphTop:O,glyphAdvance:V}=d.draw(m);return this.localGlyphs[d.fontWeight][i]={id:i,bitmap:new ks({width:T,height:S},x),metrics:{width:M/Va,height:L/Va,left:R/Va,top:O/Va-27,advance:V/Va,localGlyph:!0}}}}Gd.loadGlyphRange=function(t,e,r,i,l){const d=256*e,m=d+255,x=i.transformRequest(i.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${d}-${m}`),Oo.Glyphs);Vo(x,((T,S)=>{if(T)l(T);else if(S){const M={},L=(function(R){return new pm(R).readFields(Nw,{})})(S);for(const R of L.glyphs)M[R.id]=R;l(null,{glyphs:M,ascender:L.ascender,descender:L.descender})}}))},Gd.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:i=.25,fontFamily:l="sans-serif",fontWeight:d="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=i,this.radius=r;const x=this.size=t+4*e,T=this._createCanvas(x),S=this.ctx=T.getContext("2d",{willReadFrequently:!0});S.font=`${m} ${d} ${t}px ${l}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:l,actualBoundingBoxRight:d}=this.ctx.measureText(t),m=Math.ceil(r),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-l))),T=Math.min(this.size-this.buffer,m+Math.ceil(i)),S=x+2*this.buffer,M=T+2*this.buffer,L=Math.max(S*M,0),R=new Uint8ClampedArray(L),O={data:R,width:S,height:M,glyphWidth:x,glyphHeight:T,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(x===0||T===0)return O;const{ctx:V,buffer:q,gridInner:Q,gridOuter:oe}=this;V.clearRect(q,q,x,T),V.fillText(t,q,q+m);const pe=V.getImageData(q,q,x,T);oe.fill(Qp,0,L),Q.fill(0,0,L);for(let ae=0;ae<T;ae++)for(let de=0;de<x;de++){const ye=pe.data[4*(ae*x+de)+3]/255;if(ye===0)continue;const ge=(ae+q)*S+de+q;if(ye===1)oe[ge]=0,Q[ge]=Qp;else{const Ge=.5-ye;oe[ge]=Ge>0?Ge*Ge:0,Q[ge]=Ge<0?Ge*Ge:0}}y_(oe,0,0,S,M,S,this.f,this.v,this.z),y_(Q,q,q,x,T,S,this.f,this.v,this.z);for(let ae=0;ae<L;ae++){const de=Math.sqrt(oe[ae])-Math.sqrt(Q[ae]);R[ae]=Math.round(255-255*(de/this.radius+this.cutoff))}return O}};const Wd=Gs;function x_(t,e,r,i){const l=[],d=t.image,m=d.pixelRatio,x=d.paddedRect.w-2*Wd,T=d.paddedRect.h-2*Wd,S=t.right-t.left,M=t.bottom-t.top,L=d.stretchX||[[0,x]],R=d.stretchY||[[0,T]],O=(Ze,ot)=>Ze+ot[1]-ot[0],V=L.reduce(O,0),q=R.reduce(O,0),Q=x-V,oe=T-q;let pe=0,ae=V,de=0,ye=q,ge=0,Ge=Q,Ne=0,nt=oe;if(d.content&&i){const Ze=d.content;pe=mm(L,0,Ze[0]),de=mm(R,0,Ze[1]),ae=mm(L,Ze[0],Ze[2]),ye=mm(R,Ze[1],Ze[3]),ge=Ze[0]-pe,Ne=Ze[1]-de,Ge=Ze[2]-Ze[0]-ae,nt=Ze[3]-Ze[1]-ye}const yt=(Ze,ot,at,pt)=>{const wt=gm(Ze.stretch-pe,ae,S,t.left),et=ym(Ze.fixed-ge,Ge,Ze.stretch,V),Dt=gm(ot.stretch-de,ye,M,t.top),Ft=ym(ot.fixed-Ne,nt,ot.stretch,q),zt=gm(at.stretch-pe,ae,S,t.left),gr=ym(at.fixed-ge,Ge,at.stretch,V),Tt=gm(pt.stretch-de,ye,M,t.top),Ht=ym(pt.fixed-Ne,nt,pt.stretch,q),yr=new De(wt,Dt),Hr=new De(zt,Dt),_r=new De(zt,Tt),tr=new De(wt,Tt),yn=new De(et/m,Ft/m),wr=new De(gr/m,Ht/m),Tr=e*Math.PI/180;if(Tr){const dn=Math.sin(Tr),on=Math.cos(Tr),Cn=[on,-dn,dn,on];yr._matMult(Cn),Hr._matMult(Cn),tr._matMult(Cn),_r._matMult(Cn)}const sn=Ze.stretch+Ze.fixed,hn=ot.stretch+ot.fixed;return{tl:yr,tr:Hr,bl:tr,br:_r,tex:{x:d.paddedRect.x+Wd+sn,y:d.paddedRect.y+Wd+hn,w:at.stretch+at.fixed-sn,h:pt.stretch+pt.fixed-hn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yn,pixelOffsetBR:wr,minFontScaleX:Ge/m/S,minFontScaleY:nt/m/M,isSDF:r}};if(i&&(d.stretchX||d.stretchY)){const Ze=v_(L,Q,V),ot=v_(R,oe,q);for(let at=0;at<Ze.length-1;at++){const pt=Ze[at],wt=Ze[at+1];for(let et=0;et<ot.length-1;et++)l.push(yt(pt,ot[et],wt,ot[et+1]))}}else l.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:T+1}));return l}function mm(t,e,r){let i=0;for(const l of t)i+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return i}function v_(t,e,r){const i=[{fixed:-Wd,stretch:0}];for(const[l,d]of t){const m=i[i.length-1];i.push({fixed:l-m.stretch,stretch:m.stretch}),i.push({fixed:l-m.stretch,stretch:m.stretch+(d-l)})}return i.push({fixed:e+Wd,stretch:r}),i}function gm(t,e,r,i){return t/e*r+i}function ym(t,e,r,i){return t-e*r/i}function Ww(t,e,r,i){const l=e+t.positionedLines[i].lineOffset;return i===0?r+l/2:r+(l+(e+t.positionedLines[i-1].lineOffset))/2}class qw{constructor(e=[],r=Zw){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:i}=this,l=r[e];for(;e>0;){const d=e-1>>1,m=r[d];if(i(l,m)>=0)break;r[e]=m,e=d}r[e]=l}_down(e){const{data:r,compare:i}=this,l=this.length>>1,d=r[e];for(;e<l;){let m=1+(e<<1),x=r[m];const T=m+1;if(T<this.length&&i(r[T],x)<0&&(m=T,x=r[T]),i(x,d)>=0)break;r[e]=x,e=m}r[e]=d}}function Zw(t,e){return t<e?-1:t>e?1:0}function Hw(t,e=1,r=!1){let i=1/0,l=1/0,d=-1/0,m=-1/0;const x=t[0];for(let O=0;O<x.length;O++){const V=x[O];(!O||V.x<i)&&(i=V.x),(!O||V.y<l)&&(l=V.y),(!O||V.x>d)&&(d=V.x),(!O||V.y>m)&&(m=V.y)}const T=Math.min(d-i,m-l);let S=T/2;const M=new qw([],Xw);if(T===0)return new De(i,l);for(let O=i;O<d;O+=T)for(let V=l;V<m;V+=T)M.push(new qd(O+S,V+S,S,t));let L=(function(O){let V=0,q=0,Q=0;const oe=O[0];for(let pe=0,ae=oe.length,de=ae-1;pe<ae;de=pe++){const ye=oe[pe],ge=oe[de],Ge=ye.x*ge.y-ge.x*ye.y;q+=(ye.x+ge.x)*Ge,Q+=(ye.y+ge.y)*Ge,V+=3*Ge}return new qd(q/V,Q/V,0,O)})(t),R=M.length;for(;M.length;){const O=M.pop();(O.d>L.d||!L.d)&&(L=O,r&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,R)),O.max-L.d<=e||(S=O.h/2,M.push(new qd(O.p.x-S,O.p.y-S,S,t)),M.push(new qd(O.p.x+S,O.p.y-S,S,t)),M.push(new qd(O.p.x-S,O.p.y+S,S,t)),M.push(new qd(O.p.x+S,O.p.y+S,S,t)),R+=4)}return r&&(console.log(`num probes: ${R}`),console.log(`best distance: ${L.d}`)),L.p}function Xw(t,e){return e.max-t.max}class qd{constructor(e,r,i,l){this.p=new De(e,r),this.h=i,this.d=(function(d,m){let x=!1,T=1/0;for(let S=0;S<m.length;S++){const M=m[S];for(let L=0,R=M.length,O=R-1;L<R;O=L++){const V=M[L],q=M[O];V.y>d.y!=q.y>d.y&&d.x<(q.x-V.x)*(d.y-V.y)/(q.y-V.y)+V.x&&(x=!x),T=Math.min(T,Rp(d,V,q))}}return(x?1:-1)*Math.sqrt(T)})(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const Zd=7,wg=Number.POSITIVE_INFINITY,Kw=Math.sqrt(2);function b_(t,[e,r]){let i=0,l=0;if(r===wg){e<0&&(e=0);const d=e/Kw;switch(t){case"top-right":case"top-left":l=d-Zd;break;case"bottom-right":case"bottom-left":l=-d+Zd;break;case"bottom":l=-e+Zd;break;case"top":l=e-Zd}switch(t){case"top-right":case"bottom-right":i=-d;break;case"top-left":case"bottom-left":i=d;break;case"left":i=e;break;case"right":i=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":l=r-Zd;break;case"bottom-right":case"bottom-left":case"bottom":l=-r+Zd}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}}return[i,l]}function Yw(t,e,r,i,l,d,m,x,T,S){t.createArrays(),t.tilePixelRatio=Zt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const M=t.layers[0].layout,L=t.layers[0]._unevaluatedLayout._values,R={};if(t.textSizeData.kind==="composite"){const{minZoom:q,maxZoom:Q}=t.textSizeData;R.compositeTextSizes=[L["text-size"].possiblyEvaluate(new I(q),x),L["text-size"].possiblyEvaluate(new I(Q),x)]}if(t.iconSizeData.kind==="composite"){const{minZoom:q,maxZoom:Q}=t.iconSizeData;R.compositeIconSizes=[L["icon-size"].possiblyEvaluate(new I(q),x),L["icon-size"].possiblyEvaluate(new I(Q),x)]}R.layoutTextSize=L["text-size"].possiblyEvaluate(new I(T+1),x),R.layoutIconSize=L["icon-size"].possiblyEvaluate(new I(T+1),x),R.textMaxSize=L["text-size"].possiblyEvaluate(new I(18),x);const O=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",V=M.get("text-size");for(const q of t.features){const Q=M.get("text-font").evaluate(q,{},x).join(","),oe=V.evaluate(q,{},x),pe=R.layoutTextSize.evaluate(q,{},x),ae=(R.layoutIconSize.evaluate(q,{},x),{horizontal:{},vertical:void 0}),de=q.text;let ye,ge=[0,0];if(de){const nt=de.toString(),yt=M.get("text-letter-spacing").evaluate(q,{},x)*Ri,Ze=M.get("text-line-height").evaluate(q,{},x)*Ri,ot=El(nt)?yt:0,at=M.get("text-anchor").evaluate(q,{},x),pt=M.get("text-variable-anchor");if(!pt){const zt=M.get("text-radial-offset").evaluate(q,{},x);ge=zt?b_(at,[zt*Ri,wg]):M.get("text-offset").evaluate(q,{},x).map((gr=>gr*Ri))}let wt=O?"center":M.get("text-justify").evaluate(q,{},x);const et=M.get("symbol-placement")==="point",Dt=et?M.get("text-max-width").evaluate(q,{},x)*Ri:1/0,Ft=zt=>{t.allowVerticalPlacement&&ra(nt)&&(ae.vertical=xg(de,e,r,l,Q,Dt,Ze,at,zt,ot,ge,zo.vertical,!0,pe,oe))};if(!O&&pt){const zt=wt==="auto"?pt.map((Tt=>Tg(Tt))):[wt];let gr=!1;for(let Tt=0;Tt<zt.length;Tt++){const Ht=zt[Tt];if(!ae.horizontal[Ht])if(gr)ae.horizontal[Ht]=ae.horizontal[0];else{const yr=xg(de,e,r,l,Q,Dt,Ze,"center",Ht,ot,ge,zo.horizontal,!1,pe,oe);yr&&(ae.horizontal[Ht]=yr,gr=yr.positionedLines.length===1)}}Ft("left")}else{if(wt==="auto"&&(wt=Tg(at)),et||M.get("text-writing-mode").indexOf("horizontal")>=0||!ra(nt)){const zt=xg(de,e,r,l,Q,Dt,Ze,at,wt,ot,ge,zo.horizontal,!1,pe,oe);zt&&(ae.horizontal[wt]=zt)}Ft(et?"left":wt)}}let Ge=!1;if(q.icon&&q.icon.name){const nt=i[q.icon.name];nt&&(ye=Vw(l[q.icon.name],M.get("icon-offset").evaluate(q,{},x),M.get("icon-anchor").evaluate(q,{},x)),Ge=nt.sdf,t.sdfIcons===void 0?t.sdfIcons=nt.sdf:t.sdfIcons!==nt.sdf&&nn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(nt.pixelRatio!==t.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Ne=T_(ae.horizontal)||ae.vertical;t.iconsInText||(t.iconsInText=!!Ne&&Ne.iconsInText),(Ne||ye)&&Jw(t,q,ae,ye,i,R,pe,0,ge,Ge,m,x,S)}d&&t.generateCollisionDebugBuffers(T,t.collisionBoxArray)}function Tg(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Jw(t,e,r,i,l,d,m,x,T,S,M,L,R){let O=d.textMaxSize.evaluate(e,{},L);O===void 0&&(O=m);const V=t.layers[0].layout,q=V.get("icon-offset").evaluate(e,{},L),Q=T_(r.horizontal)||r.vertical,oe=R.name==="globe",pe=Ri,ae=m/pe,de=t.tilePixelRatio*O/pe,ye=(at=t.overscaling,t.zoom>18&&at>2&&(at>>=1),Math.max(Zt/(512*at),1)*V.get("symbol-spacing")),ge=V.get("text-padding")*t.tilePixelRatio,Ge=V.get("icon-padding")*t.tilePixelRatio,Ne=vt(V.get("text-max-angle")),nt=V.get("text-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",yt=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Ze=V.get("symbol-placement"),ot=ye/2;var at;const pt=V.get("icon-text-fit");let wt;i&&pt!=="none"&&(t.allowVerticalPlacement&&r.vertical&&(wt=u_(i,r.vertical,pt,V.get("icon-text-fit-padding"),q,ae)),Q&&(i=u_(i,Q,pt,V.get("icon-text-fit-padding"),q,ae)));const et=(Dt,Ft,zt)=>{if(Ft.x<0||Ft.x>=Zt||Ft.y<0||Ft.y>=Zt)return;let gr=null;if(oe){const{x:Tt,y:Ht,z:yr}=R.projectTilePoint(Ft.x,Ft.y,zt);gr={anchor:new Rc(Tt,Ht,yr,0,void 0),up:R.upVector(zt,Ft.x,Ft.y)}}(function(Tt,Ht,yr,Hr,_r,tr,yn,wr,Tr,sn,hn,dn,on,Cn,Bn,Kn,an,ui,Yn,Dn,Yr,Jn,pn,As,Qn){const zi=Tt.addToLineVertexArray(Ht,Hr);let Si,Ms,Ei,Ga,Kd,cf,uf,rx=0,nx=0,ix=0,sx=0,Bg=-1,Fg=-1;const Vl={};let ox=Es("");const Vh=yr?yr.anchor:Ht;let Og=0,Ug=0;if(Tr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Og,Ug]=Tr.layout.get("text-offset").evaluate(Yr,{},Qn).map((lo=>lo*Ri)):(Og=Tr.layout.get("text-radial-offset").evaluate(Yr,{},Qn)*Ri,Ug=wg),Tt.allowVerticalPlacement&&_r.vertical){const lo=_r.vertical;if(Bn)cf=Sg(lo),wr&&(uf=Sg(wr));else{const co=Tr.layout.get("text-rotate").evaluate(Yr,{},Qn)+90;Ei=_m(sn,Vh,Ht,hn,dn,on,lo,Cn,co,Kn),wr&&(Ga=_m(sn,Vh,Ht,hn,dn,on,wr,ui,co))}}if(tr){const lo=Tr.layout.get("icon-rotate").evaluate(Yr,{},Qn),co=Tr.layout.get("icon-text-fit")!=="none",hf=x_(tr,lo,pn,co),$g=wr?x_(wr,lo,pn,co):void 0;Ms=_m(sn,Vh,Ht,hn,dn,on,tr,ui,lo),rx=4*hf.length;const ax=Tt.iconSizeData;let $h=null;ax.kind==="source"?($h=[Ua*Tr.layout.get("icon-size").evaluate(Yr,{},Qn)],$h[0]>ku&&nn(`${Tt.layerIds[0]}: Value for "icon-size" is >= ${ef}. Reduce your "icon-size".`)):ax.kind==="composite"&&($h=[Ua*Jn.compositeIconSizes[0].evaluate(Yr,{},Qn),Ua*Jn.compositeIconSizes[1].evaluate(Yr,{},Qn)],($h[0]>ku||$h[1]>ku)&&nn(`${Tt.layerIds[0]}: Value for "icon-size" is >= ${ef}. Reduce your "icon-size".`)),Tt.addSymbols(Tt.icon,hf,$h,Dn,Yn,Yr,!1,yr,Ht,zi.lineStartIndex,zi.lineLength,-1,As,Qn),Bg=Tt.icon.placedSymbolArray.length-1,$g&&(nx=4*$g.length,Tt.addSymbols(Tt.icon,$g,$h,Dn,Yn,Yr,zo.vertical,yr,Ht,zi.lineStartIndex,zi.lineLength,-1,As,Qn),Fg=Tt.icon.placedSymbolArray.length-1)}for(const lo in _r.horizontal){const co=_r.horizontal[lo];Si||(ox=Es(co.text),Bn?Kd=Sg(co):Si=_m(sn,Vh,Ht,hn,dn,on,co,Cn,Tr.layout.get("text-rotate").evaluate(Yr,{},Qn),Kn));const hf=co.positionedLines.length===1;if(ix+=w_(Tt,yr,Ht,co,yn,Tr,Bn,Yr,Kn,zi,_r.vertical?zo.horizontal:zo.horizontalOnly,hf?Object.keys(_r.horizontal):[lo],Vl,Bg,Jn,As,Qn),hf)break}_r.vertical&&(sx+=w_(Tt,yr,Ht,_r.vertical,yn,Tr,Bn,Yr,Kn,zi,zo.vertical,["vertical"],Vl,Fg,Jn,As,Qn));let Du=-1;const Vg=(lo,co)=>lo?Math.max(lo,co):co;Du=Vg(Kd,Du),Du=Vg(cf,Du),Du=Vg(uf,Du);const kT=Du>-1?1:0;Tt.glyphOffsetArray.length>=Au.MAX_GLYPHS&&nn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Yr.sortKey!==void 0&&Tt.addToSortKeyRanges(Tt.symbolInstances.length,Yr.sortKey),Tt.symbolInstances.emplaceBack(Vh.x,Vh.y,Vh.z,Ht.x,Ht.y,Vl.right>=0?Vl.right:-1,Vl.center>=0?Vl.center:-1,Vl.left>=0?Vl.left:-1,Vl.vertical>=0?Vl.vertical:-1,Bg,Fg,ox,Si!==void 0?Si:Tt.collisionBoxArray.length,Si!==void 0?Si+1:Tt.collisionBoxArray.length,Ei!==void 0?Ei:Tt.collisionBoxArray.length,Ei!==void 0?Ei+1:Tt.collisionBoxArray.length,Ms!==void 0?Ms:Tt.collisionBoxArray.length,Ms!==void 0?Ms+1:Tt.collisionBoxArray.length,Ga||Tt.collisionBoxArray.length,Ga?Ga+1:Tt.collisionBoxArray.length,hn,ix,sx,rx,nx,kT,0,Og,Ug,Du)})(t,Ft,gr,Dt,r,i,l,wt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ge,nt,T,0,Ge,yt,q,e,d,S,M,L)};if(Ze==="line")for(const Dt of g_(e.geometry,0,0,Zt,Zt)){const Ft=Gw(Dt,ye,Ne,r.vertical||Q,i,pe,de,t.overscaling,Zt);for(const zt of Ft)Q&&Qw(t,Q.text,ot,zt)||et(Dt,zt,L)}else if(Ze==="line-center"){for(const Dt of e.geometry)if(Dt.length>1){const Ft=$w(Dt,Ne,r.vertical||Q,i,pe,de);Ft&&et(Dt,Ft,L)}}else if(e.type==="Polygon")for(const Dt of Zp(e.geometry,0)){const Ft=Hw(Dt,16);et(Dt[0],new Rc(Ft.x,Ft.y,0,0,void 0),L)}else if(e.type==="LineString")for(const Dt of e.geometry)et(Dt,new Rc(Dt[0].x,Dt[0].y,0,0,void 0),L);else if(e.type==="Point")for(const Dt of e.geometry)for(const Ft of Dt)et([Ft],new Rc(Ft.x,Ft.y,0,0,void 0),L)}const ef=255,ku=ef*Ua;function w_(t,e,r,i,l,d,m,x,T,S,M,L,R,O,V,q,Q){const oe=(function(de,ye,ge,Ge,Ne,nt,yt,Ze){const ot=[];if(ye.positionedLines.length===0)return ot;const at=Ge.layout.get("text-rotate").evaluate(nt,{})*Math.PI/180,pt=(function(zt){const gr=zt[0],Tt=zt[1],Ht=gr*Tt;return Ht>0?[gr,-Tt]:Ht<0?[-gr,Tt]:gr===0?[Tt,gr]:[Tt,-gr]})(ge);let wt=Math.abs(ye.top-ye.bottom);for(const zt of ye.positionedLines)wt-=zt.lineOffset;const et=ye.positionedLines.length,Dt=wt/et;let Ft=ye.top-ge[1];for(let zt=0;zt<et;++zt){const gr=ye.positionedLines[zt];Ft=Ww(ye,Dt,Ft,zt);for(const Tt of gr.positionedGlyphs){if(!Tt.rect)continue;const Ht=Tt.rect||{};let yr=r_+1,Hr=!0,_r=1,tr=0;if(Tt.imageName){const pn=yt[Tt.imageName];if(!pn)continue;if(pn.sdf){nn("SDF images are not supported in formatted text and will be ignored.");continue}Hr=!1,_r=pn.pixelRatio,yr=Gs/_r}const yn=(Ne||Ze)&&Tt.vertical,wr=Tt.metrics.advance*Tt.scale/2,Tr=Tt.metrics,sn=Tt.rect;if(sn===null)continue;Ze&&ye.verticalizable&&(tr=Tt.imageName?wr-Tt.metrics.width*Tt.scale/2:0);const hn=Ne?[Tt.x+wr,Tt.y]:[0,0];let dn=[0,0],on=[0,0],Cn=!1;Ne||(yn?(on=[Tt.x+wr+pt[0],Tt.y+pt[1]-tr],Cn=!0):dn=[Tt.x+wr+ge[0],Tt.y+ge[1]-tr]);const Bn=sn.w*Tt.scale/(_r*(Tt.localGlyph?Va:1)),Kn=sn.h*Tt.scale/(_r*(Tt.localGlyph?Va:1));let an,ui,Yn,Dn;if(yn){const pn=Tt.y-Ft,As=new De(-wr,wr-pn),Qn=-Math.PI/2,zi=new De(...on);an=new De(-wr+dn[0],dn[1]),an._rotateAround(Qn,As)._add(zi),an.x+=-pn+wr,an.y-=(Tr.left-yr)*Tt.scale;const Si=Tt.imageName?Tr.advance*Tt.scale:Ri*Tt.scale,Ms=String.fromCharCode(Tt.glyph);kw(Ms)?an.x+=(1-yr)*Tt.scale:Cw(Ms)?an.x+=Si-Tr.height*Tt.scale+(-yr-1)*Tt.scale:an.x+=Tt.imageName||Tr.width+2*yr===sn.w&&Tr.height+2*yr===sn.h?(Si-Kn)/2:(Si-(Tr.height+2*yr)*Tt.scale)/2,ui=new De(an.x,an.y-Bn),Yn=new De(an.x+Kn,an.y),Dn=new De(an.x+Kn,an.y-Bn)}else{const pn=(Tr.left-yr)*Tt.scale-wr+dn[0],As=(-Tr.top-yr)*Tt.scale+dn[1],Qn=pn+Bn,zi=As+Kn;an=new De(pn,As),ui=new De(Qn,As),Yn=new De(pn,zi),Dn=new De(Qn,zi)}if(at){let pn;pn=Ne?new De(0,0):Cn?new De(pt[0],pt[1]):new De(ge[0],ge[1]),an._rotateAround(at,pn),ui._rotateAround(at,pn),Yn._rotateAround(at,pn),Dn._rotateAround(at,pn)}const Yr=new De(0,0),Jn=new De(0,0);ot.push({tl:an,tr:ui,bl:Yn,br:Dn,tex:Ht,writingMode:ye.writingMode,glyphOffset:hn,sectionIndex:Tt.sectionIndex,isSDF:Hr,pixelOffsetTL:Yr,pixelOffsetBR:Jn,minFontScaleX:0,minFontScaleY:0})}}return ot})(0,i,T,d,m,x,l,t.allowVerticalPlacement),pe=t.textSizeData;let ae=null;pe.kind==="source"?(ae=[Ua*d.layout.get("text-size").evaluate(x,{},Q)],ae[0]>ku&&nn(`${t.layerIds[0]}: Value for "text-size" is >= ${ef}. Reduce your "text-size".`)):pe.kind==="composite"&&(ae=[Ua*V.compositeTextSizes[0].evaluate(x,{},Q),Ua*V.compositeTextSizes[1].evaluate(x,{},Q)],(ae[0]>ku||ae[1]>ku)&&nn(`${t.layerIds[0]}: Value for "text-size" is >= ${ef}. Reduce your "text-size".`)),t.addSymbols(t.text,oe,ae,T,m,x,M,e,r,S.lineStartIndex,S.lineLength,O,q,Q);for(const de of L)R[de]=t.text.placedSymbolArray.length-1;return 4*oe.length}function T_(t){for(const e in t)return t[e];return null}function _m(t,e,r,i,l,d,m,x,T,S){let M=m.top,L=m.bottom,R=m.left,O=m.right;const V=m.collisionPadding;if(V&&(R-=V[0],M-=V[1],O+=V[2],L+=V[3]),T){const q=new De(R,M),Q=new De(O,M),oe=new De(R,L),pe=new De(O,L),ae=vt(T);let de=new De(0,0);S&&(de=new De(S[0],S[1])),q._rotateAround(ae,de),Q._rotateAround(ae,de),oe._rotateAround(ae,de),pe._rotateAround(ae,de),R=Math.min(q.x,Q.x,oe.x,pe.x),O=Math.max(q.x,Q.x,oe.x,pe.x),M=Math.min(q.y,Q.y,oe.y,pe.y),L=Math.max(q.y,Q.y,oe.y,pe.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,R,M,O,L,x,i,l,d),t.length-1}function Sg(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Qw(t,e,r,i){const l=t.compareText;if(e in l){const d=l[e];for(let m=d.length-1;m>=0;m--)if(i.dist(d[m])<r)return!0}else l[e]=[];return l[e].push(i),!1}function S_(t,e){const r=t.fovAboveCenter,i=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,l=(t._camera.position[2]*t.worldSize-i)/Math.cos(t._pitch),d=Math.sin(r)*l/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),m=Math.sin(t._pitch)*d+l;return Math.min(1.01*m,l*(1/t._horizonShift))}function Oh(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),i=t.x*r,l=(t.x+1)*r,d=t.y*r,m=(t.y+1)*r,x=bi(i),T=bi(l),S=qr(d),M=qr(m),L=e.project(x,S),R=e.project(T,S),O=e.project(T,M),V=e.project(x,M);let q=Math.min(L.x,R.x,O.x,V.x),Q=Math.min(L.y,R.y,O.y,V.y),oe=Math.max(L.x,R.x,O.x,V.x),pe=Math.max(L.y,R.y,O.y,V.y);const ae=r/16;function de(ge,Ge,Ne,nt,yt,Ze){const ot=(Ne+yt)/2,at=(nt+Ze)/2,pt=e.project(bi(ot),qr(at)),wt=Math.max(0,q-pt.x,Q-pt.y,pt.x-oe,pt.y-pe);q=Math.min(q,pt.x),oe=Math.max(oe,pt.x),Q=Math.min(Q,pt.y),pe=Math.max(pe,pt.y),wt>ae&&(de(ge,pt,Ne,nt,ot,at),de(pt,Ge,ot,at,yt,Ze))}de(L,R,i,d,l,d),de(R,O,l,d,l,m),de(O,V,l,m,i,m),de(V,L,i,m,i,d),q-=ae,Q-=ae,oe+=ae,pe+=ae;const ye=1/Math.max(oe-q,pe-Q);return{scale:ye,x:q*ye,y:Q*ye,x2:oe*ye,y2:pe*ye,projection:e}}const eT=Io(new Float32Array(16));class Cu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new Kt(0,0)}projectTilePoint(e,r,i){return{x:e,y:r,z:0}}locationPoint(e,r,i=!0){return e._coordinatePoint(e.locationCoordinate(r),i)}pixelsPerMeter(e,r){return Nn(1,e)*r}pixelSpaceConversion(e,r,i){return 1}farthestPixelDistance(e){return S_(e,e.pixelsPerMeter)}pointCoordinate(e,r,i,l){const d=e.horizonLineFromTop(!1),m=new De(r,Math.max(d,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,l))}pointCoordinate3D(e,r,i){const l=new De(r,i);if(e.elevation)return e.elevation.pointCoordinate(l);{const d=this.pointCoordinate(e,l.x,l.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const i=e.horizonLineFromTop();return r.y<i}createInversionMatrix(e,r){return eT}createTileMatrix(e,r,i){let l,d,m;const x=i.canonical,T=Io(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=Oh(x,this);l=1,d=S.x+i.wrap*S.scale,m=S.y,Pl(T,T,[l/S.scale,l/S.scale,e.pixelsPerMeter/r])}else l=r/e.zoomScale(x.z),d=(x.x+Math.pow(2,x.z)*i.wrap)*l,m=x.y*l;return Ml(T,T,[d,m,0]),Pl(T,T,[l/Zt,l/Zt,1]),T}upVector(e,r,i){return[0,0,1]}upVectorScale(e,r,i){return{metersToTile:1}}}class tT extends Cu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,i]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(vt(r));this.n=(l+Math.sin(vt(i)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:i,c:l,r0:d}=this,m=vt(e-this.center[0]),x=vt(r),T=Math.sqrt(l-2*i*Math.sin(x))/i;return{x:T*Math.sin(m*i),y:T*Math.cos(m*i)-d,z:0}}unproject(e,r){const{n:i,c:l,r0:d}=this,m=d+r;let x=Math.atan2(e,Math.abs(m))*Math.sign(m);m*i<0&&(x-=Math.PI*Math.sign(e)*Math.sign(m));const T=vt(this.center[0])*i;x=Te(x,-Math.PI-T,Math.PI-T);const S=Fe(nr(x/i)+this.center[0],-180,180),M=Math.asin(Fe((l-(e*e+m*m)*i*i)/(2*i),-1,1)),L=Fe(nr(M),-Pn,Pn);return new Kt(S,L)}}const tf=1.340264,rf=-.081106,nf=893e-6,sf=.003796,xm=Math.sqrt(3)/2;class rT extends Cu{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const i=Math.asin(xm*Math.sin(r)),l=i*i,d=l*l*l;return{x:.5*(e*Math.cos(i)/(xm*(tf+3*rf*l+d*(7*nf+9*sf*l)))/Math.PI+.5),y:1-.5*(i*(tf+rf*l+d*(nf+sf*l))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let i=r=(2*(1-r)-1)*Math.PI,l=i*i,d=l*l*l;for(let M,L,R,O=0;O<12&&(L=i*(tf+rf*l+d*(nf+sf*l))-r,R=tf+3*rf*l+d*(7*nf+9*sf*l),M=L/R,i=Fe(i-M,-Math.PI/3,Math.PI/3),l=i*i,d=l*l*l,!(Math.abs(M)<1e-12));++O);const m=xm*e*(tf+3*rf*l+d*(7*nf+9*sf*l))/Math.cos(i),x=Math.asin(Math.sin(i)/xm),T=Fe(180*m/Math.PI,-180,180),S=Fe(180*x/Math.PI,-Pn,Pn);return new Kt(T,S)}}class nT extends Cu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const i=360*(e-.5),l=Fe(360*(.5-r),-Pn,Pn);return new Kt(i,l)}}const Hd=Math.PI/2;function vm(t){return Math.tan((Hd+t)/2)}class iT extends Cu{constructor(e){super(e),this.center=e.center||[0,30];const[r,i]=this.parallels=e.parallels||[30,30];let l=vt(r),d=vt(i);this.southernCenter=l+d<0,this.southernCenter&&(l=-l,d=-d);const m=Math.cos(l),x=vm(l);this.n=l===d?Math.sin(l):Math.log(m/Math.cos(d))/Math.log(vm(d)/x),this.f=m*Math.pow(vm(l),this.n)/this.n}project(e,r){r=vt(r),this.southernCenter&&(r=-r),e=vt(e-this.center[0]);const i=1e-6,{n:l,f:d}=this;d>0?r<-Hd+i&&(r=-Hd+i):r>Hd-i&&(r=Hd-i);const m=d/Math.pow(vm(r),l);let x=m*Math.sin(l*e),T=d-m*Math.cos(l*e);return x=.5*(x/Math.PI+.5),T=.5*(T/Math.PI+.5),{x,y:this.southernCenter?T:1-T,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:i,f:l}=this,d=l-r,m=Math.sign(d),x=Math.sign(i)*Math.sqrt(e*e+d*d);let T=Math.atan2(e,Math.abs(d))*m;d*i<0&&(T-=Math.PI*Math.sign(e)*m);const S=Fe(nr(T/i)+this.center[0],-180,180),M=Fe(nr(2*Math.atan(Math.pow(l/x,1/i))-Hd),-Pn,Pn);return new Kt(S,this.southernCenter?-M:M)}}class E_ extends Cu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:cn(e),y:wn(r),z:0}}unproject(e,r){const i=bi(e),l=qr(r);return new Kt(i,l)}}const k_=vt(Pn);class sT extends Cu{project(e,r){const i=(r=vt(r))*r,l=i*i;return{x:.5*((e=vt(e))*(.8707-.131979*i+l*(l*(.003971*i-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+i*(.015085+l*(.028874*i-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let i=r=(2*(1-r)-1)*Math.PI,l=25,d=0,m=i*i;do{m=i*i;const S=m*m;d=(i*(1.007226+m*(.015085+S*(.028874*m-.044475-.005916*S)))-r)/(1.007226+m*(.045255+S*(.259866*m-.311325-.005916*11*S))),i=Fe(i-d,-k_,k_)}while(Math.abs(d)>1e-6&&--l>0);m=i*i;const x=Fe(nr(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),T=nr(i);return new Kt(x,T)}}const C_=vt(Pn);class oT extends Cu{project(e,r){r=vt(r),e=vt(e);const i=Math.cos(r),l=2/Math.PI,d=Math.acos(i*Math.cos(e/2)),m=Math.sin(d)/d,x=.5*(e*l+2*i*Math.sin(e/2)/m)||0,T=.5*(r+Math.sin(r)/m)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(e,r){let i=e=(2*e-.5)*Math.PI,l=r=(2*(1-r)-1)*Math.PI,d=25;const m=1e-6;let x=0,T=0;do{const S=Math.cos(l),M=Math.sin(l),L=2*M*S,R=M*M,O=S*S,V=Math.cos(i/2),q=Math.sin(i/2),Q=2*V*q,oe=q*q,pe=1-O*V*V,ae=pe?1/pe:0,de=pe?Math.acos(S*V)*Math.sqrt(1/pe):0,ye=.5*(2*de*S*q+2*i/Math.PI)-e,ge=.5*(de*M+l)-r,Ge=.5*ae*(O*oe+de*S*V*R)+1/Math.PI,Ne=ae*(Q*L/4-de*M*q),nt=.125*ae*(L*q-de*M*O*Q),yt=.5*ae*(R*V+de*oe*S)+.5,Ze=Ne*nt-yt*Ge;x=(ge*Ne-ye*yt)/Ze,T=(ye*nt-ge*Ge)/Ze,i=Fe(i-x,-Math.PI,Math.PI),l=Fe(l-T,-C_,C_)}while((Math.abs(x)>m||Math.abs(T)>m)&&--d>0);return new Kt(nr(i),nr(l))}}class A_ extends Cu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(vt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:i,cosPhi:l}=this;return{x:vt(e)*l*i+.5,y:-Math.sin(vt(r))/l*i+.5,z:0}}unproject(e,r){const{scale:i,cosPhi:l}=this,d=-(r-.5)/i,m=Fe(nr((e-.5)/i)/l,-180,180),x=Math.asin(Fe(d*l,-1,1)),T=Fe(nr(x),-Pn,Pn);return new Kt(m,T)}}class aT extends E_{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,i){const l=oo(e,r,i);return kn(l,l,is($s(i))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,r){const i=Wi(r.lat,r.lng),l=Di([],i),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;fu(i,i,l,Nn(1,0)*Zt*d);const m=Io(new Float64Array(16));return Ba(m,e.pixelMatrix,e.globeMatrix),kn(i,i,m),new De(i[0],i[1])}pixelsPerMeter(e,r){return Nn(1,0)*r}pixelSpaceConversion(e,r,i){const l=Nn(1,e)*r,d=Rr(Nn(1,45)*r,l,i);return this.pixelsPerMeter(e,r)/d}createTileMatrix(e,r,i){const l=kd($s(i.canonical));return Ba(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,r){const{center:i}=e,l=is($s(r));return _h(l,l,vt(i.lng)),gd(l,l,vt(i.lat)),Pl(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,r,i,l){return Ap(e,r,i,!0)||new Ll(0,0)}pointCoordinate3D(e,r,i){const l=this.pointCoordinate(e,r,i,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,r){return!Ap(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=(function(l,d){const m=l.cameraToCenterDistance,x=l._centerAltitude*d,T=l._camera,S=l._camera.forward(),M=aa([],vn([],S,-m),[0,0,x]),L=l.worldSize/(2*Math.PI),R=[0,0,-L],O=l.width/l.height,V=Math.tan(l.fovAboveCenter),q=vn([],T.up(),V),Q=vn([],T.right(),V*O),oe=Di([],aa([],aa([],S,q),Q)),pe=[];let ae;if(new Sd(M,oe).closestPointOnSphere(R,L,pe)){const de=aa([],pe,R),ye=Vs([],de,M);ae=Math.cos(l.fovAboveCenter)*pu(ye)}else{const de=Vs([],M,R),ye=Vs([],R,M);Di(ye,ye);const ge=pu(de)-L;ae=Math.sqrt(ge*(ge+2*L));const Ge=Math.acos(ae/(L+ge))-Math.acos(Us(S,ye));ae*=Math.cos(Ge)}return 1.01*ae})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=xu(e.zoom);if(i>0){const l=S_(e,Nn(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Rr(r,l+d*(1-Math.cos(m)),Math.pow(i,10))}return r}upVector(e,r,i){return oo(r,i,e,1)}upVectorScale(e){return{metersToTile:yu(kh($s(e)))}}}function M_(t){const e=t.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new E_(t);case"equirectangular":return new nT(t);case"naturalEarth":return new sT(t);case"equalEarth":return new rT(t);case"winkelTripel":return new oT(t);case"albers":return r?new A_(t):new tT(t);case"lambertConformalConic":return r?new A_(t):new iT(t);case"globe":return new aT(t)}throw new Error(`Invalid projection name: ${t.name}`)}const lT=or.types,cT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function bm(t,e,r,i,l,d,m,x,T,S,M,L,R){const O=x?Math.min(ku,Math.round(x[0])):0,V=x?Math.min(ku,Math.round(x[1])):0;t.emplaceBack(e,r,Math.round(32*i),Math.round(32*l),d,m,(O<<1)+(T?1:0),V,16*S,16*M,256*L,256*R)}function wm(t,e,r,i,l,d,m){t.emplaceBack(e,r,i,l,d,m)}function Tm(t,e,r,i,l){t.emplaceBack(e,r,i,l),t.emplaceBack(e,r,i,l),t.emplaceBack(e,r,i,l),t.emplaceBack(e,r,i,l)}function uT(t){for(const e of t.sections)if(Ao(e.text))return!0;return!1}class Eg{constructor(e){this.layoutVertexArray=new ct,this.indexArray=new Vt,this.programConfigurations=e,this.segments=new zn,this.dynamicLayoutVertexArray=new dt,this.opacityVertexArray=new Ut,this.placedSymbolArray=new En,this.globeExtVertexArray=new gt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,i,l){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_w.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,vw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,cT,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,xw.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Lt(Eg,"SymbolBuffers");class kg{constructor(e,r,i){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new i,this.segments=new zn,this.collisionVertexArray=new br,this.collisionVertexArrayExt=new Er}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,bw.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,ww.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Lt(kg,"CollisionBuffers");class Au{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((m=>m.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Io([]),this.placementViewportMatrix=Io([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fg(this.zoom,r["text-size"]),this.iconSizeData=fg(this.zoom,r["icon-size"]);const i=this.layers[0].layout,l=i.get("symbol-sort-key"),d=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map((m=>zo[m])),this.stateDependentLayerIds=this.layers.filter((m=>m.isStateDependent())).map((m=>m.id)),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Eg(new Al(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Eg(new Al(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Un,this.lineVertexArray=new gn,this.symbolInstances=new rn}calculateGlyphDependencies(e,r,i,l,d){for(let m=0;m<e.length;m++)if(r[e.charCodeAt(m)]=!0,l&&d){const x=Yp[e.charAt(m)];x&&(r[x.charCodeAt(0)]=!0)}}populate(e,r,i,l){const d=this.layers[0],m=d.layout,x=this.projection.name==="globe",T=m.get("text-font"),S=m.get("text-field"),M=m.get("icon-image"),L=(S.value.kind!=="constant"||S.value.value instanceof ii&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),R=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,O=m.get("symbol-sort-key");if(this.features=[],!L&&!R)return;const V=r.iconDependencies,q=r.glyphDependencies,Q=r.availableImages,oe=new I(this.zoom);for(const{feature:pe,id:ae,index:de,sourceLayerIndex:ye}of e){const ge=d._featureFilter.needGeometry,Ge=ha(pe,ge);if(!d._featureFilter.filter(oe,Ge,i))continue;if(ge||(Ge.geometry=qi(pe,i,l)),x&&pe.type!==1&&i.z<=5){const Ze=Ge.geometry,ot=.98078528056,at=(pt,wt)=>Us(oo(pt.x,pt.y,i,1),oo(wt.x,wt.y,i,1))<ot;for(let pt=0;pt<Ze.length;pt++)Ze[pt]=bu(Ze[pt],at)}let Ne,nt;if(L){const Ze=d.getValueAndResolveTokens("text-field",Ge,i,Q),ot=ii.factory(Ze);uT(ot)&&(this.hasRTLText=!0),(!this.hasRTLText||b()==="unavailable"||this.hasRTLText&&A.isParsed())&&(Ne=Ew(ot,d,Ge))}if(R){const Ze=d.getValueAndResolveTokens("icon-image",Ge,i,Q);nt=Ze instanceof gs?Ze:gs.fromString(Ze)}if(!Ne&&!nt)continue;const yt=this.sortFeaturesByKey?O.evaluate(Ge,{},i):void 0;if(this.features.push({id:ae,text:Ne,icon:nt,index:de,sourceLayerIndex:ye,geometry:Ge.geometry,properties:pe.properties,type:lT[pe.type],sortKey:yt}),nt&&(V[nt.name]=!0),Ne){const Ze=T.evaluate(Ge,{},i).join(","),ot=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(zo.vertical)>=0;for(const at of Ne.sections)if(at.image)V[at.image.name]=!0;else{const pt=ra(Ne.toString()),wt=at.fontStack||Ze,et=q[wt]=q[wt]||{};this.calculateGlyphDependencies(at.text,et,ot,this.allowVerticalPlacement,pt)}}}m.get("symbol-placement")==="line"&&(this.features=(function(pe){const ae={},de={},ye=[];let ge=0;function Ge(Ze){ye.push(pe[Ze]),ge++}function Ne(Ze,ot,at){const pt=de[Ze];return delete de[Ze],de[ot]=pt,ye[pt].geometry[0].pop(),ye[pt].geometry[0]=ye[pt].geometry[0].concat(at[0]),pt}function nt(Ze,ot,at){const pt=ae[ot];return delete ae[ot],ae[Ze]=pt,ye[pt].geometry[0].shift(),ye[pt].geometry[0]=at[0].concat(ye[pt].geometry[0]),pt}function yt(Ze,ot,at){const pt=at?ot[0][ot[0].length-1]:ot[0][0];return`${Ze}:${pt.x}:${pt.y}`}for(let Ze=0;Ze<pe.length;Ze++){const ot=pe[Ze],at=ot.geometry,pt=ot.text?ot.text.toString():null;if(!pt){Ge(Ze);continue}const wt=yt(pt,at),et=yt(pt,at,!0);if(wt in de&&et in ae&&de[wt]!==ae[et]){const Dt=nt(wt,et,at),Ft=Ne(wt,et,ye[Dt].geometry);delete ae[wt],delete de[et],de[yt(pt,ye[Ft].geometry,!0)]=Ft,ye[Dt].geometry=null}else wt in de?Ne(wt,et,at):et in ae?nt(wt,et,at):(Ge(Ze),ae[wt]=ge-1,de[et]=ge-1)}return ye.filter((Ze=>Ze.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((pe,ae)=>pe.sortKey-ae.sortKey))}update(e,r,i,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,i,l),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,i,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=M_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const i=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:d}of r)this.lineVertexArray.emplaceBack(l,d);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,r,i,l,d,m,x,T,S,M,L,R,O,V){const q=e.indexArray,Q=e.layoutVertexArray,oe=e.globeExtVertexArray,pe=e.segments.prepareSegment(4*r.length,Q,q,this.canOverlap?m.sortKey:void 0),ae=this.glyphOffsetArray.length,de=pe.vertexLength,ye=this.allowVerticalPlacement&&x===zo.vertical?Math.PI/2:0,ge=m.text&&m.text.sections;for(let Ne=0;Ne<r.length;Ne++){const{tl:nt,tr:yt,bl:Ze,br:ot,tex:at,pixelOffsetTL:pt,pixelOffsetBR:wt,minFontScaleX:et,minFontScaleY:Dt,glyphOffset:Ft,isSDF:zt,sectionIndex:gr}=r[Ne],Tt=pe.vertexLength,Ht=Ft[1];if(bm(Q,S.x,S.y,nt.x,Ht+nt.y,at.x,at.y,i,zt,pt.x,pt.y,et,Dt),bm(Q,S.x,S.y,yt.x,Ht+yt.y,at.x+at.w,at.y,i,zt,wt.x,pt.y,et,Dt),bm(Q,S.x,S.y,Ze.x,Ht+Ze.y,at.x,at.y+at.h,i,zt,pt.x,wt.y,et,Dt),bm(Q,S.x,S.y,ot.x,Ht+ot.y,at.x+at.w,at.y+at.h,i,zt,wt.x,wt.y,et,Dt),T){const{x:yr,y:Hr,z:_r}=T.anchor,[tr,yn,wr]=T.up;wm(oe,yr,Hr,_r,tr,yn,wr),wm(oe,yr,Hr,_r,tr,yn,wr),wm(oe,yr,Hr,_r,tr,yn,wr),wm(oe,yr,Hr,_r,tr,yn,wr),Tm(e.dynamicLayoutVertexArray,yr,Hr,_r,ye)}else Tm(e.dynamicLayoutVertexArray,S.x,S.y,S.z,ye);q.emplaceBack(Tt,Tt+1,Tt+2),q.emplaceBack(Tt+1,Tt+2,Tt+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ft[0]),Ne!==r.length-1&&gr===r[Ne+1].sectionIndex||e.programConfigurations.populatePaintArrays(Q.length,m,m.index,{},O,V,ge&&ge[gr])}const Ge=T?T.anchor:S;e.placedSymbolArray.emplaceBack(Ge.x,Ge.y,Ge.z,S.x,S.y,ae,this.glyphOffsetArray.length-ae,de,M,L,S.segment,i?i[0]:0,i?i[1]:0,l[0],l[1],x,0,!1,0,R,0)}_commitLayoutVertex(e,r,i,l,d,m,x){e.emplaceBack(r,i,l,d,m,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,r,i,l,d,m,x){const T=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),S=T.vertexLength,M=x.tileAnchorX,L=x.tileAnchorY;for(let O=0;O<4;O++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),i.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(i.layoutVertexArray,l,d,m,M,L,new De(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,l,d,m,M,L,new De(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,l,d,m,M,L,new De(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,l,d,m,M,L,new De(e.x1,e.y2)),T.vertexLength+=4;const R=i.indexArray;R.emplaceBack(S,S+1),R.emplaceBack(S+1,S+2),R.emplaceBack(S+2,S+3),R.emplaceBack(S+3,S),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,i,l,d,m){for(let x=l;x<d;x++){const T=i.get(x),S=this.getSymbolInstanceTextSize(e,m,r,x);this._addCollisionDebugVertices(T,S,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,r,i,l,d,m){for(let x=l;x<d;x++){const T=i.get(x),S=this.getSymbolInstanceIconSize(e,r,m.placedIconSymbolIndex);this._addCollisionDebugVertices(T,S,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new kg(Nt,H0.members,Sn),this.iconCollisionBox=new kg(Nt,H0.members,Sn);const i=Od(this.iconSizeData,e),l=Od(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(l,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(l,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(i,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(i,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,r,i,l){const d=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:l),m=hm(this.textSizeData,e,d)/Ri;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,r,i){const l=this.icon.placedSymbolArray.get(i),d=hm(this.iconSizeData,e,l);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,r,i){e.emplaceBack(r,-i,-i),e.emplaceBack(r,i,-i),e.emplaceBack(r,i,i),e.emplaceBack(r,-i,i)}_updateTextDebugCollisionBoxes(e,r,i,l,d,m){for(let x=l;x<d;x++){const T=i.get(x),S=this.getSymbolInstanceTextSize(e,m,r,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,T.padding)}}_updateIconDebugCollisionBoxes(e,r,i,l,d,m){for(let x=l;x<d;x++){const T=i.get(x),S=this.getSymbolInstanceIconSize(e,r,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,T.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=Od(this.iconSizeData,e),l=Od(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(l,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(l,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(i,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex,m.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(i,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,i,l,d,m,x,T,S){const M={};if(r<i){const{x1:L,y1:R,x2:O,y2:V,padding:q,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de,featureIndex:ye}=e.get(r);M.textBox={x1:L,y1:R,x2:O,y2:V,padding:q,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de},M.textFeatureIndex=ye}if(l<d){const{x1:L,y1:R,x2:O,y2:V,padding:q,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de,featureIndex:ye}=e.get(l);M.verticalTextBox={x1:L,y1:R,x2:O,y2:V,padding:q,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de},M.verticalTextFeatureIndex=ye}if(m<x){const{x1:L,y1:R,x2:O,y2:V,padding:q,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de,featureIndex:ye}=e.get(m);M.iconBox={x1:L,y1:R,x2:O,y2:V,padding:q,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de},M.iconFeatureIndex=ye}if(T<S){const{x1:L,y1:R,x2:O,y2:V,padding:q,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de,featureIndex:ye}=e.get(T);M.verticalIconBox={x1:L,y1:R,x2:O,y2:V,padding:q,projectedAnchorX:Q,projectedAnchorY:oe,projectedAnchorZ:pe,tileAnchorX:ae,tileAnchorY:de},M.verticalIconFeatureIndex=ye}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const i=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const i=e.placedSymbolArray.get(r),l=i.vertexStartIndex+4*i.numGlyphs;for(let d=i.vertexStartIndex;d<l;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),i=Math.cos(e),l=[],d=[],m=[];for(let x=0;x<this.symbolInstances.length;++x){m.push(x);const T=this.symbolInstances.get(x);l.push(0|Math.round(r*T.tileAnchorX+i*T.tileAnchorY)),d.push(T.featureIndex)}return m.sort(((x,T)=>l[x]-l[T]||d[T]-d[x])),m}addToSortKeyRanges(e,r){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===r?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const i=this.symbolInstances.get(r);this.featureSortOrder.push(i.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:S}=i;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),d>=0&&d!==l&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&m!==d&&m!==l&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Lt(Au,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Au.MAX_GLYPHS=65535,Au.addDynamicAttributes=Tm;const hT=new ce({"symbol-placement":new W(rt.layout_symbol["symbol-placement"]),"symbol-spacing":new W(rt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new W(rt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new te(rt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new W(rt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new W(rt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new W(rt.layout_symbol["icon-ignore-placement"]),"icon-optional":new W(rt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new W(rt.layout_symbol["icon-rotation-alignment"]),"icon-size":new te(rt.layout_symbol["icon-size"]),"icon-text-fit":new W(rt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new W(rt.layout_symbol["icon-text-fit-padding"]),"icon-image":new te(rt.layout_symbol["icon-image"]),"icon-rotate":new te(rt.layout_symbol["icon-rotate"]),"icon-padding":new W(rt.layout_symbol["icon-padding"]),"icon-keep-upright":new W(rt.layout_symbol["icon-keep-upright"]),"icon-offset":new te(rt.layout_symbol["icon-offset"]),"icon-anchor":new te(rt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new W(rt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new W(rt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new W(rt.layout_symbol["text-rotation-alignment"]),"text-field":new te(rt.layout_symbol["text-field"]),"text-font":new te(rt.layout_symbol["text-font"]),"text-size":new te(rt.layout_symbol["text-size"]),"text-max-width":new te(rt.layout_symbol["text-max-width"]),"text-line-height":new te(rt.layout_symbol["text-line-height"]),"text-letter-spacing":new te(rt.layout_symbol["text-letter-spacing"]),"text-justify":new te(rt.layout_symbol["text-justify"]),"text-radial-offset":new te(rt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new W(rt.layout_symbol["text-variable-anchor"]),"text-anchor":new te(rt.layout_symbol["text-anchor"]),"text-max-angle":new W(rt.layout_symbol["text-max-angle"]),"text-writing-mode":new W(rt.layout_symbol["text-writing-mode"]),"text-rotate":new te(rt.layout_symbol["text-rotate"]),"text-padding":new W(rt.layout_symbol["text-padding"]),"text-keep-upright":new W(rt.layout_symbol["text-keep-upright"]),"text-transform":new te(rt.layout_symbol["text-transform"]),"text-offset":new te(rt.layout_symbol["text-offset"]),"text-allow-overlap":new W(rt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new W(rt.layout_symbol["text-ignore-placement"]),"text-optional":new W(rt.layout_symbol["text-optional"])});var Cg={paint:new ce({"icon-opacity":new te(rt.paint_symbol["icon-opacity"]),"icon-color":new te(rt.paint_symbol["icon-color"]),"icon-halo-color":new te(rt.paint_symbol["icon-halo-color"]),"icon-halo-width":new te(rt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new te(rt.paint_symbol["icon-halo-blur"]),"icon-translate":new W(rt.paint_symbol["icon-translate"]),"icon-translate-anchor":new W(rt.paint_symbol["icon-translate-anchor"]),"text-opacity":new te(rt.paint_symbol["text-opacity"]),"text-color":new te(rt.paint_symbol["text-color"],{runtimeType:Bi,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new te(rt.paint_symbol["text-halo-color"]),"text-halo-width":new te(rt.paint_symbol["text-halo-width"]),"text-halo-blur":new te(rt.paint_symbol["text-halo-blur"]),"text-translate":new W(rt.paint_symbol["text-translate"]),"text-translate-anchor":new W(rt.paint_symbol["text-translate-anchor"])}),layout:hT};class P_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:xo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Lt(P_,"FormatSectionOverride",{omit:["defaultValue"]});class Sm extends Po{constructor(e){super(e,Cg)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const l=[];for(const d of i)l.indexOf(d)<0&&l.push(d);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,i,l){const d=this.layout.get(e).evaluate(r,{},i,l),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Ca(m.value)||!d?d:(function(x,T){return T.replace(/{([^{}]+)}/g,((S,M)=>M in x?String(x[M]):""))})(r.properties,d)}createBucket(e){return new Au(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Cg.paint.overridableProperties){if(!Sm.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),i=new P_(r),l=new dc(i,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new pc("source",l):new Jo("composite",l,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new ne(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,i){return!(!this.layout||r.isDataDriven()||i.isDataDriven())&&Sm.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const i=e.get("text-field"),l=Cg.paint.properties[r];let d=!1;const m=x=>{for(const T of x)if(l.overrides&&l.overrides.hasOverride(T))return void(d=!0)};if(i.value.kind==="constant"&&i.value.value instanceof ii)m(i.value.value.sections);else if(i.value.kind==="source"){const x=S=>{d||(S instanceof js&&bn(S.value)===_a?m(S.value.sections):S instanceof Ys?m(S.sections):S.eachChild(x))},T=i.value;T._styleExpression&&x(T._styleExpression.expression)}return d}getProgramConfiguration(e){return new za(this,e)}}var dT={paint:new ce({"background-color":new W(rt.paint_background["background-color"]),"background-pattern":new W(rt.paint_background["background-pattern"]),"background-opacity":new W(rt.paint_background["background-opacity"])})},pT={paint:new ce({"raster-opacity":new W(rt.paint_raster["raster-opacity"]),"raster-hue-rotate":new W(rt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new W(rt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new W(rt.paint_raster["raster-brightness-max"]),"raster-saturation":new W(rt.paint_raster["raster-saturation"]),"raster-contrast":new W(rt.paint_raster["raster-contrast"]),"raster-resampling":new W(rt.paint_raster["raster-resampling"]),"raster-fade-duration":new W(rt.paint_raster["raster-fade-duration"])})};class fT extends Po{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var mT={paint:new ce({"sky-type":new W(rt.paint_sky["sky-type"]),"sky-atmosphere-sun":new W(rt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new W(rt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new W(rt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new W(rt.paint_sky["sky-gradient-radius"]),"sky-gradient":new le(rt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new W(rt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new W(rt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new W(rt.paint_sky["sky-opacity"])})};function Ag(t,e,r){const i=[0,0,1],l=bh([]);return kp(l,l,r?-vt(t)+Math.PI:vt(t)),Qf(l,l,-vt(e)),vd(i,i,l),Di(i,i)}const gT={circle:class extends Po{constructor(t){super(t,im)}createBucket(t){return new Ac(t)}queryRadius(t){const e=t;return Mc("circle-radius",this,e)+Mc("circle-stroke-width",this,e)+wu(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,i,l,d,m,x){const T=Dd(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return zp(t,i,d,m,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,S)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new za(this,t)}},heatmap:class extends Po{createBucket(t){return new Bp(t)}constructor(t){super(t,Gn),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Up({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Mc("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,i,l,d,m,x){const T=this.paint.get("heatmap-radius").evaluate(e,r);return zp(t,i,d,m,x,!0,!0,new De(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new za(this,t)}},hillshade:class extends Po{constructor(t){super(t,sm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Po{constructor(t){super(t,D)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(t){return new za(this,t)}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new _(t)}queryRadius(){return wu(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,i,l,d){return!t.queryGeometry.isAboveHorizon&&Ph(Rl(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends Po{constructor(t){super(t,uw)}createBucket(t){return new Hp(t)}queryRadius(){return wu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new za(this,t)}queryIntersectsFeature(t,e,r,i,l,d,m,x,T){const S=Dd(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,r),L=this.paint.get("fill-extrusion-base").evaluate(e,r),R=[0,0],O=x&&d.elevation,V=d.elevation?d.elevation.exaggeration():1,q=t.tile.getBucket(this);if(O&&q instanceof Hp){const de=q.centroidVertexArray,ye=T+1;ye<de.length&&(R[0]=de.geta_centroid_pos0(ye),R[1]=de.geta_centroid_pos1(ye))}if(R[0]===0&&R[1]===1)return!1;d.projection.name==="globe"&&(i=O0([i],[new De(0,0),new De(Zt,Zt)],t.tileID.canonical).map((de=>de.polygon)).flat());const Q=O?x:null,[oe,pe]=(function(de,ye,ge,Ge,Ne,nt,yt,Ze,ot,at,pt){return de.projection.name==="globe"?(function(wt,et,Dt,Ft,zt,gr,Tt,Ht,yr,Hr,_r){const tr=[],yn=[],wr=wt.projection.upVectorScale(_r,wt.center.lat,wt.worldSize).metersToTile,Tr=[0,0,0,1],sn=[0,0,0,1],hn=(on,Cn,Bn,Kn)=>{on[0]=Cn,on[1]=Bn,on[2]=Kn,on[3]=1},dn=F0();Dt>0&&(Dt+=dn),Ft+=dn;for(const on of et){const Cn=[],Bn=[];for(const Kn of on){const an=Kn.x+zt.x,ui=Kn.y+zt.y,Yn=wt.projection.projectTilePoint(an,ui,_r),Dn=wt.projection.upVector(_r,Kn.x,Kn.y);let Yr=Dt,Jn=Ft;if(Tt){const pn=G0(an,ui,Dt,Ft,Tt,Ht,yr,Hr);Yr+=pn.base,Jn+=pn.top}Dt!==0?hn(Tr,Yn.x+Dn[0]*wr*Yr,Yn.y+Dn[1]*wr*Yr,Yn.z+Dn[2]*wr*Yr):hn(Tr,Yn.x,Yn.y,Yn.z),hn(sn,Yn.x+Dn[0]*wr*Jn,Yn.y+Dn[1]*wr*Jn,Yn.z+Dn[2]*wr*Jn),kn(Tr,Tr,gr),kn(sn,sn,gr),Cn.push(new Fd(Tr[0],Tr[1],Tr[2])),Bn.push(new Fd(sn[0],sn[1],sn[2]))}tr.push(Cn),yn.push(Bn)}return[tr,yn]})(de,ye,ge,Ge,Ne,nt,yt,Ze,ot,at,pt):yt?(function(wt,et,Dt,Ft,zt,gr,Tt,Ht,yr){const Hr=[],_r=[],tr=[0,0,0,1];for(const yn of wt){const wr=[],Tr=[];for(const sn of yn){const hn=sn.x+Ft.x,dn=sn.y+Ft.y,on=G0(hn,dn,et,Dt,gr,Tt,Ht,yr);tr[0]=hn,tr[1]=dn,tr[2]=on.base,tr[3]=1,Il(tr,tr,zt),tr[3]=Math.max(tr[3],1e-5);const Cn=new Fd(tr[0]/tr[3],tr[1]/tr[3],tr[2]/tr[3]);tr[0]=hn,tr[1]=dn,tr[2]=on.top,tr[3]=1,Il(tr,tr,zt),tr[3]=Math.max(tr[3],1e-5);const Bn=new Fd(tr[0]/tr[3],tr[1]/tr[3],tr[2]/tr[3]);wr.push(Cn),Tr.push(Bn)}Hr.push(wr),_r.push(Tr)}return[Hr,_r]})(ye,ge,Ge,Ne,nt,yt,Ze,ot,at):(function(wt,et,Dt,Ft,zt){const gr=[],Tt=[],Ht=zt[8]*et,yr=zt[9]*et,Hr=zt[10]*et,_r=zt[11]*et,tr=zt[8]*Dt,yn=zt[9]*Dt,wr=zt[10]*Dt,Tr=zt[11]*Dt;for(const sn of wt){const hn=[],dn=[];for(const on of sn){const Cn=on.x+Ft.x,Bn=on.y+Ft.y,Kn=zt[0]*Cn+zt[4]*Bn+zt[12],an=zt[1]*Cn+zt[5]*Bn+zt[13],ui=zt[2]*Cn+zt[6]*Bn+zt[14],Yn=zt[3]*Cn+zt[7]*Bn+zt[15],Dn=Kn+Ht,Yr=an+yr,Jn=ui+Hr,pn=Math.max(Yn+_r,1e-5),As=Kn+tr,Qn=an+yn,zi=ui+wr,Si=Math.max(Yn+Tr,1e-5);hn.push(new Fd(Dn/pn,Yr/pn,Jn/pn)),dn.push(new Fd(As/Si,Qn/Si,zi/Si))}gr.push(hn),Tt.push(dn)}return[gr,Tt]})(ye,ge,Ge,Ne,nt)})(d,i,L,M,S,m,Q,R,V,d.center.lat,t.tileID.canonical),ae=t.queryGeometry;return(function(de,ye,ge){let Ge=1/0;Ph(ge,ye)&&(Ge=$0(ge,ye[0]));for(let Ne=0;Ne<ye.length;Ne++){const nt=ye[Ne],yt=de[Ne];for(let Ze=0;Ze<nt.length-1;Ze++){const ot=nt[Ze],at=[ot,nt[Ze+1],yt[Ze+1],yt[Ze],ot];Md(ge,at)&&(Ge=Math.min(Ge,$0(ge,at)))}}return Ge!==1/0&&Ge})(oe,pe,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},line:class extends Po{constructor(t){super(t,W0),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ku,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=q0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new um(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new za(this,t)}queryRadius(t){const e=t,r=Z0(Mc("line-width",this,e),Mc("line-gap-width",this,e)),i=Mc("line-offset",this,e);return r/2+Math.abs(i)+wu(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,i,l,d){if(t.queryGeometry.isAboveHorizon)return!1;const m=Rl(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),x=t.pixelToTileUnitsFactor/2*Z0(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),T=this.paint.get("line-offset").evaluate(e,r);return T&&(i=(function(S,M){const L=[],R=new De(0,0);for(let O=0;O<S.length;O++){const V=S[O],q=[];for(let Q=0;Q<V.length;Q++){const oe=V[Q],pe=V[Q+1],ae=Q===0?R:oe.sub(V[Q-1])._unit()._perp(),de=Q===V.length-1?R:pe.sub(oe)._unit()._perp(),ye=ae._add(de)._unit();ye._mult(1/(ye.x*de.x+ye.y*de.y)),q.push(ye._mult(M)._add(oe))}L.push(q)}return L})(i,T*t.pixelToTileUnitsFactor)),(function(S,M,L){for(let R=0;R<M.length;R++){const O=M[R];if(S.length>=3){for(let V=0;V<O.length;V++)if(Oa(S,O[V]))return!0}if(os(S,O,L))return!0}return!1})(m,i,x)}isTileClipped(){return!0}},symbol:Sm,background:class extends Po{constructor(t){super(t,dT)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Po{constructor(t){super(t,pT)}getProgramIds(){return["raster"]}},sky:class extends Po{constructor(t){super(t,mT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Up({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const i=this.paint.get("sky-atmosphere-sun"),l=!i,d=t.style.light,m=d.properties.get("position");return l&&d.properties.get("anchor")==="viewport"&&nn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?Ag(m.azimuthal,90-m.polar,e):Ag(i[0],90-i[1],e)}const r=this.paint.get("sky-gradient-center");return Ag(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class of{constructor(e,r,i,l){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(r,l)}update(e,r,i){const{width:l,height:d}=e,{context:m}=this,{gl:x}=m,{HTMLImageElement:T,HTMLCanvasElement:S,HTMLVideoElement:M,ImageData:L,ImageBitmap:R}=U;if(x.bindTexture(x.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!r||r.premultiply!==!1)),i||this.size&&this.size[0]===l&&this.size[1]===d){const{x:O,y:V}=i||{x:0,y:0};e instanceof T||e instanceof S||e instanceof M||e instanceof L||R&&e instanceof R?x.texSubImage2D(x.TEXTURE_2D,0,O,V,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,O,V,l,d,x.RGBA,x.UNSIGNED_BYTE,e.data)}else this.size=[l,d],e instanceof T||e instanceof S||e instanceof M||e instanceof L||R&&e instanceof R?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,l,d,0,this.format,x.UNSIGNED_BYTE,e.data);this.useMipmap=!!(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,r){const{context:i}=this,{gl:l}=i;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class yT{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class _T{constructor(){this.tasks={},this.taskQueue=[],Ln(["process"],this),this.invoker=new yT(this.process),this.nextId=0}add(e,r){const i=this.nextId++,l=(function({type:d,isSymbolTile:m,zoom:x}){return x=x||0,d==="message"?0:d!=="maybePrepare"||m?d!=="parseTile"||m?d==="parseTile"&&m?300-x:d==="maybePrepare"&&m?400-x:500:200-x:100-x})(r);if(l===0){vr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:e,metadata:r,priority:l,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){vr();try{if(this.taskQueue=this.taskQueue.filter((i=>!!this.tasks[i])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let l=0;l<this.taskQueue.length;l++){const d=this.tasks[this.taskQueue[l]];d.priority<r&&(r=d.priority,e=l)}if(e===null)return null;const i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class I_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const i=e[r];this._stringToNumber[i]=r,this._numberToString[r]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const xT=["tile","layer","source","sourceLayer","state"];class D_{constructor(e,r,i,l,d){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=i,this._y=l,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of xT)this[r]!==void 0&&(e[r]=this[r]);return e}}const pa=32,Fl=33,Mu=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,r=0,i=0,l=0,d=0,m=0,x=0;for(1&e?l=d=m=pa:r=i=x=pa;(e>>=1)>1;){const S=r+l>>1,M=i+d>>1;1&e?(l=r,d=i,r=m,i=x):(r=l,i=d,l=m,d=x),m=S,x=M}const T=4*t;Mu[T+0]=r,Mu[T+1]=i,Mu[T+2]=l,Mu[T+3]=d}const Ol=new Uint16Array(2178),Pu=new Uint8Array(1089),Em=new Uint16Array(1089);function L_(t){return t===0?-.03125:t===32?.03125:0}var j_=Ce([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const R_={type:2,extent:Zt,loadGeometry:()=>[[new De(0,0),new De(Zt+1,0),new De(Zt+1,Zt+1),new De(0,Zt+1),new De(0,0)]]};class Mg{constructor(e,r,i,l,d){this.tileID=e,this.uid=sr(),this.uses=0,this.tileSize=r,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<Hs.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Oh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,i){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(l,d){const m={};if(!d)return m;for(const x of l){const T=x.layerIds.map((S=>d.getLayer(S))).filter(Boolean);if(T.length!==0){x.layers=T,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map((S=>T.filter((M=>M.id===S))[0])));for(const S of T)m[S.id]=x}}return m})(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const d=this.buckets[l];if(d instanceof Au){if(this.hasSymbolBuckets=!0,!i)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const d=this.buckets[l];if(d instanceof Au&&d.hasRTLText){this.hasRTLText=!0,A.isLoading()||A.isLoaded()||b()!=="deferred"||C();break}}this.queryPadding=0;for(const l in this.buckets){const d=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(l).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Kr}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const i in this.buckets){const l=this.buckets[i];l.uploadPending()&&l.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new of(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new of(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new of(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,i,l,d,m,x,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:x,transform:m,params:d,tileTransform:this.tileTransform},e,r,i):{}}querySourceFeatures(e,r){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const l=i.loadVTLayers(),d=r?r.sourceLayer:"",m=l._geojsonTileLayer||l[d];if(!m)return;const x=vl(r&&r.filter),{z:T,x:S,y:M}=this.tileID.canonical,L={z:T,x:S,y:M};for(let R=0;R<m.length;R++){const O=m.feature(R);if(x.needGeometry){const Q=ha(O,!0);if(!x.filter(new I(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!x.filter(new I(this.tileID.overscaledZ),O))continue;const V=i.getId(O,d),q=new D_(O,T,S,M,V);q.tile=L,e.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const i=Mr(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const i=Date.now();let l=!1;if(this.expirationTime>i)l=!1;else if(r)if(this.expirationTime<r)l=!0;else{const d=this.expirationTime-r;d?this.expirationTime=i+Math.max(d,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const i=this.latestFeatureIndex.loadVTLayers(),l=r.style.listImages();for(const d in this.buckets){if(!r.style.hasLayer(d))continue;const m=this.buckets[d],x=m.layers[0].sourceLayer||"_geojsonTileLayer",T=i[x],S=e[x];if(!T||!S||Object.keys(S).length===0)continue;if(m.update(S,T,l,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof um||m instanceof _){const L=r.style._getSourceCache(m.layers[0].source);r._terrain&&r._terrain.enabled&&L&&m.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(L.id,this.tileID)}const M=r&&r.style&&r.style.getLayer(d);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Hs.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Hs.now()+e}setTexture(e,r){const i=r.context,l=i.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new of(i,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE))}setDependencies(e,r){const i={};for(const l of r)i[l]=!0;this.dependencies[e]=i}hasDependency(e,r){for(const i of e){const l=this.dependencies[i];if(l){for(const d of r)if(l[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const i=qi(R_,this.tileID.canonical,this.tileTransform)[0],l=new ft,d=new ns;for(let m=0;m<i.length;m++){const{x,y:T}=i[m];l.emplaceBack(x,T),d.emplaceBack(m)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(l,Th.members),this._tileDebugSegments=zn.simpleSegment(0,0,l.length,d.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const i=qi(R_,this.tileID.canonical,this.tileTransform)[0];let l,d;if(this.isRaster){const m=(function(x,T){const S=Oh(x,T),M=Math.pow(2,x.z);for(let Q=0;Q<Fl;Q++)for(let oe=0;oe<Fl;oe++){const pe=bi((x.x+(oe+L_(oe))/pa)/M),ae=qr((x.y+(Q+L_(Q))/pa)/M),de=T.project(pe,ae),ye=Q*Fl+oe;Ol[2*ye+0]=Math.round((de.x*S.scale-S.x)*Zt),Ol[2*ye+1]=Math.round((de.y*S.scale-S.y)*Zt)}Pu.fill(0),Em.fill(0);for(let Q=2045;Q>=0;Q--){const oe=4*Q,pe=Mu[oe+0],ae=Mu[oe+1],de=Mu[oe+2],ye=Mu[oe+3],ge=pe+de>>1,Ge=ae+ye>>1,Ne=ge+Ge-ae,nt=Ge+pe-ge,yt=ae*Fl+pe,Ze=ye*Fl+de,ot=Ge*Fl+ge,at=Math.hypot((Ol[2*yt+0]+Ol[2*Ze+0])/2-Ol[2*ot+0],(Ol[2*yt+1]+Ol[2*Ze+1])/2-Ol[2*ot+1])>=16;Pu[ot]=Pu[ot]||(at?1:0),Q<1022&&(Pu[ot]=Pu[ot]||Pu[(ae+nt>>1)*Fl+(pe+Ne>>1)]||Pu[(ye+nt>>1)*Fl+(de+Ne>>1)])}const L=new Je,R=new Vt;let O=0;function V(Q,oe){const pe=oe*Fl+Q;return Em[pe]===0&&(L.emplaceBack(Ol[2*pe+0],Ol[2*pe+1],Q*Zt/pa,oe*Zt/pa),Em[pe]=++O),Em[pe]-1}function q(Q,oe,pe,ae,de,ye){const ge=Q+pe>>1,Ge=oe+ae>>1;if(Math.abs(Q-de)+Math.abs(oe-ye)>1&&Pu[Ge*Fl+ge])q(de,ye,Q,oe,ge,Ge),q(pe,ae,de,ye,ge,Ge);else{const Ne=V(Q,oe),nt=V(pe,ae),yt=V(de,ye);R.emplaceBack(Ne,nt,yt)}}return q(0,0,pa,pa,pa,0),q(pa,pa,0,0,0,pa),{vertices:L,indices:R}})(this.tileID.canonical,r);l=m.vertices,d=m.indices}else{l=new Je,d=new Vt;for(const{x,y:T}of i)l.emplaceBack(x,T,0,0);const m=Nd(l.int16,void 0,4);for(let x=0;x<m.length;x+=3)d.emplaceBack(m[x],m[x+1],m[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,j_.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=zn.simpleSegment(0,0,l.length,d.length)}_makeGlobeTileDebugBuffers(e,r){const i=r.projection;if(!i||i.name!=="globe"||r.freezeTileCoverage)return;const l=this.tileID.canonical,d=is(Mp(l,r)),m=xu(r.zoom);let x;m>0&&(x=Os(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,l,r,d,x,m),this._makeGlobeTileDebugTextBuffer(e,l,r,d,x,m)}_globePoint(e,r,i,l,d,m,x){let T=oo(e,r,i);if(m){const S=1<<i.z,M=cn(l.center.lng),L=wn(l.center.lat),R=(i.x+.5)/S-M;let O=0;R>.5?O=-1:R<-.5&&(O=1);let V=(e/Zt+i.x)/S+O,q=(r/Zt+i.y)/S;V=(V-M)*l._pixelsPerMercatorPixel+M,q=(q-L)*l._pixelsPerMercatorPixel+L;const Q=[V*l.worldSize,q*l.worldSize,0];kn(Q,Q,m),T=Fa(T,Q,x)}return kn(T,T,d)}_makeGlobeTileDebugBorderBuffer(e,r,i,l,d,m){const x=new ft,T=new ns,S=new je,M=(R,O,V,q,Q)=>{const oe=(V-R)/(Q-1),pe=(q-O)/(Q-1),ae=x.length;for(let de=0;de<Q;de++){const ye=R+de*oe,ge=O+de*pe;x.emplaceBack(ye,ge);const Ge=this._globePoint(ye,ge,r,i,l,d,m);S.emplaceBack(Ge[0],Ge[1],Ge[2]),T.emplaceBack(ae+de)}},L=Zt;M(0,0,L,0,16),M(L,0,L,L,16),M(L,L,0,L,16),M(0,L,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(T),this._tileDebugBuffer=e.createVertexBuffer(x,Th.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(S,la.members),this._tileDebugSegments=zn.simpleSegment(0,0,x.length,T.length)}_makeGlobeTileDebugTextBuffer(e,r,i,l,d,m){const x=Zt/4,T=new ft,S=new Vt,M=new je,L=25;S.reserve(32),T.reserve(L),M.reserve(L);const R=(O,V)=>L*O+V;for(let O=0;O<L;O++){const V=O*x;for(let q=0;q<L;q++){const Q=q*x;T.emplaceBack(Q,V);const oe=this._globePoint(Q,V,r,i,l,d,m);M.emplaceBack(oe[0],oe[1],oe[2])}}for(let O=0;O<4;O++)for(let V=0;V<4;V++){const q=R(O,V),Q=R(O,V+1),oe=R(O+1,V),pe=R(O+1,V+1);S.emplaceBack(q,Q,oe),S.emplaceBack(oe,Q,pe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(S),this._tileDebugTextBuffer=e.createVertexBuffer(T,Th.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(M,la.members),this._tileDebugTextSegments=zn.simpleSegment(0,0,L,32)}}class vT{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,i){const l=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},Ot(this.stateChanges[e][l],i),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==l&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const d in this.state[e][l])i[d]||(this.deletedStates[e][l][d]=null)}else for(const d in i)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][d]===null&&delete this.deletedStates[e][l][d]}removeFeatureState(e,r,i){if(this.deletedStates[e]===null)return;const l=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&r!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][i]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(i in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][i]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,r){const i=String(r),l=Ot({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][r];if(d===null)return{};for(const m in d)delete l[m]}return l}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const i={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const d={};for(const m in this.stateChanges[l])this.state[l][m]||(this.state[l][m]={}),Ot(this.state[l][m],this.stateChanges[l][m]),d[m]=this.state[l][m];i[l]=d}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const d={};if(this.deletedStates[l]===null)for(const m in this.state[l])d[m]={},this.state[l][m]={};else for(const m in this.deletedStates[l]){if(this.deletedStates[l][m]===null)this.state[l][m]={};else if(this.state[l][m])for(const x of Object.keys(this.deletedStates[l][m]))delete this.state[l][m][x];d[m]=this.state[l][m]}i[l]=i[l]||{},Ot(i[l],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(i).length!==0)for(const l in e)e[l].setFeatureState(i,r)}}class z_{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const i=this.toIdx(e,r);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function N_(t,e,r,i){let l=0,d=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(i[m])<1e-15){if(r[m]<t[m]||r[m]>e[m])return null}else{const x=1/i[m];let T=(t[m]-r[m])*x,S=(e[m]-r[m])*x;if(T>S){const M=T;T=S,S=M}if(T>l&&(l=T),S<d&&(d=S),l>d)return null}return l}function B_(t,e,r,i,l,d,m,x,T,S,M){const L=i-t,R=l-e,O=d-r,V=m-t,q=x-e,Q=T-r,oe=M[1]*Q-M[2]*q,pe=M[2]*V-M[0]*Q,ae=M[0]*q-M[1]*V,de=L*oe+R*pe+O*ae;if(Math.abs(de)<1e-15)return null;const ye=1/de,ge=S[0]-t,Ge=S[1]-e,Ne=S[2]-r,nt=(ge*oe+Ge*pe+Ne*ae)*ye;if(nt<0||nt>1)return null;const yt=Ge*O-Ne*R,Ze=Ne*L-ge*O,ot=ge*R-Ge*L,at=(M[0]*yt+M[1]*Ze+M[2]*ot)*ye;return at<0||nt+at>1?null:(V*yt+q*Ze+Q*ot)*ye}function F_(t,e,r){return(t-e)/(r-e)}function O_(t,e,r,i,l,d,m,x,T){const S=1<<r,M=d-i,L=m-l,R=(t+1)/S*M+i,O=(e+0)/S*L+l,V=(e+1)/S*L+l;x[0]=(t+0)/S*M+i,x[1]=O,T[0]=R,T[1]=V}class U_{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=(function(d){const m=Math.ceil(Math.log2(d.dim/8)),x=[];let T=Math.ceil(Math.pow(2,m));const S=1/T,M=(O,V,q,Q,oe)=>{const pe=Q?1:0,ae=(O+1)*q-pe,de=V*q,ye=(V+1)*q-pe;oe[0]=O*q,oe[1]=de,oe[2]=ae,oe[3]=ye};let L=new z_(T);const R=[];for(let O=0;O<T*T;O++){M(O%T,Math.floor(O/T),S,!1,R);const V=Iu(R[0],R[1],d),q=Iu(R[2],R[1],d),Q=Iu(R[2],R[3],d),oe=Iu(R[0],R[3],d);L.minimums.push(Math.min(V,q,Q,oe)),L.maximums.push(Math.max(V,q,Q,oe)),L.leaves.push(1)}for(x.push(L),T/=2;T>=1;T/=2){const O=x[x.length-1];L=new z_(T);for(let V=0;V<T*T;V++){M(V%T,Math.floor(V/T),2,!0,R);const q=O.getElevation(R[0],R[1]),Q=O.getElevation(R[2],R[1]),oe=O.getElevation(R[2],R[3]),pe=O.getElevation(R[0],R[3]),ae=O.isLeaf(R[0],R[1]),de=O.isLeaf(R[2],R[1]),ye=O.isLeaf(R[2],R[3]),ge=O.isLeaf(R[0],R[3]),Ge=Math.min(q.min,Q.min,oe.min,pe.min),Ne=Math.max(q.max,Q.max,oe.max,pe.max),nt=ae&&de&&ye&&ge;L.maximums.push(Ne),L.minimums.push(Ge),L.leaves.push(Ne-Ge<=5&&nt?1:0)}x.push(L)}return x})(this.dem),i=r.length-1,l=r[i];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(r,0,0,i,0)}raycastRoot(e,r,i,l,d,m,x=1){return N_([e,r,-100],[i,l,this.maximums[0]*x],d,m)}raycast(e,r,i,l,d,m,x=1){if(!this.nodeCount)return null;const T=this.raycastRoot(e,r,i,l,d,m,x);if(T==null)return null;const S=[],M=[],L=[],R=[],O=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:V,t:q,nodex:Q,nodey:oe,depth:pe}=O.pop();if(this.leaves[V]){O_(Q,oe,pe,e,r,i,l,L,R);const de=1<<pe,ye=(Q+0)/de,ge=(Q+1)/de,Ge=(oe+0)/de,Ne=(oe+1)/de,nt=Iu(ye,Ge,this.dem)*x,yt=Iu(ge,Ge,this.dem)*x,Ze=Iu(ge,Ne,this.dem)*x,ot=Iu(ye,Ne,this.dem)*x,at=B_(L[0],L[1],nt,R[0],L[1],yt,R[0],R[1],Ze,d,m),pt=B_(R[0],R[1],Ze,L[0],R[1],ot,L[0],L[1],nt,d,m),wt=Math.min(at!==null?at:Number.MAX_VALUE,pt!==null?pt:Number.MAX_VALUE);if(wt!==Number.MAX_VALUE)return wt;{const et=fu([],d,m,q);if(V_(nt,yt,ot,Ze,F_(et[0],L[0],R[0]),F_(et[1],L[1],R[1]))>=et[2])return q}continue}let ae=0;for(let de=0;de<this._siblingOffset.length;de++){O_((Q<<1)+this._siblingOffset[de][0],(oe<<1)+this._siblingOffset[de][1],pe+1,e,r,i,l,L,R),L[2]=-100,R[2]=this.maximums[this.childOffsets[V]+de]*x;const ye=N_(L,R,d,m);if(ye!=null){const ge=ye;S[de]=ge;let Ge=!1;for(let Ne=0;Ne<ae&&!Ge;Ne++)ge>=S[M[Ne]]&&(M.splice(Ne,0,de),Ge=!0);Ge||(M[ae]=de),ae++}}for(let de=0;de<ae;de++){const ye=M[de];O.push({idx:this.childOffsets[V]+ye,t:S[ye],nodex:(Q<<1)+this._siblingOffset[ye][0],nodey:(oe<<1)+this._siblingOffset[ye][1],depth:pe+1})}}return null}_addNode(e,r,i){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,i,l,d){if(e[l].isLeaf(r,i)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const m=l-1,x=e[m];let T=0,S=0;for(let M=0;M<this._siblingOffset.length;M++){const L=2*r+this._siblingOffset[M][0],R=2*i+this._siblingOffset[M][1],O=x.getElevation(L,R),V=x.isLeaf(L,R),q=this._addNode(O.min,O.max,V);V&&(T|=1<<M),S||(S=q)}for(let M=0;M<this._siblingOffset.length;M++)T&1<<M||this._construct(e,2*r+this._siblingOffset[M][0],2*i+this._siblingOffset[M][1],m,S+M)}}function V_(t,e,r,i,l,d){return Rr(Rr(t,r,d),Rr(e,i,d),l)}function Iu(t,e,r){const i=r.dim,l=Fe(t*i-.5,0,i-1),d=Fe(e*i-.5,0,i-1),m=Math.floor(l),x=Math.floor(d),T=Math.min(m+1,i-1),S=Math.min(x+1,i-1);return V_(r.get(m,x),r.get(T,x),r.get(m,S),r.get(T,S),l-m,d-x)}const $_={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function bT(t,e,r){return(256*t*256+256*e+r)/10-1e4}function wT(t,e,r){return 256*t+e+r/256-32768}class km{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,i,l=!1,d=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(i&&i!=="mapbox"&&i!=="terrarium")return nn(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const m=this.dim=r.height-2,x=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=i||"mapbox",this.borderReady=l,!l){for(let T=0;T<m;T++)x[this._idx(-1,T)]=x[this._idx(0,T)],x[this._idx(m,T)]=x[this._idx(m-1,T)],x[this._idx(T,-1)]=x[this._idx(T,0)],x[this._idx(T,m)]=x[this._idx(T,m-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(m,-1)]=x[this._idx(m-1,0)],x[this._idx(-1,m)]=x[this._idx(0,m-1)],x[this._idx(m,m)]=x[this._idx(m-1,m-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new U_(this)}get(e,r,i=!1){i&&(e=Fe(e,-1,this.dim),r=Fe(r,-1,this.dim));const l=4*this._idx(e,r);return(this.encoding==="terrarium"?wT:bT)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}static getUnpackVector(e){return $_[e]}get unpackVector(){return $_[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const i=[0,0,0,0],l=km.getUnpackVector(r);let d=Math.floor((e+l[3])/l[2]);return i[2]=d%256,d=Math.floor(d/256),i[1]=d%256,d=Math.floor(d/256),i[0]=d,i}getPixels(){return new as({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,d=r*this.dim+this.dim,m=i*this.dim,x=i*this.dim+this.dim;switch(r){case-1:l=d-1;break;case 1:d=l+1}switch(i){case-1:m=x-1;break;case 1:x=m+1}const T=-r*this.dim,S=-i*this.dim;for(let M=m;M<x;M++)for(let L=l;L<d;L++){const R=4*this._idx(L,M),O=4*this._idx(L+T,M+S);this.pixels[R+0]=e.pixels[O+0],this.pixels[R+1]=e.pixels[O+1],this.pixels[R+2]=e.pixels[O+2],this.pixels[R+3]=e.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Lt(km,"DEMData"),Lt(U_,"DemMinMaxQuadTree",{omit:["dem"]});class TT{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,i){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const d={value:r,timeout:void 0};if(i!==void 0&&(d.timeout=setTimeout((()=>{this.remove(e,d)}),i)),this.data[l].push(d),this.order.push(l),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const i=e.wrapped().key,l=r===void 0?0:this.data[i].indexOf(r),d=this.data[i][l];return this.data[i].splice(l,1),d.timeout&&clearTimeout(d.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(d.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const i in this.data)for(const l of this.data[i])e(l.value)||r.push(l);for(const i of r)this.remove(i.value.tileID,i)}}class Xd{constructor(e,r,i){this.func=e,this.mask=r,this.range=i}}Xd.ReadOnly=!1,Xd.ReadWrite=!0,Xd.disabled=new Xd(519,Xd.ReadOnly,[0,1]);const Pg=7680;class Ig{constructor(e,r,i,l,d,m){this.test=e,this.ref=r,this.mask=i,this.fail=l,this.depthFail=d,this.pass=m}}Ig.disabled=new Ig({func:519,mask:0},0,0,Pg,Pg,Pg);class Ul{constructor(e,r,i){this.blendFunction=e,this.blendColor=r,this.mask=i}}Ul.Replace=[1,0],Ul.disabled=new Ul(Ul.Replace,tn.transparent,[!1,!1,!1,!1]),Ul.unblended=new Ul(Ul.Replace,tn.transparent,[!0,!0,!0,!0]),Ul.alphaBlended=new Ul([1,771],tn.transparent,[!0,!0,!0,!0]);const Dg=1029,Lg=2305;class $a{constructor(e,r,i){this.enable=e,this.mode=r,this.frontFace=i}}$a.disabled=new $a(!1,Dg,Lg),$a.backCCW=new $a(!0,Dg,Lg),$a.backCW=new $a(!0,Dg,2304),$a.frontCW=new $a(!0,1028,2304),$a.frontCCW=new $a(!0,1028,Lg);class Uh extends Ni{constructor(e,r,i){super(),this.id=e,this._onlySymbols=i,r.on("data",(l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),r.on("error",(()=>{this._sourceErrored=!0})),this._source=r,this._tiles={},this._cache=new TT(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new vT,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const i=this._tiles[r];i.upload(e),i.prepare(this.map.style.imageManager)}}getIds(){return Gt(this._tiles).map((e=>e.tileID)).sort(G_).map((e=>e.key))}getRenderableIds(e){const r=[];for(const i in this._tiles)this._isIdRenderable(+i,e)&&r.push(this._tiles[i]);return e?r.sort(((i,l)=>{const d=i.tileID,m=l.tileID,x=new De(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),T=new De(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-m.overscaledZ||T.y-x.y||T.x-x.x})).map((i=>i.tileID.key)):r.map((i=>i.tileID)).sort(G_).map((i=>i.key))}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const i=this._tiles[e];i&&(i.state!=="loading"&&(i.state=r),this._loadTile(i,this._tileLoaded.bind(this,i,e,r)))}_tileLoaded(e,r,i,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new ps(l,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Hs.now(),i==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new $o("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let l=0;l<r.length;l++){const d=r[l];if(e.neighboringTiles&&e.neighboringTiles[d]){const m=this.getTileByID(d);i(e,m),i(m,e)}}function i(l,d){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let m=d.tileID.canonical.x-l.tileID.canonical.x;const x=d.tileID.canonical.y-l.tileID.canonical.y,T=Math.pow(2,l.tileID.canonical.z),S=d.tileID.key;m===0&&x===0||Math.abs(x)>1||(Math.abs(m)>1&&(Math.abs(m+T)===1?m+=T:Math.abs(m-T)===1&&(m-=T)),d.dem&&l.dem&&(l.dem.backfillBorder(d.dem,m,x),l.neighboringTiles&&l.neighboringTiles[S]&&(l.neighboringTiles[S].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,i,l){for(const d in this._tiles){let m=this._tiles[d];if(l[d]||!m.hasData()||m.tileID.overscaledZ<=r||m.tileID.overscaledZ>i)continue;let x=m.tileID;for(;m&&m.tileID.overscaledZ>r+1;){const S=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[S.key],m&&m.hasData()&&(x=S)}let T=x;for(;T.overscaledZ>r;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){l[x.key]=x;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=r?i:null}for(let i=e.overscaledZ-1;i>=r;i--){const l=e.scaledTo(i),d=this._getLoadedTile(l);if(d)return d}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const i=Math.ceil(e.width/r)+1,l=Math.ceil(e.height/r)+1,d=Math.floor(i*l*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(x)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const i={};for(const l in this._tiles){const d=this._tiles[l];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+r),i[d.tileID.key]=d}this._tiles=i;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,r,i){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!i)return;let l;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((x=>new Cs(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y))):(l=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter((x=>this._source.hasTile(x))))):l=[];const d=this._updateRetainedTiles(l);if(W_(this._source.type)&&l.length!==0){const x={},T={},S=Object.keys(d);for(const L of S){const R=d[L],O=this._tiles[L];if(!O||O.fadeEndTime&&O.fadeEndTime<=Hs.now())continue;const V=this.findLoadedParent(R,Math.max(R.overscaledZ-Uh.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),x[V.tileID.key]=V.tileID),T[L]=R}const M=l[l.length-1].overscaledZ;for(const L in this._tiles){const R=this._tiles[L];if(d[L]||!R.hasData())continue;let O=R.tileID;for(;O.overscaledZ>M;){O=O.scaledTo(O.overscaledZ-1);const V=this._tiles[O.key];if(V&&V.hasData()&&T[O.key]){d[L]=R.tileID;break}}}for(const L in x)d[L]||(this._coveredTiles[L]=!0,d[L]=x[L])}for(const x in d)this._tiles[x].clearFadeHold();const m=(function(x,T){const S=[];for(const M in x)M in T||S.push(M);return S})(this._tiles,d);for(const x of m){const T=this._tiles[x];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const i={},l=e.reduce(((S,M)=>Math.min(S,M.overscaledZ)),1/0),d=e[0].overscaledZ,m=Math.max(d-Uh.maxOverzooming,this._source.minzoom),x=Math.max(d+Uh.maxUnderzooming,this._source.minzoom),T={};for(const S of e){const M=this._addTile(S);r[S.key]=S,M.hasData()||l<this._source.maxzoom&&(T[S.key]=S)}this._retainLoadedChildren(T,l,x,r);for(const S of e){let M=this._tiles[S.key];if(M.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const R=S.children(this._source.maxzoom)[0],O=this.getTile(R);if(O&&O.hasData()){r[R.key]=R;continue}}else{const R=S.children(this._source.maxzoom);if(r[R[0].key]&&r[R[1].key]&&r[R[2].key]&&r[R[3].key])continue}let L=M.wasRequested();for(let R=S.overscaledZ-1;R>=m;--R){const O=S.scaledTo(R);if(i[O.key]||(i[O.key]=!0,M=this.getTile(O),!M&&L&&(M=this._addTile(O)),M&&(r[O.key]=O,L=M.wasRequested(),M.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let i,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){i=this._loadedParentTiles[l.key];break}r.push(l.key);const d=l.scaledTo(l.overscaledZ-1);if(i=this._getLoadedTile(d),i)break;l=d}for(const d of r)this._loadedParentTiles[d]=i}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const i=!!r;if(!i){const l=this.map?this.map.painter:null;r=new Mg(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,i||this._source.fire(new $o("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=r.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),i))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,i){const l=[],d=this.transform;if(!d)return l;const m=d.projection.name==="globe",x=cn(d.center.lng);for(const T in this._tiles){const S=this._tiles[T];if(i&&S.clearQueryDebugViz(),S.holdingForFade())continue;let M;if(m){const L=S.tileID.canonical;if(L.z===0){const R=[Math.abs(Fe(x,...af(L,-1))-x),Math.abs(Fe(x,...af(L,1))-x)];M=[0,2*R.indexOf(Math.min(...R))-1]}else{const R=[Math.abs(Fe(x,...af(L,-1))-x),Math.abs(Fe(x,...af(L,0))-x),Math.abs(Fe(x,...af(L,1))-x)];M=[R.indexOf(Math.min(...R))-1]}}else M=[0];for(const L of M){const R=e.containsTile(S,d,r,L);R&&l.push(R)}}return l}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map((i=>this._tiles[i].tileID));for(const i of r)i.projMatrix=this.transform.calculateProjMatrix(i.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(W_(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=Hs.now())return!0}return!1}setFeatureState(e,r,i){this._state.updateState(e=e||"_geojsonTileLayer",r,i)}removeFeatureState(e,r,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,i)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,i){const l=this._tiles[e];l&&l.setDependencies(r,i)}reloadTilesForDependencies(e,r){for(const i in this._tiles)this._tiles[i].hasDependency(e,r)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(e,r)))}_preloadTiles(e,r){if(!this._sourceLoaded){const x=()=>{this._sourceLoaded&&(this._source.off("data",x),this._preloadTiles(e,r))};return void this._source.on("data",x)}const i=new Map,l=Array.isArray(e)?e:[e],d=this.map.painter.terrain,m=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const x of l){const T=x.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of T)i.set(S.key,S);this.usedForTerrain&&x.updateElevation(!1)}st(Array.from(i.values()),((x,T)=>{const S=new Mg(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,(M=>{this._source.type==="raster-dem"&&S.dem&&this._backfillDEM(S),T(M,S)}))}),r)}}function G_(t,e){const r=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function W_(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function af(t,e){const r=1<<t.z;return[t.x/r+e,(t.x+1)/r+e]}Uh.maxOverzooming=10,Uh.maxUnderzooming=3;class Cm{constructor(e,r,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=i}static create(e,r,i){const l=i||e.findDEMTileFor(r);if(!l||!l.dem)return;const d=l.dem,m=l.tileID,x=1<<r.canonical.z-m.canonical.z;return new Cm(l,l.tileSize/Zt/x,[(r.canonical.x/x-m.canonical.x)*d.dim,(r.canonical.y/x-m.canonical.y)*d.dim])}tileCoordToPixel(e,r){const i=r*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(i);return new De(l,d)}getElevationAt(e,r,i,l){const d=e*this._scale+this._offset[0],m=r*this._scale+this._offset[1],x=Math.floor(d),T=Math.floor(m),S=this._dem;return l=!!l,i?Rr(Rr(S.get(x,T,l),S.get(x,T+1,l),m-T),Rr(S.get(x+1,T,l),S.get(x+1,T+1,l),m-T),d-x):S.get(x,T,l)}getElevationAtPixel(e,r,i){return this._dem.get(e,r,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Nn(1,e)*this._dem.stride}}class q_{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ro(Zt,16,0),this.featureIndexArray=new Mn,this.promoteId=r}insert(e,r,i,l,d,m=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,l,d,m);const T=this.grid;for(let S=0;S<r.length;S++){const M=r[S],L=[1/0,1/0,-1/0,-1/0];for(let R=0;R<M.length;R++){const O=M[R];L[0]=Math.min(L[0],O.x),L[1]=Math.min(L[1],O.y),L[2]=Math.max(L[2],O.x),L[3]=Math.max(L[3],O.y)}L[0]<Zt&&L[1]<Zt&&L[2]>=0&&L[3]>=0&&T.insert(x,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Qt(new pm(this.rawTileData)).layers,this.sourceLayerCoder=new I_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,i,l){this.loadVTLayers();const d=e.params||{},m=vl(d.filter),x=e.tileResult,T=e.transform,S=x.bufferedTilespaceBounds,M=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,((V,q,Q,oe)=>nm(x.bufferedTilespaceGeometry,V,q,Q,oe)));M.sort(ST);let L=null;T.elevation&&M.length>0&&(L=Cm.create(T.elevation,this.tileID));const R={};let O;for(let V=0;V<M.length;V++){const q=M[V];if(q===O)continue;O=q;const Q=this.featureIndexArray.get(q);let oe=null;this.loadMatchingFeature(R,Q,m,d.layers,d.availableImages,r,i,l,((pe,ae,de,ye=0)=>(oe||(oe=qi(pe,this.tileID.canonical,e.tileTransform)),ae.queryIntersectsFeature(x,pe,de,oe,this.z,e.transform,e.pixelPosMatrix,L,ye))))}return R}loadMatchingFeature(e,r,i,l,d,m,x,T,S){const{featureIndex:M,bucketIndex:L,sourceLayerIndex:R,layoutVertexArrayOffset:O}=r,V=this.bucketLayerIDs[L];if(l&&!(function(pe,ae){for(let de=0;de<pe.length;de++)if(ae.indexOf(pe[de])>=0)return!0;return!1})(l,V))return;const q=this.sourceLayerCoder.decode(R),Q=this.vtLayers[q].feature(M);if(i.needGeometry){const pe=ha(Q,!0);if(!i.filter(new I(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!i.filter(new I(this.tileID.overscaledZ),Q))return;const oe=this.getId(Q,q);for(let pe=0;pe<V.length;pe++){const ae=V[pe];if(l&&l.indexOf(ae)<0)continue;const de=m[ae];if(!de)continue;let ye={};oe!==void 0&&T&&(ye=T.getState(de.sourceLayer||"_geojsonTileLayer",oe));const ge=Ot({},x[ae]);ge.paint=Z_(ge.paint,de.paint,Q,ye,d),ge.layout=Z_(ge.layout,de.layout,Q,ye,d);const Ge=!S||S(Q,de,ye,O);if(!Ge)continue;const Ne=new D_(Q,this.z,this.x,this.y,oe);Ne.layer=ge;let nt=e[ae];nt===void 0&&(nt=e[ae]=[]),nt.push({featureIndex:M,feature:Ne,intersectionZ:Ge})}}lookupSymbolFeatures(e,r,i,l,d,m,x,T){const S={};this.loadVTLayers();const M=vl(d);for(const L of e)this.loadMatchingFeature(S,{bucketIndex:i,sourceLayerIndex:l,featureIndex:L,layoutVertexArrayOffset:0},M,m,x,T,r);return S}loadFeature(e){const{featureIndex:r,sourceLayerIndex:i}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(i),d=this.vtFeatures[l];if(d[r])return d[r];const m=this.vtLayers[l].feature(r);return d[r]=m,m}hasLayer(e){for(const r of this.bucketLayerIDs)for(const i of r)if(e===i)return!0;return!1}getId(e,r){let i=e.id;if(this.promoteId){const l=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];l!=null&&(i=e.properties[l]),typeof i=="boolean"&&(i=Number(i))}return i}}function Z_(t,e,r,i,l){return Cr(t,((d,m)=>{const x=e instanceof se?e.get(m):null;return x&&x.evaluate?x.evaluate(r,i,l):x}))}function ST(t,e){return e-t}Lt(q_,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class H_{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new ks({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const i=this.getKey(e,r);return this.positions[i]}trim(){const e=this.width,r=this.height=jr(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,i){const l=[];let d=e.length%2==1?-e[e.length-1]*i:0,m=e[0]*i,x=!0;l.push({left:d,right:m,isDash:x,zeroLength:e[0]===0});let T=e[0];for(let S=1;S<e.length;S++){x=!x;const M=e[S];d=T*i,T+=M,m=T*i,l.push({left:d,right:m,isDash:x,zeroLength:M===0})}return l}addRoundDash(e,r,i){const l=r/2;for(let d=-i;d<=i;d++){const m=this.width*(this.nextRow+i+d);let x=0,T=e[x];for(let S=0;S<this.width;S++){S/T.right>1&&(T=e[++x]);const M=Math.abs(S-T.left),L=Math.abs(S-T.right),R=Math.min(M,L);let O;const V=d/i*(l+1);if(T.isDash){const q=l-Math.abs(V);O=Math.sqrt(R*R+q*q)}else O=l-Math.sqrt(R*R+V*V);this.image.data[m+S]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e,r){for(let T=e.length-1;T>=0;--T){const S=e[T],M=e[T+1];S.zeroLength?e.splice(T,1):M&&M.isDash===S.isDash&&(M.left=S.left,e.splice(T,1))}const i=e[0],l=e[e.length-1];i.isDash===l.isDash&&(i.left=l.left-this.width,l.right=i.right+this.width);const d=this.width*this.nextRow;let m=0,x=e[m];for(let T=0;T<this.width;T++){T/x.right>1&&(x=e[++m]);const S=Math.abs(T-x.left),M=Math.abs(T-x.right),L=Math.min(S,M);this.image.data[d+T]=Math.max(0,Math.min(255,(x.isDash?L:-L)+r+128))}}addDash(e,r){const i=this.getKey(e,r);if(this.positions[i])return this.positions[i];const l=r==="round",d=l?7:0,m=2*d+1;if(this.nextRow+m>this.height)return nn("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let M=0;M<e.length;M++)e[M]<0&&(nn("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),x+=e[M];if(x!==0){const M=this.width/x,L=this.getDashRanges(e,this.width,M);l?this.addRoundDash(L,M,d):this.addRegularDash(L,r==="square"?.5*M:0)}const T=this.nextRow+d;this.nextRow+=m;const S={tl:[T,d],br:[x,0]};return this.positions[i]=S,S}}Lt(H_,"LineAtlas");const X_=1*Va;class K_{constructor(e){const r={},i=[];for(const x in e){const T=e[x],S=r[x]={};for(const M in T.glyphs){const L=T.glyphs[+M];if(!L||L.bitmap.width===0||L.bitmap.height===0)continue;const R=L.metrics.localGlyph?X_:1,O={x:0,y:0,w:L.bitmap.width+2*R,h:L.bitmap.height+2*R};i.push(O),S[M]=O}}const{w:l,h:d}=yg(i),m=new ks({width:l||1,height:d||1});for(const x in e){const T=e[x];for(const S in T.glyphs){const M=T.glyphs[+S];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const L=r[x][S],R=M.metrics.localGlyph?X_:1;ks.copy(M.bitmap,m,{x:0,y:0},{x:L.x+R,y:L.y+R},M.bitmap)}}this.image=m,this.positions=r}}Lt(K_,"GlyphAtlas");class ET{constructor(e){this.tileID=new Cs(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Oh(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,i,l,d){this.status="parsing",this.data=e,this.collisionBoxArray=new Kr;const m=new I_(Object.keys(e.layers).sort()),x=new q_(this.tileID,this.promoteId);x.bucketLayerIDs=[];const T={},S=new H_(256,256),M={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:i},L=r.familiesBySource[this.source];for(const ye in L){const ge=e.layers[ye];if(!ge)continue;let Ge=!1,Ne=!1;for(const Ze of L[ye])Ze[0].type==="symbol"?Ge=!0:Ne=!0;if(this.isSymbolTile===!0&&!Ge||this.isSymbolTile===!1&&!Ne)continue;ge.version===1&&nn(`Vector tile source "${this.source}" layer "${ye}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const nt=m.encode(ye),yt=[];for(let Ze=0;Ze<ge.length;Ze++){const ot=ge.feature(Ze),at=x.getId(ot,ye);yt.push({feature:ot,id:at,index:Ze,sourceLayerIndex:nt})}for(const Ze of L[ye]){const ot=Ze[0];this.isSymbolTile!==void 0&&ot.type==="symbol"!==this.isSymbolTile||ot.minzoom&&this.zoom<Math.floor(ot.minzoom)||ot.maxzoom&&this.zoom>=ot.maxzoom||ot.visibility!=="none"&&(jg(Ze,this.zoom,i),(T[ot.id]=ot.createBucket({index:x.bucketLayerIDs.length,layers:Ze,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:nt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:i})).populate(yt,M,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Ze.map((at=>at.id))))}}let R,O,V,q;S.trim();const Q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},oe=()=>{if(R)return d(R);if(O&&V&&q){const ye=new K_(O),ge=new n_(V,q);for(const Ge in T){const Ne=T[Ge];Ne instanceof Au?(jg(Ne.layers,this.zoom,i),Yw(Ne,O,ye.positions,V,ge.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection)):Ne.hasPattern&&(Ne instanceof um||Ne instanceof _||Ne instanceof Hp)&&(jg(Ne.layers,this.zoom,i),Ne.addFeatures(M,this.tileID.canonical,ge.patternPositions,i,this.tileTransform))}this.status="done",d(null,{buckets:Gt(T).filter((Ge=>!Ge.isEmpty())),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ye.image,lineAtlas:S,imageAtlas:ge,glyphMap:this.returnDependencies?O:null,iconMap:this.returnDependencies?V:null,glyphPositions:this.returnDependencies?ye.positions:null})}},pe=Cr(M.glyphDependencies,(ye=>Object.keys(ye).map(Number)));Object.keys(pe).length?l.send("getGlyphs",{uid:this.uid,stacks:pe},((ye,ge)=>{R||(R=ye,O=ge,oe())}),void 0,!1,Q):O={};const ae=Object.keys(M.iconDependencies);ae.length?l.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"icons"},((ye,ge)=>{R||(R=ye,V=ge,oe())}),void 0,!1,Q):V={};const de=Object.keys(M.patternDependencies);de.length?l.send("getImages",{icons:de,source:this.source,tileID:this.tileID,type:"patterns"},((ye,ge)=>{R||(R=ye,q=ge,oe())}),void 0,!1,Q):q={},oe()}}function jg(t,e,r){const i=new I(e);for(const l of t)l.recalculate(i,r)}class Y_{constructor(e){this.entries={},this.scheduler=e}request(e,r,i,l){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[m,x]=d.result;return this.scheduler?this.scheduler.add((()=>{l(m,x)}),r):l(m,x),()=>{}}return d.callbacks.push(l),d.cancel||(d.cancel=i(((m,x)=>{d.result=[m,x];for(const T of d.callbacks)this.scheduler?this.scheduler.add((()=>{T(m,x)}),r):T(m,x);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{d.result||(d.callbacks=d.callbacks.filter((m=>m!==l)),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function J_(t,e,r){const i=JSON.stringify(t.request);return t.data&&(this.deduped.entries[i]={result:[null,t.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},(l=>{const d=Vo(t.request,((m,x,T,S)=>{m?l(m):x&&l(null,{vectorTile:r?void 0:new Qt(new pm(x)),rawData:x,cacheControl:T,expires:S})}));return()=>{d.cancel(),l()}}),e)}const Q_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Rg{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,i]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=i>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const d=Q_[15&i];if(!d)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new Rg(x,m,d,e)}constructor(e,r=64,i=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=Q_.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-x%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${i}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+x+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=r,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return zg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,i,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:m,nodeSize:x}=this,T=[0,d.length-1,0],S=[];for(;T.length;){const M=T.pop()||0,L=T.pop()||0,R=T.pop()||0;if(L-R<=x){for(let Q=R;Q<=L;Q++){const oe=m[2*Q],pe=m[2*Q+1];oe>=e&&oe<=i&&pe>=r&&pe<=l&&S.push(d[Q])}continue}const O=R+L>>1,V=m[2*O],q=m[2*O+1];V>=e&&V<=i&&q>=r&&q<=l&&S.push(d[O]),(M===0?e<=V:r<=q)&&(T.push(R),T.push(O-1),T.push(1-M)),(M===0?i>=V:l>=q)&&(T.push(O+1),T.push(L),T.push(1-M))}return S}within(e,r,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:m}=this,x=[0,l.length-1,0],T=[],S=i*i;for(;x.length;){const M=x.pop()||0,L=x.pop()||0,R=x.pop()||0;if(L-R<=m){for(let Q=R;Q<=L;Q++)tx(d[2*Q],d[2*Q+1],e,r)<=S&&T.push(l[Q]);continue}const O=R+L>>1,V=d[2*O],q=d[2*O+1];tx(V,q,e,r)<=S&&T.push(l[O]),(M===0?e-i<=V:r-i<=q)&&(x.push(R),x.push(O-1),x.push(1-M)),(M===0?e+i>=V:r+i>=q)&&(x.push(O+1),x.push(L),x.push(1-M))}return T}}function zg(t,e,r,i,l,d){if(l-i<=r)return;const m=i+l>>1;ex(t,e,m,i,l,d),zg(t,e,r,i,m-1,1-d),zg(t,e,r,m+1,l,1-d)}function ex(t,e,r,i,l,d){for(;l>i;){if(l-i>600){const S=l-i+1,M=r-i+1,L=Math.log(S),R=.5*Math.exp(2*L/3),O=.5*Math.sqrt(L*R*(S-R)/S)*(M-S/2<0?-1:1);ex(t,e,r,Math.max(i,Math.floor(r-M*R/S+O)),Math.min(l,Math.floor(r+(S-M)*R/S+O)),d)}const m=e[2*r+d];let x=i,T=l;for(lf(t,e,i,r),e[2*l+d]>m&&lf(t,e,i,l);x<T;){for(lf(t,e,x,T),x++,T--;e[2*x+d]<m;)x++;for(;e[2*T+d]>m;)T--}e[2*i+d]===m?lf(t,e,i,T):(T++,lf(t,e,T,l)),T<=r&&(i=T+1),r<=T&&(l=T-1)}}function lf(t,e,r,i){Ng(t,r,i),Ng(e,2*r,2*i),Ng(e,2*r+1,2*i+1)}function Ng(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}function tx(t,e,r,i){const l=t-r,d=e-i;return l*l+d*d}s.ARRAY_TYPE=Ii,s.AUTH_ERR_MSG=_e,s.Aabb=Li,s.Actor=class{constructor(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Ln(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=vr()?t:U,this.scheduler=new _T}send(t,e,r,i,l=!1,d){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=d,this.callbacks[m]=r);const x=Fn(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:t,hasCallback:!!r,targetMapId:i,mustQueue:l,sourceMapId:this.mapId,data:Da(e,x)},x),{cancel:()=>{r&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(t){const e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const i=this.cancelCallbacks[r];delete this.cancelCallbacks[r],i&&i.cancel()}else if(e.mustQueue||vr()){const i=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add((()=>this.processTask(r,e)),i&&i.metadata||{type:"message"})}else this.processTask(r,e)}processTask(t,e){if(e.type==="<response>"){const r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(La(e.error)):r(null,La(e.data)))}else{const r=Fn(this.globalScope)?void 0:[],i=e.hasCallback?(d,m)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:d?Da(d):null,data:Da(m,r)},r)}:d=>{},l=La(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,l,i);else if(this.parent.getWorkerSource){const d=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,d[0],l.source)[d[1]](l,i)}else i(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=cm,s.Color=tn,s.ColorMode=Ul,s.CullFaceMode=$a,s.DEMData=km,s.DataConstantProperty=W,s.DedupedRequest=Y_,s.DepthMode=Xd,s.EXTENT=Zt,s.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const r=e.getSource().maxzoom,i=1<<r,l=Math.floor(t.x),d=Math.floor((t.x-l)*i),m=Math.floor(t.y*i),x=this.findDEMTileFor(new Cs(r,l,r,d,m));return!(!x||!x.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const i=this._source();if(!i||t.y<0||t.y>1)return e;const l=i.getSource().maxzoom,d=1<<l,m=Math.floor(t.x),x=t.x-m,T=new Cs(l,m,l,Math.floor(x*d),Math.floor(t.y*d)),S=this.findDEMTileFor(T);if(!S||!S.dem)return e;const M=S.dem,L=1<<S.tileID.canonical.z,R=(x*L-S.tileID.canonical.x)*M.dim,O=(t.y*L-S.tileID.canonical.y)*M.dim,V=Math.floor(R),q=Math.floor(O);return(r?this.exaggeration():1)*Rr(Rr(M.get(V,q),M.get(V,q+1),O-q),Rr(M.get(V+1,q),M.get(V+1,q+1),O-q),R-V)}getAtTileOffset(t,e,r){const i=1<<t.canonical.z;return this.getAtPointOrZero(new Ll(t.wrap+(t.canonical.x+e/Zt)/i,(t.canonical.y+r/Zt)/i))}getAtTileOffsetFunc(t,e,r,i){return l=>{const d=this.getAtTileOffset(t,l.x,l.y),m=i.upVector(t.canonical,l.x,l.y);return vn(m,m,d*i.upVectorScale(t.canonical,e,r).metersToTile),m}}getForTilePoints(t,e,r,i){if(this.isUsingMockSource())return!1;const l=Cm.create(this,t,i);return!!l&&(e.forEach((d=>{d[2]=this.exaggeration()*l.getElevationAt(d[0],d[1],r)})),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,i=e.tileID,l=1<<t.canonical.z-i.canonical.z;let d=t.canonical.x/l-i.canonical.x,m=t.canonical.y/l-i.canonical.y,x=0;for(let T=0;T<t.canonical.z-i.canonical.z&&!r.leaves[x];T++){d*=2,m*=2;const S=2*Math.floor(m)+Math.floor(d);x=r.childOffsets[x]+S,d%=1,m%=1}return{min:this.exaggeration()*r.minimums[x],max:this.exaggeration()*r.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=ps,s.EvaluationParameters=I,s.Event=$o,s.Evented=Ni,s.FillExtrusionBucket=Hp,s.Frustum=Ed,s.FrustumCorners=Sh,s.GLOBE_RADIUS=ca,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=ji,s.GLOBE_ZOOM_THRESHOLD_MIN=Sc,s.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const r=new ft,i=new Vt,l=[],d=t+1+2,m=e[0]+1,x=e[0]+1+(1+e.length),T=(S,M,L)=>{let R=S===d-1?S-2:S===0?S:S-1;return R+=L?24575:0,[R,M]};for(let S=0;S<d;++S)r.emplaceBack(...T(S,0,!0));for(let S=0;S<m;++S)for(let M=0;M<d;++M)r.emplaceBack(...T(M,S,(M===0||M===d-1)&&!0));for(let S=0;S<e.length;++S){const M=e[S];for(let L=0;L<d;++L)r.emplaceBack(...T(L,M,!0))}for(let S=0;S<e.length;++S){const M=i.length,L=e[S]+1+2,R=new Vt;for(let q=0;q<L-1;q++){const Q=q===L-2,oe=Q?d*(x-e.length+S-q):d;for(let pe=0;pe<d-1;pe++){const ae=q*d+pe;q===0||Q||pe===0||pe===d-2?(R.emplaceBack(ae+1,ae,ae+oe),R.emplaceBack(ae+oe,ae+oe+1,ae+1)):(i.emplaceBack(ae+1,ae,ae+oe),i.emplaceBack(ae+oe,ae+oe+1,ae+1))}}const O=zn.simpleSegment(0,M,r.length,i.length-M);for(let q=0;q<R.uint16.length;q+=3)i.emplaceBack(R.uint16[q],R.uint16[q+1],R.uint16[q+2]);const V=zn.simpleSegment(0,M,r.length,i.length-M);l.push({withoutSkirts:O,withSkirts:V})}return{vertices:r,indices:i,segments:l}}_createGrid(t){const e=this._fillGridMeshWithLods(ua,li);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Th.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Vt;for(let l=0;l<=ua;l++)e.emplaceBack(0,l+1,l+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const r=new Or,i=new Or;this._poleSegments=[];for(let l=0,d=0;l<Sc;l++){const m=360/(1<<l);r.emplaceBack(0,-ca,0,.5,0),i.emplaceBack(0,-ca,0,.5,1);for(let x=0;x<=ua;x++){const T=x/ua,S=Rr(0,m,T),[M,L,R]=$n(rm,ag,S,ca);r.emplaceBack(M,L,R,T,0),i.emplaceBack(M,L,R,T,1)}this._poleSegments.push(zn.simpleSegment(d,0,66,64)),d+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(r,wh,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(i,wh,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const r=new Sn,i=ua,l=i+1+2,d=1;this._wireframeSegments=[];for(let m=0,x=0;m<li.length;m++){const T=li[m];for(let M=d;M<T+d;M++)for(let L=d;L<i+d;L++){const R=M*l+L;r.emplaceBack(R,R+1),r.emplaceBack(R,R+l),r.emplaceBack(R,R+l+1)}const S=T*i*3;this._wireframeSegments.push(zn.simpleSegment(0,x,(T+1)*l,S)),x+=S}this._wireframeIndexBuffer=t.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},s.GlyphManager=Gd,s.ImagePosition=_g,s.KDBush=Rg,s.LivePerformanceUtils=Yh,s.LngLat=Kt,s.LngLatBounds=Na,s.LocalGlyphMode=bg,s.MAX_MERCATOR_LATITUDE=Pn,s.MercatorCoordinate=Ll,s.ONE_EM=Ri,s.OverscaledTileID=Cs,s.PerformanceMarkers=ya,s.Point=De,s.Properties=ce,s.RGBAImage=as,s.Ray=Sd,s.RequestManager=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=(function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Me,e].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Se(t))return t;const r=Ct(t);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Se(t))return t;const r=Ct(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e,r,i){if(!Se(t))return t;const l=Ct(t);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),r&&l.params.push(`language=${r}`),i&&l.params.push(`worldview=${i}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,i){const l=Ct(t);return Se(t)?(l.path=`/styles/v1${l.path}/sprite${e}${r}`,this._makeAPIURL(l,this._customAccessToken||i)):(l.path+=`${e}${r}`,mt(l))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Se(t))return t;const i=Ct(t);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&i.authority!=="raster"&&r===512?"@2x":""}${me.supported?".webp":"$1"}`),i.authority==="raster"?i.path=`/${Y.RASTER_URL_PREFIX}${i.path}`:(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path=`/${Y.TILE_URL_VERSION}${i.path}`);const l=this._customAccessToken||(function(d){for(const m of d){const x=m.match(/^access_token=(.*)$/);if(x)return x[1]}return null})(i.params)||Y.ACCESS_TOKEN;return Y.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&i.params.push(`sku=${this._skuToken}`),this._makeAPIURL(i,l)}canonicalizeTileURL(t,e){const r=Ct(t);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let i="mapbox://";r.path.match(/^\/raster\/v1\//)?i+=`raster/${r.path.replace(`/${Y.RASTER_URL_PREFIX}/`,"")}`:i+=`tiles/${r.path.replace(`/${Y.TILE_URL_VERSION}/`,"")}`;let l=r.params;return e&&(l=l.filter((d=>!d.match(/^access_token=/)))),l.length&&(i+=`?${l.join("&")}`),i}canonicalizeTileset(t,e){const r=!!e&&Se(e),i=[];for(const l of t.tiles||[])ze(l)?i.push(this.canonicalizeTileURL(l,r)):i.push(l);return i}_makeAPIURL(t,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",i=Ct(Y.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,t.protocol==="http"){const l=t.params.indexOf("secure");l>=0&&t.params.splice(l,1)}if(i.path!=="/"&&(t.path=`${i.path}${t.path}`),!Y.REQUIRE_ACCESS_TOKEN)return mt(t);if(e=e||Y.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter((l=>l.indexOf("access_token")===-1)),t.params.push(`access_token=${e||""}`),mt(t)}},s.ResourceType=Oo,s.SegmentVector=zn,s.SourceCache=Uh,s.StencilMode=Ig,s.StructArrayLayout1ui2=ns,s.StructArrayLayout2f1f2i16=Xt,s.StructArrayLayout2i4=ft,s.StructArrayLayout2ui4=Sn,s.StructArrayLayout3f12=Er,s.StructArrayLayout3ui6=Vt,s.StructArrayLayout4i8=Je,s.StructArrayLayout5f20=Or,s.Texture=of,s.Tile=Mg,s.Transitionable=$,s.Uniform1f=gh,s.Uniform1i=class extends sa{constructor(t){super(t),this.current=0}set(t,e,r){this.fetchUniformLocation(t,e)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},s.Uniform2f=class extends sa{constructor(t){super(t),this.current=[0,0]}set(t,e,r){this.fetchUniformLocation(t,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}},s.Uniform3f=class extends sa{constructor(t){super(t),this.current=[0,0,0]}set(t,e,r){this.fetchUniformLocation(t,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}},s.Uniform4f=xp,s.UniformColor=vp,s.UniformMatrix2f=class extends sa{constructor(t){super(t),this.current=$f}set(t,e,r){if(this.fetchUniformLocation(t,e)){for(let i=0;i<4;i++)if(r[i]!==this.current[i]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}},s.UniformMatrix3f=class extends sa{constructor(t){super(t),this.current=Vf}set(t,e,r){if(this.fetchUniformLocation(t,e)){for(let i=0;i<9;i++)if(r[i]!==this.current[i]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},s.UniformMatrix4f=class extends sa{constructor(t){super(t),this.current=Uf}set(t,e,r){if(this.fetchUniformLocation(t,e)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let i=1;i<16;i++)if(r[i]!==this.current[i]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}},s.UnwrappedTileID=V0,s.ValidationError=It,s.VectorTileFeature=or,s.VectorTileWorkerSource=class extends Ni{constructor(t,e,r,i,l){super(),this.actor=t,this.layerIndex=e,this.availableImages=r,this.loadVectorData=l||J_,this.loading={},this.loaded={},this.deduped=new Y_(t.scheduler),this.isSpriteLoaded=i,this.scheduler=t.scheduler}loadTile(t,e){const r=t.uid,i=t&&t.request,l=i&&i.collectResourceTiming,d=this.loading[r]=new ET(t);d.abort=this.loadVectorData(t,((m,x)=>{const T=!this.loading[r];if(delete this.loading[r],T||m||!x)return d.status="done",T||(this.loaded[r]=d),e(m);const S=x.rawData,M={};x.expires&&(M.expires=x.expires),x.cacheControl&&(M.cacheControl=x.cacheControl),d.vectorTile=x.vectorTile||new Qt(new pm(S));const L=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,((R,O)=>{if(R||!O)return e(R);const V={};if(l){const q=Ou(i);q.length>0&&(V.resourceTiming=JSON.parse(JSON.stringify(q)))}e(null,Ot({rawTileData:S.slice(0)},O,M,V))}))};this.isSpriteLoaded?L():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(L,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):L()})),this.loaded=this.loaded||{},this.loaded[r]=d}))}reloadTile(t,e){const r=this.loaded,i=t.uid,l=this;if(r&&r[i]){const d=r[i];d.showCollisionBoxes=t.showCollisionBoxes,d.enableTerrain=!!t.enableTerrain,d.projection=t.projection,d.tileTransform=Oh(t.tileID.canonical,t.projection);const m=(x,T)=>{const S=d.reloadCallback;S&&(delete d.reloadCallback,d.parse(d.vectorTile,l.layerIndex,this.availableImages,l.actor,S)),e(x,T)};d.status==="parsing"?d.reloadCallback=m:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(t,e){const r=t.uid,i=this.loading[r];i&&(i.abort&&i.abort(),delete this.loading[r]),e()}removeTile(t,e){const r=this.loaded,i=t.uid;r&&r[i]&&delete r[i],e()}},s.WritingMode=zo,s.ZoomDependentExpression=Jo,s.add=aa,s.addDynamicAttributes=Tm,s.adjoint=function(t,e){var r=e[0],i=e[1],l=e[2],d=e[3],m=e[4],x=e[5],T=e[6],S=e[7],M=e[8];return t[0]=m*M-x*S,t[1]=l*S-i*M,t[2]=i*x-l*m,t[3]=x*T-d*M,t[4]=r*M-l*T,t[5]=l*d-r*x,t[6]=d*S-m*T,t[7]=i*T-r*S,t[8]=r*m-i*d,t},s.asyncAll=st,s.bezier=cr,s.bindAll=Ln,s.boundsAttributes=j_,s.bufferConvexPolygon=function(t,e){const r=[];for(let i=0;i<t.length;i++){const l=Te(i-1,-1,t.length-1),d=Te(i+1,-1,t.length-1),m=t[i],x=t[d],T=t[l].sub(m).unit(),S=x.sub(m).unit(),M=S.angleWithSep(T.x,T.y),L=T.add(S).unit().mult(-1*e/Math.sin(M/2));r.push(m.add(L))}return r},s.cacheEntryPossiblyAdded=function(t){Ka++,Ka>Ha&&(t.getActor().send("enforceCacheSizeLimit",On),Ka=0)},s.calculateGlobeLabelMatrix=function(t,e){const{x:r,y:i}=t.point,l=Do(r,i,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Ba(l,l,kd($s(e)))},s.calculateGlobeMatrix=function(t){const{x:e,y:r}=t.point,{lng:i,lat:l}=t._center;return Do(e,r,t.worldSize,i,l)},s.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,r=e/Nn(1,t.center.lat),i=Io(new Float64Array(16));return Ml(i,i,[t.point.x,t.point.y,0]),Pl(i,i,[r,r,e]),Float32Array.from(i)},s.circumferenceAtLatitude=ci,s.clamp=Fe,s.clearTileCache=function(t){if(!go())return;const e=U.caches.delete(Zn);t&&e.catch(t).then((()=>t()))},s.clipLine=g_,s.clone=function(t){var e=new Ii(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},s.clone$1=di,s.collisionCircleLayout=Tw,s.config=Y,s.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},s.create=function(){var t=new Ii(16);return Ii!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},s.create$1=Hf,s.createExpression=en,s.createLayout=Ce,s.createStyleLayer=function(t){return t.type==="custom"?new fT(t):new gT[t.type](t)},s.cross=xd,s.degToRad=vt,s.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},s.div=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},s.dot=Us,s.earthRadius=Dl,s.ease=St,s.easeCubicInOut=ir,s.ecefToLatLng=function([t,e,r]){const i=Math.hypot(t,e,r),l=Math.atan2(t,r),d=.5*Math.PI-Math.acos(-e/i);return new Kt(nr(l),nr(d))},s.emitValidationErrors=Pi,s.endsWith=Hi,s.enforceCacheSizeLimit=function(t){Is(),Ai&&Ai.then((e=>{e.keys().then((r=>{for(let i=0;i<r.length-t;i++)e.delete(r[i])}))}))},s.evaluateSizeForFeature=hm,s.evaluateSizeForZoom=Od,s.evaluateVariableOffset=b_,s.evented=y,s.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},s.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},s.exported=Hs,s.exported$1=me,s.extend=Ot,s.extend$1=Xn,s.fillExtrusionHeightLift=F0,s.filterObject=us,s.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},s.fromQuat=function(t,e){var r=e[0],i=e[1],l=e[2],d=e[3],m=r+r,x=i+i,T=l+l,S=r*m,M=i*m,L=i*x,R=l*m,O=l*x,V=l*T,q=d*m,Q=d*x,oe=d*T;return t[0]=1-L-V,t[1]=M+oe,t[2]=R-Q,t[3]=0,t[4]=M-oe,t[5]=1-S-V,t[6]=O+q,t[7]=0,t[8]=R+Q,t[9]=O-q,t[10]=1-S-L,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},s.fromRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},s.fromScaling=yd,s.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return Jr[e]},s.getAABBPointSquareDist=function(t,e,r){let i=0;for(let l=0;l<2;++l){const d=r?r[l]:0;t[l]>d&&(i+=(t[l]-d)*(t[l]-d)),e[l]<d&&(i+=(d-e[l])*(d-e[l]))}return i},s.getAnchorAlignment=vg,s.getAnchorJustification=Tg,s.getBounds=function(t){let e=1/0,r=1/0,i=-1/0,l=-1/0;for(const d of t)e=Math.min(e,d.x),r=Math.min(r,d.y),i=Math.max(i,d.x),l=Math.max(l,d.y);return{min:new De(e,r),max:new De(i,l)}},s.getColumn=Ci,s.getDefaultExportFromCjs=lt,s.getGridMatrix=function(t,e,r,i){const l=e.getNorth(),d=e.getSouth(),m=e.getWest(),x=e.getEast(),T=1<<t.z,S=x-m,M=l-d,L=S/ua,R=-M/li[r],O=[0,L,0,R,0,0,l,m,0];if(t.z>0){const V=180/i;Xf(O,O,[V/S+1,0,0,0,V/M+1,0,-.5*V/L,.5*V/R,1])}return O[2]=T,O[5]=t.x,O[8]=t.y,O},s.getImage=ue,s.getJSON=function(t,e){return _o(Ot(t,{type:"json"}),e)},s.getLatitudinalLod=function(t){const e=Pn-5;t=Fe(t,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(vt(t))),3);return Math.round(r*(li.length-1))},s.getMapSessionAPI=Hn,s.getPerformanceMeasurement=Ou,s.getProjection=M_,s.getRTLTextPluginStatus=b,s.getReferrer=yo,s.getTilePoint=function(t,{x:e,y:r},i=0){return new De(((e-i)*t.scale-t.x)*Zt,(r*t.scale-t.y)*Zt)},s.getTileVec3=function(t,e,r=0){return Tc(((e.x-r)*t.scale-t.x)*Zt,(e.y*t.scale-t.y)*Zt,vu(e.z,e.y))},s.getVideo=function(t,e){const r=U.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let i=0;i<t.length;i++){const l=U.document.createElement("source");Ya(t[i])||(r.crossOrigin="Anonymous"),l.src=t[i],r.appendChild(l)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(t){const e=[0,0,0],r=Io(new Float64Array(16));return Ba(r,t.pixelMatrix,t.globeMatrix),kn(e,e,r),new De(e[0],e[1])},s.globeDenormalizeECEF=kd,s.globeECEFOrigin=function(t,e){const r=[0,0,0];return kn(r,r,is($s(e.canonical))),kn(r,r,t),r},s.globeMetersToEcef=yu,s.globeNormalizeECEF=is,s.globePixelsToTileUnits=function(t,e){return Zt/(512*Math.pow(2,t))*kh($s(e))},s.globePoleMatrixForTile=function(t,e,r){const i=Io(new Float64Array(16)),l=(e/(1<<t)-.5)*Math.PI*2;return _h(i,r.globeMatrix,l),Float32Array.from(i)},s.globeTileBounds=$s,s.globeTiltAtLngLat=Dp,s.globeToMercatorTransition=xu,s.globeUseCustomAntiAliasing=function(t,e,r){const i=xu(r.zoom),l=t.style.map._antialias,d=!!e.extStandardDerivatives,m=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return i===0&&!l&&!m&&d},s.identity=Io,s.identity$1=bh,s.invert=Os,s.isFullscreen=function(){return!!U.document.fullscreenElement||!!U.document.webkitFullscreenElement},s.isLngLatBehindGlobe=Cd,s.isMapAuthenticated=function(t){return Mi.has(t)},s.isMapboxURL=Se,s.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Fn(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=qr,s.latLngToECEF=Wi,s.len=Jf,s.length=pu,s.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},s.lngFromMercatorX=bi,s.loadVectorTile=J_,s.makeRequest=_o,s.mapValue=function(t,e,r,i,l){return Fe((t-e)/(r-e)*(l-i)+i,i,l)},s.mercatorScale=Ch,s.mercatorXfromLng=cn,s.mercatorYfromLat=wn,s.mercatorZfromAltitude=Nn,s.mul=Sp,s.mul$1=Yf,s.multiply=Ba,s.multiply$1=Xf,s.multiply$2=Ep,s.nextPowerOfTwo=jr,s.normalize=Di,s.normalize$1=Cp,s.normalize$2=wd,s.number=Rr,s.ortho=function(t,e,r,i,l,d,m){var x=1/(e-r),T=1/(i-l),S=1/(d-m);return t[0]=-2*x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*T,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*S,t[11]=0,t[12]=(e+r)*x,t[13]=(l+i)*T,t[14]=(m+d)*S,t[15]=1,t},s.pbf=X0,s.perspective=function(t,e,r,i,l){var d,m=1/Math.tan(e/2);return t[0]=m/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=(l+i)*(d=1/(i-l)),t[14]=2*l*i*d):(t[10]=-1,t[14]=-2*i),t},s.pick=function(t,e){const r={};for(let i=0;i<e.length;i++){const l=e[i];l in t&&(r[l]=t[l])}return r},s.plugin=A,s.pointGeometry=tt,s.polesInViewport=function(t){const e=Io(new Float64Array(16));Ba(e,t.pixelMatrix,t.globeMatrix);const r=[0,so,0],i=[0,Bt,0];return kn(r,r,e),kn(i,i,e),[r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!Cd(t,new Kt(t.center.lat,90)),i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Cd(t,new Kt(t.center.lat,-90))]},s.polygonContainsPoint=Oa,s.polygonIntersectsBox=nm,s.polygonIntersectsPolygon=Md,s.polygonizeBounds=function(t,e,r=0,i=!0){const l=new De(r,r),d=t.sub(l),m=e.add(l),x=[d,new De(m.x,d.y),m,new De(d.x,m.y)];return i&&x.push(d.clone()),x},s.posAttributes=Th,s.postMapLoadEvent=jn,s.postPerformanceEvent=fn,s.postTurnstileEvent=Pr,s.potpack=yg,s.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},s.radToDeg=nr,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(t){return t({pluginStatus:h,pluginURL:n}),y.on("pluginStateChange",t),t},s.removeAuthState=function(t){Mi.delete(t)},s.renderColorRamp=Up,s.resample=ss,s.rotateX=gd,s.rotateX$1=Qf,s.rotateY=_h,s.rotateY$1=kp,s.rotateZ=function(t,e,r){var i=Math.sin(r),l=Math.cos(r),d=e[0],m=e[1],x=e[2],T=e[3],S=e[4],M=e[5],L=e[6],R=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*l+S*i,t[1]=m*l+M*i,t[2]=x*l+L*i,t[3]=T*l+R*i,t[4]=S*l-d*i,t[5]=M*l-m*i,t[6]=L*l-x*i,t[7]=R*l-T*i,t},s.rotateZ$1=function(t,e,r){r*=.5;var i=e[0],l=e[1],d=e[2],m=e[3],x=Math.sin(r),T=Math.cos(r);return t[0]=i*T+l*x,t[1]=l*T-i*x,t[2]=d*T+m*x,t[3]=m*T-d*x,t},s.scale=Pl,s.scale$1=bd,s.scale$2=vn,s.scaleAndAdd=fu,s.set=function(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t},s.setCacheLimits=function(t,e){On=t,Ha=e},s.setColumn=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},s.setRTLTextPlugin=function(t,e,r=!1){if(h===Bs||h===Mo||h===uu)throw new Error("setRTLTextPlugin cannot be called multiple times.");n=Hs.resolveURL(t),h=Bs,na=e,f(),r||C()},s.smoothstep=_t,s.spec=rt,s.squaredLength=function(t){var e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i},s.storeAuthState=function(t,e){e?Mi.add(t):Mi.delete(t)},s.sub=Vs,s.subtract=_d,s.symbolSize=Sw,s.tileAABB=function(t,e,r,i,l,d,m,x,T){if(T.name==="globe")return tm(t,e,new cm(r,i,l));const S=Oh({z:r,x:i,y:l},T);return new Li([(d+S.x/S.scale)*e,e*(S.y/S.scale),m],[(d+S.x2/S.scale)*e,e*(S.y2/S.scale),x])},s.tileCornersToBounds=_u,s.tileTransform=Oh,s.transformMat3=function(t,e,r){var i=e[0],l=e[1],d=e[2];return t[0]=i*r[0]+l*r[3]+d*r[6],t[1]=i*r[1]+l*r[4]+d*r[7],t[2]=i*r[2]+l*r[5]+d*r[8],t},s.transformMat4=kn,s.transformMat4$1=Il,s.transformQuat=vd,s.transitionTileAABBinECEF=Mp,s.translate=Ml,s.transpose=function(t,e){if(t===e){var r=e[1],i=e[2],l=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=l}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},s.triggerPluginCompletionEvent=a,s.uniqueId=sr,s.updateGlobeVertexNormal=function(t,e,r,i,l){const d=5*e+2;t.float32[d+0]=r,t.float32[d+1]=i,t.float32[d+2]=l},s.validateCustomStyleLayer=function(t){const e=[],r=t.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateFilter=t=>fi(Vi(t)),s.validateFog=t=>fi(Co(t)),s.validateLayer=t=>fi(dd(t)),s.validateLight=t=>fi(lu(t)),s.validateSource=t=>fi(Pa(t)),s.validateStyle=pi,s.validateTerrain=t=>fi(ea(t)),s.values=Gt,s.vectorTile=Ke,s.version=G,s.warnOnce=nn,s.window=U,s.wrap=Te})),j(["./shared"],(function(s){function U(he){if(typeof he=="number"||typeof he=="boolean"||typeof he=="string"||he==null)return JSON.stringify(he);if(Array.isArray(he)){let H="[";for(const ue of he)H+=`${U(ue)},`;return`${H}]`}let Z="{";for(const H of Object.keys(he).sort())Z+=`${H}:${U(he[H])},`;return`${Z}}`}function G(he){let Z="";for(const H of s.refProperties)Z+=`/${U(he[H])}`;return Z}class J{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,H){for(const _e of Z)this._layerConfigs[_e.id]=_e,(this._layers[_e.id]=s.createStyleLayer(_e)).compileFilter(),this.keyCache[_e.id]&&delete this.keyCache[_e.id];for(const _e of H)delete this.keyCache[_e],delete this._layerConfigs[_e],delete this._layers[_e];this.familiesBySource={};const ue=(function(_e,Se){const ze={};for(let we=0;we<_e.length;we++){const qe=Se&&Se[_e[we].id]||G(_e[we]);Se&&(Se[_e[we].id]=qe);let xt=ze[qe];xt||(xt=ze[qe]=[]),xt.push(_e[we])}const Le=[];for(const we in ze)Le.push(ze[we]);return Le})(s.values(this._layerConfigs),this.keyCache);for(const _e of ue){const Se=_e.map((Ct=>this._layers[Ct.id])),ze=Se[0];if(ze.visibility==="none")continue;const Le=ze.source||"";let we=this.familiesBySource[Le];we||(we=this.familiesBySource[Le]={});const qe=ze.sourceLayer||"_geojsonTileLayer";let xt=we[qe];xt||(xt=we[qe]=[]),xt.push(Se)}}}class Y{loadTile(Z,H){const{uid:ue,encoding:_e,rawImageData:Se,padding:ze,buildQuadTree:Le}=Z,we=s.window.ImageBitmap&&Se instanceof s.window.ImageBitmap?this.getImageData(Se,ze):Se;H(null,new s.DEMData(ue,we,_e,ze<1,Le))}getImageData(Z,H){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const ue=this.offscreenCanvasContext.getImageData(-H,-H,Z.width+2*H,Z.height+2*H);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ue}}function me(he,Z){if(he.length!==0){Ae(he[0],Z);for(var H=1;H<he.length;H++)Ae(he[H],!Z)}}function Ae(he,Z){for(var H=0,ue=0,_e=0,Se=he.length,ze=Se-1;_e<Se;ze=_e++){var Le=(he[_e][0]-he[ze][0])*(he[ze][1]+he[_e][1]),we=H+Le;ue+=Math.abs(H)>=Math.abs(Le)?H-we+Le:Le-we+H,H=we}H+ue>=0!=!!Z&&he.reverse()}var Ee=s.getDefaultExportFromCjs((function he(Z,H){var ue,_e=Z&&Z.type;if(_e==="FeatureCollection")for(ue=0;ue<Z.features.length;ue++)he(Z.features[ue],H);else if(_e==="GeometryCollection")for(ue=0;ue<Z.geometries.length;ue++)he(Z.geometries[ue],H);else if(_e==="Feature")he(Z.geometry,H);else if(_e==="Polygon")me(Z.coordinates,H);else if(_e==="MultiPolygon")for(ue=0;ue<Z.coordinates.length;ue++)me(Z.coordinates[ue],H);return Z}));const Re=s.VectorTileFeature.prototype.toGeoJSON;var Ue={exports:{}},He=s.pointGeometry,Me=s.vectorTile.VectorTileFeature,lt=kt;function kt(he,Z){this.options=Z||{},this.features=he,this.length=he.length}function $e(he,Z){this.id=typeof he.id=="number"?he.id:void 0,this.type=he.type,this.rawGeometry=he.type===1?[he.geometry]:he.geometry,this.properties=he.tags,this.extent=Z||4096}kt.prototype.feature=function(he){return new $e(this.features[he],this.options.extent)},$e.prototype.loadGeometry=function(){var he=this.rawGeometry;this.geometry=[];for(var Z=0;Z<he.length;Z++){for(var H=he[Z],ue=[],_e=0;_e<H.length;_e++)ue.push(new He(H[_e][0],H[_e][1]));this.geometry.push(ue)}return this.geometry},$e.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var he=this.geometry,Z=1/0,H=-1/0,ue=1/0,_e=-1/0,Se=0;Se<he.length;Se++)for(var ze=he[Se],Le=0;Le<ze.length;Le++){var we=ze[Le];Z=Math.min(Z,we.x),H=Math.max(H,we.x),ue=Math.min(ue,we.y),_e=Math.max(_e,we.y)}return[Z,ue,H,_e]},$e.prototype.toGeoJSON=Me.prototype.toGeoJSON;var Ye=s.pbf,tt=lt;function it(he){var Z=new Ye;return(function(H,ue){for(var _e in H.layers)ue.writeMessage(3,De,H.layers[_e])})(he,Z),Z.finish()}function De(he,Z){var H;Z.writeVarintField(15,he.version||1),Z.writeStringField(1,he.name||""),Z.writeVarintField(5,he.extent||4096);var ue={keys:[],values:[],keycache:{},valuecache:{}};for(H=0;H<he.length;H++)ue.feature=he.feature(H),Z.writeMessage(2,$t,ue);var _e=ue.keys;for(H=0;H<_e.length;H++)Z.writeStringField(3,_e[H]);var Se=ue.values;for(H=0;H<Se.length;H++)Z.writeMessage(4,ir,Se[H])}function $t(he,Z){var H=he.feature;H.id!==void 0&&Z.writeVarintField(1,H.id),Z.writeMessage(2,ut,he),Z.writeVarintField(3,H.type),Z.writeMessage(4,Jr,H)}function ut(he,Z){var H=he.feature,ue=he.keys,_e=he.values,Se=he.keycache,ze=he.valuecache;for(var Le in H.properties){var we=H.properties[Le],qe=Se[Le];if(we!==null){qe===void 0&&(ue.push(Le),Se[Le]=qe=ue.length-1),Z.writeVarint(qe);var xt=typeof we;xt!=="string"&&xt!=="boolean"&&xt!=="number"&&(we=JSON.stringify(we));var Ct=xt+":"+we,mt=ze[Ct];mt===void 0&&(_e.push(we),ze[Ct]=mt=_e.length-1),Z.writeVarint(mt)}}}function vt(he,Z){return(Z<<3)+(7&he)}function nr(he){return he<<1^he>>31}function Jr(he,Z){for(var H=he.loadGeometry(),ue=he.type,_e=0,Se=0,ze=H.length,Le=0;Le<ze;Le++){var we=H[Le],qe=1;ue===1&&(qe=we.length),Z.writeVarint(vt(1,qe));for(var xt=ue===3?we.length-1:we.length,Ct=0;Ct<xt;Ct++){Ct===1&&ue!==1&&Z.writeVarint(vt(2,xt-1));var mt=we[Ct].x-_e,hr=we[Ct].y-Se;Z.writeVarint(nr(mt)),Z.writeVarint(nr(hr)),_e+=mt,Se+=hr}ue===3&&Z.writeVarint(vt(7,1))}}function ir(he,Z){var H=typeof he;H==="string"?Z.writeStringField(1,he):H==="boolean"?Z.writeBooleanField(7,he):H==="number"&&(he%1!=0?Z.writeDoubleField(3,he):he<0?Z.writeSVarintField(6,he):Z.writeVarintField(5,he))}Ue.exports=it,Ue.exports.fromVectorTileJs=it,Ue.exports.fromGeojsonVt=function(he,Z){Z=Z||{};var H={};for(var ue in he)H[ue]=new tt(he[ue].features,Z),H[ue].name=ue,H[ue].version=Z.version,H[ue].extent=Z.extent;return it({layers:H})},Ue.exports.GeoJSONWrapper=tt;var cr=s.getDefaultExportFromCjs(Ue.exports);const St={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:he=>he},Fe=Math.fround||(_t=new Float32Array(1),he=>(_t[0]=+he,_t[0]));var _t;const Te=3,st=5,Gt=6;class Ot{constructor(Z){this.options=Object.assign(Object.create(St),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:H,minZoom:ue,maxZoom:_e}=this.options;H&&console.time("total time");const Se=`prepare ${Z.length} points`;H&&console.time(Se),this.points=Z;const ze=[];for(let we=0;we<Z.length;we++){const qe=Z[we];if(!qe.geometry)continue;const[xt,Ct]=qe.geometry.coordinates,mt=Fe(Ur(xt)),hr=Fe(jr(Ct));ze.push(mt,hr,1/0,we,-1,1),this.options.reduce&&ze.push(0)}let Le=this.trees[_e+1]=this._createTree(ze);H&&console.timeEnd(Se);for(let we=_e;we>=ue;we--){const qe=+Date.now();Le=this.trees[we]=this._createTree(this._cluster(Le,we)),H&&console.log("z%d: %d clusters in %dms",we,Le.numItems,+Date.now()-qe)}return H&&console.timeEnd("total time"),this}getClusters(Z,H){let ue=((Z[0]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,Z[1]));let Se=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ue=-180,Se=180;else if(ue>Se){const Ct=this.getClusters([ue,_e,180,ze],H),mt=this.getClusters([-180,_e,Se,ze],H);return Ct.concat(mt)}const Le=this.trees[this._limitZoom(H)],we=Le.range(Ur(ue),jr(ze),Ur(Se),jr(_e)),qe=Le.data,xt=[];for(const Ct of we){const mt=this.stride*Ct;xt.push(qe[mt+st]>1?xr(qe,mt,this.clusterProps):this.points[qe[mt+Te]])}return xt}getChildren(Z){const H=this._getOriginId(Z),ue=this._getOriginZoom(Z),_e="No cluster with the specified id.",Se=this.trees[ue];if(!Se)throw new Error(_e);const ze=Se.data;if(H*this.stride>=ze.length)throw new Error(_e);const Le=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),we=Se.within(ze[H*this.stride],ze[H*this.stride+1],Le),qe=[];for(const xt of we){const Ct=xt*this.stride;ze[Ct+4]===Z&&qe.push(ze[Ct+st]>1?xr(ze,Ct,this.clusterProps):this.points[ze[Ct+Te]])}if(qe.length===0)throw new Error(_e);return qe}getLeaves(Z,H,ue){const _e=[];return this._appendLeaves(_e,Z,H=H||10,ue=ue||0,0),_e}getTile(Z,H,ue){const _e=this.trees[this._limitZoom(Z)],Se=Math.pow(2,Z),{extent:ze,radius:Le}=this.options,we=Le/ze,qe=(ue-we)/Se,xt=(ue+1+we)/Se,Ct={features:[]};return this._addTileFeatures(_e.range((H-we)/Se,qe,(H+1+we)/Se,xt),_e.data,H,ue,Se,Ct),H===0&&this._addTileFeatures(_e.range(1-we/Se,qe,1,xt),_e.data,Se,ue,Se,Ct),H===Se-1&&this._addTileFeatures(_e.range(0,qe,we/Se,xt),_e.data,-1,ue,Se,Ct),Ct.features.length?Ct:null}getClusterExpansionZoom(Z){let H=this._getOriginZoom(Z)-1;for(;H<=this.options.maxZoom;){const ue=this.getChildren(Z);if(H++,ue.length!==1)break;Z=ue[0].properties.cluster_id}return H}_appendLeaves(Z,H,ue,_e,Se){const ze=this.getChildren(H);for(const Le of ze){const we=Le.properties;if(we&&we.cluster?Se+we.point_count<=_e?Se+=we.point_count:Se=this._appendLeaves(Z,we.cluster_id,ue,_e,Se):Se<_e?Se++:Z.push(Le),Z.length===ue)break}return Se}_createTree(Z){const H=new s.KDBush(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ue=0;ue<Z.length;ue+=this.stride)H.add(Z[ue],Z[ue+1]);return H.finish(),H.data=Z,H}_addTileFeatures(Z,H,ue,_e,Se,ze){for(const Le of Z){const we=Le*this.stride,qe=H[we+st]>1;let xt,Ct,mt;if(qe)xt=sr(H,we,this.clusterProps),Ct=H[we],mt=H[we+1];else{const ur=this.points[H[we+Te]];xt=ur.properties;const[fr,Pr]=ur.geometry.coordinates;Ct=Ur(fr),mt=jr(Pr)}const hr={type:1,geometry:[[Math.round(this.options.extent*(Ct*Se-ue)),Math.round(this.options.extent*(mt*Se-_e))]],tags:xt};let dr;dr=qe||this.options.generateId?H[we+Te]:this.points[H[we+Te]].id,dr!==void 0&&(hr.id=dr),ze.features.push(hr)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,H){const{radius:ue,extent:_e,reduce:Se,minPoints:ze}=this.options,Le=ue/(_e*Math.pow(2,H)),we=Z.data,qe=[],xt=this.stride;for(let Ct=0;Ct<we.length;Ct+=xt){if(we[Ct+2]<=H)continue;we[Ct+2]=H;const mt=we[Ct],hr=we[Ct+1],dr=Z.within(we[Ct],we[Ct+1],Le),ur=we[Ct+st];let fr=ur;for(const Pr of dr){const _n=Pr*xt;we[_n+2]>H&&(fr+=we[_n+st])}if(fr>ur&&fr>=ze){let Pr,_n=mt*ur,jn=hr*ur,_i=-1;const fn=((Ct/xt|0)<<5)+(H+1)+this.points.length;for(const Ds of dr){const Hn=Ds*xt;if(we[Hn+2]<=H)continue;we[Hn+2]=H;const Mi=we[Hn+st];_n+=we[Hn]*Mi,jn+=we[Hn+1]*Mi,we[Hn+4]=fn,Se&&(Pr||(Pr=this._map(we,Ct,!0),_i=this.clusterProps.length,this.clusterProps.push(Pr)),Se(Pr,this._map(we,Hn)))}we[Ct+4]=fn,qe.push(_n/fr,jn/fr,1/0,fn,-1,fr),Se&&qe.push(_i)}else{for(let Pr=0;Pr<xt;Pr++)qe.push(we[Ct+Pr]);if(fr>1)for(const Pr of dr){const _n=Pr*xt;if(!(we[_n+2]<=H)){we[_n+2]=H;for(let jn=0;jn<xt;jn++)qe.push(we[_n+jn])}}}}return qe}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,H,ue){if(Z[H+st]>1){const ze=this.clusterProps[Z[H+Gt]];return ue?Object.assign({},ze):ze}const _e=this.points[Z[H+Te]].properties,Se=this.options.map(_e);return ue&&Se===_e?Object.assign({},Se):Se}}function xr(he,Z,H){return{type:"Feature",id:he[Z+Te],properties:sr(he,Z,H),geometry:{type:"Point",coordinates:[(ue=he[Z],360*(ue-.5)),Qr(he[Z+1])]}};var ue}function sr(he,Z,H){const ue=he[Z+st],_e=ue>=1e4?`${Math.round(ue/1e3)}k`:ue>=1e3?Math.round(ue/100)/10+"k":ue,Se=he[Z+Gt],ze=Se===-1?{}:Object.assign({},H[Se]);return Object.assign(ze,{cluster:!0,cluster_id:he[Z+Te],point_count:ue,point_count_abbreviated:_e})}function Ur(he){return he/360+.5}function jr(he){const Z=Math.sin(he*Math.PI/180),H=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return H<0?0:H>1?1:H}function Qr(he){const Z=(180-360*he)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function Ln(he,Z,H,ue){for(var _e,Se=ue,ze=H-Z>>1,Le=H-Z,we=he[Z],qe=he[Z+1],xt=he[H],Ct=he[H+1],mt=Z+3;mt<H;mt+=3){var hr=Hi(he[mt],he[mt+1],we,qe,xt,Ct);if(hr>Se)_e=mt,Se=hr;else if(hr===Se){var dr=Math.abs(mt-ze);dr<Le&&(_e=mt,Le=dr)}}Se>ue&&(_e-Z>3&&Ln(he,Z,_e,ue),he[_e+2]=Se,H-_e>3&&Ln(he,_e,H,ue))}function Hi(he,Z,H,ue,_e,Se){var ze=_e-H,Le=Se-ue;if(ze!==0||Le!==0){var we=((he-H)*ze+(Z-ue)*Le)/(ze*ze+Le*Le);we>1?(H=_e,ue=Se):we>0&&(H+=ze*we,ue+=Le*we)}return(ze=he-H)*ze+(Le=Z-ue)*Le}function Cr(he,Z,H,ue){var _e={id:he===void 0?null:he,type:Z,geometry:H,tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return(function(Se){var ze=Se.geometry,Le=Se.type;if(Le==="Point"||Le==="MultiPoint"||Le==="LineString")us(Se,ze);else if(Le==="Polygon"||Le==="MultiLineString")for(var we=0;we<ze.length;we++)us(Se,ze[we]);else if(Le==="MultiPolygon")for(we=0;we<ze.length;we++)for(var qe=0;qe<ze[we].length;qe++)us(Se,ze[we][qe])})(_e),_e}function us(he,Z){for(var H=0;H<Z.length;H+=3)he.minX=Math.min(he.minX,Z[H]),he.minY=Math.min(he.minY,Z[H+1]),he.maxX=Math.max(he.maxX,Z[H]),he.maxY=Math.max(he.maxY,Z[H+1])}function di(he,Z,H,ue){if(Z.geometry){var _e=Z.geometry.coordinates,Se=Z.geometry.type,ze=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2),Le=[],we=Z.id;if(H.promoteId?we=Z.properties[H.promoteId]:H.generateId&&(we=ue||0),Se==="Point")Fo(_e,Le);else if(Se==="MultiPoint")for(var qe=0;qe<_e.length;qe++)Fo(_e[qe],Le);else if(Se==="LineString")nn(_e,Le,ze,!1);else if(Se==="MultiLineString"){if(H.lineMetrics){for(qe=0;qe<_e.length;qe++)nn(_e[qe],Le=[],ze,!1),he.push(Cr(we,"LineString",Le,Z.properties));return}yi(_e,Le,ze,!1)}else if(Se==="Polygon")yi(_e,Le,ze,!0);else{if(Se!=="MultiPolygon"){if(Se==="GeometryCollection"){for(qe=0;qe<Z.geometry.geometries.length;qe++)di(he,{id:we,geometry:Z.geometry.geometries[qe],properties:Z.properties},H,ue);return}throw new Error("Input data is not a valid GeoJSON object.")}for(qe=0;qe<_e.length;qe++){var xt=[];yi(_e[qe],xt,ze,!0),Le.push(xt)}}he.push(Cr(we,Se,Le,Z.properties))}}function Fo(he,Z){Z.push(Mt(he[0])),Z.push(vr(he[1])),Z.push(0)}function nn(he,Z,H,ue){for(var _e,Se,ze=0,Le=0;Le<he.length;Le++){var we=Mt(he[Le][0]),qe=vr(he[Le][1]);Z.push(we),Z.push(qe),Z.push(0),Le>0&&(ze+=ue?(_e*qe-we*Se)/2:Math.sqrt(Math.pow(we-_e,2)+Math.pow(qe-Se,2))),_e=we,Se=qe}var xt=Z.length-3;Z[2]=1,Ln(Z,0,xt,H),Z[xt+2]=1,Z.size=Math.abs(ze),Z.start=0,Z.end=Z.size}function yi(he,Z,H,ue){for(var _e=0;_e<he.length;_e++){var Se=[];nn(he[_e],Se,H,ue),Z.push(Se)}}function Mt(he){return he/360+.5}function vr(he){var Z=Math.sin(he*Math.PI/180),H=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return H<0?0:H>1?1:H}function Mr(he,Z,H,ue,_e,Se,ze,Le){if(ue/=Z,Se>=(H/=Z)&&ze<ue)return he;if(ze<H||Se>=ue)return null;for(var we=[],qe=0;qe<he.length;qe++){var xt=he[qe],Ct=xt.geometry,mt=xt.type,hr=_e===0?xt.minX:xt.minY,dr=_e===0?xt.maxX:xt.maxY;if(hr>=H&&dr<ue)we.push(xt);else if(!(dr<H||hr>=ue)){var ur=[];if(mt==="Point"||mt==="MultiPoint")Wt(Ct,ur,H,ue,_e);else if(mt==="LineString")Fn(Ct,ur,H,ue,_e,!1,Le.lineMetrics);else if(mt==="MultiLineString")Ci(Ct,ur,H,ue,_e,!1);else if(mt==="Polygon")Ci(Ct,ur,H,ue,_e,!0);else if(mt==="MultiPolygon")for(var fr=0;fr<Ct.length;fr++){var Pr=[];Ci(Ct[fr],Pr,H,ue,_e,!0),Pr.length&&ur.push(Pr)}if(ur.length){if(Le.lineMetrics&&mt==="LineString"){for(fr=0;fr<ur.length;fr++)we.push(Cr(xt.id,mt,ur[fr],xt.tags));continue}mt!=="LineString"&&mt!=="MultiLineString"||(ur.length===1?(mt="LineString",ur=ur[0]):mt="MultiLineString"),mt!=="Point"&&mt!=="MultiPoint"||(mt=ur.length===3?"Point":"MultiPoint"),we.push(Cr(xt.id,mt,ur,xt.tags))}}}return we.length?we:null}function Wt(he,Z,H,ue,_e){for(var Se=0;Se<he.length;Se+=3){var ze=he[Se+_e];ze>=H&&ze<=ue&&(Z.push(he[Se]),Z.push(he[Se+1]),Z.push(he[Se+2]))}}function Fn(he,Z,H,ue,_e,Se,ze){for(var Le,we,qe=hs(he),xt=_e===0?On:Ha,Ct=he.start,mt=0;mt<he.length-3;mt+=3){var hr=he[mt],dr=he[mt+1],ur=he[mt+2],fr=he[mt+3],Pr=he[mt+4],_n=_e===0?hr:dr,jn=_e===0?fr:Pr,_i=!1;ze&&(Le=Math.sqrt(Math.pow(hr-fr,2)+Math.pow(dr-Pr,2))),_n<H?jn>H&&(we=xt(qe,hr,dr,fr,Pr,H),ze&&(qe.start=Ct+Le*we)):_n>ue?jn<ue&&(we=xt(qe,hr,dr,fr,Pr,ue),ze&&(qe.start=Ct+Le*we)):Zn(qe,hr,dr,ur),jn<H&&_n>=H&&(we=xt(qe,hr,dr,fr,Pr,H),_i=!0),jn>ue&&_n<=ue&&(we=xt(qe,hr,dr,fr,Pr,ue),_i=!0),!Se&&_i&&(ze&&(qe.end=Ct+Le*we),Z.push(qe),qe=hs(he)),ze&&(Ct+=Le)}var fn=he.length-3;hr=he[fn],dr=he[fn+1],ur=he[fn+2],(_n=_e===0?hr:dr)>=H&&_n<=ue&&Zn(qe,hr,dr,ur),fn=qe.length-3,Se&&fn>=3&&(qe[fn]!==qe[0]||qe[fn+1]!==qe[1])&&Zn(qe,qe[0],qe[1],qe[2]),qe.length&&Z.push(qe)}function hs(he){var Z=[];return Z.size=he.size,Z.start=he.start,Z.end=he.end,Z}function Ci(he,Z,H,ue,_e,Se){for(var ze=0;ze<he.length;ze++)Fn(he[ze],Z,H,ue,_e,Se,!1)}function Zn(he,Z,H,ue){he.push(Z),he.push(H),he.push(ue)}function On(he,Z,H,ue,_e,Se){var ze=(Se-Z)/(ue-Z);return he.push(Se),he.push(H+(_e-H)*ze),he.push(1),ze}function Ha(he,Z,H,ue,_e,Se){var ze=(Se-H)/(_e-H);return he.push(Z+(ue-Z)*ze),he.push(Se),he.push(1),ze}function Ai(he,Z){for(var H=[],ue=0;ue<he.length;ue++){var _e,Se=he[ue],ze=Se.type;if(ze==="Point"||ze==="MultiPoint"||ze==="LineString")_e=mo(Se.geometry,Z);else if(ze==="MultiLineString"||ze==="Polygon"){_e=[];for(var Le=0;Le<Se.geometry.length;Le++)_e.push(mo(Se.geometry[Le],Z))}else if(ze==="MultiPolygon")for(_e=[],Le=0;Le<Se.geometry.length;Le++){for(var we=[],qe=0;qe<Se.geometry[Le].length;qe++)we.push(mo(Se.geometry[Le][qe],Z));_e.push(we)}H.push(Cr(Se.id,ze,_e,Se.tags))}return H}function mo(he,Z){var H=[];H.size=he.size,he.start!==void 0&&(H.start=he.start,H.end=he.end);for(var ue=0;ue<he.length;ue+=3)H.push(he[ue]+Z,he[ue+1],he[ue+2]);return H}function go(he,Z){if(he.transformed)return he;var H,ue,_e,Se=1<<he.z,ze=he.x,Le=he.y;for(H=0;H<he.features.length;H++){var we=he.features[H],qe=we.geometry,xt=we.type;if(we.geometry=[],xt===1)for(ue=0;ue<qe.length;ue+=2)we.geometry.push(Is(qe[ue],qe[ue+1],Z,Se,ze,Le));else for(ue=0;ue<qe.length;ue++){var Ct=[];for(_e=0;_e<qe[ue].length;_e+=2)Ct.push(Is(qe[ue][_e],qe[ue][_e+1],Z,Se,ze,Le));we.geometry.push(Ct)}}return he.transformed=!0,he}function Is(he,Z,H,ue,_e,Se){return[Math.round(H*(he*ue-_e)),Math.round(H*(Z*ue-Se))]}function Xa(he,Z,H,ue,_e){for(var Se=Z===_e.maxZoom?0:_e.tolerance/((1<<Z)*_e.extent),ze={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:H,y:ue,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Le=0;Le<he.length;Le++){ze.numFeatures++,Ka(ze,he[Le],Se,_e);var we=he[Le].minX,qe=he[Le].minY,xt=he[Le].maxX,Ct=he[Le].maxY;we<ze.minX&&(ze.minX=we),qe<ze.minY&&(ze.minY=qe),xt>ze.maxX&&(ze.maxX=xt),Ct>ze.maxY&&(ze.maxY=Ct)}return ze}function Ka(he,Z,H,ue){var _e=Z.geometry,Se=Z.type,ze=[];if(Se==="Point"||Se==="MultiPoint")for(var Le=0;Le<_e.length;Le+=3)ze.push(_e[Le]),ze.push(_e[Le+1]),he.numPoints++,he.numSimplified++;else if(Se==="LineString")Oo(ze,_e,he,H,!1,!1);else if(Se==="MultiLineString"||Se==="Polygon")for(Le=0;Le<_e.length;Le++)Oo(ze,_e[Le],he,H,Se==="Polygon",Le===0);else if(Se==="MultiPolygon")for(var we=0;we<_e.length;we++){var qe=_e[we];for(Le=0;Le<qe.length;Le++)Oo(ze,qe[Le],he,H,!0,Le===0)}if(ze.length){var xt=Z.tags||null;if(Se==="LineString"&&ue.lineMetrics){for(var Ct in xt={},Z.tags)xt[Ct]=Z.tags[Ct];xt.mapbox_clip_start=_e.start/_e.size,xt.mapbox_clip_end=_e.end/_e.size}var mt={geometry:ze,type:Se==="Polygon"||Se==="MultiPolygon"?3:Se==="LineString"||Se==="MultiLineString"?2:1,tags:xt};Z.id!==null&&(mt.id=Z.id),he.features.push(mt)}}function Oo(he,Z,H,ue,_e,Se){var ze=ue*ue;if(ue>0&&Z.size<(_e?ze:ue))H.numPoints+=Z.length/3;else{for(var Le=[],we=0;we<Z.length;we+=3)(ue===0||Z[we+2]>ze)&&(H.numSimplified++,Le.push(Z[we]),Le.push(Z[we+1])),H.numPoints++;_e&&(function(qe,xt){for(var Ct=0,mt=0,hr=qe.length,dr=hr-2;mt<hr;dr=mt,mt+=2)Ct+=(qe[mt]-qe[dr])*(qe[mt+1]+qe[dr+1]);if(Ct>0===xt)for(mt=0,hr=qe.length;mt<hr/2;mt+=2){var ur=qe[mt],fr=qe[mt+1];qe[mt]=qe[hr-2-mt],qe[mt+1]=qe[hr-1-mt],qe[hr-2-mt]=ur,qe[hr-1-mt]=fr}})(Le,Se),he.push(Le)}}function Uo(he,Z){var H=(Z=this.options=(function(_e,Se){for(var ze in Se)_e[ze]=Se[ze];return _e})(Object.create(this.options),Z)).debug;if(H&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");var ue=(function(_e,Se){var ze=[];if(_e.type==="FeatureCollection")for(var Le=0;Le<_e.features.length;Le++)di(ze,_e.features[Le],Se,Le);else di(ze,_e.type==="Feature"?_e:{geometry:_e},Se);return ze})(he,Z);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=(function(_e,Se){var ze=Se.buffer/Se.extent,Le=_e,we=Mr(_e,1,-1-ze,ze,0,-1,2,Se),qe=Mr(_e,1,1-ze,2+ze,0,-1,2,Se);return(we||qe)&&(Le=Mr(_e,1,-ze,1+ze,0,-1,2,Se)||[],we&&(Le=Ai(we,1).concat(Le)),qe&&(Le=Le.concat(Ai(qe,-1)))),Le})(ue,Z),ue.length&&this.splitTile(ue,0,0,0),H&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function yo(he,Z,H){return 32*((1<<he)*H+Z)+he}function _o(he,Z){const H=he.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);const ue=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!ue)return Z(null,null);const _e=new class{constructor(ze){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=ze.length,this._features=ze}feature(ze){return new class{constructor(Le){this._feature=Le,this.extent=s.EXTENT,this.type=Le.type,this.properties=Le.tags,"id"in Le&&!isNaN(Le.id)&&(this.id=parseInt(Le.id,10))}loadGeometry(){if(this._feature.type===1){const Le=[];for(const we of this._feature.geometry)Le.push([new s.Point(we[0],we[1])]);return Le}{const Le=[];for(const we of this._feature.geometry){const qe=[];for(const xt of we)qe.push(new s.Point(xt[0],xt[1]));Le.push(qe)}return Le}}toGeoJSON(Le,we,qe){return Re.call(this,Le,we,qe)}}(this._features[ze])}}(ue.features);let Se=cr(_e);Se.byteOffset===0&&Se.byteLength===Se.buffer.byteLength||(Se=new Uint8Array(Se)),Z(null,{vectorTile:_e,rawData:Se.buffer})}Uo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Uo.prototype.splitTile=function(he,Z,H,ue,_e,Se,ze){for(var Le=[he,Z,H,ue],we=this.options,qe=we.debug;Le.length;){ue=Le.pop(),H=Le.pop(),Z=Le.pop(),he=Le.pop();var xt=1<<Z,Ct=yo(Z,H,ue),mt=this.tiles[Ct];if(!mt&&(qe>1&&console.time("creation"),mt=this.tiles[Ct]=Xa(he,Z,H,ue,we),this.tileCoords.push({z:Z,x:H,y:ue}),qe)){qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,H,ue,mt.numFeatures,mt.numPoints,mt.numSimplified),console.timeEnd("creation"));var hr="z"+Z;this.stats[hr]=(this.stats[hr]||0)+1,this.total++}if(mt.source=he,_e){if(Z===we.maxZoom||Z===_e)continue;var dr=1<<_e-Z;if(H!==Math.floor(Se/dr)||ue!==Math.floor(ze/dr))continue}else if(Z===we.indexMaxZoom||mt.numPoints<=we.indexMaxPoints)continue;if(mt.source=null,he.length!==0){qe>1&&console.time("clipping");var ur,fr,Pr,_n,jn,_i,fn=.5*we.buffer/we.extent,Ds=.5-fn,Hn=.5+fn,Mi=1+fn;ur=fr=Pr=_n=null,jn=Mr(he,xt,H-fn,H+Hn,0,mt.minX,mt.maxX,we),_i=Mr(he,xt,H+Ds,H+Mi,0,mt.minX,mt.maxX,we),he=null,jn&&(ur=Mr(jn,xt,ue-fn,ue+Hn,1,mt.minY,mt.maxY,we),fr=Mr(jn,xt,ue+Ds,ue+Mi,1,mt.minY,mt.maxY,we),jn=null),_i&&(Pr=Mr(_i,xt,ue-fn,ue+Hn,1,mt.minY,mt.maxY,we),_n=Mr(_i,xt,ue+Ds,ue+Mi,1,mt.minY,mt.maxY,we),_i=null),qe>1&&console.timeEnd("clipping"),Le.push(ur||[],Z+1,2*H,2*ue),Le.push(fr||[],Z+1,2*H,2*ue+1),Le.push(Pr||[],Z+1,2*H+1,2*ue),Le.push(_n||[],Z+1,2*H+1,2*ue+1)}}},Uo.prototype.getTile=function(he,Z,H){var ue=this.options,_e=ue.extent,Se=ue.debug;if(he<0||he>24)return null;var ze=1<<he,Le=yo(he,Z=(Z%ze+ze)%ze,H);if(this.tiles[Le])return go(this.tiles[Le],_e);Se>1&&console.log("drilling down to z%d-%d-%d",he,Z,H);for(var we,qe=he,xt=Z,Ct=H;!we&&qe>0;)qe--,xt=Math.floor(xt/2),Ct=Math.floor(Ct/2),we=this.tiles[yo(qe,xt,Ct)];return we&&we.source?(Se>1&&console.log("found parent tile z%d-%d-%d",qe,xt,Ct),Se>1&&console.time("drilling down"),this.splitTile(we.source,qe,xt,Ct,he,Z,H),Se>1&&console.timeEnd("drilling down"),this.tiles[Le]?go(this.tiles[Le],_e):null):null};class Vo extends s.VectorTileWorkerSource{constructor(Z,H,ue,_e,Se){super(Z,H,ue,_e,_o),Se&&(this.loadGeoJSON=Se)}loadData(Z,H){const ue=Z&&Z.request,_e=ue&&ue.collectResourceTiming;this.loadGeoJSON(Z,((Se,ze)=>{if(Se||!ze)return H(Se);if(typeof ze!="object")return H(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{Ee(ze,!0);try{if(Z.filter){const we=s.createExpression(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(we.result==="error")throw new Error(we.value.map((xt=>`${xt.key}: ${xt.message}`)).join(", "));ze={type:"FeatureCollection",features:ze.features.filter((xt=>we.value.evaluate({zoom:0},xt)))}}this._geoJSONIndex=Z.cluster?new Ot((function({superclusterOptions:we,clusterProperties:qe}){if(!qe||!we)return we;const xt={},Ct={},mt={accumulated:null,zoom:0},hr={properties:null},dr=Object.keys(qe);for(const ur of dr){const[fr,Pr]=qe[ur],_n=s.createExpression(Pr),jn=s.createExpression(typeof fr=="string"?[fr,["accumulated"],["get",ur]]:fr);xt[ur]=_n.value,Ct[ur]=jn.value}return we.map=ur=>{hr.properties=ur;const fr={};for(const Pr of dr)fr[Pr]=xt[Pr].evaluate(mt,hr);return fr},we.reduce=(ur,fr)=>{hr.properties=fr;for(const Pr of dr)mt.accumulated=ur[Pr],ur[Pr]=Ct[Pr].evaluate(mt,hr)},we})(Z)).load(ze.features):(function(we,qe){return new Uo(we,qe)})(ze,Z.geojsonVtOptions)}catch(we){return H(we)}this.loaded={};const Le={};if(_e){const we=s.getPerformanceMeasurement(ue);we&&(Le.resourceTiming={},Le.resourceTiming[Z.source]=JSON.parse(JSON.stringify(we)))}H(null,Le)}}))}reloadTile(Z,H){const ue=this.loaded;return ue&&ue[Z.uid]?super.reloadTile(Z,H):this.loadTile(Z,H)}loadGeoJSON(Z,H){if(Z.request)s.getJSON(Z.request,H);else{if(typeof Z.data!="string")return H(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return H(null,JSON.parse(Z.data))}catch{return H(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,H){try{H(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(ue){H(ue)}}getClusterChildren(Z,H){try{H(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(ue){H(ue)}}getClusterLeaves(Z,H){try{H(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(ue){H(ue)}}}class Ya{constructor(Z){this.self=Z,this.actor=new s.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:Vo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(H,ue)=>{if(this.workerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.workerSourceTypes[H]=ue},this.self.registerRTLTextPlugin=H=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=H.applyArabicShaping,s.plugin.processBidirectionalText=H.processBidirectionalText,s.plugin.processStyledBidirectionalText=H.processStyledBidirectionalText}}clearCaches(Z,H,ue){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z],ue()}checkIfReady(Z,H,ue){ue()}setReferrer(Z,H){this.referrer=H}spriteLoaded(Z,H){this.isSpriteLoaded[Z]=H;for(const ue in this.workerSources[Z]){const _e=this.workerSources[Z][ue];for(const Se in _e)_e[Se]instanceof s.VectorTileWorkerSource&&(_e[Se].isSpriteLoaded=H,_e[Se].fire(new s.Event("isSpriteLoaded")))}}setImages(Z,H,ue){this.availableImages[Z]=H;for(const _e in this.workerSources[Z]){const Se=this.workerSources[Z][_e];for(const ze in Se)Se[ze].availableImages=H}ue()}enableTerrain(Z,H,ue){this.terrain=H,ue()}setProjection(Z,H){this.projections[Z]=s.getProjection(H)}setLayers(Z,H,ue){this.getLayerIndex(Z).replace(H),ue()}updateLayers(Z,H,ue){this.getLayerIndex(Z).update(H.layers,H.removedIds),ue()}loadTile(Z,H,ue){const _e=this.enableTerrain?s.extend({enableTerrain:this.terrain},H):H;_e.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,H.type,H.source).loadTile(_e,ue)}loadDEMTile(Z,H,ue){const _e=this.enableTerrain?s.extend({buildQuadTree:this.terrain},H):H;this.getDEMWorkerSource(Z,H.source).loadTile(_e,ue)}reloadTile(Z,H,ue){const _e=this.enableTerrain?s.extend({enableTerrain:this.terrain},H):H;_e.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,H.type,H.source).reloadTile(_e,ue)}abortTile(Z,H,ue){this.getWorkerSource(Z,H.type,H.source).abortTile(H,ue)}removeTile(Z,H,ue){this.getWorkerSource(Z,H.type,H.source).removeTile(H,ue)}removeSource(Z,H,ue){if(!this.workerSources[Z]||!this.workerSources[Z][H.type]||!this.workerSources[Z][H.type][H.source])return;const _e=this.workerSources[Z][H.type][H.source];delete this.workerSources[Z][H.type][H.source],_e.removeSource!==void 0?_e.removeSource(H,ue):ue()}loadWorkerSource(Z,H,ue){try{this.self.importScripts(H.url),ue()}catch(_e){ue(_e.toString())}}syncRTLPluginState(Z,H,ue){try{s.plugin.setState(H);const _e=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&_e!=null){this.self.importScripts(_e);const Se=s.plugin.isParsed();ue(Se?void 0:new Error(`RTL Text Plugin failed to import scripts from ${_e}`),Se)}}catch(_e){ue(_e.toString())}}getAvailableImages(Z){let H=this.availableImages[Z];return H||(H=[]),H}getLayerIndex(Z){let H=this.layerIndexes[Z];return H||(H=this.layerIndexes[Z]=new J),H}getWorkerSource(Z,H,ue){if(this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][H]||(this.workerSources[Z][H]={}),!this.workerSources[Z][H][ue]){const _e={send:(Se,ze,Le,we,qe,xt)=>{this.actor.send(Se,ze,Le,Z,qe,xt)},scheduler:this.actor.scheduler};this.workerSources[Z][H][ue]=new this.workerSourceTypes[H](_e,this.getLayerIndex(Z),this.getAvailableImages(Z),this.isSpriteLoaded[Z])}return this.workerSources[Z][H][ue]}getDEMWorkerSource(Z,H){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][H]||(this.demWorkerSources[Z][H]=new Y),this.demWorkerSources[Z][H]}enforceCacheSizeLimit(Z,H){s.enforceCacheSizeLimit(H)}getWorkerPerformanceMetrics(Z,H,ue){ue(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ya(self)),Ya})),j(["./shared"],(function(s){function U(h,n){if(Array.isArray(h)){if(!Array.isArray(n)||h.length!==n.length)return!1;for(let a=0;a<h.length;a++)if(!U(h[a],n[a]))return!1;return!0}if(typeof h=="object"&&h!==null&&n!==null){if(typeof n!="object"||Object.keys(h).length!==Object.keys(n).length)return!1;for(const a in h)if(!U(h[a],n[a]))return!1;return!0}return h===n}var G=J;function J(h){return!(function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,y,b=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(b);try{y=new Worker(C),f=!0}catch{f=!1}return y&&y.terminate(),URL.revokeObjectURL(C),f})()?"Uint8ClampedArray"in window?ArrayBuffer.isView?(function(){var f=document.createElement("canvas");f.width=f.height=1;var y=f.getContext("2d");if(!y)return!1;var b=y.getImageData(0,0,1,1);return b&&b.width===f.width})()?(Y[a=n&&n.failIfMajorPerformanceCaveat]===void 0&&(Y[a]=(function(f){var y,b=(function(C){var A=document.createElement("canvas"),I=Object.create(J.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=C,A.getContext("webgl",I)||A.getContext("experimental-webgl",I)})(f);if(!b)return!1;try{y=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!y||b.isContextLost())&&(b.shaderSource(y,"void main() {}"),b.compileShader(y),b.getShaderParameter(y,b.COMPILE_STATUS)===!0)})(a)),Y[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var a})(h)}var Y={};function me(h,n,a){const f=s.window.document.createElement(h);return n!==void 0&&(f.className=n),a&&a.appendChild(f),f}function Ae(h,n,a){const f=s.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const y of Object.keys(n))f.setAttributeNS(null,y,n[y]);return a&&a.appendChild(f),f}J.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ee=s.window.document&&s.window.document.documentElement.style,Re=Ee&&Ee.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ue;function He(){Ee&&Re&&(Ue=Ee[Re],Ee[Re]="none")}function Me(){Ee&&Re&&(Ee[Re]=Ue)}function lt(h){h.preventDefault(),h.stopPropagation(),s.window.removeEventListener("click",lt,!0)}function kt(){s.window.addEventListener("click",lt,!0),s.window.setTimeout((()=>{s.window.removeEventListener("click",lt,!0)}),0)}function $e(h,n){const a=h.getBoundingClientRect();return it(h,a,n)}function Ye(h,n){const a=h.getBoundingClientRect(),f=[];for(let y=0;y<n.length;y++)f.push(it(h,a,n[y]));return f}function tt(h){return s.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function it(h,n,a){const f=h.offsetWidth===n.width?1:h.offsetWidth/n.width;return new s.Point((a.clientX-n.left)*f,(a.clientY-n.top)*f)}function De(h,n){var a=n[0],f=n[1],y=n[2],b=n[3],C=a*b-y*f;return C?(h[0]=b*(C=1/C),h[1]=-f*C,h[2]=-y*C,h[3]=a*C,h):null}function $t(h){const{userImage:n}=h;return!!(n&&n.render&&n.render())&&(h.data.replace(new Uint8Array(n.data.buffer)),!0)}class ut extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:a,callback:f}of this.requestors)this._notify(a,f);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,a){this._validate(n,a)&&(this.images[n]=a)}_validate(n,a){let f=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),f=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),f=!1),this._validateContent(a.content,a)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),f=!1),f}_validateStretch(n,a){if(!n)return!0;let f=0;for(const y of n){if(y[0]<f||y[1]<y[0]||a<y[1])return!1;f=y[1]}return!0}_validateContent(n,a){return!(n&&(n.length!==4||n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,a){a.version=this.images[n].version+1,this.images[n]=a,this.updatedImages[n]=!0}removeImage(n){const a=this.images[n];delete this.images[n],delete this.patterns[n],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,a){let f=!0;if(!this.isLoaded())for(const y of n)this.images[y]||(f=!1);this.isLoaded()||f?this._notify(n,a):this.requestors.push({ids:n,callback:a})}_notify(n,a){const f={};for(const y of n){this.images[y]||this.fire(new s.Event("styleimagemissing",{id:y}));const b=this.images[y];b?f[y]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:s.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,f)}getPixelSize(){const{width:n,height:a}=this.atlasImage;return{width:n,height:a}}getPattern(n){const a=this.patterns[n],f=this.getImage(n);if(!f)return null;if(a&&a.position.version===f.version)return a.position;if(a)a.position.version=f.version;else{const y={w:f.data.width+2,h:f.data.height+2,x:0,y:0},b=new s.ImagePosition(y,f);this.patterns[n]={bin:y,position:b}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const a=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(n,this.atlasImage,a.RGBA),this.atlasTexture&&this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const b in this.patterns)n.push(this.patterns[b].bin);const{w:a,h:f}=s.potpack(n),y=this.atlasImage;y.resize({width:a||1,height:f||1});for(const b in this.patterns){const{bin:C}=this.patterns[b],A=C.x+1,I=C.y+1,N=this.images[b].data,z=N.width,$=N.height;s.RGBAImage.copy(N,y,{x:0,y:0},{x:A,y:I},{width:z,height:$}),s.RGBAImage.copy(N,y,{x:0,y:$-1},{x:A,y:I-1},{width:z,height:1}),s.RGBAImage.copy(N,y,{x:0,y:0},{x:A,y:I+$},{width:z,height:1}),s.RGBAImage.copy(N,y,{x:z-1,y:0},{x:A-1,y:I},{width:1,height:$}),s.RGBAImage.copy(N,y,{x:0,y:0},{x:A+z,y:I},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const a of n){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const f=this.images[a];$t(f)&&this.updateImage(a,f)}}}const vt=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(h,n){return(function([a,f,y]){const b=s.degToRad(f+90),C=s.degToRad(y);return{x:a*Math.cos(b)*Math.sin(C),y:a*Math.sin(b)*Math.sin(C),z:a*Math.cos(C),azimuthal:f,polar:y}})(h.expression.evaluate(n))}interpolate(h,n,a){return{x:s.number(h.x,n.x,a),y:s.number(h.y,n.y,a),z:s.number(h.z,n.z,a),azimuthal:s.number(h.azimuthal,n.azimuthal,a),polar:s.number(h.polar,n.polar,a)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)});class nr extends s.Evented{constructor(n){super(),this._transitionable=new s.Transitionable(vt),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a={}){if(!this._validate(s.validateLight,n,a))for(const f in n){const y=n[f];s.endsWith(f,"-transition")?this._transitionable.setTransition(f.slice(0,-11),y):this._transitionable.setValue(f,y)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,f){return(!f||f.validate!==!1)&&s.emitValidationErrors(this,n.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const Jr=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)});let ir=class extends s.Evented{constructor(h,n){super(),this._transitionable=new s.Transitionable(Jr),this.set(h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(h){for(const n in h){const a=h[n];s.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-11),a):this._transitionable.setValue(n,a)}}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}};function cr(h,n,a,f){const y=s.smoothstep(45,65,a),[b,C]=St(h,f),A=s.length(n);let I=1-Math.min(1,Math.exp((A-b)/(C-b)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*y*h.alpha}function St(h,n){const a=.5/Math.tan(.5*n);return[h.range[0]+a,h.range[1]+a]}const Fe=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])});class _t extends s.Evented{constructor(n,a){super(),this._transitionable=new s.Transitionable(Fe),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=a}get state(){const n=this._transform,a=n.projection.name==="globe",f=s.globeToMercatorTransition(n.zoom),y=this.properties.get("range"),b=[.5,3];return{range:a?[s.number(b[0],y[0],f),s.number(b[1],y[1],f)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a={}){if(!this._validate(s.validateFog,n,a)){for(const f of Object.keys(s.spec.fog))n&&n[f]===void 0&&(n[f]=s.spec.fog[f].default);for(const f in n){const y=n[f];s.endsWith(f,"-transition")?this._transitionable.setTransition(f.slice(0,-11),y):this._transitionable.setValue(f,y)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?(function(f,y,b){const C=s.MercatorCoordinate.fromLngLat(y),A=b.elevation?b.elevation.getAtPointOrZero(C):0,I=[C.x,C.y,A];return s.transformMat4(I,I,b.mercatorFogMatrix),cr(f,I,b.pitch,b._fov)})(this.state,n,a):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?St(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,f){return(!f||f.validate!==!1)&&s.emitValidationErrors(this,n.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class Te{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const f=this.workerPool.acquire(this.id);for(let y=0;y<f.length;y++){const b=new Te.Actor(f[y],a,this.id);b.name=`Worker ${y}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(n,a,f){s.asyncAll(this.actors,((y,b)=>{y.send(n,a,b)}),f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((n=>{n.remove()})),this.actors=[],this.workerPool.release(this.id)}}function st(h,n,a){return n*(s.EXTENT/(h.tileSize*Math.pow(2,a-h.tileID.overscaledZ)))}Te.Actor=s.Actor;class Gt{constructor(n,a,f,y){this.screenBounds=n,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(n,a){let f,y;if(n instanceof s.Point||typeof n[0]=="number"){const b=s.Point.convert(n);f=[b],y=a.isPointAboveHorizon(b)}else{const b=s.Point.convert(n[0]),C=s.Point.convert(n[1]);f=[b,C],y=s.polygonizeBounds(b,C).every((A=>a.isPointAboveHorizon(A)))}return new Gt(f,a.getCameraPoint(),y,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],y=s.polygonizeBounds(a,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<f.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?y[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(y[3]=this.cameraPoint)),s.bufferConvexPolygon(y,n)}bufferedCameraGeometryGlobe(n){const a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],y=s.polygonizeBounds(a,f,n),b=this.cameraPoint.clone();switch(3*((b.y>a.y)+(b.y>f.y))+((b.x>a.x)+(b.x>f.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(n,a,f,y=0){const b=n.queryPadding/a._pixelsPerMercatorPixel+1,C=f?this._bufferedCameraMercator(b,a):this._bufferedScreenMercator(b,a);let A=n.tileID.wrap+(C.unwrapped?y:0);const I=C.polygon.map((se=>s.getTilePoint(n.tileTransform,se,A)));if(!s.polygonIntersectsBox(I,0,0,s.EXTENT,s.EXTENT))return;A=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const N=this.screenGeometryMercator.polygon.map((se=>s.getTileVec3(n.tileTransform,se,A))),z=N.map((se=>new s.Point(se[0],se[1]))),$=a.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),K=s.getTileVec3(n.tileTransform,$,A),re=N.map((se=>{const W=s.sub(se,se,K);return s.normalize(W,W),new s.Ray(K,W)})),ie=st(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:re,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(ne=s.getBounds(I),ne.min.x=s.clamp(ne.min.x,0,s.EXTENT),ne.min.y=s.clamp(ne.min.y,0,s.EXTENT),ne.max.x=s.clamp(ne.max.x,0,s.EXTENT),ne.max.y=s.clamp(ne.max.y,0,s.EXTENT),ne),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:ie};var ne}_bufferedScreenMercator(n,a){const f=sr(n);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let y;return y=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map((b=>a.pointCoordinate3D(b))),unwrapped:!0},this._screenRaycastCache[f]=y,y}}_bufferedCameraMercator(n,a){const f=sr(n);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let y;return y=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map((b=>a.pointCoordinate3D(b))),unwrapped:!0},this._cameraRaycastCache[f]=y,y}}_projectAndResample(n,a){const f=(function(b,C){const A=s.multiply([],C.pixelMatrix,C.globeMatrix),I=[0,-s.GLOBE_RADIUS,0,1],N=[0,s.GLOBE_RADIUS,0,1],z=[0,0,0,1];s.transformMat4$1(I,I,A),s.transformMat4$1(N,N,A),s.transformMat4$1(z,z,A);const $=new s.Point(I[0]/I[3],I[1]/I[3]),K=new s.Point(N[0]/N[3],N[1]/N[3]),re=s.polygonContainsPoint(b,$)&&I[3]<z[3],ie=s.polygonContainsPoint(b,K)&&N[3]<z[3];if(!re&&!ie)return null;const ne=(function(ve,Pe,Ce){for(let Oe=1;Oe<ve.length;Oe++){const ft=xr(Pe.pointCoordinate3D(ve[Oe-1]).x),je=xr(Pe.pointCoordinate3D(ve[Oe]).x);if(Ce<0){if(ft<je)return{idx:Oe,t:-ft/(je-1-ft)}}else if(je<ft)return{idx:Oe,t:(1-ft)/(je+1-ft)}}return null})(b,C,re?-1:1);if(!ne)return null;const{idx:se,t:W}=ne;let te=se>1?Ot(b.slice(0,se),C):[],le=se<b.length?Ot(b.slice(se),C):[];te=te.map((ve=>new s.Point(xr(ve.x),ve.y))),le=le.map((ve=>new s.Point(xr(ve.x),ve.y)));const ce=[...te];ce.length===0&&ce.push(le[le.length-1]);const xe=s.number(ce[ce.length-1].y,(le.length===0?te[0]:le[0]).y,W);let be;return be=re?[new s.Point(0,xe),new s.Point(0,0),new s.Point(1,0),new s.Point(1,xe)]:[new s.Point(1,xe),new s.Point(1,1),new s.Point(0,1),new s.Point(0,xe)],ce.push(...be),le.length===0?ce.push(te[0]):ce.push(...le),{polygon:ce.map((ve=>new s.MercatorCoordinate(ve.x,ve.y))),unwrapped:!1}})(n,a);if(f)return f;const y=(function(b,C){let A=!1,I=-1/0,N=0;for(let $=0;$<b.length-1;$++)b[$].x>I&&(I=b[$].x,N=$);for(let $=0;$<b.length-1;$++){const K=(N+$)%(b.length-1),re=b[K],ie=b[K+1];Math.abs(re.x-ie.x)>.5&&(re.x<ie.x?(re.x+=1,K===0&&(b[b.length-1].x+=1)):(ie.x+=1,K+1===b.length-1&&(b[0].x+=1)),A=!0)}const z=s.mercatorXfromLng(C.center.lng);return A&&z<Math.abs(z-1)&&b.forEach(($=>{$.x-=1})),{polygon:b,unwrapped:A}})(Ot(n,a).map((b=>new s.Point(xr(b.x),b.y))),a);return{polygon:y.polygon.map((b=>new s.MercatorCoordinate(b.x,b.y))),unwrapped:y.unwrapped}}}function Ot(h,n){return s.resample(h,(a=>{const f=n.pointCoordinate3D(a);a.x=f.x,a.y=f.y}),1/256)}function xr(h){return h<0?1+h%1:h%1}function sr(h){return 100*h|0}function Ur(h,n,a,f,y){const b=function(C,A){if(C)return y(C);if(A){h.url&&A.tiles&&h.tiles&&delete h.tiles;const I=s.pick(s.extend(A,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(I.vectorLayers=A.vector_layers,I.vectorLayerIds=I.vectorLayers.map((N=>N.id))),I.tiles=n.canonicalizeTileset(I,h.url),y(null,I)}};return h.url?s.getJSON(n.transformRequest(n.normalizeSourceURL(h.url,null,a,f),s.ResourceType.Source),b):s.exported.frame((()=>b(null,h)))}class jr{constructor(n,a,f){this.bounds=s.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=a||0,this.maxzoom=f||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const a=Math.pow(2,n.z),f=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*a),y=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*a),b=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*a),C=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*a);return n.x>=f&&n.x<b&&n.y>=y&&n.y<C}}class Qr{constructor(n,a,f){this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ln={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Hi{constructor(n,a,f,y){this.length=a.length,this.attributes=f,this.itemSize=a.bytesPerElement,this.dynamicDraw=y,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),n.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let f=0;f<this.attributes.length;f++){const y=a.attributes[this.attributes[f].name];y!==void 0&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,a,f){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],C=a.attributes[b.name];C!==void 0&&n.vertexAttribPointer(C,b.components,n[Ln[b.type]],!1,this.itemSize,b.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Cr{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class us extends Cr{getDefault(){return s.Color.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class di extends Cr{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Fo extends Cr{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class nn extends Cr{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class yi extends Cr{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Mt extends Cr{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class vr extends Cr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Mr extends Cr{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Wt extends Cr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class Fn extends Cr{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class hs extends Cr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class Ci extends Cr{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Zn extends Cr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class On extends Cr{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Ha extends Cr{getDefault(){return s.Color.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ai extends Cr{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class mo extends Cr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class go extends Cr{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Is extends Cr{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Xa,Ka=class extends Cr{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class Oo extends Cr{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Uo extends Cr{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class yo extends Cr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class _o extends Cr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Vo extends Cr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Ya extends Cr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class he extends Cr{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Z extends Cr{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class H extends Cr{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class ue extends Cr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class _e extends Cr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Se extends Cr{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class ze extends Se{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Le extends Se{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class we extends Le{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class qe{constructor(n,a,f,y){this.context=n,this.width=a,this.height=f;const b=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new ze(n,b),y&&(this.depthAttachment=new Le(n,b))}destroy(){const n=this.context.gl,a=this.colorAttachment.get();if(a&&n.deleteTexture(a),this.depthAttachment){const f=this.depthAttachment.get();f&&n.deleteRenderbuffer(f)}n.deleteFramebuffer(this.framebuffer)}}class xt{constructor(n,a=!1){if(this.gl=n,this.isWebGL2=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),a){const f=n;this.extVertexArrayObject={createVertexArrayOES:f.createVertexArray.bind(n),deleteVertexArrayOES:f.deleteVertexArray.bind(n),bindVertexArrayOES:f.bindVertexArray.bind(n)}}this.clearColor=new us(this),this.clearDepth=new di(this),this.clearStencil=new Fo(this),this.colorMask=new nn(this),this.depthMask=new yi(this),this.stencilMask=new Mt(this),this.stencilFunc=new vr(this),this.stencilOp=new Mr(this),this.stencilTest=new Wt(this),this.depthRange=new Fn(this),this.depthTest=new hs(this),this.depthFunc=new Ci(this),this.blend=new Zn(this),this.blendFunc=new On(this),this.blendColor=new Ha(this),this.blendEquation=new Ai(this),this.cullFace=new mo(this),this.cullFaceSide=new go(this),this.frontFace=new Is(this),this.program=new Ka(this),this.activeTexture=new Oo(this),this.viewport=new Uo(this),this.bindFramebuffer=new yo(this),this.bindRenderbuffer=new _o(this),this.bindTexture=new Vo(this),this.bindVertexBuffer=new Ya(this),this.bindElementBuffer=new he(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Z(this),this.pixelStoreUnpack=new H(this),this.pixelStoreUnpackPremultiplyAlpha=new ue(this),this.pixelStoreUnpackFlipY=new _e(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),a||(this.extTextureHalfFloat=n.getExtension("OES_texture_half_float")),(a||this.extTextureHalfFloat&&n.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=a||n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a){return new Qr(this,n,a)}createVertexBuffer(n,a,f){return new Hi(this,n,a,f)}createRenderbuffer(n,a,f){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,n,a,f),this.bindRenderbuffer.set(null),b}createFramebuffer(n,a,f){return new qe(this,n,a,f)}clear({color:n,depth:a,stencil:f}){const y=this.gl;let b=0;n&&(b|=y.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(b|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),f!==void 0&&(b|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),y.clear(b)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){U(n.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ct extends s.Evented{constructor(n,a,f,y){if(super(),this.id=n,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(a,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(n){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=Ur(this._options,this.map._requestManager,a,f,((y,b)=>{this._tileJSONRequest=null,this._loaded=!0,y?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new s.ErrorEvent(y))):b&&(s.extend(this,b),b.bounds&&(this.tileBounds=new jr(b.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(b.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(y)}))}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(n,a){const f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(f,s.ResourceType.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile};if(y.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=a:n.request=n.actor.send("reloadTile",y,b.bind(this));else if(n.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",y,b.bind(this),void 0,!0);else{const C=s.loadVectorTile.call({deduped:this._deduped},y,((A,I)=>{A||!I?b.call(this,A):(y.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},n.actor&&n.actor.send("loadTile",y,b.bind(this),void 0,!0))}),!0);n.request={cancel:C}}function b(C,A){return delete n.request,n.aborted?a(null):C&&C.status!==404?a(C):(A&&A.resourceTiming&&(n.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&n.setExpiryData(A),n.loadVectorData(A,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),a(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id})}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class mt extends s.Evented{constructor(n,a,f,y){super(),this.id=n,this.dispatcher=f,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},a),s.extend(this,s.pick(a,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ur(this._options,this.map._requestManager,null,null,((a,f)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new s.ErrorEvent(a)):f&&(s.extend(this,f),f.bounds&&(this.tileBounds=new jr(f.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(f.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(a)}))}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){const f=s.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);n.request=s.getImage(this.map._requestManager.transformRequest(y,s.ResourceType.Tile),((b,C,A,I)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):b?(n.state="errored",a(b)):C?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:A,expires:I}),n.setTexture(C,this.map.painter),n.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void a(null)):a(null))))}static loadTileData(n,a,f){n.setTexture(a,f)}static unloadTileData(n,a){n.texture&&a.saveTileTexture(n.texture)}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a()}unloadTile(n,a){n.texture&&this.map.painter.saveTileTexture(n.texture),a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function hr(h,n,a,f,y,b,C,A){const I=[h,a,y,n,f,b,1,1,1],N=[C,A,1],z=s.adjoint([],I),[$,K,re]=s.transformMat3(N,N,s.transpose(z,z));return s.multiply$1(I,[$,0,0,0,K,0,0,0,re],I)}class dr extends s.Evented{constructor(n,a,f,y){super(),this.id=n,this.dispatcher=f,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=a,this._dirty=!1}load(n,a){this._loaded=a||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),((f,y)=>{if(this._imageRequest=null,this._loaded=!0,f)this.fire(new s.ErrorEvent(f));else if(y){const{HTMLImageElement:b}=s.window;this.image=y instanceof b?s.exported.getImageData(y):y,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const a=n.map(s.MercatorCoordinate.fromLngLat);return this.tileID=(function(f){let y=1/0,b=1/0,C=-1/0,A=-1/0;for(const $ of f)y=Math.min(y,$.x),b=Math.min(b,$.y),C=Math.max(C,$.x),A=Math.max(A,$.y);const I=Math.max(C-y,A-b),N=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),z=Math.pow(2,N);return new s.CanonicalTileID(N,Math.floor((y+C)/2*z),Math.floor((b+A)/2*z))})(a),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const I in this.tiles){const N=this.tiles[I];N.state!=="loaded"&&(N.state="loaded",N.texture=this.texture)}if(this._boundsArray)return;const a=s.tileTransform(this.tileID,this.map.transform.projection),[f,y,b,C]=this.coordinates.map((I=>{const N=a.projection.project(I[0],I[1]);return s.getTilePoint(a,N)._round()}));this.perspectiveTransform=(function(I,N,z,$,K,re,ie,ne,se,W){const te=hr(0,0,I,0,0,N,I,N),le=hr(z,$,K,re,ie,ne,se,W);return s.multiply$1(le,s.adjoint(te,te),le),[le[6]/le[8]*I/s.EXTENT,le[7]/le[8]*N/s.EXTENT]})(this.width,this.height,f.x,f.y,y.x,y.y,C.x,C.y,b.x,b.y);const A=this._boundsArray=new s.StructArrayLayout4i8;A.emplaceBack(f.x,f.y,0,0),A.emplaceBack(y.x,y.y,s.EXTENT,0),A.emplaceBack(C.x,C.y,0,s.EXTENT),A.emplaceBack(b.x,b.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(A,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,a=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,a){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},a(null)):(n.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ur={vector:Ct,raster:mt,"raster-dem":class extends mt{constructor(h,n,a,f){super(h,n,a,f),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(h,n){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(y,b){y&&(h.state="errored",n(y)),b&&(h.dem=b,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",n(null))}h.request=s.getImage(this.map._requestManager.transformRequest(a,s.ResourceType.Tile),(function(y,b,C,A){if(delete h.request,h.aborted)h.state="unloaded",n(null);else if(y)h.state="errored",n(y);else if(b){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:C,expires:A});const I=s.window.ImageBitmap&&b instanceof s.window.ImageBitmap&&(Xa==null&&(Xa=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),Xa),N=1-(b.width-s.prevPowerOfTwo(b.width))/2;N<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const z=I?b:s.exported.getImageData(b,N),$={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:N};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",$,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const n=h.canonical,a=Math.pow(2,n.z),f=(n.x-1+a)%a,y=n.x===0?h.wrap-1:h.wrap,b=(n.x+1+a)%a,C=n.x+1===a?h.wrap+1:h.wrap,A={};return A[new s.OverscaledTileID(h.overscaledZ,y,n.z,f,n.y).key]={backfilled:!1},A[new s.OverscaledTileID(h.overscaledZ,C,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(A[new s.OverscaledTileID(h.overscaledZ,y,n.z,f,n.y-1).key]={backfilled:!1},A[new s.OverscaledTileID(h.overscaledZ,h.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},A[new s.OverscaledTileID(h.overscaledZ,C,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<a&&(A[new s.OverscaledTileID(h.overscaledZ,y,n.z,f,n.y+1).key]={backfilled:!1},A[new s.OverscaledTileID(h.overscaledZ,h.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},A[new s.OverscaledTileID(h.overscaledZ,C,n.z,b,n.y+1).key]={backfilled:!1}),A}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends s.Evented{constructor(h,n,a,f){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(f),this._data=n.data,this._options=s.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const y=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*y,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*y,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*y,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},n),this}getClusterChildren(h,n){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},n),this}getClusterLeaves(h,n,a,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:n,offset:a},f),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=s.extend({},this.workerOptions),n=this._data;typeof n=="string"?(h.request=this.map._requestManager.transformRequest(s.exported.resolveURL(n),s.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,((a,f)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new s.ErrorEvent(a));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(y.resourceTiming=f.resourceTiming[this.id]),this.fire(new s.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(h,n){const a=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(a,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((f,y)=>(delete h.request,h.unloadVectorData(),h.aborted?n(null):f?n(f):(h.loadVectorData(y,this.map.painter,a==="reloadTile"),n(null)))),void 0,a==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends dr{constructor(h,n,a,f){super(h,n,a,f),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const n of h.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.ResourceType.Source).url);s.getVideo(this.urls,((n,a)=>{this._loaded=!0,n?this.fire(new s.ErrorEvent(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const n=this.video.seekable;h<n.start(0)||h>n.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,n=h.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(h,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:dr,canvas:class extends dr{constructor(h,n,a,f){super(h,n,a,f),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some((y=>!Array.isArray(y)||y.length!==2||y.some((b=>typeof b!="number"))))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends s.Evented{constructor(h,n,a,f){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new jr(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:n,y:a,z:f}=h.canonical;return this._implementation.hasTile({x:n,y:a,z:f})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,n){const{x:a,y:f,z:y}=h.tileID.canonical,b=new s.window.AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:a,y:f,z:y},{signal:b.signal})).then((function(C){return delete h.request,h.aborted?(h.state="unloaded",n(null)):C===void 0?(h.state="errored",n(null)):C===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",n(null)):(function(A){return A instanceof s.window.ImageData||A instanceof s.window.HTMLCanvasElement||A instanceof s.window.ImageBitmap||A instanceof s.window.HTMLImageElement})(C)?(this.loadTileData(h,C),h.state="loaded",void n(null)):(h.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((C=>{C.code!==20&&(h.state="errored",n(C))})),h.request.cancel=()=>b.abort()}loadTileData(h,n){mt.loadTileData(h,n,this._map.painter)}unloadTileData(h){mt.unloadTileData(h,this._map.painter)}unloadTile(h,n){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:a,y:f,z:y}=h.tileID.canonical;this._implementation.unloadTile({x:a,y:f,z:y})}n()}abortTile(h,n){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z})))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},fr=function(h,n,a,f){const y=new ur[n.type](h,n,a,f);if(y.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${y.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],y),y};function Pr(h,n){const a=s.identity([]);return s.scale(a,a,[.5*h.width,.5*-h.height,1]),s.translate(a,a,[1,-1,0]),s.multiply(a,a,h.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(a)}function _n(h,n,a,f,y,b,C,A=!1){const I=h.tilesIn(f,C,A);I.sort(_i);const N=[];for(const $ of I)N.push({wrappedTileID:$.tile.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(n,a,h._state,$,y,b,Pr(h.transform,$.tile.tileID),A)});const z=(function($){const K={},re={};for(const ie of $){const ne=ie.queryResults,se=ie.wrappedTileID,W=re[se]=re[se]||{};for(const te in ne){const le=ne[te],ce=W[te]=W[te]||{},xe=K[te]=K[te]||[];for(const be of le)ce[be.featureIndex]||(ce[be.featureIndex]=!0,xe.push(be))}}return K})(N);for(const $ in z)z[$].forEach((K=>{const re=K.feature,ie=re.layer;ie&&ie.type!=="background"&&ie.type!=="sky"&&(re.source=ie.source,ie["source-layer"]&&(re.sourceLayer=ie["source-layer"]),re.state=re.id!==void 0?h.getFeatureState(ie["source-layer"],re.id):{})}));return z}function jn(h,n){const a=h.getRenderableIds().map((b=>h.getTileByID(b))),f=[],y={};for(let b=0;b<a.length;b++){const C=a[b],A=C.tileID.canonical.key;y[A]||(y[A]=!0,C.querySourceFeatures(f,n))}return f}function _i(h,n){const a=h.tileID,f=n.tileID;return a.overscaledZ-f.overscaledZ||a.canonical.y-f.canonical.y||a.wrap-f.wrap||a.canonical.x-f.canonical.x}function fn(){return na.workerClass!=null?new na.workerClass:new s.window.Worker(na.workerUrl)}const Ds="mapboxgl_preloaded_worker_pool";class Hn{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Hn.workerCount;)this.workers.push(new fn);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ds]}numActive(){return Object.keys(this.active).length}}let Mi;function ya(){return Mi||(Mi=new Hn),Mi}function Yh(h,n){const a={};for(const f in h)f!=="ref"&&(a[f]=h[f]);return s.refProperties.forEach((f=>{f in n&&(a[f]=n[f])})),a}function Fu(h){h=h.slice();const n=Object.create(null);for(let a=0;a<h.length;a++)n[h[a].id]=h[a];for(let a=0;a<h.length;a++)"ref"in h[a]&&(h[a]=Yh(h[a],n[h[a].ref]));return h}Hn.workerCount=2;const Vr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ou(h,n,a){a.push({command:Vr.addSource,args:[h,n[h]]})}function Hl(h,n,a){n.push({command:Vr.removeSource,args:[h]}),a[h]=!0}function Tn(h,n,a,f){Hl(h,a,f),Ou(h,n,a)}function Vc(h,n,a){let f;for(f in h[a])if(h[a].hasOwnProperty(f)&&f!=="data"&&!U(h[a][f],n[a][f]))return!1;for(f in n[a])if(n[a].hasOwnProperty(f)&&f!=="data"&&!U(h[a][f],n[a][f]))return!1;return!0}function ds(h,n,a,f,y,b){let C;for(C in n=n||{},h=h||{})h.hasOwnProperty(C)&&(U(h[C],n[C])||a.push({command:b,args:[f,C,n[C],y]}));for(C in n)n.hasOwnProperty(C)&&!h.hasOwnProperty(C)&&(U(h[C],n[C])||a.push({command:b,args:[f,C,n[C],y]}))}function Hs(h){return h.id}function Ja(h,n){return h[n.id]=n,h}class Uu{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.clamp(n,0,1);let a=1,f=this._distances[a];const y=n*this.paddedLength+this.padding;for(;f<y&&a<this._distances.length;)f=this._distances[++a];const b=a-1,C=this._distances[b],A=f-C,I=A>0?(y-C)/A:0;return this.points[b].mult(1-I).add(this.points[a].mult(I))}}class $o{constructor(n,a,f){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/f),this.yCellCount=Math.ceil(a/f);for(let C=0;C<this.xCellCount*this.yCellCount;C++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,f,y,b){this._forEachCell(a,f,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(n,a,f,y){this._forEachCell(a-y,f-y,a+y,f+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(f),this.circles.push(y)}_insertBoxCell(n,a,f,y,b,C){this.boxCells[b].push(C)}_insertCircleCell(n,a,f,y,b,C){this.circleCells[b].push(C)}_query(n,a,f,y,b,C){if(f<0||n>this.width||y<0||a>this.height)return!b&&[];const A=[];if(n<=0&&a<=0&&this.width<=f&&this.height<=y){if(b)return!0;for(let I=0;I<this.boxKeys.length;I++)A.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const N=this.circles[3*I],z=this.circles[3*I+1],$=this.circles[3*I+2];A.push({key:this.circleKeys[I],x1:N-$,y1:z-$,x2:N+$,y2:z+$})}return C?A.filter(C):A}return this._forEachCell(n,a,f,y,this._queryCell,A,{hitTest:b,seenUids:{box:{},circle:{}}},C),b?A.length>0:A}_queryCircle(n,a,f,y,b){const C=n-f,A=n+f,I=a-f,N=a+f;if(A<0||C>this.width||N<0||I>this.height)return!y&&[];const z=[];return this._forEachCell(C,I,A,N,this._queryCellCircle,z,{hitTest:y,circle:{x:n,y:a,radius:f},seenUids:{box:{},circle:{}}},b),y?z.length>0:z}query(n,a,f,y,b){return this._query(n,a,f,y,!1,b)}hitTest(n,a,f,y,b){return this._query(n,a,f,y,!0,b)}hitTestCircle(n,a,f,y){return this._queryCircle(n,a,f,!0,y)}_queryCell(n,a,f,y,b,C,A,I){const N=A.seenUids,z=this.boxCells[b];if(z!==null){const K=this.bboxes;for(const re of z)if(!N.box[re]){N.box[re]=!0;const ie=4*re;if(n<=K[ie+2]&&a<=K[ie+3]&&f>=K[ie+0]&&y>=K[ie+1]&&(!I||I(this.boxKeys[re]))){if(A.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[re],x1:K[ie],y1:K[ie+1],x2:K[ie+2],y2:K[ie+3]})}}}const $=this.circleCells[b];if($!==null){const K=this.circles;for(const re of $)if(!N.circle[re]){N.circle[re]=!0;const ie=3*re;if(this._circleAndRectCollide(K[ie],K[ie+1],K[ie+2],n,a,f,y)&&(!I||I(this.circleKeys[re]))){if(A.hitTest)return C.push(!0),!0;{const ne=K[ie],se=K[ie+1],W=K[ie+2];C.push({key:this.circleKeys[re],x1:ne-W,y1:se-W,x2:ne+W,y2:se+W})}}}}}_queryCellCircle(n,a,f,y,b,C,A,I){const N=A.circle,z=A.seenUids,$=this.boxCells[b];if($!==null){const re=this.bboxes;for(const ie of $)if(!z.box[ie]){z.box[ie]=!0;const ne=4*ie;if(this._circleAndRectCollide(N.x,N.y,N.radius,re[ne+0],re[ne+1],re[ne+2],re[ne+3])&&(!I||I(this.boxKeys[ie])))return C.push(!0),!0}}const K=this.circleCells[b];if(K!==null){const re=this.circles;for(const ie of K)if(!z.circle[ie]){z.circle[ie]=!0;const ne=3*ie;if(this._circlesCollide(re[ne],re[ne+1],re[ne+2],N.x,N.y,N.radius)&&(!I||I(this.circleKeys[ie])))return C.push(!0),!0}}}_forEachCell(n,a,f,y,b,C,A,I){const N=this._convertToXCellCoord(n),z=this._convertToYCellCoord(a),$=this._convertToXCellCoord(f),K=this._convertToYCellCoord(y);for(let re=N;re<=$;re++)for(let ie=z;ie<=K;ie++)if(b.call(this,n,a,f,y,this.xCellCount*ie+re,C,A,I))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,f,y,b,C){const A=y-n,I=b-a,N=f+C;return N*N>A*A+I*I}_circleAndRectCollide(n,a,f,y,b,C,A){const I=(C-y)/2,N=Math.abs(n-(y+I));if(N>I+f)return!1;const z=(A-b)/2,$=Math.abs(a-(b+z));if($>z+f)return!1;if(N<=I||$<=z)return!0;const K=N-I,re=$-z;return K*K+re*re<=f*f}}const ps={unknown:0,flipRequired:1,flipNotRequired:2},Ni=Math.tan(85*Math.PI/180);function rt(h,n,a,f,y,b,C){const A=s.create();if(a)if(b.name==="globe"){const I=s.calculateGlobeLabelMatrix(y,n);s.multiply(A,A,I)}else{const I=De([],C);A[0]=I[0],A[1]=I[1],A[4]=I[2],A[5]=I[3],f||s.rotateZ(A,A,y.angle)}else s.multiply(A,y.labelPlaneMatrix,h);return A}function Xn(h,n,a,f,y,b,C){const A=rt(h,n,a,f,y,b,C);return b.name==="globe"&&a||(A[2]=A[6]=A[10]=A[14]=0),A}function Rn(h,n,a,f,y,b,C){if(a){if(b.name==="globe"){const A=rt(h,n,a,f,y,b,C);return s.invert(A,A),s.multiply(A,h,A),A}{const A=s.clone(h),I=s.identity([]);return I[0]=C[0],I[1]=C[1],I[4]=C[2],I[5]=C[3],s.multiply(A,A,I),f||s.rotateZ(A,A,-y.angle),A}}return y.glCoordMatrix}function ri(h,n,a,f){const y=[h,n,a,1];a?s.transformMat4$1(y,y,f):mr(y,y,f);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function Jh(h,n){return Math.min(.5+h/n*.5,1.5)}function Xi(h,n){const a=h[0]/h[3],f=h[1]/h[3];return a>=-n[0]&&a<=n[0]&&f>=-n[1]&&f<=n[1]}function Qa(h,n,a,f,y,b,C,A,I,N){const z=a.transform,$=f?h.textSizeData:h.iconSizeData,K=s.evaluateSizeForZoom($,a.transform.zoom),re=z.projection.name==="globe",ie=[256/a.width*2+1,256/a.height*2+1],ne=f?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;ne.clear();let se=null;re&&(se=f?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const W=h.lineVertexArray,te=f?h.text.placedSymbolArray:h.icon.placedSymbolArray,le=a.transform.width/a.transform.height;let ce,xe=!1;for(let be=0;be<te.length;be++){const ve=te.get(be),{numGlyphs:Pe,writingMode:Ce}=ve;if(Ce!==s.WritingMode.vertical||xe||ce===s.WritingMode.horizontal||(xe=!0),ce=Ce,(ve.hidden||Ce===s.WritingMode.vertical)&&!xe){Ki(Pe,ne);continue}xe=!1;const Oe=new s.Point(ve.tileAnchorX,ve.tileAnchorY);let{x:ft,y:je,z:Je}=z.projection.projectTilePoint(Oe.x,Oe.y,N.canonical);if(I){const[er,Nt,Xt]=I(Oe);ft+=er,je+=Nt,Je+=Xt}const Ve=[ft,je,Je,1];if(s.transformMat4$1(Ve,Ve,n),!Xi(Ve,ie)){Ki(Pe,ne);continue}const dt=Jh(a.transform.cameraToCenterDistance,Ve[3]),Be=s.evaluateSizeForFeature($,K,ve),Qe=C?Be/dt:Be*dt,ht=ri(ft,je,Je,y);if(ht[3]<=0){Ki(Pe,ne);continue}let ct={};const gt=C?null:I,Ut=Rt(ve,Qe,!1,A,n,y,b,h.glyphOffsetArray,W,ne,se,ht,Oe,ct,le,gt,z.projection,N,C);xe=Ut.useVertical,gt&&Ut.needsFlipping&&(ct={}),(Ut.notEnoughRoom||xe||Ut.needsFlipping&&Rt(ve,Qe,!0,A,n,y,b,h.glyphOffsetArray,W,ne,se,ht,Oe,ct,le,gt,z.projection,N,C).notEnoughRoom)&&Ki(Pe,ne)}f?(h.text.dynamicLayoutVertexBuffer.updateData(ne),se&&h.text.globeExtVertexBuffer.updateData(se)):(h.icon.dynamicLayoutVertexBuffer.updateData(ne),se&&h.icon.globeExtVertexBuffer.updateData(se))}function el(h,n,a,f,y,b,C,A,I,N,z,$,K,re,ie,ne){const{lineStartIndex:se,glyphStartIndex:W,segment:te}=A,le=W+A.numGlyphs,ce=se+A.lineLength,xe=n.getoffsetX(W),be=n.getoffsetX(le-1),ve=Bi(h*xe,a,f,y,b,C,te,se,ce,I,N,z,$,K,!0,re,ie,ne);if(!ve)return null;const Pe=Bi(h*be,a,f,y,b,C,te,se,ce,I,N,z,$,K,!0,re,ie,ne);return Pe?{first:ve,last:Pe}:null}function xo(h,n,a,f){return h===s.WritingMode.horizontal&&Math.abs(f)>Math.abs(a)?{useVertical:!0}:h===s.WritingMode.vertical?f>0?{needsFlipping:!0}:null:n!==ps.unknown&&(function(y,b){return y===0||Math.abs(b/y)>Ni})(a,f)?n===ps.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Rt(h,n,a,f,y,b,C,A,I,N,z,$,K,re,ie,ne,se,W,te){const le=n/24,ce=h.lineOffsetX*le,xe=h.lineOffsetY*le,{lineStartIndex:be,glyphStartIndex:ve,numGlyphs:Pe,segment:Ce,writingMode:Oe,flipState:ft}=h,je=be+h.lineLength,Je=Ve=>{if(z){const[ht,ct,gt]=Ve.up,Ut=N.length;s.updateGlobeVertexNormal(z,Ut+0,ht,ct,gt),s.updateGlobeVertexNormal(z,Ut+1,ht,ct,gt),s.updateGlobeVertexNormal(z,Ut+2,ht,ct,gt),s.updateGlobeVertexNormal(z,Ut+3,ht,ct,gt)}const[dt,Be,Qe]=Ve.point;s.addDynamicAttributes(N,dt,Be,Qe,Ve.angle)};if(Pe>1){const Ve=el(le,A,ce,xe,a,$,K,h,I,b,re,ne,!1,se,W,te);if(!Ve)return{notEnoughRoom:!0};if(f&&!a){let[dt,Be,Qe]=Ve.first.point,[ht,ct,gt]=Ve.last.point;[dt,Be]=ri(dt,Be,Qe,C),[ht,ct]=ri(ht,ct,gt,C);const Ut=xo(Oe,ft,(ht-dt)*ie,ct-Be);if(h.flipState=Ut&&Ut.needsFlipping?ps.flipRequired:ps.flipNotRequired,Ut)return Ut}Je(Ve.first);for(let dt=ve+1;dt<ve+Pe-1;dt++){const Be=Bi(le*A.getoffsetX(dt),ce,xe,a,$,K,Ce,be,je,I,b,re,ne,!1,!1,se,W,te);if(!Be)return N.length-=4*(dt-ve),{notEnoughRoom:!0};Je(Be)}Je(Ve.last)}else{if(f&&!a){const dt=ri(K.x,K.y,0,y),Be=be+Ce+1,Qe=new s.Point(I.getx(Be),I.gety(Be)),ht=ri(Qe.x,Qe.y,0,y),ct=ht[3]>0?ht:Sr(K,Qe,dt,1,y,void 0,se,W.canonical),gt=xo(Oe,ft,(ct[0]-dt[0])*ie,ct[1]-dt[1]);if(h.flipState=gt&&gt.needsFlipping?ps.flipRequired:ps.flipNotRequired,gt)return gt}const Ve=Bi(le*A.getoffsetX(ve),ce,xe,a,$,K,Ce,be,je,I,b,re,ne,!1,!1,se,W,te);if(!Ve)return{notEnoughRoom:!0};Je(Ve)}return{}}function Dr(h,n,a,f,y){const{x:b,y:C,z:A}=f.projectTilePoint(h.x,h.y,n);if(!y)return ri(b,C,A,a);const[I,N,z]=y(h);return ri(b+I,C+N,A+z,a)}function Sr(h,n,a,f,y,b,C,A){const I=Dr(h.sub(n)._unit()._add(h),A,y,C,b);return s.sub(I,a,I),s.normalize(I,I),s.scaleAndAdd(I,a,I,f)}function Bi(h,n,a,f,y,b,C,A,I,N,z,$,K,re,ie,ne,se,W){const te=f?h-n:h+n;let le=te>0?1:-1,ce=0;f&&(le*=-1,ce=Math.PI),le<0&&(ce+=Math.PI);let xe=A+C+(le>0?0:1)|0,be=y,ve=y,Pe=0,Ce=0;const Oe=Math.abs(te),ft=[],je=[];let Je=b,Ve=Je;const dt=()=>Sr(Ve,Je,ve,Oe-Pe+1,z,K,ne,se.canonical);for(;Pe+Ce<=Oe;){if(xe+=le,xe<A||xe>=I)return null;if(ve=be,Ve=Je,ft.push(ve),re&&je.push(Ve),Je=new s.Point(N.getx(xe),N.gety(xe)),be=$[xe],!be){const Xt=Dr(Je,se.canonical,z,ne,K);be=Xt[3]>0?$[xe]=Xt:dt()}Pe+=Ce,Ce=s.distance(ve,be)}ie&&K&&($[xe]&&(be=dt(),Ce=s.distance(ve,be)),$[xe]=be);const Be=(Oe-Pe)/Ce,Qe=Je.sub(Ve)._mult(Be)._add(Ve),ht=s.sub([],be,ve),ct=s.scaleAndAdd([],ve,ht,Be);let gt=[0,0,1],Ut=ht[0],er=ht[1];if(W&&(gt=ne.upVector(se.canonical,Qe.x,Qe.y),gt[0]!==0||gt[1]!==0||gt[2]!==1)){const Xt=[gt[2],0,-gt[0]],br=s.cross([],gt,Xt);s.normalize(Xt,Xt),s.normalize(br,br),Ut=s.dot(ht,Xt),er=s.dot(ht,br)}if(a){const Xt=s.cross([],gt,ht);s.normalize(Xt,Xt),s.scaleAndAdd(ct,ct,Xt,a*le)}const Nt=ce+Math.atan2(er,Ut);return ft.push(ct),re&&je.push(Qe),{point:ct,angle:Nt,path:ft,tilePath:je,up:gt}}function Ki(h,n){const a=n.length,f=a+4*h;n.resize(f),n.float32.fill(-1/0,4*a,4*f)}function mr(h,n,a){const f=n[0],y=n[1];return h[0]=a[0]*f+a[4]*y+a[12],h[1]=a[1]*f+a[5]*y+a[13],h[3]=a[3]*f+a[7]*y+a[15],h}const Yi=100;class _a{constructor(n,a,f=new $o(n.width+200,n.height+200,25),y=new $o(n.width+200,n.height+200,25)){this.transform=n,this.grid=f,this.ignoredGrid=y,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Yi,this.screenBottomBoundary=n.height+Yi,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,f,y,b,C,A,I){let N=f.projectedAnchorX,z=f.projectedAnchorY,$=f.projectedAnchorZ;const K=f.elevation,re=f.tileID,ie=n.getProjection();if(K&&re){const[be,ve,Pe]=ie.upVector(re.canonical,f.tileAnchorX,f.tileAnchorY),Ce=ie.upVectorScale(re.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;N+=be*K*Ce,z+=ve*K*Ce,$+=Pe*K*Ce}const ne=this.projectAndGetPerspectiveRatio(A,N,z,$,f.tileID,ie.name==="globe"||!!K||this.transform.pitch>0,ie),se=C*ne.perspectiveRatio,W=(f.x1*a+y.x-f.padding)*se+ne.point.x,te=(f.y1*a+y.y-f.padding)*se+ne.point.y,le=(f.x2*a+y.x+f.padding)*se+ne.point.x,ce=(f.y2*a+y.y+f.padding)*se+ne.point.y,xe=ne.perspectiveRatio<=.55||ne.occluded;return!this.isInsideGrid(W,te,le,ce)||!b&&this.grid.hitTest(W,te,le,ce,I)||xe?{box:[],offscreen:!1,occluded:ne.occluded}:{box:[W,te,le,ce],offscreen:this.isOffscreen(W,te,le,ce),occluded:!1}}placeCollisionCircles(n,a,f,y,b,C,A,I,N,z,$,K,re,ie,ne){const se=[],W=this.transform.elevation,te=n.getProjection(),le=W?W.getAtTileOffsetFunc(ne,this.transform.center.lat,this.transform.worldSize,te):null,ce=new s.Point(f.tileAnchorX,f.tileAnchorY);let{x:xe,y:be,z:ve}=te.projectTilePoint(ce.x,ce.y,ne.canonical);if(le){const[Qe,ht,ct]=le(ce);xe+=Qe,be+=ht,ve+=ct}const Pe=te.name==="globe",Ce=this.projectAndGetPerspectiveRatio(A,xe,be,ve,ne,Pe||!!W||this.transform.pitch>0,te),{perspectiveRatio:Oe}=Ce,ft=($?C/Oe:C*Oe)/s.ONE_EM,je=ri(xe,be,ve,I),Je=Ce.signedDistanceFromCamera>0?el(ft,b,f.lineOffsetX*ft,f.lineOffsetY*ft,!1,je,ce,f,y,I,{},W&&!$?le:null,$&&!!W,te,ne,$):null;let Ve=!1,dt=!1,Be=!0;if(Je&&!Ce.occluded){const Qe=.5*re*Oe+ie,ht=new s.Point(-100,-100),ct=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),gt=new Uu,{first:Ut,last:er}=Je,Nt=Ut.path.length;let Xt=[];for(let Vt=Nt-1;Vt>=1;Vt--)Xt.push(Ut.path[Vt]);for(let Vt=1;Vt<er.path.length;Vt++)Xt.push(er.path[Vt]);const br=2.5*Qe;N&&(Xt=Xt.map((([Vt,Ir,Gr],Wr)=>(le&&!Pe&&(Gr=le(Wr<Nt-1?Ut.tilePath[Nt-1-Wr]:er.tilePath[Wr-Nt+2])[2]),ri(Vt,Ir,Gr,N)))),Xt.some((Vt=>Vt[3]<=0))&&(Xt=[]));let Er=[];if(Xt.length>0){let Vt=1/0,Ir=-1/0,Gr=1/0,Wr=-1/0;for(const Or of Xt)Vt=Math.min(Vt,Or[0]),Gr=Math.min(Gr,Or[1]),Ir=Math.max(Ir,Or[0]),Wr=Math.max(Wr,Or[1]);Ir>=ht.x&&Vt<=ct.x&&Wr>=ht.y&&Gr<=ct.y&&(Er=[Xt.map((Or=>new s.Point(Or[0],Or[1])))],(Vt<ht.x||Ir>ct.x||Gr<ht.y||Wr>ct.y)&&(Er=s.clipLine(Er,ht.x,ht.y,ct.x,ct.y)))}for(const Vt of Er){gt.reset(Vt,.25*Qe);let Ir=0;Ir=gt.length<=.5*Qe?1:Math.ceil(gt.paddedLength/br)+1;for(let Gr=0;Gr<Ir;Gr++){const Wr=Gr/Math.max(Ir-1,1),Or=gt.lerp(Wr),oi=Or.x+Yi,Sn=Or.y+Yi;se.push(oi,Sn,Qe,0);const ns=oi-Qe,ws=Sn-Qe,pr=oi+Qe,Kr=Sn+Qe;if(Be=Be&&this.isOffscreen(ns,ws,pr,Kr),dt=dt||this.isInsideGrid(ns,ws,pr,Kr),!a&&this.grid.hitTestCircle(oi,Sn,Qe,K)&&(Ve=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Ve,occluded:!1}}}}return{circles:!z&&Ve||!dt?[]:se,offscreen:Be,collisionDetected:Ve,occluded:Ce.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let f=1/0,y=1/0,b=-1/0,C=-1/0;for(const z of n){const $=new s.Point(z.x+Yi,z.y+Yi);f=Math.min(f,$.x),y=Math.min(y,$.y),b=Math.max(b,$.x),C=Math.max(C,$.y),a.push($)}const A=this.grid.query(f,y,b,C).concat(this.ignoredGrid.query(f,y,b,C)),I={},N={};for(const z of A){const $=z.key;if(I[$.bucketInstanceId]===void 0&&(I[$.bucketInstanceId]={}),I[$.bucketInstanceId][$.featureIndex])continue;const K=[new s.Point(z.x1,z.y1),new s.Point(z.x2,z.y1),new s.Point(z.x2,z.y2),new s.Point(z.x1,z.y2)];s.polygonIntersectsPolygon(a,K)&&(I[$.bucketInstanceId][$.featureIndex]=!0,N[$.bucketInstanceId]===void 0&&(N[$.bucketInstanceId]=[]),N[$.bucketInstanceId].push($.featureIndex))}return N}insertCollisionBox(n,a,f,y,b){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:y,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,f,y,b){const C=a?this.ignoredGrid:this.grid,A={bucketInstanceId:f,featureIndex:y,collisionGroupID:b};for(let I=0;I<n.length;I+=4)C.insertCircle(A,n[I],n[I+1],n[I+2])}projectAndGetPerspectiveRatio(n,a,f,y,b,C,A){const I=[a,f,y,1];let N=!1;y||this.transform.pitch>0?(s.transformMat4$1(I,I,n),this.fogState&&b&&A.name!=="globe"&&(N=(function(K,re,ie,ne,se,W){const te=W.calculateFogTileMatrix(se),le=[re,ie,ne];return s.transformMat4(le,le,te),cr(K,le,W.pitch,W._fov)})(this.fogState,a,f,y,b.toUnwrapped(),this.transform)>.9)):mr(I,I,n);const z=I[3];return{point:new s.Point((I[0]/z+1)/2*this.transform.width+Yi,(-I[1]/z+1)/2*this.transform.height+Yi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/z*.5,1.5),signedDistanceFromCamera:z,occluded:C&&I[2]>z||N}}isOffscreen(n,a,f,y){return f<Yi||n>=this.screenRightBoundary||y<Yi||a>this.screenBottomBoundary}isInsideGrid(n,a,f,y){return f>=0&&n<this.gridRightBoundary&&y>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=s.identity([]);return s.translate(n,n,[-100,-100,0]),n}}function $r(h,n,a){const f=n.createTileMatrix(h,h.worldSize,a.toUnwrapped());return s.multiply(new Float32Array(16),h.projMatrix,f)}function Ji(h,n,a){if(n.projection.name===a.projection.name)return h.projMatrix;const f=a.clone();return f.setProjection(n.projection),$r(f,n.getProjection(),h)}function ln(h,n,a){return n.name===a.projection.name?h.projMatrix:$r(a,n,h)}class $c{constructor(n,a,f,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):y&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Xs{constructor(n,a,f,y,b,C=!1){this.text=new $c(n?n.text:null,a,f,b),this.icon=new $c(n?n.icon:null,a,y,b),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class tl{constructor(n,a,f,y=!1){this.text=n,this.icon=a,this.skipFade=f,this.clipped=y}}class rl{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Xl{constructor(n,a,f,y,b){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=f,this.bucketIndex=y,this.tileID=b}}class Kl{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:f=>f.collisionGroupID===a}}return this.collisionGroups[n]}}function fs(h,n,a,f,y){const{horizontalAlign:b,verticalAlign:C}=s.getAnchorAlignment(h),A=-(b-.5)*n,I=-(C-.5)*a,N=s.evaluateVariableOffset(h,f);return new s.Point(A+N[0]*y,I+N[1]*y)}function ms(h,n,a,f,y){const b=new s.Point(h,n);return a&&b._rotate(f?y:-y),b}class Ls{constructor(n,a,f,y,b){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new _a(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Kl(f),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,f,y){const b=f.getBucket(a),C=f.latestFeatureIndex;if(!b||!C||a.id!==b.layerIds[0])return;const A=b.layers[0].layout,I=f.collisionBoxArray,N=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),z=f.tileSize/s.EXTENT,$=f.tileID.toUnwrapped();this.transform.setProjection(b.projection);const K=(re=f.tileID,ie=b.getProjection(),ne=this.transform,ie.name===this.projection?ne.calculateProjMatrix(re.toUnwrapped()):$r(ne,ie,re));var re,ie,ne;const se=A.get("text-pitch-alignment")==="map",W=A.get("text-rotation-alignment")==="map";a.compileFilter();const te=a.dynamicFilter(),le=a.dynamicFilterNeedsFeature(),ce=this.transform.calculatePixelsToTileUnitsMatrix(f),xe=Xn(K,f.tileID.canonical,se,W,this.transform,b.getProjection(),ce);let be=null;if(se){const Ce=Rn(K,f.tileID.canonical,se,W,this.transform,b.getProjection(),ce);be=s.multiply([],this.transform.labelPlaneMatrix,Ce)}let ve=null;te&&f.latestFeatureIndex&&(ve={unwrappedTileID:$,dynamicFilter:te,dynamicFilterNeedsFeature:le,featureIndex:f.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Xl(b.bucketInstanceId,C,b.sourceLayerIndex,b.index,f.tileID);const Pe={bucket:b,layout:A,posMatrix:K,textLabelPlaneMatrix:xe,labelToScreenMatrix:be,clippingData:ve,scale:N,textPixelRatio:z,holdingForFade:f.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(y)for(const Ce of b.sortKeyRanges){const{sortKey:Oe,symbolInstanceStart:ft,symbolInstanceEnd:je}=Ce;n.push({sortKey:Oe,symbolInstanceStart:ft,symbolInstanceEnd:je,parameters:Pe})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Pe})}attemptAnchorPlacement(n,a,f,y,b,C,A,I,N,z,$,K,re,ie,ne,se,W,te){const{textOffset0:le,textOffset1:ce,crossTileID:xe}=K,be=[le,ce],ve=fs(n,f,y,be,b),Pe=this.collisionIndex.placeCollisionBox(ie,b,a,ms(ve.x,ve.y,C,A,this.transform.angle),$,I,N,z.predicate);if(se){const Ce=ie.getSymbolInstanceIconSize(te,this.transform.zoom,K.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ie,Ce,se,ms(ve.x,ve.y,C,A,this.transform.angle),$,I,N,z.predicate).box.length===0)return}if(Pe.box.length>0){let Ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[xe]&&this.prevPlacement.placements[xe]&&this.prevPlacement.placements[xe].text&&(Ce=this.prevPlacement.variableOffsets[xe].anchor),this.variableOffsets[xe]={textOffset:be,width:f,height:y,anchor:n,textScale:b,prevAnchor:Ce},this.markUsedJustification(ie,n,K,ne),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,ne,K),this.placedOrientations[xe]=ne),{shift:ve,placedGlyphBoxes:Pe}}}placeLayerBucketPart(n,a,f,y){const{bucket:b,layout:C,posMatrix:A,textLabelPlaneMatrix:I,labelToScreenMatrix:N,clippingData:z,textPixelRatio:$,holdingForFade:K,collisionBoxArray:re,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:ne,collisionGroup:se}=n.parameters,W=C.get("text-optional"),te=C.get("icon-optional"),le=C.get("text-allow-overlap"),ce=C.get("icon-allow-overlap"),xe=C.get("text-rotation-alignment")==="map",be=C.get("text-pitch-alignment")==="map",ve=C.get("icon-text-fit")!=="none",Pe=C.get("symbol-z-order")==="viewport-y";this.transform.setProjection(b.projection);let Ce=le&&(ce||!b.hasIconData()||te),Oe=ce&&(le||!b.hasTextData()||W);!b.collisionArrays&&re&&b.deserializeCollisionBoxes(re),f&&y&&b.updateCollisionDebugBuffers(this.transform.zoom,re);const ft=(je,Je,Ve)=>{const{crossTileID:dt,numVerticalGlyphVertices:Be}=je;if(z){const pr={zoom:this.transform.zoom,pitch:this.transform.pitch};let Kr=null;if(z.dynamicFilterNeedsFeature){const Fr=this.retainedQueryData[b.bucketInstanceId];Kr=z.featureIndex.loadFeature({featureIndex:je.featureIndex,bucketIndex:Fr.bucketIndex,sourceLayerIndex:Fr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(pr,Kr,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new s.Point(je.tileAnchorX,je.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[dt]=new tl(!1,!1,!1,!0),void a.add(dt)}if(a.has(dt))return;if(K)return void(this.placements[dt]=new tl(!1,!1,!1));let Qe=!1,ht=!1,ct=!0,gt=!1,Ut=!1,er=null,Nt={box:null,offscreen:null,occluded:null},Xt={box:null},br=null,Er=null,Vt=null,Ir=0,Gr=0,Wr=0;Ve.textFeatureIndex?Ir=Ve.textFeatureIndex:je.useRuntimeCollisionCircles&&(Ir=je.featureIndex),Ve.verticalTextFeatureIndex&&(Gr=Ve.verticalTextFeatureIndex);const Or=pr=>{pr.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const Kr=this.transform.elevation;(Kr||pr.elevation)&&(pr.elevation=Kr?Kr.getAtTileOffset(pr.tileID,pr.tileAnchorX,pr.tileAnchorY):0)},oi=Ve.textBox;if(oi){Or(oi);const pr=Fr=>{let En=s.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Fr&&this.prevPlacement){const ai=this.prevPlacement.placedOrientations[dt];ai&&(this.placedOrientations[dt]=ai,En=ai,this.markUsedOrientation(b,En,je))}return En},Kr=(Fr,En)=>{if(b.allowVerticalPlacement&&Be>0&&Ve.verticalTextBox){for(const ai of b.writingModes)if(ai===s.WritingMode.vertical?(Nt=En(),Xt=Nt):Nt=Fr(),Nt&&Nt.box&&Nt.box.length)break}else Nt=Fr()};if(C.get("text-variable-anchor")){let Fr=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[dt]){const rn=this.prevPlacement.variableOffsets[dt];Fr.indexOf(rn.anchor)>0&&(Fr=Fr.filter((Un=>Un!==rn.anchor)),Fr.unshift(rn.anchor))}const En=(rn,Un,gn)=>{const xn=b.getSymbolInstanceTextSize(ie,je,this.transform.zoom,Je),Mn=(rn.x2-rn.x1)*xn+2*rn.padding,Ts=(rn.y2-rn.y1)*xn+2*rn.padding,Ss=ve&&!ce?Un:null;Ss&&Or(Ss);let Fs={box:[],offscreen:!1,occluded:!1};const hu=le?2*Fr.length:Fr.length;for(let Vn=0;Vn<hu;++Vn){const vc=this.attemptAnchorPlacement(Fr[Vn%Fr.length],rn,Mn,Ts,xn,xe,be,$,A,se,Vn>=Fr.length,je,Je,b,gn,Ss,ie,ne);if(vc&&(Fs=vc.placedGlyphBoxes,Fs&&Fs.box&&Fs.box.length)){Qe=!0,er=vc.shift;break}}return Fs};Kr((()=>En(oi,Ve.iconBox,s.WritingMode.horizontal)),(()=>{const rn=Ve.verticalTextBox;return rn&&Or(rn),b.allowVerticalPlacement&&!(Nt&&Nt.box&&Nt.box.length)&&Be>0&&rn?En(rn,Ve.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),Nt&&(Qe=Nt.box,ct=Nt.offscreen,gt=Nt.occluded);const ai=pr(!(!Nt||!Nt.box));if(!Qe&&this.prevPlacement){const rn=this.prevPlacement.variableOffsets[dt];rn&&(this.variableOffsets[dt]=rn,this.markUsedJustification(b,rn.anchor,je,ai))}}else{const Fr=(En,ai)=>{const rn=b.getSymbolInstanceTextSize(ie,je,this.transform.zoom,Je),Un=this.collisionIndex.placeCollisionBox(b,rn,En,new s.Point(0,0),le,$,A,se.predicate);return Un&&Un.box&&Un.box.length&&(this.markUsedOrientation(b,ai,je),this.placedOrientations[dt]=ai),Un};Kr((()=>Fr(oi,s.WritingMode.horizontal)),(()=>{const En=Ve.verticalTextBox;return b.allowVerticalPlacement&&Be>0&&En?(Or(En),Fr(En,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),pr(!!(Nt&&Nt.box&&Nt.box.length))}}if(br=Nt,Qe=br&&br.box&&br.box.length>0,ct=br&&br.offscreen,gt=br&&br.occluded,je.useRuntimeCollisionCircles){const pr=b.text.placedSymbolArray.get(je.centerJustifiedTextSymbolIndex>=0?je.centerJustifiedTextSymbolIndex:je.verticalPlacedTextSymbolIndex),Kr=s.evaluateSizeForFeature(b.textSizeData,ie,pr),Fr=C.get("text-padding");Er=this.collisionIndex.placeCollisionCircles(b,le,pr,b.lineVertexArray,b.glyphOffsetArray,Kr,A,I,N,f,be,se.predicate,je.collisionCircleDiameter*Kr/s.ONE_EM,Fr,this.retainedQueryData[b.bucketInstanceId].tileID),Qe=le||Er.circles.length>0&&!Er.collisionDetected,ct=ct&&Er.offscreen,gt=Er.occluded}if(Ve.iconFeatureIndex&&(Wr=Ve.iconFeatureIndex),Ve.iconBox){const pr=Kr=>{Or(Kr);const Fr=ve&&er?ms(er.x,er.y,xe,be,this.transform.angle):new s.Point(0,0),En=b.getSymbolInstanceIconSize(ne,this.transform.zoom,je.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,En,Kr,Fr,ce,$,A,se.predicate)};Xt&&Xt.box&&Xt.box.length&&Ve.verticalIconBox?(Vt=pr(Ve.verticalIconBox),ht=Vt.box.length>0):(Vt=pr(Ve.iconBox),ht=Vt.box.length>0),ct=ct&&Vt.offscreen,Ut=Vt.occluded}const Sn=W||je.numHorizontalGlyphVertices===0&&Be===0,ns=te||je.numIconVertices===0;if(Sn||ns?ns?Sn||(ht=ht&&Qe):Qe=ht&&Qe:ht=Qe=ht&&Qe,Qe&&br&&br.box&&this.collisionIndex.insertCollisionBox(br.box,C.get("text-ignore-placement"),b.bucketInstanceId,Xt&&Xt.box&&Gr?Gr:Ir,se.ID),ht&&Vt&&this.collisionIndex.insertCollisionBox(Vt.box,C.get("icon-ignore-placement"),b.bucketInstanceId,Wr,se.ID),Er&&(Qe&&this.collisionIndex.insertCollisionCircles(Er.circles,C.get("text-ignore-placement"),b.bucketInstanceId,Ir,se.ID),f)){const pr=b.bucketInstanceId;let Kr=this.collisionCircleArrays[pr];Kr===void 0&&(Kr=this.collisionCircleArrays[pr]=new rl);for(let Fr=0;Fr<Er.circles.length;Fr+=4)Kr.circles.push(Er.circles[Fr+0]),Kr.circles.push(Er.circles[Fr+1]),Kr.circles.push(Er.circles[Fr+2]),Kr.circles.push(Er.collisionDetected?1:0)}const ws=b.projection.name!=="globe";Ce=Ce&&(ws||!gt),Oe=Oe&&(ws||!Ut),this.placements[dt]=new tl(Qe||Ce,ht||Oe,ct||b.justReloaded),a.add(dt)};if(Pe){const je=b.getSortedSymbolIndexes(this.transform.angle);for(let Je=je.length-1;Je>=0;--Je){const Ve=je[Je];ft(b.symbolInstances.get(Ve),Ve,b.collisionArrays[Ve])}}else for(let je=n.symbolInstanceStart;je<n.symbolInstanceEnd;je++)ft(b.symbolInstances.get(je),je,b.collisionArrays[je]);if(f&&b.bucketInstanceId in this.collisionCircleArrays){const je=this.collisionCircleArrays[b.bucketInstanceId];s.invert(je.invProjMatrix,A),je.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(n,a,f,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:I,crossTileID:N}=f,z=s.getAnchorJustification(a),$=y===s.WritingMode.vertical?I:z==="left"?b:z==="center"?C:z==="right"?A:-1;b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=$>=0&&b!==$?0:N),C>=0&&(n.text.placedSymbolArray.get(C).crossTileID=$>=0&&C!==$?0:N),A>=0&&(n.text.placedSymbolArray.get(A).crossTileID=$>=0&&A!==$?0:N),I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=$>=0&&I!==$?0:N)}markUsedOrientation(n,a,f){const y=a===s.WritingMode.horizontal||a===s.WritingMode.horizontalOnly?a:0,b=a===s.WritingMode.vertical?a:0,{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:N}=f,z=n.text.placedSymbolArray;C>=0&&(z.get(C).placedOrientation=y),A>=0&&(z.get(A).placedOrientation=y),I>=0&&(z.get(I).placedOrientation=y),N>=0&&(z.get(N).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let f=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const y=a?a.symbolFadeChange(n):1,b=a?a.opacities:{},C=a?a.variableOffsets:{},A=a?a.placedOrientations:{};for(const I in this.placements){const N=this.placements[I],z=b[I];z?(this.opacities[I]=new Xs(z,y,N.text,N.icon,null,N.clipped),f=f||N.text!==z.text.placed||N.icon!==z.icon.placed):(this.opacities[I]=new Xs(null,y,N.text,N.icon,N.skipFade,N.clipped),f=f||N.text||N.icon)}for(const I in b){const N=b[I];if(!this.opacities[I]){const z=new Xs(N,y,!1,!1);z.isHidden()||(this.opacities[I]=z,f=f||N.text.placed||N.icon.placed)}}for(const I in C)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=C[I]);for(const I in A)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=A[I]);f?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a){const f=new Set;for(const y of a){const b=y.getBucket(n);b&&y.latestFeatureIndex&&n.id===b.layerIds[0]&&this.updateBucketOpacities(b,f,y.collisionBoxArray)}}updateBucketOpacities(n,a,f){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const y=n.layers[0].layout,b=!!n.layers[0].dynamicFilter(),C=new Xs(null,0,!1,!1,!0),A=y.get("text-allow-overlap"),I=y.get("icon-allow-overlap"),N=y.get("text-variable-anchor"),z=y.get("text-rotation-alignment")==="map",$=y.get("text-pitch-alignment")==="map",K=y.get("icon-text-fit")!=="none",re=new Xs(null,0,A&&(I||!n.hasIconData()||y.get("icon-optional")),I&&(A||!n.hasTextData()||y.get("text-optional")),!0);!n.collisionArrays&&f&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(f);const ie=(se,W,te)=>{for(let le=0;le<W/4;le++)se.opacityVertexArray.emplaceBack(te)};let ne=0;for(let se=0;se<n.symbolInstances.length;se++){const W=n.symbolInstances.get(se),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:le,crossTileID:ce,numIconVertices:xe}=W,be=a.has(ce);let ve=this.opacities[ce];be?ve=C:ve||(ve=re,this.opacities[ce]=ve),a.add(ce);const Pe=te>0||le>0,Ce=xe>0,Oe=this.placedOrientations[ce],ft=Oe===s.WritingMode.vertical,je=Oe===s.WritingMode.horizontal||Oe===s.WritingMode.horizontalOnly;if(!Pe&&!Ce||ve.isHidden()||ne++,Pe){const Je=Go(ve.text);ie(n.text,te,ft?bn:Je),ie(n.text,le,je?bn:Je);const Ve=ve.text.isHidden(),{leftJustifiedTextSymbolIndex:dt,centerJustifiedTextSymbolIndex:Be,rightJustifiedTextSymbolIndex:Qe,verticalPlacedTextSymbolIndex:ht}=W,ct=n.text.placedSymbolArray,gt=Ve||ft?1:0;dt>=0&&(ct.get(dt).hidden=gt),Be>=0&&(ct.get(Be).hidden=gt),Qe>=0&&(ct.get(Qe).hidden=gt),ht>=0&&(ct.get(ht).hidden=Ve||je?1:0);const Ut=this.variableOffsets[ce];Ut&&this.markUsedJustification(n,Ut.anchor,W,Oe);const er=this.placedOrientations[ce];er&&(this.markUsedJustification(n,"left",W,er),this.markUsedOrientation(n,er,W))}if(Ce){const Je=Go(ve.icon),{placedIconSymbolIndex:Ve,verticalPlacedIconSymbolIndex:dt}=W,Be=n.icon.placedSymbolArray,Qe=ve.icon.isHidden()?1:0;Ve>=0&&(ie(n.icon,xe,ft?bn:Je),Be.get(Ve).hidden=Qe),dt>=0&&(ie(n.icon,W.numVerticalIconVertices,je?bn:Je),Be.get(dt).hidden=Qe)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Je=n.collisionArrays[se];if(Je){let Ve=new s.Point(0,0),dt=!0;if(Je.textBox||Je.verticalTextBox){if(N){const Qe=this.variableOffsets[ce];Qe?(Ve=fs(Qe.anchor,Qe.width,Qe.height,Qe.textOffset,Qe.textScale),z&&Ve._rotate($?this.transform.angle:-this.transform.angle)):dt=!1}b&&(dt=!ve.clipped),Je.textBox&&Ks(n.textCollisionBox.collisionVertexArray,ve.text.placed,!dt||ft,Ve.x,Ve.y),Je.verticalTextBox&&Ks(n.textCollisionBox.collisionVertexArray,ve.text.placed,!dt||je,Ve.x,Ve.y)}const Be=dt&&!!(!je&&Je.verticalIconBox);Je.iconBox&&Ks(n.iconCollisionBox.collisionVertexArray,ve.icon.placed,Be,K?Ve.x:0,K?Ve.y:0),Je.verticalIconBox&&Ks(n.iconCollisionBox.collisionVertexArray,ve.icon.placed,!Be,K?Ve.x:0,K?Ve.y:0)}}}if(n.fullyClipped=ne===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=se.invProjMatrix,n.placementViewportMatrix=se.viewportMatrix,n.collisionCircleArray=se.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const f=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*f>n}setStale(){this.stale=!0}}function Ks(h,n,a,f,y){h.emplaceBack(n?1:0,a?1:0,f||0,y||0),h.emplaceBack(n?1:0,a?1:0,f||0,y||0),h.emplaceBack(n?1:0,a?1:0,f||0,y||0),h.emplaceBack(n?1:0,a?1:0,f||0,y||0)}const ni=Math.pow(2,25),tn=Math.pow(2,24),Vu=Math.pow(2,17),Gc=Math.pow(2,16),ii=Math.pow(2,9),gs=Math.pow(2,8),$u=Math.pow(2,1);function Go(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const n=h.placed?1:0,a=Math.floor(127*h.opacity);return a*ni+n*tn+a*Vu+n*Gc+a*ii+n*gs+a*$u+n}const bn=0;class Yl{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,a,f,y,b){const C=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(C,y,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(((A,I)=>A.sortKey-I.sortKey)));this._currentPartIndex<C.length;){const A=C[this._currentPartIndex];if(a.placeLayerBucketPart(A,this._seenCrossTileIDs,f,A.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class xa{constructor(n,a,f,y,b,C,A,I){this.placement=new Ls(n,b,C,A,I),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(n,a,f){const y=s.exported.now(),b=()=>{const C=s.exported.now()-y;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=a[n[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=A)&&(!C.maxzoom||C.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Yl(C)),this._inProgressLayer.continuePlacement(f[C.source],this.placement,this._showCollisionBoxes,C,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const js=512/s.EXTENT/2;class An{constructor(n,a,f){this.tileID=n,this.bucketInstanceId=f,this.index=new s.KDBush(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=n.canonical.x*s.EXTENT,b=n.canonical.y*s.EXTENT;for(let C=0;C<a.length;C++){const{key:A,crossTileID:I,tileAnchorX:N,tileAnchorY:z}=a.get(C),$=Math.floor((y+N)*js),K=Math.floor((b+z)*js);this.index.add($,K),this.keys.push(A),this.crossTileIDs.push(I)}this.index.finish()}findMatches(n,a,f){const y=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),b=js/Math.pow(2,a.canonical.z-this.tileID.canonical.z),C=a.canonical.x*s.EXTENT,A=a.canonical.y*s.EXTENT;for(let I=0;I<n.length;I++){const N=n.get(I);if(N.crossTileID)continue;const{key:z,tileAnchorX:$,tileAnchorY:K}=N,re=Math.floor((C+$)*b),ie=Math.floor((A+K)*b),ne=this.index.range(re-y,ie-y,re+y,ie+y);for(const se of ne){const W=this.crossTileIDs[se];if(this.keys[se]===z&&!f.has(W)){f.add(W),N.crossTileID=W;break}}}}}class nl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(a!==0)for(const f in this.indexes){const y=this.indexes[f],b={};for(const C in y){const A=y[C];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+a),b[A.tileID.key]=A}this.indexes[f]=b}this.lng=n}addBucket(n,a,f){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const y=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const C=this.indexes[b];if(Number(b)>n.overscaledZ)for(const A in C){const I=C[A];I.tileID.isChildOf(n)&&I.findMatches(a.symbolInstances,n,y)}else{const A=C[n.scaledTo(Number(b)).key];A&&A.findMatches(a.symbolInstances,n,y)}}for(let b=0;b<a.symbolInstances.length;b++){const C=a.symbolInstances.get(b);C.crossTileID||(C.crossTileID=f.generate(),y.add(C.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new An(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const f of a.crossTileIDs)this.usedCrossTileIDs[n].delete(f)}removeStaleBuckets(n){let a=!1;for(const f in this.indexes){const y=this.indexes[f];for(const b in y)n[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,y[b]),delete y[b],a=!0)}return a}}class vo{constructor(){this.layerIndexes={},this.crossTileIDs=new nl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,f,y){let b=this.layerIndexes[n.id];b===void 0&&(b=this.layerIndexes[n.id]=new Gu);let C=!1;const A={};y.name!=="globe"&&b.handleWrapJump(f);for(const I of a){const N=I.getBucket(n);N&&n.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(I.tileID,N,this.crossTileIDs)&&(C=!0),A[N.bucketInstanceId]=!0)}return b.removeStaleBuckets(A)&&(C=!0),C}pruneUnusedLayers(n){const a={};n.forEach((f=>{a[f]=!0}));for(const f in this.layerIndexes)a[f]||delete this.layerIndexes[f]}}const Ys=(h,n)=>s.emitValidationErrors(h,n&&n.filter((a=>a.identifier!=="source.canvas"))),va=s.pick(Vr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Wu=s.pick(Vr,["setCenter","setZoom","setBearing","setPitch"]),Wc={version:8,layers:[],sources:{}},Qi={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ys extends s.Evented{constructor(n,a={}){super(),this.map=n,this.dispatcher=new Te(ya(),this),this.imageManager=new ut,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(n._requestManager,a.localFontFamily?s.LocalGlyphMode.all:a.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,a.localFontFamily||a.localIdeographFontFamily),this.crossTileSymbolIndex=new vo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const f=this;this._rtlTextPluginCallback=ys.registerForPluginStateChange((y=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},((b,C)=>{if(s.triggerPluginCompletionEvent(b),C&&C.every((A=>A)))for(const A in f._sourceCaches){const I=f._sourceCaches[A],N=I.getSource().type;N!=="vector"&&N!=="geojson"||I.reload()}}))})),this.on("data",(y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getSource(y.sourceId);if(b&&b.vectorLayerIds)for(const C in this._layers){const A=this._layers[C];A.source===b.id&&this._validateLayer(A)}}))}loadURL(n,a={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const f=typeof a.validate=="boolean"?a.validate:!s.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,a.accessToken);const y=this.map._requestManager.transformRequest(n,s.ResourceType.Style);this._request=s.getJSON(y,((b,C)=>{this._request=null,b?this.fire(new s.ErrorEvent(b)):C&&this._load(C,f)}))}loadJSON(n,a={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame((()=>{this._request=null,this._load(n,a.validate!==!1)}))}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(Wc,!1)}_updateLayerCount(n,a){const f=a?1:-1;n.is3D()&&(this._num3DLayers+=f),n.type==="circle"&&(this._numCircleLayers+=f),n.type==="symbol"&&(this._numSymbolLayers+=f)}_load(n,a){if(a&&Ys(this,s.validateStyle(n)))return;this._loaded=!0,this.stylesheet=s.clone$1(n),this._updateMapProjection();for(const y in n.sources)this.addSource(y,n.sources[y],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const f=Fu(this.stylesheet.layers);this._order=f.map((y=>y.id)),this._layers={},this._serializedLayers={};for(const y of f){const b=s.createStyleLayer(y);b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new nr(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=(function(a,f,y){let b,C,A;const I=s.exported.devicePixelRatio>1?"@2x":"";let N=s.getJSON(f.transformRequest(f.normalizeSpriteURL(a,I,".json"),s.ResourceType.SpriteJSON),((K,re)=>{N=null,A||(A=K,b=re,$())})),z=s.getImage(f.transformRequest(f.normalizeSpriteURL(a,I,".png"),s.ResourceType.SpriteImage),((K,re)=>{z=null,A||(A=K,C=re,$())}));function $(){if(A)y(A);else if(b&&C){const K=s.exported.getImageData(C),re={};for(const ie in b){const{width:ne,height:se,x:W,y:te,sdf:le,pixelRatio:ce,stretchX:xe,stretchY:be,content:ve}=b[ie],Pe=new s.RGBAImage({width:ne,height:se});s.RGBAImage.copy(K,Pe,{x:W,y:te},{x:0,y:0},{width:ne,height:se}),re[ie]={data:Pe,pixelRatio:ce,sdf:le,stretchX:xe,stretchY:be,content:ve}}y(null,re)}}return{cancel(){N&&(N.cancel(),N=null),z&&(z.cancel(),z=null)}}})(n,this.map._requestManager,((a,f)=>{if(this._spriteRequest=null,a)this.fire(new s.ErrorEvent(a));else if(f)for(const y in f)this.imageManager.addImage(y,f[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))}))}_validateLayer(n){const a=this.getSource(n.source);if(!a)return;const f=n.sourceLayer;f&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(f)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const a=[];for(const f of n){const y=this._layers[f];y.type!=="custom"&&a.push(y.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&(typeof n.isLayerDraped=="function"?n.isLayerDraped():Qi[n.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const a=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(y.length||b.length)&&this._updateWorkerLayers(y,b);for(const C in this._updatedSources){const A=this._updatedSources[C];A==="reload"?this._reloadSource(C):A==="clear"&&this._clearSource(C)}this._updateTilesForChangedImages();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const f={};for(const y in this._sourceCaches){const b=this._sourceCaches[y];f[y]=b.used,b.used=!1}for(const y of this._order){const b=this._layers[y];if(b.recalculate(n,this._availableImages),!b.isHidden(n.zoom)){const A=this._getLayerSourceCache(b);A&&(A.used=!0)}const C=this.map.painter;if(C){const A=b.getProgramIds();if(!A)continue;const I=b.getProgramConfiguration(n.zoom);for(const N of A)C.useProgram(N,I)}}for(const y in f){const b=this._sourceCaches[y];f[y]!==b.used&&b.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Ys(this,s.validateStyle(n)))return!1;(n=s.clone$1(n)).layers=Fu(n.layers);const a=(function(y,b){if(!y)return[{command:Vr.setStyle,args:[b]}];let C=[];try{if(!U(y.version,b.version))return[{command:Vr.setStyle,args:[b]}];U(y.center,b.center)||C.push({command:Vr.setCenter,args:[b.center]}),U(y.zoom,b.zoom)||C.push({command:Vr.setZoom,args:[b.zoom]}),U(y.bearing,b.bearing)||C.push({command:Vr.setBearing,args:[b.bearing]}),U(y.pitch,b.pitch)||C.push({command:Vr.setPitch,args:[b.pitch]}),U(y.sprite,b.sprite)||C.push({command:Vr.setSprite,args:[b.sprite]}),U(y.glyphs,b.glyphs)||C.push({command:Vr.setGlyphs,args:[b.glyphs]}),U(y.transition,b.transition)||C.push({command:Vr.setTransition,args:[b.transition]}),U(y.light,b.light)||C.push({command:Vr.setLight,args:[b.light]}),U(y.fog,b.fog)||C.push({command:Vr.setFog,args:[b.fog]}),U(y.projection,b.projection)||C.push({command:Vr.setProjection,args:[b.projection]});const A={},I=[];(function($,K,re,ie){let ne;for(ne in K=K||{},$=$||{})$.hasOwnProperty(ne)&&(K.hasOwnProperty(ne)||Hl(ne,re,ie));for(ne in K){if(!K.hasOwnProperty(ne))continue;const se=K[ne];$.hasOwnProperty(ne)?U($[ne],se)||($[ne].type==="geojson"&&se.type==="geojson"&&Vc($,K,ne)?re.push({command:Vr.setGeoJSONSourceData,args:[ne,se.data]}):Tn(ne,K,re,ie)):Ou(ne,K,re)}})(y.sources,b.sources,I,A);const N=[];y.layers&&y.layers.forEach(($=>{$.source&&A[$.source]?C.push({command:Vr.removeLayer,args:[$.id]}):N.push($)}));let z=y.terrain;z&&A[z.source]&&(C.push({command:Vr.setTerrain,args:[void 0]}),z=void 0),C=C.concat(I),U(z,b.terrain)||C.push({command:Vr.setTerrain,args:[b.terrain]}),(function($,K,re){K=K||[];const ie=($=$||[]).map(Hs),ne=K.map(Hs),se=$.reduce(Ja,{}),W=K.reduce(Ja,{}),te=ie.slice(),le=Object.create(null);let ce,xe,be,ve,Pe,Ce,Oe;for(ce=0,xe=0;ce<ie.length;ce++)be=ie[ce],W.hasOwnProperty(be)?xe++:(re.push({command:Vr.removeLayer,args:[be]}),te.splice(te.indexOf(be,xe),1));for(ce=0,xe=0;ce<ne.length;ce++)be=ne[ne.length-1-ce],te[te.length-1-ce]!==be&&(se.hasOwnProperty(be)?(re.push({command:Vr.removeLayer,args:[be]}),te.splice(te.lastIndexOf(be,te.length-xe),1)):xe++,Ce=te[te.length-ce],re.push({command:Vr.addLayer,args:[W[be],Ce]}),te.splice(te.length-ce,0,be),le[be]=!0);for(ce=0;ce<ne.length;ce++)if(be=ne[ce],ve=se[be],Pe=W[be],!le[be]&&!U(ve,Pe))if(U(ve.source,Pe.source)&&U(ve["source-layer"],Pe["source-layer"])&&U(ve.type,Pe.type)){for(Oe in ds(ve.layout,Pe.layout,re,be,null,Vr.setLayoutProperty),ds(ve.paint,Pe.paint,re,be,null,Vr.setPaintProperty),U(ve.filter,Pe.filter)||re.push({command:Vr.setFilter,args:[be,Pe.filter]}),U(ve.minzoom,Pe.minzoom)&&U(ve.maxzoom,Pe.maxzoom)||re.push({command:Vr.setLayerZoomRange,args:[be,Pe.minzoom,Pe.maxzoom]}),ve)ve.hasOwnProperty(Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&(Oe.indexOf("paint.")===0?ds(ve[Oe],Pe[Oe],re,be,Oe.slice(6),Vr.setPaintProperty):U(ve[Oe],Pe[Oe])||re.push({command:Vr.setLayerProperty,args:[be,Oe,Pe[Oe]]}));for(Oe in Pe)Pe.hasOwnProperty(Oe)&&!ve.hasOwnProperty(Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&(Oe.indexOf("paint.")===0?ds(ve[Oe],Pe[Oe],re,be,Oe.slice(6),Vr.setPaintProperty):U(ve[Oe],Pe[Oe])||re.push({command:Vr.setLayerProperty,args:[be,Oe,Pe[Oe]]}))}else re.push({command:Vr.removeLayer,args:[be]}),Ce=te[te.lastIndexOf(be)+1],re.push({command:Vr.addLayer,args:[Pe,Ce]})})(N,b.layers,C)}catch(A){console.warn("Unable to compute style diff:",A),C=[{command:Vr.setStyle,args:[b]}]}return C})(this.serialize(),n).filter((y=>!(y.command in Wu)));if(a.length===0)return!1;const f=a.filter((y=>!(y.command in va)));if(f.length>0)throw new Error(`Unimplemented: ${f.map((y=>y.command)).join(", ")}.`);return a.forEach((y=>{y.command!=="setTransition"&&y.command!=="setProjection"&&this[y.command].apply(this,y.args)})),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,a){return this.getImage(n)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,a),this._afterImageUpdated(n),this)}updateImage(n,a){this.imageManager.updateImage(n,a)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,a,f={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(s.validateSource,`sources.${n}`,a,null,f))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const y=fr(n,a,this.dispatcher,this);y.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:y.serialize(),sourceId:n})));const b=C=>{const A=(C?"symbol:":"other:")+n,I=this._sourceCaches[A]=new s.SourceCache(A,y,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[n]=I,I.style=this,I.onAdd(this.map)};b(!1),a.type!=="vector"&&a.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const a=this.getSource(n);if(!a)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===n)return this.fire(new s.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new s.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const f=this._getSourceCaches(n);for(const y of f)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getSource(n).setData(a),this._changed=!0}getSource(n){const a=this._getSourceCache(n);return a&&a.getSource()}_getSources(){const n=[];for(const a in this._otherSourceCaches){const f=this._getSourceCache(a);f&&n.push(f.getSource())}return n}addLayer(n,a,f={}){this._checkLoaded();const y=n.id;if(this.getLayer(y))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(n.type==="custom"){if(Ys(this,s.validateCustomStyleLayer(n)))return;b=s.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(y,n.source),n=s.clone$1(n),n=s.extend(n,{source:y})),this._validate(s.validateLayer,`layers.${y}`,n,{arrayIndex:-1},f))return;b=s.createStyleLayer(n),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const C=a?this._order.indexOf(a):this._order.length;if(a&&C===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`)));this._order.splice(C,0,y),this._layerOrderChanged=!0,this._layers[y]=b;const A=this._getLayerSourceCache(b);if(this._removedLayers[y]&&b.source&&A&&b.type!=="custom"){const I=this._removedLayers[y];delete this._removedLayers[y],I.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",A.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,a){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===a)return;const f=this._order.indexOf(n);this._order.splice(f,1);const y=a?this._order.indexOf(a):this._order.length;a&&y===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`))):(this._order.splice(y,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const a=this._layers[n];if(!a)return void this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));a.setEventedParent(null),this._updateLayerCount(a,!1);const f=this._order.indexOf(n);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=a,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],a.onRemove&&a.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,f){this._checkLoaded();const y=this.getLayer(n);y?y.minzoom===a&&y.maxzoom===f||(a!=null&&(y.minzoom=a),f!=null&&(y.maxzoom=f),this._updateLayer(y)):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,a,f={}){this._checkLoaded();const y=this.getLayer(n);if(y){if(!U(y.filter,a))return a==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(s.validateFilter,`layers.${y.id}.filter`,a,{layerType:y.type},f)||(y.filter=s.clone$1(a),this._updateLayer(y)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const a=this.getLayer(n);return a&&s.clone$1(a.filter)}setLayoutProperty(n,a,f,y={}){this._checkLoaded();const b=this.getLayer(n);b?U(b.getLayoutProperty(a),f)||(b.setLayoutProperty(a,f,y),this._updateLayer(b)):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,a){const f=this.getLayer(n);if(f)return f.getLayoutProperty(a);this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,a,f,y={}){this._checkLoaded();const b=this.getLayer(n);b?U(b.getPaintProperty(a),f)||(b.setPaintProperty(a,f,y)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,a){const f=this.getLayer(n);return f&&f.getPaintProperty(a)}setFeatureState(n,a){this._checkLoaded();const f=n.source,y=n.sourceLayer,b=this.getSource(f);if(!b)return void this.fire(new s.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const C=b.type;if(C==="geojson"&&y)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(C==="vector"&&!y)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(f);for(const I of A)I.setFeatureState(y,n.id,a)}removeFeatureState(n,a){this._checkLoaded();const f=n.source,y=this.getSource(f);if(!y)return void this.fire(new s.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const b=y.type,C=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!C)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(f);for(const I of A)I.removeFeatureState(C,n.id,a)}getFeatureState(n){this._checkLoaded();const a=n.source,f=n.sourceLayer,y=this.getSource(a);if(y){if(y.type!=="vector"||f)return n.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(a)[0].getFeatureState(f,n.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const a in this._sourceCaches){const f=this._sourceCaches[a].getSource();n[f.id]||(n[f.id]=f.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},(a=>a!==void 0))}_updateLayer(n){this._updatedLayers[n.id]=!0;const a=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&a&&a.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",a.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const a=C=>this._layers[C].type==="fill-extrusion",f={},y=[];for(let C=this._order.length-1;C>=0;C--){const A=this._order[C];if(a(A)){f[A]=C;for(const I of n){const N=I[A];if(N)for(const z of N)y.push(z)}}}y.sort(((C,A)=>A.intersectionZ-C.intersectionZ));const b=[];for(let C=this._order.length-1;C>=0;C--){const A=this._order[C];if(a(A))for(let I=y.length-1;I>=0;I--){const N=y[I].feature;if(f[N.layer.id]<C)break;b.push(N),y.pop()}else for(const I of n){const N=I[A];if(N)for(const z of N)b.push(z.feature)}}return b}queryRenderedFeatures(n,a,f){a&&a.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",a.filter,null,a);const y={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const I of a.layers){const N=this._layers[I];if(!N)return this.fire(new s.ErrorEvent(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];y[N.source]=!0}}const b=[];a.availableImages=this._availableImages;const C=a&&a.layers?a.layers.some((I=>{const N=this.getLayer(I);return N&&N.is3D()})):this.has3DLayers(),A=Gt.createFromScreenPoints(n,f);for(const I in this._sourceCaches){const N=this._sourceCaches[I].getSource().id;a.layers&&!y[N]||b.push(_n(this._sourceCaches[I],this._layers,this._serializedLayers,A,a,f,C,!!this.map._showQueryGeometry))}return this.placement&&b.push((function(I,N,z,$,K,re,ie){const ne={},se=re.queryRenderedSymbols($),W=[];for(const te of Object.keys(se).map(Number))W.push(ie[te]);W.sort(_i);for(const te of W){const le=te.featureIndex.lookupSymbolFeatures(se[te.bucketInstanceId],N,te.bucketIndex,te.sourceLayerIndex,K.filter,K.layers,K.availableImages,I);for(const ce in le){const xe=ne[ce]=ne[ce]||[],be=le[ce];be.sort(((ve,Pe)=>{const Ce=te.featureSortOrder;if(Ce){const Oe=Ce.indexOf(ve.featureIndex);return Ce.indexOf(Pe.featureIndex)-Oe}return Pe.featureIndex-ve.featureIndex}));for(const ve of be)xe.push(ve)}}for(const te in ne)ne[te].forEach((le=>{const ce=le.feature,xe=z(I[te]);if(!xe)return;const be=xe.getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=be}));return ne})(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(n,a){a&&a.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",a.filter,null,a);const f=this._getSourceCaches(n);let y=[];for(const b of f)y=y.concat(jn(b,a));return y}addSourceType(n,a,f){return ys.getSourceType(n)?f(new Error(`A source type called "${n}" already exists.`)):(ys.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(n,a={}){this._checkLoaded();const f=this.light.getLight();let y=!1;for(const C in n)if(!U(n[C],f[C])){y=!0;break}if(!y)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,a),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,a=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let f=n;if(a===1){if(typeof f.source=="object"){const y="terrain-dem-src";this.addSource(y,f.source),f=s.clone$1(f),f=s.extend(f,{source:y})}if(this._validate(s.validateTerrain,"terrain",f))return}if(!this.terrain||this.terrain&&a!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,a)}else{const y=this.terrain,b=y.get();for(const C of Object.keys(s.spec.terrain))!f.hasOwnProperty(C)&&s.spec.terrain[C].default&&(f[C]=s.spec.terrain[C].default);for(const C in f)if(!U(f[C],b[C])){y.set(f),this.stylesheet.terrain=f;const A=this._setTransitionParameters({duration:0});y.updateTransitions(A);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const a=this.fog=new _t(n,this.map.transform);this.stylesheet.fog=n;const f=this._setTransitionParameters({duration:0});a.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const n of this.map._markers)n._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog,f=a.get();Object.keys(n).length===0&&a.set(n);for(const y in n)if(!U(n[y],f[y])){a.set(n),this.stylesheet.fog=n;const b=this._setTransitionParameters({duration:0});a.updateTransitions(b);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:s.exported.now(),transition:s.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter((f=>this.isLayerDraped(this._layers[f]))),a=this._order.filter((f=>!this.isLayerDraped(this._layers[f])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){const f=this.terrain=new ir(n,a);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const y=this._setTransitionParameters({duration:0});f.updateTransitions(y)}_force3DLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="symbol"&&this._updateLayer(a)}}_validate(n,a,f,y,b={}){return(!b||b.validate!==!1)&&Ys(this,n.call(s.validateStyle,s.extend({key:a,style:this.serialize(),value:f,styleSpec:s.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const a=this._getSourceCaches(n);for(const f of a)f.clearTiles()}_reloadSource(n){const a=this._getSourceCaches(n);for(const f of a)f.resume(),f.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const a in this._sourceCaches)this._sourceCaches[a].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,f,y,b=!1){let C=!1,A=!1;const I={};for(const N of this._order){const z=this._layers[N];if(z.type!=="symbol")continue;if(!I[z.source]){const K=this._getLayerSourceCache(z);if(!K)continue;I[z.source]=K.getRenderableIds(!0).map((re=>K.getTileByID(re))).sort(((re,ie)=>ie.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(ie.tileID)?-1:1)))}const $=this.crossTileSymbolIndex.addLayer(z,I[z.source],n.center.lng,n.projection);C=C||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),n.zoom))&&(this.pauseablePlacement=new xa(n,this._order,b,a,f,y,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),A=!0),C&&this.pauseablePlacement.placement.setStale()),A||C)for(const N of this._order){const z=this._layers[N];z.type==="symbol"&&this.placement.updateLayerOpacities(z,I[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,a,f){this.imageManager.getImages(a.icons,f),this._updateTilesForChangedImages();const y=b=>{b&&b.setDependencies(a.tileID.key,a.type,a.icons)};y(this._otherSourceCaches[a.source]),y(this._symbolSourceCaches[a.source])}getGlyphs(n,a,f){this.glyphManager.getGlyphs(a.stacks,f)}getResource(n,a,f){return s.makeRequest(a,f)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){const a=this._getSourceCaches(n);return a.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):a.every((f=>f.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ys.getSourceType=function(h){return ur[h]},ys.setSourceType=function(h,n){ur[h]=n},ys.registerForPluginStateChange=s.registerForPluginStateChange;var il=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Wo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",_s=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,qo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Js=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let xi={},Rs={};const ba=[];Qs(il,ba),Qs(_s,ba),Qs(qo,ba),Qs(Js,ba),xi=Nr("",_s),Rs=Nr(Js,qo);const sl=Nr(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),qc=il,Jl=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Ql={background:Nr(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Nr(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Nr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Nr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Nr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Nr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Nr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Nr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Nr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Nr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Nr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Nr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Nr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Nr(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Nr(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Nr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Nr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Nr(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Nr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Nr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Nr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Nr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Nr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Nr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Nr(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Nr(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Wo),skyboxGradient:Nr(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Wo),skyboxCapture:Nr(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Nr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Nr(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Qs(h,n){const a=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of a)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=f.split(" ");for(const b of y)n.includes(b)||n.push(b)}}function Nr(h,n){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),y={},b=[...ba];return Qs(h,b),Qs(n,b),{fragmentSource:h=h.replace(a,((C,A,I,N,z)=>(y[z]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${z}
varying ${I} ${N} ${z};
#else
uniform ${I} ${N} u_${z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${z}
    ${I} ${N} ${z} = u_${z};
#endif
`))),vertexSource:n=n.replace(a,((C,A,I,N,z)=>{const $=N==="float"?"vec2":"vec4",K=z.match(/color/)?"color":$;return y[z]?A==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${I} ${$} a_${z};
varying ${I} ${N} ${z};
#else
uniform ${I} ${N} u_${z};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${I} ${N} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${K}(a_${z}, u_${z}_t);
#else
    ${I} ${N} ${z} = u_${z};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${I} ${$} a_${z};
#else
uniform ${I} ${N} u_${z};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${I} ${N} ${z} = a_${z};
#else
    ${I} ${N} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${I} ${N} ${z} = unpack_mix_${K}(a_${z}, u_${z}_t);
#else
    ${I} ${N} ${z} = u_${z};
#endif
`})),staticAttributes:f,usedDefines:b}}class Qh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,f,y,b,C,A){this.context=n;let I=this.boundPaintVertexBuffers.length!==y.length;for(let z=0;!I&&z<y.length;z++)this.boundPaintVertexBuffers[z]!==y[z]&&(I=!0);let N=this.boundDynamicVertexBuffers.length!==A.length;for(let z=0;!N&&z<A.length;z++)this.boundDynamicVertexBuffers[z]!==A[z]&&(N=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==f||I||N||this.boundIndexBuffer!==b||this.boundVertexOffset!==C)this.freshBind(a,f,y,b,C,A);else{n.bindVertexArrayOES.set(this.vao);for(const z of A)z&&z.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(n,a,f,y,b,C){let A;const I=n.numAttributes,N=this.context,z=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=C;else{A=N.currentNumAttributes||0;for(let $=I;$<A;$++)z.disableVertexAttribArray($)}a.enableAttributes(z,n),a.bind(),a.setVertexAttribPointers(z,n,b);for(const $ of f)$.enableAttributes(z,n),$.bind(),$.setVertexAttribPointers(z,n,b);for(const $ of C)$&&($.enableAttributes(z,n),$.bind(),$.setVertexAttribPointers(z,n,b));y&&y.bind(),N.currentNumAttributes=I}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function qu(h,n){const a=Math.pow(2,n.canonical.z),f=n.canonical.y;return[new s.MercatorCoordinate(0,f/a).toLngLat().lat,new s.MercatorCoordinate(0,(f+1)/a).toLngLat().lat]}function ed(h,n,a,f,y,b,C){const A=h.context,I=A.gl,N=a.fbo;if(!N)return;h.prepareDrawTile();const z=h.useProgram("hillshade");A.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,N.colorAttachment.get());const $=((ne,se,W,te)=>{const le=W.paint.get("hillshade-shadow-color"),ce=W.paint.get("hillshade-highlight-color"),xe=W.paint.get("hillshade-accent-color");let be=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(be-=ne.transform.angle);const ve=!ne.options.moving;return{u_matrix:te||ne.transform.calculateProjMatrix(se.tileID.toUnwrapped(),ve),u_image:0,u_latrange:qu(0,se.tileID),u_light:[W.paint.get("hillshade-exaggeration"),be],u_shadow:le,u_highlight:ce,u_accent:xe}})(h,a,f,h.terrain?n.projMatrix:null);h.prepareDrawProgram(A,z,n.toUnwrapped());const{tileBoundsBuffer:K,tileBoundsIndexBuffer:re,tileBoundsSegments:ie}=h.getTileBoundsBuffers(a);z.draw(A,I.TRIANGLES,y,b,C,s.CullFaceMode.disabled,$,f.id,K,re,ie)}function Zu(h,n,a){if(!n.needsDEMTextureUpload)return;const f=h.context,y=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||h.getTileTexture(a.stride);const b=a.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new s.Texture(f,b,y.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Zc(h,n,a,f,y,b){const C=h.context,A=C.gl;if(!n.dem)return;const I=n.dem;if(C.activeTexture.set(A.TEXTURE1),Zu(h,n,I),!n.demTexture)return;n.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const N=I.dim;C.activeTexture.set(A.TEXTURE0);let z=n.fbo;if(!z){const ie=new s.Texture(C,{width:N,height:N,data:null},A.RGBA);ie.bind(A.LINEAR,A.CLAMP_TO_EDGE),z=n.fbo=C.createFramebuffer(N,N,!0),z.colorAttachment.set(ie.texture)}C.bindFramebuffer.set(z.framebuffer),C.viewport.set([0,0,N,N]);const{tileBoundsBuffer:$,tileBoundsIndexBuffer:K,tileBoundsSegments:re}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(C,A.TRIANGLES,f,y,b,s.CullFaceMode.disabled,((ie,ne)=>{const se=ne.stride,W=s.create();return s.ortho(W,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(W,W,[0,-s.EXTENT,0]),{u_matrix:W,u_image:1,u_dimension:[se,se],u_zoom:ie.overscaledZ,u_unpack:ne.unpackVector}})(n.tileID,I),a.id,$,K,re),n.needsHillshadePrepare=!1}const Hu=h=>({u_matrix:new s.UniformMatrix4f(h),u_image0:new s.Uniform1i(h),u_skirt_height:new s.Uniform1f(h)}),ol=(h,n)=>({u_matrix:h,u_image0:0,u_skirt_height:n}),Hc=(h,n,a,f,y,b,C,A,I,N,z,$,K,re,ie)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:a,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_frustum_tl:C,u_frustum_tr:A,u_frustum_br:I,u_frustum_bl:N,u_globe_pos:z,u_globe_radius:$,u_viewport:K,u_grid_matrix:ie?Float32Array.from(ie):new Float32Array(9),u_skirt_height:re});function al(h,n){return h!=null&&n!=null&&!(!h.hasData()||!n.hasData())&&h.demTexture!=null&&n.demTexture!=null&&h.tileID.key!==n.tileID.key}const bo=new class{constructor(){this.operations={}}newMorphing(h,n,a,f,y){if(h in this.operations){const b=this.operations[h];b.to.tileID.key!==a.tileID.key&&(b.queued=a)}else this.operations[h]={startTime:f,phase:0,duration:y,from:n,to:a,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const n=this.operations[h];return{from:n.from,to:n.to,phase:n.phase}}update(h){for(const n in this.operations){const a=this.operations[n];for(a.phase=(h-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,h)){delete this.operations[n];break}}}_nextOp(h,n){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=n,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Zo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Xc(h){return 6*Math.pow(1.5,22-h)}function td(h,n){const a=1<<h.z;return!n&&(h.x===0||h.x===a-1)||h.y===0||h.y===a-1}const ec=h=>({u_matrix:h});function Xu(h,n,a,f,y){if(y>0){const b=s.exported.now(),C=(b-h.timeAdded)/y,A=n?(b-n.timeAdded)/y:-1,I=a.getSource(),N=f.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),z=!n||Math.abs(n.tileID.overscaledZ-N)>Math.abs(h.tileID.overscaledZ-N),$=z&&h.refreshedUponExpiration?1:s.clamp(z?C:1-A,0,1);return h.refreshedUponExpiration&&C>=1&&(h.refreshedUponExpiration=!1),n?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}class tc extends s.SourceCache{constructor(n){const a={type:"raster-dem",maxzoom:n.transform.maxZoom},f=new Te(ya(),null),y=fr("mock-dem",a,f,n.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class Kc extends s.SourceCache{constructor(n){const a=fr("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new Te(ya(),null),n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,f){if(n.freezeTileCoverage)return;this.transform=n;const y=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((b,C)=>{if(b[C.key]="",!this._tiles[C.key]){const A=new s.Tile(C,this._source.tileSize*C.overscaleFactor(),n.tileZoom);A.state="loaded",this._tiles[C.key]=A}return b}),{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const a=this.proxyCachedFBO[n];if(a!==void 0){const f=Object.values(a);this.renderCachePool.push(...f),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach((n=>n.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Yc extends s.OverscaledTileID{constructor(n,a,f){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=f}}class Ku extends s.Elevation{constructor(n,a){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,y,b]=(function(I){const N=new s.StructArrayLayout2i4,z=new s.StructArrayLayout3ui6,$=131;N.reserve(17161),z.reserve(33800);const K=s.EXTENT/128,re=s.EXTENT+K/2,ie=re+K;for(let se=-K;se<ie;se+=K)for(let W=-K;W<ie;W+=K){const te=W<0||W>re||se<0||se>re?24575:0,le=s.clamp(Math.round(W),0,s.EXTENT),ce=s.clamp(Math.round(se),0,s.EXTENT);N.emplaceBack(le+te,ce)}const ne=(se,W)=>{const te=W*$+se;z.emplaceBack(te+1,te,te+$),z.emplaceBack(te+$,te+$+1,te+1)};for(let se=1;se<129;se++)for(let W=1;W<129;W++)ne(W,se);return[0,129].forEach((se=>{for(let W=0;W<130;W++)ne(W,se),ne(se,W)})),[N,z,32768]})(),C=n.context;this.gridBuffer=C.createVertexBuffer(f,s.posAttributes.members),this.gridIndexBuffer=C.createIndexBuffer(y),this.gridSegments=s.SegmentVector.simpleSegment(0,0,f.length,y.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,f.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Kc(a.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.EXTENT,0,s.EXTENT,0,1);const A=C.gl;this._overlapStencilMode=new s.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new tc(a.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(n,a,f){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const y=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const b=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const C=this.getScaledDemTileSize();this.sourceCache.update(a,C,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),a.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((n=>n.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=a.getIds().map((I=>{const N=a.getTileByID(I).tileID;return N.projMatrix=f.calculateProjMatrix(N.toUnwrapped()),N}));(function(I,N){const z=N.transform.pointCoordinate(N.transform.getCameraPoint()),$=new s.Point(z.x,z.y);I.sort(((K,re)=>{if(re.overscaledZ-K.overscaledZ)return re.overscaledZ-K.overscaledZ;const ie=new s.Point(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ne=new s.Point(re.canonical.x+(1<<re.canonical.z)*re.wrap,re.canonical.y),se=$.mult(1<<K.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(ie)-se.distSqr(ne)}))})(y,this.painter),this._previousZoom=f.zoom;const b=this.proxyToSource||{};this.proxyToSource={},y.forEach((I=>{this.proxyToSource[I.key]={}})),this.terrainTileForTile={};const C=this._style._sourceCaches;for(const I in C){const N=C[I];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,n[I],b),N.usedForTerrain))continue;const z=n[I];N.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[a.id]=y.map((I=>new Yc(I,I.key,this.orthoMatrix))),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const A={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const N=this.terrainTileForTile[I.key];if(!N)continue;const z=N.tileID.key;z in A||(this._visibleDemTiles.push(N),A[z]=z)}}_assignTerrainTiles(n){this._initializing||n.forEach((a=>{if(this.terrainTileForTile[a.key])return;const f=this._findTileCoveringTileID(a,this.sourceCache);f&&(this.terrainTileForTile[a.key]=f)}))}_prepareDEMTextures(){const n=this.painter.context,a=n.gl;for(const f in this.terrainTileForTile){const y=this.terrainTileForTile[f],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),Zu(this.painter,y,b))}}_prepareDemTileUniforms(n,a,f,y){if(!a||a.demTexture==null)return!1;const b=n.tileID.canonical,C=Math.pow(2,a.tileID.canonical.z-b.z),A=y||"";return f[`u_dem_tl${A}`]=[b.x*C%1,b.y*C%1],f[`u_dem_scale${A}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,a=n.gl;if(!this._emptyDepthBufferTexture){const f=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(n,f,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const a=this._visibleDemTiles.reduce(((f,y)=>{if(!y.dem)return f;const b=y.dem.tree.minimums[0];return b>0&&n++,f+b}),0);return n?a/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);const f=this._getLoadedAreaMinimum(),y=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(f,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new s.Texture(n,y,a.RGBA,{premultiply:!1}),b}setupElevationDraw(n,a,f){const y=this.painter.context,b=y.gl,C=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var A;C.u_dem_size=this.sourceCache.getSource().tileSize,C.u_exaggeration=this.exaggeration();let I=null,N=null,z=1;if(f&&f.morphing&&this._useVertexMorphing){const $=f.morphing.srcDemTile,K=f.morphing.dstDemTile;z=f.morphing.phase,$&&K&&(this._prepareDemTileUniforms(n,$,C,"_prev")&&(N=$),this._prepareDemTileUniforms(n,K,C)&&(I=K))}if(N&&I?(y.activeTexture.set(b.TEXTURE2),I.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),y.activeTexture.set(b.TEXTURE4),N.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),C.u_dem_lerp=z):(I=this.terrainTileForTile[n.tileID.key],y.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(n,I,C)?I.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),y.activeTexture.set(b.TEXTURE3),f&&f.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(C.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),C.u_depth_size_inv=[1,1]),f&&f.useMeterToDem&&I){const $=(1<<I.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=$}if(f&&f.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),a.setTerrainUniformValues(y,C),this.painter.transform.projection.name==="globe"){const $=this.globeUniformValues(this.painter.transform,n.tileID.canonical,f&&f.useDenormalizedUpVectorScale);a.setGlobeUniformValues(y,$)}}globeUniformValues(n,a,f){const y=n.projection;return{u_tile_tl_up:y.upVector(a,0,0),u_tile_tr_up:y.upVector(a,s.EXTENT,0),u_tile_br_up:y.upVector(a,s.EXTENT,s.EXTENT),u_tile_bl_up:y.upVector(a,0,s.EXTENT),u_tile_up_scale:f?s.globeMetersToEcef(1):y.upVectorScale(a,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const a=this.painter,f=this.painter.context;n.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(y,b,C,A,I){if(y.transform.projection.name==="globe")(function(N,z,$,K,re){const ie=N.context,ne=ie.gl;let se,W;const te=N.options.showTerrainWireframe?2:0,le=N.transform,ce=s.globeUseCustomAntiAliasing(N,ie,le),xe=(dt,Be)=>{if(W===dt)return;const Qe=[Zo[dt],"PROJECTION_GLOBE_VIEW"];ce&&Qe.push("CUSTOM_ANTIALIASING"),Be&&Qe.push(Zo[te]),se=N.useProgram("globeRaster",null,Qe),W=dt},be=N.colorModeForRenderPass(),ve=new s.DepthMode(ne.LEQUAL,s.DepthMode.ReadWrite,N.depthRangeFor3D);bo.update(re);const Pe=s.calculateGlobeMercatorMatrix(le),Ce=[s.mercatorXfromLng(le.center.lng),s.mercatorYfromLat(le.center.lat)],Oe=te?[!1,!0]:[!1],ft=N.globeSharedBuffers,je=[le.width*s.exported.devicePixelRatio,le.height*s.exported.devicePixelRatio],Je=Float32Array.from(le.globeMatrix),Ve={useDenormalizedUpVectorScale:!0};if(Oe.forEach((dt=>{const Be=N.transform,Qe=Xc(Be.zoom)*z.exaggeration();W=-1;const ht=dt?ne.LINES:ne.TRIANGLES;for(const ct of K){const gt=$.getTile(ct),Ut=s.StencilMode.disabled,er=z.prevTerrainTileForTile[ct.key],Nt=z.terrainTileForTile[ct.key];al(er,Nt)&&bo.newMorphing(ct.key,er,Nt,re,250),ie.activeTexture.set(ne.TEXTURE0),gt.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const Xt=bo.getMorphValuesForProxy(ct.key),br=Xt?1:0;Xt&&s.extend$1(Ve,{morphing:{srcDemTile:Xt.from,dstDemTile:Xt.to,phase:s.easeCubicInOut(Xt.phase)}});const Er=s.tileCornersToBounds(ct.canonical),Vt=s.getLatitudinalLod(Er.getCenter().lat),Ir=s.getGridMatrix(ct.canonical,Er,Vt,Be.worldSize/Be._pixelsPerMercatorPixel),Gr=s.globeNormalizeECEF(s.globeTileBounds(ct.canonical)),Wr=Hc(Be.projMatrix,Je,Pe,Gr,s.globeToMercatorTransition(Be.zoom),Ce,Be.frustumCorners.TL,Be.frustumCorners.TR,Be.frustumCorners.BR,Be.frustumCorners.BL,Be.globeCenterInViewSpace,Be.globeRadius,je,Qe,Ir);if(xe(br,dt),z.setupElevationDraw(gt,se,Ve),N.prepareDrawProgram(ie,se,ct.toUnwrapped()),ft){const[Or,oi,Sn]=dt?ft.getWirefameBuffers(N.context,Vt):ft.getGridBuffers(Vt,Qe!==0);se.draw(ie,ht,ve,Ut,be,s.CullFaceMode.backCCW,Wr,"globe_raster",Or,oi,Sn)}}})),ft){const dt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ce&&dt.push("CUSTOM_ANTIALIASING"),se=N.useProgram("globeRaster",null,dt);for(const Be of K){const{x:Qe,y:ht,z:ct}=Be.canonical,gt=ht===0,Ut=ht===(1<<ct)-1,[er,Nt,Xt,br]=ft.getPoleBuffers(ct);if(br&&(gt||Ut)){const Er=$.getTile(Be);ie.activeTexture.set(ne.TEXTURE0),Er.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);let Vt=s.globePoleMatrixForTile(ct,Qe,le);const Ir=s.globeNormalizeECEF(s.globeTileBounds(Be.canonical)),Gr=(Wr,Or)=>Wr.draw(ie,ne.TRIANGLES,ve,s.StencilMode.disabled,be,s.CullFaceMode.disabled,Hc(le.projMatrix,Vt,Vt,Ir,0,Ce,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,je,0),"globe_pole_raster",Or,Xt,br);z.setupElevationDraw(Er,se,Ve),N.prepareDrawProgram(ie,se,Be.toUnwrapped()),gt&&Gr(se,er),Ut&&(Vt=s.scale(s.create(),Vt,[1,-1,1]),Gr(se,Nt))}}}})(y,b,C,A,I);else{const N=y.context,z=N.gl;let $,K;const re=y.options.showTerrainWireframe?2:0,ie=(le,ce)=>{if(K===le)return;const xe=[Zo[le]];ce&&xe.push(Zo[re]),$=y.useProgram("terrainRaster",null,xe),K=le},ne=y.colorModeForRenderPass(),se=new s.DepthMode(z.LEQUAL,s.DepthMode.ReadWrite,y.depthRangeFor3D);bo.update(I);const W=y.transform,te=Xc(W.zoom)*b.exaggeration();(re?[!1,!0]:[!1]).forEach((le=>{K=-1;const ce=le?z.LINES:z.TRIANGLES,[xe,be]=le?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const ve of A){const Pe=C.getTile(ve),Ce=s.StencilMode.disabled,Oe=b.prevTerrainTileForTile[ve.key],ft=b.terrainTileForTile[ve.key];al(Oe,ft)&&bo.newMorphing(ve.key,Oe,ft,I,250),N.activeTexture.set(z.TEXTURE0),Pe.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const je=bo.getMorphValuesForProxy(ve.key),Je=je?1:0;let Ve;je&&(Ve={morphing:{srcDemTile:je.from,dstDemTile:je.to,phase:s.easeCubicInOut(je.phase)}});const dt=ol(ve.projMatrix,td(ve.canonical,W.renderWorldCopies)?te/10:te);ie(Je,le),b.setupElevationDraw(Pe,$,Ve),y.prepareDrawProgram(N,$,ve.toUnwrapped()),$.draw(N,ce,se,Ce,ne,s.CullFaceMode.backCCW,dt,"terrain_raster",b.gridBuffer,xe,be)}}))}})(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const a=this.painter,f=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],C=this._drapedRenderBatches.shift(),A=[],I=a.style.order;let N=0;for(const z of b){const $=y.getTileByID(z.proxyTileKey),K=y.proxyCachedFBO[z.key]?y.proxyCachedFBO[z.key][n]:void 0,re=K!==void 0?y.renderCache[K]:this.pool[N++],ie=K!==void 0;if($.texture=re.tex,ie&&!re.dirty){A.push($.tileID);continue}let ne;f.bindFramebuffer.set(re.fb.framebuffer),this.renderedToTile=!1,re.dirty&&(f.clear({color:s.Color.transparent,stencil:0}),re.dirty=!1);for(let se=C.start;se<=C.end;++se){const W=a.style._layers[I[se]];if(W.isHidden(a.transform.zoom))continue;const te=a.style._getLayerSourceCache(W),le=te?this.proxyToSource[z.key][te.id]:[z];if(!le)continue;const ce=le;f.viewport.set([0,0,re.fb.width,re.fb.height]),ne!==(te?te.id:null)&&(this._setupStencil(re,le,W,te),ne=te?te.id:null),a.renderLayer(a,te,W,ce)}this.renderedToTile?(re.dirty=!0,A.push($.tileID)):ie||--N,N===5&&(N=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),C.end+1}postRender(){}renderCacheEfficiency(n){const a=n.order.length;if(a===0)return{efficiency:100};let f,y=0,b=0,C=!1;for(let A=0;A<a;++A){const I=n._layers[n.order[A]];this._style.isLayerDraped(I)?(C&&++y,++b):C||(C=!0,f=I.id)}return b===0?{efficiency:100}:{efficiency:100*(1-y/b),firstUndrapedLayer:f}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter((a=>a.dem)).forEach((a=>{n=Math.min(n,a.dem.tree.minimums[0])})),n===0?n:(n-30)*this._exaggeration}raycast(n,a,f){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter((b=>b.dem)).map((b=>{const C=b.tileID,A=1<<C.overscaledZ,{x:I,y:N}=C.canonical,z=I/A,$=(I+1)/A,K=N/A,re=(N+1)/A;return{minx:z,miny:K,maxx:$,maxy:re,t:b.dem.tree.raycastRoot(z,K,$,re,n,a,f),tile:b}}));y.sort(((b,C)=>(b.t!==null?b.t:Number.MAX_VALUE)-(C.t!==null?C.t:Number.MAX_VALUE)));for(const b of y){if(b.t==null)return null;const C=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,a,f);if(C!=null)return C}return null}_createFBO(){const n=this.painter.context,a=n.gl,f=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);const y=new s.Texture(n,{width:f[0],height:f[1],data:null},a.RGBA);y.bind(a.LINEAR,a.CLAMP_TO_EDGE);const b=n.createFramebuffer(f[0],f[1],!1);return b.colorAttachment.set(y.texture),b.depthAttachment=new we(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some((n=>{const a=this._style._layers[n],f=a.isHidden(this.painter.transform.zoom);return a.type==="custom"?!f&&a.shouldRedrape():!f&&a.hasTransition()}))}_clearLineLayersFromRenderCache(){let n=!1;for(const f of this._style._getSources())if(f instanceof Ct){n=!0;break}if(!n)return;const a={};for(let f=0;f<this._style.order.length;++f){const y=this._style._layers[this._style.order[f]],b=this._style._getLayerSourceCache(y);if(b&&!a[b.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof s.ZoomDependentExpression){a[b.id]=!0;for(const C of this.proxyCoords){const A=this.proxyToSource[C.key][b.id];if(A)for(const I of A)this._clearRenderCacheForTile(b.id,I)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const f in this._style._sourceCaches)if(this._style._sourceCaches[f]._source instanceof mt){n=!0;break}if(!n)return;const a={};for(let f=0;f<this._style.order.length;++f){const y=this._style._layers[this._style.order[f]],b=this._style._getLayerSourceCache(y);if(!b||a[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const C=y.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const I=this.proxyToSource[A.key][b.id];if(I)for(const N of I){const z=Xu(b.getTile(N),b.findLoadedParent(N,0),b,this.painter.transform,C);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(b.id,N)}}}}_setupDrapedRenderBatches(){const n=this._style.order,a=n.length;if(a===0)return;const f=[];let y,b=0,C=this._style._layers[n[b]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++b<a;)C=this._style._layers[n[b]];for(;b<a;++b){const A=this._style._layers[n[b]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?y===void 0&&(y=b):y!==void 0&&(f.push({start:y,end:b-1}),y=void 0))}y!==void 0&&f.push({start:y,end:b-1}),this._drapedRenderBatches=f}_setupRenderCache(n){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const C=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let A=0;A<C.length;++A){const I=Object.values(C[A]);a.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,y=this._tilesDirty;for(let C=f.length-1;C>=0;C--){const A=f[C];if(a.getTileByID(A.key),a.proxyCachedFBO[A.key]!==void 0){const I=n[A.key],N=this.proxyToSource[A.key];let z=0;for(const $ in N){const K=N[$],re=I[$];if(!re||re.length!==K.length||K.some(((ie,ne)=>ie!==re[ne]||y[$]&&y[$].hasOwnProperty(ie.key)))){z=-1;break}++z}for(const $ in a.proxyCachedFBO[A.key])a.renderCache[a.proxyCachedFBO[A.key][$]].dirty=z<0||z!==Object.values(I).length}}const b=[...this._drapedRenderBatches];b.sort(((C,A)=>A.end-A.start-(C.end-C.start)));for(const C of b)for(const A of f){if(a.proxyCachedFBO[A.key])continue;let I=a.renderCachePool.pop();I===void 0&&a.renderCache.length<50&&(I=a.renderCache.length,a.renderCache.push(this._createFBO())),I!==void 0&&(a.proxyCachedFBO[A.key]={},a.proxyCachedFBO[A.key][C.start]=I,a.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,f,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,C=b.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let A;if(f.isTileClipped())A=a.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(n,a){const f=this.painter,y=this.painter.context,b=y.gl;f._tileClippingMaskIDs={},y.setColorMode(s.ColorMode.disabled),y.setDepthMode(s.DepthMode.disabled);const C=f.useProgram("clippingMask");for(const A of n){const I=f._tileClippingMaskIDs[A.key]=--a;C.draw(y,b.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:b.ALWAYS,mask:0},I,255,b.KEEP,b.KEEP,b.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,ec(A.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(n){const a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;const f=[n.x,n.y,1,1];s.transformMat4$1(f,f,a.pixelMatrixInverse),s.scale$1(f,f,1/f[3]),f[0]/=a.worldSize,f[1]/=a.worldSize;const y=a._camera.position,b=s.mercatorZfromAltitude(1,a.center.lat),C=[y[0],y[1],y[2]/b,0],A=s.subtract([],f.slice(0,3),C);s.normalize(A,A);const I=this.raycast(C,A,this._exaggeration);return I!==null&&I?(s.scaleAndAdd(C,C,A,I),C[3]=C[2],C[2]*=b,C):null}drawDepth(){const n=this.painter,a=n.context,f=this.proxySourceCache,y=Math.ceil(n.width),b=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const C=a.gl,A=a.createFramebuffer(y,b,!0);a.activeTexture.set(C.TEXTURE0);const I=new s.Texture(a,{width:y,height:b,data:null},C.RGBA);I.bind(C.NEAREST,C.CLAMP_TO_EDGE),A.colorAttachment.set(I.texture);const N=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,y,b);A.depthAttachment.set(N),this._depthFBO=A,this._depthTexture=I}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,y,b]),(function(C,A,I,N){if(C.transform.projection.name==="globe")return;const z=C.context,$=z.gl;z.clear({depth:1});const K=C.useProgram("terrainDepth"),re=new s.DepthMode($.LESS,s.DepthMode.ReadWrite,C.depthRangeFor3D);for(const ie of N){const ne=I.getTile(ie),se=ol(ie.projMatrix,0);A.setupElevationDraw(ne,K),K.draw(z,$.TRIANGLES,re,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,se,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}})(n,this,f,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,a,f){if(n.getSource()instanceof dr)return this._setupProxiedCoordsForImageSource(n,a,f);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const y=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let A=0;A<b.length;A++){const I=b[A],N=this._findTileCoveringTileID(I,n);if(N){const z=this._createProxiedId(I,N,f[I.key]&&f[I.key][n.id]);y.push(z),this.proxyToSource[I.key][n.id]=[z]}}let C=!1;for(let A=0;A<a.length;A++){const I=n.getTile(a[A]);if(!I||!I.hasData())continue;const N=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(N&&N.tileID.canonical.z!==I.tileID.canonical.z){const z=this.proxyToSource[N.tileID.key][n.id],$=this._createProxiedId(N.tileID,I,f[N.tileID.key]&&f[N.tileID.key][n.id]);z?z.splice(z.length-1,0,$):this.proxyToSource[N.tileID.key][n.id]=[$],y.push($),C=!0}}this._sourceTilesOverlap[n.id]=C}_setupProxiedCoordsForImageSource(n,a,f){if(!n.getSource().loaded())return;const y=this.proxiedCoords[n.id]=[],b=this.proxyCoords,C=n.getSource(),A=new s.Point(C.tileID.x,C.tileID.y)._div(1<<C.tileID.z),I=C.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce(((z,$)=>(z.min.x=Math.min(z.min.x,$.x-A.x),z.min.y=Math.min(z.min.y,$.y-A.y),z.max.x=Math.max(z.max.x,$.x-A.x),z.max.y=Math.max(z.max.y,$.y-A.y),z)),{min:new s.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),N=(z,$)=>{const K=z.wrap+z.canonical.x/(1<<z.canonical.z),re=z.canonical.y/(1<<z.canonical.z),ie=s.EXTENT/(1<<z.canonical.z),ne=$.wrap+$.canonical.x/(1<<$.canonical.z),se=$.canonical.y/(1<<$.canonical.z);return K+ie<ne+I.min.x||K>ne+I.max.x||re+ie<se+I.min.y||re>se+I.max.y};for(let z=0;z<b.length;z++){const $=b[z];for(let K=0;K<a.length;K++){const re=n.getTile(a[K]);if(!re||!re.hasData()||N($,re.tileID))continue;const ie=this._createProxiedId($,re,f[$.key]&&f[$.key][n.id]),ne=this.proxyToSource[$.key][n.id];ne?ne.push(ie):this.proxyToSource[$.key][n.id]=[ie],y.push(ie)}}}_createProxiedId(n,a,f){let y=this.orthoMatrix;if(f){const b=f.find((C=>C.key===a.tileID.key));if(b)return b}if(a.tileID.key!==n.key){const b=n.canonical.z-a.tileID.canonical.z;let C,A,I;y=s.create();const N=a.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(C=s.EXTENT>>b,A=C*((a.tileID.canonical.x<<b)-n.canonical.x+N),I=C*((a.tileID.canonical.y<<b)-n.canonical.y)):(C=s.EXTENT<<-b,A=s.EXTENT*(a.tileID.canonical.x-(n.canonical.x+N<<-b)),I=s.EXTENT*(a.tileID.canonical.y-(n.canonical.y<<-b))),s.ortho(y,0,C,0,C,0,1),s.translate(y,y,[A,I,0])}return new Yc(a.tileID,n.key,y)}_findTileCoveringTileID(n,a){let f=a.getTile(n);if(f&&f.hasData())return f;const y=this._findCoveringTileCache[a.id],b=y[n.key];if(f=b?a.getTileByID(b):null,f&&f.hasData()||b===null)return f;let C=f?f.tileID:n,A=C.overscaledZ;const I=a.getSource().minzoom,N=[];if(!b){const $=a.getSource().maxzoom;if(n.canonical.z>=$){const K=n.canonical.z-$;a.getSource().reparseOverscaled?(A=Math.max(n.canonical.z+2,a.transform.tileZoom),C=new s.OverscaledTileID(A,n.wrap,$,n.canonical.x>>K,n.canonical.y>>K)):K!==0&&(A=$,C=new s.OverscaledTileID(A,n.wrap,$,n.canonical.x>>K,n.canonical.y>>K))}C.key!==n.key&&(N.push(C.key),f=a.getTile(C))}const z=$=>{N.forEach((K=>{y[K]=$})),N.length=0};for(A-=1;A>=I&&(!f||!f.hasData());A--){f&&z(f.tileID.key);const $=C.calculateScaledKey(A);if(f=a.getTileByID($),f&&f.hasData())break;const K=y[$];if(K===null)break;K===void 0?N.push($):f=a.getTileByID(K)}return z(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let f=this._tilesDirty[n];f||(f=this._tilesDirty[n]={}),f[a.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=(function(a){let f=0;const y=new s.StructArrayLayout2ui4,b=131;for(let C=1;C<129;C++){for(let A=1;A<129;A++)f=C*b+A,y.emplaceBack(f,f+1),y.emplaceBack(f,f+b),y.emplaceBack(f+1,f+b),C===128&&y.emplaceBack(f+b,f+b+1);y.emplaceBack(f+1,f+1+b)}return y})();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Rr{static cacheKey(n,a,f,y){let b=`${a}${y?y.cacheKey:""}`;for(const C of f)n.usedDefines.includes(C)&&(b+=`/${C}`);return b}constructor(n,a,f,y,b,C){const A=n.gl;this.program=A.createProgram();const I=(function(W){const te=[];for(let le=0;le<W.length;le++){if(W[le]===null)continue;const ce=W[le].split(" ");te.push(ce.pop())}return te})(f.staticAttributes),N=y?y.getBinderAttributes():[],z=I.concat(N);let $=y?y.defines():[];$=$.concat(C.map((W=>`#define ${W}`)));const K=n.isWebGL2?`#version 300 es
`:"",re=K+$.concat(n.extStandardDerivatives&&K.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Jl):Jl,Jl,qc,sl.fragmentSource,Rs.fragmentSource,f.fragmentSource).join(`
`),ie=K+$.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,qc,sl.vertexSource,Rs.vertexSource,xi.vertexSource,f.vertexSource).join(`
`),ne=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(ne,re),A.compileShader(ne),A.attachShader(this.program,ne);const se=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(se,ie),A.compileShader(se),A.attachShader(this.program,se),this.attributes={},this.numAttributes=z.length;for(let W=0;W<this.numAttributes;W++)z[W]&&(A.bindAttribLocation(this.program,W,z[W]),this.attributes[z[W]]=W);A.linkProgram(this.program),A.deleteShader(se),A.deleteShader(ne),this.fixedUniforms=b(n),this.binderUniforms=y?y.getUniforms(n):[],C.includes("TERRAIN")&&(this.terrainUniforms=(W=>({u_dem:new s.Uniform1i(W),u_dem_prev:new s.Uniform1i(W),u_dem_unpack:new s.Uniform4f(W),u_dem_tl:new s.Uniform2f(W),u_dem_scale:new s.Uniform1f(W),u_dem_tl_prev:new s.Uniform2f(W),u_dem_scale_prev:new s.Uniform1f(W),u_dem_size:new s.Uniform1f(W),u_dem_lerp:new s.Uniform1f(W),u_exaggeration:new s.Uniform1f(W),u_depth:new s.Uniform1i(W),u_depth_size_inv:new s.Uniform2f(W),u_meter_to_dem:new s.Uniform1f(W),u_label_plane_matrix_inv:new s.UniformMatrix4f(W)}))(n)),C.includes("GLOBE")&&(this.globeUniforms=(W=>({u_tile_tl_up:new s.Uniform3f(W),u_tile_tr_up:new s.Uniform3f(W),u_tile_br_up:new s.Uniform3f(W),u_tile_bl_up:new s.Uniform3f(W),u_tile_up_scale:new s.Uniform1f(W)}))(n)),C.includes("FOG")&&(this.fogUniforms=(W=>({u_fog_matrix:new s.UniformMatrix4f(W),u_fog_range:new s.Uniform2f(W),u_fog_color:new s.Uniform4f(W),u_fog_horizon_blend:new s.Uniform1f(W),u_fog_temporal_offset:new s.Uniform1f(W),u_frustum_tl:new s.Uniform3f(W),u_frustum_tr:new s.Uniform3f(W),u_frustum_br:new s.Uniform3f(W),u_frustum_bl:new s.Uniform3f(W),u_globe_pos:new s.Uniform3f(W),u_globe_radius:new s.Uniform1f(W),u_globe_transition:new s.Uniform1f(W),u_is_globe:new s.Uniform1i(W),u_viewport:new s.Uniform2f(W)}))(n))}}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in a)f[y]&&f[y].set(this.program,y,a[y])}}setGlobeUniformValues(n,a){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in a)f[y]&&f[y].set(this.program,y,a[y])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in a)f[y].set(this.program,y,a[y])}}draw(n,a,f,y,b,C,A,I,N,z,$,K,re,ie,ne){const se=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(f),n.setStencilMode(y),n.setColorMode(b),n.setCullFace(C);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(this.program,te,A[te]);ie&&ie.setUniforms(this.program,n,this.binderUniforms,K,{zoom:re});const W={[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[a];for(const te of $.get()){const le=te.vaos||(te.vaos={});(le[I]||(le[I]=new Qh)).bind(n,this,N,ie?ie.getPaintVertexBuffers():[],z,te.vertexOffset,ne||[]),se.drawElements(a,te.primitiveLength*W,se.UNSIGNED_SHORT,te.primitiveOffset*W*2)}}}function rc(h,n){const a=Math.pow(2,n.tileID.overscaledZ),f=n.tileSize*Math.pow(2,h.transform.tileZoom)/a,y=f*(n.tileID.canonical.x+n.tileID.wrap*a),b=f*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_tile_units_to_pixels:1/st(n,1,h.transform.tileZoom),u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const rd=s.create(),Yu=(h,n,a,f,y,b,C,A,I,N,z)=>{const $=n.style.light,K=$.properties.get("position"),re=[K.x,K.y,K.z],ie=s.create$1();$.properties.get("anchor")==="viewport"&&(s.fromRotation(ie,-n.transform.angle),s.transformMat3(re,re,ie));const ne=$.properties.get("color"),se=n.transform,W={u_matrix:h,u_lightpos:re,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+a,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:rd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:y,u_edge_radius:b};return se.projection.name==="globe"&&(W.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],W.u_zoom_transition=I,W.u_inv_rot_matrix=z,W.u_merc_center=N,W.u_up_dir=se.projection.upVector(new s.CanonicalTileID(0,0,0),N[0]*s.EXTENT,N[1]*s.EXTENT),W.u_height_lift=A),W},nd=(h,n,a,f,y,b,C,A,I,N,z,$)=>{const K=Yu(h,n,a,f,y,b,C,I,N,z,$),re={u_height_factor:-Math.pow(2,C.overscaledZ)/A.tileSize/8};return s.extend(K,rc(n,A),re)},wa=h=>({u_matrix:h}),Ju=(h,n,a)=>s.extend(wa(h),rc(n,a)),mp=(h,n)=>({u_matrix:h,u_world:n}),Qu=(h,n,a,f)=>s.extend(Ju(h,n,a),{u_world:f}),nc=s.create(),eh=(h,n,a,f,y,b)=>{const C=h.transform,A=C.projection.name==="globe";let I;if(b.paint.get("circle-pitch-alignment")==="map")if(A){const z=s.globePixelsToTileUnits(C.zoom,n.canonical)*C._pixelsPerMercatorPixel;I=Float32Array.from([z,0,0,z])}else I=C.calculatePixelsToTileUnitsMatrix(a);else I=new Float32Array([C.pixelsToGLUnits[0],0,0,C.pixelsToGLUnits[1]]);const N={u_camera_to_center_distance:C.cameraToCenterDistance,u_matrix:h.translatePosMatrix(n.projMatrix,a,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:nc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){N.u_inv_rot_matrix=f,N.u_merc_center=y,N.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],N.u_zoom_transition=s.globeToMercatorTransition(C.zoom);const z=y[0]*s.EXTENT,$=y[1]*s.EXTENT;N.u_up_dir=C.projection.upVector(new s.CanonicalTileID(0,0,0),z,$)}return N},Jc=h=>{const n=[];return h.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},Qc=(h,n,a,f)=>{const y=s.EXTENT/a.tileSize;return{u_matrix:h,u_camera_to_center_distance:n.getCameraToCenterDistance(f),u_extrude_scale:[n.pixelsToGLUnits[0]/y,n.pixelsToGLUnits[1]/y]}},ic=(h,n,a=1)=>({u_matrix:h,u_color:n,u_overlay:0,u_overlay_scale:a}),th=s.create(),rh=(h,n,a,f,y,b,C)=>{const A=h.transform,I=A.projection.name==="globe",N=I?s.globePixelsToTileUnits(A.zoom,n.canonical)*A._pixelsPerMercatorPixel:st(a,1,b),z={u_matrix:n.projMatrix,u_extrude_scale:N,u_intensity:C,u_inv_rot_matrix:th,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){z.u_inv_rot_matrix=f,z.u_merc_center=y,z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],z.u_zoom_transition=s.globeToMercatorTransition(A.zoom);const $=y[0]*s.EXTENT,K=y[1]*s.EXTENT;z.u_up_dir=A.projection.upVector(new s.CanonicalTileID(0,0,0),$,K)}return z},ll=(h,n,a,f,y,b,C)=>{const A=h.transform,I=A.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:nh(h,n,a,f),u_pixels_to_tile_units:I,u_device_pixel_ratio:b,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:ul(a)?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:cl(n,h.transform),u_alpha_discard_threshold:0,u_trim_offset:C}},sc=(h,n,a,f,y)=>{const b=h.transform;return{u_matrix:nh(h,n,a,f),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:y,u_image:0,u_tile_units_to_pixels:cl(n,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function cl(h,n){return 1/st(h,1,n.tileZoom)}function nh(h,n,a,f){return h.translatePosMatrix(f||n.tileID.projMatrix,n,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}function ul(h){const n=h.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const eu=(h,n,a,f,y,b)=>{return{u_matrix:h,u_tl_parent:n,u_scale_parent:a,u_fade_t:f.mix,u_opacity:f.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(A=y.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(C=y.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:Fi(y.paint.get("raster-hue-rotate")),u_perspective_transform:b};var C,A};function Fi(h){h*=Math.PI/180;const n=Math.sin(h),a=Math.cos(h);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const Ho=s.create(),ih=(h,n,a,f,y,b,C,A,I,N,z,$,K,re,ie,ne)=>{const se=y.transform,W={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_rotate_symbol:+a,u_aspect_ratio:se.width/se.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:C,u_coord_matrix:A,u_is_text:+I,u_pitch_with_map:+f,u_texsize:N,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ho,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ho,u_up_vector:[0,-1,0]};return ne.name==="globe"&&(W.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],W.u_zoom_transition=$,W.u_inv_rot_matrix=re,W.u_merc_center=K,W.u_camera_forward=se._camera.forward(),W.u_ecef_origin=s.globeECEFOrigin(se.globeMatrix,z.toUnwrapped()),W.u_tile_matrix=Float32Array.from(se.globeMatrix),W.u_up_vector=ie),W},Ta=(h,n,a,f,y,b,C,A,I,N,z,$,K,re,ie,ne,se)=>s.extend(ih(h,n,a,f,y,b,C,A,I,N,$,K,re,ie,ne,se),{u_gamma_scale:f?y.transform.cameraToCenterDistance*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:1}),id=(h,n,a,f,y,b,C,A,I,N,z,$,K,re,ie,ne)=>s.extend(Ta(h,n,a,f,y,b,C,A,!0,I,!0,z,$,K,re,ie,ne),{u_texsize_icon:N,u_texture_icon:1}),tu=(h,n,a)=>({u_matrix:h,u_opacity:n,u_color:a}),sh=(h,n,a,f,y)=>s.extend((function(b,C,A){const I=C.imageManager.getPattern(b.toString()),{width:N,height:z}=C.imageManager.getPixelSize(),$=Math.pow(2,A.tileID.overscaledZ),K=A.tileSize*Math.pow(2,C.transform.tileZoom)/$,re=K*(A.tileID.canonical.x+A.tileID.wrap*$),ie=K*A.tileID.canonical.y;return{u_image:0,u_pattern_tl:I.tl,u_pattern_br:I.br,u_texsize:[N,z],u_pattern_size:I.displaySize,u_tile_units_to_pixels:1/st(A,1,C.transform.tileZoom),u_pixel_coord_upper:[re>>16,ie>>16],u_pixel_coord_lower:[65535&re,65535&ie]}})(f,a,y),{u_matrix:h,u_opacity:n}),oc={fillExtrusion:h=>({u_matrix:new s.UniformMatrix4f(h),u_lightpos:new s.Uniform3f(h),u_lightintensity:new s.Uniform1f(h),u_lightcolor:new s.Uniform3f(h),u_vertical_gradient:new s.Uniform1f(h),u_opacity:new s.Uniform1f(h),u_edge_radius:new s.Uniform1f(h),u_ao:new s.Uniform2f(h),u_tile_id:new s.Uniform3f(h),u_zoom_transition:new s.Uniform1f(h),u_inv_rot_matrix:new s.UniformMatrix4f(h),u_merc_center:new s.Uniform2f(h),u_up_dir:new s.Uniform3f(h),u_height_lift:new s.Uniform1f(h)}),fillExtrusionPattern:h=>({u_matrix:new s.UniformMatrix4f(h),u_lightpos:new s.Uniform3f(h),u_lightintensity:new s.Uniform1f(h),u_lightcolor:new s.Uniform3f(h),u_vertical_gradient:new s.Uniform1f(h),u_height_factor:new s.Uniform1f(h),u_edge_radius:new s.Uniform1f(h),u_ao:new s.Uniform2f(h),u_tile_id:new s.Uniform3f(h),u_zoom_transition:new s.Uniform1f(h),u_inv_rot_matrix:new s.UniformMatrix4f(h),u_merc_center:new s.Uniform2f(h),u_up_dir:new s.Uniform3f(h),u_height_lift:new s.Uniform1f(h),u_image:new s.Uniform1i(h),u_texsize:new s.Uniform2f(h),u_pixel_coord_upper:new s.Uniform2f(h),u_pixel_coord_lower:new s.Uniform2f(h),u_tile_units_to_pixels:new s.Uniform1f(h),u_opacity:new s.Uniform1f(h)}),fill:h=>({u_matrix:new s.UniformMatrix4f(h)}),fillPattern:h=>({u_matrix:new s.UniformMatrix4f(h),u_image:new s.Uniform1i(h),u_texsize:new s.Uniform2f(h),u_pixel_coord_upper:new s.Uniform2f(h),u_pixel_coord_lower:new s.Uniform2f(h),u_tile_units_to_pixels:new s.Uniform1f(h)}),fillOutline:h=>({u_matrix:new s.UniformMatrix4f(h),u_world:new s.Uniform2f(h)}),fillOutlinePattern:h=>({u_matrix:new s.UniformMatrix4f(h),u_world:new s.Uniform2f(h),u_image:new s.Uniform1i(h),u_texsize:new s.Uniform2f(h),u_pixel_coord_upper:new s.Uniform2f(h),u_pixel_coord_lower:new s.Uniform2f(h),u_tile_units_to_pixels:new s.Uniform1f(h)}),circle:h=>({u_camera_to_center_distance:new s.Uniform1f(h),u_extrude_scale:new s.UniformMatrix2f(h),u_device_pixel_ratio:new s.Uniform1f(h),u_matrix:new s.UniformMatrix4f(h),u_inv_rot_matrix:new s.UniformMatrix4f(h),u_merc_center:new s.Uniform2f(h),u_tile_id:new s.Uniform3f(h),u_zoom_transition:new s.Uniform1f(h),u_up_dir:new s.Uniform3f(h)}),collisionBox:h=>({u_matrix:new s.UniformMatrix4f(h),u_camera_to_center_distance:new s.Uniform1f(h),u_extrude_scale:new s.Uniform2f(h)}),collisionCircle:h=>({u_matrix:new s.UniformMatrix4f(h),u_inv_matrix:new s.UniformMatrix4f(h),u_camera_to_center_distance:new s.Uniform1f(h),u_viewport_size:new s.Uniform2f(h)}),debug:h=>({u_color:new s.UniformColor(h),u_matrix:new s.UniformMatrix4f(h),u_overlay:new s.Uniform1i(h),u_overlay_scale:new s.Uniform1f(h)}),clippingMask:h=>({u_matrix:new s.UniformMatrix4f(h)}),heatmap:h=>({u_extrude_scale:new s.Uniform1f(h),u_intensity:new s.Uniform1f(h),u_matrix:new s.UniformMatrix4f(h),u_inv_rot_matrix:new s.UniformMatrix4f(h),u_merc_center:new s.Uniform2f(h),u_tile_id:new s.Uniform3f(h),u_zoom_transition:new s.Uniform1f(h),u_up_dir:new s.Uniform3f(h)}),heatmapTexture:h=>({u_image:new s.Uniform1i(h),u_color_ramp:new s.Uniform1i(h),u_opacity:new s.Uniform1f(h)}),hillshade:h=>({u_matrix:new s.UniformMatrix4f(h),u_image:new s.Uniform1i(h),u_latrange:new s.Uniform2f(h),u_light:new s.Uniform2f(h),u_shadow:new s.UniformColor(h),u_highlight:new s.UniformColor(h),u_accent:new s.UniformColor(h)}),hillshadePrepare:h=>({u_matrix:new s.UniformMatrix4f(h),u_image:new s.Uniform1i(h),u_dimension:new s.Uniform2f(h),u_zoom:new s.Uniform1f(h),u_unpack:new s.Uniform4f(h)}),line:h=>({u_matrix:new s.UniformMatrix4f(h),u_pixels_to_tile_units:new s.UniformMatrix2f(h),u_device_pixel_ratio:new s.Uniform1f(h),u_units_to_pixels:new s.Uniform2f(h),u_dash_image:new s.Uniform1i(h),u_gradient_image:new s.Uniform1i(h),u_image_height:new s.Uniform1f(h),u_texsize:new s.Uniform2f(h),u_tile_units_to_pixels:new s.Uniform1f(h),u_alpha_discard_threshold:new s.Uniform1f(h),u_trim_offset:new s.Uniform2f(h)}),linePattern:h=>({u_matrix:new s.UniformMatrix4f(h),u_texsize:new s.Uniform2f(h),u_pixels_to_tile_units:new s.UniformMatrix2f(h),u_device_pixel_ratio:new s.Uniform1f(h),u_image:new s.Uniform1i(h),u_units_to_pixels:new s.Uniform2f(h),u_tile_units_to_pixels:new s.Uniform1f(h),u_alpha_discard_threshold:new s.Uniform1f(h)}),raster:h=>({u_matrix:new s.UniformMatrix4f(h),u_tl_parent:new s.Uniform2f(h),u_scale_parent:new s.Uniform1f(h),u_fade_t:new s.Uniform1f(h),u_opacity:new s.Uniform1f(h),u_image0:new s.Uniform1i(h),u_image1:new s.Uniform1i(h),u_brightness_low:new s.Uniform1f(h),u_brightness_high:new s.Uniform1f(h),u_saturation_factor:new s.Uniform1f(h),u_contrast_factor:new s.Uniform1f(h),u_spin_weights:new s.Uniform3f(h),u_perspective_transform:new s.Uniform2f(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new s.Uniform1i(h),u_is_size_feature_constant:new s.Uniform1i(h),u_size_t:new s.Uniform1f(h),u_size:new s.Uniform1f(h),u_camera_to_center_distance:new s.Uniform1f(h),u_rotate_symbol:new s.Uniform1i(h),u_aspect_ratio:new s.Uniform1f(h),u_fade_change:new s.Uniform1f(h),u_matrix:new s.UniformMatrix4f(h),u_label_plane_matrix:new s.UniformMatrix4f(h),u_coord_matrix:new s.UniformMatrix4f(h),u_is_text:new s.Uniform1i(h),u_pitch_with_map:new s.Uniform1i(h),u_texsize:new s.Uniform2f(h),u_tile_id:new s.Uniform3f(h),u_zoom_transition:new s.Uniform1f(h),u_inv_rot_matrix:new s.UniformMatrix4f(h),u_merc_center:new s.Uniform2f(h),u_camera_forward:new s.Uniform3f(h),u_tile_matrix:new s.UniformMatrix4f(h),u_up_vector:new s.Uniform3f(h),u_ecef_origin:new s.Uniform3f(h),u_texture:new s.Uniform1i(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new s.Uniform1i(h),u_is_size_feature_constant:new s.Uniform1i(h),u_size_t:new s.Uniform1f(h),u_size:new s.Uniform1f(h),u_camera_to_center_distance:new s.Uniform1f(h),u_rotate_symbol:new s.Uniform1i(h),u_aspect_ratio:new s.Uniform1f(h),u_fade_change:new s.Uniform1f(h),u_matrix:new s.UniformMatrix4f(h),u_label_plane_matrix:new s.UniformMatrix4f(h),u_coord_matrix:new s.UniformMatrix4f(h),u_is_text:new s.Uniform1i(h),u_pitch_with_map:new s.Uniform1i(h),u_texsize:new s.Uniform2f(h),u_texture:new s.Uniform1i(h),u_gamma_scale:new s.Uniform1f(h),u_device_pixel_ratio:new s.Uniform1f(h),u_tile_id:new s.Uniform3f(h),u_zoom_transition:new s.Uniform1f(h),u_inv_rot_matrix:new s.UniformMatrix4f(h),u_merc_center:new s.Uniform2f(h),u_camera_forward:new s.Uniform3f(h),u_tile_matrix:new s.UniformMatrix4f(h),u_up_vector:new s.Uniform3f(h),u_ecef_origin:new s.Uniform3f(h),u_is_halo:new s.Uniform1i(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new s.Uniform1i(h),u_is_size_feature_constant:new s.Uniform1i(h),u_size_t:new s.Uniform1f(h),u_size:new s.Uniform1f(h),u_camera_to_center_distance:new s.Uniform1f(h),u_rotate_symbol:new s.Uniform1i(h),u_aspect_ratio:new s.Uniform1f(h),u_fade_change:new s.Uniform1f(h),u_matrix:new s.UniformMatrix4f(h),u_label_plane_matrix:new s.UniformMatrix4f(h),u_coord_matrix:new s.UniformMatrix4f(h),u_is_text:new s.Uniform1i(h),u_pitch_with_map:new s.Uniform1i(h),u_texsize:new s.Uniform2f(h),u_texsize_icon:new s.Uniform2f(h),u_texture:new s.Uniform1i(h),u_texture_icon:new s.Uniform1i(h),u_gamma_scale:new s.Uniform1f(h),u_device_pixel_ratio:new s.Uniform1f(h),u_is_halo:new s.Uniform1i(h)}),background:h=>({u_matrix:new s.UniformMatrix4f(h),u_opacity:new s.Uniform1f(h),u_color:new s.UniformColor(h)}),backgroundPattern:h=>({u_matrix:new s.UniformMatrix4f(h),u_opacity:new s.Uniform1f(h),u_image:new s.Uniform1i(h),u_pattern_tl:new s.Uniform2f(h),u_pattern_br:new s.Uniform2f(h),u_texsize:new s.Uniform2f(h),u_pattern_size:new s.Uniform2f(h),u_pixel_coord_upper:new s.Uniform2f(h),u_pixel_coord_lower:new s.Uniform2f(h),u_tile_units_to_pixels:new s.Uniform1f(h)}),terrainRaster:Hu,terrainDepth:Hu,skybox:h=>({u_matrix:new s.UniformMatrix4f(h),u_sun_direction:new s.Uniform3f(h),u_cubemap:new s.Uniform1i(h),u_opacity:new s.Uniform1f(h),u_temporal_offset:new s.Uniform1f(h)}),skyboxGradient:h=>({u_matrix:new s.UniformMatrix4f(h),u_color_ramp:new s.Uniform1i(h),u_center_direction:new s.Uniform3f(h),u_radius:new s.Uniform1f(h),u_opacity:new s.Uniform1f(h),u_temporal_offset:new s.Uniform1f(h)}),skyboxCapture:h=>({u_matrix_3f:new s.UniformMatrix3f(h),u_sun_direction:new s.Uniform3f(h),u_sun_intensity:new s.Uniform1f(h),u_color_tint_r:new s.Uniform4f(h),u_color_tint_m:new s.Uniform4f(h),u_luminance:new s.Uniform1f(h)}),globeRaster:h=>({u_proj_matrix:new s.UniformMatrix4f(h),u_globe_matrix:new s.UniformMatrix4f(h),u_normalize_matrix:new s.UniformMatrix4f(h),u_merc_matrix:new s.UniformMatrix4f(h),u_zoom_transition:new s.Uniform1f(h),u_merc_center:new s.Uniform2f(h),u_image0:new s.Uniform1i(h),u_grid_matrix:new s.UniformMatrix3f(h),u_skirt_height:new s.Uniform1f(h),u_frustum_tl:new s.Uniform3f(h),u_frustum_tr:new s.Uniform3f(h),u_frustum_br:new s.Uniform3f(h),u_frustum_bl:new s.Uniform3f(h),u_globe_pos:new s.Uniform3f(h),u_globe_radius:new s.Uniform1f(h),u_viewport:new s.Uniform2f(h)}),globeAtmosphere:h=>({u_frustum_tl:new s.Uniform3f(h),u_frustum_tr:new s.Uniform3f(h),u_frustum_br:new s.Uniform3f(h),u_frustum_bl:new s.Uniform3f(h),u_horizon:new s.Uniform1f(h),u_transition:new s.Uniform1f(h),u_fadeout_range:new s.Uniform1f(h),u_color:new s.Uniform4f(h),u_high_color:new s.Uniform4f(h),u_space_color:new s.Uniform4f(h),u_star_intensity:new s.Uniform1f(h),u_star_density:new s.Uniform1f(h),u_star_size:new s.Uniform1f(h),u_temporal_offset:new s.Uniform1f(h),u_horizon_angle:new s.Uniform1f(h),u_rotation_matrix:new s.UniformMatrix4f(h)})};let ac;function hl(h,n,a,f,y,b,C){const A=h.context,I=A.gl,N=h.transform,z=h.useProgram("collisionBox"),$=[];let K=0,re=0;for(let ce=0;ce<f.length;ce++){const xe=f[ce],be=n.getTile(xe),ve=be.getBucket(a);if(!ve)continue;const Pe=Ji(xe,ve,N);let Ce=Pe;y[0]===0&&y[1]===0||(Ce=h.translatePosMatrix(Pe,be,y,b));const Oe=C?ve.textCollisionBox:ve.iconCollisionBox,ft=ve.collisionCircleArray;if(ft.length>0){const je=s.create(),Je=Ce;s.mul(je,ve.placementInvProjMatrix,N.glCoordMatrix),s.mul(je,je,ve.placementViewportMatrix),$.push({circleArray:ft,circleOffset:re,transform:Je,invTransform:je,projection:ve.getProjection()}),K+=ft.length/4,re=K}Oe&&(h.terrain&&h.terrain.setupElevationDraw(be,z),z.draw(A,I.LINES,s.DepthMode.disabled,s.StencilMode.disabled,h.colorModeForRenderPass(),s.CullFaceMode.disabled,Qc(Ce,N,be,ve.getProjection()),a.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,null,N.zoom,null,[Oe.collisionVertexBuffer,Oe.collisionVertexBufferExt]))}if(!C||!$.length)return;const ie=h.useProgram("collisionCircle"),ne=new s.StructArrayLayout2f1f2i16;ne.resize(4*K),ne._trim();let se=0;for(const ce of $)for(let xe=0;xe<ce.circleArray.length/4;xe++){const be=4*xe,ve=ce.circleArray[be+0],Pe=ce.circleArray[be+1],Ce=ce.circleArray[be+2],Oe=ce.circleArray[be+3];ne.emplace(se++,ve,Pe,Ce,Oe,0),ne.emplace(se++,ve,Pe,Ce,Oe,1),ne.emplace(se++,ve,Pe,Ce,Oe,2),ne.emplace(se++,ve,Pe,Ce,Oe,3)}(!ac||ac.length<2*K)&&(ac=(function(ce){const xe=2*ce,be=new s.StructArrayLayout3ui6;be.resize(xe),be._trim();for(let ve=0;ve<xe;ve++){const Pe=6*ve;be.uint16[Pe+0]=4*ve+0,be.uint16[Pe+1]=4*ve+1,be.uint16[Pe+2]=4*ve+2,be.uint16[Pe+3]=4*ve+2,be.uint16[Pe+4]=4*ve+3,be.uint16[Pe+5]=4*ve+0}return be})(K));const W=A.createIndexBuffer(ac,!0),te=A.createVertexBuffer(ne,s.collisionCircleLayout.members,!0);for(const ce of $){const xe={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(le=N).getCameraToCenterDistance(ce.projection),u_viewport_size:[le.width,le.height]};ie.draw(A,I.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,h.colorModeForRenderPass(),s.CullFaceMode.disabled,xe,a.id,te,W,s.SegmentVector.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,N.zoom)}var le;te.destroy(),W.destroy()}const oh=s.create();function ah({width:h,height:n,anchor:a,textOffset:f,textScale:y},b){const{horizontalAlign:C,verticalAlign:A}=s.getAnchorAlignment(a),I=-(C-.5)*h,N=-(A-.5)*n,z=s.evaluateVariableOffset(a,f);return new s.Point((I/y+z[0])*b,(N/y+z[1])*b)}function gp(h,n,a,f,y,b,C,A,I,N,z){const $=h.text.placedSymbolArray,K=h.text.dynamicLayoutVertexArray,re=h.icon.dynamicLayoutVertexArray,ie={},ne=h.getProjection(),se=ln(A,ne,b),W=b.elevation,te=ne.upVectorScale(A.canonical,b.center.lat,b.worldSize).metersToTile;K.clear();for(let le=0;le<$.length;le++){const ce=$.get(le),{tileAnchorX:xe,tileAnchorY:be,numGlyphs:ve}=ce,Pe=ce.hidden||!ce.crossTileID||h.allowVerticalPlacement&&!ce.placedOrientation?null:f[ce.crossTileID];if(Pe){let Ce=0,Oe=0,ft=0;if(W){const gt=W?W.getAtTileOffset(A,xe,be):0,[Ut,er,Nt]=ne.upVector(A.canonical,xe,be);Ce=gt*Ut*te,Oe=gt*er*te,ft=gt*Nt*te}let[je,Je,Ve,dt]=ri(ce.projectedAnchorX+Ce,ce.projectedAnchorY+Oe,ce.projectedAnchorZ+ft,a?se:C);const Be=Jh(b.getCameraToCenterDistance(ne),dt);let Qe=y.evaluateSizeForFeature(h.textSizeData,N,ce)*Be/s.ONE_EM;a&&(Qe*=h.tilePixelRatio/I);const ht=ah(Pe,Qe);a?({x:je,y:Je,z:Ve}=ne.projectTilePoint(xe+ht.x,be+ht.y,A.canonical),[je,Je,Ve]=ri(je+Ce,Je+Oe,Ve+ft,C)):(n&&ht._rotate(-b.angle),je+=ht.x,Je+=ht.y,Ve=0);const ct=h.allowVerticalPlacement&&ce.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let gt=0;gt<ve;gt++)s.addDynamicAttributes(K,je,Je,Ve,ct);z&&ce.associatedIconIndex>=0&&(ie[ce.associatedIconIndex]={x:je,y:Je,z:Ve,angle:ct})}else Ki(ve,K)}if(z){re.clear();const le=h.icon.placedSymbolArray;for(let ce=0;ce<le.length;ce++){const xe=le.get(ce),{numGlyphs:be}=xe,ve=ie[ce];if(xe.hidden||!ve)Ki(be,re);else{const{x:Pe,y:Ce,z:Oe,angle:ft}=ve;for(let je=0;je<be;je++)s.addDynamicAttributes(re,Pe,Ce,Oe,ft)}}h.icon.dynamicLayoutVertexBuffer.updateData(re)}h.text.dynamicLayoutVertexBuffer.updateData(K)}function lh(h,n,a){return a.iconsInText&&n?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function sd(h,n,a,f,y,b,C,A,I,N,z,$){const K=h.context,re=K.gl,ie=h.transform,ne=A==="map",se=I==="map",W=ne&&a.layout.get("symbol-placement")!=="point",te=ne&&!se&&!W,le=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ce=!1;const xe=h.depthModeForSublayer(0,s.DepthMode.ReadOnly),be=[s.mercatorXfromLng(ie.center.lng),s.mercatorYfromLat(ie.center.lat)],ve=a.layout.get("text-variable-anchor"),Pe=ie.projection.name==="globe",Ce=[],Oe=[0,-1,0];let ft=Oe;!Pe&&!ie.mercatorFromTransition||ne||(ft=(function(je){const Je=je._camera.getWorldToCamera(je.worldSize,1),Ve=s.multiply([],Je,je.globeMatrix);s.invert(Ve,Ve);const dt=[0,0,0],Be=[0,1,0,0];return s.transformMat4$1(Be,Be,Ve),dt[0]=Be[0],dt[1]=Be[1],dt[2]=Be[2],s.normalize(dt,dt),dt})(ie));for(const je of f){const Je=n.getTile(je),Ve=Je.getBucket(a);if(!Ve||Ve.projection.name==="mercator"&&Pe)continue;const dt=y?Ve.text:Ve.icon;if(!dt||Ve.fullyClipped||!dt.segments.get().length)continue;const Be=dt.programConfigurations.get(a.id),Qe=y||Ve.sdfIcons,ht=y?Ve.textSizeData:Ve.iconSizeData,ct=se||ie.pitch!==0,gt=s.evaluateSizeForZoom(ht,ie.zoom);let Ut,er,Nt,Xt,br=[0,0],Er=null;if(y)er=Je.glyphAtlasTexture,Nt=re.LINEAR,Ut=Je.glyphAtlasTexture.size,Ve.iconsInText&&(br=Je.imageAtlasTexture.size,Er=Je.imageAtlasTexture,Xt=ct||h.options.rotating||h.options.zooming||ht.kind==="composite"||ht.kind==="camera"?re.LINEAR:re.NEAREST);else{const Ts=a.layout.get("icon-size").constantOr(0)!==1||Ve.iconsNeedLinear;er=Je.imageAtlasTexture,Nt=Qe||h.options.rotating||h.options.zooming||Ts||ct?re.LINEAR:re.NEAREST,Ut=Je.imageAtlasTexture.size}const Vt=Ve.projection.name==="globe",Ir=Vt?ft:Oe,Gr=Vt?s.globeToMercatorTransition(ie.zoom):0,Wr=ln(je,Ve.getProjection(),ie),Or=ie.calculatePixelsToTileUnitsMatrix(Je),oi=rt(Wr,Je.tileID.canonical,se,ne,ie,Ve.getProjection(),Or),Sn=h.terrain&&se&&W?s.invert(s.create(),oi):oh,ns=Rn(Wr,Je.tileID.canonical,se,ne,ie,Ve.getProjection(),Or),ws=ve&&Ve.hasTextData(),pr=a.layout.get("icon-text-fit")!=="none"&&ws&&Ve.hasIconData();if(W){const Ts=ie.elevation,Ss=Ts?Ts.getAtTileOffsetFunc(je,ie.center.lat,ie.worldSize,Ve.getProjection()):null,Fs=Xn(Wr,Je.tileID.canonical,se,ne,ie,Ve.getProjection(),Or);Qa(Ve,Wr,h,y,Fs,ns,se,N,Ss,je)}const Kr=W||y&&ve||pr,Fr=h.translatePosMatrix(Wr,Je,b,C),En=Kr?oh:oi,ai=h.translatePosMatrix(ns,Je,b,C,!0),rn=Ve.getProjection().createInversionMatrix(ie,je.canonical),Un=[];h.terrainRenderModeElevated()&&se&&Un.push("PITCH_WITH_MAP_TERRAIN"),Vt&&Un.push("PROJECTION_GLOBE_VIEW"),Kr&&Un.push("PROJECTED_POS_ON_VIEWPORT");const gn=Qe&&a.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xn;xn=Qe?Ve.iconsInText?id(ht.kind,gt,te,se,h,Fr,En,ai,Ut,br,je,Gr,be,rn,Ir,Ve.getProjection()):Ta(ht.kind,gt,te,se,h,Fr,En,ai,y,Ut,!0,je,Gr,be,rn,Ir,Ve.getProjection()):ih(ht.kind,gt,te,se,h,Fr,En,ai,y,Ut,je,Gr,be,rn,Ir,Ve.getProjection());const Mn={program:h.useProgram(lh(Qe,y,Ve),Be,Un),buffers:dt,uniformValues:xn,atlasTexture:er,atlasTextureIcon:Er,atlasInterpolation:Nt,atlasInterpolationIcon:Xt,isSDF:Qe,hasHalo:gn,tile:Je,labelPlaneMatrixInv:Sn};if(le&&Ve.canOverlap){ce=!0;const Ts=dt.segments.get();for(const Ss of Ts)Ce.push({segments:new s.SegmentVector([Ss]),sortKey:Ss.sortKey,state:Mn})}else Ce.push({segments:dt.segments,sortKey:0,state:Mn})}ce&&Ce.sort(((je,Je)=>je.sortKey-Je.sortKey));for(const je of Ce){const Je=je.state;if(h.terrain&&h.terrain.setupElevationDraw(Je.tile,Je.program,{useDepthForOcclusion:!Pe,labelPlaneMatrixInv:Je.labelPlaneMatrixInv}),K.activeTexture.set(re.TEXTURE0),Je.atlasTexture.bind(Je.atlasInterpolation,re.CLAMP_TO_EDGE),Je.atlasTextureIcon&&(K.activeTexture.set(re.TEXTURE1),Je.atlasTextureIcon&&Je.atlasTextureIcon.bind(Je.atlasInterpolationIcon,re.CLAMP_TO_EDGE)),Je.isSDF){const Ve=Je.uniformValues;Je.hasHalo&&(Ve.u_is_halo=1,lc(Je.buffers,je.segments,a,h,Je.program,xe,z,$,Ve)),Ve.u_is_halo=0}lc(Je.buffers,je.segments,a,h,Je.program,xe,z,$,Je.uniformValues)}}function lc(h,n,a,f,y,b,C,A,I){const N=f.context,z=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer];y.draw(N,N.gl.TRIANGLES,b,C,A,s.CullFaceMode.disabled,I,a.id,h.layoutVertexBuffer,h.indexBuffer,n,a.paint,f.transform.zoom,h.programConfigurations.get(a.id),z)}function xs(h,n,a,f,y,b,C){const A=h.context.gl,I=a.paint.get("fill-pattern"),N=I&&I.constantOr(1);let z,$,K,re,ie;C?($=N&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=A.LINES):($=N?"fillPattern":"fill",z=A.TRIANGLES);for(const ne of f){const se=n.getTile(ne);if(N&&!se.patternsLoaded())continue;const W=se.getBucket(a);if(!W)continue;h.prepareDrawTile();const te=W.programConfigurations.get(a.id),le=h.useProgram($,te);N&&(h.context.activeTexture.set(A.TEXTURE0),se.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),te.updatePaintBuffers());const ce=I.constantOr(null);if(ce&&se.imageAtlas){const be=se.imageAtlas.patternPositions[ce.toString()];be&&te.setConstantPatternPositions(be)}const xe=h.translatePosMatrix(ne.projMatrix,se,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(C){re=W.indexBuffer2,ie=W.segments2;const be=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];K=$==="fillOutlinePattern"&&N?Qu(xe,h,se,be):mp(xe,be)}else re=W.indexBuffer,ie=W.segments,K=N?Ju(xe,h,se):wa(xe);h.prepareDrawProgram(h.context,le,ne.toUnwrapped()),le.draw(h.context,z,y,h.stencilModeForClipping(ne),b,s.CullFaceMode.disabled,K,a.id,W.layoutVertexBuffer,re,ie,a.paint,h.transform.zoom,te)}}function Xo(h,n,a,f,y,b,C){const A=h.context,I=A.gl,N=h.transform,z=a.paint.get("fill-extrusion-pattern"),$=z.constantOr(1),K=a.paint.get("fill-extrusion-opacity"),re=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),a.paint.get("fill-extrusion-ambient-occlusion-radius")],ie=a.layout.get("fill-extrusion-edge-radius"),ne=ie>0&&!a.paint.get("fill-extrusion-rounded-roof"),se=ne?0:ie,W=N.projection.name==="globe"?s.fillExtrusionHeightLift():0,te=N.projection.name==="globe",le=te?s.globeToMercatorTransition(N.zoom):0,ce=[s.mercatorXfromLng(N.center.lng),s.mercatorYfromLat(N.center.lat)],xe=[];te&&xe.push("PROJECTION_GLOBE_VIEW"),re[0]>0&&xe.push("FAUX_AO"),ne&&xe.push("ZERO_ROOF_RADIUS");for(const be of f){const ve=n.getTile(be),Pe=ve.getBucket(a);if(!Pe||Pe.projection.name!==N.projection.name)continue;const Ce=Pe.programConfigurations.get(a.id),Oe=h.useProgram($?"fillExtrusionPattern":"fillExtrusion",Ce,xe);if(h.terrain){const Qe=h.terrain;if(h.style.terrainSetForDrapingOnly())Qe.setupElevationDraw(ve,Oe,{useMeterToDem:!0});else{if(!Pe.enableTerrain)continue;if(Qe.setupElevationDraw(ve,Oe,{useMeterToDem:!0}),ch(A,n,be,Pe,a,Qe),!Pe.centroidVertexBuffer){const ht=Oe.attributes.a_centroid_pos;ht!==void 0&&I.vertexAttrib2f(ht,0,0)}}}$&&(h.context.activeTexture.set(I.TEXTURE0),ve.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Ce.updatePaintBuffers());const ft=z.constantOr(null);if(ft&&ve.imageAtlas){const Qe=ve.imageAtlas.patternPositions[ft.toString()];Qe&&Ce.setConstantPatternPositions(Qe)}const je=h.translatePosMatrix(be.projMatrix,ve,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Je=N.projection.createInversionMatrix(N,be.canonical),Ve=a.paint.get("fill-extrusion-vertical-gradient"),dt=$?nd(je,h,Ve,K,re,se,be,ve,W,le,ce,Je):Yu(je,h,Ve,K,re,se,be,W,le,ce,Je);h.prepareDrawProgram(A,Oe,be.toUnwrapped());const Be=[];h.terrain&&Be.push(Pe.centroidVertexBuffer),te&&Be.push(Pe.layoutVertexExtBuffer),Oe.draw(A,A.gl.TRIANGLES,y,b,C,s.CullFaceMode.backCCW,dt,a.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,a.paint,h.transform.zoom,Ce,Be)}}function ch(h,n,a,f,y,b){const C=[W=>{let te=W.canonical.x-1,le=W.wrap;return te<0&&(te=(1<<W.canonical.z)-1,le--),new s.OverscaledTileID(W.overscaledZ,le,W.canonical.z,te,W.canonical.y)},W=>{let te=W.canonical.x+1,le=W.wrap;return te===1<<W.canonical.z&&(te=0,le++),new s.OverscaledTileID(W.overscaledZ,le,W.canonical.z,te,W.canonical.y)},W=>new s.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,(W.canonical.y===0?1<<W.canonical.z:W.canonical.y)-1),W=>new s.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y===(1<<W.canonical.z)-1?0:W.canonical.y+1)],A=W=>{const te=n.getSource().minzoom,le=xe=>{const be=n.getTileByID(xe);if(be&&be.hasData())return be.getBucket(y)},ce=[0,-1,1];for(const xe of ce){if(W.overscaledZ+xe<te)continue;const be=le(W.calculateScaledKey(W.overscaledZ+xe));if(be)return be}},I=[0,0,0],N=(W,te)=>(I[0]=Math.min(W.min.y,te.min.y),I[1]=Math.max(W.max.y,te.max.y),I[2]=s.EXTENT-te.min.x>W.max.x?te.min.x-s.EXTENT:W.max.x,I),z=(W,te)=>(I[0]=Math.min(W.min.x,te.min.x),I[1]=Math.max(W.max.x,te.max.x),I[2]=s.EXTENT-te.min.y>W.max.y?te.min.y-s.EXTENT:W.max.y,I),$=[(W,te)=>N(W,te),(W,te)=>N(te,W),(W,te)=>z(W,te),(W,te)=>z(te,W)],K=new s.Point(0,0);let re,ie,ne;const se=(W,te,le,ce,xe)=>{const be=[[ce?le:W,ce?W:le,0],[ce?le:te,ce?te:le,0]],ve=xe<0?s.EXTENT+xe:xe,Pe=[ce?ve:(W+te)/2,ce?(W+te)/2:ve,0];return le===0&&xe<0||le!==0&&xe>0?b.getForTilePoints(ne,[Pe],!0,ie):be.push(Pe),b.getForTilePoints(a,be,!0,re),Math.max(be[0][2],be[1][2],Pe[2])/b.exaggeration()};for(let W=0;W<4;W++){const te=(W<2?1:5)-W,le=f.borders[W];if(le.length===0)continue;const ce=ne=C[W](a),xe=A(ce);if(!(xe&&xe instanceof s.FillExtrusionBucket&&xe.enableTerrain)||f.borderDoneWithNeighborZ[W]===xe.canonical.z&&xe.borderDoneWithNeighborZ[te]===f.canonical.z||(ie=b.findDEMTileFor(ce),!ie||!ie.dem))continue;if(!re){const Ce=b.findDEMTileFor(a);if(!Ce||!Ce.dem)return;re=Ce}const be=xe.borders[te];let ve=0;const Pe=xe.borderDoneWithNeighborZ[te]!==f.canonical.z;if(f.canonical.z===xe.canonical.z){for(let Ce=0;Ce<le.length;Ce++){const Oe=f.featuresOnBorder[le[Ce]],ft=Oe.borders[W];let je;for(;ve<be.length&&(je=xe.featuresOnBorder[be[ve]],!(je.borders[te][1]>ft[0]+3));)Pe&&xe.encodeCentroid(void 0,je,!1),ve++;if(je&&ve<be.length){const Je=ve;let Ve=0;for(;!(je.borders[te][0]>ft[1]-3)&&(Ve++,++ve!==be.length);)je=xe.featuresOnBorder[be[ve]];if(je=xe.featuresOnBorder[be[Je]],Oe.intersectsCount()>1||je.intersectsCount()>1||Ve!==1){Ve!==1&&(ve=Je),f.encodeCentroid(void 0,Oe,!1),Pe&&xe.encodeCentroid(void 0,je,!1);continue}const dt=$[W](Oe,je),Be=W%2?s.EXTENT-1:0;K.x=se(dt[0],Math.min(s.EXTENT-1,dt[1]),Be,W<2,dt[2]),K.y=0,f.encodeCentroid(K,Oe,!1),Pe&&xe.encodeCentroid(K,je,!1)}else f.encodeCentroid(void 0,Oe,!1)}f.borderDoneWithNeighborZ[W]=xe.canonical.z,f.needsCentroidUpdate=!0,Pe&&(xe.borderDoneWithNeighborZ[te]=f.canonical.z,xe.needsCentroidUpdate=!0)}else{for(const Ce of le)f.encodeCentroid(void 0,f.featuresOnBorder[Ce],!1);if(Pe){for(const Ce of be)xe.encodeCentroid(void 0,xe.featuresOnBorder[Ce],!1);xe.borderDoneWithNeighborZ[te]=f.canonical.z,xe.needsCentroidUpdate=!0}f.borderDoneWithNeighborZ[W]=xe.canonical.z,f.needsCentroidUpdate=!0}}(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(h)}const Sa=new s.Color(1,0,0,1),od=new s.Color(0,1,0,1),ad=new s.Color(0,0,1,1),uh=new s.Color(1,0,1,1),yp=new s.Color(0,1,1,1);function _p(h,n,a){const f=h.context,y=h.transform,b=f.gl,C=y.projection.name==="globe",A=C?["PROJECTION_GLOBE_VIEW"]:null;let I=a.projMatrix;if(C&&s.globeToMercatorTransition(y.zoom)>0){const Oe=s.transitionTileAABBinECEF(a.canonical,y),ft=s.globeDenormalizeECEF(Oe);I=s.multiply(new Float32Array(16),y.globeMatrix,ft),s.multiply(I,y.projMatrix,I)}const N=h.useProgram("debug",null,A),z=n.getTileByID(a.key);h.terrain&&h.terrain.setupElevationDraw(z,N);const $=s.DepthMode.disabled,K=s.StencilMode.disabled,re=h.colorModeForRenderPass(),ie="$debug";f.activeTexture.set(b.TEXTURE0),h.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),C?z._makeGlobeTileDebugBuffers(h.context,y):z._makeDebugTileBoundsBuffers(h.context,y.projection);const ne=z._tileDebugBuffer||h.debugBuffer,se=z._tileDebugIndexBuffer||h.debugIndexBuffer,W=z._tileDebugSegments||h.debugSegments;N.draw(f,b.LINE_STRIP,$,K,re,s.CullFaceMode.disabled,ic(I,s.Color.red),ie,ne,se,W,null,null,null,[z._globeTileDebugBorderBuffer]);const te=z.latestRawTileData,le=Math.floor((te&&te.byteLength||0)/1024),ce=n.getTile(a).tileSize,xe=512/Math.min(ce,512)*(a.overscaledZ/y.zoom)*.5;let be=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(be+=` => ${a.overscaledZ}`),be+=` ${le}kb`,(function(Oe,ft){Oe.initDebugOverlayCanvas();const je=Oe.debugOverlayCanvas,Je=Oe.context.gl,Ve=Oe.debugOverlayCanvas.getContext("2d");Ve.clearRect(0,0,je.width,je.height),Ve.shadowColor="white",Ve.shadowBlur=2,Ve.lineWidth=1.5,Ve.strokeStyle="white",Ve.textBaseline="top",Ve.font="bold 36px Open Sans, sans-serif",Ve.fillText(ft,5,5),Ve.strokeText(ft,5,5),Oe.debugOverlayTexture.update(je),Oe.debugOverlayTexture.bind(Je.LINEAR,Je.CLAMP_TO_EDGE)})(h,be);const ve=z._tileDebugTextBuffer||h.debugBuffer,Pe=z._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,Ce=z._tileDebugTextSegments||h.debugSegments;N.draw(f,b.TRIANGLES,$,K,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,ic(I,s.Color.transparent,xe),ie,ve,Pe,Ce,null,null,null,[z._globeTileDebugTextBuffer])}function Ea(h,n,a,f){eo(h,0,n+a/2,h.transform.width,a,f)}function dl(h,n,a,f){eo(h,n-a/2,0,a,h.transform.height,f)}function eo(h,n,a,f,y,b){const C=h.context,A=C.gl;A.enable(A.SCISSOR_TEST),A.scissor(n*s.exported.devicePixelRatio,a*s.exported.devicePixelRatio,f*s.exported.devicePixelRatio,y*s.exported.devicePixelRatio),C.clear({color:b}),A.disable(A.SCISSOR_TEST)}const ru=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:hh}=ru;function vs(h,n,a,f){h.emplaceBack(n,a,f)}class wo{constructor(n){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,vs(this.vertexArray,-1,-1,1),vs(this.vertexArray,1,-1,1),vs(this.vertexArray,-1,1,1),vs(this.vertexArray,1,1,1),vs(this.vertexArray,-1,-1,-1),vs(this.vertexArray,1,-1,-1),vs(this.vertexArray,-1,1,-1),vs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,hh),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function Oi(h,n,a,f,y,b){const C=h.gl,A=n.paint.get("sky-atmosphere-color"),I=n.paint.get("sky-atmosphere-halo-color"),N=n.paint.get("sky-atmosphere-sun-intensity"),z=(($,K,re,ie,ne)=>({u_matrix_3f:$,u_sun_direction:K,u_sun_intensity:re,u_color_tint_r:[ie.r,ie.g,ie.b,ie.a],u_color_tint_m:[ne.r,ne.g,ne.b,ne.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),f),y,N,A,I);C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),a.draw(h,C.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,z,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const pl=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class cc{constructor(n){const a=new s.StructArrayLayout5f20;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const f=new s.StructArrayLayout3ui6;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,pl.members),this.indexBuffer=n.createIndexBuffer(f),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ko={symbol:function(h,n,a,f,y){if(h.renderPass!=="translucent")return;const b=s.StencilMode.disabled,C=h.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&(function(A,I,N,z,$,K,re){const ie=I.transform,ne=$==="map",se=K==="map";for(const W of A){const te=z.getTile(W),le=te.getBucket(N);if(!le||!le.text||!le.text.segments.get().length)continue;const ce=s.evaluateSizeForZoom(le.textSizeData,ie.zoom),xe=ln(W,le.getProjection(),ie),be=ie.calculatePixelsToTileUnitsMatrix(te),ve=rt(xe,te.tileID.canonical,se,ne,ie,le.getProjection(),be),Pe=N.layout.get("icon-text-fit")!=="none"&&le.hasIconData();if(ce){const Ce=Math.pow(2,ie.zoom-te.tileID.overscaledZ);gp(le,ne,se,re,s.symbolSize,ie,ve,W,Ce,ce,Pe)}}})(f,h,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),y),a.paint.get("icon-opacity").constantOr(1)!==0&&sd(h,n,a,f,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),b,C),a.paint.get("text-opacity").constantOr(1)!==0&&sd(h,n,a,f,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),b,C),n.map.showCollisionBoxes&&(hl(h,n,a,f,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),hl(h,n,a,f,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(h,n,a,f){if(h.renderPass!=="translucent")return;const y=a.paint.get("circle-opacity"),b=a.paint.get("circle-stroke-width"),C=a.paint.get("circle-stroke-opacity"),A=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)===0&&(b.constantOr(1)===0||C.constantOr(1)===0))return;const I=h.context,N=I.gl,z=h.transform,$=h.depthModeForSublayer(0,s.DepthMode.ReadOnly),K=s.StencilMode.disabled,re=h.colorModeForRenderPass(),ie=z.projection.name==="globe",ne=[s.mercatorXfromLng(z.center.lng),s.mercatorYfromLat(z.center.lat)],se=[];for(let te=0;te<f.length;te++){const le=f[te],ce=n.getTile(le),xe=ce.getBucket(a);if(!xe||xe.projection.name!==z.projection.name)continue;const be=xe.programConfigurations.get(a.id),ve=Jc(a);ie&&ve.push("PROJECTION_GLOBE_VIEW");const Pe=h.useProgram("circle",be,ve),Ce=xe.layoutVertexBuffer,Oe=xe.globeExtVertexBuffer,ft=xe.indexBuffer,je=z.projection.createInversionMatrix(z,le.canonical),Je={programConfiguration:be,program:Pe,layoutVertexBuffer:Ce,globeExtVertexBuffer:Oe,indexBuffer:ft,uniformValues:eh(h,le,ce,je,ne,a),tile:ce};if(A){const Ve=xe.segments.get();for(const dt of Ve)se.push({segments:new s.SegmentVector([dt]),sortKey:dt.sortKey,state:Je})}else se.push({segments:xe.segments,sortKey:0,state:Je})}A&&se.sort(((te,le)=>te.sortKey-le.sortKey));const W={useDepthForOcclusion:!ie};for(const te of se){const{programConfiguration:le,program:ce,layoutVertexBuffer:xe,globeExtVertexBuffer:be,indexBuffer:ve,uniformValues:Pe,tile:Ce}=te.state,Oe=te.segments;h.terrain&&h.terrain.setupElevationDraw(Ce,ce,W),h.prepareDrawProgram(I,ce,Ce.tileID.toUnwrapped()),ce.draw(I,N.TRIANGLES,$,K,re,s.CullFaceMode.disabled,Pe,a.id,xe,ve,Oe,a.paint,z.zoom,le,[be])}},heatmap:function(h,n,a,f){if(a.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const y=h.context,b=y.gl,C=s.StencilMode.disabled,A=new s.ColorMode([b.ONE,b.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(re,ie,ne,se){const W=re.gl,te=ie.width*se,le=ie.height*se;re.activeTexture.set(W.TEXTURE1),re.viewport.set([0,0,te,le]);let ce=ne.heatmapFbo;if(!ce||ce&&(ce.width!==te||ce.height!==le)){ce&&ce.destroy();const xe=W.createTexture();W.bindTexture(W.TEXTURE_2D,xe),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),ce=ne.heatmapFbo=re.createFramebuffer(te,le,!1),(function(be,ve,Pe,Ce,Oe,ft){const je=be.gl;je.texImage2D(je.TEXTURE_2D,0,be.isWebGL2&&be.extRenderToTextureHalfFloat?je.RGBA16F:je.RGBA,Oe,ft,0,je.RGBA,be.extRenderToTextureHalfFloat?be.isWebGL2?je.HALF_FLOAT:be.extTextureHalfFloat.HALF_FLOAT_OES:je.UNSIGNED_BYTE,null),Ce.colorAttachment.set(Pe)})(re,0,xe,ce,te,le)}else W.bindTexture(W.TEXTURE_2D,ce.colorAttachment.get()),re.bindFramebuffer.set(ce.framebuffer)})(y,h,a,h.transform.projection.name==="globe"?.5:.25),y.clear({color:s.Color.transparent});const I=h.transform,N=I.projection.name==="globe",z=N?["PROJECTION_GLOBE_VIEW"]:null,$=N?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,K=[s.mercatorXfromLng(I.center.lng),s.mercatorYfromLat(I.center.lat)];for(let re=0;re<f.length;re++){const ie=f[re];if(n.hasRenderableParent(ie))continue;const ne=n.getTile(ie),se=ne.getBucket(a);if(!se||se.projection.name!==I.projection.name)continue;const W=se.programConfigurations.get(a.id),te=h.useProgram("heatmap",W,z),{zoom:le}=h.transform;h.terrain&&h.terrain.setupElevationDraw(ne,te),h.prepareDrawProgram(y,te,ie.toUnwrapped());const ce=I.projection.createInversionMatrix(I,ie.canonical);te.draw(y,b.TRIANGLES,s.DepthMode.disabled,C,A,$,rh(h,ie,ne,ce,K,le,a.paint.get("heatmap-intensity")),a.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,a.paint,h.transform.zoom,W,N?[se.globeExtVertexBuffer]:null)}y.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),(function(y,b){const C=y.context,A=C.gl,I=b.heatmapFbo;if(!I)return;C.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,I.colorAttachment.get()),C.activeTexture.set(A.TEXTURE1);let N=b.colorRampTexture;N||(N=b.colorRampTexture=new s.Texture(C,b.colorRamp,A.RGBA)),N.bind(A.LINEAR,A.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(C,A.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,y.colorModeForRenderPass(),s.CullFaceMode.disabled,((z,$,K,re)=>({u_image:0,u_color_ramp:1,u_opacity:$.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)})(h,a))},line:function(h,n,a,f){if(h.renderPass!=="translucent")return;const y=a.paint.get("line-opacity"),b=a.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const C=h.depthModeForSublayer(0,s.DepthMode.ReadOnly),A=h.colorModeForRenderPass(),I=h.terrain&&h.terrain.renderingToTexture?1:s.exported.devicePixelRatio,N=a.paint.get("line-dasharray"),z=N.constantOr(1),$=a.layout.get("line-cap"),K=a.paint.get("line-pattern"),re=K.constantOr(1),ie=a.paint.get("line-gradient"),ne=re?"linePattern":"line",se=h.context,W=se.gl,te=(ce=>{const xe=[];ul(ce)&&xe.push("RENDER_LINE_DASH"),ce.paint.get("line-gradient")&&xe.push("RENDER_LINE_GRADIENT");const be=ce.paint.get("line-trim-offset");be[0]===0&&be[1]===0||xe.push("RENDER_LINE_TRIM_OFFSET");const ve=ce.paint.get("line-pattern").constantOr(1),Pe=ce.paint.get("line-opacity").constantOr(1)!==1;return!ve&&Pe&&xe.push("RENDER_LINE_ALPHA_DISCARD"),xe})(a);let le=te.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(le=!1);for(const ce of f){const xe=n.getTile(ce);if(re&&!xe.patternsLoaded())continue;const be=xe.getBucket(a);if(!be)continue;h.prepareDrawTile();const ve=be.programConfigurations.get(a.id),Pe=h.useProgram(ne,ve,te),Ce=K.constantOr(null);if(Ce&&xe.imageAtlas){const Qe=xe.imageAtlas.patternPositions[Ce.toString()];Qe&&ve.setConstantPatternPositions(Qe)}const Oe=N.constantOr(null),ft=$.constantOr(null);if(!re&&Oe&&ft&&xe.lineAtlas){const Qe=xe.lineAtlas.getDash(Oe,ft);Qe&&ve.setConstantPatternPositions(Qe)}let[je,Je]=a.paint.get("line-trim-offset");(ft==="round"||ft==="square")&&je!==Je&&(je===0&&(je-=1),Je===1&&(Je+=1));const Ve=h.terrain?ce.projMatrix:null,dt=re?sc(h,xe,a,Ve,I):ll(h,xe,a,Ve,be.lineClipsArray.length,I,[je,Je]);if(ie){const Qe=be.gradients[a.id];let ht=Qe.texture;if(a.gradientVersion!==Qe.version){let ct=256;if(a.stepInterpolant){const gt=n.getSource().maxzoom,Ut=ce.canonical.z===gt?Math.ceil(1<<h.transform.maxZoom-ce.canonical.z):1;ct=s.clamp(s.nextPowerOfTwo(be.maxLineLength/s.EXTENT*1024*Ut),256,se.maxTextureSize)}Qe.gradient=s.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:ct,image:Qe.gradient||void 0,clips:be.lineClipsArray}),Qe.texture?Qe.texture.update(Qe.gradient):Qe.texture=new s.Texture(se,Qe.gradient,W.RGBA),Qe.version=a.gradientVersion,ht=Qe.texture}se.activeTexture.set(W.TEXTURE1),ht.bind(a.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}z&&(se.activeTexture.set(W.TEXTURE0),xe.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),ve.updatePaintBuffers()),re&&(se.activeTexture.set(W.TEXTURE0),xe.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),ve.updatePaintBuffers()),h.prepareDrawProgram(se,Pe,ce.toUnwrapped());const Be=Qe=>{Pe.draw(se,W.TRIANGLES,C,Qe,A,s.CullFaceMode.disabled,dt,a.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,a.paint,h.transform.zoom,ve,[be.layoutVertexBuffer2])};if(le){const Qe=h.stencilModeForClipping(ce).ref;Qe===0&&h.terrain&&se.clear({stencil:0});const ht={func:W.EQUAL,mask:255};dt.u_alpha_discard_threshold=.8,Be(new s.StencilMode(ht,Qe,255,W.KEEP,W.KEEP,W.INVERT)),dt.u_alpha_discard_threshold=0,Be(new s.StencilMode(ht,Qe,255,W.KEEP,W.KEEP,W.KEEP))}else Be(h.stencilModeForClipping(ce))}le&&(h.resetStencilClippingMasks(),h.terrain&&se.clear({stencil:0}))},fill:function(h,n,a,f){const y=a.paint.get("fill-color"),b=a.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const C=h.colorModeForRenderPass(),A=a.paint.get("fill-pattern"),I=h.opaquePassEnabledForLayer()&&!A.constantOr(1)&&y.constantOr(s.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===I){const N=h.depthModeForSublayer(1,h.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);xs(h,n,a,f,N,C,!1)}if(h.renderPass==="translucent"&&a.paint.get("fill-antialias")){const N=h.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);xs(h,n,a,f,N,C,!0)}},"fill-extrusion":function(h,n,a,f){const y=a.paint.get("fill-extrusion-opacity");if(y!==0&&h.renderPass==="translucent"){const b=new s.DepthMode(h.context.gl.LEQUAL,s.DepthMode.ReadWrite,h.depthRangeFor3D);if(y!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))Xo(h,n,a,f,b,s.StencilMode.disabled,s.ColorMode.disabled),Xo(h,n,a,f,b,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const C=h.colorModeForRenderPass();Xo(h,n,a,f,b,s.StencilMode.disabled,C)}}},hillshade:function(h,n,a,f){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const y=h.context,b=h.depthModeForSublayer(0,s.DepthMode.ReadOnly),C=h.colorModeForRenderPass(),A=h.terrain&&h.terrain.renderingToTexture,[I,N]=h.renderPass!=="translucent"||A?[{},f]:h.stencilConfigForOverlap(f);for(const z of N){const $=n.getTile(z);if($.needsHillshadePrepare&&h.renderPass==="offscreen")Zc(h,$,a,b,s.StencilMode.disabled,C);else if(h.renderPass==="translucent"){const K=A&&h.terrain?h.terrain.stencilModeForRTTOverlap(z):I[z.overscaledZ];ed(h,z,$,a,b,K,C)}}y.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,n,a,f,y,b){if(h.renderPass!=="translucent"||a.paint.get("raster-opacity")===0||!f.length)return;const C=h.context,A=C.gl,I=n.getSource(),N=h.useProgram("raster"),z=h.colorModeForRenderPass(),$=h.terrain&&h.terrain.renderingToTexture,[K,re]=I instanceof dr||$?[{},f]:h.stencilConfigForOverlap(f),ie=re[re.length-1].overscaledZ,ne=!h.options.moving;for(const se of re){const W=$?s.DepthMode.disabled:h.depthModeForSublayer(se.overscaledZ-ie,a.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,A.LESS),te=se.toUnwrapped(),le=n.getTile(se);if($&&(!le||!le.hasData()))continue;const ce=$?se.projMatrix:h.transform.calculateProjMatrix(te,ne),xe=h.terrain&&$?h.terrain.stencilModeForRTTOverlap(se):K[se.overscaledZ],be=b?0:a.paint.get("raster-fade-duration");le.registerFadeDuration(be);const ve=n.findLoadedParent(se,0),Pe=Xu(le,ve,n,h.transform,be);let Ce,Oe;h.terrain&&h.terrain.prepareDrawTile();const ft=a.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;C.activeTexture.set(A.TEXTURE0),le.texture.bind(ft,A.CLAMP_TO_EDGE),C.activeTexture.set(A.TEXTURE1),ve?(ve.texture.bind(ft,A.CLAMP_TO_EDGE),Ce=Math.pow(2,ve.tileID.overscaledZ-le.tileID.overscaledZ),Oe=[le.tileID.canonical.x*Ce%1,le.tileID.canonical.y*Ce%1]):le.texture.bind(ft,A.CLAMP_TO_EDGE),le.texture.useMipmap&&C.extTextureFilterAnisotropic&&h.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);const je=eu(ce,Oe||[0,0],Ce||1,Pe,a,I instanceof dr?I.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(C,N,te),I instanceof dr)I.boundsBuffer&&I.boundsSegments&&N.draw(C,A.TRIANGLES,W,s.StencilMode.disabled,z,s.CullFaceMode.disabled,je,a.id,I.boundsBuffer,h.quadTriangleIndexBuffer,I.boundsSegments);else{const{tileBoundsBuffer:Je,tileBoundsIndexBuffer:Ve,tileBoundsSegments:dt}=h.getTileBoundsBuffers(le);N.draw(C,A.TRIANGLES,W,xe,z,s.CullFaceMode.disabled,je,a.id,Je,Ve,dt)}}h.resetStencilClippingMasks()},background:function(h,n,a,f){const y=a.paint.get("background-color"),b=a.paint.get("background-opacity");if(b===0)return;const C=h.context,A=C.gl,I=h.transform,N=I.tileSize,z=a.paint.get("background-pattern");if(h.isPatternMissing(z))return;const $=!z&&y.a===1&&b===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==$)return;const K=s.StencilMode.disabled,re=h.depthModeForSublayer(0,$==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),ie=h.colorModeForRenderPass(),ne=h.useProgram(z?"backgroundPattern":"background");let se,W=f;W||(se=h.getBackgroundTiles(),W=Object.values(se).map((te=>te.tileID))),z&&(C.activeTexture.set(A.TEXTURE0),h.imageManager.bind(h.context));for(const te of W){const le=te.toUnwrapped(),ce=f?te.projMatrix:h.transform.calculateProjMatrix(le);h.prepareDrawTile();const xe=n?n.getTile(te):se?se[te.key]:new s.Tile(te,N,I.zoom,h),be=z?sh(ce,b,h,z,{tileID:te,tileSize:N}):tu(ce,b,y);h.prepareDrawProgram(C,ne,le);const{tileBoundsBuffer:ve,tileBoundsIndexBuffer:Pe,tileBoundsSegments:Ce}=h.getTileBoundsBuffers(xe);ne.draw(C,A.TRIANGLES,re,K,ie,s.CullFaceMode.disabled,be,a.id,ve,Pe,Ce)}},sky:function(h,n,a){const f=h.transform,y=f.projection.name==="mercator"||f.projection.name==="globe"?1:s.smoothstep(7,8,f.zoom),b=a.paint.get("sky-opacity")*y;if(b===0)return;const C=h.context,A=a.paint.get("sky-type"),I=new s.DepthMode(C.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),N=h.frameCounter/1e3%1;A==="atmosphere"?h.renderPass==="offscreen"?a.needsSkyboxCapture(h)&&((function(z,$,K,re){const ie=z.context,ne=ie.gl;let se=$.skyboxFbo;if(!se){se=$.skyboxFbo=ie.createFramebuffer(32,32,!1),$.skyboxGeometry=new wo(ie),$.skyboxTexture=ie.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,$.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let ce=0;ce<6;++ce)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}ie.bindFramebuffer.set(se.framebuffer),ie.viewport.set([0,0,32,32]);const W=$.getCenter(z,!0),te=z.useProgram("skyboxCapture"),le=new Float64Array(16);s.identity(le),s.rotateY(le,le,.5*-Math.PI),Oi(ie,$,te,le,W,0),s.identity(le),s.rotateY(le,le,.5*Math.PI),Oi(ie,$,te,le,W,1),s.identity(le),s.rotateX(le,le,.5*-Math.PI),Oi(ie,$,te,le,W,2),s.identity(le),s.rotateX(le,le,.5*Math.PI),Oi(ie,$,te,le,W,3),s.identity(le),Oi(ie,$,te,le,W,4),s.identity(le),s.rotateY(le,le,Math.PI),Oi(ie,$,te,le,W,5),ie.viewport.set([0,0,z.width,z.height])})(h,a),a.markSkyboxValid(h)):h.renderPass==="sky"&&(function(z,$,K,re,ie){const ne=z.context,se=ne.gl,W=z.transform,te=z.useProgram("skybox");ne.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,$.skyboxTexture);const le=((ce,xe,be,ve,Pe)=>({u_matrix:ce,u_sun_direction:xe,u_cubemap:0,u_opacity:ve,u_temporal_offset:Pe}))(W.skyboxMatrix,$.getCenter(z,!1),0,re,ie);z.prepareDrawProgram(ne,te),te.draw(ne,se.TRIANGLES,K,s.StencilMode.disabled,z.colorModeForRenderPass(),s.CullFaceMode.backCW,le,"skybox",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)})(h,a,I,b,N):A==="gradient"&&h.renderPass==="sky"&&(function(z,$,K,re,ie){const ne=z.context,se=ne.gl,W=z.transform,te=z.useProgram("skyboxGradient");$.skyboxGeometry||($.skyboxGeometry=new wo(ne)),ne.activeTexture.set(se.TEXTURE0);let le=$.colorRampTexture;le||(le=$.colorRampTexture=new s.Texture(ne,$.colorRamp,se.RGBA)),le.bind(se.LINEAR,se.CLAMP_TO_EDGE);const ce=((xe,be,ve,Pe,Ce)=>({u_matrix:xe,u_color_ramp:0,u_center_direction:be,u_radius:s.degToRad(ve),u_opacity:Pe,u_temporal_offset:Ce}))(W.skyboxMatrix,$.getCenter(z,!1),$.paint.get("sky-gradient-radius"),re,ie);z.prepareDrawProgram(ne,te),te.draw(ne,se.TRIANGLES,K,s.StencilMode.disabled,z.colorModeForRenderPass(),s.CullFaceMode.backCW,ce,"skyboxGradient",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)})(h,a,I,b,N)},debug:function(h,n,a){for(let f=0;f<a.length;f++)_p(h,n,a[f])},custom:function(h,n,a,f){const y=h.context,b=a.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&a.isLayerDraped()){if(h.renderPass==="offscreen"){const C=b.prerender;if(C){if(h.setCustomLayerDefaults(),y.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const A=h.transform.pointMerc;C.call(b,y.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(h.transform.zoom),[A.x,A.y],h.transform.pixelsPerMeterRatio)}else C.call(b,y.gl,h.transform.customLayerMatrix());y.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const A=b.renderToTile;if(A){const I=f[0].canonical,N=new s.MercatorCoordinate(I.x+f[0].wrap*(1<<I.z),I.y,I.z);y.setDepthMode(s.DepthMode.disabled),y.setStencilMode(s.StencilMode.disabled),y.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),A.call(b,y.gl,N),y.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),y.setColorMode(h.colorModeForRenderPass()),y.setStencilMode(s.StencilMode.disabled);const C=b.renderingMode==="3d"?new s.DepthMode(h.context.gl.LEQUAL,s.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,s.DepthMode.ReadOnly);if(y.setDepthMode(C),h.transform.projection.name==="globe"){const A=h.transform.pointMerc;b.render(y.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(h.transform.zoom),[A.x,A.y],h.transform.pixelsPerMeterRatio)}else b.render(y.gl,h.transform.customLayerMatrix());y.setDirty(),h.setBaseState(),y.bindFramebuffer.set(null)}}else s.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class ka{constructor(n,a,f=!1){this.context=new xt(n,f),this.transform=a,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,a){const f=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ku(this,n));const y=this._terrain;this.transform.elevation=f?y:null,y.update(n,this.transform,a)}_updateFog(n){const a=n.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,y]=a.getFovAdjustedRange(this.transform._fov);if(f>y)return void(this.transform.fogCullDistSq=null);const b=f+.78*(y-f);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,a){if(this.width=n*s.exported.devicePixelRatio,this.height=a*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._layers[f].resize()}setup(){const n=this.context,a=new s.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(s.EXTENT,0),a.emplaceBack(0,s.EXTENT),a.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(a,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const f=new s.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(s.EXTENT,0),f.emplaceBack(0,s.EXTENT),f.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=n.createVertexBuffer(f,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const y=new s.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(y,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const b=new s.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(s.EXTENT,0,s.EXTENT,0),b.emplaceBack(0,s.EXTENT,0,s.EXTENT),b.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(b,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const C=new s.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(C);const A=new s.StructArrayLayout1ui2;for(const N of[0,1,3,2,0])A.emplaceBack(N);this.debugIndexBuffer=n.createIndexBuffer(A),this.emptyTexture=new s.Texture(n,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=s.create();const I=this.context.gl;this.stencilClearMode=new s.StencilMode({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new cc(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,a=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,a.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,ec(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,f){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const I of f)if(this._tileClippingMaskIDs[I.key]===void 0){A=!0;break}if(!A)return}this.currentStencilSource=a.id;const y=this.context,b=y.gl;this.nextStencilID+f.length>256&&this.clearStencil(),y.setColorMode(s.ColorMode.disabled),y.setDepthMode(s.DepthMode.disabled);const C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of f){const I=a.getTile(A),N=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:$,tileBoundsSegments:K}=this.getTileBoundsBuffers(I);C.draw(y,b.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:b.ALWAYS,mask:0},N,255,b.KEEP,b.KEEP,b.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,ec(A.projMatrix),"$clipping",z,$,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new s.StencilMode({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const a=this.context.gl;return new s.StencilMode({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){const a=this.context.gl,f=n.sort(((C,A)=>A.overscaledZ-C.overscaledZ)),y=f[f.length-1].overscaledZ,b=f[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const C={};for(let A=0;A<b;A++)C[A+y]=new s.StencilMode({func:a.GEQUAL,mask:255},A+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[C,f]}return[{[y]:s.StencilMode.disabled},f]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([n.CONSTANT_COLOR,n.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(n,a,f){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new s.DepthMode(f||this.context.gl.LEQUAL,a,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,a){this.style=n,this.options=a,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const f=this.style.order,y=this.style._sourceCaches;for(const N in y){const z=y[N];z.used&&z.prepare(this.context)}const b={},C={},A={};for(const N in y){const z=y[N];b[N]=z.getVisibleCoordinates(),C[N]=b[N].slice().reverse(),A[N]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<f.length;N++)if(this.style._layers[f[N]].is3D()){this.opaquePassCutoff=N;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),!s.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const N of f){const z=this.style._layers[N],$=n._getLayerSourceCache(z);if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const K=$?C[$.id]:void 0;(z.type==="custom"||z.isSky()||K&&K.length)&&this.renderLayer(this,$,z,K)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon];const I=this.terrain;if(I&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&I.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:a.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[f[this.currentLayer]],z=n._getLayerSourceCache(N);if(N.isSky())continue;const $=z?C[z.id]:void 0;this._renderTileClippingMasks(N,z,$),this.renderLayer(this,z,N,$)}if(this.style.fog&&this.transform.projection.supportsFog&&(function(N,z){const $=N.context,K=$.gl,re=N.transform,ie=new s.DepthMode(K.LEQUAL,s.DepthMode.ReadOnly,[0,1]),ne=N.useProgram("globeAtmosphere",null,re.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),se=s.globeToMercatorTransition(re.zoom),W=z.properties.get("color").toArray01(),te=z.properties.get("high-color").toArray01(),le=z.properties.get("space-color").toArray01PremultipliedAlpha(),ce=s.identity$1([]);s.rotateY$1(ce,ce,-s.degToRad(re._center.lng)),s.rotateX$1(ce,ce,s.degToRad(re._center.lat)),s.rotateZ$1(ce,ce,re.angle),s.rotateX$1(ce,ce,-re._pitch);const xe=s.fromQuat(new Float32Array(16),ce),be=s.mapValue(z.properties.get("star-intensity"),0,1,0,.25),ve=5e-4,Pe=s.mapValue(z.properties.get("horizon-blend"),0,1,ve,.25),Ce=s.globeUseCustomAntiAliasing(N,$,re)&&Pe===ve?re.worldSize/(2*Math.PI*1.025)-1:re.globeRadius,Oe=N.frameCounter/1e3%1,ft=s.length(re.globeCenterInViewSpace),je=Math.sqrt(Math.pow(ft,2)-Math.pow(Ce,2)),Je=Math.acos(je/ft),Ve=((Be,Qe,ht,ct,gt,Ut,er,Nt,Xt,br,Er,Vt,Ir,Gr)=>({u_frustum_tl:Be,u_frustum_tr:Qe,u_frustum_br:ht,u_frustum_bl:ct,u_horizon:gt,u_transition:Ut,u_fadeout_range:er,u_color:Nt,u_high_color:Xt,u_space_color:br,u_star_intensity:Er,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Vt,u_horizon_angle:Ir,u_rotation_matrix:Gr}))(re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.frustumCorners.horizon,se,Pe,W,te,le,be,Oe,Je,xe);N.prepareDrawProgram($,ne);const dt=N.atmosphereBuffer;dt&&ne.draw($,K.TRIANGLES,ie,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Ve,"skybox",dt.vertexBuffer,dt.indexBuffer,dt.segments)})(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const N=this.style._layers[f[this.currentLayer]],z=n._getLayerSourceCache(N);N.isSky()&&this.renderLayer(this,z,N,z?C[z.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;){const N=this.style._layers[f[this.currentLayer]],z=n._getLayerSourceCache(N);if(N.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(N)){if(N.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const $=z?(N.type==="symbol"?A:C)[z.id]:void 0;this._renderTileClippingMasks(N,z,z?b[z.id]:void 0),this.renderLayer(this,z,N,$),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let N=null;s.values(this.style._layers).forEach((z=>{const $=n._getLayerSourceCache(z);$&&!z.isHidden(this.transform.zoom)&&(!N||N.getSource().maxzoom<$.getSource().maxzoom)&&(N=$)})),N&&this.options.showTileBoundaries&&Ko.debug(this,N,N.getVisibleCoordinates())}this.options.showPadding&&(function(N){const z=N.transform.padding;Ea(N,N.transform.height-(z.top||0),3,Sa),Ea(N,z.bottom||0,3,od),dl(N,z.left||0,3,ad),dl(N,N.transform.width-(z.right||0),3,uh);const $=N.transform.centerPoint;(function(K,re,ie,ne){eo(K,re-1,ie-10,2,20,ne),eo(K,re-10,ie-1,20,2,ne)})(N,$.x,N.transform.height-$.y,yp)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,a,f,y){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||y&&y.length)&&(this.id=f.id,this.gpuTimingStart(f),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(f.type)||n.terrain&&f.type==="custom")&&Ko[f.type](n,a,f,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let f=this.gpuTimers[n.id];f||(f=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),f.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,f.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,a=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(a),n.beginQueryEXT(n.TIME_ELAPSED_EXT,a)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const a={};for(const f in n){const y=n[f],b=this.context.extTimerQuery,C=b.getQueryObjectEXT(y.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(y.query),a[f]=C}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery;let f=0;for(const y of n)f+=a.getQueryObjectEXT(y,a.QUERY_RESULT_EXT)/1e6,a.deleteQueryEXT(y);return f}translatePosMatrix(n,a,f,y,b){if(!f[0]&&!f[1])return n;const C=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(C){const N=Math.sin(C),z=Math.cos(C);f=[f[0]*z-f[1]*N,f[0]*N+f[1]*z]}const A=[b?f[0]:st(a,f[0],this.transform.zoom),b?f[1]:st(a,f[1],this.transform.zoom),0],I=new Float32Array(16);return s.translate(I,n,A),I}saveTileTexture(n){const a=this._tileTextures[n.size[0]];a?a.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}isPatternMissing(n){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,a=this.terrain&&this.terrain.exaggeration()===0,f=this.style&&this.style.fog,y=[];return this.terrainRenderModeElevated()&&y.push("TERRAIN"),this.transform.projection.name==="globe"&&y.push("GLOBE"),a&&y.push("ZERO_EXAGGERATION"),f&&!n&&f.getOpacity(this.transform.pitch)!==0&&y.push("FOG"),n&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}useProgram(n,a,f){this.cache=this.cache||{};const y=f||[],b=this.currentGlobalDefines().concat(y),C=Rr.cacheKey(Ql[n],n,b,a);return this.cache[C]||(this.cache[C]=new Rr(this.context,n,Ql[n],a,oc[n],b)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,a,f){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const b=y.getOpacity(this.transform.pitch),C=((A,I,N,z,$,K,re,ie,ne,se,W)=>{const te=A.transform,le=I.properties.get("color").toArray01();le[3]=z;const ce=A.frameCounter/1e3%1;return{u_fog_matrix:N?te.calculateFogTileMatrix(N):A.identityMat,u_fog_range:I.getFovAdjustedRange(te._fov),u_fog_color:le,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_temporal_offset:ce,u_frustum_tl:$,u_frustum_tr:K,u_frustum_br:re,u_frustum_bl:ie,u_globe_pos:ne,u_globe_radius:se,u_viewport:W,u_globe_transition:s.globeToMercatorTransition(te.zoom),u_is_globe:+(te.projection.name==="globe")}})(this,y,f,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);a.setFogUniformValues(n,C)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,a=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const y of f)a[y.key]=n[y.key]||new s.Tile(y,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}}class uc{constructor(n=0,a=0,f=0,y=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(f)||f<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=f,this.right=y}interpolate(n,a,f){return a.top!=null&&n.top!=null&&(this.top=s.number(n.top,a.top,f)),a.bottom!=null&&n.bottom!=null&&(this.bottom=s.number(n.bottom,a.bottom,f)),a.left!=null&&n.left!=null&&(this.left=s.number(n.left,a.left,f)),a.right!=null&&n.right!=null&&(this.right=s.number(n.right,a.right,f)),this}getCenter(n,a){const f=s.clamp((this.left+n-this.right)/2,0,n),y=s.clamp((this.top+a-this.bottom)/2,0,a);return new s.Point(f,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new uc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function hc(h,n){const a=s.getColumn(h,3);s.fromQuat(h,n),s.setColumn(h,3,a)}function Br(h,n){const a=s.identity$1([]);return s.rotateZ$1(a,a,-n),s.rotateX$1(a,a,-h),a}function fl(h,n){const a=[h[0],h[1],0],f=[n[0],n[1],0];if(s.length(a)>=1e-15){const C=s.normalize([],a);s.scale$2(f,C,s.dot(f,C)),n[0]=f[0],n[1]=f[1]}const y=s.cross([],n,h);if(s.len(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return Br(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),b)}class To{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){const a=n instanceof s.MercatorCoordinate?n:new s.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=s.wrap(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;const f=this.position,y=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(n)):0,b=s.MercatorCoordinate.fromLngLat(n,y),C=[b.x-f.x,b.y-f.y,b.z-f.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=fl(C,a)}setPitchBearing(n,a){this.orientation=Br(s.degToRad(n),s.degToRad(-a))}}class ml{constructor(n,a){this._transform=s.identity([]),this.orientation=a,this.position=n}get mercatorPosition(){const n=this.position;return new s.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=s.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&s.setColumn(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.identity$1([]),n&&hc(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=Br(n,a),hc(this._transform,this._orientation)}forward(){const n=s.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){const f=new Float64Array(16);return s.invert(f,this.getWorldToCamera(n,a)),f}getWorldToCameraPosition(n,a,f){const y=this.position;s.scale$2(y,y,-n);const b=new Float64Array(16);return s.fromScaling(b,[f,f,f]),s.translate(b,b,y),b[10]*=a,b}getWorldToCamera(n,a){const f=new Float64Array(16),y=new Float64Array(4),b=this.position;return s.conjugate(y,this._orientation),s.scale$2(b,b,-n),s.fromQuat(f,y),s.translate(f,f,b),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=a,f[9]*=a,f[10]*=a,f[11]*=a,f}getCameraToClipPerspective(n,a,f,y){const b=new Float64Array(16);return s.perspective(b,n,a,f,y),b}getDistanceToElevation(n,a=!1){const f=n===0?0:s.mercatorZfromAltitude(n,a?s.latFromMercatorY(this.position[1]):this.position[1]),y=this.forward();return(f-this.position[2])/y[2]}clone(){return new ml([...this.position],[...this.orientation])}}function Yo(h,n){const a=nu(h.projection,h.zoom,h.width,h.height),f=(function(b,C,A,I,N){const z=new s.LngLat(A.lng-180*es,A.lat),$=new s.LngLat(A.lng+180*es,A.lat),K=b.project(z.lng,z.lat),re=b.project($.lng,$.lat),ie=-Math.atan2(re.y-K.y,re.x-K.x),ne=s.MercatorCoordinate.fromLngLat(A);ne.y=s.clamp(ne.y,-1+es,1-es);const se=ne.toLngLat(),W=b.project(se.lng,se.lat),te=s.MercatorCoordinate.fromLngLat(se);te.x+=es;const le=te.toLngLat(),ce=b.project(le.lng,le.lat),xe=dc(ce.x-W.x,ce.y-W.y,ie),be=s.MercatorCoordinate.fromLngLat(se);be.y+=es;const ve=be.toLngLat(),Pe=b.project(ve.lng,ve.lat),Ce=dc(Pe.x-W.x,Pe.y-W.y,ie),Oe=Math.abs(xe.x)/Math.abs(Ce.y),ft=s.identity([]);s.rotateZ(ft,ft,-ie*(1-(N?0:I)));const je=s.identity([]);return s.scale(je,je,[1,1-(1-Oe)*I,1]),je[4]=-Ce.x/Ce.y*I,s.rotateZ(je,je,ie),s.multiply(je,ft,je),je})(h.projection,0,h.center,a,n),y=ld(h);return s.scale(f,f,[y,y,1]),f}function ld(h){const n=h.projection,a=nu(h.projection,h.zoom,h.width,h.height),f=cd(n,h.center),y=cd(n,s.LngLat.convert(n.center));return Math.pow(2,f*a+(1-a)*y)}function nu(h,n,a,f,y=1/0){const b=h.range;if(!b)return 0;const C=Math.min(y,Math.max(a,f)),A=Math.log(C/1024)/Math.LN2;return s.smoothstep(b[0]+A,b[1]+A,n)}const es=1/4e4;function cd(h,n){const a=s.clamp(n.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),f=new s.LngLat(n.lng-180*es,a),y=new s.LngLat(n.lng+180*es,a),b=h.project(f.lng,a),C=h.project(y.lng,a),A=s.MercatorCoordinate.fromLngLat(f),I=s.MercatorCoordinate.fromLngLat(y),N=C.x-b.x,z=C.y-b.y,$=I.x-A.x,K=I.y-A.y,re=Math.sqrt(($*$+K*K)/(N*N+z*z));return Math.log(re)/Math.LN2}function dc(h,n,a){const f=Math.cos(a),y=Math.sin(a);return{x:h*f-n*y,y:h*y+n*f}}class Ca{constructor(n,a,f,y,b,C,A){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=f??0,this._maxPitch=y??60,this.setProjection(C),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new uc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ml,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new Ca(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n,a=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(n||f)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const f=!U(a,this.getProjection());return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.Point(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const a=-n*Math.PI/180;var f;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(f=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f),(function(y,b,C){var A=b[0],I=b[1],N=b[2],z=b[3],$=Math.sin(C),K=Math.cos(C);y[0]=A*K+N*$,y[1]=I*K+z*$,y[2]=A*-$+N*K,y[3]=I*-$+z*K})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const a=s.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=s.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let y=0,b=0;for(let C=0;C<a.length;C++){const A=new s.Point(a[C][0]*this.width,f+a[C][1]*(this.height-f)),I=n.pointCoordinate(A);if(!I)continue;const N=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);y+=I[3]*N,b+=N}return b===0?NaN:y/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*a,y=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),C=Math.max(y-f,b);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let f;f=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];const y=s.length(s.sub([],this._camera.position,f));return s.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!s.exactEquals(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){const f=[n.position.x,n.position.y,n.position.z];s.exactEquals$1(f,this._camera.position)||(this._setCameraPosition(f),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,a=new To;return a.position=new s.MercatorCoordinate(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!s.length$1(n))return!1;s.normalize$1(n,n);const a=s.transformQuat([],[0,0,-1],n),f=s.transformQuat([],[0,-1,0],n);if(f[2]<0)return!1;const y=fl(a,f);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(n){const a=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;n[2]=s.clamp(n[2],y/f,y/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,f){this._unmodified=!1,this._edgeInsets.interpolate(n,a,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){const a=[new s.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const f=this.pointCoordinate(new s.Point(0,0)),y=this.pointCoordinate(new s.Point(this.width,0)),b=this.pointCoordinate(new s.Point(this.width,this.height)),C=this.pointCoordinate(new s.Point(0,this.height)),A=Math.floor(Math.min(f.x,y.x,b.x,C.x)),I=Math.floor(Math.max(f.x,y.x,b.x,C.x)),N=1;for(let z=A-N;z<=I+N;z++)z!==0&&a.push(new s.UnwrappedTileID(z,n))}return a}coveringTiles(n){let a=this.coveringZoomLevel(n);const f=a,y=this.elevation&&!n.isTerrainDEM,b=this.projection.name==="mercator";if(n.minzoom!==void 0&&a<n.minzoom)return[];n.maxzoom!==void 0&&a>n.maxzoom&&(a=n.maxzoom);const C=this.locationCoordinate(this.center),A=this.center.lat,I=1<<a,N=[I*C.x,I*C.y,0],z=this.projection.name==="globe",$=!z,K=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,$),re=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ie=I*s.mercatorZfromAltitude(1,this.center.lat),ne=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),se=[I*re.x,I*re.y,ne*($?1:ie)],W=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?a:0,le=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ce=n.isTerrainDEM?-le:this._elevation?this._elevation.getMinElevationBelowMSL():0,xe=this.projection.isReprojectedInTileSpace?ld(this):1,be=Be=>{const ht=new s.MercatorCoordinate(Be.x+25e-6,Be.y,Be.z),ct=new s.MercatorCoordinate(Be.x,Be.y+25e-6,Be.z),gt=Be.toLngLat(),Ut=ht.toLngLat(),er=ct.toLngLat(),Nt=this.locationCoordinate(gt),Xt=this.locationCoordinate(Ut),br=this.locationCoordinate(er),Er=Math.hypot(Xt.x-Nt.x,Xt.y-Nt.y),Vt=Math.hypot(br.x-Nt.x,br.y-Nt.y);return Math.sqrt(Er*Vt)*xe/25e-6},ve=Be=>{const Qe=le,ht=ce;return{aabb:s.tileAABB(this,I,0,0,0,Be,ht,Qe,this.projection),zoom:0,x:0,y:0,minZ:ht,maxZ:Qe,wrap:Be,fullyVisible:!1}},Pe=[];let Ce=[];const Oe=a,ft=n.reparseOverscaled?f:a,je=Be=>Be*Be,Je=je((ne-this._centerAltitude)*ie),Ve=Be=>{if(!this._elevation||!Be.tileID||!b)return;const Qe=this._elevation.getMinMaxForTile(Be.tileID),ht=Be.aabb;Qe?(ht.min[2]=Qe.min,ht.max[2]=Qe.max,ht.center[2]=(ht.min[2]+ht.max[2])/2):(Be.shouldSplit=dt(Be),Be.shouldSplit||(ht.min[2]=ht.max[2]=ht.center[2]=this._centerAltitude))},dt=Be=>{if(Be.zoom<te)return!0;if(Be.zoom===Oe)return!1;if(Be.shouldSplit!=null)return Be.shouldSplit;const Qe=Be.aabb.distanceX(se),ht=Be.aabb.distanceY(se);let ct=Je,gt=1;if(z){ct=je(Be.aabb.distanceZ(se));const Nt=Math.pow(2,Be.zoom),Xt=s.latFromMercatorY((Be.y+1)/Nt),br=s.latFromMercatorY(Be.y/Nt),Er=Math.min(Math.max(A,Xt),br),Vt=s.circumferenceAtLatitude(Er)/s.circumferenceAtLatitude(A);if(gt=Er===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Vt/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&Be.zoom===Oe-1&&Vt>=.9)return!0}else if(y&&(ct=je(Be.aabb.distanceZ(se)*ie)),this.projection.isReprojectedInTileSpace&&f<=5){const Nt=Math.pow(2,Be.zoom),Xt=be(new s.MercatorCoordinate((Be.x+.5)/Nt,(Be.y+.5)/Nt));gt=Xt>.85?1:Xt}const Ut=Qe*Qe+ht*ht+ct,er=je((1<<Oe-Be.zoom)*W*gt*((Nt,Xt)=>{if(Xt*je(.707)<Nt)return 1;const br=Math.sqrt(Xt/Nt);return br/(1.4144271570014144+(Math.pow(1.1,br-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ct,Je),Ut));return Ut<er};if(this.renderWorldCopies)for(let Be=1;Be<=3;Be++)Pe.push(ve(-Be)),Pe.push(ve(Be));for(Pe.push(ve(0));Pe.length>0;){const Be=Pe.pop(),Qe=Be.x,ht=Be.y;let ct=Be.fullyVisible;if(!ct){const gt=Be.aabb.intersects(K);if(gt===0)continue;ct=gt===2}if(Be.zoom!==Oe&&dt(Be))for(let gt=0;gt<4;gt++){const Ut=(Qe<<1)+gt%2,er=(ht<<1)+(gt>>1),Nt={aabb:b?Be.aabb.quadrant(gt):s.tileAABB(this,I,Be.zoom+1,Ut,er,Be.wrap,Be.minZ,Be.maxZ,this.projection),zoom:Be.zoom+1,x:Ut,y:er,wrap:Be.wrap,fullyVisible:ct,tileID:void 0,shouldSplit:void 0,minZ:Be.minZ,maxZ:Be.maxZ};y&&!z&&(Nt.tileID=new s.OverscaledTileID(Be.zoom+1===Oe?ft:Be.zoom+1,Be.wrap,Be.zoom+1,Ut,er),Ve(Nt)),Pe.push(Nt)}else{const gt=Be.zoom===Oe?ft:Be.zoom;if(n.minzoom&&n.minzoom>gt)continue;const Ut=N[0]-(.5+Qe+(Be.wrap<<Be.zoom))*(1<<a-Be.zoom),er=N[1]-.5-ht,Nt=Be.tileID?Be.tileID:new s.OverscaledTileID(gt,Be.wrap,Be.zoom,Qe,ht);Ce.push({tileID:Nt,distanceSq:Ut*Ut+er*er})}}if(this.fogCullDistSq){const Be=this.fogCullDistSq,Qe=this.horizonLineFromTop();Ce=Ce.filter((ht=>{const ct=[0,0,0,1],gt=[s.EXTENT,s.EXTENT,0,1],Ut=this.calculateFogTileMatrix(ht.tileID.toUnwrapped());s.transformMat4$1(ct,ct,Ut),s.transformMat4$1(gt,gt,Ut);const er=s.getAABBPointSquareDist(ct,gt);if(er===0)return!0;let Nt=!1;const Xt=this._elevation;if(Xt&&er>Be&&Qe!==0){const br=this.calculateProjMatrix(ht.tileID.toUnwrapped());let Er;n.isTerrainDEM||(Er=Xt.getMinMaxForTile(ht.tileID)),Er||(Er={min:ce,max:le});const Vt=s.furthestTileCorner(this.rotation),Ir=[Vt[0]*s.EXTENT,Vt[1]*s.EXTENT,Er.max];s.transformMat4(Ir,Ir,br),Nt=(1-Ir[1])*this.height*.5<Qe}return er<Be||Nt}))}return Ce.sort(((Be,Qe)=>Be.distanceSq-Qe.distanceSq)).map((Be=>Be.tileID))}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const a=s.clamp(n.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),f=this.projection.project(n.lng,a);return new s.Point(f.x*this.worldSize,f.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,a){let f,y;const b=this.centerPoint;if(this.projection.name==="globe"){const A=this.worldSize;f=(a.x-b.x)/A,y=(a.y-b.y)/A}else{const A=this.pointCoordinate(a),I=this.pointCoordinate(b);f=A.x-I.x,y=A.y-I.y}const C=this.locationCoordinate(n);this.setLocation(new s.MercatorCoordinate(C.x-f,C.y-y))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,a){const f=a?s.mercatorZfromAltitude(a,n.lat):void 0,y=this.projection.project(n.lng,n.lat);return new s.MercatorCoordinate(y.x,y.y,f)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){const f=a??this._centerAltitude,y=[n.x,n.y,0,1],b=[n.x,n.y,1,1];s.transformMat4$1(y,y,this.pixelMatrixInverse),s.transformMat4$1(b,b,this.pixelMatrixInverse);const C=b[3];s.scale$1(y,y,1/y[3]),s.scale$1(b,b,1/C);const A=y[2],I=b[2];return{p0:y,p1:b,t:A===I?0:(f-A)/(I-A)}}screenPointToMercatorRay(n){const a=[n.x,n.y,0,1],f=[n.x,n.y,1,1];return s.transformMat4$1(a,a,this.pixelMatrixInverse),s.transformMat4$1(f,f,this.pixelMatrixInverse),s.scale$1(a,a,1/a[3]),s.scale$1(f,f,1/f[3]),a[2]=s.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,f[2]=s.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,s.scale$1(a,a,1/this.worldSize),s.scale$1(f,f,1/this.worldSize),new s.Ray([a[0],a[1],a[2]],s.normalize([],s.sub([],f,a)))}rayIntersectionCoordinate(n){const{p0:a,p1:f,t:y}=n,b=s.mercatorZfromAltitude(a[2],this._center.lat),C=s.mercatorZfromAltitude(f[2],this._center.lat);return new s.MercatorCoordinate(s.number(a[0],f[0],y)/this.worldSize,s.number(a[1],f[1],y)/this.worldSize,s.number(b,C,y))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let a=this.projection.pointCoordinate3D(this,n.x,n.y);if(a)return new s.MercatorCoordinate(a[0],a[1],a[2]);let f=0,y=this.horizonLineFromTop();if(n.y>y)return this.pointCoordinate(n);const b=.02*y,C=n.clone();for(let A=0;A<10&&y-f>b;A++){C.y=s.number(f,y,.66);const I=this.projection.pointCoordinate3D(this,C.x,C.y);I?(y=C.y,a=I):f=C.y}return a?new s.MercatorCoordinate(a[0],a[1],a[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(n);const a=this.pointCoordinate(n);return a.y>=0&&a.y<=1}_coordinatePoint(n,a){const f=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,y=[n.x*this.worldSize,n.y*this.worldSize,f+n.toAltitude(),1];return s.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new s.Point(y[0]/y[3],y[1]/y[3]):new s.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:a}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new s.Point(a,n)),C=this.pointLocation3D(new s.Point(y,n)),A=this.pointLocation3D(new s.Point(y,f)),I=this.pointLocation3D(new s.Point(a,f));let N=Math.min(b.lng,C.lng,A.lng,I.lng),z=Math.max(b.lng,C.lng,A.lng,I.lng),$=Math.min(b.lat,C.lat,A.lat,I.lat),K=Math.max(b.lat,C.lat,A.lat,I.lat);const re=Math.pow(2,-this.zoom)/16*270,ie=this.projection.name==="globe"?1:4,ne=(se,W,te,le,ce)=>{const xe=(se+te)/2,be=(W+le)/2,ve=new s.Point(xe,be),{lng:Pe,lat:Ce}=this.pointLocation3D(ve),Oe=Math.max(0,N-Pe,$-Ce,Pe-z,Ce-K);N=Math.min(N,Pe),z=Math.max(z,Pe),$=Math.min($,Ce),K=Math.max(K,Ce),(ce<ie||Oe>re)&&(ne(se,W,xe,be,ce+1),ne(xe,be,te,le,ce+1))};if(ne(a,n,y,n,1),ne(y,n,y,f,1),ne(y,f,a,f,1),ne(a,f,a,n,1),this.projection.name==="globe"){const[se,W]=s.polesInViewport(this);se?(K=90,z=180,N=-180):W&&($=-90,z=180,N=-180)}return new s.LngLatBounds(new s.LngLat(N,$),new s.LngLat(z,K))}_getBoundsRectangular(n,a){const{top:f,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,A=new s.Point(y,f),I=new s.Point(C,f),N=new s.Point(C,b),z=new s.Point(y,b);let $=this.pointCoordinate(A,n),K=this.pointCoordinate(I,n);const re=this.pointCoordinate(N,a),ie=this.pointCoordinate(z,a),ne=(se,W)=>(W.y-se.y)/(W.x-se.x);return $.y>1&&K.y>=0?$=new s.MercatorCoordinate((1-ie.y)/ne(ie,$)+ie.x,1):$.y<0&&K.y<=1&&($=new s.MercatorCoordinate(-ie.y/ne(ie,$)+ie.x,0)),K.y>1&&$.y>=0?K=new s.MercatorCoordinate((1-re.y)/ne(re,K)+re.x,1):K.y<0&&$.y<=1&&(K=new s.MercatorCoordinate(-re.y/ne(re,K)+re.x,0)),new s.LngLatBounds().extend(this.coordinateLocation($)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(ie)).extend(this.coordinateLocation(re))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=n.visibleDemTiles.reduce(((f,y)=>{if(y.dem){const b=y.dem.tree;f.min=Math.min(f.min,b.minimums[0]),f.max=Math.max(f.max,b.maximums[0])}return f}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,f=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){const a=n.key,f=this._distanceTileDataCache;if(f[a])return f[a];const y=n.canonical,b=1/this.height,C=this.cameraWorldSize,A=C/this.zoomScale(y.z),I=(y.x+Math.pow(2,y.z)*n.wrap)*A,N=y.y*A,z=this.point;z.x*=C/this.worldSize,z.y*=C/this.worldSize;const $=this.angle,K=Math.sin(-$),re=-Math.cos(-$);return f[a]={bearing:[K,re],center:[(z.x-I)*b,(z.y-N)*b],scale:A/s.EXTENT*b},f[a]}calculateFogTileMatrix(n){const a=n.key,f=this._fogTileMatrixCache;if(f[a])return f[a];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return s.multiply(y,this.worldToFogMatrix,y),f[a]=new Float32Array(y),f[a]}calculateProjMatrix(n,a=!1){const f=n.key,y=a?this._alignedProjMatrixCache:this._projMatrixCache;if(y[f])return y[f];const b=this.calculatePosMatrix(n,this.worldSize);return s.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:a?this.alignedProjMatrix:this.projMatrix,b),y[f]=new Float32Array(b),y[f]}calculatePixelsToTileUnitsMatrix(n){const a=n.tileID.key,f=this._pixelsToTileUnitsCache;if(f[a])return f[a];const y=(function(b,C){const{scale:A}=b.tileTransform,I=A*s.EXTENT/(b.tileSize*Math.pow(2,C.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return N=new Float32Array(4),K=(z=C.inverseAdjustmentMatrix)[1],re=z[2],ie=z[3],se=($=[I,I])[1],N[0]=z[0]*(ne=$[0]),N[1]=K*ne,N[2]=re*se,N[3]=ie*se,N;var N,z,$,K,re,ie,ne,se})(n,this);return f[a]=y,f[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,a=s.fromScaling([],[n,n,n]);return s.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const a=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(a),y=this._camera.forward(),b=s.mercatorZfromAltitude(1,this._center.lat);f[2]/=b,y[2]/=b,s.normalize(y,y);const C=n.raycast(f,y,n.exaggeration());if(C){const A=s.scaleAndAdd([],f,y,C),I=new s.MercatorCoordinate(A[0],A[1],s.mercatorZfromAltitude(A[2],s.latFromMercatorY(A[1]))),N=(I.z+s.length([I.x-f[0],I.y-f[1],I.z-f[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const a=this._elevation,f=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(f),b=a.getAtPointOrZero(new s.MercatorCoordinate(...y)),C=this.pixelsPerMeter/this.worldSize*b,A=this._minimumHeightOverTerrain(),I=y[2]-C;if(I<=A)if(I<0||n){const N=this.locationCoordinate(this._center,this._centerAltitude),z=[y[0],y[1],N.z-y[2]],$=s.length(z);z[2]-=(A-I)/this._pixelsPerMercatorPixel;const K=s.length(z);if(K===0)return;s.scale$2(z,z,$/K*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],N.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const K=this.center;return K.lat=s.clamp(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(K.lng=s.clamp(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const a=this._unmodified,{x:f,y}=this.point;let b=0,C=f,A=y;const I=this.width/2,N=this.height/2,z=this.worldMinY*this.scale,$=this.worldMaxY*this.scale;if(y-N<z&&(A=z+N),y+N>$&&(A=$-N),$-z<this.height&&(b=Math.max(b,this.height/($-z)),A=($+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,re=this.worldMaxX*this.scale,ie=this.worldSize/2-(K+re)/2;C=(f+ie+this.worldSize)%this.worldSize-ie,C-I<K&&(C=K+I),C+I>re&&(C=re-I),re-K<this.width&&(b=Math.max(b,this.width/(re-K)),C=(re+K)/2)}C===f&&A===y||(this.center=this.unproject(new s.Point(C,A))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,a=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const f=nu(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,f),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?a:1,b=this._camera.getWorldToCamera(this.worldSize,y),C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);C[8]=2*-n.x/this.width,C[9]=2*n.y/this.height;let A=s.mul([],C,b);if(this.projection.isReprojectedInTileSpace){const be=this.locationCoordinate(this.center),ve=s.identity([]);s.translate(ve,ve,[be.x*this.worldSize,be.y*this.worldSize,0]),s.multiply(ve,ve,Yo(this)),s.translate(ve,ve,[-be.x*this.worldSize,-be.y*this.worldSize,0]),s.multiply(A,A,ve),this.inverseAdjustmentMatrix=(function(Pe){const Ce=Yo(Pe,!0);return De([],[Ce[0],Ce[1],Ce[4],Ce[5]])})(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],A,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=A,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const I=s.invert([],C);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(I,this.horizonLineFromTop(),this.height);const N=new Float32Array(16);s.identity(N),s.scale(N,N,[1,-1,1]),s.rotateX(N,N,this._pitch),s.rotateZ(N,N,this.angle);const z=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),$=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-n.x/this.width,z[9]=2*(n.y+$)/this.height,this.skyboxMatrix=s.multiply(N,z,N);const K=this.point,re=K.x,ie=K.y,ne=this.width%2/2,se=this.height%2/2,W=Math.cos(this.angle),te=Math.sin(this.angle),le=re-Math.round(re)+W*ne+te*se,ce=ie-Math.round(ie)+W*se+te*ne,xe=new Float64Array(A);if(s.translate(xe,xe,[le>.5?le-1:le,ce>.5?ce-1:ce,0]),this.alignedProjMatrix=xe,A=s.create(),s.scale(A,A,[this.width/2,-this.height/2,1]),s.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=s.create(),s.scale(A,A,[1,-1,1]),s.translate(A,A,[-1,-1,0]),s.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},A=s.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const be=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(be,be,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,f=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[n,n,a];s.scale$2(b,b,y),s.scale$2(f,f,-1),s.multiply$2(f,f,b);const C=s.create();s.translate(C,C,f),s.scale(C,C,b),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,y)}_computeCameraPosition(n){const a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-f[0]*b,y.y/this.worldSize-f[1]*b,n/this.worldSize*this._centerAltitude-f[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],y=n[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((a-f)/y,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,n,b),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,a=this._camera.forward(),{pitch:f,bearing:y}=this._camera.getPitchBearing(),b=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),A=Math.max((n[2]-b)/Math.cos(f),C),I=this._zoomFromMercatorZ(A);s.scaleAndAdd(n,n,a,A),this._pitch=s.clamp(f,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(y,-Math.PI,Math.PI),this._setZoom(s.clamp(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let a=0,f=s.GLOBE_ZOOM_THRESHOLD_MAX,y=0,b=1/0;for(;f-a>1e-6&&f>a;){const C=a+.5*(f-a),A=this.tileSize*Math.pow(2,C),I=this.getCameraToCenterDistance(this.projection,C,A),N=this.scaleZoom(I/(n*this.tileSize)),z=Math.abs(C-N);z<b&&(b=z,y=C),C<N?a=C:f=C}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){const f=Math.min(n.x,a.x),y=Math.max(n.x,a.x),b=Math.min(n.y,a.y),C=Math.max(n.y,a.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const A=[new s.Point(f,b),new s.Point(y,C),new s.Point(f,C),new s.Point(y,b)],I=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(const z of A){const $=this.pointRayIntersection(z);if($.t<0)return!0;const K=this.rayIntersectionCoordinate($);if(K.x<I||K.y<0||K.x>N||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.Point(0,0),new s.Point(this.width,this.height))}zoomDeltaToMovement(n,a){const f=s.length(s.sub([],this._camera.position,n)),y=this._zoomFromMercatorZ(f)+a;return f-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const n=(function([a,f,y],b){const C=[a,f,y,1];s.transformMat4$1(C,C,b);const A=C[3]=Math.max(C[3],1e-6);return C[0]/=A,C[1]/=A,C[2]/=A,C})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.Point(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,n))}}getCameraToCenterDistance(n,a=this.zoom,f=this.worldSize){const y=nu(n,a,this.width,this.height,1024),b=n.pixelSpaceConversion(this.center.lat,f,y);return .5/Math.tan(.5*this._fov)*this.height*b}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.multiply(n,n,this.globeMatrix),n}}function en(h,n){let a=!1,f=null;const y=()=>{f=null,a&&(h(),f=setTimeout(y,n),a=!1)};return()=>(a=!0,f||y(),f)}class pc{constructor(n){this._hashName=n&&encodeURIComponent(n),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=en(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,s.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const a=Jo(n);if(this._hashName){const f=this._hashName;let y=!1;const b=s.window.location.hash.slice(1).split("&").map((C=>{const A=C.split("=")[0];return A===f?(y=!0,`${A}=${a}`):C})).filter((C=>C));return y||b.push(`${f}=${a}`),`#${b.join("&")}`}return`#${a}`}_getCurrentHash(){const n=s.window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map((f=>f.split("="))).forEach((f=>{f[0]===this._hashName&&(a=f)})),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some((f=>isNaN(f)))){const f=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:f,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,n)}}function Jo(h,n){const a=h.getCenter(),f=Math.round(100*h.getZoom())/100,y=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),C=Math.round(a.lng*b)/b,A=Math.round(a.lat*b)/b,I=h.getBearing(),N=h.getPitch();let z=n?`/${C}/${A}/${f}`:`${f}/${A}/${C}`;return(I||N)&&(z+="/"+Math.round(10*I)/10),N&&(z+=`/${Math.round(N)}`),z}const So={linearity:.3,easing:s.bezier(0,0,.3,1)},fc=s.extend({deceleration:2500,maxSpeed:1400},So),gl=s.extend({deceleration:20,maxSpeed:1400},So),It=s.extend({deceleration:1e3,maxSpeed:360},So),Ui=s.extend({deceleration:1e3,maxSpeed:90},So);class Aa{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=s.exported.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(a.pan.mag()){const b=mc(a.pan.mag(),f,s.extend({},fc,n||{}));y.offset=a.pan.mult(b.amount/a.pan.mag()),y.center=this._map.transform.center,yl(y,b)}if(a.zoom){const b=mc(a.zoom,f,gl);y.zoom=this._map.transform.zoom+b.amount,yl(y,b)}if(a.bearing){const b=mc(a.bearing,f,It);y.bearing=this._map.transform.bearing+s.clamp(b.amount,-179,179),yl(y,b)}if(a.pitch){const b=mc(a.pitch,f,Ui);y.pitch=this._map.transform.pitch+b.amount,yl(y,b)}if(y.zoom||y.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function yl(h,n){(!h.duration||h.duration<n.duration)&&(h.duration=n.duration,h.easing=n.easing)}function mc(h,n,a){const{maxSpeed:f,linearity:y,deceleration:b}=a,C=s.clamp(h*y/(n/1e3),-f,f),A=Math.abs(C)/(b*y);return{easing:a.easing,duration:1e3*A,amount:C*(A/2)}}class si extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,f,y={}){const b=$e(a.getCanvasContainer(),f),C=a.unproject(b);super(n,s.extend({point:b,lngLat:C,originalEvent:f},y)),this._defaultPrevented=!1,this.target=a}}class _l extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,f){const y=n==="touchend"?f.changedTouches:f.touches,b=Ye(a.getCanvasContainer(),y),C=b.map((I=>a.unproject(I))),A=b.reduce(((I,N,z,$)=>I.add(N.div($.length))),new s.Point(0,0));super(n,{points:b,point:A,lngLats:C,lngLat:a.unproject(A),originalEvent:f}),this._defaultPrevented=!1}}class Ma extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,f){super(n,{originalEvent:f}),this._defaultPrevented=!1}}class xl{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Ma(n.type,this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new si(n.type,this._map,n))}mouseup(n){this._map.fire(new si(n.type,this._map,n))}preclick(n){const a=s.extend({},n);a.type="preclick",this._map.fire(new si(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new si(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new si(n.type,this._map,n))}mouseover(n){this._map.fire(new si(n.type,this._map,n))}mouseout(n){this._map.fire(new si(n.type,this._map,n))}touchstart(n){return this._firePreventable(new _l(n.type,this._map,n))}touchmove(n){this._map.fire(new _l(n.type,this._map,n))}touchend(n){this._map.fire(new _l(n.type,this._map,n))}touchcancel(n){this._map.fire(new _l(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vl{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new si(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new si("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new si(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class iu{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&(He(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const f=a,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(f)||!this._box&&f.dist(y)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=me("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const C=Math.min(y.x,f.x),A=Math.max(y.x,f.x),I=Math.min(y.y,f.y),N=Math.max(y.y,f.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${C}px,${I}px)`,this._box.style.width=A-C+"px",this._box.style.height=N-I+"px")}))}mouseupWindow(n,a){if(!this._active)return;const f=this._startPos,y=a;if(f&&n.button===0){if(this.reset(),kt(),f.x!==y.x||f.y!==y.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(f,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Me(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new s.Event(n,{originalEvent:a}))}}function bl(h,n){const a={};for(let f=0;f<h.length;f++)a[h[f].identifier]=n[f];return a}class Qo{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),f.length===this.numTouches&&(this.centroid=(function(y){const b=new s.Point(0,0);for(const C of y)b._add(C);return b.div(y.length)})(a),this.touches=bl(f,a)))}touchmove(n,a,f){if(this.aborted||!this.centroid)return;const y=bl(f,a);for(const b in this.touches){const C=y[b];(!C||C.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,a,f){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class dh{constructor(n){this.singleTap=new Qo(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,f){this.singleTap.touchstart(n,a,f)}touchmove(n,a,f){this.singleTap.touchmove(n,a,f)}touchend(n,a,f){const y=this.singleTap.touchend(n,a,f);if(y){const b=n.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(y)<30;if(b&&C||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class ud{constructor(){this._zoomIn=new dh({numTouches:1,numTaps:2}),this._zoomOut=new dh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,f){this._zoomIn.touchstart(n,a,f),this._zoomOut.touchstart(n,a,f)}touchmove(n,a,f){this._zoomIn.touchmove(n,a,f),this._zoomOut.touchmove(n,a,f)}touchend(n,a,f){const y=this._zoomIn.touchend(n,a,f),b=this._zoomOut.touchend(n,a,f);return y?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(y)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const hd={0:1,2:2};class wl{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;const f=tt(n);this._correctButton(n,f)&&(this._lastPoint=a,this._eventButton=f)}mousemoveWindow(n,a){const f=this._lastPoint;if(f){if(n.preventDefault(),this._eventButton!=null&&(function(y,b){const C=hd[b];return y.buttons===void 0||(y.buttons&C)!==C})(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(f,a)}}mouseupWindow(n){this._lastPoint&&tt(n)===this._eventButton&&(this._moved&&kt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gc extends wl{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return a===0&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class to extends wl{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){const f=.8*(a.x-n.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(n){n.preventDefault()}}class su extends wl{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){const f=-.5*(a.y-n.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(n){n.preventDefault()}}class Eo{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)}touchstart(n,a,f){return this._calculateTransform(n,a,f)}touchmove(n,a,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,f)}}touchend(n,a,f){this._calculateTransform(n,a,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,f){f.length>0&&(this._active=!0);const y=bl(f,a),b=new s.Point(0,0),C=new s.Point(0,0);let A=0;for(const N in y){const z=y[N],$=this._touches[N];$&&(b._add(z),C._add(z.sub($)),A++,y[N]=z)}if(this._touches=y,A<this._minTouches||!C.mag())return;const I=C.div(A);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(A),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")}),500)}}class Vi{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,f){return{}}touchstart(n,a,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,f){const y=this._firstTwoTouches;if(!y)return;n.preventDefault();const[b,C]=y,A=ko(f,a,b),I=ko(f,a,C);if(!A||!I)return;const N=this._aroundCenter?null:A.add(I).div(2);return this._move([A,I],N,n)}touchend(n,a,f){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,C=ko(f,a,y),A=ko(f,a,b);C&&A||(this._active&&kt(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ko(h,n,a){for(let f=0;f<h.length;f++)if(h[f].identifier===a)return n[f]}function zs(h,n){return Math.log(h/n)/Math.LN2}class ou extends Vi{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const f=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(zs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zs(this._distance,f),pinchAround:a}}}function ph(h,n){return 180*h.angleWith(n)/Math.PI}class dd extends Vi{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){const f=this._vector;if(this._vector=n[0].sub(n[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ph(this._vector,f),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const y=ph(n,f);return Math.abs(y)<a}}function $i(h){return Math.abs(h.y)>Math.abs(h.x)}class Tl extends Vi{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,$i(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,f){const y=this._lastPoints;if(!y)return;const b=n[0].sub(y[0]),C=n[1].sub(y[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(b,C,f.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+C.y)/2*-.5})}gestureBeginsVertically(n,a,f){if(this._valid!==void 0)return this._valid;const y=n.mag()>=2,b=a.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const C=n.y>0==a.y>0;return $i(n)&&$i(a)&&C}}const Pa={panStep:100,bearingStep:15,pitchStep:10};class au{constructor(){const n=Pa;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,f=0,y=0,b=0,C=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?f=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?f=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),C=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(f=0,y=0),{cameraAnimation:A=>{const I=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:lu,zoom:a?Math.round(I)+a*(n.shiftKey?2:1):I,bearing:A.getBearing()+f*this._bearingStep,pitch:A.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-C*this._panStep],center:A.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function lu(h){return h*(2-h)}const ea=4.000244140625;class Co{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const f=s.exported.now(),y=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,a!==0&&a%ea==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=$e(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>ea?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&N!==0&&(N=1/N);const z=a(),$=Math.pow(2,z),K=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):$;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(K*N))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:a(),y=this._startZoom,b=this._easing;let C,A=!1;if(this._type==="wheel"&&y&&b){const I=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),N=b(I);C=s.number(y,f,N),I<1?this._frameId||(this._frameId=!0):A=!0}else C=f,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:C-a(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=s.ease;if(this._prevEase){const f=this._prevEase,y=(s.exported.now()-f.start)/f.duration,b=f.easing(y+.01)-f.easing(y),C=.27/Math.sqrt(b*b+1e-4)*.01,A=Math.sqrt(.0729-C*C);a=s.bezier(C,A,.25,1)}return this._prevEase={start:s.exported.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")}),200)}}class mn{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Lr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(n.shiftKey?-1:1),around:f.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ta{constructor(){this._tap=new dh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,f){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=a[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(n,a,f))}touchmove(n,a,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const y=a[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,a,f)}touchend(n,a,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(n,a,f)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pi{constructor(n,a,f){this._el=n,this._mousePan=a,this._touchPan=f}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gi{constructor(n,a,f){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ia{constructor(n,a,f,y){this._el=n,this._touchZoom=a,this._touchRotate=f,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const fi=h=>h.zoom||h.drag||h.pitch||h.rotate;class Pi extends s.Event{}class cu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){const f=s.sub([],a,n);this.radius=s.length(f[2]<0?s.div([],f,this.constants):[f[0],f[1],0])}projectRay(n){s.div(n,n,this.constants),s.normalize(n,n),s.mul$1(n,n,this.constants);const a=s.scale$2([],n,this.radius);if(a[2]>0){const f=s.scale$2([],[0,0,1],s.dot(a,[0,0,1])),y=s.scale$2([],s.normalize([],[a[0],a[1],0]),this.radius),b=s.add([],a,s.scale$2([],s.sub([],s.add([],y,f),a),2));a[0]=b[0],a[1]=b[1]}return a}}function bs(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Ns{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Aa(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new cu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),s.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[y,b,C]of this._listeners)y.addEventListener(b,y===s.window.document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[n,a,f]of this._listeners)n.removeEventListener(a,n===s.window.document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(n){const a=this._map,f=a.getCanvasContainer();this._add("mapEvent",new xl(a,n));const y=a.boxZoom=new iu(a,n);this._add("boxZoom",y);const b=new ud,C=new Lr;a.doubleClickZoom=new mn(C,b),this._add("tapZoom",b),this._add("clickZoom",C);const A=new ta;this._add("tapDragZoom",A);const I=a.touchPitch=new Tl(a);this._add("touchPitch",I);const N=new to(n),z=new su(n);a.dragRotate=new Gi(n,N,z),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const $=new gc(n),K=new Eo(a,n);a.dragPan=new pi(f,$,K),this._add("mousePan",$),this._add("touchPan",K,["touchZoom","touchRotate"]);const re=new dd,ie=new ou;a.touchZoomRotate=new Ia(f,ie,re,A),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new vl(a));const ne=a.scrollZoom=new Co(a,this);this._add("scrollZoom",ne,["mousePan"]);const se=a.keyboard=new au;this._add("keyboard",se);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[W]&&a[W].enable(n[W])}_add(n,a,f){this._handlers.push({handlerName:n,handler:a,allowed:f}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!fi(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,a,f){for(const y in n)if(y!==f&&(!a||a.indexOf(y)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const a=[];for(const f of n)this._el.contains(f.target)&&a.push(f);return a}handleEvent(n,a){this._updatingCamera=!0;const f=n.type==="renderFrame",y=f?void 0:n,b={needsRenderFrame:!1},C={},A={},I=n.touches?this._getMapTouches(n.touches):void 0,N=I?Ye(this._el,I):f?void 0:$e(this._el,n);for(const{handlerName:K,handler:re,allowed:ie}of this._handlers){if(!re.isEnabled())continue;let ne;this._blockedByActive(A,ie,K)?re.reset():re[a||n.type]&&(ne=re[a||n.type](n,N,I),this.mergeHandlerResult(b,C,ne,K,y),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||re.isActive())&&(A[K]=re)}const z={};for(const K in this._previousActiveHandlers)A[K]||(z[K]=y);this._previousActiveHandlers=A,(Object.keys(z).length||bs(b))&&(this._changes.push([b,C,z]),this._triggerRenderFrame()),(Object.keys(A).length||bs(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=b;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))}mergeHandlerResult(n,a,f,y,b){if(!f)return;s.extend(n,f);const C={handlerName:y,originalEvent:f.originalEvent||b};f.zoomDelta!==void 0&&(a.zoom=C),f.panDelta!==void 0&&(a.drag=C),f.pitchDelta!==void 0&&(a.pitch=C),f.bearingDelta!==void 0&&(a.rotate=C)}_applyChanges(){const n={},a={},f={};for(const[y,b,C]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new s.Point(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(n.around=y.around),y.aroundCoord!==void 0&&(n.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),s.extend(a,b),s.extend(f,C);this._updateMapTransform(n,a,f),this._changes=[]}_updateMapTransform(n,a,f){const y=this._map,b=y.transform,C=te=>[te.x,te.y,te.z];if((te=>{const le=this._eventsInProgress.drag;return le&&!this._handlersById[le.handlerName].isActive()})()&&!bs(n)){const te=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",te!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!bs(n))return void this._fireEvents(a,f,!0);let{panDelta:A,zoomDelta:I,bearingDelta:N,pitchDelta:z,around:$,aroundCoord:K,pinchAround:re}=n;b._isCameraConstrained&&(I>0&&(I=0),b._isCameraConstrained=!1),re!==void 0&&($=re),(I||(te=>a[te]&&!this._eventsInProgress[te])("drag"))&&$&&(this._dragOrigin=C(b.pointCoordinate3D($)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),$=$||y.transform.centerPoint,N&&(b.bearing+=N),z&&(b.pitch+=z),b._updateCameraState();const ie=[0,0,0];if(A)if(b.projection.name==="mercator"){const te=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay($).dir),le=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay($.sub(A)).dir);ie[0]=le[0]-te[0],ie[1]=le[1]-te[1]}else{const te=b.pointCoordinate($);if(b.projection.name==="globe"){A=A.rotate(-b.angle);const le=b._pixelsPerMercatorPixel/b.worldSize;ie[0]=-A.x*s.mercatorScale(s.latFromMercatorY(te.y))*le,ie[1]=-A.y*s.mercatorScale(b.center.lat)*le}else{const le=b.pointCoordinate($.sub(A));te&&le&&(ie[0]=le.x-te.x,ie[1]=le.y-te.y)}}const ne=b.zoom,se=[0,0,0];if(I){const te=C(K||b.pointCoordinate3D($)),le={dir:s.normalize([],s.sub([],te,b._camera.position))};if(le.dir[2]<0){const ce=b.zoomDeltaToMovement(te,I);s.scale$2(se,le.dir,ce)}}const W=s.add(ie,ie,se);b._translateCameraConstrained(W),I&&Math.abs(b.zoom-ne)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,f,!0)}_fireEvents(n,a,f){const y=fi(this._eventsInProgress),b=fi(n),C={};for(const z in n){const{originalEvent:$}=n[z];this._eventsInProgress[z]||(C[`${z}start`]=$),this._eventsInProgress[z]=n[z]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const z in C)this._fireEvent(z,C[z]);b&&this._fireEvent("move",b.originalEvent);for(const z in n){const{originalEvent:$}=n[z];this._fireEvent(z,$)}const A={};let I;for(const z in this._eventsInProgress){const{handlerName:$,originalEvent:K}=this._eventsInProgress[z];this._handlersById[$].isActive()||(delete this._eventsInProgress[z],I=a[$]||K,A[`${z}end`]=I)}for(const z in A)this._fireEvent(z,A[z]);const N=fi(this._eventsInProgress);if(f&&(y||b)&&!N){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=K=>K!==0&&-this._bearingSnap<K&&K<this._bearingSnap;z?($(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:I})):(this._map.fire(new s.Event("moveend",{originalEvent:I})),$(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new s.Event(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((n=>{this._frameId=void 0,this.handleEvent(new Pi("renderFrame",{timeStamp:n})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ro="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class yc extends s.Evented{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,f){return n=s.Point.convert(n).mult(-1),this.panTo(this.transform.center,s.extend({offset:n},a),f)}panTo(n,a,f){return this.easeTo(s.extend({center:n},a),f)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,f){return this.easeTo(s.extend({zoom:n},a),f)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,f){return this.easeTo(s.extend({bearing:n},a),f)}resetNorth(n,a){return this.rotateTo(0,s.extend({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){n=s.LngLatBounds.convert(n);const f=a&&a.bearing||0,y=a&&a.pitch||0,b=n.getNorthWest(),C=n.getSouthEast();return this._cameraForBounds(this.transform,b,C,f,y,a)}_extendCameraOptions(n){const a={top:0,bottom:0,right:0,left:0};if(typeof(n=s.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const f=n.padding;n.padding={top:f,bottom:f,right:f,left:f}}return n.padding=s.extend(a,n.padding),n}_minimumAABBFrustumDistance(n,a){const f=a.max[0]-a.min[0],y=a.max[1]-a.min[1];return f/y>n.aspect?f/(2*Math.tan(.5*n.fovX)*n.aspect):y/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,a,f,y,b,C){const A=n.clone(),I=this._extendCameraOptions(C);A.bearing=y,A.pitch=b;const N=s.LngLat.convert(a),z=s.LngLat.convert(f),$=.5*(N.lat+z.lat),K=.5*(N.lng+z.lng),re=s.latLngToECEF($,K),ie=s.normalize([],re),ne=s.normalize([],s.cross([],ie,[0,1,0])),se=s.cross([],ne,ie),W=[ne[0],ne[1],ne[2],0,se[0],se[1],se[2],0,ie[0],ie[1],ie[2],0,0,0,0,1],te=[re,s.latLngToECEF(N.lat,N.lng),s.latLngToECEF(z.lat,N.lng),s.latLngToECEF(z.lat,z.lng),s.latLngToECEF(N.lat,z.lng),s.latLngToECEF($,N.lng),s.latLngToECEF($,z.lng),s.latLngToECEF(N.lat,K),s.latLngToECEF(z.lat,K)];let le=s.Aabb.fromPoints(te.map((ct=>[s.dot(ne,ct),s.dot(se,ct),s.dot(ie,ct)])));const ce=s.transformMat4([],le.center,W);s.squaredLength(ce)===0&&s.set(ce,0,0,1),s.normalize(ce,ce),s.scale$2(ce,ce,s.GLOBE_RADIUS),A.center=s.ecefToLatLng(ce);const xe=A.getWorldToCameraMatrix(),be=s.invert(new Float64Array(16),xe);le=s.Aabb.applyTransform(le,s.multiply([],xe,W)),s.transformMat4(ce,ce,xe);const ve=.5*(le.max[2]-le.min[2]),Pe=this._minimumAABBFrustumDistance(A,le),Ce=s.scale$2([],[0,0,1],ve),Oe=s.add(Ce,ce,Ce),ft=Pe+(A.pitch===0?0:s.distance(ce,Oe)),je=A.globeCenterInViewSpace,Je=s.sub([],ce,[je[0],je[1],je[2]]);s.normalize(Je,Je),s.scale$2(Je,Je,ft);const Ve=s.add([],ce,Je);s.transformMat4(Ve,Ve,be);const dt=s.earthRadius/s.GLOBE_RADIUS,Be=s.length(Ve),Qe=s.mercatorZfromAltitude(Math.max(Be*dt-s.earthRadius,Number.EPSILON),0),ht=Math.min(A.zoomFromMercatorZAdjusted(Qe),I.maxZoom);return ht>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"mercator"}),A.zoom=ht,this._cameraForBounds(A,a,f,y,b,C)):{center:A.center,zoom:ht,bearing:y,pitch:b}}queryTerrainElevation(n,a){const f=this.transform.elevation;return f?(a=s.extend({},{exaggerated:!0},a),f.getAtPoint(s.MercatorCoordinate.fromLngLat(n),null,a.exaggerated)):null}_cameraForBounds(n,a,f,y,b,C){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,a,f,y,b,C);const A=n.clone(),I=this._extendCameraOptions(C),N=A.padding;A.bearing=y,A.pitch=b;const z=s.LngLat.convert(a),$=s.LngLat.convert(f),K=new s.LngLat(z.lng,$.lat),re=new s.LngLat($.lng,z.lat),ie=A.project(z),ne=A.project($),se=this.queryTerrainElevation(z),W=this.queryTerrainElevation($),te=this.queryTerrainElevation(K),le=this.queryTerrainElevation(re),ce=[[ie.x,ie.y,Math.min(se||0,W||0,te||0,le||0)],[ne.x,ne.y,Math.max(se||0,W||0,te||0,le||0)]];let xe=s.Aabb.fromPoints(ce);const be=A.getWorldToCameraMatrix(),ve=s.invert(new Float64Array(16),be);xe=s.Aabb.applyTransform(xe,be);const Pe=s.sub([],xe.max,xe.min),Ce=N.left||0,Oe=N.right||0,ft=N.bottom||0,je=N.top||0,{left:Je,right:Ve,top:dt,bottom:Be}=I.padding,Qe=.5*(Ce+Oe),ht=.5*(je+ft),ct=Math.min(A.scaleZoom(A.scale*Math.min((A.width-(Ce+Oe+Je+Ve))/Pe[0],(A.height-(ft+je+Be+dt))/Pe[1])),I.maxZoom),gt=A.scale/A.zoomScale(ct);xe=new s.Aabb([xe.min[0]-(Je+Qe)*gt,xe.min[1]-(Be+ht)*gt,xe.min[2]],[xe.max[0]+(Ve+Qe)*gt,xe.max[1]+(dt+ht)*gt,xe.max[2]]);const Ut=.5*Pe[2],er=this._minimumAABBFrustumDistance(A,xe),Nt=[0,0,1,0];s.transformMat4$1(Nt,Nt,be),s.normalize$2(Nt,Nt);const Xt=s.scale$2([],Nt,er+Ut),br=s.add([],xe.center,Xt),Er=(typeof I.offset.x=="number"&&typeof I.offset.y=="number"?new s.Point(I.offset.x,I.offset.y):s.Point.convert(I.offset)).rotate(-s.degToRad(y));xe.center[0]-=Er.x*gt,xe.center[1]+=Er.y*gt,s.transformMat4(xe.center,xe.center,ve),s.transformMat4(br,br,ve);const Vt=[xe.center[0],xe.center[1],br[2]*A.pixelsPerMeter];s.scale$2(Vt,Vt,1/A.worldSize);const Ir=s.lngFromMercatorX(Vt[0]),Gr=s.latFromMercatorY(Vt[1]),Wr=Math.min(A._zoomFromMercatorZ(Vt[2]),I.maxZoom),Or=new s.LngLat(Ir,Gr);return A.mercatorFromTransition&&Wr<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"globe"}),A.zoom=Wr,this._cameraForBounds(A,a,f,y,b,C)):{center:Or,zoom:Wr,bearing:y,pitch:b}}fitBounds(n,a,f){const y=this.cameraForBounds(n,a);return this._fitInternal(y,a,f)}fitScreenCoordinates(n,a,f,y,b){const C=s.Point.convert(n),A=s.Point.convert(a),I=new s.Point(Math.min(C.x,A.x),Math.min(C.y,A.y)),N=new s.Point(Math.max(C.x,A.x),Math.max(C.y,A.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(C,A))return this;const z=this.transform.pointLocation3D(I),$=this.transform.pointLocation3D(N),K=this.transform.pointLocation3D(new s.Point(I.x,N.y)),re=this.transform.pointLocation3D(new s.Point(N.x,I.y)),ie=[Math.min(z.lng,$.lng,K.lng,re.lng),Math.min(z.lat,$.lat,K.lat,re.lat)],ne=[Math.max(z.lng,$.lng,K.lng,re.lng),Math.max(z.lat,$.lat,K.lat,re.lat)],se=y&&y.pitch?y.pitch:this.getPitch(),W=this._cameraForBounds(this.transform,ie,ne,f,se,y);return this._fitInternal(W,y,b)}_fitInternal(n,a,f){return n?(delete(a=s.extend(n,a)).padding,a.linear?this.easeTo(a,f):this.flyTo(a,f)):this}jumpTo(n,a){this.stop();const f=n.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,C=!1;return"zoom"in n&&f.zoom!==+n.zoom&&(y=!0,f.zoom=+n.zoom),n.center!==void 0&&(f.center=s.LngLat.convert(n.center)),"bearing"in n&&f.bearing!==+n.bearing&&(b=!0,f.bearing=+n.bearing),"pitch"in n&&f.pitch!==+n.pitch&&(C=!0,f.pitch=+n.pitch),n.padding==null||f.isPaddingEqual(n.padding)||(f.padding=n.padding),n.preloadOnly?(this._preloadTiles(f),this):(this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),y&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),b&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),C&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(ro),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){const f=this.transform;if(!f.projection.supportsFreeCamera)return s.warnOnce(ro),this;this.stop();const y=f.zoom,b=f.pitch,C=f.bearing;f.setFreeCameraOptions(n);const A=y!==f.zoom,I=b!==f.pitch,N=C!==f.bearing;return this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),A&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),N&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),I&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),((n=s.extend({offset:[0,0],duration:500,easing:s.ease},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const f=this.transform,y=this.getZoom(),b=this.getBearing(),C=this.getPitch(),A=this.getPadding(),I="zoom"in n?+n.zoom:y,N="bearing"in n?this._normalizeBearing(n.bearing,b):b,z="pitch"in n?+n.pitch:C,$="padding"in n?n.padding:f.padding,K=s.Point.convert(n.offset);let re,ie,ne;if(f.projection.name==="globe"){const Ce=s.MercatorCoordinate.fromLngLat(f.center),Oe=K.rotate(-f.angle);Ce.x+=Oe.x/f.worldSize,Ce.y+=Oe.y/f.worldSize;const ft=Ce.toLngLat(),je=s.LngLat.convert(n.center||ft);this._normalizeCenter(je),re=f.centerPoint.add(Oe),ie=new s.Point(Ce.x,Ce.y).mult(f.worldSize),ne=new s.Point(s.mercatorXfromLng(je.lng),s.mercatorYfromLat(je.lat)).mult(f.worldSize).sub(ie)}else{re=f.centerPoint.add(K);const Ce=f.pointLocation(re),Oe=s.LngLat.convert(n.center||Ce);this._normalizeCenter(Oe),ie=f.project(Ce),ne=f.project(Oe).sub(ie)}const se=f.zoomScale(I-y);let W,te;n.around&&(W=s.LngLat.convert(n.around),te=f.locationPoint(W));const le=this._zooming||I!==y,ce=this._rotating||b!==N,xe=this._pitching||z!==C,be=!f.isPaddingEqual($),ve=Ce=>Oe=>{if(le&&(Ce.zoom=s.number(y,I,Oe)),ce&&(Ce.bearing=s.number(b,N,Oe)),xe&&(Ce.pitch=s.number(C,z,Oe)),be&&(Ce.interpolatePadding(A,$,Oe),re=Ce.centerPoint.add(K)),W)Ce.setLocationAtPoint(W,te);else{const ft=Ce.zoomScale(Ce.zoom-y),je=I>y?Math.min(2,se):Math.max(.5,se),Je=Math.pow(je,1-Oe),Ve=Ce.unproject(ie.add(ne.mult(Oe*Je)).mult(ft));Ce.setLocationAtPoint(Ce.renderWorldCopies?Ve.wrap():Ve,re)}return n.preloadOnly||this._fireMoveEvents(a),Ce};if(n.preloadOnly){const Ce=this._emulate(ve,n.duration,f);return this._preloadTiles(Ce),this}const Pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=le,this._rotating=ce,this._pitching=xe,this._padding=be,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,Pe),this._ease(ve(f),(Ce=>{f.recenterOnTerrain(),this._afterEase(a,Ce)}),n),this}_prepareEase(n,a,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",a||f.moving||this.fire(new s.Event("movestart",n)),this._zooming&&!f.zooming&&this.fire(new s.Event("zoomstart",n)),this._rotating&&!f.rotating&&this.fire(new s.Event("rotatestart",n)),this._pitching&&!f.pitching&&this.fire(new s.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.Event("move",n)),this._zooming&&this.fire(new s.Event("zoom",n)),this._rotating&&this.fire(new s.Event("rotate",n)),this._pitching&&this.fire(new s.Event("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new s.Event("zoomend",n)),y&&this.fire(new s.Event("rotateend",n)),b&&this.fire(new s.Event("pitchend",n)),this.fire(new s.Event("moveend",n))}flyTo(n,a){if(this._prefersReducedMotion(n)){const ct=s.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ct,a)}this.stop(),n=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},n);const f=this.transform,y=this.getZoom(),b=this.getBearing(),C=this.getPitch(),A=this.getPadding(),I="zoom"in n?s.clamp(+n.zoom,f.minZoom,f.maxZoom):y,N="bearing"in n?this._normalizeBearing(n.bearing,b):b,z="pitch"in n?+n.pitch:C,$="padding"in n?n.padding:f.padding,K=f.zoomScale(I-y),re=s.Point.convert(n.offset);let ie=f.centerPoint.add(re);const ne=f.pointLocation(ie),se=s.LngLat.convert(n.center||ne);this._normalizeCenter(se);const W=f.project(ne),te=f.project(se).sub(W);let le=n.curve;const ce=Math.max(f.width,f.height),xe=ce/K,be=te.mag();if("minZoom"in n){const ct=s.clamp(Math.min(n.minZoom,y,I),f.minZoom,f.maxZoom),gt=ce/f.zoomScale(ct-y);le=Math.sqrt(gt/be*2)}const ve=le*le;function Pe(ct){const gt=(xe*xe-ce*ce+(ct?-1:1)*ve*ve*be*be)/(2*(ct?xe:ce)*ve*be);return Math.log(Math.sqrt(gt*gt+1)-gt)}function Ce(ct){return(Math.exp(ct)-Math.exp(-ct))/2}function Oe(ct){return(Math.exp(ct)+Math.exp(-ct))/2}const ft=Pe(0);let je=function(ct){return Oe(ft)/Oe(ft+le*ct)},Je=function(ct){return ce*((Oe(ft)*(Ce(gt=ft+le*ct)/Oe(gt))-Ce(ft))/ve)/be;var gt},Ve=(Pe(1)-ft)/le;if(Math.abs(be)<1e-6||!isFinite(Ve)){if(Math.abs(ce-xe)<1e-6)return this.easeTo(n,a);const ct=xe<ce?-1:1;Ve=Math.abs(Math.log(xe/ce))/le,Je=function(){return 0},je=function(gt){return Math.exp(ct*le*gt)}}n.duration="duration"in n?+n.duration:1e3*Ve/("screenSpeed"in n?+n.screenSpeed/le:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const dt=b!==N,Be=z!==C,Qe=!f.isPaddingEqual($),ht=ct=>gt=>{const Ut=gt*Ve,er=1/je(Ut);ct.zoom=gt===1?I:y+ct.scaleZoom(er),dt&&(ct.bearing=s.number(b,N,gt)),Be&&(ct.pitch=s.number(C,z,gt)),Qe&&(ct.interpolatePadding(A,$,gt),ie=ct.centerPoint.add(re));const Nt=gt===1?se:ct.unproject(W.add(te.mult(Je(Ut))).mult(er));return ct.setLocationAtPoint(ct.renderWorldCopies?Nt.wrap():Nt,ie),ct._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),ct};if(n.preloadOnly){const ct=this._emulate(ht,n.duration,f);return this._preloadTiles(ct),this}return this._zooming=!0,this._rotating=dt,this._pitching=Be,this._padding=Qe,this._prepareEase(a,!1),this._ease(ht(f),(()=>this._afterEase(a)),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,a)}if(!n){const f=this.handlers;f&&f.stop(!1)}return this}_ease(n,a,f){f.animate===!1||f.duration===0?(n(1),a()):(this._easeStart=s.exported.now(),this._easeOptions=f,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=s.wrap(n,-180,180);const f=Math.abs(n-a);return Math.abs(n-360-a)<f&&(n-=360),Math.abs(n+360-a)<f&&(n+=360),n}_normalizeCenter(n){const a=this.transform;if(!a.renderWorldCopies||a.maxBounds)return;const f=n.lng-a.center.lng;n.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&s.exported.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,a,f){const y=Math.ceil(15*a/1e3),b=[],C=n(f.clone());for(let A=0;A<=y;A++){const I=C(A/y);b.push(I.clone())}return b}}class Lt{constructor(n={}){this.options=n,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const a=this.options&&this.options.compact;return this._map=n,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=me("button","mapboxgl-ctrl-attrib-button",this._container),me("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=me("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,a){const f=this._map._getUIString(`AttributionControl.${a}`);n.setAttribute("aria-label",f),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",f)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(n){const f=a.reduce(((y,b,C)=>(b.value&&(y+=`${b.key}=${b.value}${C<a.length-1?"&":""}`),y)),"?");n.href=`${s.config.FEEDBACK_URL}/${f}#${Jo(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const a=this._map.style._sourceCaches;for(const y in a){const b=a[y];if(b.used){const C=b.getSource();C.attribution&&n.indexOf(C.attribution)<0&&n.push(C.attribution)}}n.sort(((y,b)=>y.length-b.length)),n=n.filter(((y,b)=>{for(let C=b+1;C<n.length;C++)if(n[C].indexOf(y)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const f=n.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,n.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Sl{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=me("div","mapboxgl-ctrl");const a=me("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const a in n){const f=n[a].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class _c{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,f=a?this._queue.concat(a):this._queue;for(const y of f)if(y.id===n)return void(y.cancelled=!0)}run(n=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const f of a)if(!f.cancelled&&(f.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Da(h,n,a){if(h=new s.LngLat(h.lng,h.lat),n){const f=new s.LngLat(h.lng-360,h.lat),y=new s.LngLat(h.lng+360,h.lat),b=360*Math.ceil(Math.abs(h.lng-a.center.lng)/360),C=a.locationPoint(h).distSqr(n),A=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint(f).distSqr(n)<C&&(A||Math.abs(f.lng-a.center.lng)<b)?h=f:a.locationPoint(y).distSqr(n)<C&&(A||Math.abs(y.lng-a.center.lng)<b)&&(h=y)}for(;Math.abs(h.lng-a.center.lng)>180;){const f=a.locationPoint(h);if(f.x>=0&&f.y>=0&&f.x<=a.width&&f.y<=a.height)break;h.lng>a.center.lng?h.lng-=360:h.lng+=360}return h}const La={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Pt extends s.Evented{constructor(n,a){if(super(),(n instanceof s.window.HTMLElement||a)&&(n=s.extend({element:n},a)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=s.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=me("div");const y=41,b=27,C=Ae("svg",{display:"block",height:y*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${y}`},this._element),A=Ae("radialGradient",{id:"shadowGradient"},Ae("defs",{},C));Ae("stop",{offset:"10%","stop-opacity":.4},A),Ae("stop",{offset:"100%","stop-opacity":.05},A),Ae("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),Ae("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),Ae("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),Ae("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=s.Point.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(y=>{y.preventDefault()})),this._element.addEventListener("mousedown",(y=>{y.preventDefault()}));const f=this._element.classList;for(const y in La)f.remove(`mapboxgl-marker-anchor-${y}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const a=n.code,f=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(n){const a=n.originalEvent.target,f=this._element;this._popup&&(a===f||f.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,a=this._pos;if(!n||!a)return!1;const f=n.unproject(a),y=n.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(f)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();const f=n.unproject(a);let y;n._showingGlobe()&&s.isLngLatBehindGlobe(n.transform,this._lngLat)?y=0:(y=1-n._queryFogOpacity(f),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${La[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const n=this._pos,a=this._map,f=this.getPitchAlignment();if(!a||!n||f!=="map")return"";if(!a._showingGlobe()){const I=a.getPitch();return I?`rotateX(${I}deg)`:""}const y=s.radToDeg(s.globeTiltAtLngLat(a.transform,this._lngLat)),b=n.sub(s.globeCenterToScreenPoint(a.transform)),C=Math.abs(b.x)+Math.abs(b.y);if(C===0)return"";const A=y/C;return`rotateX(${-b.y*A}deg) rotateY(${b.x*A}deg)`}_calculateZTransform(){const n=this._pos,a=this._map;if(!a||!n)return"";let f=0;const y=this.getRotationAlignment();if(y==="map")if(a._showingGlobe()){const b=a.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),C=a.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);f=s.radToDeg(Math.atan2(C.y,C.x))-90}else f=-a.getBearing();else if(y==="horizon"){const b=s.smoothstep(4,6,a.getZoom()),C=s.globeCenterToScreenPoint(a.transform);C.y+=b*a.transform.height;const A=n.sub(C),I=s.radToDeg(Math.atan2(A.y,A.x));f=(I>90?I-270:I+90)*(1-b)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(n){s.window.cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Da(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),n===!0?this._updateFrameId=s.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),a._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(n){return this._offset=s.Point.convert(n),this._update(),this}_onMove(n){const a=this._map;if(!a)return;const f=this._pointerdownPos,y=this._positionDelta;if(f&&y){if(!this._isDragging){const b=this._clickTolerance||a._clickTolerance;if(n.point.dist(f)<b)return;this._isDragging=!0}this._pos=n.point.sub(y),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(n){const a=this._map,f=this._pos;a&&f&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(f),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ra={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},El=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xc(h=new s.Point(0,0),n="bottom"){if(typeof h=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(n){case"top":return new s.Point(0,h);case"top-left":return new s.Point(a,a);case"top-right":return new s.Point(-a,a);case"bottom":return new s.Point(0,-h);case"bottom-left":return new s.Point(a,-a);case"bottom-right":return new s.Point(-a,-a);case"left":return new s.Point(h,0);case"right":return new s.Point(-h,0)}return new s.Point(0,0)}return h instanceof s.Point||Array.isArray(h)?s.Point.convert(h):s.Point.convert(h[n]||[0,0])}class kl{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const a=s.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,f){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+f}}const ts={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},rs={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},ja={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ao{constructor(n,a,f=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new to({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,f&&(this.mousePitch=new su({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),He()}move(n,a){const f=this.map,y=this.mouseRotate.mousemoveWindow(n,a),b=y&&y.bearingDelta;if(b&&f.setBearing(f.getBearing()+b),this.mousePitch){const C=this.mousePitch.mousemoveWindow(n,a),A=C&&C.pitchDelta;A&&f.setPitch(f.getPitch()+A)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Me(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(s.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),$e(this.element,n)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,$e(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ye(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Ye(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Bs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Mo={maxWidth:100,unit:"metric"},uu={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},na={version:s.version,supported:G,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends yc{constructor(h){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),(h=s.extend({},rs,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(h.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ca(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._useWebGL2=h.useWebGL2,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new _c,this._domRenderTaskQueue=new _c,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},ts,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new kl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,typeof h.container=="string"){if(this._container=s.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Ns(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new pc(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,s.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new Lt({customAttribution:h.customAttribution})),this._logoControl=new Sl,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(n=>{this._update(n.dataType==="style"),this.fire(new s.Event(`${n.dataType}data`,n))})),this.on("dataloading",(n=>{this.fire(new s.Event(`${n.dataType}dataloading`,n))}))}_getMapId(){return this._mapId}addControl(h,n){if(n===void 0&&(n=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=h.onAdd(this);this._controls.push(h);const f=this._controlPositions[n];return n.indexOf("bottom")!==-1?f.insertBefore(a,f.firstChild):f.appendChild(a),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(h);return n>-1&&this._controls.splice(n,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.Event("movestart",h)).fire(new s.Event("move",h)),this.fire(new s.Event("resize",h)),n&&this.fire(new s.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(s.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?s.window.navigator.language:Array.isArray(h)?h.length===0?void 0:h.map((n=>n==="auto"?s.window.navigator.language:n)):h}setLanguage(h){const n=this._parseLanguage(h);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,n=h.projection.name;let a;n==="globe"&&h.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(h.setMercatorFromTransition(),a=!0):n==="mercator"&&h.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(h.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,n){return this._updateProjection(h||n||{name:"mercator"})}_updateProjection(h){let n;if(n=h.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const a in this.style._sourceCaches)this.style._sourceCaches[a].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(h){return this.transform.locationPoint3D(s.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(s.Point.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,n,a){if(h==="mouseenter"||h==="mouseover"){let f=!1;const y=C=>{const A=n.filter((N=>this.getLayer(N))),I=A.length?this.queryRenderedFeatures(C.point,{layers:A}):[];I.length?f||(f=!0,a.call(this,new si(h,this,C.originalEvent,{features:I}))):f=!1},b=()=>{f=!1};return{layers:new Set(n),listener:a,delegates:{mousemove:y,mouseout:b}}}if(h==="mouseleave"||h==="mouseout"){let f=!1;const y=C=>{const A=n.filter((I=>this.getLayer(I)));(A.length?this.queryRenderedFeatures(C.point,{layers:A}):[]).length?f=!0:f&&(f=!1,a.call(this,new si(h,this,C.originalEvent)))},b=C=>{f&&(f=!1,a.call(this,new si(h,this,C.originalEvent)))};return{layers:new Set(n),listener:a,delegates:{mousemove:y,mouseout:b}}}{const f=y=>{const b=n.filter((A=>this.getLayer(A))),C=b.length?this.queryRenderedFeatures(y.point,{layers:b}):[];C.length&&(y.features=C,a.call(this,y),delete y.features)};return{layers:new Set(n),listener:a,delegates:{[h]:f}}}}on(h,n,a){if(a===void 0)return super.on(h,n);Array.isArray(n)||(n=[n]);const f=this._createDelegatedListener(h,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(f);for(const y in f.delegates)this.on(y,f.delegates[y]);return this}once(h,n,a){if(a===void 0)return super.once(h,n);Array.isArray(n)||(n=[n]);const f=this._createDelegatedListener(h,n,a);for(const y in f.delegates)this.once(y,f.delegates[y]);return this}off(h,n,a){if(a===void 0)return super.off(h,n);n=new Set(Array.isArray(n)?n:[n]);const f=(b,C)=>{if(b.size!==C.size)return!1;for(const A of b)if(!C.has(A))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[h]:void 0;return y&&(b=>{for(let C=0;C<b.length;C++){const A=b[C];if(A.listener===a&&f(A.layers,n)){for(const I in A.delegates)this.off(I,A.delegates[I]);return b.splice(C,1),this}}})(y),this}queryRenderedFeatures(h,n){return this.style?(n!==void 0||h===void 0||h instanceof s.Point||Array.isArray(h)||(n=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(h,n){return this.style.querySourceFeatures(h,n)}isPointOnSurface(h){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&s.warnOnce(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.Point.convert(h))}setStyle(h,n){return(n=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(h,n))}_getUIString(h){const n=this._locale[h];if(n==null)throw new Error(`Missing UI string '${h}'`);return n}_updateStyle(h,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new ys(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ys(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,n){if(typeof h=="string"){const a=this._requestManager.normalizeStyleURL(h),f=this._requestManager.transformRequest(a,s.ResourceType.Style);s.getJSON(f,((y,b)=>{y?this.fire(new s.ErrorEvent(y)):b&&this._updateDiff(b,n)}))}else typeof h=="object"&&this._updateDiff(h,n)}_updateDiff(h,n){try{this.style.setState(h)&&this._update(!0)}catch(a){s.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(h,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(h,n){return this._lazyInitEmptyStyle(),this.style.addSource(h,n),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const n in h){const a=h[n]._tiles;for(const f in a){const y=a[f];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}addSourceType(h,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(h,n,a)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,n,{pixelRatio:a=1,sdf:f=!1,stretchX:y,stretchY:b,content:C}={}){if(this._lazyInitEmptyStyle(),n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap){const{width:A,height:I,data:N}=s.exported.getImageData(n);this.style.addImage(h,{data:new s.RGBAImage({width:A,height:I},N),pixelRatio:a,stretchX:y,stretchY:b,content:C,sdf:f,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:I}=n,N=n;this.style.addImage(h,{data:new s.RGBAImage({width:A,height:I},new Uint8Array(N.data)),pixelRatio:a,stretchX:y,stretchY:b,content:C,sdf:f,version:0,userImage:N}),N.onAdd&&N.onAdd(this,h)}}updateImage(h,n){const a=this.style.getImage(h);if(!a)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap?s.exported.getImageData(n):n,{width:y,height:b}=f;y!==void 0&&b!==void 0?y===a.data.width&&b===a.data.height?(a.data.replace(f.data,!(n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap)),this.style.updateImage(h,a)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${y}, ${b})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,n){s.getImage(this._requestManager.transformRequest(h,s.ResourceType.Image),((a,f)=>{n(a,f instanceof s.window.HTMLImageElement?s.exported.getImageData(f):f)}))}listImages(){return this.style.listImages()}addLayer(h,n){return this._lazyInitEmptyStyle(),this.style.addLayer(h,n),this._update(!0)}moveLayer(h,n){return this.style.moveLayer(h,n),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,n,a){return this.style.setLayerZoomRange(h,n,a),this._update(!0)}setFilter(h,n,a={}){return this.style.setFilter(h,n,a),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,n,a,f={}){return this.style.setPaintProperty(h,n,a,f),this._update(!0)}getPaintProperty(h,n){return this.style.getPaintProperty(h,n)}setLayoutProperty(h,n,a,f={}){return this.style.setLayoutProperty(h,n,a,f),this._update(!0)}getLayoutProperty(h,n){return this.style.getLayoutProperty(h,n)}setLight(h,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(h),this.transform):0}setFeatureState(h,n){return this.style.setFeatureState(h,n),this._update()}removeFeatureState(h,n){return this.style.removeFeatureState(h,n),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let a,f,y,b=this._container;for(;b&&(!f||!y);){const C=s.window.getComputedStyle(b).transform;C&&C!=="none"&&(a=C.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(f=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(y=a[3])),b=b.parentElement}this._containerWidth=f?Math.abs(h/f):h,this._containerHeight=y?Math.abs(n/y):n}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=me("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=me("div","mapboxgl-canvas-container",h);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=me("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=me("div","mapboxgl-control-container",h),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((y=>{f[y]=me("div",`mapboxgl-ctrl-${y}`,a)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,n){const a=s.exported.devicePixelRatio||1;this._canvas.width=a*Math.ceil(h),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${n}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const n=this._markers.indexOf(h);n!==-1&&this._markers.splice(n,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const n=this._popups.indexOf(h);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const h=s.extend({},G.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",h),a=n||this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);a?(this._useWebGL2&&!n&&s.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),s.storeAuthState(a,!0),this.painter=new ka(a,this.transform,!!n),this.on("data",(f=>{f.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),s.exported$1.testSupport(a)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let n;const a=this.painter.context.extTimerQuery,f=s.exported.now();if(this.listens("gpu-timing-frame")&&(n=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,I=this.transform.pitch,N=s.exported.now(),z=new s.EvaluationParameters(A,{now:N,fadeDuration:y,pitch:I,transition:this.style.getTransition()});this.style.update(z)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(f),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(f),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const A=s.exported.now()-f;a.endQueryEXT(a.TIME_ELAPSED_EXT,n),setTimeout((()=>{const I=a.getQueryObjectEXT(n,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(n),this.fire(new s.Event("gpu-timing-frame",{cpuTime:A,gpuTime:I})),s.window.performance.mark("frame-gpu",{startTime:f,detail:{gpuTime:I}})}),50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout((()=>{const I=this.painter.queryGpuTimers(A);this.fire(new s.Event("gpu-timing-layer",{layerTimes:I}))}),50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const I=this.painter.queryGpuTimeDeferredRender(A);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:I}))}),50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(C||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(b=this._updateAverageElevation(f,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const n of this._markers)h&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!h||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(h,n=!1){const a=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);if((n||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const f=this.transform.averageElevation;let y=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=h;const C=Math.abs(f-y);if(C>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(y),a(y);this._averageElevation.easeTo(y,h,300)}else if(C>1e-4)return this._averageElevation.jumpTo(y),a(y)}return!!this._averageElevation.isEasing(h)&&a(this._averageElevation.getValue(h))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(h=>{if(h&&(h.message===s.AUTH_ERR_MSG||h.status===401)){const n=this.painter.context.gl;s.storeAuthState(n,!1),this._logoControl instanceof Sl&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const a=this.painter.context.gl,f=a.createFramebuffer();function y(b){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0);const C=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,C),C}return a.bindFramebuffer(a.FRAMEBUFFER,f),this._canvasPixelComparison(y(h),n.canvasCopies.map(y),n.timeStamps)}_canvasPixelComparison(h,n,a){let f=a[1]-a[0];const y=h.length/4;for(let b=0;b<n.length;b++){const C=n[b];let A=0;for(let I=0;I<C.length;I+=4)C[I]===h[I]&&C[I+1]===h[I+1]&&C[I+2]===h[I+2]&&C[I+3]===h[I+3]&&(A+=1);f+=(a[b+2]-a[b+1])*(1-A/y)}return f}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1),s.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=s.exported.frame((n=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)})))}_preloadTiles(h){const n=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(n,((a,f)=>a._preloadTiles(h,f)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){s.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,n){s.setCacheLimits(h,n)}get version(){return s.version}},NavigationControl:class{constructor(h){this.options=s.extend({},ja,h),this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(n=>{this._map&&this._map.zoomIn({},{originalEvent:n})})),me("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(n=>{this._map&&this._map.zoomOut({},{originalEvent:n})})),me("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(n=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))})),this._compassIcon=me("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const n=h.getZoom(),a=n===h.getMaxZoom(),f=n===h.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=n)}))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ao(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,n){const a=me("button",h,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(h,n){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${n}`);h.setAttribute("aria-label",a),h.firstElementChild&&h.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends s.Evented{constructor(h){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},Bs,h),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=en(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const n=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,h(a)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then((a=>n(a.state!=="denied"))).catch((()=>n())):n()}_isOutOfMapMaxBounds(h){const n=this._map.getMaxBounds(),a=h.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",h)),this._finish()}}_updateCamera(h){const n=new s.LngLat(h.coords.longitude,h.coords.latitude),a=h.coords.accuracy,f=this._map.getBearing(),y=s.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),y,{geolocateSource:!0})}_updateMarker(h){if(h){const n=new s.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,n=s.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this._geolocateButton=me("button","mapboxgl-ctrl-geolocate",this._container),me("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=me("div","mapboxgl-user-location"),this._dotElement.appendChild(me("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(me("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Pt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=me("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))}))}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((n=>{n==="granted"&&h()})).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Lt,ScaleControl:class{constructor(h){this.options=s.extend({},Mo,h),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,f=n._containerWidth/2-h/2,y=n.unproject([f,a]),b=n.unproject([f+h,a]),C=y.distanceTo(b);if(this.options.unit==="imperial"){const A=3.2808*C;A>5280?this._setScale(h,A/5280,"mile"):this._setScale(h,A,"foot")}else this.options.unit==="nautical"?this._setScale(h,C/1852,"nautical-mile"):C>=1e3?this._setScale(h,C/1e3,"kilometer"):this._setScale(h,C,"meter")}_setScale(h,n,a){this._map._requestDomTask((()=>{const f=(function(b){const C=Math.pow(10,`${Math.floor(b)}`.length-1);let A=b/C;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:(function(I){const N=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*N)/N})(A),C*A})(n),y=f/n;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(f):`${f}&nbsp;${uu[a]}`,this._container.style.width=h*y+"px"}))}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof s.window.HTMLElement?this._container=h.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=me("button","mapboxgl-ctrl-fullscreen",this._controlContainer);me("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(h){super(),this.options=s.extend(Object.create(ra),h),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=s.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(s.window.document.createTextNode(h))}setHTML(h){const n=s.window.document.createDocumentFragment(),a=s.window.document.createElement("body");let f;for(a.innerHTML=h;f=a.firstChild,f;)n.appendChild(f);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=me("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(h),this.options.closeButton){const a=this._closeButton=me("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let n;return this._classList.delete(h)?n=!1:(this._classList.add(h),n=!0),this._updateClassList(),n}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const n=this._map,a=this._container,f=this._pos;if(!n||!a||!f)return"bottom";const y=a.offsetWidth,b=a.offsetHeight,C=f.x<y/2,A=f.x>n.transform.width-y/2;if(f.y+h<b)return C?"top-left":A?"top-right":"top";if(f.y>n.transform.height-b){if(C)return"bottom-left";if(A)return"bottom-right"}return C?"left":A?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),h.className=n.join(" ")}_update(h){const n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let f=this._container;if(f||(f=this._container=me("div","mapboxgl-popup",n.getContainer()),this._tip=me("div","mapboxgl-popup-tip",f),f.appendChild(a)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Da(this._lngLat,this._pos,n.transform)),!this._trackPointer||h){const y=this._pos=this._trackPointer&&h?h:n.project(this._lngLat),b=xc(this.options.offset),C=this._anchor=this._getAnchor(b.y),A=xc(this.options.offset,C),I=y.add(A).round();n._requestDomTask((()=>{this._container&&C&&(this._container.style.transform=`${La[C]} translate(${I.x}px,${I.y}px)`)}))}if(!this._marker&&n._showingGlobe()){const y=s.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(El);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Pt,Style:ys,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:To,Evented:s.Evented,config:s.config,prewarm:function(){ya().acquire(Ds)},clearPrewarmedResources:function(){const h=Mi;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(Ds),Mi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(h){s.config.ACCESS_TOKEN=h},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(h){s.config.API_URL=h},get workerCount(){return Hn.workerCount},set workerCount(h){Hn.workerCount=h},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){s.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){s.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return na}));var F=P;return F}))})(Bm)),Bm.exports}var BE=NE();const FE=Gy(BE);function zr(u,p,g){return p in u?Object.defineProperty(u,p,{value:g,enumerable:!0,configurable:!0,writable:!0}):u[p]=g,u}const qs=ee.createContext(null);var OE=typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||!(typeof process>"u"||typeof process.versions!="object"||!process.versions.electron)||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0;const qa=!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||OE?FE:null;var kx=["resize","remove","mousedown","mouseup","mouseover","mousemove","click","dblclick","mouseenter","mouseleave","mouseout","contextmenu","touchstart","touchend","touchmove","touchcancel","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoom","zoomend","rotatestart","rotate","rotateend","pitchstart","pitch","pitchend","boxzoomstart","boxzoomend","boxzoomcancel","webglcontextlost","webglcontextrestored","load","error","data","styledata","sourcedata","dataloading","styledataloading","sourcedataloading"],Cx=function(u){return u.charAt(0).toUpperCase()+u.slice(1)};const Jy=(u=[],p=[])=>{if(u.length!==p.length)return!1;for(let g=0;g<u.length;g+=1)if(u[g]!==p[g])return!1;return!0},Ax=(u={},p={})=>[...new Set([...Object.keys(u),...Object.keys(p)])].reduce(((g,w)=>{const E=u[w];return E!==p[w]&&g.push([w,E]),g}),[]),ff=(u,p,g,w)=>{const E={layers:[p]};if(w){const P=[[g[0]-w,g[1]-w],[g[0]+w,g[1]+w]];return u.queryRenderedFeatures(P,E)}return u.queryRenderedFeatures(g,E)},Jg=[["onClick","click"],["onHover","mousemove"],["onEnter","mouseenter"],["onLeave","mouseleave"],["onContextMenu","contextmenu"]];class ju extends ee.PureComponent{constructor(p){super(p),zr(this,"_addLayer",(g=>{const w=this._map,{before:E,radius:P,onClick:j,onHover:F,onEnter:s,onLeave:U,onContextMenu:G,...J}=g;E&&w.getLayer(E)?w.addLayer(J,E):w.addLayer(J),this._addEventListeners(g)})),zr(this,"_addEventListeners",(g=>{Jg.forEach((([w,E])=>{const P=`_${w}`;g[w]&&this._map.on(E,this._id,this[P])}))})),zr(this,"_updateEventListeners",((g,w)=>{Jg.forEach((([E,P])=>{const j=`_${E}`;!w[E]&&g[E]&&this._map.off(P,this._id,this[j]),w[E]&&!g[E]&&this._map.on(P,this._id,this[j])}))})),zr(this,"_removeEventListeners",(g=>{Jg.forEach((([w,E])=>{const P=`_${w}`;g[w]&&this._map.off(E,this._id,this[P])}))})),zr(this,"_onClick",(g=>{const w=[g.point.x,g.point.y],E=ff(this._map,this._id,w,this.props.radius);this.props.onClick({...g,features:E})})),zr(this,"_onHover",(g=>{const w=[g.point.x,g.point.y],E=ff(this._map,this._id,w,this.props.radius);this.props.onHover({...g,features:E})})),zr(this,"_onEnter",(g=>{const w=[g.point.x,g.point.y],E=ff(this._map,this._id,w,this.props.radius);this.props.onEnter({...g,features:E})})),zr(this,"_onLeave",(g=>{const w=[g.point.x,g.point.y],E=ff(this._map,this._id,w,this.props.radius);this.props.onLeave({...g,features:E})})),zr(this,"_onContextMenu",(g=>{const w=[g.point.x,g.point.y],E=ff(this._map,this._id,w,this.props.radius);this.props.onContextMenu({...g,features:E})})),this._id=p.id}componentDidMount(){this._addLayer(this.props)}componentDidUpdate(p){const g=this._map,{id:w,before:E,onClick:P,...j}=this.props;if(w!==p.id||this.props.type!==p.type||p.type!=="background"&&(this.props.source!==p.source||this.props["source-layer"]!==p["source-layer"]))return this._id=w,this._map.removeLayer(p.id),void this._addLayer(this.props);E!==p.before&&E&&g.getLayer(E)&&g.moveLayer(this._id,E),j.paint!==p.paint&&Ax(j.paint,p.paint).forEach((([F,s])=>{g.setPaintProperty(this._id,F,s)})),j.layout!==p.layout&&Ax(j.layout,p.layout).forEach((([F,s])=>{g.setLayoutProperty(this._id,F,s)})),j.filter!==p.filter&&(j.filter?g.setFilter(this._id,j.filter):g.setFilter(this._id,void 0)),this._updateEventListeners(p,this.props)}componentWillUnmount(){this._map&&this._map.getStyle()&&(this._removeEventListeners(this.props),this._map.getLayer(this._id)&&this._map.removeLayer(this._id))}render(){return ee.createElement(qs.Consumer,{},(p=>(p&&(this._map=p),null)))}}zr(ju,"displayName","Layer"),zr(ju,"defaultProps",{radius:0});class v1 extends ee.PureComponent{componentDidMount(){const{layer:p,before:g}=this.props;g&&this._map.getLayer(g)?this._map.addLayer(p,g):this._map.addLayer(p),this._id=p.id}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.getLayer(this._id)&&this._map.removeLayer(this._id)}render(){return ee.createElement(qs.Consumer,{},(p=>(p&&(this._map=p),null)))}}zr(v1,"displayName","CustomLayer");const UE=[ju,v1],b1=u=>UE.includes(u.type),w1=(u,p)=>{ee.Children.forEach(p,(g=>{g&&(b1(g)&&u(g),g.props&&g.props.children&&w1(u,g.props.children))}))},VE=u=>{const p=(w=>{const E=[];return w1((P=>{P.props.before||E.push((j=>j.props.id||j.props.layer.id)(P))}),w),E})(u);p.shift();const g=w=>typeof w=="function"?w:ee.Children.map(w,(E=>{if(!E)return E;if(b1(E)){const P=E.props.before||p.shift();return ee.cloneElement(E,{before:P})}return E.props&&E.props.children?ee.cloneElement(E,{children:g(E.props.children)}):E}));return g(u)};class Gm extends ee.PureComponent{constructor(p){super(p),zr(this,"state",{loaded:!1}),zr(this,"_onViewportChange",(g=>{if(!g.originalEvent)return;const w=this._map,{lng:E,lat:P}=w.getCenter(),j={latitude:P,longitude:E,zoom:w.getZoom(),pitch:w.getPitch(),bearing:w.getBearing()};this.props.onViewportChange(j)})),qa&&(qa.accessToken=p.accessToken),this._container=ee.createRef()}componentDidMount(){if(!qa)return;const p=this._container.current,g=new qa.Map({container:p,style:this.props.mapStyle,interactive:!!this.props.onViewportChange,center:[this.props.longitude,this.props.latitude],zoom:this.props.zoom,pitch:this.props.pitch,bearing:this.props.bearing,minZoom:this.props.minZoom,maxZoom:this.props.maxZoom,hash:this.props.hash,bearingSnap:this.props.bearingSnap,pitchWithRotate:this.props.pitchWithRotate,attributionControl:this.props.attributionControl,logoPosition:this.props.logoPosition,failIfMajorPerformanceCaveat:this.props.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.props.preserveDrawingBuffer,antialias:this.props.antialias,refreshExpiredTiles:this.props.refreshExpiredTiles,maxBounds:this.props.maxBounds,bounds:this.props.bounds,scrollZoom:this.props.scrollZoom,boxZoom:this.props.boxZoom,dragRotate:this.props.dragRotate,dragPan:this.props.dragPan,keyboard:this.props.keyboard,doubleClickZoom:this.props.doubleClickZoom,trackResize:this.props.trackResize,renderWorldCopies:this.props.renderWorldCopies,maxTileCacheSize:this.props.maxTileCacheSize,localIdeographFontFamily:this.props.localIdeographFontFamily,transformRequest:this.props.transformRequest,collectResourceTiming:this.props.collectResourceTiming,fadeDuration:this.props.fadeDuration,crossSourceCollisions:this.props.crossSourceCollisions,locale:this.props.locale});this._map=g,g.once("load",(()=>{this.setState({loaded:!0},this.props.onLoad)})),this.props.onViewportChange&&(g.on("dragend",this._onViewportChange),g.on("zoomend",this._onViewportChange),g.on("rotateend",this._onViewportChange),g.on("pitchend",this._onViewportChange),g.on("boxzoomend",this._onViewportChange)),kx.forEach((w=>{const E=`on${Cx(w)}`,P=this.props[E];P&&(Array.isArray(P)?g.on(w,...P):g.on(w,P))})),this.props.cursorStyle&&(g.getCanvas().style.cursor=this.props.cursorStyle),this.props.showTileBoundaries&&(this._map.showTileBoundaries=this.props.showTileBoundaries)}componentDidUpdate(p){this._updateMapViewport(p,this.props),this._updateMapStyle(p,this.props),this._updateMapSize(p,this.props),this._updateMapEventListeners(p,this.props),!p.cursorStyle!==this.props.cursorStyle&&(this._map.getCanvas().style.cursor=this.props.cursorStyle),p.showTileBoundaries!==this.props.showTileBoundaries&&(this._map.showTileBoundaries=!!this.props.showTileBoundaries)}componentWillUnmount(){this._map&&this._map.remove()}getMap(){return this._map}_updateMapEventListeners(p,g){kx.forEach((w=>{const E=`on${Cx(w)}`,P=p[E],j=g[E];Array.isArray(P)&&Array.isArray(j)&&Jy(P,j)||P===j||(P&&(Array.isArray(P)?this._map.off(w,...P):this._map.off(w,P)),j&&(Array.isArray(j)?this._map.on(w,...j):this._map.on(w,j)))}))}_updateMapStyle(p,g){const w=g.mapStyle,E=p.mapStyle;w!==E&&this.setState({loaded:!1},(()=>{this._map.setStyle(w),this._map.once("style.load",(()=>this.setState({loaded:!0})))}))}_updateMapViewport(p,g){const w=this._map,E=w.getCenter();if(!(g.latitude!==p.latitude&&g.latitude!==E.lat||g.longitude!==p.longitude&&g.longitude!==E.lng||g.zoom!==p.zoom&&g.zoom!==w.getZoom()||g.pitch!==p.pitch&&g.pitch!==w.getPitch()||g.bearing!==p.bearing&&g.bearing!==w.getBearing()))return;const P={center:[g.longitude,g.latitude],zoom:g.zoom,pitch:g.pitch,bearing:g.bearing},{viewportChangeMethod:j,viewportChangeOptions:F}=this.props,s={...F,...P};switch(j){case"flyTo":w.flyTo(s);break;case"jumpTo":w.jumpTo(s);break;case"easeTo":w.easeTo(s);break;default:throw new Error("Unknown viewport change method")}}_updateMapSize(p,g){((p.style&&p.style.height)!==(g.style&&g.style.height)||(p.style&&p.style.width)!==(g.style&&g.style.width))&&this._map.resize()}render(){const{loaded:p}=this.state,{className:g,style:w}=this.props,E=this.props.children?VE(this.props.children):null;return ee.createElement(qs.Provider,{value:this._map},ee.createElement("div",{ref:this._container,style:w,className:g},p&&E))}}zr(Gm,"displayName","MapGL"),zr(Gm,"defaultProps",{children:null,className:null,style:null,mapStyle:"mapbox://styles/mapbox/light-v8",accessToken:null,bearing:0,pitch:0,minZoom:0,maxZoom:22,maxBounds:null,bounds:null,hash:!1,bearingSnap:7,pitchWithRotate:!0,attributionControl:!0,logoPosition:"bottom-left",failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,antialias:!1,refreshExpiredTiles:!0,boxZoom:!0,scrollZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,trackResize:!0,renderWorldCopies:!0,maxTileCacheSize:null,onViewportChange:null,onLoad:null,localIdeographFontFamily:null,transformRequest:null,collectResourceTiming:!1,fadeDuration:300,crossSourceCollisions:!0,locale:null,cursorStyle:null,viewportChangeMethod:"jumpTo",viewportChangeOptions:null});var Qg=u=>{switch(u.type){case"vector":return{type:"vector",...u};case"raster":return{type:"raster",...u};case"raster-dem":return{type:"raster-dem",...u};case"geojson":return{type:"geojson",...u};case"video":return{type:"video",...u};case"image":return{type:"image",...u};default:throw new Error(`Unknown type for '${u.id}' Source`)}};class rp extends ee.PureComponent{constructor(...p){super(...p),zr(this,"state",{loaded:!1}),zr(this,"_onSourceData",(()=>{this._map.isSourceLoaded(this.props.id)&&(this._map.off("sourcedata",this._onSourceData),this.setState({loaded:!0}))})),zr(this,"_updateGeoJSONSource",((g,w,E)=>{if(E.data!==w.data){const P=this._map.getSource(g);P!==void 0&&P.setData(E.data)}})),zr(this,"_updateImageSource",((g,w,E)=>{if(E.url!==w.url||E.coordinates!==w.coordinates){const P=this._map.getSource(g);P!==void 0&&P.updateImage(E)}})),zr(this,"_updateTileSource",((g,w,E)=>{if(E.url===w.url&&Jy(E.tiles,w.tiles))return;const P=this._map.getSource(g);P._tileJSONRequest&&P._tileJSONRequest.cancel(),P.url=E.url,P.scheme=E.scheme,P._options={...P._options,...E};const j=this._map.style.sourceCaches[g];j&&j.clearTiles(),P.load()})),zr(this,"_removeSource",(()=>{const{id:g}=this.props;if(this._map.getSource(g)){const{layers:w}=this._map.getStyle();w&&w.forEach((E=>{E.source===g&&this._map.removeLayer(E.id)})),this._map.removeSource(g)}}))}componentDidMount(){const{id:p,children:g,...w}=this.props,E=Qg(w);this._map.addSource(p,E),this._map.on("sourcedata",this._onSourceData)}componentDidUpdate(p){const{id:g,children:w,...E}=p,P=Qg(E),{id:j,children:F,...s}=this.props,U=Qg(s);if(j!==g||U.type!==P.type)return this._map.removeSource(g),void this._map.addSource(j,U);U.type!=="geojson"||P.type!=="geojson"?U.type!=="image"||P.type!=="image"?U.type!=="vector"||P.type!=="vector"?U.type==="raster"&&P.type==="raster"&&this._updateTileSource(j,P,U):this._updateTileSource(j,P,U):this._updateImageSource(j,P,U):this._updateGeoJSONSource(j,P,U)}componentWillUnmount(){this._map&&this._map.getStyle()&&this._removeSource()}render(){const{loaded:p}=this.state,{children:g}=this.props;return ee.createElement(qs.Consumer,{},(w=>(w&&(this._map=w),p&&g)))}}zr(rp,"displayName","Source");class Mx extends ee.PureComponent{constructor(p){super(p),this._el=document.createElement("div")}componentDidMount(){const{longitude:p,latitude:g,offset:w,closeButton:E,closeOnClick:P,onClose:j,anchor:F,className:s,maxWidth:U}=this.props;this._popup=new qa.Popup({offset:w,closeButton:E,closeOnClick:P,anchor:F,className:s,maxWidth:U}),this._popup.setDOMContent(this._el),this._popup.setLngLat([p,g]).addTo(this._map),j&&this._popup.on("close",j)}componentDidUpdate(p){(p.latitude!==this.props.latitude||p.longitude!==this.props.longitude)&&this._popup.setLngLat([this.props.longitude,this.props.latitude])}componentWillUnmount(){this._map&&this._map.getStyle()&&this._popup.remove()}getPopup(){return this._popup}render(){return ee.createElement(qs.Consumer,{},(p=>(p&&(this._map=p),l1.createPortal(this.props.children,this._el))))}}zr(Mx,"displayName","Popup"),zr(Mx,"defaultProps",{closeButton:!0,closeOnClick:!0,onClose:void 0,anchor:void 0,offset:void 0,className:void 0,maxWidth:"240px"});class qh extends ee.PureComponent{constructor(p){super(p),zr(this,"_onDragEnd",(()=>{this.props.onDragEnd(this._marker.getLngLat())})),zr(this,"_onDragStart",(()=>{this.props.onDragStart(this._marker.getLngLat())})),zr(this,"_onDrag",(()=>{this.props.onDrag(this._marker.getLngLat())})),this._el=document.createElement("div")}componentDidMount(){const{longitude:p,latitude:g,onClick:w,onDragEnd:E,onDragStart:P,onDrag:j}=this.props;this._marker=new qa.Marker({element:this._el,anchor:this.props.anchor,draggable:this.props.draggable,offset:this.props.offset,rotation:this.props.rotation,pitchAlignment:this.props.pitchAlignment,rotationAlignment:this.props.rotationAlignment}),this._marker.setLngLat([p,g]).addTo(this._map),w&&this._el.addEventListener("click",w),E&&this._marker.on("dragend",this._onDragEnd),P&&this._marker.on("dragstart",this._onDragStart),j&&this._marker.on("drag",this._onDrag)}componentDidUpdate(p){(p.latitude!==this.props.latitude||p.longitude!==this.props.longitude)&&this._marker.setLngLat([this.props.longitude,this.props.latitude])}componentWillUnmount(){this._map&&this._map.getStyle()&&(this.props.onClick&&this._el.removeEventListener("click",this.props.onClick),this._marker.remove())}getMarker(){return this._marker}render(){return ee.createElement(qs.Consumer,{},(p=>(p&&(this._map=p),l1.createPortal(this.props.children,this._el))))}}zr(qh,"displayName","Marker"),zr(qh,"defaultProps",{anchor:"center",offset:null,draggable:!1,rotation:0,pitchAlignment:"auto",rotationAlignment:"auto"});class $E extends ee.PureComponent{constructor(p){super(p),zr(this,"_loadImage",((g,w)=>{typeof g!="string"?w(g):this._map.loadImage(g,((E,P)=>{if(E)throw E;w(P)}))})),this._id=p.id}componentDidMount(){const{image:p,pixelRatio:g,sdf:w}=this.props;this._loadImage(p,(E=>this._map.addImage(this._id,E,{pixelRatio:g,sdf:w})))}componentDidUpdate(p){const{id:g,image:w,pixelRatio:E,sdf:P}=this.props;if(g!==p.id||P!==p.sdf||E!==p.pixelRatio)return this._id=g,this._map.removeImage(p.id),void this._loadImage(w,(j=>this._map.addImage(this._id,j,{pixelRatio:E,sdf:P})));w!==p.image&&this._loadImage(w,(j=>this._map.updateImage(this._id,j)))}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.hasImage(this._id)&&this._map.removeImage(this._id)}render(){return ee.createElement(qs.Consumer,{},(p=>(p&&(this._map=p),null)))}}zr($E,"defaultProps",{pixelRatio:1,sdf:!1});class GE extends ee.PureComponent{componentDidMount(){const p=this._map,{compact:g,customAttribution:w,position:E}=this.props,P=new qa.AttributionControl({compact:g,customAttribution:w});p.addControl(P,E),this._control=P}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.removeControl(this._control)}getControl(){return this._control}render(){return ee.createElement(qs.Consumer,{},(p=>(p&&(this._map=p),null)))}}zr(GE,"defaultProps",{position:"bottom-right"});class WE extends ee.PureComponent{componentDidMount(){const p=this._map,{container:g,position:w}=this.props,E=new qa.FullscreenControl({container:g});p.addControl(E,w),this._control=E}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.removeControl(this._control)}getControl(){return this._control}render(){return ee.createElement(qs.Consumer,{},(p=>(p&&(this._map=p),null)))}}zr(WE,"defaultProps",{position:"top-right"});class qE extends ee.PureComponent{componentDidMount(){const p=this._map,{positionOptions:g,fitBoundsOptions:w,trackUserLocation:E,showUserLocation:P,position:j,onTrackUserLocationEnd:F,onTrackUserLocationStart:s,onError:U,onGeolocate:G}=this.props,J=new qa.GeolocateControl({positionOptions:g,fitBoundsOptions:w,trackUserLocation:E,showUserLocation:P});F&&J.on("trackuserlocationend",F),s&&J.on("trackuserlocationstart",s),U&&J.on("error",U),G&&J.on("geolocate",G),p.addControl(J,j),this._control=J}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.removeControl(this._control)}getControl(){return this._control}render(){return ee.createElement(qs.Consumer,{},(p=>(p&&(this._map=p),null)))}}zr(qE,"defaultProps",{positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0});class ZE extends ee.PureComponent{componentDidMount(){const p=this._map,{showCompass:g,showZoom:w,visualizePitch:E,position:P}=this.props,j=new qa.NavigationControl({showCompass:g,showZoom:w,visualizePitch:E});p.addControl(j,P),this._control=j}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.removeControl(this._control)}getControl(){return this._control}render(){return ee.createElement(qs.Consumer,{},(p=>(p&&(this._map=p),null)))}}zr(ZE,"defaultProps",{showCompass:!0,showZoom:!0,visualizePitch:!1,position:"top-right"});class HE extends ee.PureComponent{componentDidMount(){const p=this._map,{maxWidth:g,unit:w,position:E}=this.props,P=new qa.ScaleControl({maxWidth:g,unit:w});p.addControl(P,E),this._control=P}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.removeControl(this._control)}getControl(){return this._control}render(){return ee.createElement(qs.Consumer,{},(p=>(p&&(this._map=p),null)))}}zr(HE,"defaultProps",{position:"bottom-right",unit:"metric"});var T1={exports:{}};(function(u){function p(w){if(w=Object.assign({},w),!(this instanceof p))throw new Error("MapboxLanguage needs to be called with the new keyword");this.setLanguage=this.setLanguage.bind(this),this._initialStyleUpdate=this._initialStyleUpdate.bind(this),this._defaultLanguage=w.defaultLanguage,this._isLanguageField=w.languageField||/^\{name/,this._getLanguageField=w.getLanguageField||function(E){return E==="mul"?"{name}":"{name_"+E+"}"},this._languageSource=w.languageSource||null,this._languageTransform=w.languageTransform||function(E,P){return P==="ar"?(function(j){var F=j.layers.map((function(s){if(!(s.layout||{})["text-field"])return s;var U=0;return Object.assign({},s,{layout:Object.assign({},s.layout,{"text-letter-spacing":U})})}));return Object.assign({},j,{layers:F})})(E):(function(j){var F=j.layers.map((function(s){if(!(s.layout||{})["text-field"])return s;var U=0;return s["source-layer"]==="state_label"&&(U=.15),s["source-layer"]==="marine_label"&&(/-lg/.test(s.id)&&(U=.25),/-md/.test(s.id)&&(U=.15),/-sm/.test(s.id)&&(U=.1)),s["source-layer"]==="place_label"&&(/-suburb/.test(s.id)&&(U=.15),/-neighbour/.test(s.id)&&(U=.1),/-islet/.test(s.id)&&(U=.01)),s["source-layer"]==="airport_label"&&(U=.01),s["source-layer"]==="rail_station_label"&&(U=.01),s["source-layer"]==="poi_label"&&/-scalerank/.test(s.id)&&(U=.01),s["source-layer"]==="road_label"&&(/-label-/.test(s.id)&&(U=.01),/-shields/.test(s.id)&&(U=.05)),Object.assign({},s,{layout:Object.assign({},s.layout,{"text-letter-spacing":U})})}));return Object.assign({},j,{layers:F})})(E)},this._excludedLayerIds=w.excludedLayerIds||[],this.supportedLanguages=w.supportedLanguages||["ar","en","es","fr","de","ja","ko","mul","pt","ru","zh"]}function g(w,E,P){if((function(F,s){return typeof s=="string"&&F.test(s)})(w,E))return P;if((function(F,s){return s.stops&&s.stops.filter((function(U){return F.test(U[1])})).length>0})(w,E)){var j=E.stops.map((function(F){return w.test(F[1])?[F[0],P]:F}));return Object.assign({},E,{stops:j})}return E}p.prototype.setLanguage=function(w,E){if(this.supportedLanguages.indexOf(E)<0)throw new Error("Language "+E+" is not supported");var P=this._languageSource||(function(J){return Object.keys(J.sources).filter((function(Y){var me=J.sources[Y];return/mapbox-streets-v\d/.test(me.url)}))[0]})(w);if(!P)return w;var j=this._getLanguageField(E),F=this._isLanguageField,s=this._excludedLayerIds,U=w.layers.map((function(J){return J.source===P?(function(Y,me,Ae,Ee){return me.layout&&me.layout["text-field"]&&Ee.indexOf(me.id)===-1?Object.assign({},me,{layout:Object.assign({},me.layout,{"text-field":g(Y,me.layout["text-field"],Ae)})}):me})(F,J,j,s):J})),G=Object.assign({},w,{layers:U});return this._languageTransform(G,E)},p.prototype._initialStyleUpdate=function(){var w=this._map.getStyle(),E=this._defaultLanguage||(function(P){var j=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,F=j.split("-"),s=j;return F.length>1&&(s=F[0]),P.indexOf(s)>-1?s:null})(this.supportedLanguages);this._map.off("styledata",this._initialStyleUpdate),this._map.setStyle(this.setLanguage(w,E))},p.prototype.onAdd=function(w){return this._map=w,this._map.on("styledata",this._initialStyleUpdate),this._container=document.createElement("div"),this._container},p.prototype.onRemove=function(){this._map.off("styledata",this._initialStyleUpdate),this._map=void 0},u.exports=p})(T1);var XE=T1.exports;class KE extends ee.PureComponent{constructor(...p){super(...p),zr(this,"_setLanguage",(()=>{const{language:g}=this.props,w=this._map,E=this._control;g&&w.setStyle(E.setLanguage(w.getStyle(),g))}))}componentDidMount(){const p=this._map,{supportedLanguages:g,languageTransform:w,languageField:E,getLanguageField:P,languageSource:j,defaultLanguage:F}=this.props,s=new XE({supportedLanguages:g,languageTransform:w,languageField:E,getLanguageField:P,languageSource:j,defaultLanguage:F});p.addControl(s),this._control=s}componentDidUpdate(p){p.language!==this.props.language&&this._setLanguage()}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.removeControl(this._control)}getControl(){return this._control}render(){return ee.createElement(qs.Consumer,{},(p=>(p&&(this._map=p),null)))}}zr(KE,"defaultProps",{});var S1={exports:{}};(function(u){var p=[{id:"traffic-street-link-bg",type:"line",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},source:"mapbox://mapbox.mapbox-traffic-v1","source-layer":"traffic",minzoom:15,filter:["all",["==","$type","LineString"],["all",["has","congestion"],["in","class","link","motorway_link","service","street"]]],layout:{visibility:"visible","line-join":"round","line-cap":"round"},paint:{"line-width":{base:1.5,stops:[[14,2.5],[20,15.5]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(145, 95%, 30%)"],["moderate","hsl(30, 100%, 42%)"],["heavy","hsl(355, 100%, 37%)"],["severe","hsl(355, 70%, 22%)"]]},"line-offset":{base:1.5,stops:[[14,2],[20,18]]},"line-opacity":{base:1,stops:[[15,0],[16,1]]}}},{id:"traffic-secondary-tertiary-bg",type:"line",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},source:"mapbox://mapbox.mapbox-traffic-v1","source-layer":"traffic",minzoom:6,filter:["all",["==","$type","LineString"],["all",["has","congestion"],["in","class","secondary","tertiary"]]],layout:{visibility:"visible","line-join":"round","line-cap":"round"},paint:{"line-width":{base:1.5,stops:[[9,1.5],[18,11],[20,16.5]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(145, 95%, 30%)"],["moderate","hsl(30, 100%, 42%)"],["heavy","hsl(355, 100%, 37%)"],["severe","hsl(355, 70%, 22%)"]]},"line-offset":{base:1.5,stops:[[10,.5],[15,5],[18,11],[20,14.5]]},"line-opacity":{base:1,stops:[[13,0],[14,1]]}}},{id:"traffic-primary-bg",type:"line",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},source:"mapbox://mapbox.mapbox-traffic-v1","source-layer":"traffic",minzoom:6,filter:["all",["==","$type","LineString"],["all",["==","class","primary"],["has","congestion"]]],layout:{visibility:"visible","line-join":"round","line-cap":"round"},paint:{"line-width":{base:1.5,stops:[[10,.75],[15,6],[20,18]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(145, 95%, 30%)"],["moderate","hsl(30, 100%, 42%)"],["heavy","hsl(355, 100%, 37%)"],["severe","hsl(355, 70%, 22%)"]]},"line-offset":{base:1.2,stops:[[10,0],[12,1.5],[18,13],[20,16]]},"line-opacity":{base:1,stops:[[11,0],[12,1]]}}},{id:"traffic-trunk-bg",type:"line",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},source:"mapbox://mapbox.mapbox-traffic-v1","source-layer":"traffic",minzoom:6,filter:["all",["==","$type","LineString"],["all",["==","class","trunk"],["has","congestion"]]],layout:{visibility:"visible","line-join":"round","line-cap":"round"},paint:{"line-width":{base:1.5,stops:[[8,.5],[9,2.25],[18,13],[20,17.5]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(145, 95%, 30%)"],["moderate","hsl(30, 100%, 42%)"],["heavy","hsl(355, 100%, 37%)"],["severe","hsl(355, 70%, 22%)"]]},"line-offset":{base:1.5,stops:[[7,0],[9,1],[18,13],[20,18]]},"line-opacity":1}},{id:"traffic-motorway-bg",type:"line",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},source:"mapbox://mapbox.mapbox-traffic-v1","source-layer":"traffic",minzoom:6,filter:["all",["==","$type","LineString"],["all",["==","class","motorway"],["has","congestion"]]],layout:{visibility:"visible","line-join":"round","line-cap":"round"},paint:{"line-width":{base:1.5,stops:[[6,.5],[9,3],[18,16],[20,20]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(145, 95%, 30%)"],["moderate","hsl(30, 100%, 42%)"],["heavy","hsl(355, 100%, 37%)"],["severe","hsl(355, 70%, 22%)"]]},"line-opacity":1,"line-offset":{base:1.5,stops:[[7,0],[9,1.2],[11,1.2],[18,10],[20,15.5]]}}},{id:"traffic-primary",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},ref:"traffic-primary-bg",paint:{"line-width":{base:1.5,stops:[[10,1],[15,4],[20,16]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(142, 55%, 50%)"],["moderate","hsl(30, 100%, 55%)"],["heavy","hsl(355, 100%, 50%)"],["severe","hsl(355, 70%, 35%)"]]},"line-offset":{base:1.2,stops:[[10,0],[12,1.5],[18,13],[20,16]]},"line-opacity":1}},{id:"traffic-secondary-tertiary",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},ref:"traffic-secondary-tertiary-bg",paint:{"line-width":{base:1.5,stops:[[9,.5],[18,9],[20,14]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(142, 55%, 50%)"],["moderate","hsl(30, 100%, 55%)"],["heavy","hsl(355, 100%, 50%)"],["severe","hsl(355, 70%, 35%)"]]},"line-offset":{base:1.5,stops:[[10,.5],[15,5],[18,11],[20,14.5]]},"line-opacity":1}},{id:"traffic-street-link",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},ref:"traffic-street-link-bg",paint:{"line-width":{base:1.5,stops:[[14,1.5],[20,13.5]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(142, 55%, 50%)"],["moderate","hsl(30, 100%, 55%)"],["heavy","hsl(355, 100%, 50%)"],["severe","hsl(355, 70%, 35%)"]]},"line-offset":{base:1.5,stops:[[14,2],[20,18]]},"line-opacity":1}},{id:"traffic-trunk",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},ref:"traffic-trunk-bg",paint:{"line-width":{base:1.5,stops:[[8,.75],[18,11],[20,15]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(142, 55%, 50%)"],["moderate","hsl(30, 100%, 55%)"],["heavy","hsl(355, 100%, 50%)"],["severe","hsl(355, 70%, 35%)"]]},"line-offset":{base:1.5,stops:[[7,0],[9,1],[18,13],[20,18]]},"line-opacity":1}},{id:"traffic-motorway",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},ref:"traffic-motorway-bg",paint:{"line-width":{base:1.5,stops:[[6,.5],[9,1.5],[18,14],[20,18]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(142, 55%, 50%)"],["moderate","hsl(30, 100%, 55%)"],["heavy","hsl(355, 100%, 50%)"],["severe","hsl(355, 70%, 35%)"]]},"line-opacity":1,"line-offset":{base:1.5,stops:[[7,0],[9,1.2],[11,1.2],[18,10],[20,15.5]]}}}];function g(E){if(!(this instanceof g))throw new Error("MapboxTraffic needs to be called with the new keyword");this.options=Object.assign({showTraffic:!1,showTrafficButton:!0,trafficSource:/mapbox-traffic-v\d/},E),this.render=this.render.bind(this),this.toggleTraffic=this.toggleTraffic.bind(this),this._hideTraffic=this._hideTraffic.bind(this),this._showTraffic=this._showTraffic.bind(this),this._hasTraffic=this._hasTraffic.bind(this),this._toggle=new w({show:this.options.showTrafficButton,onToggle:this.toggleTraffic.bind(this)})}function w(E){var P;E=Object.assign({show:!0,onToggle:function(){}},E),this._btn=((P=document.createElement("button")).className="mapboxgl-ctrl-icon mapboxgl-ctrl-traffic",P.type="button",P["aria-label"]="Inspect",P),this._btn.onclick=E.onToggle,this.elem=(function(j,F){var s=document.createElement("div");return s.className="mapboxgl-ctrl mapboxgl-ctrl-group",s.appendChild(j),F||(s.style.display="none"),s})(this._btn,E.show)}g.prototype._hasTraffic=function(){var E=this._map.getStyle(),P=this.options.trafficSource;return Object.keys(E.sources).filter((function(j){return P.test(j)})).length>0},g.prototype.toggleTraffic=function(){this.options.showTraffic=!this.options.showTraffic,this.render()},g.prototype.render=function(){if(!this._hasTraffic()){this._map.addSource("mapbox://mapbox.mapbox-traffic-v1",{type:"vector",url:"mapbox://mapbox.mapbox-traffic-v1"});var E=this._map.getStyle().layers.filter((function(F){return F["source-layer"]==="road"})),P=E[E.length-1].id,j=(function(F,s,U){for(var G=0;G<F.layers.length;G++)if(U===F.layers[G].id){var J=F.layers.slice(0,G).concat(s).concat(F.layers.slice(G));return Object.assign({},F,{layers:J})}return F})(this._map.getStyle(),p,P);this._map.setStyle(j)}this.options.showTraffic?(this._showTraffic(),this._toggle.setMapIcon()):(this._hideTraffic(),this._toggle.setTrafficIcon())},g.prototype._hideTraffic=function(){var E=this._map.getStyle(),P=this.options.trafficSource;E.layers.forEach((function(j){P.test(j.source)&&(j.layout=j.layout||{},j.layout.visibility="none")})),this._map.setStyle(E)},g.prototype._showTraffic=function(){var E=this._map.getStyle(),P=this.options.trafficSource;E.layers.forEach((function(j){P.test(j.source)&&(j.layout=j.layout||{},j.layout.visibility="visible")})),this._map.setStyle(E)},g.prototype.onAdd=function(E){return this._map=E,E.on("load",this.render),this._toggle.elem},g.prototype.onRemove=function(){this._map.off("load",this.render);var E=this._toggle.elem;E.parentNode.removeChild(E),this._map=void 0},w.prototype.setTrafficIcon=function(){this._btn.className="mapboxgl-ctrl-icon mapboxgl-ctrl-traffic"},w.prototype.setMapIcon=function(){this._btn.className="mapboxgl-ctrl-icon mapboxgl-ctrl-map"},u.exports=g})(S1);var YE=S1.exports;class JE extends ee.PureComponent{constructor(...p){super(...p),zr(this,"_addControl",(()=>{const{showTraffic:g,showTrafficButton:w,trafficSource:E}=this.props,P=new YE({showTraffic:g,showTrafficButton:w,trafficSource:E});this._map.addControl(P),this._control=P}))}componentDidMount(){this._addControl()}componentDidUpdate(p){p.showTraffic!==this.props.showTraffic&&this._control.toggleTraffic(),(p.showTrafficButton!==this.props.showTrafficButton||p.trafficSource!==this.props.trafficSource)&&(this._map.removeControl(this._control),this._addControl())}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.removeControl(this._control)}getControl(){return this._control}render(){return ee.createElement(qs.Consumer,{},(p=>(p&&(this._map=p),null)))}}zr(JE,"defaultProps",{showTraffic:!1,showTrafficButton:!0,trafficSource:/mapbox-traffic-v\d/});class QE extends ee.PureComponent{componentDidMount(){this._setFilter()}componentDidUpdate(p){const g=p.filter,w=p.validate,{filter:E,validate:P}=this.props;(!Jy(g,E)||w!==P)&&this._setFilter()}componentWillUnmount(){if(!this._map||!this._map.getStyle())return;const{layerId:p}=this.props;this._map.getLayer(p)!==void 0&&this._map.setFilter(p,void 0)}_setFilter(){const{layerId:p,filter:g,validate:w}=this.props;this._map.getLayer(p)!==void 0&&(Array.isArray(g)?this._map.setFilter(p,g,{validate:w}):this._map.setFilter(p,void 0))}render(){return ee.createElement(qs.Consumer,{},(p=>(p&&(this._map=p),null)))}}zr(QE,"defaultProps",{validate:!0});const Qy=ee.createContext({});function e0(u){const p=ee.useRef(null);return p.current===null&&(p.current=u()),p.current}const t0=typeof window<"u",E1=t0?ee.useLayoutEffect:ee.useEffect,Qm=ee.createContext(null);function r0(u,p){u.indexOf(p)===-1&&u.push(p)}function n0(u,p){const g=u.indexOf(p);g>-1&&u.splice(g,1)}const Fc=(u,p,g)=>g>p?p:g<u?u:g;let i0=()=>{};const Oc={},k1=u=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(u);function C1(u){return typeof u=="object"&&u!==null}const A1=u=>/^0[^.\s]+$/u.test(u);function s0(u){let p;return()=>(p===void 0&&(p=u()),p)}const ga=u=>u,ek=(u,p)=>g=>p(u(g)),Nf=(...u)=>u.reduce(ek),kf=(u,p,g)=>{const w=p-u;return w===0?1:(g-u)/w};class o0{constructor(){this.subscriptions=[]}add(p){return r0(this.subscriptions,p),()=>n0(this.subscriptions,p)}notify(p,g,w){const E=this.subscriptions.length;if(E)if(E===1)this.subscriptions[0](p,g,w);else for(let P=0;P<E;P++){const j=this.subscriptions[P];j&&j(p,g,w)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const $l=u=>u*1e3,Gl=u=>u/1e3;function M1(u,p){return p?u*(1e3/p):0}const P1=(u,p,g)=>(((1-3*g+3*p)*u+(3*g-6*p))*u+3*p)*u,tk=1e-7,rk=12;function nk(u,p,g,w,E){let P,j,F=0;do j=p+(g-p)/2,P=P1(j,w,E)-u,P>0?g=j:p=j;while(Math.abs(P)>tk&&++F<rk);return j}function Bf(u,p,g,w){if(u===p&&g===w)return ga;const E=P=>nk(P,0,1,u,g);return P=>P===0||P===1?P:P1(E(P),p,w)}const I1=u=>p=>p<=.5?u(2*p)/2:(2-u(2*(1-p)))/2,D1=u=>p=>1-u(1-p),L1=Bf(.33,1.53,.69,.99),a0=D1(L1),j1=I1(a0),R1=u=>(u*=2)<1?.5*a0(u):.5*(2-Math.pow(2,-10*(u-1))),l0=u=>1-Math.sin(Math.acos(u)),z1=D1(l0),N1=I1(l0),ik=Bf(.42,0,1,1),sk=Bf(0,0,.58,1),B1=Bf(.42,0,.58,1),ok=u=>Array.isArray(u)&&typeof u[0]!="number",F1=u=>Array.isArray(u)&&typeof u[0]=="number",ak={linear:ga,easeIn:ik,easeInOut:B1,easeOut:sk,circIn:l0,circInOut:N1,circOut:z1,backIn:a0,backInOut:j1,backOut:L1,anticipate:R1},lk=u=>typeof u=="string",Px=u=>{if(F1(u)){i0(u.length===4);const[p,g,w,E]=u;return Bf(p,g,w,E)}else if(lk(u))return ak[u];return u},Pm=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function ck(u,p){let g=new Set,w=new Set,E=!1,P=!1;const j=new WeakSet;let F={delta:0,timestamp:0,isProcessing:!1};function s(G){j.has(G)&&(U.schedule(G),u()),G(F)}const U={schedule:(G,J=!1,Y=!1)=>{const Ae=Y&&E?g:w;return J&&j.add(G),Ae.has(G)||Ae.add(G),G},cancel:G=>{w.delete(G),j.delete(G)},process:G=>{if(F=G,E){P=!0;return}E=!0,[g,w]=[w,g],g.forEach(s),g.clear(),E=!1,P&&(P=!1,U.process(G))}};return U}const uk=40;function O1(u,p){let g=!1,w=!0;const E={delta:0,timestamp:0,isProcessing:!1},P=()=>g=!0,j=Pm.reduce((Me,lt)=>(Me[lt]=ck(P),Me),{}),{setup:F,read:s,resolveKeyframes:U,preUpdate:G,update:J,preRender:Y,render:me,postRender:Ae}=j,Ee=()=>{const Me=Oc.useManualTiming?E.timestamp:performance.now();g=!1,Oc.useManualTiming||(E.delta=w?1e3/60:Math.max(Math.min(Me-E.timestamp,uk),1)),E.timestamp=Me,E.isProcessing=!0,F.process(E),s.process(E),U.process(E),G.process(E),J.process(E),Y.process(E),me.process(E),Ae.process(E),E.isProcessing=!1,g&&p&&(w=!1,u(Ee))},Re=()=>{g=!0,w=!0,E.isProcessing||u(Ee)};return{schedule:Pm.reduce((Me,lt)=>{const kt=j[lt];return Me[lt]=($e,Ye=!1,tt=!1)=>(g||Re(),kt.schedule($e,Ye,tt)),Me},{}),cancel:Me=>{for(let lt=0;lt<Pm.length;lt++)j[Pm[lt]].cancel(Me)},state:E,steps:j}}const{schedule:qn,cancel:Ru,state:cs,steps:ey}=O1(typeof requestAnimationFrame<"u"?requestAnimationFrame:ga,!0);let Fm;function hk(){Fm=void 0}const po={now:()=>(Fm===void 0&&po.set(cs.isProcessing||Oc.useManualTiming?cs.timestamp:performance.now()),Fm),set:u=>{Fm=u,queueMicrotask(hk)}},U1=u=>p=>typeof p=="string"&&p.startsWith(u),c0=U1("--"),dk=U1("var(--"),u0=u=>dk(u)?pk.test(u.split("/*")[0].trim()):!1,pk=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,hp={test:u=>typeof u=="number",parse:parseFloat,transform:u=>u},Cf={...hp,transform:u=>Fc(0,1,u)},Im={...hp,default:1},yf=u=>Math.round(u*1e5)/1e5,h0=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function fk(u){return u==null}const mk=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,d0=(u,p)=>g=>!!(typeof g=="string"&&mk.test(g)&&g.startsWith(u)||p&&!fk(g)&&Object.prototype.hasOwnProperty.call(g,p)),V1=(u,p,g)=>w=>{if(typeof w!="string")return w;const[E,P,j,F]=w.match(h0);return{[u]:parseFloat(E),[p]:parseFloat(P),[g]:parseFloat(j),alpha:F!==void 0?parseFloat(F):1}},gk=u=>Fc(0,255,u),ty={...hp,transform:u=>Math.round(gk(u))},Zh={test:d0("rgb","red"),parse:V1("red","green","blue"),transform:({red:u,green:p,blue:g,alpha:w=1})=>"rgba("+ty.transform(u)+", "+ty.transform(p)+", "+ty.transform(g)+", "+yf(Cf.transform(w))+")"};function yk(u){let p="",g="",w="",E="";return u.length>5?(p=u.substring(1,3),g=u.substring(3,5),w=u.substring(5,7),E=u.substring(7,9)):(p=u.substring(1,2),g=u.substring(2,3),w=u.substring(3,4),E=u.substring(4,5),p+=p,g+=g,w+=w,E+=E),{red:parseInt(p,16),green:parseInt(g,16),blue:parseInt(w,16),alpha:E?parseInt(E,16)/255:1}}const Ty={test:d0("#"),parse:yk,transform:Zh.transform},Ff=u=>({test:p=>typeof p=="string"&&p.endsWith(u)&&p.split(" ").length===1,parse:parseFloat,transform:p=>`${p}${u}`}),Lu=Ff("deg"),Wl=Ff("%"),Ar=Ff("px"),_k=Ff("vh"),xk=Ff("vw"),Ix={...Wl,parse:u=>Wl.parse(u)/100,transform:u=>Wl.transform(u*100)},Yd={test:d0("hsl","hue"),parse:V1("hue","saturation","lightness"),transform:({hue:u,saturation:p,lightness:g,alpha:w=1})=>"hsla("+Math.round(u)+", "+Wl.transform(yf(p))+", "+Wl.transform(yf(g))+", "+yf(Cf.transform(w))+")"},ki={test:u=>Zh.test(u)||Ty.test(u)||Yd.test(u),parse:u=>Zh.test(u)?Zh.parse(u):Yd.test(u)?Yd.parse(u):Ty.parse(u),transform:u=>typeof u=="string"?u:u.hasOwnProperty("red")?Zh.transform(u):Yd.transform(u),getAnimatableNone:u=>{const p=ki.parse(u);return p.alpha=0,ki.transform(p)}},vk=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function bk(u){return isNaN(u)&&typeof u=="string"&&(u.match(h0)?.length||0)+(u.match(vk)?.length||0)>0}const $1="number",G1="color",wk="var",Tk="var(",Dx="${}",Sk=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Af(u){const p=u.toString(),g=[],w={color:[],number:[],var:[]},E=[];let P=0;const F=p.replace(Sk,s=>(ki.test(s)?(w.color.push(P),E.push(G1),g.push(ki.parse(s))):s.startsWith(Tk)?(w.var.push(P),E.push(wk),g.push(s)):(w.number.push(P),E.push($1),g.push(parseFloat(s))),++P,Dx)).split(Dx);return{values:g,split:F,indexes:w,types:E}}function W1(u){return Af(u).values}function q1(u){const{split:p,types:g}=Af(u),w=p.length;return E=>{let P="";for(let j=0;j<w;j++)if(P+=p[j],E[j]!==void 0){const F=g[j];F===$1?P+=yf(E[j]):F===G1?P+=ki.transform(E[j]):P+=E[j]}return P}}const Ek=u=>typeof u=="number"?0:ki.test(u)?ki.getAnimatableNone(u):u;function kk(u){const p=W1(u);return q1(u)(p.map(Ek))}const zu={test:bk,parse:W1,createTransformer:q1,getAnimatableNone:kk};function ry(u,p,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?u+(p-u)*6*g:g<1/2?p:g<2/3?u+(p-u)*(2/3-g)*6:u}function Ck({hue:u,saturation:p,lightness:g,alpha:w}){u/=360,p/=100,g/=100;let E=0,P=0,j=0;if(!p)E=P=j=g;else{const F=g<.5?g*(1+p):g+p-g*p,s=2*g-F;E=ry(s,F,u+1/3),P=ry(s,F,u),j=ry(s,F,u-1/3)}return{red:Math.round(E*255),green:Math.round(P*255),blue:Math.round(j*255),alpha:w}}function Wm(u,p){return g=>g>0?p:u}const ei=(u,p,g)=>u+(p-u)*g,ny=(u,p,g)=>{const w=u*u,E=g*(p*p-w)+w;return E<0?0:Math.sqrt(E)},Ak=[Ty,Zh,Yd],Mk=u=>Ak.find(p=>p.test(u));function Lx(u){const p=Mk(u);if(!p)return!1;let g=p.parse(u);return p===Yd&&(g=Ck(g)),g}const jx=(u,p)=>{const g=Lx(u),w=Lx(p);if(!g||!w)return Wm(u,p);const E={...g};return P=>(E.red=ny(g.red,w.red,P),E.green=ny(g.green,w.green,P),E.blue=ny(g.blue,w.blue,P),E.alpha=ei(g.alpha,w.alpha,P),Zh.transform(E))},Sy=new Set(["none","hidden"]);function Pk(u,p){return Sy.has(u)?g=>g<=0?u:p:g=>g>=1?p:u}function Ik(u,p){return g=>ei(u,p,g)}function p0(u){return typeof u=="number"?Ik:typeof u=="string"?u0(u)?Wm:ki.test(u)?jx:jk:Array.isArray(u)?Z1:typeof u=="object"?ki.test(u)?jx:Dk:Wm}function Z1(u,p){const g=[...u],w=g.length,E=u.map((P,j)=>p0(P)(P,p[j]));return P=>{for(let j=0;j<w;j++)g[j]=E[j](P);return g}}function Dk(u,p){const g={...u,...p},w={};for(const E in g)u[E]!==void 0&&p[E]!==void 0&&(w[E]=p0(u[E])(u[E],p[E]));return E=>{for(const P in w)g[P]=w[P](E);return g}}function Lk(u,p){const g=[],w={color:0,var:0,number:0};for(let E=0;E<p.values.length;E++){const P=p.types[E],j=u.indexes[P][w[P]],F=u.values[j]??0;g[E]=F,w[P]++}return g}const jk=(u,p)=>{const g=zu.createTransformer(p),w=Af(u),E=Af(p);return w.indexes.var.length===E.indexes.var.length&&w.indexes.color.length===E.indexes.color.length&&w.indexes.number.length>=E.indexes.number.length?Sy.has(u)&&!E.values.length||Sy.has(p)&&!w.values.length?Pk(u,p):Nf(Z1(Lk(w,E),E.values),g):Wm(u,p)};function H1(u,p,g){return typeof u=="number"&&typeof p=="number"&&typeof g=="number"?ei(u,p,g):p0(u)(u,p)}const Rk=u=>{const p=({timestamp:g})=>u(g);return{start:(g=!0)=>qn.update(p,g),stop:()=>Ru(p),now:()=>cs.isProcessing?cs.timestamp:po.now()}},X1=(u,p,g=10)=>{let w="";const E=Math.max(Math.round(p/g),2);for(let P=0;P<E;P++)w+=Math.round(u(P/(E-1))*1e4)/1e4+", ";return`linear(${w.substring(0,w.length-2)})`},qm=2e4;function f0(u){let p=0;const g=50;let w=u.next(p);for(;!w.done&&p<qm;)p+=g,w=u.next(p);return p>=qm?1/0:p}function zk(u,p=100,g){const w=g({...u,keyframes:[0,p]}),E=Math.min(f0(w),qm);return{type:"keyframes",ease:P=>w.next(E*P).value/p,duration:Gl(E)}}const Nk=5;function K1(u,p,g){const w=Math.max(p-Nk,0);return M1(g-u(w),p-w)}const hi={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},iy=.001;function Bk({duration:u=hi.duration,bounce:p=hi.bounce,velocity:g=hi.velocity,mass:w=hi.mass}){let E,P,j=1-p;j=Fc(hi.minDamping,hi.maxDamping,j),u=Fc(hi.minDuration,hi.maxDuration,Gl(u)),j<1?(E=U=>{const G=U*j,J=G*u,Y=G-g,me=Ey(U,j),Ae=Math.exp(-J);return iy-Y/me*Ae},P=U=>{const J=U*j*u,Y=J*g+g,me=Math.pow(j,2)*Math.pow(U,2)*u,Ae=Math.exp(-J),Ee=Ey(Math.pow(U,2),j);return(-E(U)+iy>0?-1:1)*((Y-me)*Ae)/Ee}):(E=U=>{const G=Math.exp(-U*u),J=(U-g)*u+1;return-iy+G*J},P=U=>{const G=Math.exp(-U*u),J=(g-U)*(u*u);return G*J});const F=5/u,s=Ok(E,P,F);if(u=$l(u),isNaN(s))return{stiffness:hi.stiffness,damping:hi.damping,duration:u};{const U=Math.pow(s,2)*w;return{stiffness:U,damping:j*2*Math.sqrt(w*U),duration:u}}}const Fk=12;function Ok(u,p,g){let w=g;for(let E=1;E<Fk;E++)w=w-u(w)/p(w);return w}function Ey(u,p){return u*Math.sqrt(1-p*p)}const Uk=["duration","bounce"],Vk=["stiffness","damping","mass"];function Rx(u,p){return p.some(g=>u[g]!==void 0)}function $k(u){let p={velocity:hi.velocity,stiffness:hi.stiffness,damping:hi.damping,mass:hi.mass,isResolvedFromDuration:!1,...u};if(!Rx(u,Vk)&&Rx(u,Uk))if(u.visualDuration){const g=u.visualDuration,w=2*Math.PI/(g*1.2),E=w*w,P=2*Fc(.05,1,1-(u.bounce||0))*Math.sqrt(E);p={...p,mass:hi.mass,stiffness:E,damping:P}}else{const g=Bk(u);p={...p,...g,mass:hi.mass},p.isResolvedFromDuration=!0}return p}function Zm(u=hi.visualDuration,p=hi.bounce){const g=typeof u!="object"?{visualDuration:u,keyframes:[0,1],bounce:p}:u;let{restSpeed:w,restDelta:E}=g;const P=g.keyframes[0],j=g.keyframes[g.keyframes.length-1],F={done:!1,value:P},{stiffness:s,damping:U,mass:G,duration:J,velocity:Y,isResolvedFromDuration:me}=$k({...g,velocity:-Gl(g.velocity||0)}),Ae=Y||0,Ee=U/(2*Math.sqrt(s*G)),Re=j-P,Ue=Gl(Math.sqrt(s/G)),He=Math.abs(Re)<5;w||(w=He?hi.restSpeed.granular:hi.restSpeed.default),E||(E=He?hi.restDelta.granular:hi.restDelta.default);let Me;if(Ee<1){const kt=Ey(Ue,Ee);Me=$e=>{const Ye=Math.exp(-Ee*Ue*$e);return j-Ye*((Ae+Ee*Ue*Re)/kt*Math.sin(kt*$e)+Re*Math.cos(kt*$e))}}else if(Ee===1)Me=kt=>j-Math.exp(-Ue*kt)*(Re+(Ae+Ue*Re)*kt);else{const kt=Ue*Math.sqrt(Ee*Ee-1);Me=$e=>{const Ye=Math.exp(-Ee*Ue*$e),tt=Math.min(kt*$e,300);return j-Ye*((Ae+Ee*Ue*Re)*Math.sinh(tt)+kt*Re*Math.cosh(tt))/kt}}const lt={calculatedDuration:me&&J||null,next:kt=>{const $e=Me(kt);if(me)F.done=kt>=J;else{let Ye=kt===0?Ae:0;Ee<1&&(Ye=kt===0?$l(Ae):K1(Me,kt,$e));const tt=Math.abs(Ye)<=w,it=Math.abs(j-$e)<=E;F.done=tt&&it}return F.value=F.done?j:$e,F},toString:()=>{const kt=Math.min(f0(lt),qm),$e=X1(Ye=>lt.next(kt*Ye).value,kt,30);return kt+"ms "+$e},toTransition:()=>{}};return lt}Zm.applyToOptions=u=>{const p=zk(u,100,Zm);return u.ease=p.ease,u.duration=$l(p.duration),u.type="keyframes",u};function ky({keyframes:u,velocity:p=0,power:g=.8,timeConstant:w=325,bounceDamping:E=10,bounceStiffness:P=500,modifyTarget:j,min:F,max:s,restDelta:U=.5,restSpeed:G}){const J=u[0],Y={done:!1,value:J},me=tt=>F!==void 0&&tt<F||s!==void 0&&tt>s,Ae=tt=>F===void 0?s:s===void 0||Math.abs(F-tt)<Math.abs(s-tt)?F:s;let Ee=g*p;const Re=J+Ee,Ue=j===void 0?Re:j(Re);Ue!==Re&&(Ee=Ue-J);const He=tt=>-Ee*Math.exp(-tt/w),Me=tt=>Ue+He(tt),lt=tt=>{const it=He(tt),De=Me(tt);Y.done=Math.abs(it)<=U,Y.value=Y.done?Ue:De};let kt,$e;const Ye=tt=>{me(Y.value)&&(kt=tt,$e=Zm({keyframes:[Y.value,Ae(Y.value)],velocity:K1(Me,tt,Y.value),damping:E,stiffness:P,restDelta:U,restSpeed:G}))};return Ye(0),{calculatedDuration:null,next:tt=>{let it=!1;return!$e&&kt===void 0&&(it=!0,lt(tt),Ye(tt)),kt!==void 0&&tt>=kt?$e.next(tt-kt):(!it&&lt(tt),Y)}}}function Gk(u,p,g){const w=[],E=g||Oc.mix||H1,P=u.length-1;for(let j=0;j<P;j++){let F=E(u[j],u[j+1]);if(p){const s=Array.isArray(p)?p[j]||ga:p;F=Nf(s,F)}w.push(F)}return w}function Wk(u,p,{clamp:g=!0,ease:w,mixer:E}={}){const P=u.length;if(i0(P===p.length),P===1)return()=>p[0];if(P===2&&p[0]===p[1])return()=>p[1];const j=u[0]===u[1];u[0]>u[P-1]&&(u=[...u].reverse(),p=[...p].reverse());const F=Gk(p,w,E),s=F.length,U=G=>{if(j&&G<u[0])return p[0];let J=0;if(s>1)for(;J<u.length-2&&!(G<u[J+1]);J++);const Y=kf(u[J],u[J+1],G);return F[J](Y)};return g?G=>U(Fc(u[0],u[P-1],G)):U}function qk(u,p){const g=u[u.length-1];for(let w=1;w<=p;w++){const E=kf(0,p,w);u.push(ei(g,1,E))}}function Zk(u){const p=[0];return qk(p,u.length-1),p}function Hk(u,p){return u.map(g=>g*p)}function Xk(u,p){return u.map(()=>p||B1).splice(0,u.length-1)}function _f({duration:u=300,keyframes:p,times:g,ease:w="easeInOut"}){const E=ok(w)?w.map(Px):Px(w),P={done:!1,value:p[0]},j=Hk(g&&g.length===p.length?g:Zk(p),u),F=Wk(j,p,{ease:Array.isArray(E)?E:Xk(p,E)});return{calculatedDuration:u,next:s=>(P.value=F(s),P.done=s>=u,P)}}const Kk=u=>u!==null;function m0(u,{repeat:p,repeatType:g="loop"},w,E=1){const P=u.filter(Kk),F=E<0||p&&g!=="loop"&&p%2===1?0:P.length-1;return!F||w===void 0?P[F]:w}const Yk={decay:ky,inertia:ky,tween:_f,keyframes:_f,spring:Zm};function Y1(u){typeof u.type=="string"&&(u.type=Yk[u.type])}class g0{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(p=>{this.resolve=p})}notifyFinished(){this.resolve()}then(p,g){return this.finished.then(p,g)}}const Jk=u=>u/100;class y0 extends g0{constructor(p){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:g}=this.options;g&&g.updatedAt!==po.now()&&this.tick(po.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=p,this.initAnimation(),this.play(),p.autoplay===!1&&this.pause()}initAnimation(){const{options:p}=this;Y1(p);const{type:g=_f,repeat:w=0,repeatDelay:E=0,repeatType:P,velocity:j=0}=p;let{keyframes:F}=p;const s=g||_f;s!==_f&&typeof F[0]!="number"&&(this.mixKeyframes=Nf(Jk,H1(F[0],F[1])),F=[0,100]);const U=s({...p,keyframes:F});P==="mirror"&&(this.mirroredGenerator=s({...p,keyframes:[...F].reverse(),velocity:-j})),U.calculatedDuration===null&&(U.calculatedDuration=f0(U));const{calculatedDuration:G}=U;this.calculatedDuration=G,this.resolvedDuration=G+E,this.totalDuration=this.resolvedDuration*(w+1)-E,this.generator=U}updateTime(p){const g=Math.round(p-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=g}tick(p,g=!1){const{generator:w,totalDuration:E,mixKeyframes:P,mirroredGenerator:j,resolvedDuration:F,calculatedDuration:s}=this;if(this.startTime===null)return w.next(0);const{delay:U=0,keyframes:G,repeat:J,repeatType:Y,repeatDelay:me,type:Ae,onUpdate:Ee,finalKeyframe:Re}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,p):this.speed<0&&(this.startTime=Math.min(p-E/this.speed,this.startTime)),g?this.currentTime=p:this.updateTime(p);const Ue=this.currentTime-U*(this.playbackSpeed>=0?1:-1),He=this.playbackSpeed>=0?Ue<0:Ue>E;this.currentTime=Math.max(Ue,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=E);let Me=this.currentTime,lt=w;if(J){const tt=Math.min(this.currentTime,E)/F;let it=Math.floor(tt),De=tt%1;!De&&tt>=1&&(De=1),De===1&&it--,it=Math.min(it,J+1),!!(it%2)&&(Y==="reverse"?(De=1-De,me&&(De-=me/F)):Y==="mirror"&&(lt=j)),Me=Fc(0,1,De)*F}const kt=He?{done:!1,value:G[0]}:lt.next(Me);P&&(kt.value=P(kt.value));let{done:$e}=kt;!He&&s!==null&&($e=this.playbackSpeed>=0?this.currentTime>=E:this.currentTime<=0);const Ye=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&$e);return Ye&&Ae!==ky&&(kt.value=m0(G,this.options,Re,this.speed)),Ee&&Ee(kt.value),Ye&&this.finish(),kt}then(p,g){return this.finished.then(p,g)}get duration(){return Gl(this.calculatedDuration)}get time(){return Gl(this.currentTime)}set time(p){p=$l(p),this.currentTime=p,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=p:this.driver&&(this.startTime=this.driver.now()-p/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(p){this.updateTime(po.now());const g=this.playbackSpeed!==p;this.playbackSpeed=p,g&&(this.time=Gl(this.currentTime))}play(){if(this.isStopped)return;const{driver:p=Rk,startTime:g}=this.options;this.driver||(this.driver=p(E=>this.tick(E))),this.options.onPlay?.();const w=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=w):this.holdTime!==null?this.startTime=w-this.holdTime:this.startTime||(this.startTime=g??w),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(po.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(p){return this.startTime=0,this.tick(p,!0)}attachTimeline(p){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),p.observe(this)}}function Qk(u){for(let p=1;p<u.length;p++)u[p]??(u[p]=u[p-1])}const Hh=u=>u*180/Math.PI,Cy=u=>{const p=Hh(Math.atan2(u[1],u[0]));return Ay(p)},eC={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:u=>(Math.abs(u[0])+Math.abs(u[3]))/2,rotate:Cy,rotateZ:Cy,skewX:u=>Hh(Math.atan(u[1])),skewY:u=>Hh(Math.atan(u[2])),skew:u=>(Math.abs(u[1])+Math.abs(u[2]))/2},Ay=u=>(u=u%360,u<0&&(u+=360),u),zx=Cy,Nx=u=>Math.sqrt(u[0]*u[0]+u[1]*u[1]),Bx=u=>Math.sqrt(u[4]*u[4]+u[5]*u[5]),tC={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Nx,scaleY:Bx,scale:u=>(Nx(u)+Bx(u))/2,rotateX:u=>Ay(Hh(Math.atan2(u[6],u[5]))),rotateY:u=>Ay(Hh(Math.atan2(-u[2],u[0]))),rotateZ:zx,rotate:zx,skewX:u=>Hh(Math.atan(u[4])),skewY:u=>Hh(Math.atan(u[1])),skew:u=>(Math.abs(u[1])+Math.abs(u[4]))/2};function My(u){return u.includes("scale")?1:0}function Py(u,p){if(!u||u==="none")return My(p);const g=u.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let w,E;if(g)w=tC,E=g;else{const F=u.match(/^matrix\(([-\d.e\s,]+)\)$/u);w=eC,E=F}if(!E)return My(p);const P=w[p],j=E[1].split(",").map(nC);return typeof P=="function"?P(j):j[P]}const rC=(u,p)=>{const{transform:g="none"}=getComputedStyle(u);return Py(g,p)};function nC(u){return parseFloat(u.trim())}const dp=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],pp=new Set(dp),Fx=u=>u===hp||u===Ar,iC=new Set(["x","y","z"]),sC=dp.filter(u=>!iC.has(u));function oC(u){const p=[];return sC.forEach(g=>{const w=u.getValue(g);w!==void 0&&(p.push([g,w.get()]),w.set(g.startsWith("scale")?1:0))}),p}const Xh={width:({x:u},{paddingLeft:p="0",paddingRight:g="0"})=>u.max-u.min-parseFloat(p)-parseFloat(g),height:({y:u},{paddingTop:p="0",paddingBottom:g="0"})=>u.max-u.min-parseFloat(p)-parseFloat(g),top:(u,{top:p})=>parseFloat(p),left:(u,{left:p})=>parseFloat(p),bottom:({y:u},{top:p})=>parseFloat(p)+(u.max-u.min),right:({x:u},{left:p})=>parseFloat(p)+(u.max-u.min),x:(u,{transform:p})=>Py(p,"x"),y:(u,{transform:p})=>Py(p,"y")};Xh.translateX=Xh.x;Xh.translateY=Xh.y;const Kh=new Set;let Iy=!1,Dy=!1,Ly=!1;function J1(){if(Dy){const u=Array.from(Kh).filter(w=>w.needsMeasurement),p=new Set(u.map(w=>w.element)),g=new Map;p.forEach(w=>{const E=oC(w);E.length&&(g.set(w,E),w.render())}),u.forEach(w=>w.measureInitialState()),p.forEach(w=>{w.render();const E=g.get(w);E&&E.forEach(([P,j])=>{w.getValue(P)?.set(j)})}),u.forEach(w=>w.measureEndState()),u.forEach(w=>{w.suspendedScrollY!==void 0&&window.scrollTo(0,w.suspendedScrollY)})}Dy=!1,Iy=!1,Kh.forEach(u=>u.complete(Ly)),Kh.clear()}function Q1(){Kh.forEach(u=>{u.readKeyframes(),u.needsMeasurement&&(Dy=!0)})}function aC(){Ly=!0,Q1(),J1(),Ly=!1}class _0{constructor(p,g,w,E,P,j=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...p],this.onComplete=g,this.name=w,this.motionValue=E,this.element=P,this.isAsync=j}scheduleResolve(){this.state="scheduled",this.isAsync?(Kh.add(this),Iy||(Iy=!0,qn.read(Q1),qn.resolveKeyframes(J1))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:p,name:g,element:w,motionValue:E}=this;if(p[0]===null){const P=E?.get(),j=p[p.length-1];if(P!==void 0)p[0]=P;else if(w&&g){const F=w.readValue(g,j);F!=null&&(p[0]=F)}p[0]===void 0&&(p[0]=j),E&&P===void 0&&E.set(p[0])}Qk(p)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(p=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,p),Kh.delete(this)}cancel(){this.state==="scheduled"&&(Kh.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const lC=u=>u.startsWith("--");function cC(u,p,g){lC(p)?u.style.setProperty(p,g):u.style[p]=g}const uC=s0(()=>window.ScrollTimeline!==void 0),hC={};function dC(u,p){const g=s0(u);return()=>hC[p]??g()}const eb=dC(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),gf=([u,p,g,w])=>`cubic-bezier(${u}, ${p}, ${g}, ${w})`,Ox={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:gf([0,.65,.55,1]),circOut:gf([.55,0,1,.45]),backIn:gf([.31,.01,.66,-.59]),backOut:gf([.33,1.53,.69,.99])};function tb(u,p){if(u)return typeof u=="function"?eb()?X1(u,p):"ease-out":F1(u)?gf(u):Array.isArray(u)?u.map(g=>tb(g,p)||Ox.easeOut):Ox[u]}function pC(u,p,g,{delay:w=0,duration:E=300,repeat:P=0,repeatType:j="loop",ease:F="easeOut",times:s}={},U=void 0){const G={[p]:g};s&&(G.offset=s);const J=tb(F,E);Array.isArray(J)&&(G.easing=J);const Y={delay:w,duration:E,easing:Array.isArray(J)?"linear":J,fill:"both",iterations:P+1,direction:j==="reverse"?"alternate":"normal"};return U&&(Y.pseudoElement=U),u.animate(G,Y)}function rb(u){return typeof u=="function"&&"applyToOptions"in u}function fC({type:u,...p}){return rb(u)&&eb()?u.applyToOptions(p):(p.duration??(p.duration=300),p.ease??(p.ease="easeOut"),p)}class mC extends g0{constructor(p){if(super(),this.finishedTime=null,this.isStopped=!1,!p)return;const{element:g,name:w,keyframes:E,pseudoElement:P,allowFlatten:j=!1,finalKeyframe:F,onComplete:s}=p;this.isPseudoElement=!!P,this.allowFlatten=j,this.options=p,i0(typeof p.type!="string");const U=fC(p);this.animation=pC(g,w,E,U,P),U.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!P){const G=m0(E,this.options,F,this.speed);this.updateMotionValue?this.updateMotionValue(G):cC(g,w,G),this.animation.cancel()}s?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:p}=this;p==="idle"||p==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const p=this.animation.effect?.getComputedTiming?.().duration||0;return Gl(Number(p))}get time(){return Gl(Number(this.animation.currentTime)||0)}set time(p){this.finishedTime=null,this.animation.currentTime=$l(p)}get speed(){return this.animation.playbackRate}set speed(p){p<0&&(this.finishedTime=null),this.animation.playbackRate=p}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(p){this.animation.startTime=p}attachTimeline({timeline:p,observe:g}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,p&&uC()?(this.animation.timeline=p,ga):g(this)}}const nb={anticipate:R1,backInOut:j1,circInOut:N1};function gC(u){return u in nb}function yC(u){typeof u.ease=="string"&&gC(u.ease)&&(u.ease=nb[u.ease])}const Ux=10;class _C extends mC{constructor(p){yC(p),Y1(p),super(p),p.startTime&&(this.startTime=p.startTime),this.options=p}updateMotionValue(p){const{motionValue:g,onUpdate:w,onComplete:E,element:P,...j}=this.options;if(!g)return;if(p!==void 0){g.set(p);return}const F=new y0({...j,autoplay:!1}),s=$l(this.finishedTime??this.time);g.setWithVelocity(F.sample(s-Ux).value,F.sample(s).value,Ux),F.stop()}}const Vx=(u,p)=>p==="zIndex"?!1:!!(typeof u=="number"||Array.isArray(u)||typeof u=="string"&&(zu.test(u)||u==="0")&&!u.startsWith("url("));function xC(u){const p=u[0];if(u.length===1)return!0;for(let g=0;g<u.length;g++)if(u[g]!==p)return!0}function vC(u,p,g,w){const E=u[0];if(E===null)return!1;if(p==="display"||p==="visibility")return!0;const P=u[u.length-1],j=Vx(E,p),F=Vx(P,p);return!j||!F?!1:xC(u)||(g==="spring"||rb(g))&&w}function jy(u){u.duration=0,u.type}const bC=new Set(["opacity","clipPath","filter","transform"]),wC=s0(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function TC(u){const{motionValue:p,name:g,repeatDelay:w,repeatType:E,damping:P,type:j}=u;if(!(p?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:s,transformTemplate:U}=p.owner.getProps();return wC()&&g&&bC.has(g)&&(g!=="transform"||!U)&&!s&&!w&&E!=="mirror"&&P!==0&&j!=="inertia"}const SC=40;class EC extends g0{constructor({autoplay:p=!0,delay:g=0,type:w="keyframes",repeat:E=0,repeatDelay:P=0,repeatType:j="loop",keyframes:F,name:s,motionValue:U,element:G,...J}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=po.now();const Y={autoplay:p,delay:g,type:w,repeat:E,repeatDelay:P,repeatType:j,name:s,motionValue:U,element:G,...J},me=G?.KeyframeResolver||_0;this.keyframeResolver=new me(F,(Ae,Ee,Re)=>this.onKeyframesResolved(Ae,Ee,Y,!Re),s,U,G),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(p,g,w,E){this.keyframeResolver=void 0;const{name:P,type:j,velocity:F,delay:s,isHandoff:U,onUpdate:G}=w;this.resolvedAt=po.now(),vC(p,P,j,F)||((Oc.instantAnimations||!s)&&G?.(m0(p,w,g)),p[0]=p[p.length-1],jy(w),w.repeat=0);const Y={startTime:E?this.resolvedAt?this.resolvedAt-this.createdAt>SC?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:g,...w,keyframes:p},me=!U&&TC(Y)?new _C({...Y,element:Y.motionValue.owner.current}):new y0(Y);me.finished.then(()=>this.notifyFinished()).catch(ga),this.pendingTimeline&&(this.stopTimeline=me.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=me}get finished(){return this._animation?this.animation.finished:this._finished}then(p,g){return this.finished.finally(p).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),aC()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(p){this.animation.time=p}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(p){this.animation.speed=p}get startTime(){return this.animation.startTime}attachTimeline(p){return this._animation?this.stopTimeline=this.animation.attachTimeline(p):this.pendingTimeline=p,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const kC=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function CC(u){const p=kC.exec(u);if(!p)return[,];const[,g,w,E]=p;return[`--${g??w}`,E]}function ib(u,p,g=1){const[w,E]=CC(u);if(!w)return;const P=window.getComputedStyle(p).getPropertyValue(w);if(P){const j=P.trim();return k1(j)?parseFloat(j):j}return u0(E)?ib(E,p,g+1):E}function x0(u,p){return u?.[p]??u?.default??u}const sb=new Set(["width","height","top","left","right","bottom",...dp]),AC={test:u=>u==="auto",parse:u=>u},ob=u=>p=>p.test(u),ab=[hp,Ar,Wl,Lu,xk,_k,AC],$x=u=>ab.find(ob(u));function MC(u){return typeof u=="number"?u===0:u!==null?u==="none"||u==="0"||A1(u):!0}const PC=new Set(["brightness","contrast","saturate","opacity"]);function IC(u){const[p,g]=u.slice(0,-1).split("(");if(p==="drop-shadow")return u;const[w]=g.match(h0)||[];if(!w)return u;const E=g.replace(w,"");let P=PC.has(p)?1:0;return w!==g&&(P*=100),p+"("+P+E+")"}const DC=/\b([a-z-]*)\(.*?\)/gu,Ry={...zu,getAnimatableNone:u=>{const p=u.match(DC);return p?p.map(IC).join(" "):u}},Gx={...hp,transform:Math.round},LC={rotate:Lu,rotateX:Lu,rotateY:Lu,rotateZ:Lu,scale:Im,scaleX:Im,scaleY:Im,scaleZ:Im,skew:Lu,skewX:Lu,skewY:Lu,distance:Ar,translateX:Ar,translateY:Ar,translateZ:Ar,x:Ar,y:Ar,z:Ar,perspective:Ar,transformPerspective:Ar,opacity:Cf,originX:Ix,originY:Ix,originZ:Ar},v0={borderWidth:Ar,borderTopWidth:Ar,borderRightWidth:Ar,borderBottomWidth:Ar,borderLeftWidth:Ar,borderRadius:Ar,radius:Ar,borderTopLeftRadius:Ar,borderTopRightRadius:Ar,borderBottomRightRadius:Ar,borderBottomLeftRadius:Ar,width:Ar,maxWidth:Ar,height:Ar,maxHeight:Ar,top:Ar,right:Ar,bottom:Ar,left:Ar,padding:Ar,paddingTop:Ar,paddingRight:Ar,paddingBottom:Ar,paddingLeft:Ar,margin:Ar,marginTop:Ar,marginRight:Ar,marginBottom:Ar,marginLeft:Ar,backgroundPositionX:Ar,backgroundPositionY:Ar,...LC,zIndex:Gx,fillOpacity:Cf,strokeOpacity:Cf,numOctaves:Gx},jC={...v0,color:ki,backgroundColor:ki,outlineColor:ki,fill:ki,stroke:ki,borderColor:ki,borderTopColor:ki,borderRightColor:ki,borderBottomColor:ki,borderLeftColor:ki,filter:Ry,WebkitFilter:Ry},lb=u=>jC[u];function cb(u,p){let g=lb(u);return g!==Ry&&(g=zu),g.getAnimatableNone?g.getAnimatableNone(p):void 0}const RC=new Set(["auto","none","0"]);function zC(u,p,g){let w=0,E;for(;w<u.length&&!E;){const P=u[w];typeof P=="string"&&!RC.has(P)&&Af(P).values.length&&(E=u[w]),w++}if(E&&g)for(const P of p)u[P]=cb(g,E)}class NC extends _0{constructor(p,g,w,E,P){super(p,g,w,E,P,!0)}readKeyframes(){const{unresolvedKeyframes:p,element:g,name:w}=this;if(!g||!g.current)return;super.readKeyframes();for(let s=0;s<p.length;s++){let U=p[s];if(typeof U=="string"&&(U=U.trim(),u0(U))){const G=ib(U,g.current);G!==void 0&&(p[s]=G),s===p.length-1&&(this.finalKeyframe=U)}}if(this.resolveNoneKeyframes(),!sb.has(w)||p.length!==2)return;const[E,P]=p,j=$x(E),F=$x(P);if(j!==F)if(Fx(j)&&Fx(F))for(let s=0;s<p.length;s++){const U=p[s];typeof U=="string"&&(p[s]=parseFloat(U))}else Xh[w]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:p,name:g}=this,w=[];for(let E=0;E<p.length;E++)(p[E]===null||MC(p[E]))&&w.push(E);w.length&&zC(p,w,g)}measureInitialState(){const{element:p,unresolvedKeyframes:g,name:w}=this;if(!p||!p.current)return;w==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Xh[w](p.measureViewportBox(),window.getComputedStyle(p.current)),g[0]=this.measuredOrigin;const E=g[g.length-1];E!==void 0&&p.getValue(w,E).jump(E,!1)}measureEndState(){const{element:p,name:g,unresolvedKeyframes:w}=this;if(!p||!p.current)return;const E=p.getValue(g);E&&E.jump(this.measuredOrigin,!1);const P=w.length-1,j=w[P];w[P]=Xh[g](p.measureViewportBox(),window.getComputedStyle(p.current)),j!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=j),this.removedTransforms?.length&&this.removedTransforms.forEach(([F,s])=>{p.getValue(F).set(s)}),this.resolveNoneKeyframes()}}function BC(u,p,g){if(u instanceof EventTarget)return[u];if(typeof u=="string"){let w=document;const E=g?.[u]??w.querySelectorAll(u);return E?Array.from(E):[]}return Array.from(u)}const ub=(u,p)=>p&&typeof u=="number"?p.transform(u):u;function hb(u){return C1(u)&&"offsetHeight"in u}const Wx=30,FC=u=>!isNaN(parseFloat(u));class OC{constructor(p,g={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=w=>{const E=po.now();if(this.updatedAt!==E&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(w),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const P of this.dependents)P.dirty()},this.hasAnimated=!1,this.setCurrent(p),this.owner=g.owner}setCurrent(p){this.current=p,this.updatedAt=po.now(),this.canTrackVelocity===null&&p!==void 0&&(this.canTrackVelocity=FC(this.current))}setPrevFrameValue(p=this.current){this.prevFrameValue=p,this.prevUpdatedAt=this.updatedAt}onChange(p){return this.on("change",p)}on(p,g){this.events[p]||(this.events[p]=new o0);const w=this.events[p].add(g);return p==="change"?()=>{w(),qn.read(()=>{this.events.change.getSize()||this.stop()})}:w}clearListeners(){for(const p in this.events)this.events[p].clear()}attach(p,g){this.passiveEffect=p,this.stopPassiveEffect=g}set(p){this.passiveEffect?this.passiveEffect(p,this.updateAndNotify):this.updateAndNotify(p)}setWithVelocity(p,g,w){this.set(g),this.prev=void 0,this.prevFrameValue=p,this.prevUpdatedAt=this.updatedAt-w}jump(p,g=!0){this.updateAndNotify(p),this.prev=p,this.prevUpdatedAt=this.prevFrameValue=void 0,g&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(p){this.dependents||(this.dependents=new Set),this.dependents.add(p)}removeDependent(p){this.dependents&&this.dependents.delete(p)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const p=po.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||p-this.updatedAt>Wx)return 0;const g=Math.min(this.updatedAt-this.prevUpdatedAt,Wx);return M1(parseFloat(this.current)-parseFloat(this.prevFrameValue),g)}start(p){return this.stop(),new Promise(g=>{this.hasAnimated=!0,this.animation=p(g),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ap(u,p){return new OC(u,p)}const{schedule:b0}=O1(queueMicrotask,!1),Wa={x:!1,y:!1};function db(){return Wa.x||Wa.y}function UC(u){return u==="x"||u==="y"?Wa[u]?null:(Wa[u]=!0,()=>{Wa[u]=!1}):Wa.x||Wa.y?null:(Wa.x=Wa.y=!0,()=>{Wa.x=Wa.y=!1})}function pb(u,p){const g=BC(u),w=new AbortController,E={passive:!0,...p,signal:w.signal};return[g,E,()=>w.abort()]}function qx(u){return!(u.pointerType==="touch"||db())}function VC(u,p,g={}){const[w,E,P]=pb(u,g),j=F=>{if(!qx(F))return;const{target:s}=F,U=p(s,F);if(typeof U!="function"||!s)return;const G=J=>{qx(J)&&(U(J),s.removeEventListener("pointerleave",G))};s.addEventListener("pointerleave",G,E)};return w.forEach(F=>{F.addEventListener("pointerenter",j,E)}),P}const fb=(u,p)=>p?u===p?!0:fb(u,p.parentElement):!1,w0=u=>u.pointerType==="mouse"?typeof u.button!="number"||u.button<=0:u.isPrimary!==!1,$C=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function GC(u){return $C.has(u.tagName)||u.tabIndex!==-1}const Om=new WeakSet;function Zx(u){return p=>{p.key==="Enter"&&u(p)}}function sy(u,p){u.dispatchEvent(new PointerEvent("pointer"+p,{isPrimary:!0,bubbles:!0}))}const WC=(u,p)=>{const g=u.currentTarget;if(!g)return;const w=Zx(()=>{if(Om.has(g))return;sy(g,"down");const E=Zx(()=>{sy(g,"up")}),P=()=>sy(g,"cancel");g.addEventListener("keyup",E,p),g.addEventListener("blur",P,p)});g.addEventListener("keydown",w,p),g.addEventListener("blur",()=>g.removeEventListener("keydown",w),p)};function Hx(u){return w0(u)&&!db()}function qC(u,p,g={}){const[w,E,P]=pb(u,g),j=F=>{const s=F.currentTarget;if(!Hx(F))return;Om.add(s);const U=p(s,F),G=(me,Ae)=>{window.removeEventListener("pointerup",J),window.removeEventListener("pointercancel",Y),Om.has(s)&&Om.delete(s),Hx(me)&&typeof U=="function"&&U(me,{success:Ae})},J=me=>{G(me,s===window||s===document||g.useGlobalTarget||fb(s,me.target))},Y=me=>{G(me,!1)};window.addEventListener("pointerup",J,E),window.addEventListener("pointercancel",Y,E)};return w.forEach(F=>{(g.useGlobalTarget?window:F).addEventListener("pointerdown",j,E),hb(F)&&(F.addEventListener("focus",U=>WC(U,E)),!GC(F)&&!F.hasAttribute("tabindex")&&(F.tabIndex=0))}),P}function mb(u){return C1(u)&&"ownerSVGElement"in u}function ZC(u){return mb(u)&&u.tagName==="svg"}const Ps=u=>!!(u&&u.getVelocity),HC=[...ab,ki,zu],XC=u=>HC.find(ob(u)),T0=ee.createContext({transformPagePoint:u=>u,isStatic:!1,reducedMotion:"never"});class KC extends ee.Component{getSnapshotBeforeUpdate(p){const g=this.props.childRef.current;if(g&&p.isPresent&&!this.props.isPresent){const w=g.offsetParent,E=hb(w)&&w.offsetWidth||0,P=this.props.sizeRef.current;P.height=g.offsetHeight||0,P.width=g.offsetWidth||0,P.top=g.offsetTop,P.left=g.offsetLeft,P.right=E-P.width-P.left}return null}componentDidUpdate(){}render(){return this.props.children}}function YC({children:u,isPresent:p,anchorX:g,root:w}){const E=ee.useId(),P=ee.useRef(null),j=ee.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:F}=ee.useContext(T0);return ee.useInsertionEffect(()=>{const{width:s,height:U,top:G,left:J,right:Y}=j.current;if(p||!P.current||!s||!U)return;const me=g==="left"?`left: ${J}`:`right: ${Y}`;P.current.dataset.motionPopId=E;const Ae=document.createElement("style");F&&(Ae.nonce=F);const Ee=w??document.head;return Ee.appendChild(Ae),Ae.sheet&&Ae.sheet.insertRule(`
          [data-motion-pop-id="${E}"] {
            position: absolute !important;
            width: ${s}px !important;
            height: ${U}px !important;
            ${me}px !important;
            top: ${G}px !important;
          }
        `),()=>{Ee.contains(Ae)&&Ee.removeChild(Ae)}},[p]),v.jsx(KC,{isPresent:p,childRef:P,sizeRef:j,children:ee.cloneElement(u,{ref:P})})}const JC=({children:u,initial:p,isPresent:g,onExitComplete:w,custom:E,presenceAffectsLayout:P,mode:j,anchorX:F,root:s})=>{const U=e0(QC),G=ee.useId();let J=!0,Y=ee.useMemo(()=>(J=!1,{id:G,initial:p,isPresent:g,custom:E,onExitComplete:me=>{U.set(me,!0);for(const Ae of U.values())if(!Ae)return;w&&w()},register:me=>(U.set(me,!1),()=>U.delete(me))}),[g,U,w]);return P&&J&&(Y={...Y}),ee.useMemo(()=>{U.forEach((me,Ae)=>U.set(Ae,!1))},[g]),ee.useEffect(()=>{!g&&!U.size&&w&&w()},[g]),j==="popLayout"&&(u=v.jsx(YC,{isPresent:g,anchorX:F,root:s,children:u})),v.jsx(Qm.Provider,{value:Y,children:u})};function QC(){return new Map}function gb(u=!0){const p=ee.useContext(Qm);if(p===null)return[!0,null];const{isPresent:g,onExitComplete:w,register:E}=p,P=ee.useId();ee.useEffect(()=>{if(u)return E(P)},[u]);const j=ee.useCallback(()=>u&&w&&w(P),[P,w,u]);return!g&&w?[!1,j]:[!0]}const Dm=u=>u.key||"";function Xx(u){const p=[];return ee.Children.forEach(u,g=>{ee.isValidElement(g)&&p.push(g)}),p}const fo=({children:u,custom:p,initial:g=!0,onExitComplete:w,presenceAffectsLayout:E=!0,mode:P="sync",propagate:j=!1,anchorX:F="left",root:s})=>{const[U,G]=gb(j),J=ee.useMemo(()=>Xx(u),[u]),Y=j&&!U?[]:J.map(Dm),me=ee.useRef(!0),Ae=ee.useRef(J),Ee=e0(()=>new Map),[Re,Ue]=ee.useState(J),[He,Me]=ee.useState(J);E1(()=>{me.current=!1,Ae.current=J;for(let $e=0;$e<He.length;$e++){const Ye=Dm(He[$e]);Y.includes(Ye)?Ee.delete(Ye):Ee.get(Ye)!==!0&&Ee.set(Ye,!1)}},[He,Y.length,Y.join("-")]);const lt=[];if(J!==Re){let $e=[...J];for(let Ye=0;Ye<He.length;Ye++){const tt=He[Ye],it=Dm(tt);Y.includes(it)||($e.splice(Ye,0,tt),lt.push(tt))}return P==="wait"&&lt.length&&($e=lt),Me(Xx($e)),Ue(J),null}const{forceRender:kt}=ee.useContext(Qy);return v.jsx(v.Fragment,{children:He.map($e=>{const Ye=Dm($e),tt=j&&!U?!1:J===He||Y.includes(Ye),it=()=>{if(Ee.has(Ye))Ee.set(Ye,!0);else return;let De=!0;Ee.forEach($t=>{$t||(De=!1)}),De&&(kt?.(),Me(Ae.current),j&&G?.(),w&&w())};return v.jsx(JC,{isPresent:tt,initial:!me.current||g?void 0:!1,custom:p,presenceAffectsLayout:E,mode:P,root:s,onExitComplete:tt?void 0:it,anchorX:F,children:$e},Ye)})})},yb=ee.createContext({strict:!1}),Kx={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},lp={};for(const u in Kx)lp[u]={isEnabled:p=>Kx[u].some(g=>!!p[g])};function eA(u){for(const p in u)lp[p]={...lp[p],...u[p]}}const tA=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Hm(u){return u.startsWith("while")||u.startsWith("drag")&&u!=="draggable"||u.startsWith("layout")||u.startsWith("onTap")||u.startsWith("onPan")||u.startsWith("onLayout")||tA.has(u)}let _b=u=>!Hm(u);function rA(u){typeof u=="function"&&(_b=p=>p.startsWith("on")?!Hm(p):u(p))}try{rA(require("@emotion/is-prop-valid").default)}catch{}function nA(u,p,g){const w={};for(const E in u)E==="values"&&typeof u.values=="object"||(_b(E)||g===!0&&Hm(E)||!p&&!Hm(E)||u.draggable&&E.startsWith("onDrag"))&&(w[E]=u[E]);return w}const eg=ee.createContext({});function tg(u){return u!==null&&typeof u=="object"&&typeof u.start=="function"}function Mf(u){return typeof u=="string"||Array.isArray(u)}const S0=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],E0=["initial",...S0];function rg(u){return tg(u.animate)||E0.some(p=>Mf(u[p]))}function xb(u){return!!(rg(u)||u.variants)}function iA(u,p){if(rg(u)){const{initial:g,animate:w}=u;return{initial:g===!1||Mf(g)?g:void 0,animate:Mf(w)?w:void 0}}return u.inherit!==!1?p:{}}function sA(u){const{initial:p,animate:g}=iA(u,ee.useContext(eg));return ee.useMemo(()=>({initial:p,animate:g}),[Yx(p),Yx(g)])}function Yx(u){return Array.isArray(u)?u.join(" "):u}const Pf={};function oA(u){for(const p in u)Pf[p]=u[p],c0(p)&&(Pf[p].isCSSVariable=!0)}function vb(u,{layout:p,layoutId:g}){return pp.has(u)||u.startsWith("origin")||(p||g!==void 0)&&(!!Pf[u]||u==="opacity")}const aA={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},lA=dp.length;function cA(u,p,g){let w="",E=!0;for(let P=0;P<lA;P++){const j=dp[P],F=u[j];if(F===void 0)continue;let s=!0;if(typeof F=="number"?s=F===(j.startsWith("scale")?1:0):s=parseFloat(F)===0,!s||g){const U=ub(F,v0[j]);if(!s){E=!1;const G=aA[j]||j;w+=`${G}(${U}) `}g&&(p[j]=U)}}return w=w.trim(),g?w=g(p,E?"":w):E&&(w="none"),w}function k0(u,p,g){const{style:w,vars:E,transformOrigin:P}=u;let j=!1,F=!1;for(const s in p){const U=p[s];if(pp.has(s)){j=!0;continue}else if(c0(s)){E[s]=U;continue}else{const G=ub(U,v0[s]);s.startsWith("origin")?(F=!0,P[s]=G):w[s]=G}}if(p.transform||(j||g?w.transform=cA(p,u.transform,g):w.transform&&(w.transform="none")),F){const{originX:s="50%",originY:U="50%",originZ:G=0}=P;w.transformOrigin=`${s} ${U} ${G}`}}const C0=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function bb(u,p,g){for(const w in p)!Ps(p[w])&&!vb(w,g)&&(u[w]=p[w])}function uA({transformTemplate:u},p){return ee.useMemo(()=>{const g=C0();return k0(g,p,u),Object.assign({},g.vars,g.style)},[p])}function hA(u,p){const g=u.style||{},w={};return bb(w,g,u),Object.assign(w,uA(u,p)),w}function dA(u,p){const g={},w=hA(u,p);return u.drag&&u.dragListener!==!1&&(g.draggable=!1,w.userSelect=w.WebkitUserSelect=w.WebkitTouchCallout="none",w.touchAction=u.drag===!0?"none":`pan-${u.drag==="x"?"y":"x"}`),u.tabIndex===void 0&&(u.onTap||u.onTapStart||u.whileTap)&&(g.tabIndex=0),g.style=w,g}const pA={offset:"stroke-dashoffset",array:"stroke-dasharray"},fA={offset:"strokeDashoffset",array:"strokeDasharray"};function mA(u,p,g=1,w=0,E=!0){u.pathLength=1;const P=E?pA:fA;u[P.offset]=Ar.transform(-w);const j=Ar.transform(p),F=Ar.transform(g);u[P.array]=`${j} ${F}`}function wb(u,{attrX:p,attrY:g,attrScale:w,pathLength:E,pathSpacing:P=1,pathOffset:j=0,...F},s,U,G){if(k0(u,F,U),s){u.style.viewBox&&(u.attrs.viewBox=u.style.viewBox);return}u.attrs=u.style,u.style={};const{attrs:J,style:Y}=u;J.transform&&(Y.transform=J.transform,delete J.transform),(Y.transform||J.transformOrigin)&&(Y.transformOrigin=J.transformOrigin??"50% 50%",delete J.transformOrigin),Y.transform&&(Y.transformBox=G?.transformBox??"fill-box",delete J.transformBox),p!==void 0&&(J.x=p),g!==void 0&&(J.y=g),w!==void 0&&(J.scale=w),E!==void 0&&mA(J,E,P,j,!1)}const Tb=()=>({...C0(),attrs:{}}),Sb=u=>typeof u=="string"&&u.toLowerCase()==="svg";function gA(u,p,g,w){const E=ee.useMemo(()=>{const P=Tb();return wb(P,p,Sb(w),u.transformTemplate,u.style),{...P.attrs,style:{...P.style}}},[p]);if(u.style){const P={};bb(P,u.style,u),E.style={...P,...E.style}}return E}const yA=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function A0(u){return typeof u!="string"||u.includes("-")?!1:!!(yA.indexOf(u)>-1||/[A-Z]/u.test(u))}function _A(u,p,g,{latestValues:w},E,P=!1){const F=(A0(u)?gA:dA)(p,w,E,u),s=nA(p,typeof u=="string",P),U=u!==ee.Fragment?{...s,...F,ref:g}:{},{children:G}=p,J=ee.useMemo(()=>Ps(G)?G.get():G,[G]);return ee.createElement(u,{...U,children:J})}function Jx(u){const p=[{},{}];return u?.values.forEach((g,w)=>{p[0][w]=g.get(),p[1][w]=g.getVelocity()}),p}function M0(u,p,g,w){if(typeof p=="function"){const[E,P]=Jx(w);p=p(g!==void 0?g:u.custom,E,P)}if(typeof p=="string"&&(p=u.variants&&u.variants[p]),typeof p=="function"){const[E,P]=Jx(w);p=p(g!==void 0?g:u.custom,E,P)}return p}function Um(u){return Ps(u)?u.get():u}function xA({scrapeMotionValuesFromProps:u,createRenderState:p},g,w,E){return{latestValues:vA(g,w,E,u),renderState:p()}}function vA(u,p,g,w){const E={},P=w(u,{});for(const Y in P)E[Y]=Um(P[Y]);let{initial:j,animate:F}=u;const s=rg(u),U=xb(u);p&&U&&!s&&u.inherit!==!1&&(j===void 0&&(j=p.initial),F===void 0&&(F=p.animate));let G=g?g.initial===!1:!1;G=G||j===!1;const J=G?F:j;if(J&&typeof J!="boolean"&&!tg(J)){const Y=Array.isArray(J)?J:[J];for(let me=0;me<Y.length;me++){const Ae=M0(u,Y[me]);if(Ae){const{transitionEnd:Ee,transition:Re,...Ue}=Ae;for(const He in Ue){let Me=Ue[He];if(Array.isArray(Me)){const lt=G?Me.length-1:0;Me=Me[lt]}Me!==null&&(E[He]=Me)}for(const He in Ee)E[He]=Ee[He]}}}return E}const Eb=u=>(p,g)=>{const w=ee.useContext(eg),E=ee.useContext(Qm),P=()=>xA(u,p,w,E);return g?P():e0(P)};function P0(u,p,g){const{style:w}=u,E={};for(const P in w)(Ps(w[P])||p.style&&Ps(p.style[P])||vb(P,u)||g?.getValue(P)?.liveStyle!==void 0)&&(E[P]=w[P]);return E}const bA=Eb({scrapeMotionValuesFromProps:P0,createRenderState:C0});function kb(u,p,g){const w=P0(u,p,g);for(const E in u)if(Ps(u[E])||Ps(p[E])){const P=dp.indexOf(E)!==-1?"attr"+E.charAt(0).toUpperCase()+E.substring(1):E;w[P]=u[E]}return w}const wA=Eb({scrapeMotionValuesFromProps:kb,createRenderState:Tb}),TA=Symbol.for("motionComponentSymbol");function Jd(u){return u&&typeof u=="object"&&Object.prototype.hasOwnProperty.call(u,"current")}function SA(u,p,g){return ee.useCallback(w=>{w&&u.onMount&&u.onMount(w),p&&(w?p.mount(w):p.unmount()),g&&(typeof g=="function"?g(w):Jd(g)&&(g.current=w))},[p])}const I0=u=>u.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),EA="framerAppearId",Cb="data-"+I0(EA),Ab=ee.createContext({});function kA(u,p,g,w,E){const{visualElement:P}=ee.useContext(eg),j=ee.useContext(yb),F=ee.useContext(Qm),s=ee.useContext(T0).reducedMotion,U=ee.useRef(null);w=w||j.renderer,!U.current&&w&&(U.current=w(u,{visualState:p,parent:P,props:g,presenceContext:F,blockInitialAnimation:F?F.initial===!1:!1,reducedMotionConfig:s}));const G=U.current,J=ee.useContext(Ab);G&&!G.projection&&E&&(G.type==="html"||G.type==="svg")&&CA(U.current,g,E,J);const Y=ee.useRef(!1);ee.useInsertionEffect(()=>{G&&Y.current&&G.update(g,F)});const me=g[Cb],Ae=ee.useRef(!!me&&!window.MotionHandoffIsComplete?.(me)&&window.MotionHasOptimisedAnimation?.(me));return E1(()=>{G&&(Y.current=!0,window.MotionIsMounted=!0,G.updateFeatures(),G.scheduleRenderMicrotask(),Ae.current&&G.animationState&&G.animationState.animateChanges())}),ee.useEffect(()=>{G&&(!Ae.current&&G.animationState&&G.animationState.animateChanges(),Ae.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(me)}),Ae.current=!1),G.enteringChildren=void 0)}),G}function CA(u,p,g,w){const{layoutId:E,layout:P,drag:j,dragConstraints:F,layoutScroll:s,layoutRoot:U,layoutCrossfade:G}=p;u.projection=new g(u.latestValues,p["data-framer-portal-id"]?void 0:Mb(u.parent)),u.projection.setOptions({layoutId:E,layout:P,alwaysMeasureLayout:!!j||F&&Jd(F),visualElement:u,animationType:typeof P=="string"?P:"both",initialPromotionConfig:w,crossfade:G,layoutScroll:s,layoutRoot:U})}function Mb(u){if(u)return u.options.allowProjection!==!1?u.projection:Mb(u.parent)}function oy(u,{forwardMotionProps:p=!1}={},g,w){g&&eA(g);const E=A0(u)?wA:bA;function P(F,s){let U;const G={...ee.useContext(T0),...F,layoutId:AA(F)},{isStatic:J}=G,Y=sA(F),me=E(F,J);if(!J&&t0){MA();const Ae=PA(G);U=Ae.MeasureLayout,Y.visualElement=kA(u,me,G,w,Ae.ProjectionNode)}return v.jsxs(eg.Provider,{value:Y,children:[U&&Y.visualElement?v.jsx(U,{visualElement:Y.visualElement,...G}):null,_A(u,F,SA(me,Y.visualElement,s),me,J,p)]})}P.displayName=`motion.${typeof u=="string"?u:`create(${u.displayName??u.name??""})`}`;const j=ee.forwardRef(P);return j[TA]=u,j}function AA({layoutId:u}){const p=ee.useContext(Qy).id;return p&&u!==void 0?p+"-"+u:u}function MA(u,p){ee.useContext(yb).strict}function PA(u){const{drag:p,layout:g}=lp;if(!p&&!g)return{};const w={...p,...g};return{MeasureLayout:p?.isEnabled(u)||g?.isEnabled(u)?w.MeasureLayout:void 0,ProjectionNode:w.ProjectionNode}}function IA(u,p){if(typeof Proxy>"u")return oy;const g=new Map,w=(P,j)=>oy(P,j,u,p),E=(P,j)=>w(P,j);return new Proxy(E,{get:(P,j)=>j==="create"?w:(g.has(j)||g.set(j,oy(j,void 0,u,p)),g.get(j))})}function Pb({top:u,left:p,right:g,bottom:w}){return{x:{min:p,max:g},y:{min:u,max:w}}}function DA({x:u,y:p}){return{top:p.min,right:u.max,bottom:p.max,left:u.min}}function LA(u,p){if(!p)return u;const g=p({x:u.left,y:u.top}),w=p({x:u.right,y:u.bottom});return{top:g.y,left:g.x,bottom:w.y,right:w.x}}function ay(u){return u===void 0||u===1}function zy({scale:u,scaleX:p,scaleY:g}){return!ay(u)||!ay(p)||!ay(g)}function Wh(u){return zy(u)||Ib(u)||u.z||u.rotate||u.rotateX||u.rotateY||u.skewX||u.skewY}function Ib(u){return Qx(u.x)||Qx(u.y)}function Qx(u){return u&&u!=="0%"}function Xm(u,p,g){const w=u-g,E=p*w;return g+E}function ev(u,p,g,w,E){return E!==void 0&&(u=Xm(u,E,w)),Xm(u,g,w)+p}function Ny(u,p=0,g=1,w,E){u.min=ev(u.min,p,g,w,E),u.max=ev(u.max,p,g,w,E)}function Db(u,{x:p,y:g}){Ny(u.x,p.translate,p.scale,p.originPoint),Ny(u.y,g.translate,g.scale,g.originPoint)}const tv=.999999999999,rv=1.0000000000001;function jA(u,p,g,w=!1){const E=g.length;if(!E)return;p.x=p.y=1;let P,j;for(let F=0;F<E;F++){P=g[F],j=P.projectionDelta;const{visualElement:s}=P.options;s&&s.props.style&&s.props.style.display==="contents"||(w&&P.options.layoutScroll&&P.scroll&&P!==P.root&&ep(u,{x:-P.scroll.offset.x,y:-P.scroll.offset.y}),j&&(p.x*=j.x.scale,p.y*=j.y.scale,Db(u,j)),w&&Wh(P.latestValues)&&ep(u,P.latestValues))}p.x<rv&&p.x>tv&&(p.x=1),p.y<rv&&p.y>tv&&(p.y=1)}function Qd(u,p){u.min=u.min+p,u.max=u.max+p}function nv(u,p,g,w,E=.5){const P=ei(u.min,u.max,E);Ny(u,p,g,P,w)}function ep(u,p){nv(u.x,p.x,p.scaleX,p.scale,p.originX),nv(u.y,p.y,p.scaleY,p.scale,p.originY)}function Lb(u,p){return Pb(LA(u.getBoundingClientRect(),p))}function RA(u,p,g){const w=Lb(u,g),{scroll:E}=p;return E&&(Qd(w.x,E.offset.x),Qd(w.y,E.offset.y)),w}const iv=()=>({translate:0,scale:1,origin:0,originPoint:0}),tp=()=>({x:iv(),y:iv()}),sv=()=>({min:0,max:0}),gi=()=>({x:sv(),y:sv()}),By={current:null},jb={current:!1};function zA(){if(jb.current=!0,!!t0)if(window.matchMedia){const u=window.matchMedia("(prefers-reduced-motion)"),p=()=>By.current=u.matches;u.addEventListener("change",p),p()}else By.current=!1}const NA=new WeakMap;function BA(u,p,g){for(const w in p){const E=p[w],P=g[w];if(Ps(E))u.addValue(w,E);else if(Ps(P))u.addValue(w,ap(E,{owner:u}));else if(P!==E)if(u.hasValue(w)){const j=u.getValue(w);j.liveStyle===!0?j.jump(E):j.hasAnimated||j.set(E)}else{const j=u.getStaticValue(w);u.addValue(w,ap(j!==void 0?j:E,{owner:u}))}}for(const w in g)p[w]===void 0&&u.removeValue(w);return p}const ov=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class FA{scrapeMotionValuesFromProps(p,g,w){return{}}constructor({parent:p,props:g,presenceContext:w,reducedMotionConfig:E,blockInitialAnimation:P,visualState:j},F={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=_0,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const Y=po.now();this.renderScheduledAt<Y&&(this.renderScheduledAt=Y,qn.render(this.render,!1,!0))};const{latestValues:s,renderState:U}=j;this.latestValues=s,this.baseTarget={...s},this.initialValues=g.initial?{...s}:{},this.renderState=U,this.parent=p,this.props=g,this.presenceContext=w,this.depth=p?p.depth+1:0,this.reducedMotionConfig=E,this.options=F,this.blockInitialAnimation=!!P,this.isControllingVariants=rg(g),this.isVariantNode=xb(g),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(p&&p.current);const{willChange:G,...J}=this.scrapeMotionValuesFromProps(g,{},this);for(const Y in J){const me=J[Y];s[Y]!==void 0&&Ps(me)&&me.set(s[Y])}}mount(p){this.current=p,NA.set(p,this),this.projection&&!this.projection.instance&&this.projection.mount(p),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((g,w)=>this.bindToMotionValue(w,g)),jb.current||zA(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:By.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Ru(this.notifyUpdate),Ru(this.render),this.valueSubscriptions.forEach(p=>p()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const p in this.events)this.events[p].clear();for(const p in this.features){const g=this.features[p];g&&(g.unmount(),g.isMounted=!1)}this.current=null}addChild(p){this.children.add(p),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(p)}removeChild(p){this.children.delete(p),this.enteringChildren&&this.enteringChildren.delete(p)}bindToMotionValue(p,g){this.valueSubscriptions.has(p)&&this.valueSubscriptions.get(p)();const w=pp.has(p);w&&this.onBindTransform&&this.onBindTransform();const E=g.on("change",j=>{this.latestValues[p]=j,this.props.onUpdate&&qn.preRender(this.notifyUpdate),w&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let P;window.MotionCheckAppearSync&&(P=window.MotionCheckAppearSync(this,p,g)),this.valueSubscriptions.set(p,()=>{E(),P&&P(),g.owner&&g.stop()})}sortNodePosition(p){return!this.current||!this.sortInstanceNodePosition||this.type!==p.type?0:this.sortInstanceNodePosition(this.current,p.current)}updateFeatures(){let p="animation";for(p in lp){const g=lp[p];if(!g)continue;const{isEnabled:w,Feature:E}=g;if(!this.features[p]&&E&&w(this.props)&&(this.features[p]=new E(this)),this.features[p]){const P=this.features[p];P.isMounted?P.update():(P.mount(),P.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):gi()}getStaticValue(p){return this.latestValues[p]}setStaticValue(p,g){this.latestValues[p]=g}update(p,g){(p.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=p,this.prevPresenceContext=this.presenceContext,this.presenceContext=g;for(let w=0;w<ov.length;w++){const E=ov[w];this.propEventSubscriptions[E]&&(this.propEventSubscriptions[E](),delete this.propEventSubscriptions[E]);const P="on"+E,j=p[P];j&&(this.propEventSubscriptions[E]=this.on(E,j))}this.prevMotionValues=BA(this,this.scrapeMotionValuesFromProps(p,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(p){return this.props.variants?this.props.variants[p]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(p){const g=this.getClosestVariantNode();if(g)return g.variantChildren&&g.variantChildren.add(p),()=>g.variantChildren.delete(p)}addValue(p,g){const w=this.values.get(p);g!==w&&(w&&this.removeValue(p),this.bindToMotionValue(p,g),this.values.set(p,g),this.latestValues[p]=g.get())}removeValue(p){this.values.delete(p);const g=this.valueSubscriptions.get(p);g&&(g(),this.valueSubscriptions.delete(p)),delete this.latestValues[p],this.removeValueFromRenderState(p,this.renderState)}hasValue(p){return this.values.has(p)}getValue(p,g){if(this.props.values&&this.props.values[p])return this.props.values[p];let w=this.values.get(p);return w===void 0&&g!==void 0&&(w=ap(g===null?void 0:g,{owner:this}),this.addValue(p,w)),w}readValue(p,g){let w=this.latestValues[p]!==void 0||!this.current?this.latestValues[p]:this.getBaseTargetFromProps(this.props,p)??this.readValueFromInstance(this.current,p,this.options);return w!=null&&(typeof w=="string"&&(k1(w)||A1(w))?w=parseFloat(w):!XC(w)&&zu.test(g)&&(w=cb(p,g)),this.setBaseTarget(p,Ps(w)?w.get():w)),Ps(w)?w.get():w}setBaseTarget(p,g){this.baseTarget[p]=g}getBaseTarget(p){const{initial:g}=this.props;let w;if(typeof g=="string"||typeof g=="object"){const P=M0(this.props,g,this.presenceContext?.custom);P&&(w=P[p])}if(g&&w!==void 0)return w;const E=this.getBaseTargetFromProps(this.props,p);return E!==void 0&&!Ps(E)?E:this.initialValues[p]!==void 0&&w===void 0?void 0:this.baseTarget[p]}on(p,g){return this.events[p]||(this.events[p]=new o0),this.events[p].add(g)}notify(p,...g){this.events[p]&&this.events[p].notify(...g)}scheduleRenderMicrotask(){b0.render(this.render)}}class Rb extends FA{constructor(){super(...arguments),this.KeyframeResolver=NC}sortInstanceNodePosition(p,g){return p.compareDocumentPosition(g)&2?1:-1}getBaseTargetFromProps(p,g){return p.style?p.style[g]:void 0}removeValueFromRenderState(p,{vars:g,style:w}){delete g[p],delete w[p]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:p}=this.props;Ps(p)&&(this.childSubscription=p.on("change",g=>{this.current&&(this.current.textContent=`${g}`)}))}}function zb(u,{style:p,vars:g},w,E){const P=u.style;let j;for(j in p)P[j]=p[j];E?.applyProjectionStyles(P,w);for(j in g)P.setProperty(j,g[j])}function OA(u){return window.getComputedStyle(u)}class UA extends Rb{constructor(){super(...arguments),this.type="html",this.renderInstance=zb}readValueFromInstance(p,g){if(pp.has(g))return this.projection?.isProjecting?My(g):rC(p,g);{const w=OA(p),E=(c0(g)?w.getPropertyValue(g):w[g])||0;return typeof E=="string"?E.trim():E}}measureInstanceViewportBox(p,{transformPagePoint:g}){return Lb(p,g)}build(p,g,w){k0(p,g,w.transformTemplate)}scrapeMotionValuesFromProps(p,g,w){return P0(p,g,w)}}const Nb=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function VA(u,p,g,w){zb(u,p,void 0,w);for(const E in p.attrs)u.setAttribute(Nb.has(E)?E:I0(E),p.attrs[E])}class $A extends Rb{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=gi}getBaseTargetFromProps(p,g){return p[g]}readValueFromInstance(p,g){if(pp.has(g)){const w=lb(g);return w&&w.default||0}return g=Nb.has(g)?g:I0(g),p.getAttribute(g)}scrapeMotionValuesFromProps(p,g,w){return kb(p,g,w)}build(p,g,w){wb(p,g,this.isSVGTag,w.transformTemplate,w.style)}renderInstance(p,g,w,E){VA(p,g,w,E)}mount(p){this.isSVGTag=Sb(p.tagName),super.mount(p)}}const GA=(u,p)=>A0(u)?new $A(p):new UA(p,{allowProjection:u!==ee.Fragment});function np(u,p,g){const w=u.getProps();return M0(w,p,g!==void 0?g:w.custom,u)}const Fy=u=>Array.isArray(u);function WA(u,p,g){u.hasValue(p)?u.getValue(p).set(g):u.addValue(p,ap(g))}function qA(u){return Fy(u)?u[u.length-1]||0:u}function ZA(u,p){const g=np(u,p);let{transitionEnd:w={},transition:E={},...P}=g||{};P={...P,...w};for(const j in P){const F=qA(P[j]);WA(u,j,F)}}function HA(u){return!!(Ps(u)&&u.add)}function Oy(u,p){const g=u.getValue("willChange");if(HA(g))return g.add(p);if(!g&&Oc.WillChange){const w=new Oc.WillChange("auto");u.addValue("willChange",w),w.add(p)}}function Bb(u){return u.props[Cb]}const XA=u=>u!==null;function KA(u,{repeat:p,repeatType:g="loop"},w){const E=u.filter(XA),P=p&&g!=="loop"&&p%2===1?0:E.length-1;return E[P]}const YA={type:"spring",stiffness:500,damping:25,restSpeed:10},JA=u=>({type:"spring",stiffness:550,damping:u===0?2*Math.sqrt(550):30,restSpeed:10}),QA={type:"keyframes",duration:.8},eM={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},tM=(u,{keyframes:p})=>p.length>2?QA:pp.has(u)?u.startsWith("scale")?JA(p[1]):YA:eM;function rM({when:u,delay:p,delayChildren:g,staggerChildren:w,staggerDirection:E,repeat:P,repeatType:j,repeatDelay:F,from:s,elapsed:U,...G}){return!!Object.keys(G).length}const D0=(u,p,g,w={},E,P)=>j=>{const F=x0(w,u)||{},s=F.delay||w.delay||0;let{elapsed:U=0}=w;U=U-$l(s);const G={keyframes:Array.isArray(g)?g:[null,g],ease:"easeOut",velocity:p.getVelocity(),...F,delay:-U,onUpdate:Y=>{p.set(Y),F.onUpdate&&F.onUpdate(Y)},onComplete:()=>{j(),F.onComplete&&F.onComplete()},name:u,motionValue:p,element:P?void 0:E};rM(F)||Object.assign(G,tM(u,G)),G.duration&&(G.duration=$l(G.duration)),G.repeatDelay&&(G.repeatDelay=$l(G.repeatDelay)),G.from!==void 0&&(G.keyframes[0]=G.from);let J=!1;if((G.type===!1||G.duration===0&&!G.repeatDelay)&&(jy(G),G.delay===0&&(J=!0)),(Oc.instantAnimations||Oc.skipAnimations)&&(J=!0,jy(G),G.delay=0),G.allowFlatten=!F.type&&!F.ease,J&&!P&&p.get()!==void 0){const Y=KA(G.keyframes,F);if(Y!==void 0){qn.update(()=>{G.onUpdate(Y),G.onComplete()});return}}return F.isSync?new y0(G):new EC(G)};function nM({protectedKeys:u,needsAnimating:p},g){const w=u.hasOwnProperty(g)&&p[g]!==!0;return p[g]=!1,w}function Fb(u,p,{delay:g=0,transitionOverride:w,type:E}={}){let{transition:P=u.getDefaultTransition(),transitionEnd:j,...F}=p;w&&(P=w);const s=[],U=E&&u.animationState&&u.animationState.getState()[E];for(const G in F){const J=u.getValue(G,u.latestValues[G]??null),Y=F[G];if(Y===void 0||U&&nM(U,G))continue;const me={delay:g,...x0(P||{},G)},Ae=J.get();if(Ae!==void 0&&!J.isAnimating&&!Array.isArray(Y)&&Y===Ae&&!me.velocity)continue;let Ee=!1;if(window.MotionHandoffAnimation){const Ue=Bb(u);if(Ue){const He=window.MotionHandoffAnimation(Ue,G,qn);He!==null&&(me.startTime=He,Ee=!0)}}Oy(u,G),J.start(D0(G,J,Y,u.shouldReduceMotion&&sb.has(G)?{type:!1}:me,u,Ee));const Re=J.animation;Re&&s.push(Re)}return j&&Promise.all(s).then(()=>{qn.update(()=>{j&&ZA(u,j)})}),s}function Ob(u,p,g,w=0,E=1){const P=Array.from(u).sort((U,G)=>U.sortNodePosition(G)).indexOf(p),j=u.size,F=(j-1)*w;return typeof g=="function"?g(P,j):E===1?P*w:F-P*w}function Uy(u,p,g={}){const w=np(u,p,g.type==="exit"?u.presenceContext?.custom:void 0);let{transition:E=u.getDefaultTransition()||{}}=w||{};g.transitionOverride&&(E=g.transitionOverride);const P=w?()=>Promise.all(Fb(u,w,g)):()=>Promise.resolve(),j=u.variantChildren&&u.variantChildren.size?(s=0)=>{const{delayChildren:U=0,staggerChildren:G,staggerDirection:J}=E;return iM(u,p,s,U,G,J,g)}:()=>Promise.resolve(),{when:F}=E;if(F){const[s,U]=F==="beforeChildren"?[P,j]:[j,P];return s().then(()=>U())}else return Promise.all([P(),j(g.delay)])}function iM(u,p,g=0,w=0,E=0,P=1,j){const F=[];for(const s of u.variantChildren)s.notify("AnimationStart",p),F.push(Uy(s,p,{...j,delay:g+(typeof w=="function"?0:w)+Ob(u.variantChildren,s,w,E,P)}).then(()=>s.notify("AnimationComplete",p)));return Promise.all(F)}function sM(u,p,g={}){u.notify("AnimationStart",p);let w;if(Array.isArray(p)){const E=p.map(P=>Uy(u,P,g));w=Promise.all(E)}else if(typeof p=="string")w=Uy(u,p,g);else{const E=typeof p=="function"?np(u,p,g.custom):p;w=Promise.all(Fb(u,E,g))}return w.then(()=>{u.notify("AnimationComplete",p)})}function Ub(u,p){if(!Array.isArray(p))return!1;const g=p.length;if(g!==u.length)return!1;for(let w=0;w<g;w++)if(p[w]!==u[w])return!1;return!0}const oM=E0.length;function Vb(u){if(!u)return;if(!u.isControllingVariants){const g=u.parent?Vb(u.parent)||{}:{};return u.props.initial!==void 0&&(g.initial=u.props.initial),g}const p={};for(let g=0;g<oM;g++){const w=E0[g],E=u.props[w];(Mf(E)||E===!1)&&(p[w]=E)}return p}const aM=[...S0].reverse(),lM=S0.length;function cM(u){return p=>Promise.all(p.map(({animation:g,options:w})=>sM(u,g,w)))}function uM(u){let p=cM(u),g=av(),w=!0;const E=s=>(U,G)=>{const J=np(u,G,s==="exit"?u.presenceContext?.custom:void 0);if(J){const{transition:Y,transitionEnd:me,...Ae}=J;U={...U,...Ae,...me}}return U};function P(s){p=s(u)}function j(s){const{props:U}=u,G=Vb(u.parent)||{},J=[],Y=new Set;let me={},Ae=1/0;for(let Re=0;Re<lM;Re++){const Ue=aM[Re],He=g[Ue],Me=U[Ue]!==void 0?U[Ue]:G[Ue],lt=Mf(Me),kt=Ue===s?He.isActive:null;kt===!1&&(Ae=Re);let $e=Me===G[Ue]&&Me!==U[Ue]&&lt;if($e&&w&&u.manuallyAnimateOnMount&&($e=!1),He.protectedKeys={...me},!He.isActive&&kt===null||!Me&&!He.prevProp||tg(Me)||typeof Me=="boolean")continue;const Ye=hM(He.prevProp,Me);let tt=Ye||Ue===s&&He.isActive&&!$e&&lt||Re>Ae&&lt,it=!1;const De=Array.isArray(Me)?Me:[Me];let $t=De.reduce(E(Ue),{});kt===!1&&($t={});const{prevResolvedValues:ut={}}=He,vt={...ut,...$t},nr=cr=>{tt=!0,Y.has(cr)&&(it=!0,Y.delete(cr)),He.needsAnimating[cr]=!0;const St=u.getValue(cr);St&&(St.liveStyle=!1)};for(const cr in vt){const St=$t[cr],Fe=ut[cr];if(me.hasOwnProperty(cr))continue;let _t=!1;Fy(St)&&Fy(Fe)?_t=!Ub(St,Fe):_t=St!==Fe,_t?St!=null?nr(cr):Y.add(cr):St!==void 0&&Y.has(cr)?nr(cr):He.protectedKeys[cr]=!0}He.prevProp=Me,He.prevResolvedValues=$t,He.isActive&&(me={...me,...$t}),w&&u.blockInitialAnimation&&(tt=!1);const Jr=$e&&Ye;tt&&(!Jr||it)&&J.push(...De.map(cr=>{const St={type:Ue};if(typeof cr=="string"&&w&&!Jr&&u.manuallyAnimateOnMount&&u.parent){const{parent:Fe}=u,_t=np(Fe,cr);if(Fe.enteringChildren&&_t){const{delayChildren:Te}=_t.transition||{};St.delay=Ob(Fe.enteringChildren,u,Te)}}return{animation:cr,options:St}}))}if(Y.size){const Re={};if(typeof U.initial!="boolean"){const Ue=np(u,Array.isArray(U.initial)?U.initial[0]:U.initial);Ue&&Ue.transition&&(Re.transition=Ue.transition)}Y.forEach(Ue=>{const He=u.getBaseTarget(Ue),Me=u.getValue(Ue);Me&&(Me.liveStyle=!0),Re[Ue]=He??null}),J.push({animation:Re})}let Ee=!!J.length;return w&&(U.initial===!1||U.initial===U.animate)&&!u.manuallyAnimateOnMount&&(Ee=!1),w=!1,Ee?p(J):Promise.resolve()}function F(s,U){if(g[s].isActive===U)return Promise.resolve();u.variantChildren?.forEach(J=>J.animationState?.setActive(s,U)),g[s].isActive=U;const G=j(s);for(const J in g)g[J].protectedKeys={};return G}return{animateChanges:j,setActive:F,setAnimateFunction:P,getState:()=>g,reset:()=>{g=av(),w=!0}}}function hM(u,p){return typeof p=="string"?p!==u:Array.isArray(p)?!Ub(p,u):!1}function Gh(u=!1){return{isActive:u,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function av(){return{animate:Gh(!0),whileInView:Gh(),whileHover:Gh(),whileTap:Gh(),whileDrag:Gh(),whileFocus:Gh(),exit:Gh()}}class Bu{constructor(p){this.isMounted=!1,this.node=p}update(){}}class dM extends Bu{constructor(p){super(p),p.animationState||(p.animationState=uM(p))}updateAnimationControlsSubscription(){const{animate:p}=this.node.getProps();tg(p)&&(this.unmountControls=p.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:p}=this.node.getProps(),{animate:g}=this.node.prevProps||{};p!==g&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let pM=0;class fM extends Bu{constructor(){super(...arguments),this.id=pM++}update(){if(!this.node.presenceContext)return;const{isPresent:p,onExitComplete:g}=this.node.presenceContext,{isPresent:w}=this.node.prevPresenceContext||{};if(!this.node.animationState||p===w)return;const E=this.node.animationState.setActive("exit",!p);g&&!p&&E.then(()=>{g(this.id)})}mount(){const{register:p,onExitComplete:g}=this.node.presenceContext||{};g&&g(this.id),p&&(this.unmount=p(this.id))}unmount(){}}const mM={animation:{Feature:dM},exit:{Feature:fM}};function If(u,p,g,w={passive:!0}){return u.addEventListener(p,g,w),()=>u.removeEventListener(p,g)}function Of(u){return{point:{x:u.pageX,y:u.pageY}}}const gM=u=>p=>w0(p)&&u(p,Of(p));function xf(u,p,g,w){return If(u,p,gM(g),w)}const $b=1e-4,yM=1-$b,_M=1+$b,Gb=.01,xM=0-Gb,vM=0+Gb;function Ws(u){return u.max-u.min}function bM(u,p,g){return Math.abs(u-p)<=g}function lv(u,p,g,w=.5){u.origin=w,u.originPoint=ei(p.min,p.max,u.origin),u.scale=Ws(g)/Ws(p),u.translate=ei(g.min,g.max,u.origin)-u.originPoint,(u.scale>=yM&&u.scale<=_M||isNaN(u.scale))&&(u.scale=1),(u.translate>=xM&&u.translate<=vM||isNaN(u.translate))&&(u.translate=0)}function vf(u,p,g,w){lv(u.x,p.x,g.x,w?w.originX:void 0),lv(u.y,p.y,g.y,w?w.originY:void 0)}function cv(u,p,g){u.min=g.min+p.min,u.max=u.min+Ws(p)}function wM(u,p,g){cv(u.x,p.x,g.x),cv(u.y,p.y,g.y)}function uv(u,p,g){u.min=p.min-g.min,u.max=u.min+Ws(p)}function bf(u,p,g){uv(u.x,p.x,g.x),uv(u.y,p.y,g.y)}function ma(u){return[u("x"),u("y")]}const Wb=({current:u})=>u?u.ownerDocument.defaultView:null,hv=(u,p)=>Math.abs(u-p);function TM(u,p){const g=hv(u.x,p.x),w=hv(u.y,p.y);return Math.sqrt(g**2+w**2)}class qb{constructor(p,g,{transformPagePoint:w,contextWindow:E=window,dragSnapToOrigin:P=!1,distanceThreshold:j=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Y=cy(this.lastMoveEventInfo,this.history),me=this.startEvent!==null,Ae=TM(Y.offset,{x:0,y:0})>=this.distanceThreshold;if(!me&&!Ae)return;const{point:Ee}=Y,{timestamp:Re}=cs;this.history.push({...Ee,timestamp:Re});const{onStart:Ue,onMove:He}=this.handlers;me||(Ue&&Ue(this.lastMoveEvent,Y),this.startEvent=this.lastMoveEvent),He&&He(this.lastMoveEvent,Y)},this.handlePointerMove=(Y,me)=>{this.lastMoveEvent=Y,this.lastMoveEventInfo=ly(me,this.transformPagePoint),qn.update(this.updatePoint,!0)},this.handlePointerUp=(Y,me)=>{this.end();const{onEnd:Ae,onSessionEnd:Ee,resumeAnimation:Re}=this.handlers;if(this.dragSnapToOrigin&&Re&&Re(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Ue=cy(Y.type==="pointercancel"?this.lastMoveEventInfo:ly(me,this.transformPagePoint),this.history);this.startEvent&&Ae&&Ae(Y,Ue),Ee&&Ee(Y,Ue)},!w0(p))return;this.dragSnapToOrigin=P,this.handlers=g,this.transformPagePoint=w,this.distanceThreshold=j,this.contextWindow=E||window;const F=Of(p),s=ly(F,this.transformPagePoint),{point:U}=s,{timestamp:G}=cs;this.history=[{...U,timestamp:G}];const{onSessionStart:J}=g;J&&J(p,cy(s,this.history)),this.removeListeners=Nf(xf(this.contextWindow,"pointermove",this.handlePointerMove),xf(this.contextWindow,"pointerup",this.handlePointerUp),xf(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(p){this.handlers=p}end(){this.removeListeners&&this.removeListeners(),Ru(this.updatePoint)}}function ly(u,p){return p?{point:p(u.point)}:u}function dv(u,p){return{x:u.x-p.x,y:u.y-p.y}}function cy({point:u},p){return{point:u,delta:dv(u,Zb(p)),offset:dv(u,SM(p)),velocity:EM(p,.1)}}function SM(u){return u[0]}function Zb(u){return u[u.length-1]}function EM(u,p){if(u.length<2)return{x:0,y:0};let g=u.length-1,w=null;const E=Zb(u);for(;g>=0&&(w=u[g],!(E.timestamp-w.timestamp>$l(p)));)g--;if(!w)return{x:0,y:0};const P=Gl(E.timestamp-w.timestamp);if(P===0)return{x:0,y:0};const j={x:(E.x-w.x)/P,y:(E.y-w.y)/P};return j.x===1/0&&(j.x=0),j.y===1/0&&(j.y=0),j}function kM(u,{min:p,max:g},w){return p!==void 0&&u<p?u=w?ei(p,u,w.min):Math.max(u,p):g!==void 0&&u>g&&(u=w?ei(g,u,w.max):Math.min(u,g)),u}function pv(u,p,g){return{min:p!==void 0?u.min+p:void 0,max:g!==void 0?u.max+g-(u.max-u.min):void 0}}function CM(u,{top:p,left:g,bottom:w,right:E}){return{x:pv(u.x,g,E),y:pv(u.y,p,w)}}function fv(u,p){let g=p.min-u.min,w=p.max-u.max;return p.max-p.min<u.max-u.min&&([g,w]=[w,g]),{min:g,max:w}}function AM(u,p){return{x:fv(u.x,p.x),y:fv(u.y,p.y)}}function MM(u,p){let g=.5;const w=Ws(u),E=Ws(p);return E>w?g=kf(p.min,p.max-w,u.min):w>E&&(g=kf(u.min,u.max-E,p.min)),Fc(0,1,g)}function PM(u,p){const g={};return p.min!==void 0&&(g.min=p.min-u.min),p.max!==void 0&&(g.max=p.max-u.min),g}const Vy=.35;function IM(u=Vy){return u===!1?u=0:u===!0&&(u=Vy),{x:mv(u,"left","right"),y:mv(u,"top","bottom")}}function mv(u,p,g){return{min:gv(u,p),max:gv(u,g)}}function gv(u,p){return typeof u=="number"?u:u[p]||0}const DM=new WeakMap;class LM{constructor(p){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=gi(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=p}start(p,{snapToCursor:g=!1,distanceThreshold:w}={}){const{presenceContext:E}=this.visualElement;if(E&&E.isPresent===!1)return;const P=J=>{const{dragSnapToOrigin:Y}=this.getProps();Y?this.pauseAnimation():this.stopAnimation(),g&&this.snapToCursor(Of(J).point)},j=(J,Y)=>{const{drag:me,dragPropagation:Ae,onDragStart:Ee}=this.getProps();if(me&&!Ae&&(this.openDragLock&&this.openDragLock(),this.openDragLock=UC(me),!this.openDragLock))return;this.latestPointerEvent=J,this.latestPanInfo=Y,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ma(Ue=>{let He=this.getAxisMotionValue(Ue).get()||0;if(Wl.test(He)){const{projection:Me}=this.visualElement;if(Me&&Me.layout){const lt=Me.layout.layoutBox[Ue];lt&&(He=Ws(lt)*(parseFloat(He)/100))}}this.originPoint[Ue]=He}),Ee&&qn.postRender(()=>Ee(J,Y)),Oy(this.visualElement,"transform");const{animationState:Re}=this.visualElement;Re&&Re.setActive("whileDrag",!0)},F=(J,Y)=>{this.latestPointerEvent=J,this.latestPanInfo=Y;const{dragPropagation:me,dragDirectionLock:Ae,onDirectionLock:Ee,onDrag:Re}=this.getProps();if(!me&&!this.openDragLock)return;const{offset:Ue}=Y;if(Ae&&this.currentDirection===null){this.currentDirection=jM(Ue),this.currentDirection!==null&&Ee&&Ee(this.currentDirection);return}this.updateAxis("x",Y.point,Ue),this.updateAxis("y",Y.point,Ue),this.visualElement.render(),Re&&Re(J,Y)},s=(J,Y)=>{this.latestPointerEvent=J,this.latestPanInfo=Y,this.stop(J,Y),this.latestPointerEvent=null,this.latestPanInfo=null},U=()=>ma(J=>this.getAnimationState(J)==="paused"&&this.getAxisMotionValue(J).animation?.play()),{dragSnapToOrigin:G}=this.getProps();this.panSession=new qb(p,{onSessionStart:P,onStart:j,onMove:F,onSessionEnd:s,resumeAnimation:U},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:G,distanceThreshold:w,contextWindow:Wb(this.visualElement)})}stop(p,g){const w=p||this.latestPointerEvent,E=g||this.latestPanInfo,P=this.isDragging;if(this.cancel(),!P||!E||!w)return;const{velocity:j}=E;this.startAnimation(j);const{onDragEnd:F}=this.getProps();F&&qn.postRender(()=>F(w,E))}cancel(){this.isDragging=!1;const{projection:p,animationState:g}=this.visualElement;p&&(p.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:w}=this.getProps();!w&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),g&&g.setActive("whileDrag",!1)}updateAxis(p,g,w){const{drag:E}=this.getProps();if(!w||!Lm(p,E,this.currentDirection))return;const P=this.getAxisMotionValue(p);let j=this.originPoint[p]+w[p];this.constraints&&this.constraints[p]&&(j=kM(j,this.constraints[p],this.elastic[p])),P.set(j)}resolveConstraints(){const{dragConstraints:p,dragElastic:g}=this.getProps(),w=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,E=this.constraints;p&&Jd(p)?this.constraints||(this.constraints=this.resolveRefConstraints()):p&&w?this.constraints=CM(w.layoutBox,p):this.constraints=!1,this.elastic=IM(g),E!==this.constraints&&w&&this.constraints&&!this.hasMutatedConstraints&&ma(P=>{this.constraints!==!1&&this.getAxisMotionValue(P)&&(this.constraints[P]=PM(w.layoutBox[P],this.constraints[P]))})}resolveRefConstraints(){const{dragConstraints:p,onMeasureDragConstraints:g}=this.getProps();if(!p||!Jd(p))return!1;const w=p.current,{projection:E}=this.visualElement;if(!E||!E.layout)return!1;const P=RA(w,E.root,this.visualElement.getTransformPagePoint());let j=AM(E.layout.layoutBox,P);if(g){const F=g(DA(j));this.hasMutatedConstraints=!!F,F&&(j=Pb(F))}return j}startAnimation(p){const{drag:g,dragMomentum:w,dragElastic:E,dragTransition:P,dragSnapToOrigin:j,onDragTransitionEnd:F}=this.getProps(),s=this.constraints||{},U=ma(G=>{if(!Lm(G,g,this.currentDirection))return;let J=s&&s[G]||{};j&&(J={min:0,max:0});const Y=E?200:1e6,me=E?40:1e7,Ae={type:"inertia",velocity:w?p[G]:0,bounceStiffness:Y,bounceDamping:me,timeConstant:750,restDelta:1,restSpeed:10,...P,...J};return this.startAxisValueAnimation(G,Ae)});return Promise.all(U).then(F)}startAxisValueAnimation(p,g){const w=this.getAxisMotionValue(p);return Oy(this.visualElement,p),w.start(D0(p,w,0,g,this.visualElement,!1))}stopAnimation(){ma(p=>this.getAxisMotionValue(p).stop())}pauseAnimation(){ma(p=>this.getAxisMotionValue(p).animation?.pause())}getAnimationState(p){return this.getAxisMotionValue(p).animation?.state}getAxisMotionValue(p){const g=`_drag${p.toUpperCase()}`,w=this.visualElement.getProps(),E=w[g];return E||this.visualElement.getValue(p,(w.initial?w.initial[p]:void 0)||0)}snapToCursor(p){ma(g=>{const{drag:w}=this.getProps();if(!Lm(g,w,this.currentDirection))return;const{projection:E}=this.visualElement,P=this.getAxisMotionValue(g);if(E&&E.layout){const{min:j,max:F}=E.layout.layoutBox[g];P.set(p[g]-ei(j,F,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:p,dragConstraints:g}=this.getProps(),{projection:w}=this.visualElement;if(!Jd(g)||!w||!this.constraints)return;this.stopAnimation();const E={x:0,y:0};ma(j=>{const F=this.getAxisMotionValue(j);if(F&&this.constraints!==!1){const s=F.get();E[j]=MM({min:s,max:s},this.constraints[j])}});const{transformTemplate:P}=this.visualElement.getProps();this.visualElement.current.style.transform=P?P({},""):"none",w.root&&w.root.updateScroll(),w.updateLayout(),this.resolveConstraints(),ma(j=>{if(!Lm(j,p,null))return;const F=this.getAxisMotionValue(j),{min:s,max:U}=this.constraints[j];F.set(ei(s,U,E[j]))})}addListeners(){if(!this.visualElement.current)return;DM.set(this.visualElement,this);const p=this.visualElement.current,g=xf(p,"pointerdown",s=>{const{drag:U,dragListener:G=!0}=this.getProps();U&&G&&this.start(s)}),w=()=>{const{dragConstraints:s}=this.getProps();Jd(s)&&s.current&&(this.constraints=this.resolveRefConstraints())},{projection:E}=this.visualElement,P=E.addEventListener("measure",w);E&&!E.layout&&(E.root&&E.root.updateScroll(),E.updateLayout()),qn.read(w);const j=If(window,"resize",()=>this.scalePositionWithinConstraints()),F=E.addEventListener("didUpdate",(({delta:s,hasLayoutChanged:U})=>{this.isDragging&&U&&(ma(G=>{const J=this.getAxisMotionValue(G);J&&(this.originPoint[G]+=s[G].translate,J.set(J.get()+s[G].translate))}),this.visualElement.render())}));return()=>{j(),g(),P(),F&&F()}}getProps(){const p=this.visualElement.getProps(),{drag:g=!1,dragDirectionLock:w=!1,dragPropagation:E=!1,dragConstraints:P=!1,dragElastic:j=Vy,dragMomentum:F=!0}=p;return{...p,drag:g,dragDirectionLock:w,dragPropagation:E,dragConstraints:P,dragElastic:j,dragMomentum:F}}}function Lm(u,p,g){return(p===!0||p===u)&&(g===null||g===u)}function jM(u,p=10){let g=null;return Math.abs(u.y)>p?g="y":Math.abs(u.x)>p&&(g="x"),g}class RM extends Bu{constructor(p){super(p),this.removeGroupControls=ga,this.removeListeners=ga,this.controls=new LM(p)}mount(){const{dragControls:p}=this.node.getProps();p&&(this.removeGroupControls=p.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ga}unmount(){this.removeGroupControls(),this.removeListeners()}}const yv=u=>(p,g)=>{u&&qn.postRender(()=>u(p,g))};class zM extends Bu{constructor(){super(...arguments),this.removePointerDownListener=ga}onPointerDown(p){this.session=new qb(p,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Wb(this.node)})}createPanHandlers(){const{onPanSessionStart:p,onPanStart:g,onPan:w,onPanEnd:E}=this.node.getProps();return{onSessionStart:yv(p),onStart:yv(g),onMove:w,onEnd:(P,j)=>{delete this.session,E&&qn.postRender(()=>E(P,j))}}}mount(){this.removePointerDownListener=xf(this.node.current,"pointerdown",p=>this.onPointerDown(p))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Vm={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function _v(u,p){return p.max===p.min?0:u/(p.max-p.min)*100}const mf={correct:(u,p)=>{if(!p.target)return u;if(typeof u=="string")if(Ar.test(u))u=parseFloat(u);else return u;const g=_v(u,p.target.x),w=_v(u,p.target.y);return`${g}% ${w}%`}},NM={correct:(u,{treeScale:p,projectionDelta:g})=>{const w=u,E=zu.parse(u);if(E.length>5)return w;const P=zu.createTransformer(u),j=typeof E[0]!="number"?1:0,F=g.x.scale*p.x,s=g.y.scale*p.y;E[0+j]/=F,E[1+j]/=s;const U=ei(F,s,.5);return typeof E[2+j]=="number"&&(E[2+j]/=U),typeof E[3+j]=="number"&&(E[3+j]/=U),P(E)}};let uy=!1;class BM extends ee.Component{componentDidMount(){const{visualElement:p,layoutGroup:g,switchLayoutGroup:w,layoutId:E}=this.props,{projection:P}=p;oA(FM),P&&(g.group&&g.group.add(P),w&&w.register&&E&&w.register(P),uy&&P.root.didUpdate(),P.addEventListener("animationComplete",()=>{this.safeToRemove()}),P.setOptions({...P.options,onExitComplete:()=>this.safeToRemove()})),Vm.hasEverUpdated=!0}getSnapshotBeforeUpdate(p){const{layoutDependency:g,visualElement:w,drag:E,isPresent:P}=this.props,{projection:j}=w;return j&&(j.isPresent=P,uy=!0,E||p.layoutDependency!==g||g===void 0||p.isPresent!==P?j.willUpdate():this.safeToRemove(),p.isPresent!==P&&(P?j.promote():j.relegate()||qn.postRender(()=>{const F=j.getStack();(!F||!F.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:p}=this.props.visualElement;p&&(p.root.didUpdate(),b0.postRender(()=>{!p.currentAnimation&&p.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:p,layoutGroup:g,switchLayoutGroup:w}=this.props,{projection:E}=p;uy=!0,E&&(E.scheduleCheckAfterUnmount(),g&&g.group&&g.group.remove(E),w&&w.deregister&&w.deregister(E))}safeToRemove(){const{safeToRemove:p}=this.props;p&&p()}render(){return null}}function Hb(u){const[p,g]=gb(),w=ee.useContext(Qy);return v.jsx(BM,{...u,layoutGroup:w,switchLayoutGroup:ee.useContext(Ab),isPresent:p,safeToRemove:g})}const FM={borderRadius:{...mf,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:mf,borderTopRightRadius:mf,borderBottomLeftRadius:mf,borderBottomRightRadius:mf,boxShadow:NM};function OM(u,p,g){const w=Ps(u)?u:ap(u);return w.start(D0("",w,p,g)),w.animation}const UM=(u,p)=>u.depth-p.depth;class VM{constructor(){this.children=[],this.isDirty=!1}add(p){r0(this.children,p),this.isDirty=!0}remove(p){n0(this.children,p),this.isDirty=!0}forEach(p){this.isDirty&&this.children.sort(UM),this.isDirty=!1,this.children.forEach(p)}}function $M(u,p){const g=po.now(),w=({timestamp:E})=>{const P=E-g;P>=p&&(Ru(w),u(P-p))};return qn.setup(w,!0),()=>Ru(w)}const Xb=["TopLeft","TopRight","BottomLeft","BottomRight"],GM=Xb.length,xv=u=>typeof u=="string"?parseFloat(u):u,vv=u=>typeof u=="number"||Ar.test(u);function WM(u,p,g,w,E,P){E?(u.opacity=ei(0,g.opacity??1,qM(w)),u.opacityExit=ei(p.opacity??1,0,ZM(w))):P&&(u.opacity=ei(p.opacity??1,g.opacity??1,w));for(let j=0;j<GM;j++){const F=`border${Xb[j]}Radius`;let s=bv(p,F),U=bv(g,F);if(s===void 0&&U===void 0)continue;s||(s=0),U||(U=0),s===0||U===0||vv(s)===vv(U)?(u[F]=Math.max(ei(xv(s),xv(U),w),0),(Wl.test(U)||Wl.test(s))&&(u[F]+="%")):u[F]=U}(p.rotate||g.rotate)&&(u.rotate=ei(p.rotate||0,g.rotate||0,w))}function bv(u,p){return u[p]!==void 0?u[p]:u.borderRadius}const qM=Kb(0,.5,z1),ZM=Kb(.5,.95,ga);function Kb(u,p,g){return w=>w<u?0:w>p?1:g(kf(u,p,w))}function wv(u,p){u.min=p.min,u.max=p.max}function fa(u,p){wv(u.x,p.x),wv(u.y,p.y)}function Tv(u,p){u.translate=p.translate,u.scale=p.scale,u.originPoint=p.originPoint,u.origin=p.origin}function Sv(u,p,g,w,E){return u-=p,u=Xm(u,1/g,w),E!==void 0&&(u=Xm(u,1/E,w)),u}function HM(u,p=0,g=1,w=.5,E,P=u,j=u){if(Wl.test(p)&&(p=parseFloat(p),p=ei(j.min,j.max,p/100)-j.min),typeof p!="number")return;let F=ei(P.min,P.max,w);u===P&&(F-=p),u.min=Sv(u.min,p,g,F,E),u.max=Sv(u.max,p,g,F,E)}function Ev(u,p,[g,w,E],P,j){HM(u,p[g],p[w],p[E],p.scale,P,j)}const XM=["x","scaleX","originX"],KM=["y","scaleY","originY"];function kv(u,p,g,w){Ev(u.x,p,XM,g?g.x:void 0,w?w.x:void 0),Ev(u.y,p,KM,g?g.y:void 0,w?w.y:void 0)}function Cv(u){return u.translate===0&&u.scale===1}function Yb(u){return Cv(u.x)&&Cv(u.y)}function Av(u,p){return u.min===p.min&&u.max===p.max}function YM(u,p){return Av(u.x,p.x)&&Av(u.y,p.y)}function Mv(u,p){return Math.round(u.min)===Math.round(p.min)&&Math.round(u.max)===Math.round(p.max)}function Jb(u,p){return Mv(u.x,p.x)&&Mv(u.y,p.y)}function Pv(u){return Ws(u.x)/Ws(u.y)}function Iv(u,p){return u.translate===p.translate&&u.scale===p.scale&&u.originPoint===p.originPoint}class JM{constructor(){this.members=[]}add(p){r0(this.members,p),p.scheduleRender()}remove(p){if(n0(this.members,p),p===this.prevLead&&(this.prevLead=void 0),p===this.lead){const g=this.members[this.members.length-1];g&&this.promote(g)}}relegate(p){const g=this.members.findIndex(E=>p===E);if(g===0)return!1;let w;for(let E=g;E>=0;E--){const P=this.members[E];if(P.isPresent!==!1){w=P;break}}return w?(this.promote(w),!0):!1}promote(p,g){const w=this.lead;if(p!==w&&(this.prevLead=w,this.lead=p,p.show(),w)){w.instance&&w.scheduleRender(),p.scheduleRender(),p.resumeFrom=w,g&&(p.resumeFrom.preserveOpacity=!0),w.snapshot&&(p.snapshot=w.snapshot,p.snapshot.latestValues=w.animationValues||w.latestValues),p.root&&p.root.isUpdating&&(p.isLayoutDirty=!0);const{crossfade:E}=p.options;E===!1&&w.hide()}}exitAnimationComplete(){this.members.forEach(p=>{const{options:g,resumingFrom:w}=p;g.onExitComplete&&g.onExitComplete(),w&&w.options.onExitComplete&&w.options.onExitComplete()})}scheduleRender(){this.members.forEach(p=>{p.instance&&p.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function QM(u,p,g){let w="";const E=u.x.translate/p.x,P=u.y.translate/p.y,j=g?.z||0;if((E||P||j)&&(w=`translate3d(${E}px, ${P}px, ${j}px) `),(p.x!==1||p.y!==1)&&(w+=`scale(${1/p.x}, ${1/p.y}) `),g){const{transformPerspective:U,rotate:G,rotateX:J,rotateY:Y,skewX:me,skewY:Ae}=g;U&&(w=`perspective(${U}px) ${w}`),G&&(w+=`rotate(${G}deg) `),J&&(w+=`rotateX(${J}deg) `),Y&&(w+=`rotateY(${Y}deg) `),me&&(w+=`skewX(${me}deg) `),Ae&&(w+=`skewY(${Ae}deg) `)}const F=u.x.scale*p.x,s=u.y.scale*p.y;return(F!==1||s!==1)&&(w+=`scale(${F}, ${s})`),w||"none"}const hy=["","X","Y","Z"],e3=1e3;let t3=0;function dy(u,p,g,w){const{latestValues:E}=p;E[u]&&(g[u]=E[u],p.setStaticValue(u,0),w&&(w[u]=0))}function Qb(u){if(u.hasCheckedOptimisedAppear=!0,u.root===u)return;const{visualElement:p}=u.options;if(!p)return;const g=Bb(p);if(window.MotionHasOptimisedAnimation(g,"transform")){const{layout:E,layoutId:P}=u.options;window.MotionCancelOptimisedAnimation(g,"transform",qn,!(E||P))}const{parent:w}=u;w&&!w.hasCheckedOptimisedAppear&&Qb(w)}function ew({attachResizeListener:u,defaultParent:p,measureScroll:g,checkIsScrollRoot:w,resetTransform:E}){return class{constructor(j={},F=p?.()){this.id=t3++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(i3),this.nodes.forEach(l3),this.nodes.forEach(c3),this.nodes.forEach(s3)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=j,this.root=F?F.root||F:this,this.path=F?[...F.path,F]:[],this.parent=F,this.depth=F?F.depth+1:0;for(let s=0;s<this.path.length;s++)this.path[s].shouldResetTransform=!0;this.root===this&&(this.nodes=new VM)}addEventListener(j,F){return this.eventHandlers.has(j)||this.eventHandlers.set(j,new o0),this.eventHandlers.get(j).add(F)}notifyListeners(j,...F){const s=this.eventHandlers.get(j);s&&s.notify(...F)}hasListeners(j){return this.eventHandlers.has(j)}mount(j){if(this.instance)return;this.isSVG=mb(j)&&!ZC(j),this.instance=j;const{layoutId:F,layout:s,visualElement:U}=this.options;if(U&&!U.current&&U.mount(j),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(s||F)&&(this.isLayoutDirty=!0),u){let G,J=0;const Y=()=>this.root.updateBlockedByResize=!1;qn.read(()=>{J=window.innerWidth}),u(j,()=>{const me=window.innerWidth;me!==J&&(J=me,this.root.updateBlockedByResize=!0,G&&G(),G=$M(Y,250),Vm.hasAnimatedSinceResize&&(Vm.hasAnimatedSinceResize=!1,this.nodes.forEach(jv)))})}F&&this.root.registerSharedNode(F,this),this.options.animate!==!1&&U&&(F||s)&&this.addEventListener("didUpdate",({delta:G,hasLayoutChanged:J,hasRelativeLayoutChanged:Y,layout:me})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const Ae=this.options.transition||U.getDefaultTransition()||f3,{onLayoutAnimationStart:Ee,onLayoutAnimationComplete:Re}=U.getProps(),Ue=!this.targetLayout||!Jb(this.targetLayout,me),He=!J&&Y;if(this.options.layoutRoot||this.resumeFrom||He||J&&(Ue||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const Me={...x0(Ae,"layout"),onPlay:Ee,onComplete:Re};(U.shouldReduceMotion||this.options.layoutRoot)&&(Me.delay=0,Me.type=!1),this.startAnimation(Me),this.setAnimationOrigin(G,He)}else J||jv(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=me})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const j=this.getStack();j&&j.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Ru(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(u3),this.animationId++)}getTransformTemplate(){const{visualElement:j}=this.options;return j&&j.getProps().transformTemplate}willUpdate(j=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Qb(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let G=0;G<this.path.length;G++){const J=this.path[G];J.shouldResetTransform=!0,J.updateScroll("snapshot"),J.options.layoutRoot&&J.willUpdate(!1)}const{layoutId:F,layout:s}=this.options;if(F===void 0&&!s)return;const U=this.getTransformTemplate();this.prevTransformTemplateValue=U?U(this.latestValues,""):void 0,this.updateSnapshot(),j&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Dv);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Lv);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(a3),this.nodes.forEach(r3),this.nodes.forEach(n3)):this.nodes.forEach(Lv),this.clearAllSnapshots();const F=po.now();cs.delta=Fc(0,1e3/60,F-cs.timestamp),cs.timestamp=F,cs.isProcessing=!0,ey.update.process(cs),ey.preRender.process(cs),ey.render.process(cs),cs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,b0.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(o3),this.sharedNodes.forEach(h3)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,qn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){qn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Ws(this.snapshot.measuredBox.x)&&!Ws(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let s=0;s<this.path.length;s++)this.path[s].updateScroll();const j=this.layout;this.layout=this.measure(!1),this.layoutCorrected=gi(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:F}=this.options;F&&F.notify("LayoutMeasure",this.layout.layoutBox,j?j.layoutBox:void 0)}updateScroll(j="measure"){let F=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===j&&(F=!1),F&&this.instance){const s=w(this.instance);this.scroll={animationId:this.root.animationId,phase:j,isRoot:s,offset:g(this.instance),wasRoot:this.scroll?this.scroll.isRoot:s}}}resetTransform(){if(!E)return;const j=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,F=this.projectionDelta&&!Yb(this.projectionDelta),s=this.getTransformTemplate(),U=s?s(this.latestValues,""):void 0,G=U!==this.prevTransformTemplateValue;j&&this.instance&&(F||Wh(this.latestValues)||G)&&(E(this.instance,U),this.shouldResetTransform=!1,this.scheduleRender())}measure(j=!0){const F=this.measurePageBox();let s=this.removeElementScroll(F);return j&&(s=this.removeTransform(s)),m3(s),{animationId:this.root.animationId,measuredBox:F,layoutBox:s,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:j}=this.options;if(!j)return gi();const F=j.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(g3))){const{scroll:U}=this.root;U&&(Qd(F.x,U.offset.x),Qd(F.y,U.offset.y))}return F}removeElementScroll(j){const F=gi();if(fa(F,j),this.scroll?.wasRoot)return F;for(let s=0;s<this.path.length;s++){const U=this.path[s],{scroll:G,options:J}=U;U!==this.root&&G&&J.layoutScroll&&(G.wasRoot&&fa(F,j),Qd(F.x,G.offset.x),Qd(F.y,G.offset.y))}return F}applyTransform(j,F=!1){const s=gi();fa(s,j);for(let U=0;U<this.path.length;U++){const G=this.path[U];!F&&G.options.layoutScroll&&G.scroll&&G!==G.root&&ep(s,{x:-G.scroll.offset.x,y:-G.scroll.offset.y}),Wh(G.latestValues)&&ep(s,G.latestValues)}return Wh(this.latestValues)&&ep(s,this.latestValues),s}removeTransform(j){const F=gi();fa(F,j);for(let s=0;s<this.path.length;s++){const U=this.path[s];if(!U.instance||!Wh(U.latestValues))continue;zy(U.latestValues)&&U.updateSnapshot();const G=gi(),J=U.measurePageBox();fa(G,J),kv(F,U.latestValues,U.snapshot?U.snapshot.layoutBox:void 0,G)}return Wh(this.latestValues)&&kv(F,this.latestValues),F}setTargetDelta(j){this.targetDelta=j,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(j){this.options={...this.options,...j,crossfade:j.crossfade!==void 0?j.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==cs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(j=!1){const F=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=F.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=F.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=F.isSharedProjectionDirty);const s=!!this.resumingFrom||this!==F;if(!(j||s&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:G,layoutId:J}=this.options;if(!(!this.layout||!(G||J))){if(this.resolvedRelativeTargetAt=cs.timestamp,!this.targetDelta&&!this.relativeTarget){const Y=this.getClosestProjectingParent();Y&&Y.layout&&this.animationProgress!==1?(this.relativeParent=Y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=gi(),this.relativeTargetOrigin=gi(),bf(this.relativeTargetOrigin,this.layout.layoutBox,Y.layout.layoutBox),fa(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=gi(),this.targetWithTransforms=gi()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),wM(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):fa(this.target,this.layout.layoutBox),Db(this.target,this.targetDelta)):fa(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const Y=this.getClosestProjectingParent();Y&&!!Y.resumingFrom==!!this.resumingFrom&&!Y.options.layoutScroll&&Y.target&&this.animationProgress!==1?(this.relativeParent=Y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=gi(),this.relativeTargetOrigin=gi(),bf(this.relativeTargetOrigin,this.target,Y.target),fa(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||zy(this.parent.latestValues)||Ib(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const j=this.getLead(),F=!!this.resumingFrom||this!==j;let s=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(s=!1),F&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(s=!1),this.resolvedRelativeTargetAt===cs.timestamp&&(s=!1),s)return;const{layout:U,layoutId:G}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(U||G))return;fa(this.layoutCorrected,this.layout.layoutBox);const J=this.treeScale.x,Y=this.treeScale.y;jA(this.layoutCorrected,this.treeScale,this.path,F),j.layout&&!j.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(j.target=j.layout.layoutBox,j.targetWithTransforms=gi());const{target:me}=j;if(!me){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Tv(this.prevProjectionDelta.x,this.projectionDelta.x),Tv(this.prevProjectionDelta.y,this.projectionDelta.y)),vf(this.projectionDelta,this.layoutCorrected,me,this.latestValues),(this.treeScale.x!==J||this.treeScale.y!==Y||!Iv(this.projectionDelta.x,this.prevProjectionDelta.x)||!Iv(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",me))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(j=!0){if(this.options.visualElement?.scheduleRender(),j){const F=this.getStack();F&&F.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=tp(),this.projectionDelta=tp(),this.projectionDeltaWithTransform=tp()}setAnimationOrigin(j,F=!1){const s=this.snapshot,U=s?s.latestValues:{},G={...this.latestValues},J=tp();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!F;const Y=gi(),me=s?s.source:void 0,Ae=this.layout?this.layout.source:void 0,Ee=me!==Ae,Re=this.getStack(),Ue=!Re||Re.members.length<=1,He=!!(Ee&&!Ue&&this.options.crossfade===!0&&!this.path.some(p3));this.animationProgress=0;let Me;this.mixTargetDelta=lt=>{const kt=lt/1e3;Rv(J.x,j.x,kt),Rv(J.y,j.y,kt),this.setTargetDelta(J),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(bf(Y,this.layout.layoutBox,this.relativeParent.layout.layoutBox),d3(this.relativeTarget,this.relativeTargetOrigin,Y,kt),Me&&YM(this.relativeTarget,Me)&&(this.isProjectionDirty=!1),Me||(Me=gi()),fa(Me,this.relativeTarget)),Ee&&(this.animationValues=G,WM(G,U,this.latestValues,kt,He,Ue)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=kt},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(j){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Ru(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=qn.update(()=>{Vm.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=ap(0)),this.currentAnimation=OM(this.motionValue,[0,1e3],{...j,velocity:0,isSync:!0,onUpdate:F=>{this.mixTargetDelta(F),j.onUpdate&&j.onUpdate(F)},onStop:()=>{},onComplete:()=>{j.onComplete&&j.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const j=this.getStack();j&&j.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const j=this.getLead();let{targetWithTransforms:F,target:s,layout:U,latestValues:G}=j;if(!(!F||!s||!U)){if(this!==j&&this.layout&&U&&tw(this.options.animationType,this.layout.layoutBox,U.layoutBox)){s=this.target||gi();const J=Ws(this.layout.layoutBox.x);s.x.min=j.target.x.min,s.x.max=s.x.min+J;const Y=Ws(this.layout.layoutBox.y);s.y.min=j.target.y.min,s.y.max=s.y.min+Y}fa(F,s),ep(F,G),vf(this.projectionDeltaWithTransform,this.layoutCorrected,F,G)}}registerSharedNode(j,F){this.sharedNodes.has(j)||this.sharedNodes.set(j,new JM),this.sharedNodes.get(j).add(F);const U=F.options.initialPromotionConfig;F.promote({transition:U?U.transition:void 0,preserveFollowOpacity:U&&U.shouldPreserveFollowOpacity?U.shouldPreserveFollowOpacity(F):void 0})}isLead(){const j=this.getStack();return j?j.lead===this:!0}getLead(){const{layoutId:j}=this.options;return j?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:j}=this.options;return j?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:j}=this.options;if(j)return this.root.sharedNodes.get(j)}promote({needsReset:j,transition:F,preserveFollowOpacity:s}={}){const U=this.getStack();U&&U.promote(this,s),j&&(this.projectionDelta=void 0,this.needsReset=!0),F&&this.setOptions({transition:F})}relegate(){const j=this.getStack();return j?j.relegate(this):!1}resetSkewAndRotation(){const{visualElement:j}=this.options;if(!j)return;let F=!1;const{latestValues:s}=j;if((s.z||s.rotate||s.rotateX||s.rotateY||s.rotateZ||s.skewX||s.skewY)&&(F=!0),!F)return;const U={};s.z&&dy("z",j,U,this.animationValues);for(let G=0;G<hy.length;G++)dy(`rotate${hy[G]}`,j,U,this.animationValues),dy(`skew${hy[G]}`,j,U,this.animationValues);j.render();for(const G in U)j.setStaticValue(G,U[G]),this.animationValues&&(this.animationValues[G]=U[G]);j.scheduleRender()}applyProjectionStyles(j,F){if(!this.instance||this.isSVG)return;if(!this.isVisible){j.visibility="hidden";return}const s=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,j.visibility="",j.opacity="",j.pointerEvents=Um(F?.pointerEvents)||"",j.transform=s?s(this.latestValues,""):"none";return}const U=this.getLead();if(!this.projectionDelta||!this.layout||!U.target){this.options.layoutId&&(j.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,j.pointerEvents=Um(F?.pointerEvents)||""),this.hasProjected&&!Wh(this.latestValues)&&(j.transform=s?s({},""):"none",this.hasProjected=!1);return}j.visibility="";const G=U.animationValues||U.latestValues;this.applyTransformsToTarget();let J=QM(this.projectionDeltaWithTransform,this.treeScale,G);s&&(J=s(G,J)),j.transform=J;const{x:Y,y:me}=this.projectionDelta;j.transformOrigin=`${Y.origin*100}% ${me.origin*100}% 0`,U.animationValues?j.opacity=U===this?G.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:G.opacityExit:j.opacity=U===this?G.opacity!==void 0?G.opacity:"":G.opacityExit!==void 0?G.opacityExit:0;for(const Ae in Pf){if(G[Ae]===void 0)continue;const{correct:Ee,applyTo:Re,isCSSVariable:Ue}=Pf[Ae],He=J==="none"?G[Ae]:Ee(G[Ae],U);if(Re){const Me=Re.length;for(let lt=0;lt<Me;lt++)j[Re[lt]]=He}else Ue?this.options.visualElement.renderState.vars[Ae]=He:j[Ae]=He}this.options.layoutId&&(j.pointerEvents=U===this?Um(F?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(j=>j.currentAnimation?.stop()),this.root.nodes.forEach(Dv),this.root.sharedNodes.clear()}}}function r3(u){u.updateLayout()}function n3(u){const p=u.resumeFrom?.snapshot||u.snapshot;if(u.isLead()&&u.layout&&p&&u.hasListeners("didUpdate")){const{layoutBox:g,measuredBox:w}=u.layout,{animationType:E}=u.options,P=p.source!==u.layout.source;E==="size"?ma(G=>{const J=P?p.measuredBox[G]:p.layoutBox[G],Y=Ws(J);J.min=g[G].min,J.max=J.min+Y}):tw(E,p.layoutBox,g)&&ma(G=>{const J=P?p.measuredBox[G]:p.layoutBox[G],Y=Ws(g[G]);J.max=J.min+Y,u.relativeTarget&&!u.currentAnimation&&(u.isProjectionDirty=!0,u.relativeTarget[G].max=u.relativeTarget[G].min+Y)});const j=tp();vf(j,g,p.layoutBox);const F=tp();P?vf(F,u.applyTransform(w,!0),p.measuredBox):vf(F,g,p.layoutBox);const s=!Yb(j);let U=!1;if(!u.resumeFrom){const G=u.getClosestProjectingParent();if(G&&!G.resumeFrom){const{snapshot:J,layout:Y}=G;if(J&&Y){const me=gi();bf(me,p.layoutBox,J.layoutBox);const Ae=gi();bf(Ae,g,Y.layoutBox),Jb(me,Ae)||(U=!0),G.options.layoutRoot&&(u.relativeTarget=Ae,u.relativeTargetOrigin=me,u.relativeParent=G)}}}u.notifyListeners("didUpdate",{layout:g,snapshot:p,delta:F,layoutDelta:j,hasLayoutChanged:s,hasRelativeLayoutChanged:U})}else if(u.isLead()){const{onExitComplete:g}=u.options;g&&g()}u.options.transition=void 0}function i3(u){u.parent&&(u.isProjecting()||(u.isProjectionDirty=u.parent.isProjectionDirty),u.isSharedProjectionDirty||(u.isSharedProjectionDirty=!!(u.isProjectionDirty||u.parent.isProjectionDirty||u.parent.isSharedProjectionDirty)),u.isTransformDirty||(u.isTransformDirty=u.parent.isTransformDirty))}function s3(u){u.isProjectionDirty=u.isSharedProjectionDirty=u.isTransformDirty=!1}function o3(u){u.clearSnapshot()}function Dv(u){u.clearMeasurements()}function Lv(u){u.isLayoutDirty=!1}function a3(u){const{visualElement:p}=u.options;p&&p.getProps().onBeforeLayoutMeasure&&p.notify("BeforeLayoutMeasure"),u.resetTransform()}function jv(u){u.finishAnimation(),u.targetDelta=u.relativeTarget=u.target=void 0,u.isProjectionDirty=!0}function l3(u){u.resolveTargetDelta()}function c3(u){u.calcProjection()}function u3(u){u.resetSkewAndRotation()}function h3(u){u.removeLeadSnapshot()}function Rv(u,p,g){u.translate=ei(p.translate,0,g),u.scale=ei(p.scale,1,g),u.origin=p.origin,u.originPoint=p.originPoint}function zv(u,p,g,w){u.min=ei(p.min,g.min,w),u.max=ei(p.max,g.max,w)}function d3(u,p,g,w){zv(u.x,p.x,g.x,w),zv(u.y,p.y,g.y,w)}function p3(u){return u.animationValues&&u.animationValues.opacityExit!==void 0}const f3={duration:.45,ease:[.4,0,.1,1]},Nv=u=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(u),Bv=Nv("applewebkit/")&&!Nv("chrome/")?Math.round:ga;function Fv(u){u.min=Bv(u.min),u.max=Bv(u.max)}function m3(u){Fv(u.x),Fv(u.y)}function tw(u,p,g){return u==="position"||u==="preserve-aspect"&&!bM(Pv(p),Pv(g),.2)}function g3(u){return u!==u.root&&u.scroll?.wasRoot}const y3=ew({attachResizeListener:(u,p)=>If(u,"resize",p),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),py={current:void 0},rw=ew({measureScroll:u=>({x:u.scrollLeft,y:u.scrollTop}),defaultParent:()=>{if(!py.current){const u=new y3({});u.mount(window),u.setOptions({layoutScroll:!0}),py.current=u}return py.current},resetTransform:(u,p)=>{u.style.transform=p!==void 0?p:"none"},checkIsScrollRoot:u=>window.getComputedStyle(u).position==="fixed"}),_3={pan:{Feature:zM},drag:{Feature:RM,ProjectionNode:rw,MeasureLayout:Hb}};function Ov(u,p,g){const{props:w}=u;u.animationState&&w.whileHover&&u.animationState.setActive("whileHover",g==="Start");const E="onHover"+g,P=w[E];P&&qn.postRender(()=>P(p,Of(p)))}class x3 extends Bu{mount(){const{current:p}=this.node;p&&(this.unmount=VC(p,(g,w)=>(Ov(this.node,w,"Start"),E=>Ov(this.node,E,"End"))))}unmount(){}}class v3 extends Bu{constructor(){super(...arguments),this.isActive=!1}onFocus(){let p=!1;try{p=this.node.current.matches(":focus-visible")}catch{p=!0}!p||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Nf(If(this.node.current,"focus",()=>this.onFocus()),If(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Uv(u,p,g){const{props:w}=u;if(u.current instanceof HTMLButtonElement&&u.current.disabled)return;u.animationState&&w.whileTap&&u.animationState.setActive("whileTap",g==="Start");const E="onTap"+(g==="End"?"":g),P=w[E];P&&qn.postRender(()=>P(p,Of(p)))}class b3 extends Bu{mount(){const{current:p}=this.node;p&&(this.unmount=qC(p,(g,w)=>(Uv(this.node,w,"Start"),(E,{success:P})=>Uv(this.node,E,P?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const $y=new WeakMap,fy=new WeakMap,w3=u=>{const p=$y.get(u.target);p&&p(u)},T3=u=>{u.forEach(w3)};function S3({root:u,...p}){const g=u||document;fy.has(g)||fy.set(g,{});const w=fy.get(g),E=JSON.stringify(p);return w[E]||(w[E]=new IntersectionObserver(T3,{root:u,...p})),w[E]}function E3(u,p,g){const w=S3(p);return $y.set(u,g),w.observe(u),()=>{$y.delete(u),w.unobserve(u)}}const k3={some:0,all:1};class C3 extends Bu{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:p={}}=this.node.getProps(),{root:g,margin:w,amount:E="some",once:P}=p,j={root:g?g.current:void 0,rootMargin:w,threshold:typeof E=="number"?E:k3[E]},F=s=>{const{isIntersecting:U}=s;if(this.isInView===U||(this.isInView=U,P&&!U&&this.hasEnteredView))return;U&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",U);const{onViewportEnter:G,onViewportLeave:J}=this.node.getProps(),Y=U?G:J;Y&&Y(s)};return E3(this.node.current,j,F)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:p,prevProps:g}=this.node;["amount","margin","root"].some(A3(p,g))&&this.startObserver()}unmount(){}}function A3({viewport:u={}},{viewport:p={}}={}){return g=>u[g]!==p[g]}const M3={inView:{Feature:C3},tap:{Feature:b3},focus:{Feature:v3},hover:{Feature:x3}},P3={layout:{ProjectionNode:rw,MeasureLayout:Hb}},I3={...mM,...M3,..._3,...P3},rr=IA(I3,GA),D3=({bus:u,route:p,onClick:g,isSelected:w})=>v.jsx(qh,{longitude:u.lng,latitude:u.lat,children:v.jsxs(rr.div,{className:"relative cursor-pointer group",initial:{scale:0,rotate:-180},animate:{scale:w?1.2:1,rotate:0},whileHover:{scale:w?1.3:1.1},whileTap:{scale:.95},transition:{type:"spring",stiffness:300,damping:20,scale:{duration:.3}},layout:!0,onClick:g,title:`Click to view details for ${p?.shortName||"Bus"} ${u.vehicle_number||u.id}`,children:[v.jsxs(rr.div,{className:`w-12 h-12 rounded-xl shadow-xl border-2 border-white flex items-center justify-center relative transition-all duration-200 ${w?"ring-2 ring-white ring-opacity-50":""} group-hover:shadow-2xl group-hover:scale-105`,style:{backgroundColor:p?.color||"#0ea5e9"},animate:{boxShadow:w?"0 8px 25px rgba(0, 0, 0, 0.3)":"0 4px 15px rgba(0, 0, 0, 0.2)"},children:[v.jsxs(rr.svg,{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",className:"text-white",animate:{scale:u.speed>0?[1,1.1,1]:1},transition:{duration:1,repeat:u.speed>0?Number.POSITIVE_INFINITY:0},children:[v.jsx("path",{d:"M4 16c0 .88.39 1.67 1 2.22V20a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1v-1h8v1a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1v-1.78c.61-.55 1-1.34 1-2.22V6c0-3.5-3.58-4-8-4s-8 .5-8 4v10Z",fill:"currentColor"}),v.jsx("circle",{cx:"6.5",cy:"15.5",r:"1.5",fill:"white"}),v.jsx("circle",{cx:"17.5",cy:"15.5",r:"1.5",fill:"white"}),v.jsx("path",{d:"M4 7h16v5H4V7Z",fill:"white",fillOpacity:"0.3"})]}),v.jsx(rr.div,{className:"absolute -top-1 -right-1 w-3.5 h-3.5 bg-white rounded-full border border-gray-300 flex items-center justify-center",animate:{rotate:u.heading},transition:{duration:.5,ease:"easeInOut"},style:{transformOrigin:"center"},children:v.jsx("div",{className:"w-1.5 h-1.5 bg-gray-700 rounded-full"})}),u.speed>5&&v.jsx(rr.div,{className:"absolute -top-2 -left-2 w-2 h-2 bg-green-400 rounded-full",animate:{scale:[1,1.3,1],opacity:[1,.7,1]},transition:{duration:1,repeat:Number.POSITIVE_INFINITY,ease:"easeInOut"}})]}),v.jsx(fo,{children:v.jsx(rr.div,{className:"absolute -bottom-6 left-1/2 transform -translate-x-1/2 bg-white dark:bg-gray-800 px-2 py-1 rounded text-xs font-medium shadow-md border border-gray-200 dark:border-gray-700 whitespace-nowrap",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:.2},children:v.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:p?.shortName||"BUS"})})}),u.speed>0&&v.jsx(rr.div,{className:"absolute inset-0 rounded-lg border-2",style:{borderColor:p?.color||"#0ea5e9"},animate:{scale:[1,1.8,1],opacity:[.7,0,.7]},transition:{duration:2.5,repeat:Number.POSITIVE_INFINITY,ease:"easeInOut"}}),w&&v.jsx(rr.div,{className:"absolute inset-0 rounded-lg border-2 border-white",initial:{scale:1.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},transition:{duration:.3}})]})});class L3{constructor(){this.buses=new Map,this.routes=[],this.isRunning=!1,this.intervalId=null,this.updateInterval=5e3}async initialize(){if(!this.isRunning)try{this.routes=[{id:"route-38",name:"Meskel Square to Piazza",shortName:"38",color:"#1e40af",type:"bus",description:"Addis Ababa City Bus",stops:[{id:"stop-1",name:"Meskel Square",lat:9.0054,lng:38.7636},{id:"stop-2",name:"Piazza",lat:9.0154,lng:38.7736},{id:"stop-3",name:"CMC Terminal",lat:9.0254,lng:38.7836}]},{id:"route-91",name:"Bole to Kazanchis",shortName:"91",color:"#f59e0b",type:"bus",description:"Addis Ababa City Bus",stops:[{id:"stop-4",name:"Bole Airport",lat:8.9954,lng:38.7536},{id:"stop-5",name:"Kazanchis",lat:9.0054,lng:38.7436}]},{id:"route-12",name:"Merkato to Arat Kilo",shortName:"12",color:"#16a34a",type:"bus",description:"Addis Ababa City Bus",stops:[{id:"stop-6",name:"Merkato",lat:8.9854,lng:38.7236},{id:"stop-7",name:"Arat Kilo",lat:9.0154,lng:38.7536}]},{id:"route-23",name:"Current Location",shortName:"23",color:"#dc2626",type:"bus",description:"Addis Ababa City Bus",stops:[{id:"stop-8",name:"Current Location",lat:9.0054,lng:38.7636},{id:"stop-9",name:"National Theatre",lat:9.0054,lng:38.7436}]},{id:"route-07",name:"CMC to Bole",shortName:"07",color:"#8b5cf6",type:"bus",description:"Addis Ababa City Bus",stops:[{id:"stop-10",name:"CMC",lat:9.03,lng:38.8},{id:"stop-11",name:"Bole",lat:8.999,lng:38.78}]},{id:"route-35",name:"Piazza to Mexico",shortName:"35",color:"#0ea5e9",type:"bus",description:"Addis Ababa City Bus",stops:[{id:"stop-12",name:"Piazza",lat:9.0154,lng:38.7736},{id:"stop-13",name:"Mexico Square",lat:9.0085,lng:38.746}]}],this.createBuses(),this.start()}catch(p){console.error("Failed to initialize bus simulation:",p)}}createBuses(){this.routes.forEach(p=>{if(p.stops&&p.stops.length>=2){const g=Math.floor(Math.random()*2)+2;for(let w=1;w<=g;w++){const E=`bus-${p.shortName}-${w}`,P=this.createBus(E,p,w);this.buses.set(E,P)}}})}createBus(p,g,w){const E=g.stops,P=Math.floor(Math.random()*E.length),j=E[P];return{id:p,routeId:g.id,vehicleNumber:`${g.shortName}${w.toString().padStart(2,"0")}`,driver:this.getRandomDriver(),operator:this.getRandomOperator(),busType:this.getRandomBusType(),mengedCompatible:Math.random()>.3,lat:j.lat,lng:j.lng,heading:0,speed:0,capacity:40,occupancy:Math.floor(Math.random()*40),currentStopIndex:P,nextStopIndex:(P+1)%E.length,nextStop:E[(P+1)%E.length].name,eta:this.calculateETA(E[P],E[(P+1)%E.length]),lastUpdated:new Date,isMoving:!1,progress:0,route:g}}getRandomDriver(){const p=["Alemayehu","Meron","Tigist","Yonas","Eleni","Dawit","Kebede","Selam","Abebe","Mulu","Tewodros","Hirut"],g=["Tesfaye","Kebede","Assefa","Mengistu","Tadesse","Girma","Hailu","Worku","Getachew","Bekele"],w=p[Math.floor(Math.random()*p.length)],E=g[Math.floor(Math.random()*g.length)];return`${w} ${E}`}getRandomOperator(){const p=["Anbessa","Sheger","Velocity"];return p[Math.floor(Math.random()*p.length)]}getRandomBusType(){const p=["Standard","Articulated","Mini"];return p[Math.floor(Math.random()*p.length)]}calculateETA(p,g){const w=this.calculateDistance(p.lat,p.lng,g.lat,g.lng),E=15+Math.random()*10;return`${Math.round(w/E*60)} min`}calculateDistance(p,g,w,E){const j=(w-p)*Math.PI/180,F=(E-g)*Math.PI/180,s=Math.sin(j/2)*Math.sin(j/2)+Math.cos(p*Math.PI/180)*Math.cos(w*Math.PI/180)*Math.sin(F/2)*Math.sin(F/2);return 6371*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))}start(){this.isRunning||(this.isRunning=!0,this.intervalId=setInterval(()=>{this.updateBuses()},this.updateInterval),console.log("Bus simulation started"))}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.isRunning=!1,console.log("Bus simulation stopped")}updateBuses(){this.buses.forEach(p=>{this.updateBus(p)})}updateBus(p){const w=p.route.stops;if(w.length<2)return;w[p.currentStopIndex];const E=w[p.nextStopIndex];this.calculateDistance(p.lat,p.lng,E.lat,E.lng)<.01?this.arriveAtStop(p):this.moveTowardsStop(p,E),p.lastUpdated=new Date}moveTowardsStop(p,g){const w=35e-5+Math.random()*45e-5,E=g.lat-p.lat,P=g.lng-p.lng,j=Math.sqrt(E*E+P*P);if(j>0){p.lat+=E/j*w,p.lng+=P/j*w,p.heading=Math.atan2(P,E)*180/Math.PI,p.speed=Math.max(10,Math.round(w*111e3)),p.isMoving=!0;const F=p.route.stops[p.currentStopIndex],s=this.calculateDistance(F.lat,F.lng,g.lat,g.lng),U=this.calculateDistance(p.lat,p.lng,g.lat,g.lng);p.progress=s>0?Math.min(1,(s-U)/s):0}}arriveAtStop(p){const w=p.route.stops;p.currentStopIndex=p.nextStopIndex,p.nextStopIndex=(p.nextStopIndex+1)%w.length;const E=w[p.currentStopIndex];p.lat=E.lat,p.lng=E.lng;const P=w[p.nextStopIndex];p.nextStop=P.name,p.eta=this.calculateETA(E,P),p.progress=0,p.speed=0,p.isMoving=!1,p.occupancy=Math.floor(Math.random()*p.capacity),console.log(`Bus ${p.vehicleNumber} arrived at ${E.name}, next: ${P.name}`)}getBuses(){return Array.from(this.buses.values())}getBusesForRoute(p){return this.getBuses().filter(g=>g.routeId===p)}getBus(p){return this.buses.get(p)}addBus(p){const g=this.routes.find(j=>j.id===p);if(!g)return null;const w=this.getBusesForRoute(p).length+1,E=`bus-${g.shortName}-${w}`,P=this.createBus(E,g,w);return this.buses.set(E,P),P}removeBus(p){return this.buses.delete(p)}getStatus(){return{isRunning:this.isRunning,busCount:this.buses.size,routes:this.routes.length,lastUpdate:new Date}}}const ip=new L3,nw="http://localhost:3001";console.log("API URL:",nw);const Zs=async(u,p={},g=5)=>{const w=nw;console.log(`API call: ${w}${u}`);for(let E=0;E<g;E++)try{const P=new Headers(p.headers||{});try{const s=localStorage.getItem("admin_token");s&&!P.has("Authorization")&&P.set("Authorization",`Bearer ${s}`)}catch{}const j=await fetch(`${w}${u}`,{...p,headers:P});if(!j.ok){let s=`HTTP ${j.status}`;try{const G=await j.json();G&&(G.error||G.message)&&(s=`${s}: ${G.error||G.message}`)}catch{}const U=new Error(s);throw j.status>=400&&j.status<500,U}const F=await j.json();return console.log(`API response for ${u}:`,F),F}catch(P){console.log(`API call failed (attempt ${E+1}/${g}):`,P.message);const j=/^HTTP\s+(\d{3})$/.exec(String(P.message||""));if(j){const s=Number(j[1]);if(s>=400&&s<500)throw P}if(E===g-1)throw console.error(`All ${g} attempts failed for ${u}`),P;const F=Math.min(1e3*Math.pow(2,E)+Math.random()*1e3,1e4);console.log(`Retrying in ${F}ms...`),await new Promise(s=>setTimeout(s,F))}},ng=()=>Zs("/routes"),j3=u=>Zs(`/routes/${u}`),L0=()=>Zs("/alerts"),R3=u=>Zs("/trip/plan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),z3=u=>Zs("/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),iw=(u,p,g=1e3)=>Zs(`/stops/nearby?lat=${u}&lng=${p}&radius=${g}`),sw=async()=>(ip.isRunning||await ip.initialize(),ip.getBuses()),N3=async u=>(ip.isRunning||await ip.initialize(),ip.addBus(u)),ow=async()=>{const u=await ng(),p=[];for(const g of u)try{const w=await j3(g.id);p.push({...w,shortName:w.short_name||w.shortName,routeNumber:w.route_number||w.routeNumber})}catch{p.push({...g,shortName:g.short_name||g.shortName,routeNumber:g.route_number||g.routeNumber,stops:[]})}return p},B3=async(u,p)=>Zs("/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:u,password:p})}),F3=(u=200)=>Zs(`/feedbacks?limit=${u}`),O3=async(u,p="driving")=>{try{const g=u.map(j=>`${j[0]},${j[1]}`).join(";"),w=`https://router.project-osrm.org/route/v1/${p}/${g}?geometries=geojson&overview=full`;console.log("Fetching snapped route from OSRM:",w);const E=await fetch(w);if(!E.ok)throw new Error(`OSRM API error: ${E.status}`);const P=await E.json();if(P.routes&&P.routes.length>0)return{type:"Feature",geometry:P.routes[0].geometry,properties:{distance:P.routes[0].distance,duration:P.routes[0].duration}};throw new Error("No routes returned from OSRM")}catch(g){return console.error("Error fetching snapped route from OSRM:",g),{type:"Feature",geometry:{type:"LineString",coordinates:u}}}},sp=(u=null,p=null)=>{const g=new URLSearchParams;u&&g.append("routeId",u),p&&g.append("plateNumber",p);const w=g.toString();return Zs(`/buses/status${w?"?"+w:""}`)},U3=u=>Zs("/buses/add-ticket",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plateNumber:u})}),V3=u=>Zs("/buses/reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plateNumber:u})}),$3=(u,p,g="High passenger demand detected",w="medium")=>Zs("/fleet/reroute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bus_id:u,destination:p,reason:g,priority:w})}),G3=(u,p,g="Move bus to congested route",w="medium",E=null,P=null,j=null)=>Zs("/fleet/reroute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bus_id:u,plate_number:E,target_route_id:p,target_route_short_name:P,target_route_name:j,reason:g,priority:w})}),W3=()=>Zs("/fleet/congestion"),q3=()=>Zs("/fleet/congestion/routes"),Z3="pk.eyJ1Ijoic2FuaWRhZ290IiwiYSI6ImNtZjg3NHZxdzA0YXgycHNkNTl3dTQxbXoifQ.TlRvzYLTNSJsm_CVBmDAGQ",aw=({selectedRoute:u,onRouteSelect:p,plannerFrom:g,plannerTo:w,onMapClick:E,selectedBus:P,onBusSelect:j})=>{const F=ee.useRef(),[s,U]=ee.useState({longitude:38.7636,latitude:9.0054,zoom:13}),[G,J]=ee.useState([]),[Y,me]=ee.useState([]),[Ae,Ee]=ee.useState([]),[Re,Ue]=ee.useState("mapbox://styles/mapbox/light-v11"),[He,Me]=ee.useState(!0),[lt,kt]=ee.useState(!1),[$e,Ye]=ee.useState(new Date),[tt,it]=ee.useState(!0),[De,$t]=ee.useState(!1),[ut,vt]=ee.useState(null),[nr,Jr]=ee.useState(!1),[ir,cr]=ee.useState(null),[St,Fe]=ee.useState(!1),[_t,Te]=ee.useState(null),[st,Gt]=ee.useState(!1),[Ot,xr]=ee.useState([]),[sr,Ur]=ee.useState(1e4),[jr,Qr]=ee.useState([]);ee.useEffect(()=>{const Mt=document.documentElement.classList.contains("dark");Ue(Mt?"mapbox://styles/mapbox/dark-v10":"mapbox://styles/mapbox/light-v10")},[]),ee.useEffect(()=>{const Mt=new MutationObserver(()=>{const vr=document.documentElement.classList.contains("dark");Ue(vr?"mapbox://styles/mapbox/dark-v10":"mapbox://styles/mapbox/light-v10")});return Mt.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>Mt.disconnect()},[]);const Ln=async(Mt,vr=!0)=>{const Mr=[];console.log(`Processing ${Mt.length} routes for road snapping...`),console.log("Route data sample:",Mt.slice(0,2));for(const Wt of Mt)if(console.log(`Processing route ${Wt.id}:`,{hasStops:!!Wt.stops,stopsLength:Wt.stops?.length,hasId:!!Wt.id,hasShortName:!!Wt.short_name,hasName:!!Wt.name,hasColor:!!Wt.color,color:Wt.color}),Wt.stops&&Wt.stops.length>=2&&Wt.id){const Fn=Wt.id&&Wt.short_name&&Wt.name&&Wt.color,hs=["#FF0000","#00BFFF","#0000FF","#00FF00","#FFD700"],Ci=hs.includes(Wt.color);if(Fn&&Ci)if(vr)try{const Zn=Wt.stops.filter(On=>On.lat&&On.lng).map(On=>[parseFloat(On.lng),parseFloat(On.lat)]);if(Zn.length>=2){const On=await O3(Zn,"driving");Mr.push({route_id:Wt.id,geometry:On.geometry,color:Wt.color,properties:On.properties}),console.log(`Road-snapped database route ${Wt.id} (${Wt.short_name}) with ${Zn.length} stops`)}else console.warn(`Route ${Wt.id} has insufficient valid coordinates for snapping`),Mr.push({route_id:Wt.id,geometry:{type:"LineString",coordinates:Wt.stops.map(On=>[parseFloat(On.lng),parseFloat(On.lat)])},color:Wt.color})}catch(Zn){console.warn(`Failed to snap database route ${Wt.id}, using straight line:`,Zn),Mr.push({route_id:Wt.id,geometry:{type:"LineString",coordinates:Wt.stops.map(On=>[parseFloat(On.lng),parseFloat(On.lat)])},color:Wt.color})}else Mr.push({route_id:Wt.id,geometry:{type:"LineString",coordinates:Wt.stops.map(Zn=>[parseFloat(Zn.lng),parseFloat(Zn.lat)])},color:Wt.color});else console.warn(Fn&&!Ci?`Skipping route ${Wt.id} - invalid color: ${Wt.color}. Expected one of: ${hs.join(", ")}`:`Skipping non-database route: ${Wt.id} - missing required database fields`)}else console.warn(`Skipping route ${Wt.id} - insufficient stops data`);return console.log(`Processed ${Mr.length} database routes for road snapping`),Mr};ee.useEffect(()=>{(async()=>{try{const[vr,Mr,Wt]=await Promise.all([ow(),sp(),L0()]);me(vr),J(Mr),Qr(Wt||[]),console.log("Loaded data:",{routes:vr.length,buses:Mr.length,alerts:(Wt||[]).length,alertsData:Wt}),Wt&&Wt.length>0?console.log("Alerts loaded successfully:",Wt):console.warn("No alerts loaded or alerts is empty"),console.log(`Creating ${tt?"road-snapped":"straight-line"} geometries for database routes...`);const Fn=await Ln(vr,tt);Ee(Fn),Me(!1)}catch(vr){console.error("Failed to load map data:",vr),me([]),J([]),Ee([]),Qr([]),Me(!1)}})()},[tt]),ee.useEffect(()=>{if(!st)return;const vr=setTimeout(()=>{if(!navigator.geolocation){console.warn("Geolocation is not supported by this browser"),Te("Geolocation is not supported by this browser");return}Fe(!0),Te(null),navigator.geolocation.getCurrentPosition(Mr=>{const{latitude:Wt,longitude:Fn}=Mr.coords,hs={lat:Wt,lng:Fn};cr(hs),Fe(!1),console.log("User location detected automatically:",hs),console.log("Centering map on:",Fn,Wt),U(Ci=>{const Zn={...Ci,longitude:Fn,latitude:Wt,zoom:15};return console.log("New viewState:",Zn),Zn}),us(Wt,Fn,sr),setTimeout(()=>{F.current&&F.current.getMap&&(console.log("Using mapRef to center on location"),F.current.getMap().flyTo({center:[Fn,Wt],zoom:15,duration:2e3,essential:!0}))},500)},Mr=>{console.warn("Could not get user location automatically:",Mr),Te("Location access denied. Using default view."),Fe(!1)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5})},1e3);return()=>clearTimeout(vr)},[st]),ee.useEffect(()=>{const Mt=setInterval(async()=>{try{const vr=await sp();J(vr),Ye(new Date)}catch(vr){console.error("Failed to fetch buses:",vr)}},1e4);return()=>clearInterval(Mt)},[]);const Hi=ee.useCallback(()=>{F.current&&F.current.getMap&&!lt&&(kt(!0),F.current.getMap().flyTo({center:[38.7636,9.0054],zoom:13,duration:1200,essential:!0}),setTimeout(()=>{kt(!1)},1200))},[lt]),Cr=ee.useCallback(()=>{if(!navigator.geolocation){Te("Geolocation is not supported by this browser");return}Fe(!0),Te(null),navigator.geolocation.getCurrentPosition(Mt=>{const{latitude:vr,longitude:Mr}=Mt.coords,Wt={lat:vr,lng:Mr};cr(Wt),Fe(!1),F.current&&F.current.getMap&&F.current.getMap().flyTo({center:[Mr,vr],zoom:15,duration:1500,essential:!0}),console.log("User location detected:",Wt)},Mt=>{console.error("Error getting location:",Mt),Te("Unable to get your location. Please check permissions."),Fe(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},[]),us=ee.useCallback(async(Mt,vr,Mr=sr)=>{try{console.log(`Fetching nearby stops within ${Mr}m of ${Mt}, ${vr}`);const Wt=await iw(Mt,vr,Mr);xr(Wt),console.log(`Found ${Wt.length} nearby stops`)}catch(Wt){console.error("Failed to fetch nearby stops:",Wt),xr([])}},[sr]),di=ee.useCallback(()=>{ir?U(Mt=>({...Mt,longitude:ir.lng,latitude:ir.lat,zoom:15})):Cr()},[ir,Cr]),Fo=ee.useCallback(async()=>{if(!De){$t(!0);try{console.log("Refreshing database bus data...");const Mt=await sp();J(Mt),Ye(new Date),console.log(`Updated ${Mt.length} buses`)}catch(Mt){console.error("Failed to refresh buses:",Mt)}finally{$t(!1)}}},[De]);ee.useEffect(()=>{const Mt=()=>{Hi()};return window.addEventListener("recenterMap",Mt),()=>window.removeEventListener("recenterMap",Mt)},[Hi]);const nn=ee.useCallback(Mt=>{j&&j(Mt);const vr=Y.find(Mr=>Mr.id===Mt.route_id);vr&&p&&p(vr),F.current&&F.current.getMap&&F.current.getMap().flyTo({center:[Mt.lng,Mt.lat],zoom:Math.max(s.zoom,15),duration:800})},[j,p,s.zoom,Y]),yi=u?G.filter(Mt=>String(Mt.route_id)===String(u.id)):G;return v.jsxs("div",{className:"relative h-full w-full",children:[v.jsx(fo,{children:(He||St)&&v.jsx(rr.div,{initial:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-gray-50 dark:bg-gray-900 flex items-center justify-center z-50",children:v.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[v.jsx(Yg,{className:"w-8 h-8 text-primary-600 animate-spin"}),v.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:St?"Getting your location...":"Loading transit data..."})]})})}),v.jsxs(Gm,{ref:F,...s,style:{width:"100%",height:"100%"},mapStyle:Re,accessToken:Z3,onViewportChange:U,onClick:Mt=>{E&&Mt&&Mt.lngLat&&E({lng:Mt.lngLat.lng,lat:Mt.lngLat.lat})},onLoad:()=>{Me(!1),Gt(!0)},children:[Ae.map(Mt=>!Y.find(Mr=>Mr.id===Mt.route_id)||!Mt.geometry?null:v.jsx(rp,{id:`route-line-${Mt.route_id}`,type:"geojson",data:{type:"Feature",geometry:Mt.geometry},children:v.jsx(ju,{id:`route-line-layer-${Mt.route_id}`,type:"line",source:`route-line-${Mt.route_id}`,paint:{"line-color":Mt.color,"line-width":u?.id===Mt.route_id?6:4,"line-opacity":u?.id===Mt.route_id?1:.6}})},`route-${Mt.route_id}`)),v.jsx(fo,{children:yi.map(Mt=>v.jsx(D3,{bus:{...Mt,id:Mt.bus_id,lat:Mt.last_lat,lng:Mt.last_lng,vehicle_number:Mt.plate_number,speed:0,heading:0,passengers:Mt.passengers,max_capacity:Mt.max_capacity},route:Y.find(vr=>String(vr.id)===String(Mt.route_id)),onClick:()=>nn({...Mt,id:Mt.bus_id,lat:Mt.last_lat,lng:Mt.last_lng,vehicle_number:Mt.plate_number,speed:0,heading:0,passengers:Mt.passengers,max_capacity:Mt.max_capacity}),isSelected:P?.id===Mt.bus_id},Mt.bus_id))}),ir&&v.jsxs(v.Fragment,{children:[v.jsx(rp,{id:`user-location-circle-${ir.lng}-${ir.lat}`,type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[ir.lng,ir.lat]},properties:{radius:sr}},children:v.jsx(ju,{id:`user-location-circle-layer-${ir.lng}-${ir.lat}`,type:"circle",source:`user-location-circle-${ir.lng}-${ir.lat}`,paint:{"circle-radius":{stops:[[0,0],[20,sr]],base:2},"circle-color":"#fbbf24","circle-opacity":.3,"circle-stroke-color":"#f59e0b","circle-stroke-width":4,"circle-stroke-opacity":.8}},`user-circle-layer-${Date.now()}`)},`user-circle-source-${Date.now()}`),v.jsx(qh,{longitude:ir.lng,latitude:ir.lat,anchor:"center",children:v.jsxs(rr.div,{className:"relative",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:300,damping:20},children:[v.jsx(rr.div,{className:"absolute inset-0 w-8 h-8 rounded-full border-2 border-blue-500",animate:{scale:[1,1.5,1],opacity:[.7,0,.7]},transition:{duration:2,repeat:Number.POSITIVE_INFINITY,ease:"easeInOut"}}),v.jsx(rr.div,{className:"absolute inset-0 w-6 h-6 rounded-full border-2 border-blue-400",animate:{scale:[1,1.3,1],opacity:[.5,0,.5]},transition:{duration:1.5,repeat:Number.POSITIVE_INFINITY,ease:"easeInOut",delay:.5}}),v.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:v.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]})})]}),Ot.map(Mt=>v.jsx(qh,{longitude:Mt.lng,latitude:Mt.lat,anchor:"bottom",children:v.jsxs(rr.div,{className:"relative cursor-pointer",initial:{scale:0,y:10},animate:{scale:1,y:0},transition:{type:"spring",stiffness:300,damping:20},whileHover:{scale:1.1},title:`${Mt.name} - ${Mt.route_short_name||Mt.route_name}`,children:[v.jsx("div",{className:"w-6 h-6 bg-white dark:bg-gray-800 rounded-full border-2 border-green-500 shadow-lg flex items-center justify-center",children:v.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"})}),v.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full border-2 border-white dark:border-gray-800 shadow-sm",style:{backgroundColor:Mt.route_color||"#3b82f6"}})]})},Mt.id)),g&&v.jsx(qh,{longitude:g.lng,latitude:g.lat,anchor:"bottom",children:v.jsx("div",{className:"w-3 h-3 rounded-full ring-2 ring-white dark:ring-gray-900",style:{backgroundColor:"#16a34a"}})}),w&&v.jsx(qh,{longitude:w.lng,latitude:w.lat,anchor:"bottom",children:v.jsx("div",{className:"w-3 h-3 rounded-full ring-2 ring-white dark:ring-gray-900",style:{backgroundColor:"#ef4444"}})})]}),v.jsx(rr.button,{onClick:di,disabled:St,className:"absolute bottom-6 right-6 w-12 h-12 bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300 rounded-full shadow-lg border border-blue-600 flex items-center justify-center transition-colors z-10 disabled:opacity-50",whileHover:{scale:1.05},whileTap:{scale:.95},animate:St?{rotate:360}:{rotate:0},transition:{duration:St?1:.2},"aria-label":"Refresh my location",title:"Refresh and center on your location",children:St?v.jsx(Yg,{className:"w-5 h-5 text-white animate-spin"}):v.jsxs("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),v.jsx(rr.button,{onClick:Hi,disabled:lt,className:"absolute bottom-6 right-20 w-12 h-12 bg-white dark:bg-gray-800 rounded-full shadow-lg border border-gray-200 dark:border-gray-700 flex items-center justify-center hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors z-10 disabled:opacity-50",whileHover:{scale:1.05},whileTap:{scale:.95},animate:lt?{rotate:360}:{rotate:0},transition:{duration:lt?1.2:.2},"aria-label":"Recenter to Addis Ababa",title:"Center on Addis Ababa",children:lt?v.jsx(Yg,{className:"w-5 h-5 text-gray-600 dark:text-gray-400 animate-spin"}):v.jsx(y1,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),v.jsx(rr.button,{onClick:()=>it(!tt),className:`absolute bottom-6 right-32 w-12 h-12 rounded-full shadow-lg border flex items-center justify-center transition-colors z-10 ${tt?"bg-green-500 hover:bg-green-600 border-green-600 text-white":"bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400"}`,whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":tt?"Disable road snapping":"Enable road snapping",title:tt?"Road snapping enabled - database routes follow roads":"Road snapping disabled - straight lines between database stops",children:tt?v.jsx(Ef,{className:"w-5 h-5"}):v.jsx(_1,{className:"w-5 h-5"})}),v.jsx(rr.button,{onClick:Fo,disabled:De,className:"absolute bottom-6 right-44 w-12 h-12 bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300 rounded-full shadow-lg border border-blue-600 flex items-center justify-center transition-colors z-10 disabled:opacity-50",whileHover:{scale:1.05},whileTap:{scale:.95},animate:De?{rotate:360}:{rotate:0},transition:{duration:De?1:.2},"aria-label":"Refresh bus locations",title:"Refresh database bus locations",children:v.jsx(Sf,{className:"w-5 h-5 text-white"})}),v.jsx(rr.button,{onClick:()=>Jr(!nr),className:"absolute bottom-6 right-56 w-12 h-12 bg-gray-600 hover:bg-gray-700 rounded-full shadow-lg border border-gray-500 flex items-center justify-center transition-colors z-10",whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":"Simulation controls",title:"Bus simulation controls",children:v.jsx(AE,{className:"w-5 h-5 text-white"})}),v.jsx(fo,{children:nr&&v.jsxs(rr.div,{className:"absolute bottom-20 right-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-4 z-20 min-w-64",initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.95},transition:{duration:.2},children:[v.jsxs("div",{className:"flex items-center justify-between mb-3",children:[v.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Bus Simulation"}),v.jsx("button",{onClick:()=>Jr(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"×"})]}),ut&&v.jsxs("div",{className:"space-y-2 text-xs text-gray-600 dark:text-gray-400",children:[v.jsxs("div",{children:["Status: ",v.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Running"})]}),v.jsxs("div",{children:["Buses: ",ut.busCount]}),v.jsxs("div",{children:["Routes: ",ut.routes]}),v.jsxs("div",{children:["Last Update: ",ut.lastUpdate?.toLocaleTimeString()]})]}),v.jsxs("div",{className:"mt-3 space-y-2",children:[v.jsx("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:"Add Bus to Route:"}),v.jsx("div",{className:"flex flex-wrap gap-1",children:Y.map(Mt=>v.jsxs("button",{onClick:async()=>{try{await N3(Mt.id);const vr=await sw();J(vr)}catch(vr){console.error("Failed to add bus:",vr)}},className:"px-2 py-1 text-xs rounded",style:{backgroundColor:Mt.color+"20",color:Mt.color,border:`1px solid ${Mt.color}`},children:["+",Mt.shortName]},Mt.id))})]})]})}),v.jsxs(rr.div,{className:"absolute top-4 left-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 px-3 py-2 z-10",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.5},children:[v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx(rr.div,{className:"w-2 h-2 bg-green-500 rounded-full",animate:{opacity:[1,.3,1]},transition:{duration:2,repeat:Number.POSITIVE_INFINITY}}),v.jsx("span",{className:"text-xs font-medium text-gray-900 dark:text-gray-100",children:"Database"}),v.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[G.length," buses | ",Math.floor((new Date-$e)/1e3),"s ago"]})]}),v.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Real-time bus tracking"}),ir&&v.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:[Ot.length," stops within ",(sr/1e3).toFixed(1),"km"]})]}),ir&&v.jsxs(rr.div,{className:"absolute top-4 right-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 px-4 py-3 z-10 min-w-48",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.7},children:[v.jsx("div",{className:"text-xs font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Search Radius"}),v.jsxs("div",{className:"flex items-center space-x-3",children:[v.jsx("input",{type:"range",min:"1000",max:"5000",step:"250",value:sr,onChange:Mt=>{const vr=parseInt(Mt.target.value);Ur(vr),us(ir.lat,ir.lng,vr)},className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer"}),v.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-400 min-w-12",children:[(sr/1e3).toFixed(1),"km"]})]}),v.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[Ot.length," stops found"]})]}),v.jsx(fo,{children:_t&&v.jsx(rr.div,{className:"absolute top-4 right-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg shadow-lg px-3 py-2 z-20 max-w-xs",initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("div",{className:"w-4 h-4 text-yellow-500 flex-shrink-0",children:v.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:v.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),v.jsx("div",{className:"flex-1",children:v.jsx("div",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:_t})}),v.jsx("button",{onClick:()=>Te(null),className:"text-yellow-400 hover:text-yellow-600 dark:hover:text-yellow-300",children:v.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:v.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})})})]})},H3=({route:u,busData:p,busStatusData:g=[],onClick:w})=>v.jsx(rr.div,{className:"bg-white dark:bg-gray-800 rounded-2xl p-3 cursor-pointer hover:shadow-lg transition-all duration-200 border border-gray-100 dark:border-gray-700",onClick:w,whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:v.jsxs("div",{className:"flex items-start justify-between",children:[v.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[v.jsx("div",{className:"w-14 h-14 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-sm flex-shrink-0",style:{backgroundColor:u.color},children:u.shortName}),v.jsxs("div",{className:"flex-1 min-w-0 pt-1",children:[v.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[v.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:u.name}),u.type==="express"&&v.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300 rounded-full",children:"Express"})]}),v.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:u.description}),v.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400",children:[v.jsxs("div",{className:"flex items-center space-x-1",children:[v.jsx(Bc,{className:"w-4 h-4"}),v.jsx("span",{children:p.nextArrival})]}),v.jsxs("div",{className:"flex items-center space-x-1",children:[v.jsx(op,{className:"w-4 h-4"}),v.jsxs("span",{children:[p.activeBuses," buses"]})]})]}),g.length>0&&v.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[g.slice(0,2).map((E,P)=>v.jsxs("div",{className:"flex items-center space-x-1 text-xs bg-gray-50 dark:bg-gray-700 px-2 py-1 rounded",children:[v.jsx("span",{className:"text-sm",children:E.status_emoji}),v.jsxs("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:[E.passengers,"/",E.max_capacity]})]},E.bus_id||P)),g.length>2&&v.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-500 bg-gray-50 dark:bg-gray-700 px-2 py-1 rounded",children:["+",g.length-2]})]})]})]}),v.jsxs("div",{className:"flex flex-col items-end space-y-2 flex-shrink-0 ml-2",children:[v.jsxs("div",{className:"text-right",children:[v.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:p.nextArrival.replace(" min","")}),v.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:"minutes"})]}),v.jsx(pE,{className:"w-5 h-5 text-gray-400"})]})]})}),X3=({isOpen:u,onToggle:p,selectedRoute:g,onRouteSelect:w,selectedBus:E,onBusSelect:P})=>{const j=jf(),[F,s]=ee.useState("Current location"),[U,G]=ee.useState(""),[J,Y]=ee.useState(null),[me,Ae]=ee.useState([]),[Ee]=ee.useState(["Great Theatre","Athens Chapel","Puck's Pharmacy","Shakespeare Ave"]),Re=[{name:"Meskel Square",lat:9.0054,lng:38.7636,type:"landmark"},{name:"Piazza",lat:9.0154,lng:38.7736,type:"landmark"},{name:"CMC Terminal",lat:9.0254,lng:38.7836,type:"terminal"},{name:"Bole Airport",lat:8.9954,lng:38.7536,type:"airport"},{name:"Kazanchis",lat:9.0054,lng:38.7436,type:"area"},{name:"Merkato",lat:8.9854,lng:38.7236,type:"market"},{name:"Arat Kilo",lat:9.0154,lng:38.7536,type:"area"},{name:"National Theatre",lat:9.0054,lng:38.7436,type:"landmark"},{name:"Addis Ababa University",lat:9.0054,lng:38.7636,type:"university"},{name:"Ethiopian Airlines",lat:8.9954,lng:38.7536,type:"office"},{name:"Sheraton Addis",lat:9.0054,lng:38.7636,type:"hotel"},{name:"Unity Park",lat:9.0054,lng:38.7636,type:"park"},{name:"Entoto Park",lat:9.0254,lng:38.7836,type:"park"},{name:"Lion of Judah",lat:9.0054,lng:38.7636,type:"monument"},{name:"Red Terror Martyrs Memorial",lat:9.0054,lng:38.7636,type:"memorial"}],Ue=(ut,vt)=>{if(!ut||ut.length<1)return[];const nr=ut.toLowerCase();return Re.filter(Jr=>Jr.name.toLowerCase().includes(nr)).slice(0,5).map(Jr=>Jr.name)},[He,Me]=ee.useState({}),[lt,kt]=ee.useState([]),[$e,Ye]=ee.useState([]),tt=ut=>He[ut]||{activeBuses:0,nextArrival:"--"},it=ut=>lt.filter(vt=>vt.route_id===ut),De=()=>{const ut=F;s(U),G(ut)},$t=()=>{const ut=Re.find(nr=>nr.name.toLowerCase().includes(F.toLowerCase())),vt=Re.find(nr=>nr.name.toLowerCase().includes(U.toLowerCase()));j("/trip-planner",{state:{from:ut||{name:F,lat:9.0054,lng:38.7636},to:vt||{name:U,lat:9.0154,lng:38.7736}}})};return ee.useEffect(()=>{ow().then(Ae).catch(()=>Ae([]));const ut=async()=>{try{const ir=await L0();Ye(ir||[])}catch(ir){console.error("Failed to fetch alerts:",ir)}},vt=async()=>{try{const ir=await sp();kt(ir)}catch(ir){console.error("Failed to fetch bus status:",ir)}};ut(),vt();const nr=setInterval(vt,3e4),Jr=setInterval(async()=>{try{const cr=(await sw()).reduce((Fe,_t)=>(Fe[_t.routeId]=Fe[_t.routeId]||[],Fe[_t.routeId].push(_t),Fe),{}),St=Object.fromEntries(Object.entries(cr).map(([Fe,_t])=>[Fe,{activeBuses:_t.length,nextArrival:`${Math.max(1,2+Math.floor(Math.random()*6))} min`}]));Me(St)}catch{}},5e3);return()=>{clearInterval(Jr),clearInterval(nr)}},[]),v.jsxs(v.Fragment,{children:[v.jsx(rr.div,{className:"fixed left-0 top-0 h-full bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-700 z-40 flex flex-col",initial:!1,animate:{width:u?400:0,opacity:u?1:0},transition:{duration:.3,ease:"easeInOut",opacity:{duration:u?.3:.1}},style:{overflow:"auto"},children:v.jsxs("div",{className:"w-full h-full flex flex-col",children:[v.jsxs("div",{className:"flex items-center justify-between px-4 py-6 border-b border-gray-200 dark:border-gray-700",children:[v.jsxs("div",{className:"flex items-center space-x-4",children:[v.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center shadow-lg",children:v.jsx(Jm,{className:"w-7 h-7 text-white"})}),v.jsxs("div",{children:[v.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"Transit"}),v.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Real-time tracking"})]})]}),v.jsx("button",{onClick:p,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:v.jsx(jE,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]}),v.jsxs("div",{className:"px-4 py-6 border-b border-gray-200 dark:border-gray-700",children:[v.jsx("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Plan Your Trip"}),v.jsxs("div",{className:"space-y-4",children:[v.jsx("div",{className:"relative",children:v.jsxs("div",{className:`flex items-center px-4 py-3 bg-gray-50 dark:bg-gray-800 rounded-xl border transition-colors ${J==="from"?"border-primary-500 bg-white dark:bg-gray-700":"border-gray-200 dark:border-gray-600"}`,children:[v.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500 mr-3 flex-shrink-0"}),v.jsx("input",{type:"text",placeholder:"From",value:F,onChange:ut=>s(ut.target.value),onFocus:()=>Y("from"),onBlur:()=>Y(null),className:"flex-1 bg-transparent border-none outline-none text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"}),v.jsx(d1,{className:"w-4 h-4 text-green-500 ml-2 flex-shrink-0"})]})}),v.jsx("div",{className:"flex justify-center",children:v.jsx("button",{onClick:De,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:v.jsx(aE,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})})}),v.jsx("div",{className:"relative",children:v.jsxs("div",{className:`flex items-center px-4 py-3 bg-gray-50 dark:bg-gray-800 rounded-xl border transition-colors ${J==="to"?"border-primary-500 bg-white dark:bg-gray-700":"border-gray-200 dark:border-gray-600"}`,children:[v.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500 mr-3 flex-shrink-0"}),v.jsx("input",{type:"text",placeholder:"To",value:U,onChange:ut=>G(ut.target.value),onFocus:()=>Y("to"),onBlur:()=>Y(null),className:"flex-1 bg-transparent border-none outline-none text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"}),v.jsx(vy,{className:"w-4 h-4 text-gray-400 ml-2 flex-shrink-0"})]})}),F&&U&&v.jsx(rr.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},onClick:$t,className:"w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-2xl transition-colors text-lg",children:"GO"}),v.jsx(fo,{children:J&&(F||U)&&v.jsx(rr.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-lg overflow-hidden",children:v.jsx("div",{className:"p-2",children:J==="from"&&F&&F!=="Current location"||J==="to"&&U?Ue(J==="from"?F:U).map((ut,vt)=>{const nr=Re.find(Jr=>Jr.name===ut);return v.jsxs("button",{onClick:()=>{J==="from"?s(ut):G(ut),Y(null)},className:"w-full flex items-center px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors text-left",children:[v.jsx(vy,{className:"w-4 h-4 text-gray-400 mr-3 flex-shrink-0"}),v.jsxs("div",{className:"flex-1",children:[v.jsx("span",{className:"text-sm text-gray-900 dark:text-gray-100",children:ut}),v.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2 capitalize",children:nr?.type})]})]},vt)}):Ee.slice(0,3).map((ut,vt)=>v.jsxs("button",{onClick:()=>{J==="from"?s(ut):G(ut),Y(null)},className:"w-full flex items-center px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors text-left",children:[v.jsx(wE,{className:"w-4 h-4 text-gray-400 mr-3 flex-shrink-0"}),v.jsx("span",{className:"text-sm text-gray-900 dark:text-gray-100",children:ut})]},vt))})})})]})]}),v.jsx("div",{className:"flex-1 overflow-y-auto",children:E?v.jsxs("div",{className:"px-4 py-6",children:[v.jsx("div",{className:"flex items-center justify-between mb-4",children:v.jsx("button",{onClick:()=>P(null),className:"text-sm text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 transition-colors",children:"← Back to routes"})}),v.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[v.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center text-white font-bold text-xl shadow-sm",style:{backgroundColor:g?.color||"#3b82f6"},children:g?.shortName||"BUS"}),v.jsxs("div",{children:[v.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:g?.name||"Bus Details"}),v.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:g?.description||`Route #${E.route_id||E.routeId}`})]})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[v.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-5",children:[v.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[v.jsx(Bc,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),v.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Next Arrival"})]}),v.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:typeof E.eta_minutes=="number"?E.eta_minutes:"Unknown"}),v.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"minutes"})]}),v.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-5",children:[v.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[v.jsx(op,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),v.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Active Buses"})]}),v.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:tt(g?.id||E.route_id).activeBuses}),v.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"buses"})]})]}),v.jsxs("div",{className:"mb-6",children:[v.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"Bus Details"}),v.jsx("div",{className:"space-y-2",children:v.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[v.jsxs("div",{className:"flex items-center justify-between mb-2",children:[v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("span",{className:"text-lg",children:"🚌"}),v.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:E.plate_number||E.vehicle_number||"N/A"})]}),v.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${(E.passengers||0)/(E.max_capacity||50)<.5?"bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300":(E.passengers||0)/(E.max_capacity||50)<.8?"bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300":"bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300"}`,children:[Math.round((E.passengers||0)/(E.max_capacity||50)*100),"% full"]})]}),v.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[v.jsxs("span",{children:["Passengers: ",E.passengers||0,"/",E.max_capacity||50]}),v.jsxs("span",{children:["Bus #",E.bus_number||E.id||"N/A"]})]}),E.next_stop&&v.jsxs("div",{className:"mt-2 text-sm text-gray-700 dark:text-gray-300",children:["Next stop: ",v.jsx("span",{className:"font-medium",children:E.next_stop})]}),v.jsx("div",{className:"mt-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:v.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${(E.passengers||0)/(E.max_capacity||50)<.5?"bg-green-500":(E.passengers||0)/(E.max_capacity||50)<.8?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min((E.passengers||0)/(E.max_capacity||50)*100,100)}%`}})})]})})]}),(()=>{const ut=[{id:"route-alert-1",title:"Heavy Traffic on Route",description:"Heavy traffic reported on this route. Expect delays of 10-15 minutes.",severity:"medium",type:"delay"},{id:"route-alert-2",title:"Construction Zone",description:"Road construction near Meskel Square may cause minor delays.",severity:"low",type:"disruption"}];return v.jsxs("div",{className:"mb-6",children:[v.jsxs("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:["⚠️ Route Alerts (",ut.length,")"]}),v.jsx("div",{className:"space-y-2",children:ut.map((vt,nr)=>v.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-3 border border-amber-200 dark:border-amber-800",children:v.jsx("div",{className:"flex items-start justify-between",children:v.jsxs("div",{className:"flex-1",children:[v.jsx("div",{className:"text-sm font-medium text-amber-900 dark:text-amber-100 mb-1",children:vt.title}),v.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300 mb-2",children:vt.description}),v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${vt.severity==="high"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300":vt.severity==="medium"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"}`,children:vt.severity?.toUpperCase()}),v.jsx("span",{className:"text-xs text-amber-600 dark:text-amber-400",children:vt.type?.replace("_"," ").toUpperCase()})]})]})})},vt.id||nr))})]})})(),g?.stops&&g.stops.length>0&&v.jsxs("div",{children:[v.jsxs("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:["Route Stops (",g.stops.length,")"]}),v.jsx("div",{className:"space-y-3",children:g.stops.map((ut,vt)=>v.jsxs("div",{className:"flex items-start space-x-3",children:[v.jsxs("div",{className:"relative mt-2",children:[v.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:g.color}}),vt<g.stops.length-1&&v.jsx("div",{className:"absolute top-3 left-1/2 w-0.5 h-8 -translate-x-1/2",style:{backgroundColor:g.color,opacity:.3}})]}),v.jsxs("div",{className:"flex-1 pb-4",children:[v.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-1",children:ut.name}),v.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Stop #",ut.sequence," • ",Number(ut.lat)?.toFixed(4),", ",Number(ut.lng)?.toFixed(4)]}),v.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[v.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300",children:[Math.max(1,2+Math.floor(Math.random()*6))," min"]}),v.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400",children:[Math.max(8,10+Math.floor(Math.random()*8))," min"]})]})]})]},ut.id))})]})]}):g?v.jsxs("div",{className:"px-4 py-6",children:[v.jsx("div",{className:"flex items-center justify-between mb-4",children:v.jsx("button",{onClick:()=>w(null),className:"text-sm text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 transition-colors",children:"← Back to routes"})}),v.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[v.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center text-white font-bold text-xl shadow-sm",style:{backgroundColor:g.color},children:g.shortName}),v.jsxs("div",{children:[v.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:g.name}),v.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:g.description})]})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[v.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-5",children:[v.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[v.jsx(Bc,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),v.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Next Arrival"})]}),v.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:tt(g.id).nextArrival.replace(" min","")}),v.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"minutes"})]}),v.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-5",children:[v.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[v.jsx(op,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),v.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Active Buses"})]}),v.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:tt(g.id).activeBuses}),v.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"buses"})]})]}),it(g.id).length>0&&v.jsxs("div",{className:"mb-6",children:[v.jsxs("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:["Bus Status (",it(g.id).length,")"]}),v.jsx("div",{className:"space-y-2",children:it(g.id).map(ut=>v.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[v.jsxs("div",{className:"flex items-center justify-between mb-2",children:[v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("span",{className:"text-lg",children:ut.status_emoji}),v.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:ut.plate_number})]}),v.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ut.status==="green"?"bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300":ut.status==="yellow"?"bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300":"bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300"}`,children:ut.status})]}),v.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[v.jsxs("span",{children:["Passengers: ",ut.passengers,"/",ut.max_capacity]}),v.jsxs("span",{children:[ut.fullness_percentage,"% full"]})]}),v.jsx("div",{className:"mt-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:v.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${ut.status==="green"?"bg-green-500":ut.status==="yellow"?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(ut.fullness_percentage,100)}%`}})})]},ut.bus_id))})]}),(()=>{const ut=$e.filter(vt=>{const nr=g?.route_number,Jr=vt.affected_routes&&(vt.affected_routes.includes(String(nr))||vt.affected_routes.includes(nr)),ir=vt.is_active!==!1;return Jr&&ir});return ut.length===0?null:v.jsxs("div",{className:"mb-6",children:[v.jsxs("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:["⚠️ Active Alerts (",ut.length,")"]}),v.jsx("div",{className:"space-y-2",children:ut.map((vt,nr)=>v.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-3 border border-amber-200 dark:border-amber-800",children:v.jsx("div",{className:"flex items-start justify-between",children:v.jsxs("div",{className:"flex-1",children:[v.jsx("div",{className:"text-sm font-medium text-amber-900 dark:text-amber-100 mb-1",children:vt.title}),v.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300 mb-2",children:vt.description}),v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${vt.severity==="high"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300":vt.severity==="medium"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"}`,children:vt.severity?.toUpperCase()}),v.jsx("span",{className:"text-xs text-amber-600 dark:text-amber-400",children:vt.type?.replace("_"," ").toUpperCase()})]})]})})},vt.id||nr))})]})})(),v.jsxs("div",{children:[v.jsxs("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:["Route Stops (",g.stops?.length||0,")"]}),v.jsxs("div",{className:"space-y-3",children:[(g.stops||[]).map((ut,vt)=>v.jsxs("div",{className:"flex items-start space-x-3",children:[v.jsxs("div",{className:"relative mt-2",children:[v.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:g.color}}),vt<(g.stops?.length||0)-1&&v.jsx("div",{className:"absolute top-3 left-1/2 w-0.5 h-8 -translate-x-1/2",style:{backgroundColor:g.color,opacity:.3}})]}),v.jsxs("div",{className:"flex-1 pb-4",children:[v.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-1",children:ut.name}),v.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Stop #",ut.sequence," • ",Number(ut.lat)?.toFixed(4),", ",Number(ut.lng)?.toFixed(4)]}),v.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[v.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300",children:[Math.max(1,2+Math.floor(Math.random()*6))," min"]}),v.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400",children:[Math.max(8,10+Math.floor(Math.random()*8))," min"]})]})]})]},ut.id)),(!g.stops||g.stops.length===0)&&v.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[v.jsx("div",{className:"text-sm",children:"No stops data available"}),v.jsx("div",{className:"text-xs mt-1",children:"Check your backend API"})]})]})]})]}):v.jsxs("div",{className:"px-4 py-6",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4",children:[v.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Nearby Routes"}),v.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[me.length," routes"]})]}),v.jsx("div",{className:"space-y-3",children:(me||[]).map(ut=>v.jsx("div",{className:"transform scale-95",children:v.jsx(H3,{route:ut,busData:tt(String(ut.id)),busStatusData:it(String(ut.id)),onClick:()=>w(ut)})},ut.id))})]})})]})}),v.jsx(fo,{children:!u&&v.jsx(rr.button,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},onClick:p,className:"fixed top-20 right-4 z-50 w-12 h-12 bg-white dark:bg-gray-800 rounded-full shadow-lg border border-gray-200 dark:border-gray-700 flex items-center justify-center hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors lg:flex","aria-label":"Open sidebar",children:v.jsx(kE,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})}),v.jsx(fo,{children:u&&v.jsx(rr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-25 z-30 lg:hidden",onClick:p})})]})},Za=({offsetLeft:u=0,leftAddon:p=null,containerStyle:g,containerClassName:w=""})=>{const E=[{path:"/",label:"Home"},{path:"/map",label:"Map",openSidebarOnMap:!0},{path:"/trip-planner",label:"Trip Planner"},{path:"/nearby",label:"Nearby"},{path:"/favorites",label:"Favorites"},{path:"/alerts",label:"Alerts"},{path:"/feedback",label:"Feedback"}],P=jf(),j=(()=>{try{return!!localStorage.getItem("admin_token")}catch{return!1}})();return v.jsx("div",{className:`sticky top-0 z-30 border-b border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 supports-[backdrop-filter]:dark:bg-gray-900/60 ${w}`,style:{paddingLeft:u,...g||{}},children:v.jsx("div",{className:"p-4",children:v.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[p,E.map(F=>v.jsx(o1,{to:F.path,onClick:()=>{if(F.openSidebarOnMap)try{localStorage.setItem("openSidebarOnMap","1")}catch{}},className:({isActive:s})=>`inline-flex items-center gap-2 px-3 py-2 rounded-xl text-sm transition-colors border shadow-sm ${s?"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white border-gray-200 dark:border-gray-700":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800/50 border-transparent"}`,children:v.jsx("span",{className:"font-medium",children:F.label})},`topbar-${F.path}`)),v.jsx("div",{className:"ml-auto"}),v.jsx("button",{onClick:()=>P(j?"/admin/dashboard":"/admin/login"),className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl text-sm transition-colors border shadow-sm bg-emerald-600 text-white hover:bg-emerald-700",children:j?"Dashboard":"Admin Login"})]})})})},fp=({darkMode:u,onToggle:p})=>v.jsx(rr.button,{onClick:p,className:"w-12 h-12 glass-effect rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":u?"Switch to light mode":"Switch to dark mode",children:v.jsx(rr.div,{initial:!1,animate:{rotate:u?180:0},transition:{duration:.3,ease:"easeInOut"},children:u?v.jsx(IE,{className:"w-5 h-5 text-yellow-500"}):v.jsx(CE,{className:"w-5 h-5 text-gray-600"})})}),K3=({darkMode:u,setDarkMode:p})=>{const[g,w]=ee.useState(!0),[E,P]=ee.useState(null),[j,F]=ee.useState(null);return ee.useEffect(()=>{try{localStorage.getItem("openSidebarOnMap")==="1"&&(w(!0),localStorage.removeItem("openSidebarOnMap"))}catch{}},[]),v.jsxs("div",{className:"h-full w-full relative",children:[g&&v.jsx("div",{className:"absolute left-[400px] right-0 top-0 z-20",children:v.jsx(Za,{offsetLeft:0,leftAddon:null,containerClassName:"relative top-[88px]"})}),!g&&v.jsx(Za,{offsetLeft:0,leftAddon:v.jsxs("button",{onClick:()=>w(!0),className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl text-sm transition-colors border text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800/50 border-transparent shadow-sm","aria-label":"Open sidebar",children:[v.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[v.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),v.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),v.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]}),v.jsx("span",{className:"font-medium",children:"Open"})]})}),v.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[400px] z-10",children:v.jsx(X3,{isOpen:g,onToggle:()=>w(!g),selectedRoute:E,onRouteSelect:P,selectedBus:j,onBusSelect:F})}),v.jsxs("div",{className:`h-full transition-all duration-300 ${g?"ml-[400px]":"ml-0"}`,children:[v.jsx(aw,{selectedRoute:E,onRouteSelect:P,selectedBus:j,onBusSelect:F}),v.jsx("div",{className:"absolute top-4 right-4 z-10",children:v.jsx(fp,{darkMode:u,onToggle:()=>p(!u)})})]})]})},Y3={en:{langName:"English",heroTitle:"AddisTransit – Real-time public transit for Addis Ababa",heroSubtitle:"A simple, fast, and multilingual app to find buses, plan trips, and navigate Addis Ababa with confidence.",ctaMap:"Open Map",ctaPlanner:"Plan a Trip",sectionAboutTitle:"What problem we solve",sectionAboutBody:"Finding reliable public transit information in Addis Ababa is hard. AddisTransit aggregates routes, stops, and simulated live bus positions to help riders discover nearby routes, check arrivals, and plan efficient trips — even on low connectivity devices.",featuresTitle:"Highlights",features:["Real-time bus tracking to reduce wait times","Smart trip scheduling with suggested departure windows","Live service alerts for delays, diversions, and closures","Offline-ready PWA for low connectivity conditions","Crowding-aware demand predictions (AI-assisted)"],faqTitle:"Frequently asked questions",faqs:[{q:"Is the data real-time?",a:"The demo uses a realistic simulation. It can connect to live feeds when available."},{q:"Does it work offline?",a:"Yes, it is a PWA and caches key assets."},{q:"Which areas are covered?",a:"Addis Ababa routes are included first; we plan to expand coverage."},{q:"How can I contribute?",a:"Share feedback, routes, and stops data or help translate the interface."}],teamTitle:"Team",team:[{name:"Deresani Yetnayet",role:"Fullstack Developer"},{name:"Naol Kebede",role:"Fullstack Developer"},{name:"Achenef Tarekegn",role:"Marketing"},{name:"Demewez Demeke",role:"AI Modelist"},{name:"Mulu Berhan",role:"Sales Manager"}]},am:{langName:"አማርኛ",heroTitle:"AddisTransit – የአዲስ አበባ የህዝብ ትራንዚት መረጃ",heroSubtitle:"አብራሪ ፈጣን እና ቀላል መተግበሪያ ለአዲስ አበባ ባስ መፈለግ፣ ጉዞ መከተት እና መቃኘት.",ctaMap:"ካርታ ክፈት",ctaPlanner:"ጉዞ አዘጋጅ",sectionAboutTitle:"የምንፈታው ችግኝ",sectionAboutBody:"በአዲስ አበባ የህዝብ ትራንዚት መረጃ ማግኘት አስቸጋሪ ነው። AddisTransit መንገዶችን፣ ማቆሚያዎችን እና እውነተኛን የመሳሰሉ ህይወት ባስ እንቅስቃሴ ይያዛል እና ተጓዦች መንገዶችን እንዲያገኙ እና ጊዜያትን እንዲመርምሩ ይረዳቸዋል.",featuresTitle:"ልዩ ባህሪዎች",features:["የባስ እንቅስቃሴን በእውነተኛ ጊዜ መመልከት","አስተካክሎ የጊዜ ሰሌዳ ጥቆማ እና ምክር","ስለ መዘግየት፣ መሻር እና መዘግየት ማስታወቂያዎች","በዝቅተኛ ኢንተርኔት ሁኔታ የሚሰራ የPWA ዝግጁነት","በአብዛኛው ጊዜ ተጭነት በመመከት የAI ትንታኔ"],faqTitle:"ተደጋጋሚ ጥያቄዎች",faqs:[{q:"መረጃው በእውነተኛ ጊዜ ነው?",a:"አሁን ለማሳየት ልምድ ስርዓት እንጠቀማለን። እውነተኛ ምንጮች ሲኖሩ ሊገናኙ ይችላሉ።"},{q:"ከመስመር ውጭ ይሰራል?",a:"አዎን፣ PWA ነው እና ዋና ንብረቶችን ይከማቻል።"},{q:"የተሸፈነው አካባቢ?",a:"በመጀመሪያ አዲስ አበባ መንገዶች ናቸው፣ መስፋፋት እንደሚኖር እቅድ አለ።"},{q:"እንዴት ልረዳ?",a:"አስተያየት ያካፍሉ፣ መንገዶችን እና ማቆሚያዎችን ያካትቱ ወይም ትርጉም ይሁኑ።"}],teamTitle:"ቡድን",team:[{name:"Deresani Yetnayet",role:"Fullstack Developer"},{name:"Naol Kebede",role:"Fullstack Developer"},{name:"Achenef Tarekegn",role:"Marketing"},{name:"Demewez Demeke",role:"AI Modelist"},{name:"Mulu Berhan",role:"Marketing"}]},om:{langName:"Afaan Oromoo",heroTitle:"AddisTransit – Tajaajila ittiin imaltuu uummataa Addis Ababa",heroSubtitle:"App salphaa fi saffisaa, bitaa fi mirga imala kee qindeesu, bussiwwan argachuuf, akkasumas karaa keessa of qajeelchuuf.",ctaMap:"Kaartaa Bani",ctaPlanner:"Imala Qindeessi",sectionAboutTitle:"Rakkoo inni hiiku",sectionAboutBody:"Odeeffannoo imalaa uummataa argachuun garaagara. AddisTransit karaa, iddoo dhaabbataa fi odeeffannoo bussiwwan akkuma yeroo dhugaa fakkaatu walitti qaba; imaltoonni karaa naannoo argachuu fi imala gaarii qindeessu ni danda'u.",featuresTitle:"Amaloota",features:["Bussiwwan yeroo dhugaa hordofuu (yeroo eeggannoo xiqqeessuuf)","Tartiiba imalaa ogummaa qabu fi yaadannoo yeroo deemsisa","Oduu tajaajila (tuffii, jijjiirraa, cufamuu) yeroo dhugaa","PWA sirrii sababa qunnamtii gadi-aanaa irrattis ni hojjetti","Tuma’ina baay’ina imaltootaa (AI tajaajilaan)"],faqTitle:"Gaaffilee yeroo baay'ee gaafataman",faqs:[{q:"Odeeffannoon yeroo dhugaati?",a:"Fakkeenya tajaajila tajaajilaa fayyadamna; yeroo jiraatuu waliin walitti ni hidhama."},{q:"Offline ni hojjetaa?",a:"Eeyyee, PWA dha; qabeenya ijoo ni kuufa."},{q:"Eessa qofa tajaajiluu?",a:"Addis Ababa jalqabaa; bal'inaan tajaajiluu ni karoorfanna."},{q:"Akkaataa gargaarsa?",a:"Yaada kennaa, odeeffannoo karaa fi dhaabbataa qoodaa yookaan hiika dabalataa godhaa."}],teamTitle:"Hojii geggeessitoota",team:[{name:"Deresani Yetnayet",role:"Fullstack Developer"},{name:"Naol Kebede",role:"Fullstack Developer"},{name:"Achenef Tarekegn",role:"Marketing"},{name:"Demewez Demeke",role:"AI Modelist"},{name:"Mulu Berhan",role:"Marketing"}]},ti:{langName:"ትግርኛ",heroTitle:"AddisTransit – ሕቡራት መጓዓዝ ንኣዲስ ኣበባ",heroSubtitle:"መተግበሪ ቀሊል እና ብጣዕሚ ብፍጥነት ንኣስራሕ መንገዲ ፍልስልሲ እና መብት ምዕጋዝ.",ctaMap:"ካርታ ክፈት",ctaPlanner:"መጓዓዝ ኣዘጋጅ",sectionAboutTitle:"ጸገም እንታይ ክፈትና እዩ",sectionAboutBody:"ናይ ሕቡራት መጓዓዝ መረጃ ብኣዲስ ኣበባ ምርካብ ኣስቸጋሪ እዩ። AddisTransit መንገዶችን፣ ማቆሚያዎችን እና ዝመስል እውነት ዝረኣየ ንቡስ እንቅስቃሴ ይኣክል እና ጓዕዞታት ናይ ኣብ ቀረባ መንገዶች ምርካብ እና ግዜ ምርመራ ይሕግዝ።",featuresTitle:"ምርጥ ባህሪታት",features:["ናይ ንቡስ እንቅስቃሴ እቲ ኣብ ሕጂ ግዜ ምርካብ","ግዜ ሰሌዳ ብምትካከል ኣብ ምድላው ምክር","ንመዘግየት/ምሻር/ምዝጋብ ሓበሬታታት ኣብ ሕጂ ግዜ","PWA ምዕባለ እና ናይ ብቕልጡፍ መስመር ስርሕ ዝሓለፈ","ብAI ትንተና ናይ ተመራማሪ ዝርከብ ብዝሒ ተጓዥቲ"],faqTitle:"ብዝሒ ዝሓለፉ ሕቶታት",faqs:[{q:"መረጃ እውነት እዩ?",a:"ምርካብ ሞዴል ንምርካብ እንጠቕመር። እውነት ምንጪ ኣብ ምኻን ክትዕር ይኽእል።"},{q:"ካብ መስመር ውጽኣት ይሰርሕ?",a:"እወ፣ PWA እዩ እና ኣብ ዋና ንብረታት ይከማቻ።"},{q:"ናበይ ይሸፍን?",a:"ኣዲስ ኣበባ ብጀማምረ; ምስፋፋሕ ንምእካይ እትኽእል።"},{q:"ከመይ ክትሓግዙ?",a:"ምኽሪ ኣቕርቡ፣ መንገዶችን እና ማቆሚያዎችን ኣካፍሉ ወይ ትርጓሜ ሓግዙ።"}],teamTitle:"ቡድን",team:[{name:"Deresani Yetnayet",role:"Fullstack Developer"},{name:"Naol Kebede",role:"Fullstack Developer"},{name:"Achenef Tarekegn",role:"Marketing"},{name:"Demewez Demeke",role:"AI Modelist"},{name:"Mulu Berhan",role:"Marketing"}]}};function J3(){const[u,p]=ee.useState("en"),g=ee.useMemo(()=>Y3[u],[u]);return v.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 text-gray-900 dark:text-gray-100",children:[v.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[v.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),v.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),v.jsx(Za,{containerClassName:"border-0 bg-transparent"}),v.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[v.jsx("div",{className:"flex justify-end pt-6",children:v.jsxs("select",{"aria-label":"Language",value:u,onChange:w=>p(w.target.value),className:"bg-white/90 backdrop-blur dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2 text-sm shadow-sm",children:[v.jsx("option",{value:"en",children:"English"}),v.jsx("option",{value:"am",children:"አማርኛ"}),v.jsx("option",{value:"om",children:"Afaan Oromoo"}),v.jsx("option",{value:"ti",children:"ትግርኛ"})]})}),v.jsx("section",{className:"py-12 md:py-20",children:v.jsxs("div",{className:"grid md:grid-cols-2 gap-8 items-center",children:[v.jsxs("div",{children:[v.jsxs("span",{className:"inline-flex items-center gap-2 text-xs uppercase tracking-wider text-emerald-700 bg-emerald-100 dark:text-emerald-300 dark:bg-emerald-900/40 px-3 py-1 rounded-full",children:[v.jsx(Yy,{className:"h-3.5 w-3.5"})," AddisTransit"]}),v.jsxs("div",{className:"flex items-center gap-3 mt-3 mb-4",children:[v.jsx("img",{src:"/transitlogo.png",alt:"AddisTransit logo",className:"h-36 w-36 rounded-lg shadow-sm"}),v.jsx("h1",{className:"text-3xl md:text-5xl font-extrabold tracking-tight m-0",children:g.heroTitle})]}),v.jsx("p",{className:"text-lg md:text-xl text-gray-600 dark:text-gray-300 max-w-3xl",children:g.heroSubtitle}),v.jsxs("div",{className:"mt-8 flex flex-wrap gap-3",children:[v.jsx("a",{href:"/map",className:"px-5 py-3 rounded-xl bg-green-600 hover:bg-green-700 text-white font-medium shadow",children:g.ctaMap}),v.jsx("a",{href:"/trip-planner",className:"px-5 py-3 rounded-xl border border-gray-300 dark:border-gray-700 bg-white/80 dark:bg-gray-900/60 hover:bg-white text-gray-900 dark:text-gray-100 font-medium shadow-sm",children:g.ctaPlanner}),v.jsx("a",{href:"/about",className:"px-5 py-3 rounded-xl border border-gray-300 dark:border-gray-700 bg-white/80 dark:bg-gray-900/60 hover:bg-white text-gray-900 dark:text-gray-100 font-medium shadow-sm",children:"Learn More"})]})]}),v.jsxs("div",{className:"relative hidden md:block",children:[v.jsx("div",{className:"absolute -inset-6 rounded-3xl bg-gradient-to-tr from-green-500/20 to-emerald-500/20 blur-2xl"}),v.jsx("div",{className:"relative rounded-3xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-6 shadow-xl",children:v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsx(jm,{icon:v.jsx(Ef,{className:"h-5 w-5"}),title:"Real-time Tracking",children:"Live bus locations to reduce wait times"}),v.jsx(jm,{icon:v.jsx(PE,{className:"h-5 w-5"}),title:"Smart Scheduling",children:"Suggested departure windows based on demand"}),v.jsx(jm,{icon:v.jsx(xy,{className:"h-5 w-5"}),title:"Service Alerts",children:"Delays, diversions, and closures in real time"}),v.jsx(jm,{icon:v.jsx(TE,{className:"h-5 w-5"}),title:"Offline-ready PWA",children:"Works great on low connectivity and installs to home screen"})]})})]})]})}),v.jsx("section",{className:"py-12 border-t border-gray-200 dark:border-gray-800",children:v.jsxs("div",{className:"md:flex md:items-start md:gap-8",children:[v.jsx("div",{className:"md:w-1/3 mb-4 md:mb-0",children:v.jsx("h2",{className:"text-2xl font-bold",children:g.sectionAboutTitle})}),v.jsx("div",{className:"md:flex-1",children:v.jsx("p",{className:"text-gray-700 dark:text-gray-300 max-w-4xl leading-relaxed",children:g.sectionAboutBody})})]})}),v.jsxs("section",{className:"py-12 border-t border-gray-200 dark:border-gray-800",children:[v.jsx("h3",{className:"text-xl font-semibold mb-6",children:g.featuresTitle}),v.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:g.features.map((w,E)=>v.jsx("div",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/70 dark:bg-gray-900/60 p-5 shadow-sm",children:v.jsxs("div",{className:"flex items-start gap-3",children:[v.jsx("span",{className:"mt-1 inline-block h-2.5 w-2.5 rounded-full bg-emerald-500"}),v.jsx("div",{className:"text-gray-700 dark:text-gray-300",children:w})]})},E))})]}),v.jsxs("section",{className:"py-12 border-t border-gray-200 dark:border-gray-800",children:[v.jsx("h3",{className:"text-xl font-semibold mb-6",children:g.faqTitle}),v.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:g.faqs.map((w,E)=>v.jsx("div",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 p-5 bg-white/70 dark:bg-gray-900/60 shadow-sm",children:v.jsxs("div",{className:"flex items-start gap-3",children:[v.jsx(xy,{className:"h-5 w-5 text-emerald-600 dark:text-emerald-400 mt-0.5"}),v.jsxs("div",{children:[v.jsx("div",{className:"font-semibold mb-1",children:w.q}),v.jsx("div",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:w.a})]})]})},E))})]}),v.jsxs("section",{className:"py-12 border-t border-gray-200 dark:border-gray-800",children:[v.jsx("h3",{className:"text-xl font-semibold mb-6",children:g.teamTitle}),v.jsx("div",{className:"grid sm:grid-cols-2 md:grid-cols-3 gap-4",children:g.team.map(w=>v.jsx("div",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 p-5 bg-white/70 dark:bg-gray-900/60 shadow-sm",children:v.jsxs("div",{className:"flex items-center gap-4",children:[v.jsx("div",{className:"h-12 w-12 rounded-full bg-emerald-600 text-white flex items-center justify-center font-bold shadow",children:Q3(w.name)}),v.jsxs("div",{children:[v.jsxs("div",{className:"text-base font-semibold flex items-center gap-2",children:[w.name,v.jsx(op,{className:"h-4 w-4 text-emerald-600 dark:text-emerald-400"})]}),v.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:w.role})]})]})},w.name))})]})]}),v.jsxs("footer",{className:"py-8 border-t border-gray-200 dark:border-gray-800 text-center text-sm text-gray-600 dark:text-gray-400",children:["© ",new Date().getFullYear()," AddisTransit"]})]})}function jm({icon:u,title:p,children:g}){return v.jsx("div",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/70 dark:bg-gray-900/60 p-4 shadow-sm",children:v.jsxs("div",{className:"flex items-start gap-3",children:[v.jsx("div",{className:"h-9 w-9 rounded-lg bg-emerald-600/10 text-emerald-700 dark:text-emerald-300 flex items-center justify-center",children:u}),v.jsxs("div",{children:[v.jsx("div",{className:"font-semibold mb-0.5",children:p}),v.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:g})]})]})})}function Q3(u){return u.split(" ").map(p=>p[0]).slice(0,2).join("").toUpperCase()}function eP(){const[u,p]=ee.useState(""),[g,w]=ee.useState(!1),[E,P]=ee.useState(""),[j,F]=ee.useState({route:"",busNumber:"",plateNumber:"",feedback:""});ee.useEffect(()=>{let G=!1;return(async()=>{try{const me=await(await fetch("https://api.ipify.org?format=json")).json();G||p(me?.ip||"")}catch{try{const Ae=await(await fetch("https://ipapi.co/json/")).json();G||p(Ae?.ip||"")}catch{G||p("")}}})(),()=>{G=!0}},[]);const s=ee.useMemo(()=>j.route.trim().length>0&&j.busNumber.trim().length>0&&j.plateNumber.trim().length>0&&j.feedback.trim().length>3,[j]),U=async G=>{if(G.preventDefault(),!!s){w(!0),P("");try{await z3({route:j.route,busNumber:j.busNumber,plateNumber:j.plateNumber,feedback:j.feedback,ip:u,userAgent:navigator.userAgent,locale:navigator.language}),F({route:"",busNumber:"",plateNumber:"",feedback:""}),P("Feedback submitted. Thank you!")}finally{w(!1)}}};return v.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 text-gray-900 dark:text-gray-100",children:[v.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[v.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),v.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),v.jsx(Za,{containerClassName:"border-0 bg-transparent"}),v.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-10",children:[v.jsxs("div",{className:"mb-8",children:[v.jsxs("span",{className:"inline-flex items-center gap-2 text-xs uppercase tracking-wider text-emerald-700 bg-emerald-100 dark:text-emerald-300 dark:bg-emerald-900/40 px-3 py-1 rounded-full",children:[v.jsx(Tx,{className:"h-3.5 w-3.5"})," Feedback"]}),v.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold tracking-tight mt-3 mb-2",children:"Share your bus experience"}),v.jsx("p",{className:"text-gray-700 dark:text-gray-300 max-w-3xl",children:"Help improve public transit in Addis Ababa. Tell us about your ride by filling in the details below."})]}),v.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:v.jsx("div",{className:"md:col-span-2",children:v.jsxs("form",{onSubmit:U,className:"rounded-3xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-6 shadow-xl",children:[v.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[v.jsx(my,{label:"Route",placeholder:"e.g. Arat Kilo - Bole",icon:v.jsx(Yy,{className:"h-4 w-4"}),value:j.route,onChange:G=>F(J=>({...J,route:G}))}),v.jsx(my,{label:"Bus Number",placeholder:"e.g. 12",icon:v.jsx(vE,{className:"h-4 w-4"}),value:j.busNumber,onChange:G=>F(J=>({...J,busNumber:G}))}),v.jsx(my,{label:"Plate Number",placeholder:"e.g. A12345",icon:v.jsx(hE,{className:"h-4 w-4"}),value:j.plateNumber,onChange:G=>F(J=>({...J,plateNumber:G}))}),v.jsxs("div",{className:"flex flex-col gap-2",children:[v.jsx("label",{className:"text-sm font-medium",children:"Your Feedback"}),v.jsxs("div",{className:"relative",children:[v.jsx("textarea",{rows:6,className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-800/60 px-3 py-2 pr-10 outline-none focus:ring-2 focus:ring-emerald-500/50",placeholder:"Describe your experience...",value:j.feedback,onChange:G=>F(J=>({...J,feedback:G.target.value})),required:!0}),v.jsx(Tx,{className:"absolute right-3 top-3 h-5 w-5 text-gray-400"})]})]})]}),v.jsxs("div",{className:"mt-6 flex items-center gap-3",children:[v.jsxs("button",{type:"submit",disabled:!s||g,className:"inline-flex items-center gap-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 disabled:opacity-60 text-white px-5 py-2.5 font-semibold shadow",children:[v.jsx(by,{className:"h-4 w-4"})," ",g?"Submitting...":"Submit Feedback"]}),E&&v.jsx("span",{className:"text-sm text-emerald-700 dark:text-emerald-400",children:E})]})]})})})]}),v.jsxs("footer",{className:"py-8 border-t border-gray-200 dark:border-gray-800 text-center text-sm text-gray-600 dark:text-gray-400",children:["© ",new Date().getFullYear()," AddisTransit"]})]})}function my({label:u,placeholder:p,icon:g,value:w,onChange:E}){return v.jsxs("div",{className:"flex flex-col gap-2",children:[v.jsx("label",{className:"text-sm font-medium",children:u}),v.jsxs("div",{className:"relative",children:[v.jsx("input",{className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-800/60 px-3 py-2 pr-10 outline-none focus:ring-2 focus:ring-emerald-500/50",placeholder:p,value:w,onChange:P=>E(P.target.value),required:!0}),v.jsx("span",{className:"absolute right-3 top-2.5 text-gray-400",children:g})]})]})}function tP(){const u=jf(),[p,g]=ee.useState(""),[w,E]=ee.useState(""),[P,j]=ee.useState(!1),[F,s]=ee.useState("");ee.useEffect(()=>{try{localStorage.getItem("admin_token")&&u("/admin/dashboard")}catch{}},[u]);const U=async G=>{G.preventDefault(),s(""),j(!0);try{if(!p.trim()||!w.trim()){s("Enter email and password");return}try{const J=await B3(p,w);localStorage.setItem("admin_token",J.token),u("/admin/dashboard")}catch{s("Invalid credentials")}}finally{j(!1)}};return v.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 text-gray-900 dark:text-gray-100",children:[v.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[v.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),v.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),v.jsx(Za,{}),v.jsx("div",{className:"max-w-md mx-auto px-4 py-12",children:v.jsxs("div",{className:"rounded-3xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-6 shadow-xl",children:[v.jsxs("div",{className:"mb-6",children:[v.jsxs("span",{className:"inline-flex items-center gap-2 text-xs uppercase tracking-wider text-emerald-700 bg-emerald-100 dark:text-emerald-300 dark:bg-emerald-900/40 px-3 py-1 rounded-full",children:[v.jsx(wx,{className:"h-3.5 w-3.5"})," Admin"]}),v.jsx("h1",{className:"mt-3 text-2xl font-extrabold tracking-tight",children:"Admin Login"}),v.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:"Restricted access. Authorized personnel only."})]}),v.jsxs("form",{onSubmit:U,className:"space-y-4",children:[v.jsxs("div",{children:[v.jsx("label",{className:"text-sm font-medium",children:"Email"}),v.jsxs("div",{className:"relative mt-1",children:[v.jsx("input",{type:"email",className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-800/60 px-3 py-2 pr-10 outline-none focus:ring-2 focus:ring-emerald-500/50",placeholder:"admin@example.com",value:p,onChange:G=>g(G.target.value)}),v.jsx(EE,{className:"absolute right-3 top-2.5 h-5 w-5 text-gray-400"})]})]}),v.jsxs("div",{children:[v.jsx("label",{className:"text-sm font-medium",children:"Password"}),v.jsxs("div",{className:"relative mt-1",children:[v.jsx("input",{type:"password",className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-800/60 px-3 py-2 pr-10 outline-none focus:ring-2 focus:ring-emerald-500/50",placeholder:"••••••••",value:w,onChange:G=>E(G.target.value)}),v.jsx(wx,{className:"absolute right-3 top-2.5 h-5 w-5 text-gray-400"})]})]}),F&&v.jsx("div",{className:"text-sm text-red-600",children:F}),v.jsxs("button",{type:"submit",disabled:P,className:"w-full inline-flex items-center justify-center gap-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 disabled:opacity-60 text-white px-5 py-2.5 font-semibold shadow",children:[v.jsx(SE,{className:"h-4 w-4"})," ",P?"Signing in...":"Sign In"]})]})]})})]})}const rP="/assets/addis_bus_forecast_sep2025_timeslot_holidays-B4l_Yyyy.csv",nP=({congestionData:u,onLocationClick:p,selectedLocation:g})=>{const[w,E]=ee.useState(!1),[P,j]=ee.useState({longitude:38.7756,latitude:9.0192,zoom:11}),F=u&&u.length>0?u:[{lng:38.7756,lat:9.0192,intensity:.9,area:"Meskel Square"},{lng:38.76,lat:9.01,intensity:.7,area:"CMC"},{lng:38.79,lat:9.03,intensity:.8,area:"Bole"},{lng:38.75,lat:9,intensity:.6,area:"Piazza"},{lng:38.78,lat:9.04,intensity:.5,area:"Kazanchis"},{lng:38.74,lat:8.99,intensity:.4,area:"Merkato"},{lng:38.8,lat:9.05,intensity:.3,area:"Airport"},{lng:38.72,lat:8.98,intensity:.2,area:"Arat Kilo"}],s={type:"FeatureCollection",features:F.map((G,J)=>({type:"Feature",properties:{intensity:G.intensity,area:G.area,id:J},geometry:{type:"Point",coordinates:[G.lng,G.lat]}}))},U=G=>{const{lngLat:J}=G;J.lng,J.lat;let Y=null,me=1/0;F.forEach(Ae=>{const Ee=Math.sqrt(Math.pow(Ae.lng-J.lng,2)+Math.pow(Ae.lat-J.lat,2));Ee<me&&(me=Ee,Y=Ae)}),Y&&p&&p(Y)};return v.jsxs("div",{className:"w-full h-96 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:[v.jsxs(Gm,{style:{width:"100%",height:"100%"},mapStyle:"mapbox://styles/mapbox/streets-v12",accessToken:"pk.eyJ1Ijoic2FuaWRhZ290IiwiYSI6ImNtZjg3NHZxdzA0YXgycHNkNTl3dTQxbXoifQ.TlRvzYLTNSJsm_CVBmDAGQ",longitude:P.longitude,latitude:P.latitude,zoom:P.zoom,onMove:G=>j(G.viewState),onClick:U,onLoad:()=>E(!0),children:[v.jsx(rp,{id:"congestion-heatmap",type:"geojson",data:s,children:v.jsx(ju,{id:"congestion-heatmap-layer",type:"heatmap",source:"congestion-heatmap",paint:{"heatmap-weight":{property:"intensity",type:"exponential",stops:[[0,0],[1,1]]},"heatmap-intensity":{stops:[[0,0],[1,1]]},"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 255, 0, 0)",.1,"rgba(0, 255, 0, 0.5)",.3,"rgba(255, 255, 0, 0.5)",.5,"rgba(255, 165, 0, 0.5)",.7,"rgba(255, 0, 0, 0.5)",1,"rgba(255, 0, 0, 0.8)"],"heatmap-radius":{stops:[[0,2],[1,20]]},"heatmap-opacity":.6}})}),v.jsx(rp,{id:"congestion-points",type:"geojson",data:s,children:v.jsx(ju,{id:"congestion-points-layer",type:"circle",source:"congestion-points",paint:{"circle-radius":{property:"intensity",stops:[[0,4],[1,12]]},"circle-color":{property:"intensity",stops:[[0,"#00ff00"],[.2,"#88ff00"],[.4,"#ffaa00"],[.6,"#ff8800"],[.8,"#ff0000"]]},"circle-stroke-width":2,"circle-stroke-color":"#ffffff","circle-opacity":.8}})}),g&&v.jsx(rp,{id:"selected-location",type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[g.lng,g.lat]}},children:v.jsx(ju,{id:"selected-location-layer",type:"circle",source:"selected-location",paint:{"circle-radius":15,"circle-color":"#0066ff","circle-stroke-width":3,"circle-stroke-color":"#ffffff","circle-opacity":.8}})})]}),v.jsxs("div",{className:"absolute bottom-4 left-4 bg-white dark:bg-gray-800 rounded-lg p-3 shadow-lg border border-gray-200 dark:border-gray-700",children:[v.jsx("div",{className:"text-sm font-semibold mb-2",children:"Congestion Level"}),v.jsxs("div",{className:"space-y-1",children:[v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500"}),v.jsx("span",{className:"text-xs",children:"High (80%+)"})]}),v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500"}),v.jsx("span",{className:"text-xs",children:"Medium-High (60-80%)"})]}),v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx("div",{className:"w-4 h-4 rounded-full bg-yellow-500"}),v.jsx("span",{className:"text-xs",children:"Medium (40-60%)"})]}),v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500"}),v.jsx("span",{className:"text-xs",children:"Low (0-40%)"})]})]})]})]})},iP=()=>{const[u,p]=ee.useState(null),[g,w]=ee.useState([]),[E,P]=ee.useState(null),[j,F]=ee.useState(!1),[s,U]=ee.useState(""),[G,J]=ee.useState([]),[Y,me]=ee.useState([]),[Ae,Ee]=ee.useState(null),Re=async()=>{try{const $e=await q3();$e.success&&me($e.routes)}catch($e){console.error("Failed to load route congestion",$e)}};ee.useEffect(()=>{Ue(),He(),Re()},[]);const Ue=async()=>{try{const Ye=(await sp()).filter(tt=>tt.status!=="red"&&tt.passengers/tt.max_capacity<.8);w(Ye)}catch($e){console.error("Failed to load bus status:",$e)}},He=async()=>{try{const $e=await W3();$e.success&&J($e.data)}catch($e){console.error("Failed to load congestion data:",$e),Me()}},Me=()=>{J([{area:"Meskel Square",lng:38.7756,lat:9.0192,intensity:.9,passengers:150},{area:"CMC",lng:38.76,lat:9.01,intensity:.7,passengers:120},{area:"Bole",lng:38.79,lat:9.03,intensity:.8,passengers:140},{area:"Piazza",lng:38.75,lat:9,intensity:.6,passengers:100},{area:"Kazanchis",lng:38.78,lat:9.04,intensity:.5,passengers:80},{area:"Merkato",lng:38.74,lat:8.99,intensity:.4,passengers:60},{area:"Airport",lng:38.8,lat:9.05,intensity:.3,passengers:40},{area:"Arat Kilo",lng:38.72,lat:8.98,intensity:.2,passengers:30}])},lt=$e=>{p($e),U("")},kt=async()=>{if(!E){U("Please select a bus");return}F(!0);try{let $e;if(Ae)$e=await G3(E.bus_id,Ae.route_id,`Move to congested route ${Ae.short_name}`,"high",E.plate_number,Ae.short_name,Ae.name);else if(u)$e=await $3(E.bus_id,{name:u.area,lng:u.lng,lat:u.lat},`High passenger demand detected at ${u.area}`,u.intensity>.7?"high":"medium");else{U("Select a target route or a location"),F(!1);return}$e.success?(U(`✅ Bus ${E.plate_number} has been reassigned`),P(null),p(null),Ee(null),await Ue(),await Re()):U(`❌ Error: ${$e.error||"Failed to send reroute command"}`)}catch($e){U(`❌ Error: ${$e.message}`)}finally{F(!1)}};return v.jsxs("div",{className:"space-y-6 bg-green-50/40 dark:bg-gray-900/60 rounded-3xl p-4",children:[v.jsxs("div",{className:"rounded-3xl border border-green-200 dark:border-green-900/40 bg-white/90 dark:bg-gray-900/70 shadow-xl p-5",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4",children:[v.jsxs("div",{children:[v.jsx("h2",{className:"text-2xl md:text-3xl font-extrabold tracking-tight",children:"AI Fleet Management"}),v.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"AI-powered congestion prediction and bus rerouting system"})]}),v.jsxs("button",{onClick:Ue,className:"inline-flex items-center gap-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 font-semibold shadow",children:[v.jsx(Sf,{className:"h-4 w-4"})," Refresh"]})]}),v.jsxs("div",{className:"mb-6 rounded-2xl overflow-hidden border border-green-100 dark:border-green-900/40",children:[v.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[v.jsx(zf,{className:"h-5 w-5 text-orange-500"}),"AI Congestion Predictions"]}),v.jsx(nP,{congestionData:G,onLocationClick:lt,selectedLocation:u})]}),v.jsxs("div",{className:"mb-6",children:[v.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Congested Routes (from DB)"}),v.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:Y.map(($e,Ye)=>v.jsxs(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Ye*.05},className:`rounded-2xl border p-4 cursor-pointer transition-all ${Ae?.route_id===$e.route_id?"ring-2 ring-emerald-500 bg-emerald-50 dark:bg-emerald-900/20":"hover:shadow-md border-green-200/60 dark:border-green-900/40"}`,onClick:()=>{Ee($e),p(null),U("")},children:[v.jsxs("div",{className:"flex items-center justify-between mb-2",children:[v.jsxs("h4",{className:"font-semibold text-sm",children:[$e.short_name," — ",$e.name]}),v.jsxs("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700",children:[$e.load_percentage,"%"]})]}),v.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:[v.jsxs("div",{children:["Buses: ",$e.buses]}),v.jsxs("div",{children:["Passengers: ",$e.passengers,"/",$e.capacity]})]})]},$e.route_id))})]})]}),v.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[v.jsxs("div",{className:"rounded-3xl border border-green-200 dark:border-green-900/40 bg-white/90 dark:bg-gray-900/70 shadow-xl p-5",children:[v.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[v.jsx(Tf,{className:"h-5 w-5 text-blue-500"}),"Available Buses (",g.length,")"]}),v.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:g.map($e=>v.jsxs(rr.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:`rounded-lg border p-3 cursor-pointer transition-all ${E?.bus_id===$e.bus_id?"ring-2 ring-emerald-500 bg-emerald-50 dark:bg-emerald-900/20":"hover:shadow-md border-gray-200 dark:border-gray-700"}`,onClick:()=>P($e),children:[v.jsxs("div",{className:"flex items-center justify-between mb-2",children:[v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx("span",{className:"text-lg",children:$e.status_emoji}),v.jsx("span",{className:"font-semibold",children:$e.plate_number})]}),v.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${$e.status==="green"?"bg-green-100 text-green-700":$e.status==="yellow"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:$e.status})]}),v.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[v.jsxs("div",{children:["Route: ",$e.route_short_name," - ",$e.route_name]}),v.jsxs("div",{children:["Passengers: ",$e.passengers,"/",$e.max_capacity," (",$e.fullness_percentage,"%)"]})]})]},$e.bus_id))})]}),v.jsxs("div",{className:"rounded-3xl border border-green-200 dark:border-green-900/40 bg-white/90 dark:bg-gray-900/70 shadow-xl p-5",children:[v.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[v.jsx(by,{className:"h-5 w-5 text-purple-500"}),"Send Bus (to route or location)"]}),u&&!Ae&&v.jsxs("div",{className:"mb-4 p-4 rounded-xl bg-green-50 border border-green-200 dark:bg-green-900/20 dark:border-green-800",children:[v.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[v.jsx(Bo,{className:"h-4 w-4 text-blue-600"}),v.jsxs("span",{className:"font-semibold text-blue-900 dark:text-blue-100",children:["Selected: ",u.area]})]}),v.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[v.jsxs("div",{children:["Congestion: ",Math.round(u.intensity*100),"%"]}),v.jsxs("div",{children:["Expected Passengers: ",u.passengers]})]})]}),Ae&&v.jsxs("div",{className:"mb-4 p-4 rounded-xl bg-green-50 border border-green-200 dark:bg-green-900/20 dark:border-green-800",children:[v.jsxs("div",{className:"font-semibold",children:["Target Route: ",Ae.short_name," — ",Ae.name]}),v.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Load: ",Ae.load_percentage,"%"]})]}),E&&v.jsxs("div",{className:"mb-4 p-4 rounded-xl bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800",children:[v.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[v.jsx(Tf,{className:"h-4 w-4 text-emerald-600"}),v.jsxs("span",{className:"font-semibold text-emerald-900 dark:text-emerald-100",children:["Selected: ",E.plate_number]})]}),v.jsxs("div",{className:"text-sm text-emerald-700 dark:text-emerald-300",children:[v.jsxs("div",{children:["Route: ",E.route_short_name]}),v.jsxs("div",{children:["Capacity: ",E.passengers,"/",E.max_capacity]})]})]}),v.jsx("button",{onClick:kt,disabled:!E||!Ae&&!u||j,className:"w-full bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:j?v.jsxs(v.Fragment,{children:[v.jsx(Sf,{className:"h-4 w-4 animate-spin"}),"Sending..."]}):v.jsxs(v.Fragment,{children:[v.jsx(by,{className:"h-4 w-4"}),"Send Bus to Location"]})}),s&&v.jsx(rr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-4 p-3 rounded-lg bg-gray-100 dark:bg-gray-800 text-sm",children:s})]})]})]})};function sP(){const u=jf(),[p,g]=ee.useState("ai"),[w,E]=ee.useState([]),[P,j]=ee.useState(!1),[F,s]=ee.useState([]),[U,G]=ee.useState(!1),[J,Y]=ee.useState({from:"",to:"",slot:"",start:"",end:""});ee.useEffect(()=>{try{localStorage.getItem("admin_token")||u("/admin/login")}catch{}},[u]),ee.useEffect(()=>{(async()=>{if(p==="feedbacks"){j(!0);try{const lt=await F3(200);E(lt)}catch{E([])}finally{j(!1)}}})()},[p]),ee.useEffect(()=>{(async()=>{if(!(p!=="ai"||F.length>0)){G(!0);try{const $e=(await(await fetch(rP)).text()).trim().split(/\r?\n/),Ye=$e.shift().split(","),tt=De=>Ye.indexOf(De),it=[];for(const De of $e){const $t=De.split(",");it.push({date:$t[tt("date")],predicted_passengers:Number($t[tt("predicted_passengers")]),lower_bound:Number($t[tt("lower_bound")]),upper_bound:Number($t[tt("upper_bound")]),origin:$t[tt("origin")],destination:$t[tt("destination")],time_slot:$t[tt("time_slot")]})}s(it)}finally{G(!1)}}})()},[p,F.length]);const me=ee.useMemo(()=>Array.from(new Set(F.map(Me=>Me.origin))).sort(),[F]),Ae=ee.useMemo(()=>Array.from(new Set(F.map(Me=>Me.destination))).sort(),[F]),Ee=ee.useMemo(()=>Array.from(new Set(F.map(Me=>Me.time_slot))).sort(),[F]),Re=ee.useMemo(()=>F.filter(Me=>!(J.from&&Me.origin!==J.from||J.to&&Me.destination!==J.to||J.slot&&Me.time_slot!==J.slot||J.start&&Me.date<J.start||J.end&&Me.date>J.end)),[F,J]),Ue=ee.useMemo(()=>{const Me=Re.length?Re:F;if(!Me.length)return{total:0,pairs:0,avg:0,peak:0,today:0};let lt=0,kt=0;const $e=new Set,Ye=new Date().toISOString().split("T")[0];let tt=0;for(const De of Me){const $t=Number(De.predicted_passengers)||0;lt+=$t,$t>kt&&(kt=$t),$e.add(`${De.origin}→${De.destination}`),De.date===Ye&&(tt+=$t)}const it=Math.round(lt/Me.length);return{total:Math.round(lt),pairs:$e.size,avg:it,peak:Math.round(kt),today:Math.round(tt)}},[Re,F]),He=()=>{localStorage.removeItem("admin_token"),u("/admin/login")};return v.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 text-gray-900 dark:text-gray-100",children:[v.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[v.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),v.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),v.jsx(Za,{}),v.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-10",children:[v.jsxs("div",{className:"flex items-center justify-between mb-6",children:[v.jsxs("div",{children:[v.jsx("h1",{className:"text-3xl font-extrabold tracking-tight",children:"Admin Dashboard"}),v.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Overview of city data and system activity"})]}),v.jsxs("button",{onClick:He,className:"inline-flex items-center gap-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 font-semibold shadow",children:[v.jsx(f1,{className:"h-4 w-4"})," Logout"]})]}),v.jsxs("div",{className:"flex gap-6",children:[v.jsxs("aside",{className:"w-56 shrink-0 rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-3 h-fit -ml-4 md:-ml-6 lg:-ml-8",children:[v.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400 px-2 mb-2",children:"Menu"}),v.jsxs("nav",{className:"space-y-1",children:[v.jsx("button",{onClick:()=>g("ai"),className:`w-full text-left px-3 py-2 rounded-xl transition-colors ${p==="ai"?"bg-emerald-600 text-white":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-200"}`,children:"AI Statistics"}),v.jsx("button",{onClick:()=>g("feedbacks"),className:`w-full text-left px-3 py-2 rounded-xl transition-colors ${p==="feedbacks"?"bg-emerald-600 text-white":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-200"}`,children:"User Feedbacks"}),v.jsx("button",{onClick:()=>g("fleet"),className:`w-full text-left px-3 py-2 rounded-xl transition-colors ${p==="fleet"?"bg-emerald-600 text-white":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-200"}`,children:"Fleet Management"})]})]}),v.jsxs("main",{className:"flex-1",children:[p==="ai"&&v.jsxs(v.Fragment,{children:[v.jsx("div",{className:"rounded-3xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 shadow-xl p-5 mb-6",children:v.jsxs("div",{className:"mb-0",children:[v.jsx("h2",{className:"text-2xl md:text-3xl font-extrabold tracking-tight",children:"AI -Driven Passenger Demand Prediction"}),v.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Forecasts and confidence intervals with flexible filters"})]})}),v.jsxs("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[v.jsx(Rm,{icon:v.jsx(op,{className:"h-5 w-5"}),title:"Todays Predicted Riders",value:Ue.today.toLocaleString(),delta:""}),v.jsx(Rm,{icon:v.jsx(Yy,{className:"h-5 w-5"}),title:"Origin–Destination Pairs",value:Ue.pairs.toLocaleString(),delta:""}),v.jsx(Rm,{icon:v.jsx(dE,{className:"h-5 w-5"}),title:"Avg per Row",value:Ue.avg.toLocaleString(),delta:""}),v.jsx(Rm,{icon:v.jsx(zf,{className:"h-5 w-5"}),title:"Peak Predicted",value:Ue.peak.toLocaleString(),delta:""})]}),v.jsxs("div",{className:"rounded-3xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 shadow-xl p-5",children:[v.jsxs("div",{className:"grid md:grid-cols-5 gap-3 mb-4",children:[v.jsxs("div",{children:[v.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Origin"}),v.jsxs("select",{value:J.from,onChange:Me=>Y(lt=>({...lt,from:Me.target.value})),className:"w-full rounded-md border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-800/60 px-2 py-2",children:[v.jsx("option",{value:"",children:"All"}),me.map(Me=>v.jsx("option",{value:Me,children:Me},Me))]})]}),v.jsxs("div",{children:[v.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Destination"}),v.jsxs("select",{value:J.to,onChange:Me=>Y(lt=>({...lt,to:Me.target.value})),className:"w-full rounded-md border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-800/60 px-2 py-2",children:[v.jsx("option",{value:"",children:"All"}),Ae.map(Me=>v.jsx("option",{value:Me,children:Me},Me))]})]}),v.jsxs("div",{children:[v.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Time Slot"}),v.jsxs("select",{value:J.slot,onChange:Me=>Y(lt=>({...lt,slot:Me.target.value})),className:"w-full rounded-md border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-800/60 px-2 py-2",children:[v.jsx("option",{value:"",children:"All"}),Ee.map(Me=>v.jsx("option",{value:Me,children:Me},Me))]})]}),v.jsxs("div",{children:[v.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Start Date"}),v.jsx("input",{type:"date",value:J.start,onChange:Me=>Y(lt=>({...lt,start:Me.target.value})),className:"w-full rounded-md border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-800/60 px-2 py-2"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:"End Date"}),v.jsx("input",{type:"date",value:J.end,onChange:Me=>Y(lt=>({...lt,end:Me.target.value})),className:"w-full rounded-md border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-800/60 px-2 py-2"})]})]}),v.jsx("div",{className:"overflow-x-auto border border-gray-100 dark:border-gray-800 rounded-xl",children:v.jsxs("table",{className:"min-w-full text-sm",children:[v.jsx("thead",{children:v.jsxs("tr",{className:"text-left border-b border-gray-200 dark:border-gray-800",children:[v.jsx(No,{children:"Date"}),v.jsx(No,{children:"Origin"}),v.jsx(No,{children:"Destination"}),v.jsx(No,{children:"Time Slot"}),v.jsx(No,{children:"Predicted"}),v.jsx(No,{children:"Lower"}),v.jsx(No,{children:"Upper"})]})}),v.jsxs("tbody",{children:[U&&v.jsx("tr",{children:v.jsx(ls,{colSpan:7,children:"Loading forecasts..."})}),!U&&Re.length===0&&v.jsx("tr",{children:v.jsx(ls,{colSpan:7,children:"No rows match filters."})}),!U&&Re.map((Me,lt)=>v.jsxs("tr",{className:"border-t border-gray-100 dark:border-gray-800",children:[v.jsx(ls,{children:Me.date}),v.jsx(ls,{children:Me.origin}),v.jsx(ls,{children:Me.destination}),v.jsx(ls,{children:Me.time_slot}),v.jsx(ls,{children:Math.round(Me.predicted_passengers)}),v.jsx(ls,{children:Math.round(Me.lower_bound)}),v.jsx(ls,{children:Math.round(Me.upper_bound)})]},`${Me.date}-${Me.origin}-${Me.destination}-${Me.time_slot}-${lt}`))]})]})})]})]}),p==="feedbacks"&&v.jsxs("div",{className:"rounded-3xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 shadow-xl overflow-hidden",children:[v.jsxs("div",{className:"px-5 py-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[v.jsx("h2",{className:"text-lg font-semibold",children:"Recent User Feedbacks"}),v.jsx("span",{className:"text-sm text-gray-500",children:"Latest"})]}),v.jsx("div",{className:"overflow-x-auto",children:v.jsxs("table",{className:"min-w-full text-sm",children:[v.jsx("thead",{children:v.jsxs("tr",{className:"text-left border-b border-gray-200 dark:border-gray-800",children:[v.jsx(No,{children:"Time"}),v.jsx(No,{children:"IP"}),v.jsx(No,{children:"Route"}),v.jsx(No,{children:"Bus No."}),v.jsx(No,{children:"Plate"}),v.jsx(No,{children:"Feedback"})]})}),v.jsxs("tbody",{children:[P&&v.jsx("tr",{children:v.jsx(ls,{colSpan:6,children:"Loading..."})}),!P&&w.length===0&&v.jsx("tr",{children:v.jsx(ls,{colSpan:6,children:"No feedbacks found."})}),!P&&w.map(Me=>v.jsxs("tr",{className:"border-t border-gray-100 dark:border-gray-800 align-top",children:[v.jsx(ls,{children:new Date(Me.created_at).toLocaleString()}),v.jsx(ls,{children:Me.submitter_ip||""}),v.jsx(ls,{children:Me.route}),v.jsx(ls,{children:Me.bus_number}),v.jsx(ls,{children:Me.plate_number}),v.jsx(ls,{children:v.jsx("div",{className:"max-w-xl whitespace-pre-wrap leading-relaxed",children:Me.feedback})})]},Me.id))]})]})})]}),p==="fleet"&&v.jsx(iP,{})]})]})]})]})}function Rm({icon:u,title:p,value:g,delta:w}){return v.jsx("div",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-4 shadow-sm",children:v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"flex items-center gap-3",children:[v.jsx("div",{className:"h-9 w-9 rounded-lg bg-emerald-600/10 text-emerald-700 dark:text-emerald-300 flex items-center justify-center",children:u}),v.jsxs("div",{children:[v.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:p}),v.jsx("div",{className:"text-xl font-bold",children:g})]})]}),v.jsx("div",{className:"text-sm text-emerald-600 dark:text-emerald-400",children:w})]})})}function No({children:u}){return v.jsx("th",{className:"p-3 text-xs font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300",children:u})}function ls({children:u}){return v.jsx("td",{className:"p-3 text-gray-800 dark:text-gray-200",children:u})}const oP=({darkMode:u,setDarkMode:p})=>{const g=Nu(),[w,E]=ee.useState(""),[P,j]=ee.useState(""),[F,s]=ee.useState("now"),[U,G]=ee.useState(""),[J,Y]=ee.useState(""),[me,Ae]=ee.useState("fastest"),[Ee,Re]=ee.useState(null),[Ue,He]=ee.useState(null),[Me,lt]=ee.useState([]),[kt,$e]=ee.useState(!1),[Ye,tt]=ee.useState({from:!1,to:!1}),[it,De]=ee.useState([]),$t=[{name:"Meskel Square",lat:9.0054,lng:38.7636,type:"landmark"},{name:"Piazza",lat:9.0154,lng:38.7736,type:"landmark"},{name:"CMC Terminal",lat:9.0254,lng:38.7836,type:"terminal"},{name:"Bole Airport",lat:8.9954,lng:38.7536,type:"airport"},{name:"Kazanchis",lat:9.0054,lng:38.7436,type:"area"},{name:"Merkato",lat:8.9854,lng:38.7236,type:"market"},{name:"Arat Kilo",lat:9.0154,lng:38.7536,type:"area"},{name:"National Theatre",lat:9.0054,lng:38.7436,type:"landmark"},{name:"Addis Ababa University",lat:9.0054,lng:38.7636,type:"university"},{name:"Ethiopian Airlines",lat:8.9954,lng:38.7536,type:"office"},{name:"Sheraton Addis",lat:9.0054,lng:38.7636,type:"hotel"},{name:"Unity Park",lat:9.0054,lng:38.7636,type:"park"},{name:"Entoto Park",lat:9.0254,lng:38.7836,type:"park"},{name:"Lion of Judah",lat:9.0054,lng:38.7636,type:"monument"},{name:"Red Terror Martyrs Memorial",lat:9.0054,lng:38.7636,type:"memorial"}];ee.useEffect(()=>{(async()=>{try{const _t=await ng();De(_t||[])}catch{De([])}})()},[]),ee.useEffect(()=>{if(g.state){const{from:Fe,to:_t}=g.state;Fe&&(E(Fe.name),Re(Fe)),_t&&(j(_t.name),He(_t))}},[g.state]);const ut=$t.map(Fe=>Fe.name),vt=[{id:"fastest",label:"Fastest",icon:_1,description:"Minimize travel time"},{id:"least-walking",label:"Least Walking",icon:h1,description:"Minimize walking distance"},{id:"cheapest",label:"Cheapest",icon:_E,description:"Lowest fare options"}];ee.useEffect(()=>{w&&P&&w!==P&&nr()},[w,P,F,me]);const nr=async()=>{if(!(!w&&!Ee)&&!(!P&&!Ue)){$e(!0);try{const Fe=Ee||$t.find(Ot=>Ot.name.toLowerCase().includes(w.toLowerCase())),_t=Ue||$t.find(Ot=>Ot.name.toLowerCase().includes(P.toLowerCase())),Gt=(await R3({from:Fe||{name:w,lat:9.0054,lng:38.7636},to:_t||{name:P,lat:9.0154,lng:38.7736},departureTime:F,preference:me}))?.options||[];Gt.length?lt(Gt.map((Ot,xr)=>({id:`api-${xr}`,departureTime:"Now",arrivalTime:"Soon",duration:Ot.duration||"--",walkingTime:Ot.walkingTime||"--",transfers:Ot.transfers||0,routes:it.slice(0,Math.max(1,(Ot.routes||[]).length||1)).map(sr=>({shortName:sr.short_name||sr.shortName||"38",color:sr.color||"#1e40af",name:sr.name||"Route 38"})),fare:Ot.fare||"$2.50",co2Saved:"1.2 kg",preference:me}))):lt(Jr(w||"From",P||"To"))}catch{lt(Jr())}$e(!1)}},Jr=(Fe,_t)=>{const Te=new Date,st=[];for(let Gt=0;Gt<3;Gt++){const Ot=new Date(Te.getTime()+(Gt*5+2)*6e4),xr=new Date(Ot.getTime()+(25+Gt*5)*6e4),sr=3+Gt*2;st.push({id:`trip-${Gt}`,departureTime:Ot.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),arrivalTime:xr.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),duration:`${25+Gt*5} min`,walkingTime:`${sr} min walk`,transfers:Gt===0?0:Gt,routes:Gt===0?[it[0]||{shortName:"38",color:"#1e40af",name:"Route 38"}]:[it[Gt%it.length]||{shortName:"38",color:"#1e40af",name:"Route 38"},it[(Gt+1)%it.length]||{shortName:"91",color:"#f59e0b",name:"Route 91"}],fare:`${(20+Gt*5).toFixed(0)} ETB`,co2Saved:`${(1.2+Gt*.3).toFixed(1)} kg`,preference:Gt===0?"fastest":Gt===1?"least-walking":"cheapest"})}return st},ir=(Fe,_t)=>Fe?ut.filter(Te=>Te.toLowerCase().includes(Fe.toLowerCase())&&Te!==(_t==="from"?P:w)).slice(0,5):[],cr=()=>{const Fe=w;E(P),j(Fe);const _t=Ee;Re(Ue),He(_t)},St=Fe=>{Ee?Ue?(Re(Fe),He(null)):He(Fe):Re(Fe)};return v.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 flex flex-col",children:[v.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[v.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),v.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),v.jsx(Za,{}),v.jsx("div",{className:"bg-white/70 dark:bg-gray-900/70 border-b border-gray-200 dark:border-gray-700 px-4 py-4 backdrop-blur rounded-b-2xl",children:v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Trip Planner"}),v.jsx(fp,{darkMode:u,onToggle:()=>p(!u)})]})}),v.jsxs("div",{className:"flex-1 overflow-auto grid lg:grid-cols-2 gap-0",children:[v.jsx("div",{className:"p-4 order-2 lg:order-1",children:v.jsxs("div",{className:"max-w-2xl mx-auto space-y-4 bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-700 p-4 shadow-sm",children:[v.jsx("div",{className:"relative",children:v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[v.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),v.jsx("div",{className:"w-0.5 h-8 bg-gray-300 dark:bg-gray-600"}),v.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"})]}),v.jsxs("div",{className:"flex-1 space-y-3",children:[v.jsxs("div",{className:"relative",children:[v.jsx("input",{type:"text",placeholder:"From",value:w,onChange:Fe=>{E(Fe.target.value),tt({...Ye,from:!0})},onFocus:()=>tt({...Ye,from:!0}),className:"w-full px-4 py-3 bg-white/80 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent"}),v.jsx(fo,{children:Ye.from&&w&&v.jsx(rr.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 right-0 z-20 bg-white/95 dark:bg-gray-800/95 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg mt-1",children:ir(w,"from").map((Fe,_t)=>{const Te=$t.find(st=>st.name===Fe);return v.jsxs("button",{onClick:()=>{E(Fe),Re(Te),tt({...Ye,from:!1})},className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center space-x-3 first:rounded-t-lg last:rounded-b-lg",children:[v.jsx(Bo,{className:"w-4 h-4 text-gray-400"}),v.jsxs("div",{children:[v.jsx("span",{className:"text-gray-900 dark:text-white",children:Fe}),v.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2 capitalize",children:Te?.type})]})]},_t)})})})]}),v.jsxs("div",{className:"relative",children:[v.jsx("input",{type:"text",placeholder:"To",value:P,onChange:Fe=>{j(Fe.target.value),tt({...Ye,to:!0})},onFocus:()=>tt({...Ye,to:!0}),className:"w-full px-4 py-3 bg-white/80 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent"}),v.jsx(fo,{children:Ye.to&&P&&v.jsx(rr.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 right-0 z-20 bg-white/95 dark:bg-gray-800/95 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg mt-1",children:ir(P,"to").map((Fe,_t)=>{const Te=$t.find(st=>st.name===Fe);return v.jsxs("button",{onClick:()=>{j(Fe),He(Te),tt({...Ye,to:!1})},className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center space-x-3 first:rounded-t-lg last:rounded-b-lg",children:[v.jsx(Bo,{className:"w-4 h-4 text-gray-400"}),v.jsxs("div",{children:[v.jsx("span",{className:"text-gray-900 dark:text-white",children:Fe}),v.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2 capitalize",children:Te?.type})]})]},_t)})})})]})]}),v.jsx("button",{onClick:cr,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",disabled:!w||!P,children:v.jsx(Jm,{className:"w-5 h-5 text-gray-400 transform rotate-90"})})]})}),v.jsxs("div",{className:"flex items-center space-x-4",children:[v.jsx(Bc,{className:"w-5 h-5 text-gray-400"}),v.jsxs("select",{value:F,onChange:Fe=>s(Fe.target.value),className:"px-3 py-2 bg-white/80 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500",children:[v.jsx("option",{value:"now",children:"Leave now"}),v.jsx("option",{value:"depart",children:"Depart at"}),v.jsx("option",{value:"arrive",children:"Arrive by"})]}),F!=="now"&&v.jsxs("div",{className:"flex space-x-2",children:[v.jsx("input",{type:"time",value:U,onChange:Fe=>G(Fe.target.value),className:"px-3 py-2 bg-white/80 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500"}),v.jsx("input",{type:"date",value:J,onChange:Fe=>Y(Fe.target.value),className:"px-3 py-2 bg-white/80 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500"})]})]}),v.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:vt.map(Fe=>{const _t=Fe.icon;return v.jsxs("button",{onClick:()=>Ae(Fe.id),className:`flex items-center space-x-2 px-4 py-2 rounded-xl whitespace-nowrap transition-all ${me===Fe.id?"bg-emerald-600 text-white":"bg-white/70 dark:bg-gray-800/60 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[v.jsx(_t,{className:"w-4 h-4"}),v.jsx("span",{className:"text-sm font-medium",children:Fe.label})]},Fe.id)})})]})}),v.jsx("div",{className:"h-[50vh] lg:h-[calc(100vh-160px)] order-1 lg:order-2",children:v.jsx(aw,{plannerFrom:Ee,plannerTo:Ue,onMapClick:St})}),v.jsx("div",{className:"flex-1 p-4 lg:col-span-2",children:v.jsx("div",{className:"max-w-2xl mx-auto",children:kt?v.jsxs("div",{className:"flex items-center justify-center py-12",children:[v.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"}),v.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Finding best routes..."})]}):Me.length>0?v.jsxs("div",{className:"space-y-4",children:[v.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Trip Options (",Me.length,")"]}),Me.map((Fe,_t)=>v.jsxs(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:_t*.1},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-shadow cursor-pointer",children:[v.jsxs("div",{className:"flex items-center justify-between mb-3",children:[v.jsxs("div",{className:"flex items-center space-x-4",children:[v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:Fe.departureTime}),v.jsx("div",{className:"text-sm text-gray-500",children:"Depart"})]}),v.jsx("div",{className:"flex items-center space-x-2 flex-1",children:v.jsxs("div",{className:"flex-1 h-0.5 bg-gray-300 dark:bg-gray-600 relative",children:[v.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 w-2 h-2 bg-green-500 rounded-full"}),v.jsx("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 w-2 h-2 bg-red-500 rounded-full"})]})}),v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:Fe.arrivalTime}),v.jsx("div",{className:"text-sm text-gray-500",children:"Arrive"})]})]}),v.jsxs("div",{className:"text-right",children:[v.jsxs("div",{className:"inline-flex items-center bg-black text-white text-[11px] px-2 py-1 rounded mb-1",children:[v.jsx("span",{className:"mr-1",children:"Menged ✔"}),v.jsx("span",{children:"• Anbessa"})]}),v.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:Fe.duration}),v.jsx("div",{className:"text-sm text-gray-500",children:Fe.fare})]})]}),v.jsxs("div",{className:"flex items-center justify-between text-sm",children:[v.jsxs("div",{className:"flex items-center space-x-4",children:[v.jsx("div",{className:"flex items-center space-x-1",children:Fe.routes.map((Te,st)=>v.jsxs("div",{className:"flex items-center space-x-1",children:[v.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:Te.color},children:Te.shortName}),st<Fe.routes.length-1&&v.jsx(oE,{className:"w-3 h-3 text-gray-400"})]},st))}),v.jsx("span",{className:"text-gray-500",children:Fe.walkingTime}),Fe.transfers>0&&v.jsxs("span",{className:"text-gray-500",children:[Fe.transfers," transfer",Fe.transfers>1?"s":""]})]}),v.jsxs("div",{className:"flex items-center space-x-3 text-gray-500",children:[v.jsxs("span",{children:["🌱 ",Fe.co2Saved," CO₂ saved"]}),v.jsxs("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded",children:["ETA ",Fe.arrivalTime]})]})]})]},Fe.id))]}):w&&P?v.jsxs("div",{className:"text-center py-12",children:[v.jsx(vy,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),v.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No routes found between these locations."})]}):v.jsxs("div",{className:"text-center py-12",children:[v.jsx(Bo,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),v.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Enter your starting point and destination to plan your trip."})]})})})]})]})},aP=({darkMode:u,setDarkMode:p})=>{const[g,w]=ee.useState([]),[E,P]=ee.useState(!0),[j,F]=ee.useState(new Date),[s,U]=ee.useState("all"),[G,J]=ee.useState("distance"),[Y,me]=ee.useState(!1),[Ae,Ee]=ee.useState({lat:9.0054,lng:38.7636}),Re=[{id:"stop-1",name:"Meskel Square",lat:9.0054,lng:38.7636,routeId:"route-38",routeName:"Route 38",routeShortName:"38",routeColor:"#1e40af",nextArrivals:["2 min","12 min","22 min"],distance:.1,walkingTime:1},{id:"stop-2",name:"Piazza",lat:9.0154,lng:38.7736,routeId:"route-38",routeName:"Route 38",routeShortName:"38",routeColor:"#1e40af",nextArrivals:["5 min","15 min","25 min"],distance:.3,walkingTime:4},{id:"stop-3",name:"CMC Terminal",lat:9.0254,lng:38.7836,routeId:"route-38",routeName:"Route 38",routeShortName:"38",routeColor:"#1e40af",nextArrivals:["8 min","18 min","28 min"],distance:.5,walkingTime:6},{id:"stop-4",name:"Bole Airport",lat:8.9954,lng:38.7536,routeId:"route-91",routeName:"Route 91",routeShortName:"91",routeColor:"#f59e0b",nextArrivals:["3 min","13 min","23 min"],distance:.2,walkingTime:2},{id:"stop-5",name:"Kazanchis",lat:9.0054,lng:38.7436,routeId:"route-91",routeName:"Route 91",routeShortName:"91",routeColor:"#f59e0b",nextArrivals:["6 min","16 min","26 min"],distance:.4,walkingTime:5},{id:"stop-6",name:"Merkato",lat:8.9854,lng:38.7236,routeId:"route-12",routeName:"Route 12",routeShortName:"12",routeColor:"#16a34a",nextArrivals:["1 min","11 min","21 min"],distance:.6,walkingTime:7},{id:"stop-7",name:"Arat Kilo",lat:9.0154,lng:38.7536,routeId:"route-12",routeName:"Route 12",routeShortName:"12",routeColor:"#16a34a",nextArrivals:["4 min","14 min","24 min"],distance:.3,walkingTime:4},{id:"stop-8",name:"National Theatre",lat:9.0054,lng:38.7436,routeId:"route-23",routeName:"Route 23",routeShortName:"23",routeColor:"#dc2626",nextArrivals:["7 min","17 min","27 min"],distance:.2,walkingTime:2},{id:"stop-9",name:"Addis Ababa University",lat:9.0054,lng:38.7636,routeId:"route-38",routeName:"Route 38",routeShortName:"38",routeColor:"#1e40af",nextArrivals:["9 min","19 min","29 min"],distance:.1,walkingTime:1},{id:"stop-10",name:"Sheraton Addis",lat:9.0054,lng:38.7636,routeId:"route-91",routeName:"Route 91",routeShortName:"91",routeColor:"#f59e0b",nextArrivals:["2 min","12 min","22 min"],distance:.2,walkingTime:2}];ee.useEffect(()=>{Ue();const $e=setInterval(Ue,3e4);return()=>clearInterval($e)},[]);const Ue=async()=>{P(!0);try{const Ye=(await iw(Ae.lat,Ae.lng,1200)||[]).map(tt=>({id:tt.id,name:tt.name,lat:tt.lat,lng:tt.lng,routeId:tt.route_id,routeName:tt.route_name,routeShortName:tt.route_short_name,routeColor:tt.route_color,nextArrivals:tt.next_arrivals||["3 min","13 min","23 min"],distance:(tt.meters||0)/1e3,walkingTime:Math.ceil((tt.meters||0)/1e3*12)}));w(Ye)}catch{w(Re)}F(new Date),P(!1)},He=g.filter($e=>s==="all"||$e.routeId===s).sort(($e,Ye)=>{switch(G){case"distance":return $e.distance-Ye.distance;case"time":return Number.parseInt($e.nextArrivals[0])-Number.parseInt(Ye.nextArrivals[0]);case"name":return $e.name.localeCompare(Ye.name);default:return 0}}),Me=[...new Set(g.map($e=>$e.routeId))],lt=()=>{Ue()},kt=$e=>{console.log("Adding stop to favorites:",$e)};return v.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 flex flex-col",children:[v.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[v.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),v.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),v.jsx(Za,{}),v.jsxs("div",{className:"bg-white/70 dark:bg-gray-900/70 border-b border-gray-200 dark:border-gray-700 px-4 py-4 backdrop-blur rounded-b-2xl",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"flex items-center space-x-3",children:[v.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Nearby Stops"}),v.jsx("button",{onClick:lt,disabled:E,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors disabled:opacity-50",children:v.jsx(Sf,{className:`w-5 h-5 text-gray-600 dark:text-gray-400 ${E?"animate-spin":""}`})})]}),v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("button",{onClick:()=>me(!Y),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:v.jsx(u1,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),v.jsx(fp,{darkMode:u,onToggle:()=>p(!u)})]})]}),v.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[v.jsx(Bc,{className:"w-4 h-4 text-gray-400"}),v.jsxs("span",{className:"text-sm text-gray-500",children:["Last updated: ",j.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}),v.jsx(fo,{children:Y&&v.jsx(rr.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"bg-white/80 dark:bg-gray-900/60 border-b border-gray-200 dark:border-gray-700 overflow-hidden rounded-b-2xl backdrop-blur",children:v.jsx("div",{className:"p-4 space-y-4",children:v.jsxs("div",{className:"flex flex-wrap gap-4",children:[v.jsxs("div",{className:"flex-1 min-w-48",children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Filter by Route"}),v.jsxs("select",{value:s,onChange:$e=>U($e.target.value),className:"w-full px-3 py-2 bg-white/80 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500",children:[v.jsx("option",{value:"all",children:"All Routes"}),Me.map($e=>{const Ye=routesData.find(tt=>tt.id===$e);return v.jsxs("option",{value:$e,children:[Ye?.shortName," - ",Ye?.name]},$e)})]})]}),v.jsxs("div",{className:"flex-1 min-w-48",children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort by"}),v.jsxs("select",{value:G,onChange:$e=>J($e.target.value),className:"w-full px-3 py-2 bg-white/80 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500",children:[v.jsx("option",{value:"distance",children:"Distance"}),v.jsx("option",{value:"time",children:"Next Arrival"}),v.jsx("option",{value:"name",children:"Stop Name"})]})]})]})})})}),v.jsx("div",{className:"flex-1 overflow-auto p-4",children:E?v.jsxs("div",{className:"flex items-center justify-center py-12",children:[v.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),v.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading nearby stops..."})]}):He.length>0?v.jsx("div",{className:"space-y-3 max-w-4xl mx-auto",children:He.map(($e,Ye)=>v.jsx(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Ye*.05},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-shadow",children:v.jsxs("div",{className:"flex items-start justify-between",children:[v.jsxs("div",{className:"flex-1",children:[v.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[v.jsx("div",{className:"w-8 h-8 rounded flex items-center justify-center text-white text-sm font-bold",style:{backgroundColor:$e.routeColor},children:$e.routeShortName}),v.jsxs("div",{className:"flex-1",children:[v.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:$e.name}),v.jsx("p",{className:"text-sm text-gray-500",children:$e.routeName})]}),v.jsx("button",{onClick:()=>kt($e.id),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:v.jsx(wy,{className:"w-4 h-4 text-gray-400 hover:text-yellow-500"})})]}),v.jsxs("div",{className:"flex items-center space-x-4 mb-3 text-sm text-gray-500",children:[v.jsxs("div",{className:"flex items-center space-x-1",children:[v.jsx(Bo,{className:"w-4 h-4"}),v.jsxs("span",{children:[$e.distance.toFixed(1)," km away"]})]}),v.jsxs("div",{className:"flex items-center space-x-1",children:[v.jsx(h1,{className:"w-4 h-4"}),v.jsxs("span",{children:[$e.walkingTime," min walk"]})]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Next Arrivals"}),v.jsx("div",{className:"flex space-x-3",children:$e.nextArrivals.slice(0,3).map((tt,it)=>v.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${it===0?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:tt},it))})]})]}),v.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors ml-4",children:v.jsx(Jm,{className:"w-5 h-5 text-gray-400"})})]})},`${$e.id}-${$e.routeId}`))}):v.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[v.jsx(Bo,{className:"w-12 h-12 text-gray-400 mb-4"}),v.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No stops found"}),v.jsx("p",{className:"text-gray-500 text-center",children:s!=="all"?"Try changing your route filter":"No nearby stops available"})]})})]})},lP=({darkMode:u,setDarkMode:p})=>{const[g,w]=ee.useState("stops"),[E,P]=ee.useState([]),[j,F]=ee.useState([]),[s,U]=ee.useState([]),[G,J]=ee.useState([]),[Y,me]=ee.useState(null),[Ae,Ee]=ee.useState(!1),Re=[{id:"fav-1",name:"Meskel Square",routeId:"route-38",routeName:"Route 38",routeColor:"#1e40af",nextArrivals:["2 min","12 min"],distance:.1,category:"home"},{id:"fav-2",name:"Bole Airport",routeId:"route-91",routeName:"Route 91",routeColor:"#f59e0b",nextArrivals:["5 min","15 min"],distance:.3,category:"work"},{id:"fav-3",name:"Merkato",routeId:"route-12",routeName:"Route 12",routeColor:"#16a34a",nextArrivals:["1 min","11 min"],distance:.2,category:"shopping"},{id:"fav-4",name:"National Theatre",routeId:"route-23",routeName:"Route 23",routeColor:"#dc2626",nextArrivals:["7 min","17 min"],distance:.4,category:"entertainment"}],Ue=[{id:"trip-1",from:"Meskel Square",to:"Bole Airport",duration:"25 min",routes:["Route 38","Route 91"],timestamp:"2 hours ago"},{id:"trip-2",from:"Piazza",to:"Merkato",duration:"18 min",routes:["Route 38","Route 12"],timestamp:"Yesterday"},{id:"trip-3",from:"CMC Terminal",to:"National Theatre",duration:"22 min",routes:["Route 38","Route 23"],timestamp:"2 days ago"}];ee.useEffect(()=>{(async()=>{try{const De=await ng();U(De||[])}catch{U([])}})(),P(Re),J(Ue)},[]);const He=[{id:"stops",label:"Stops",icon:Bo},{id:"routes",label:"Routes",icon:Ef},{id:"trips",label:"Recent",icon:Bc}],Me={home:d1,work:cE,coffee:gE,star:wy};ee.useEffect(()=>{lt()},[]);const lt=()=>{const it=JSON.parse(localStorage.getItem("transit-favorite-stops")||"[]"),De=JSON.parse(localStorage.getItem("transit-saved-routes")||"[]"),$t=JSON.parse(localStorage.getItem("transit-recent-trips")||"[]");if(it.length===0){const ut=[{id:"fav-1",name:"School St / Queen St",nickname:"Home Stop",icon:"home",routeShortName:"38",routeColor:"#1e40af",nextArrivals:["3 min","13 min","23 min"],lastUpdated:new Date},{id:"fav-2",name:"Athens Chapel",nickname:"Work",icon:"work",routeShortName:"12",routeColor:"#16a34a",nextArrivals:["7 min","17 min","27 min"],lastUpdated:new Date},{id:"fav-3",name:"Puck's Pharmacy",nickname:"Coffee Shop",icon:"coffee",routeShortName:"91",routeColor:"#f59e0b",nextArrivals:["12 min","22 min","32 min"],lastUpdated:new Date}];P(ut),localStorage.setItem("transit-favorite-stops",JSON.stringify(ut))}else P(it);if(De.length===0){const ut=[{id:"saved-route-1",name:"Home to Work",from:"School St / Queen St",to:"Athens Chapel",routes:[s[0],s[2]],duration:"25 min",lastUsed:new Date},{id:"saved-route-2",name:"Weekend Shopping",from:"Current Location",to:"Glade Terminal",routes:[s[0]],duration:"18 min",lastUsed:new Date(Date.now()-864e5)}];F(ut),localStorage.setItem("transit-saved-routes",JSON.stringify(ut))}else F(De);if($t.length===0){const ut=[{id:"trip-1",from:"School St / Queen St",to:"Great Theatre",date:new Date,duration:"22 min",routes:[s[3]]},{id:"trip-2",from:"Athens Chapel",to:"Puck's Pharmacy",date:new Date(Date.now()-36e5),duration:"15 min",routes:[s[1]]},{id:"trip-3",from:"Current Location",to:"Shakespeare Ave",date:new Date(Date.now()-72e5),duration:"28 min",routes:[s[1]]}];J(ut),localStorage.setItem("transit-recent-trips",JSON.stringify(ut))}else J($t)},kt=it=>{const De=E.filter($t=>$t.id!==it);P(De),localStorage.setItem("transit-favorite-stops",JSON.stringify(De))},$e=it=>{const De=j.filter($t=>$t.id!==it);F(De),localStorage.setItem("transit-saved-routes",JSON.stringify(De))},Ye=(it,De)=>{const $t=E.map(ut=>ut.id===it?{...ut,nickname:De}:ut);P($t),localStorage.setItem("transit-favorite-stops",JSON.stringify($t)),me(null)},tt=it=>{const $t=new Date-new Date(it),ut=Math.floor($t/6e4),vt=Math.floor($t/36e5),nr=Math.floor($t/864e5);return ut<60?`${ut}m ago`:vt<24?`${vt}h ago`:`${nr}d ago`};return v.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 flex flex-col",children:[v.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[v.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),v.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),v.jsx(Za,{}),v.jsxs("div",{className:"bg-white/70 dark:bg-gray-900/70 border-b border-gray-200 dark:border-gray-700 px-4 py-4 backdrop-blur rounded-b-2xl",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Favorites"}),v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("button",{onClick:()=>Ee(!0),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:v.jsx(g1,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),v.jsx(fp,{darkMode:u,onToggle:()=>p(!u)})]})]}),v.jsx("div",{className:"flex space-x-1 mt-4 bg-white/70 dark:bg-gray-800/60 rounded-xl p-1 border border-gray-200 dark:border-gray-700",children:He.map(it=>{const De=it.icon;return v.jsxs("button",{onClick:()=>w(it.id),className:`flex items-center space-x-2 px-4 py-2 rounded-xl transition-all relative ${g===it.id?"bg-emerald-600 text-white shadow-sm":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[v.jsx(De,{className:"w-4 h-4"}),v.jsx("span",{className:"font-medium",children:it.label})]},it.id)})})]}),v.jsx("div",{className:"flex-1 overflow-auto p-4",children:v.jsxs(fo,{mode:"wait",children:[g==="stops"&&v.jsx(rr.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"p-0 max-w-4xl mx-auto",children:E.length>0?v.jsx("div",{className:"space-y-3",children:E.map((it,De)=>{const $t=Me[it.icon]||wy;return v.jsx(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:De*.1},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-4",children:v.jsxs("div",{className:"flex items-start justify-between",children:[v.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[v.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-700 rounded-lg",children:v.jsx($t,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),v.jsxs("div",{className:"flex-1",children:[Y===it.id?v.jsx("input",{type:"text",defaultValue:it.nickname,onBlur:ut=>Ye(it.id,ut.target.value),onKeyDown:ut=>{ut.key==="Enter"&&Ye(it.id,ut.target.value)},className:"text-lg font-semibold bg-transparent border-b border-blue-500 focus:outline-none text-gray-900 dark:text-white",autoFocus:!0}):v.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:it.nickname}),v.jsx("p",{className:"text-sm text-gray-500 mb-2",children:it.name}),v.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[v.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:it.routeColor},children:it.routeShortName}),v.jsx("span",{className:"text-sm text-gray-500",children:"Next arrivals"})]}),v.jsx("div",{className:"flex space-x-2",children:it.nextArrivals.map((ut,vt)=>v.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${vt===0?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:ut},vt))})]})]}),v.jsxs("div",{className:"flex items-center space-x-1",children:[v.jsx("button",{onClick:()=>me(it.id),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:v.jsx(m1,{className:"w-4 h-4 text-gray-400"})}),v.jsx("button",{onClick:()=>kt(it.id),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:v.jsx(Sx,{className:"w-4 h-4 text-red-400"})})]})]})},it.id)})}):v.jsxs("div",{className:"text-center py-12",children:[v.jsx(bE,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),v.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No favorite stops yet"}),v.jsx("p",{className:"text-gray-500",children:"Add stops to your favorites for quick access to arrival times."})]})},"stops"),g==="routes"&&v.jsx(rr.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"p-0 max-w-4xl mx-auto",children:j.length>0?v.jsx("div",{className:"space-y-3",children:j.map((it,De)=>v.jsx(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:De*.1},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-4",children:v.jsxs("div",{className:"flex items-start justify-between",children:[v.jsxs("div",{className:"flex-1",children:[v.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:it.name}),v.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[v.jsx(Bo,{className:"w-4 h-4 text-green-500"}),v.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:it.from}),v.jsx("span",{className:"text-gray-400",children:"→"}),v.jsx(Bo,{className:"w-4 h-4 text-red-500"}),v.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:it.to})]}),v.jsxs("div",{className:"flex items-center space-x-4 mb-3",children:[v.jsx("div",{className:"flex items-center space-x-1",children:it.routes.map(($t,ut)=>v.jsxs("div",{className:"flex items-center space-x-1",children:[v.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:$t.color},children:$t.shortName}),ut<it.routes.length-1&&v.jsx("span",{className:"text-gray-400 text-sm",children:"→"})]},ut))}),v.jsx("span",{className:"text-sm text-gray-500",children:it.duration})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("span",{className:"text-xs text-gray-400",children:["Last used: ",tt(it.lastUsed)]}),v.jsx("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium",children:"Go Now"})]})]}),v.jsx("button",{onClick:()=>$e(it.id),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors ml-4",children:v.jsx(Sx,{className:"w-4 h-4 text-red-400"})})]})},it.id))}):v.jsxs("div",{className:"text-center py-12",children:[v.jsx(Ef,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),v.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No saved routes yet"}),v.jsx("p",{className:"text-gray-500",children:"Save your frequent trips for quick access."})]})},"routes"),g==="trips"&&v.jsx(rr.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"p-0 max-w-4xl mx-auto",children:G.length>0?v.jsx("div",{className:"space-y-3",children:G.map((it,De)=>v.jsx(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:De*.1},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-4",children:v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"flex-1",children:[v.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[v.jsx(Bo,{className:"w-4 h-4 text-green-500"}),v.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:it.from}),v.jsx("span",{className:"text-gray-400",children:"→"}),v.jsx(Bo,{className:"w-4 h-4 text-red-500"}),v.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:it.to})]}),v.jsxs("div",{className:"flex items-center space-x-4",children:[v.jsx("div",{className:"flex items-center space-x-1",children:it.routes.map(($t,ut)=>v.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:$t.color},children:$t.shortName},ut))}),v.jsx("span",{className:"text-sm text-gray-500",children:it.duration}),v.jsx("span",{className:"text-xs text-gray-400",children:tt(it.date)})]})]}),v.jsx("button",{className:"px-3 py-1 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors text-sm font-medium",children:"Repeat"})]})},it.id))}):v.jsxs("div",{className:"text-center py-12",children:[v.jsx(Bc,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),v.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No recent trips"}),v.jsx("p",{className:"text-gray-500",children:"Your recent trip searches will appear here."})]})},"trips")]})})]})},cP=({darkMode:u,setDarkMode:p})=>{const[g,w]=ee.useState([]),[E,P]=ee.useState([]),[j,F]=ee.useState([]),[s,U]=ee.useState("all"),[G,J]=ee.useState(!1),[Y,me]=ee.useState(!0),[Ae,Ee]=ee.useState({disruptions:!0,delays:!0,maintenance:!1,weather:!0}),Re={disruption:{label:"Service Disruption",icon:fE,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",borderColor:"border-red-200 dark:border-red-800"},delay:{label:"Delay",icon:Bc,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",borderColor:"border-yellow-200 dark:border-yellow-800"},maintenance:{label:"Planned Maintenance",icon:yE,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800"},weather:{label:"Weather Alert",icon:mE,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",borderColor:"border-purple-200 dark:border-purple-800"},info:{label:"Information",icon:p1,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-800",borderColor:"border-gray-200 dark:border-gray-700"}},Ue={high:{label:"High",color:"text-red-600",bgColor:"bg-red-100 dark:bg-red-900"},medium:{label:"Medium",color:"text-yellow-600",bgColor:"bg-yellow-100 dark:bg-yellow-900"},low:{label:"Low",color:"text-blue-600",bgColor:"bg-blue-100 dark:bg-blue-900"}};ee.useEffect(()=>{He();const Ye=setInterval(He,6e4);return()=>clearInterval(Ye)},[]),ee.useEffect(()=>{Me()},[g,s]);const He=async()=>{me(!0);try{const[Ye,tt]=await Promise.all([L0(),ng()]),it=(Ye||[]).map(De=>({...De,startTime:De.start_time?new Date(De.start_time):new Date,endTime:De.end_time?new Date(De.end_time):null,lastUpdated:De.updated_at?new Date(De.updated_at):new Date}));w(it),P(tt||[])}catch{w([]),P([])}me(!1)},Me=()=>{let Ye=g;s!=="all"&&(Ye=g.filter(tt=>tt.type===s)),Ye.sort((tt,it)=>{const De={high:3,medium:2,low:1};return De[tt.severity]!==De[it.severity]?De[it.severity]-De[tt.severity]:new Date(it.lastUpdated)-new Date(tt.lastUpdated)}),F(Ye)},lt=(Ye,tt)=>{const it=new Date(Ye),De=new Date;if(it>De)return`Starts in ${Math.ceil((it-De)/36e5)}h`;if(!tt)return"Ongoing";const $t=new Date(tt);return $t<De?"Resolved":`${Math.ceil(($t-De)/(1e3*60*60))}h remaining`},kt=Ye=>E.find(tt=>tt.short_name===Ye),$e=Ye=>{Ee(tt=>({...tt,[Ye]:!tt[Ye]}))};return v.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 flex flex-col",children:[v.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[v.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),v.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),v.jsx(Za,{}),v.jsxs("div",{className:"bg-white/70 dark:bg-gray-900/70 border-b border-gray-200 dark:border-gray-700 px-4 py-4 backdrop-blur rounded-b-2xl",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"flex items-center space-x-3",children:[v.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Service Alerts"}),j.filter(Ye=>Ye.isActive&&Ye.severity==="high").length>0&&v.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 bg-red-100 dark:bg-red-900 rounded-full",children:[v.jsx(zf,{className:"w-4 h-4 text-red-600"}),v.jsxs("span",{className:"text-xs font-medium text-red-600",children:[j.filter(Ye=>Ye.isActive&&Ye.severity==="high").length," Active"]})]})]}),v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("button",{onClick:()=>J(!G),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:v.jsx(u1,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),v.jsx(fp,{darkMode:u,onToggle:()=>p(!u)})]})]}),v.jsx("div",{className:"flex space-x-1 mt-4 overflow-x-auto pb-2",children:[{id:"all",label:"All Alerts"},{id:"disruption",label:"Disruptions"},{id:"delay",label:"Delays"},{id:"maintenance",label:"Maintenance"},{id:"weather",label:"Weather"},{id:"info",label:"Info"}].map(Ye=>v.jsx("button",{onClick:()=>U(Ye.id),className:`px-4 py-2 rounded-xl whitespace-nowrap transition-all ${s===Ye.id?"bg-emerald-600 text-white":"bg-white/70 dark:bg-gray-800/60 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:Ye.label},Ye.id))})]}),v.jsx(fo,{children:G&&v.jsx(rr.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"bg-white/80 dark:bg-gray-900/60 border-b border-gray-200 dark:border-gray-700 overflow-hidden rounded-b-2xl backdrop-blur",children:v.jsxs("div",{className:"p-4",children:[v.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Notification Settings"}),v.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(Ae).map(([Ye,tt])=>v.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[v.jsx("input",{type:"checkbox",checked:tt,onChange:()=>$e(Ye),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),v.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 capitalize",children:Ye})]},Ye))})]})})}),v.jsx("div",{className:"flex-1 overflow-auto p-4",children:Y?v.jsxs("div",{className:"flex items-center justify-center py-12",children:[v.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"}),v.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading alerts..."})]}):j.length>0?v.jsx("div",{className:"space-y-4 max-w-4xl mx-auto",children:j.map((Ye,tt)=>{const it=Re[Ye.type],De=Ue[Ye.severity],$t=it.icon;return v.jsx(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:tt*.1},className:`rounded-2xl border p-4 ${it.bgColor} ${it.borderColor} shadow-sm`,children:v.jsxs("div",{className:"flex items-start space-x-3",children:[v.jsx("div",{className:`p-2 rounded-lg ${De.bgColor}`,children:v.jsx($t,{className:`w-5 h-5 ${it.color}`})}),v.jsxs("div",{className:"flex-1",children:[v.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[v.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:Ye.title}),v.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${De.color} ${De.bgColor}`,children:De.label}),Ye.isActive&&v.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900 text-green-600",children:"Active"})]}),v.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-3",children:Ye.description}),Ye.affectedRoutes&&Ye.affectedRoutes.length>0&&v.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[v.jsx("span",{className:"text-sm text-gray-500",children:"Affected routes:"}),v.jsx("div",{className:"flex space-x-1",children:Ye.affectedRoutes.map(ut=>{const vt=kt(ut);return v.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:vt?.color||"#6b7280"},children:ut},ut)})})]}),Ye.affectedStops&&Ye.affectedStops.length>0&&v.jsxs("div",{className:"flex items-start space-x-2 mb-2",children:[v.jsx(Bo,{className:"w-4 h-4 text-gray-400 mt-0.5"}),v.jsx("div",{className:"flex flex-wrap gap-1",children:Ye.affectedStops.map((ut,vt)=>v.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[ut,vt<Ye.affectedStops.length-1&&","]},vt))})]}),v.jsxs("div",{className:"flex items-center justify-between text-sm",children:[v.jsx("span",{className:"text-gray-500",children:lt(Ye.startTime,Ye.endTime)}),v.jsxs("span",{className:"text-gray-400",children:["Updated: ",Ye.lastUpdated.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]})]})},Ye.id)})}):v.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[v.jsx(_y,{className:"w-12 h-12 text-green-500 mb-4"}),v.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"All Clear!"}),v.jsx("p",{className:"text-gray-500 text-center",children:s==="all"?"No service alerts at this time.":`No ${s} alerts currently.`})]})})]})},uP=({darkMode:u,setDarkMode:p})=>{const[g,w]=ee.useState({name:"Alemayehu Tesfaye",email:"alemayehu.tesfaye@email.com",avatar:null,joinDate:"March 2024"}),[E,P]=ee.useState({notifications:{pushNotifications:!0,serviceAlerts:!0,arrivalReminders:!0,weeklyDigest:!1},preferences:{language:"en",units:"metric",walkingSpeed:"normal",accessibilityMode:!1,showCrowding:!0,autoRefresh:!0},privacy:{locationTracking:!0,analyticsSharing:!1,crashReporting:!0},offline:{downloadMaps:!1,offlineSchedules:!0,dataUsage:"wifi-only"}}),[j,F]=ee.useState(!1),[s,U]=ee.useState(g.name);ee.useEffect(()=>{const Ee=localStorage.getItem("transit-settings");Ee&&P(JSON.parse(Ee))},[]);const G=(Ee,Re,Ue)=>{const He={...E,[Ee]:{...E[Ee],[Re]:Ue}};P(He),localStorage.setItem("transit-settings",JSON.stringify(He))},J=()=>{w({...g,name:s}),F(!1)},Y=({label:Ee,description:Re,checked:Ue,onChange:He})=>v.jsxs("div",{className:"flex items-center justify-between py-3",children:[v.jsxs("div",{className:"flex-1",children:[v.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:Ee}),Re&&v.jsx("p",{className:"text-sm text-gray-500 mt-1",children:Re})]}),v.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[v.jsx("input",{type:"checkbox",className:"sr-only peer",checked:Ue,onChange:Me=>He(Me.target.checked)}),v.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),me=({label:Ee,description:Re,value:Ue,options:He,onChange:Me})=>v.jsxs("div",{className:"flex items-center justify-between py-3",children:[v.jsxs("div",{className:"flex-1",children:[v.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:Ee}),Re&&v.jsx("p",{className:"text-sm text-gray-500 mt-1",children:Re})]}),v.jsx("select",{value:Ue,onChange:lt=>Me(lt.target.value),className:"px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:He.map(lt=>v.jsx("option",{value:lt.value,children:lt.label},lt.value))})]}),Ae=({label:Ee,description:Re,icon:Ue,onClick:He,rightText:Me,danger:lt=!1})=>v.jsxs("button",{onClick:He,className:`w-full flex items-center justify-between py-3 px-4 rounded-lg transition-colors ${lt?"hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 dark:text-red-400":"hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[v.jsxs("div",{className:"flex items-center space-x-3",children:[v.jsx(Ue,{className:`w-5 h-5 ${lt?"text-red-500":"text-gray-400"}`}),v.jsxs("div",{className:"text-left",children:[v.jsx("h4",{className:`font-medium ${lt?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-white"}`,children:Ee}),Re&&v.jsx("p",{className:"text-sm text-gray-500 mt-1",children:Re})]})]}),Me&&v.jsx("span",{className:"text-sm text-gray-500",children:Me})]});return v.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 flex flex-col",children:[v.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[v.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),v.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),v.jsx("div",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 py-4",children:v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Settings"}),v.jsx(fp,{darkMode:u,onToggle:()=>p(!u)})]})}),v.jsxs("div",{className:"flex-1 overflow-auto",children:[v.jsx("div",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 p-4",children:v.jsxs("div",{className:"flex items-center space-x-4",children:[v.jsxs("div",{className:"relative",children:[v.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center",children:g.avatar?v.jsx("img",{src:g.avatar||"/placeholder.svg",alt:"Profile",className:"w-16 h-16 rounded-full object-cover"}):v.jsx(DE,{className:"w-8 h-8 text-white"})}),v.jsx("button",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:v.jsx(uE,{className:"w-3 h-3 text-white"})})]}),v.jsx("div",{className:"flex-1",children:j?v.jsxs("div",{className:"space-y-2",children:[v.jsx("input",{type:"text",value:s,onChange:Ee=>U(Ee.target.value),className:"text-lg font-semibold bg-transparent border-b border-blue-500 focus:outline-none text-gray-900 dark:text-white",autoFocus:!0}),v.jsxs("div",{className:"flex space-x-2",children:[v.jsx("button",{onClick:J,className:"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600",children:"Save"}),v.jsx("button",{onClick:()=>{F(!1),U(g.name)},className:"px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded text-sm hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"})]})]}):v.jsxs("div",{children:[v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:g.name}),v.jsx("button",{onClick:()=>F(!0),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded",children:v.jsx(m1,{className:"w-4 h-4 text-gray-400"})})]}),v.jsx("p",{className:"text-sm text-gray-500",children:g.email}),v.jsxs("p",{className:"text-xs text-gray-400",children:["Member since ",g.joinDate]})]})})]})}),v.jsxs("div",{className:"space-y-6 p-4",children:[v.jsxs(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[v.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[v.jsx(lE,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),v.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Notifications"})]}),v.jsxs("div",{className:"space-y-1",children:[v.jsx(Y,{label:"Push Notifications",description:"Receive notifications on your device",checked:E.notifications.pushNotifications,onChange:Ee=>G("notifications","pushNotifications",Ee)}),v.jsx(Y,{label:"Service Alerts",description:"Get notified about service disruptions",checked:E.notifications.serviceAlerts,onChange:Ee=>G("notifications","serviceAlerts",Ee)}),v.jsx(Y,{label:"Arrival Reminders",description:"Reminders before your bus arrives",checked:E.notifications.arrivalReminders,onChange:Ee=>G("notifications","arrivalReminders",Ee)}),v.jsx(Y,{label:"Weekly Digest",description:"Summary of your transit usage",checked:E.notifications.weeklyDigest,onChange:Ee=>G("notifications","weeklyDigest",Ee)})]})]}),v.jsxs(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[v.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[v.jsx(xE,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),v.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Preferences"})]}),v.jsxs("div",{className:"space-y-1",children:[v.jsx(me,{label:"Language",value:E.preferences.language,options:[{value:"en",label:"English"},{value:"am",label:"አማርኛ (Amharic)"},{value:"or",label:"Afaan Oromoo"},{value:"ti",label:"ትግርኛ (Tigrinya)"}],onChange:Ee=>G("preferences","language",Ee)}),v.jsx(me,{label:"Units",value:E.preferences.units,options:[{value:"metric",label:"Metric (km)"},{value:"imperial",label:"Imperial (mi)"}],onChange:Ee=>G("preferences","units",Ee)}),v.jsx(me,{label:"Walking Speed",description:"Used for trip planning calculations",value:E.preferences.walkingSpeed,options:[{value:"slow",label:"Slow (3 km/h)"},{value:"normal",label:"Normal (5 km/h)"},{value:"fast",label:"Fast (6 km/h)"}],onChange:Ee=>G("preferences","walkingSpeed",Ee)}),v.jsx(Y,{label:"Accessibility Mode",description:"Prioritize accessible routes and stops",checked:E.preferences.accessibilityMode,onChange:Ee=>G("preferences","accessibilityMode",Ee)}),v.jsx(Y,{label:"Show Crowding Info",description:"Display real-time crowding levels",checked:E.preferences.showCrowding,onChange:Ee=>G("preferences","showCrowding",Ee)}),v.jsx(Y,{label:"Auto Refresh",description:"Automatically update arrival times",checked:E.preferences.autoRefresh,onChange:Ee=>G("preferences","autoRefresh",Ee)})]})]}),v.jsxs(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[v.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[v.jsx(ME,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),v.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Privacy & Data"})]}),v.jsxs("div",{className:"space-y-1",children:[v.jsx(Y,{label:"Location Tracking",description:"Allow app to access your location",checked:E.privacy.locationTracking,onChange:Ee=>G("privacy","locationTracking",Ee)}),v.jsx(Y,{label:"Analytics Sharing",description:"Help improve the app with usage data",checked:E.privacy.analyticsSharing,onChange:Ee=>G("privacy","analyticsSharing",Ee)}),v.jsx(Y,{label:"Crash Reporting",description:"Automatically send crash reports",checked:E.privacy.crashReporting,onChange:Ee=>G("privacy","crashReporting",Ee)})]})]}),v.jsxs(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[v.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[v.jsx(LE,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),v.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Offline & Data Usage"})]}),v.jsxs("div",{className:"space-y-1",children:[v.jsx(Y,{label:"Download Maps",description:"Save maps for offline use (500MB)",checked:E.offline.downloadMaps,onChange:Ee=>G("offline","downloadMaps",Ee)}),v.jsx(Y,{label:"Offline Schedules",description:"Cache schedules for offline viewing",checked:E.offline.offlineSchedules,onChange:Ee=>G("offline","offlineSchedules",Ee)}),v.jsx(me,{label:"Data Usage",description:"Control when to use mobile data",value:E.offline.dataUsage,options:[{value:"always",label:"Always"},{value:"wifi-only",label:"Wi-Fi Only"},{value:"never",label:"Never"}],onChange:Ee=>G("offline","dataUsage",Ee)})]})]}),v.jsx(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:v.jsxs("div",{className:"space-y-1",children:[v.jsx(Ae,{label:"Help & Support",description:"Get help and contact support",icon:xy,onClick:()=>console.log("Open help")}),v.jsx(Ae,{label:"About Transit",description:"App version and legal information",icon:p1,onClick:()=>console.log("Open about"),rightText:"v6.0.1"}),v.jsx(Ae,{label:"Sign Out",description:"Sign out of your account",icon:f1,onClick:()=>console.log("Sign out"),danger:!0})]})})]})]})]})};function hP(){return v.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 text-gray-900 dark:text-gray-100",children:[v.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[v.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),v.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),v.jsx(Za,{containerClassName:"border-0 bg-transparent"}),v.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-12",children:[v.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold tracking-tight mb-3",children:"About AddisTransit"}),v.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-8",children:"A practical, lightweight transit companion for Addis Ababa that helps riders reduce uncertainty, plan smarter trips, and stay informed in real time."}),v.jsxs("div",{className:"space-y-6",children:[v.jsxs("section",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-5 shadow",children:[v.jsx("h2",{className:"text-xl font-semibold mb-2",children:"The Challenge"}),v.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:"Riders in Addis Ababa struggle with uncertain wait times, unclear routes, and scarce service alerts. Traditional schedules rarely reflect real conditions, and information is fragmented across sources."}),v.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed mt-3",children:"Operators also need better tools to anticipate demand, allocate vehicles, and communicate disruptions quickly—especially under variable traffic and network conditions."})]}),v.jsxs("section",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-5 shadow",children:[v.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Our Solution"}),v.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-gray-700 dark:text-gray-300",children:[v.jsx("li",{children:"Real-time style bus tracking and a clean map experience"}),v.jsx("li",{children:"Trip planning with suggested departure windows"}),v.jsx("li",{children:"Live service alerts for delays, diversions, and closures"}),v.jsx("li",{children:"Offline-ready PWA for low connectivity conditions"}),v.jsx("li",{children:"AI-assisted demand forecasts to reduce crowding"})]}),v.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[v.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-4",children:[v.jsx("div",{className:"font-semibold mb-1",children:"Who it’s for"}),v.jsx("div",{className:"text-gray-700 dark:text-gray-300 text-sm",children:"Daily riders, visitors, and operators who need fast, reliable guidance without heavy data usage."})]}),v.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-4",children:[v.jsx("div",{className:"font-semibold mb-1",children:"Design principles"}),v.jsx("div",{className:"text-gray-700 dark:text-gray-300 text-sm",children:"Fast, clear, mobile-first, and resilient to patchy networks with graceful fallbacks."})]})]})]}),v.jsxs("section",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-5 shadow",children:[v.jsx("h2",{className:"text-xl font-semibold mb-2",children:"How the AI Forecasts Help"}),v.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:"The system aggregates historical patterns (by date, route, and time slot) to estimate likely passenger demand. We present ranges (lower–upper bounds) to reflect uncertainty and avoid overconfidence. Forecasts inform riders when to depart and help operators decide where extra capacity is useful."}),v.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed mt-3",children:"These forecasts are indicative, not guarantees. As live data becomes available, predictions are recalibrated to improve accuracy."})]}),v.jsxs("section",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-5 shadow",children:[v.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Data, Privacy, and Reliability"}),v.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-gray-700 dark:text-gray-300",children:[v.jsx("li",{children:"We minimize data collection and only store feedback that users explicitly submit."}),v.jsx("li",{children:"All metrics are aggregated; no personal identities are displayed."}),v.jsx("li",{children:"Where live feeds are unavailable, simulated data and forecasts are clearly labeled."})]})]}),v.jsxs("section",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-5 shadow",children:[v.jsx("h2",{className:"text-xl font-semibold mb-2",children:"What’s Next"}),v.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:"We’re working on integrating live feeds, richer route coverage, and more accurate AI forecasts, while keeping the app lightweight and accessible on all devices."}),v.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-gray-700 dark:text-gray-300 mt-3",children:[v.jsx("li",{children:"Real-time GTFS and AVL integrations"}),v.jsx("li",{children:"Operator dashboards for load balancing and incident response"}),v.jsx("li",{children:"Multimodal options (walking transfers and future rail integrations)"})]})]}),v.jsxs("section",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-5 shadow",children:[v.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Get Involved"}),v.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:"Share feedback, contribute route data, or help with translations. Your input directly improves transit for everyone in Addis Ababa."})]})]})]})]})}const dP=()=>{const[u,p]=ee.useState([]),[g,w]=ee.useState(""),[E,P]=ee.useState(!1),[j,F]=ee.useState("");ee.useEffect(()=>{s();const Y=setInterval(s,3e4);return()=>clearInterval(Y)},[]);const s=async()=>{try{const Y=await sp();p(Y)}catch(Y){console.error("Failed to load bus status:",Y)}},U=async()=>{if(!g){F("Please select a bus plate number");return}P(!0);try{const Y=await U3(g);Y.success?(F(`✅ Ticket added! ${Y.status_emoji} ${Y.current_passengers}/${Y.max_capacity} passengers`),await s()):F(`❌ Error: ${Y.error}`)}catch(Y){F(`❌ Error: ${Y.message}`)}finally{P(!1)}},G=async()=>{if(!g){F("Please select a bus plate number");return}P(!0);try{const Y=await V3(g);Y.success?(F(`🔄 Bus reset! Previous count: ${Y.previous_count}`),await s()):F(`❌ Error: ${Y.error}`)}catch(Y){F(`❌ Error: ${Y.message}`)}finally{P(!1)}},J=Y=>{switch(Y){case"green":return"text-green-600 bg-green-100";case"yellow":return"text-yellow-600 bg-yellow-100";case"red":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}};return v.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:v.jsxs("div",{className:"max-w-7xl mx-auto",children:[v.jsxs("div",{className:"mb-6",children:[v.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Bus Coordinator Interface"}),v.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Track passenger counts and manage bus capacity"})]}),v.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6",children:[v.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Quick Actions"}),v.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[v.jsxs("div",{className:"flex-1 min-w-64",children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Bus Plate Number"}),v.jsxs("select",{value:g,onChange:Y=>w(Y.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[v.jsx("option",{value:"",children:"Choose a bus..."}),u.map(Y=>v.jsxs("option",{value:Y.plate_number,children:[Y.plate_number," - Route ",Y.route_number," (",Y.route_short_name,")"]},Y.bus_id))]})]}),v.jsxs("button",{onClick:U,disabled:E||!g,className:"flex items-center gap-2 px-6 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300 text-white rounded-lg transition-colors font-medium",children:[v.jsx(g1,{className:"w-4 h-4"}),"Print Ticket (+1)"]}),v.jsxs("button",{onClick:G,disabled:E||!g,className:"flex items-center gap-2 px-6 py-2 bg-orange-500 hover:bg-orange-600 disabled:bg-orange-300 text-white rounded-lg transition-colors font-medium",children:[v.jsx(y1,{className:"w-4 h-4"}),"Reset Bus"]})]}),j&&v.jsx(rr.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-lg",children:j})]}),v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:u.map(Y=>v.jsxs(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 border-l-4",style:{borderLeftColor:Y.route_color},children:[v.jsxs("div",{className:"flex items-center justify-between mb-3",children:[v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx(Tf,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),v.jsxs("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:["Route ",Y.route_number]})]}),v.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${J(Y.status)}`,children:[Y.status_emoji," ",Y.status]})]}),v.jsxs("div",{className:"space-y-2 text-sm",children:[v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Plate:"}),v.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:Y.plate_number})]}),v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Passengers:"}),v.jsxs("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:[Y.passengers,"/",Y.max_capacity]})]}),v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Fullness:"}),v.jsxs("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:[Y.fullness_percentage,"%"]})]}),v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Tickets Sold:"}),v.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:Y.ticket_count||0})]}),v.jsxs("div",{className:"mt-3",children:[v.jsxs("div",{className:"flex justify-between text-xs text-gray-600 dark:text-gray-400 mb-1",children:[v.jsx("span",{children:"Capacity"}),v.jsxs("span",{children:[Y.fullness_percentage,"%"]})]}),v.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:v.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${Y.status==="green"?"bg-green-500":Y.status==="yellow"?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(Y.fullness_percentage,100)}%`}})})]})]})]},Y.bus_id))}),u.length===0&&v.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[v.jsx(Tf,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),v.jsx("p",{children:"No bus data available"})]})]})})},pP=()=>{const[u,p]=ee.useState(null),[g,w]=ee.useState(null),[E,P]=ee.useState(!1),[j,F]=ee.useState(""),[s,U]=ee.useState(!1);ee.useEffect(()=>{p({bus_id:"bus-12-1",plate_number:"AA-1234-5678",route_id:"route-12",route_short_name:"12",route_name:"Route 12 - Bole to Piazza",passengers:25,max_capacity:50,status:"yellow",status_emoji:"🟡",fullness_percentage:50,last_lat:38.7756,last_lng:9.0192}),G()},[]);const G=()=>{setTimeout(()=>{const Ae={id:"reroute-001",timestamp:new Date().toISOString(),from:"Admin Fleet Management",destination:{name:"Meskel Square",lng:38.7756,lat:9.0192,reason:"High passenger demand detected",expectedPassengers:45},priority:"high",estimatedArrival:"15 minutes"};w(Ae),U(!0)},5e3)},J=()=>{P(!0),F(""),setTimeout(()=>{F("✅ Reroute accepted! Navigating to new destination."),U(!1),P(!1),setTimeout(()=>{w(null),F("")},3e3)},1e3)},Y=()=>{F("❌ Reroute declined. Continuing on current route."),U(!1),w(null),setTimeout(()=>{F("")},3e3)},me=Ae=>{switch(Ae){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}};return u?v.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:v.jsxs("div",{className:"max-w-4xl mx-auto",children:[v.jsxs("div",{className:"mb-6",children:[v.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Driver Dashboard"}),v.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Bus ",u.plate_number," - Route ",u.route_short_name]})]}),v.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[v.jsx(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:v.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[v.jsx("div",{className:"h-10 w-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center",children:v.jsx(Tf,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),v.jsxs("div",{children:[v.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Bus Status"}),v.jsxs("div",{className:"text-lg font-semibold",children:[u.status_emoji," ",u.status]})]})]})}),v.jsxs(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[v.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[v.jsx("div",{className:"h-10 w-10 rounded-lg bg-green-100 dark:bg-green-900/30 flex items-center justify-center",children:v.jsx(op,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),v.jsxs("div",{children:[v.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Passengers"}),v.jsxs("div",{className:"text-lg font-semibold",children:[u.passengers,"/",u.max_capacity]})]})]}),v.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:v.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${u.status==="green"?"bg-green-500":u.status==="yellow"?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(u.fullness_percentage,100)}%`}})})]}),v.jsx(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:v.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[v.jsx("div",{className:"h-10 w-10 rounded-lg bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center",children:v.jsx(Ef,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"})}),v.jsxs("div",{children:[v.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Current Route"}),v.jsx("div",{className:"text-lg font-semibold",children:u.route_short_name})]})]})}),v.jsx(rr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:v.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[v.jsx("div",{className:"h-10 w-10 rounded-lg bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center",children:v.jsx(Bc,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),v.jsxs("div",{children:[v.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Next Stop"}),v.jsx("div",{className:"text-lg font-semibold",children:"5 min"})]})]})})]}),j&&v.jsx(rr.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6 p-4 rounded-lg bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx(_y,{className:"h-5 w-5 text-green-600"}),v.jsx("span",{className:"text-sm font-medium",children:j})]})}),v.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6",children:[v.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[v.jsx(Jm,{className:"h-5 w-5 text-blue-600"}),"Current Route: ",u.route_name]}),v.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[v.jsxs("div",{children:[v.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Route ID"}),v.jsx("div",{className:"font-semibold",children:u.route_id})]}),v.jsxs("div",{children:[v.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Plate Number"}),v.jsx("div",{className:"font-semibold",children:u.plate_number})]}),v.jsxs("div",{children:[v.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Current Location"}),v.jsxs("div",{className:"font-semibold",children:["Lat: ",u.last_lat?.toFixed(4),", Lng: ",u.last_lng?.toFixed(4)]})]}),v.jsxs("div",{children:[v.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Capacity"}),v.jsxs("div",{className:"font-semibold",children:[u.fullness_percentage,"% full"]})]})]})]}),v.jsx(fo,{children:s&&g&&v.jsx(rr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:v.jsxs(rr.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[v.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[v.jsx("div",{className:"h-10 w-10 rounded-lg bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center",children:v.jsx(zf,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),v.jsxs("div",{children:[v.jsx("h3",{className:"text-lg font-semibold",children:"New Reroute Command"}),v.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["From: ",g.from]})]})]}),v.jsxs("div",{className:"space-y-4 mb-6",children:[v.jsxs("div",{className:"p-4 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800",children:[v.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[v.jsx(Bo,{className:"h-4 w-4 text-blue-600"}),v.jsxs("span",{className:"font-semibold text-blue-900 dark:text-blue-100",children:["Destination: ",g.destination.name]})]}),v.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[v.jsxs("div",{children:["Reason: ",g.destination.reason]}),v.jsxs("div",{children:["Expected Passengers: ",g.destination.expectedPassengers]}),v.jsxs("div",{children:["ETA: ",g.estimatedArrival]})]})]}),v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${me(g.priority)}`,children:[g.priority.toUpperCase()," PRIORITY"]}),v.jsx("span",{className:"text-xs text-gray-500",children:new Date(g.timestamp).toLocaleTimeString()})]})]}),v.jsxs("div",{className:"flex gap-3",children:[v.jsx("button",{onClick:J,disabled:E,className:"flex-1 bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-400 text-white font-semibold py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:E?v.jsxs(v.Fragment,{children:[v.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Accepting..."]}):v.jsxs(v.Fragment,{children:[v.jsx(_y,{className:"h-4 w-4"}),"Accept Reroute"]})}),v.jsx("button",{onClick:Y,disabled:E,className:"flex-1 bg-gray-500 hover:bg-gray-600 disabled:bg-gray-400 text-white font-semibold py-2 px-4 rounded-lg transition-colors",children:"Decline"})]})]})})})]})}):v.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600 mx-auto mb-4"}),v.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading driver dashboard..."})]})})};function fP(){const[u,p]=ee.useState(()=>{const g=localStorage.getItem("transit-dark-mode");return g!==null?JSON.parse(g):window.matchMedia("(prefers-color-scheme: dark)").matches});return ee.useEffect(()=>{u?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("transit-dark-mode",JSON.stringify(u))},[u]),ee.useEffect(()=>{const g=window.matchMedia("(prefers-color-scheme: dark)"),w=E=>{localStorage.getItem("transit-dark-mode")===null&&p(E.matches)};return g.addEventListener("change",w),()=>g.removeEventListener("change",w)},[]),v.jsx(RE,{children:v.jsx(HS,{children:v.jsx("div",{className:"h-screen w-screen overflow-hidden bg-gray-50 dark:bg-gray-900 flex",children:v.jsx("div",{className:"flex-1 flex flex-col",children:v.jsxs(ES,{children:[v.jsx(ho,{path:"/",element:v.jsx(J3,{})}),v.jsx(ho,{path:"/map",element:v.jsx(K3,{darkMode:u,setDarkMode:p})}),v.jsx(ho,{path:"/feedback",element:v.jsx(eP,{})}),v.jsx(ho,{path:"/admin/login",element:v.jsx(tP,{})}),v.jsx(ho,{path:"/admin/dashboard",element:v.jsx(sP,{})}),v.jsx(ho,{path:"/coordinator",element:v.jsx(dP,{})}),v.jsx(ho,{path:"/driver",element:v.jsx(pP,{})}),v.jsx(ho,{path:"/about",element:v.jsx(hP,{})}),v.jsx(ho,{path:"/trip-planner",element:v.jsx(oP,{darkMode:u,setDarkMode:p})}),v.jsx(ho,{path:"/nearby",element:v.jsx(aP,{darkMode:u,setDarkMode:p})}),v.jsx(ho,{path:"/favorites",element:v.jsx(lP,{darkMode:u,setDarkMode:p})}),v.jsx(ho,{path:"/alerts",element:v.jsx(cP,{darkMode:u,setDarkMode:p})}),v.jsx(ho,{path:"/settings",element:v.jsx(uP,{darkMode:u,setDarkMode:p})})]})})})})})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(u=>{console.log("SW registered: ",u)}).catch(u=>{console.log("SW registration failed: ",u)})});try{RT.createRoot(document.getElementById("root")).render(v.jsx(Vv.StrictMode,{children:v.jsx(fP,{})}))}catch(u){console.error("Failed to render Transit app:",u),document.getElementById("root").innerHTML=`
    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; font-family: system-ui;">
      <div style="text-align: center; padding: 2rem;">
        <h1 style="color: #ef4444; margin-bottom: 1rem;">Transit App Error</h1>
        <p style="color: #6b7280; margin-bottom: 2rem;">Failed to load the application. Please refresh the page.</p>
        <button onclick="window.location.reload()" style="background: #3b82f6; color: white; padding: 0.5rem 1rem; border: none; border-radius: 0.5rem; cursor: pointer;">
          Refresh Page
        </button>
      </div>
    </div>
  `}
