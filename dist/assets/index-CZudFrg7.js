(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const k of document.querySelectorAll('link[rel="modulepreload"]'))w(k);new MutationObserver(k=>{for(const A of k)if(A.type==="childList")for(const I of A.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&w(I)}).observe(document,{childList:!0,subtree:!0});function y(k){const A={};return k.integrity&&(A.integrity=k.integrity),k.referrerPolicy&&(A.referrerPolicy=k.referrerPolicy),k.crossOrigin==="use-credentials"?A.credentials="include":k.crossOrigin==="anonymous"?A.credentials="omit":A.credentials="same-origin",A}function w(k){if(k.ep)return;k.ep=!0;const A=y(k);fetch(k.href,A)}})();function Yy(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Jg={exports:{}},bf={},Qg={exports:{}},en={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v_;function qT(){if(v_)return en;v_=1;var u=Symbol.for("react.element"),h=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),I=Symbol.for("react.context"),B=Symbol.for("react.forward_ref"),i=Symbol.for("react.suspense"),R=Symbol.for("react.memo"),$=Symbol.for("react.lazy"),K=Symbol.iterator;function Z(ve){return ve===null||typeof ve!="object"?null:(ve=K&&ve[K]||ve["@@iterator"],typeof ve=="function"?ve:null)}var he={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Te=Object.assign,ye={};function Me(ve,et,Ut){this.props=ve,this.context=et,this.refs=ye,this.updater=Ut||he}Me.prototype.isReactComponent={},Me.prototype.setState=function(ve,et){if(typeof ve!="object"&&typeof ve!="function"&&ve!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ve,et,"setState")},Me.prototype.forceUpdate=function(ve){this.updater.enqueueForceUpdate(this,ve,"forceUpdate")};function Le(){}Le.prototype=Me.prototype;function De(ve,et,Ut){this.props=ve,this.context=et,this.refs=ye,this.updater=Ut||he}var Qe=De.prototype=new Le;Qe.constructor=De,Te(Qe,Me.prototype),Qe.isPureReactComponent=!0;var dt=Array.isArray,St=Object.prototype.hasOwnProperty,ce={current:null},$e={key:!0,ref:!0,__self:!0,__source:!0};function Ge(ve,et,Ut){var Ot,pr={},lr=null,zr=null;if(et!=null)for(Ot in et.ref!==void 0&&(zr=et.ref),et.key!==void 0&&(lr=""+et.key),et)St.call(et,Ot)&&!$e.hasOwnProperty(Ot)&&(pr[Ot]=et[Ot]);var lt=arguments.length-2;if(lt===1)pr.children=Ut;else if(1<lt){for(var hr=Array(lt),ir=0;ir<lt;ir++)hr[ir]=arguments[ir+2];pr.children=hr}if(ve&&ve.defaultProps)for(Ot in lt=ve.defaultProps,lt)pr[Ot]===void 0&&(pr[Ot]=lt[Ot]);return{$$typeof:u,type:ve,key:lr,ref:zr,props:pr,_owner:ce.current}}function Ye(ve,et){return{$$typeof:u,type:ve.type,key:et,ref:ve.ref,props:ve.props,_owner:ve._owner}}function ge(ve){return typeof ve=="object"&&ve!==null&&ve.$$typeof===u}function Pt(ve){var et={"=":"=0",":":"=2"};return"$"+ve.replace(/[=:]/g,function(Ut){return et[Ut]})}var tt=/\/+/g;function ct(ve,et){return typeof ve=="object"&&ve!==null&&ve.key!=null?Pt(""+ve.key):et.toString(36)}function Kt(ve,et,Ut,Ot,pr){var lr=typeof ve;(lr==="undefined"||lr==="boolean")&&(ve=null);var zr=!1;if(ve===null)zr=!0;else switch(lr){case"string":case"number":zr=!0;break;case"object":switch(ve.$$typeof){case u:case h:zr=!0}}if(zr)return zr=ve,pr=pr(zr),ve=Ot===""?"."+ct(zr,0):Ot,dt(pr)?(Ut="",ve!=null&&(Ut=ve.replace(tt,"$&/")+"/"),Kt(pr,et,Ut,"",function(ir){return ir})):pr!=null&&(ge(pr)&&(pr=Ye(pr,Ut+(!pr.key||zr&&zr.key===pr.key?"":(""+pr.key).replace(tt,"$&/")+"/")+ve)),et.push(pr)),1;if(zr=0,Ot=Ot===""?".":Ot+":",dt(ve))for(var lt=0;lt<ve.length;lt++){lr=ve[lt];var hr=Ot+ct(lr,lt);zr+=Kt(lr,et,Ut,hr,pr)}else if(hr=Z(ve),typeof hr=="function")for(ve=hr.call(ve),lt=0;!(lr=ve.next()).done;)lr=lr.value,hr=Ot+ct(lr,lt++),zr+=Kt(lr,et,Ut,hr,pr);else if(lr==="object")throw et=String(ve),Error("Objects are not valid as a React child (found: "+(et==="[object Object]"?"object with keys {"+Object.keys(ve).join(", ")+"}":et)+"). If you meant to render a collection of children, use an array instead.");return zr}function Mr(ve,et,Ut){if(ve==null)return ve;var Ot=[],pr=0;return Kt(ve,Ot,"","",function(lr){return et.call(Ut,lr,pr++)}),Ot}function Jt(ve){if(ve._status===-1){var et=ve._result;et=et(),et.then(function(Ut){(ve._status===0||ve._status===-1)&&(ve._status=1,ve._result=Ut)},function(Ut){(ve._status===0||ve._status===-1)&&(ve._status=2,ve._result=Ut)}),ve._status===-1&&(ve._status=0,ve._result=et)}if(ve._status===1)return ve._result.default;throw ve._result}var Ht={current:null},Tt={transition:null},Be={ReactCurrentDispatcher:Ht,ReactCurrentBatchConfig:Tt,ReactCurrentOwner:ce};function Je(){throw Error("act(...) is not supported in production builds of React.")}return en.Children={map:Mr,forEach:function(ve,et,Ut){Mr(ve,function(){et.apply(this,arguments)},Ut)},count:function(ve){var et=0;return Mr(ve,function(){et++}),et},toArray:function(ve){return Mr(ve,function(et){return et})||[]},only:function(ve){if(!ge(ve))throw Error("React.Children.only expected to receive a single React element child.");return ve}},en.Component=Me,en.Fragment=y,en.Profiler=k,en.PureComponent=De,en.StrictMode=w,en.Suspense=i,en.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Be,en.act=Je,en.cloneElement=function(ve,et,Ut){if(ve==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ve+".");var Ot=Te({},ve.props),pr=ve.key,lr=ve.ref,zr=ve._owner;if(et!=null){if(et.ref!==void 0&&(lr=et.ref,zr=ce.current),et.key!==void 0&&(pr=""+et.key),ve.type&&ve.type.defaultProps)var lt=ve.type.defaultProps;for(hr in et)St.call(et,hr)&&!$e.hasOwnProperty(hr)&&(Ot[hr]=et[hr]===void 0&&lt!==void 0?lt[hr]:et[hr])}var hr=arguments.length-2;if(hr===1)Ot.children=Ut;else if(1<hr){lt=Array(hr);for(var ir=0;ir<hr;ir++)lt[ir]=arguments[ir+2];Ot.children=lt}return{$$typeof:u,type:ve.type,key:pr,ref:lr,props:Ot,_owner:zr}},en.createContext=function(ve){return ve={$$typeof:I,_currentValue:ve,_currentValue2:ve,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ve.Provider={$$typeof:A,_context:ve},ve.Consumer=ve},en.createElement=Ge,en.createFactory=function(ve){var et=Ge.bind(null,ve);return et.type=ve,et},en.createRef=function(){return{current:null}},en.forwardRef=function(ve){return{$$typeof:B,render:ve}},en.isValidElement=ge,en.lazy=function(ve){return{$$typeof:$,_payload:{_status:-1,_result:ve},_init:Jt}},en.memo=function(ve,et){return{$$typeof:R,type:ve,compare:et===void 0?null:et}},en.startTransition=function(ve){var et=Tt.transition;Tt.transition={};try{ve()}finally{Tt.transition=et}},en.unstable_act=Je,en.useCallback=function(ve,et){return Ht.current.useCallback(ve,et)},en.useContext=function(ve){return Ht.current.useContext(ve)},en.useDebugValue=function(){},en.useDeferredValue=function(ve){return Ht.current.useDeferredValue(ve)},en.useEffect=function(ve,et){return Ht.current.useEffect(ve,et)},en.useId=function(){return Ht.current.useId()},en.useImperativeHandle=function(ve,et,Ut){return Ht.current.useImperativeHandle(ve,et,Ut)},en.useInsertionEffect=function(ve,et){return Ht.current.useInsertionEffect(ve,et)},en.useLayoutEffect=function(ve,et){return Ht.current.useLayoutEffect(ve,et)},en.useMemo=function(ve,et){return Ht.current.useMemo(ve,et)},en.useReducer=function(ve,et,Ut){return Ht.current.useReducer(ve,et,Ut)},en.useRef=function(ve){return Ht.current.useRef(ve)},en.useState=function(ve){return Ht.current.useState(ve)},en.useSyncExternalStore=function(ve,et,Ut){return Ht.current.useSyncExternalStore(ve,et,Ut)},en.useTransition=function(){return Ht.current.useTransition()},en.version="18.3.1",en}var b_;function Jy(){return b_||(b_=1,Qg.exports=qT()),Qg.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w_;function ZT(){if(w_)return bf;w_=1;var u=Jy(),h=Symbol.for("react.element"),y=Symbol.for("react.fragment"),w=Object.prototype.hasOwnProperty,k=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,A={key:!0,ref:!0,__self:!0,__source:!0};function I(B,i,R){var $,K={},Z=null,he=null;R!==void 0&&(Z=""+R),i.key!==void 0&&(Z=""+i.key),i.ref!==void 0&&(he=i.ref);for($ in i)w.call(i,$)&&!A.hasOwnProperty($)&&(K[$]=i[$]);if(B&&B.defaultProps)for($ in i=B.defaultProps,i)K[$]===void 0&&(K[$]=i[$]);return{$$typeof:h,type:B,key:Z,ref:he,props:K,_owner:k.current}}return bf.Fragment=y,bf.jsx=I,bf.jsxs=I,bf}var T_;function HT(){return T_||(T_=1,Jg.exports=ZT()),Jg.exports}var m=HT(),H=Jy();const n1=Yy(H);var Lm={},ey={exports:{}},ma={},ty={exports:{}},ry={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var k_;function XT(){return k_||(k_=1,(function(u){function h(Tt,Be){var Je=Tt.length;Tt.push(Be);e:for(;0<Je;){var ve=Je-1>>>1,et=Tt[ve];if(0<k(et,Be))Tt[ve]=Be,Tt[Je]=et,Je=ve;else break e}}function y(Tt){return Tt.length===0?null:Tt[0]}function w(Tt){if(Tt.length===0)return null;var Be=Tt[0],Je=Tt.pop();if(Je!==Be){Tt[0]=Je;e:for(var ve=0,et=Tt.length,Ut=et>>>1;ve<Ut;){var Ot=2*(ve+1)-1,pr=Tt[Ot],lr=Ot+1,zr=Tt[lr];if(0>k(pr,Je))lr<et&&0>k(zr,pr)?(Tt[ve]=zr,Tt[lr]=Je,ve=lr):(Tt[ve]=pr,Tt[Ot]=Je,ve=Ot);else if(lr<et&&0>k(zr,Je))Tt[ve]=zr,Tt[lr]=Je,ve=lr;else break e}}return Be}function k(Tt,Be){var Je=Tt.sortIndex-Be.sortIndex;return Je!==0?Je:Tt.id-Be.id}if(typeof performance=="object"&&typeof performance.now=="function"){var A=performance;u.unstable_now=function(){return A.now()}}else{var I=Date,B=I.now();u.unstable_now=function(){return I.now()-B}}var i=[],R=[],$=1,K=null,Z=3,he=!1,Te=!1,ye=!1,Me=typeof setTimeout=="function"?setTimeout:null,Le=typeof clearTimeout=="function"?clearTimeout:null,De=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Qe(Tt){for(var Be=y(R);Be!==null;){if(Be.callback===null)w(R);else if(Be.startTime<=Tt)w(R),Be.sortIndex=Be.expirationTime,h(i,Be);else break;Be=y(R)}}function dt(Tt){if(ye=!1,Qe(Tt),!Te)if(y(i)!==null)Te=!0,Jt(St);else{var Be=y(R);Be!==null&&Ht(dt,Be.startTime-Tt)}}function St(Tt,Be){Te=!1,ye&&(ye=!1,Le(Ge),Ge=-1),he=!0;var Je=Z;try{for(Qe(Be),K=y(i);K!==null&&(!(K.expirationTime>Be)||Tt&&!Pt());){var ve=K.callback;if(typeof ve=="function"){K.callback=null,Z=K.priorityLevel;var et=ve(K.expirationTime<=Be);Be=u.unstable_now(),typeof et=="function"?K.callback=et:K===y(i)&&w(i),Qe(Be)}else w(i);K=y(i)}if(K!==null)var Ut=!0;else{var Ot=y(R);Ot!==null&&Ht(dt,Ot.startTime-Be),Ut=!1}return Ut}finally{K=null,Z=Je,he=!1}}var ce=!1,$e=null,Ge=-1,Ye=5,ge=-1;function Pt(){return!(u.unstable_now()-ge<Ye)}function tt(){if($e!==null){var Tt=u.unstable_now();ge=Tt;var Be=!0;try{Be=$e(!0,Tt)}finally{Be?ct():(ce=!1,$e=null)}}else ce=!1}var ct;if(typeof De=="function")ct=function(){De(tt)};else if(typeof MessageChannel<"u"){var Kt=new MessageChannel,Mr=Kt.port2;Kt.port1.onmessage=tt,ct=function(){Mr.postMessage(null)}}else ct=function(){Me(tt,0)};function Jt(Tt){$e=Tt,ce||(ce=!0,ct())}function Ht(Tt,Be){Ge=Me(function(){Tt(u.unstable_now())},Be)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(Tt){Tt.callback=null},u.unstable_continueExecution=function(){Te||he||(Te=!0,Jt(St))},u.unstable_forceFrameRate=function(Tt){0>Tt||125<Tt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ye=0<Tt?Math.floor(1e3/Tt):5},u.unstable_getCurrentPriorityLevel=function(){return Z},u.unstable_getFirstCallbackNode=function(){return y(i)},u.unstable_next=function(Tt){switch(Z){case 1:case 2:case 3:var Be=3;break;default:Be=Z}var Je=Z;Z=Be;try{return Tt()}finally{Z=Je}},u.unstable_pauseExecution=function(){},u.unstable_requestPaint=function(){},u.unstable_runWithPriority=function(Tt,Be){switch(Tt){case 1:case 2:case 3:case 4:case 5:break;default:Tt=3}var Je=Z;Z=Tt;try{return Be()}finally{Z=Je}},u.unstable_scheduleCallback=function(Tt,Be,Je){var ve=u.unstable_now();switch(typeof Je=="object"&&Je!==null?(Je=Je.delay,Je=typeof Je=="number"&&0<Je?ve+Je:ve):Je=ve,Tt){case 1:var et=-1;break;case 2:et=250;break;case 5:et=1073741823;break;case 4:et=1e4;break;default:et=5e3}return et=Je+et,Tt={id:$++,callback:Be,priorityLevel:Tt,startTime:Je,expirationTime:et,sortIndex:-1},Je>ve?(Tt.sortIndex=Je,h(R,Tt),y(i)===null&&Tt===y(R)&&(ye?(Le(Ge),Ge=-1):ye=!0,Ht(dt,Je-ve))):(Tt.sortIndex=et,h(i,Tt),Te||he||(Te=!0,Jt(St))),Tt},u.unstable_shouldYield=Pt,u.unstable_wrapCallback=function(Tt){var Be=Z;return function(){var Je=Z;Z=Be;try{return Tt.apply(this,arguments)}finally{Z=Je}}}})(ry)),ry}var S_;function KT(){return S_||(S_=1,ty.exports=XT()),ty.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var E_;function YT(){if(E_)return ma;E_=1;var u=Jy(),h=KT();function y(a){for(var c="https://reactjs.org/docs/error-decoder.html?invariant="+a,_=1;_<arguments.length;_++)c+="&args[]="+encodeURIComponent(arguments[_]);return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var w=new Set,k={};function A(a,c){I(a,c),I(a+"Capture",c)}function I(a,c){for(k[a]=c,a=0;a<c.length;a++)w.add(c[a])}var B=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),i=Object.prototype.hasOwnProperty,R=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,$={},K={};function Z(a){return i.call(K,a)?!0:i.call($,a)?!1:R.test(a)?K[a]=!0:($[a]=!0,!1)}function he(a,c,_,E){if(_!==null&&_.type===0)return!1;switch(typeof c){case"function":case"symbol":return!0;case"boolean":return E?!1:_!==null?!_.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function Te(a,c,_,E){if(c===null||typeof c>"u"||he(a,c,_,E))return!0;if(E)return!1;if(_!==null)switch(_.type){case 3:return!c;case 4:return c===!1;case 5:return isNaN(c);case 6:return isNaN(c)||1>c}return!1}function ye(a,c,_,E,N,O,J){this.acceptsBooleans=c===2||c===3||c===4,this.attributeName=E,this.attributeNamespace=N,this.mustUseProperty=_,this.propertyName=a,this.type=c,this.sanitizeURL=O,this.removeEmptyString=J}var Me={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){Me[a]=new ye(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var c=a[0];Me[c]=new ye(c,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){Me[a]=new ye(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){Me[a]=new ye(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){Me[a]=new ye(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){Me[a]=new ye(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){Me[a]=new ye(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){Me[a]=new ye(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){Me[a]=new ye(a,5,!1,a.toLowerCase(),null,!1,!1)});var Le=/[\-:]([a-z])/g;function De(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var c=a.replace(Le,De);Me[c]=new ye(c,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var c=a.replace(Le,De);Me[c]=new ye(c,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var c=a.replace(Le,De);Me[c]=new ye(c,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){Me[a]=new ye(a,1,!1,a.toLowerCase(),null,!1,!1)}),Me.xlinkHref=new ye("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){Me[a]=new ye(a,1,!1,a.toLowerCase(),null,!0,!0)});function Qe(a,c,_,E){var N=Me.hasOwnProperty(c)?Me[c]:null;(N!==null?N.type!==0:E||!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(Te(c,_,N,E)&&(_=null),E||N===null?Z(c)&&(_===null?a.removeAttribute(c):a.setAttribute(c,""+_)):N.mustUseProperty?a[N.propertyName]=_===null?N.type===3?!1:"":_:(c=N.attributeName,E=N.attributeNamespace,_===null?a.removeAttribute(c):(N=N.type,_=N===3||N===4&&_===!0?"":""+_,E?a.setAttributeNS(E,c,_):a.setAttribute(c,_))))}var dt=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,St=Symbol.for("react.element"),ce=Symbol.for("react.portal"),$e=Symbol.for("react.fragment"),Ge=Symbol.for("react.strict_mode"),Ye=Symbol.for("react.profiler"),ge=Symbol.for("react.provider"),Pt=Symbol.for("react.context"),tt=Symbol.for("react.forward_ref"),ct=Symbol.for("react.suspense"),Kt=Symbol.for("react.suspense_list"),Mr=Symbol.for("react.memo"),Jt=Symbol.for("react.lazy"),Ht=Symbol.for("react.offscreen"),Tt=Symbol.iterator;function Be(a){return a===null||typeof a!="object"?null:(a=Tt&&a[Tt]||a["@@iterator"],typeof a=="function"?a:null)}var Je=Object.assign,ve;function et(a){if(ve===void 0)try{throw Error()}catch(_){var c=_.stack.trim().match(/\n( *(at )?)/);ve=c&&c[1]||""}return`
`+ve+a}var Ut=!1;function Ot(a,c){if(!a||Ut)return"";Ut=!0;var _=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(c)if(c=function(){throw Error()},Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(c,[])}catch(rt){var E=rt}Reflect.construct(a,[],c)}else{try{c.call()}catch(rt){E=rt}a.call(c.prototype)}else{try{throw Error()}catch(rt){E=rt}a()}}catch(rt){if(rt&&E&&typeof rt.stack=="string"){for(var N=rt.stack.split(`
`),O=E.stack.split(`
`),J=N.length-1,xe=O.length-1;1<=J&&0<=xe&&N[J]!==O[xe];)xe--;for(;1<=J&&0<=xe;J--,xe--)if(N[J]!==O[xe]){if(J!==1||xe!==1)do if(J--,xe--,0>xe||N[J]!==O[xe]){var Pe=`
`+N[J].replace(" at new "," at ");return a.displayName&&Pe.includes("<anonymous>")&&(Pe=Pe.replace("<anonymous>",a.displayName)),Pe}while(1<=J&&0<=xe);break}}}finally{Ut=!1,Error.prepareStackTrace=_}return(a=a?a.displayName||a.name:"")?et(a):""}function pr(a){switch(a.tag){case 5:return et(a.type);case 16:return et("Lazy");case 13:return et("Suspense");case 19:return et("SuspenseList");case 0:case 2:case 15:return a=Ot(a.type,!1),a;case 11:return a=Ot(a.type.render,!1),a;case 1:return a=Ot(a.type,!0),a;default:return""}}function lr(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case $e:return"Fragment";case ce:return"Portal";case Ye:return"Profiler";case Ge:return"StrictMode";case ct:return"Suspense";case Kt:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case Pt:return(a.displayName||"Context")+".Consumer";case ge:return(a._context.displayName||"Context")+".Provider";case tt:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case Mr:return c=a.displayName||null,c!==null?c:lr(a.type)||"Memo";case Jt:c=a._payload,a=a._init;try{return lr(a(c))}catch{}}return null}function zr(a){var c=a.type;switch(a.tag){case 24:return"Cache";case 9:return(c.displayName||"Context")+".Consumer";case 10:return(c._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=c.render,a=a.displayName||a.name||"",c.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return c;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return lr(c);case 8:return c===Ge?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c}return null}function lt(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function hr(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function ir(a){var c=hr(a)?"checked":"value",_=Object.getOwnPropertyDescriptor(a.constructor.prototype,c),E=""+a[c];if(!a.hasOwnProperty(c)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var N=_.get,O=_.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return N.call(this)},set:function(J){E=""+J,O.call(this,J)}}),Object.defineProperty(a,c,{enumerable:_.enumerable}),{getValue:function(){return E},setValue:function(J){E=""+J},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function Vn(a){a._valueTracker||(a._valueTracker=ir(a))}function Yt(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var _=c.getValue(),E="";return a&&(E=hr(a)?a.checked?"true":"false":a.value),a=E,a!==_?(c.setValue(a),!0):!1}function ei(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function Rn(a,c){var _=c.checked;return Je({},c,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:_??a._wrapperState.initialChecked})}function nn(a,c){var _=c.defaultValue==null?"":c.defaultValue,E=c.checked!=null?c.checked:c.defaultChecked;_=lt(c.value!=null?c.value:_),a._wrapperState={initialChecked:E,initialValue:_,controlled:c.type==="checkbox"||c.type==="radio"?c.checked!=null:c.value!=null}}function Gr(a,c){c=c.checked,c!=null&&Qe(a,"checked",c,!1)}function sn(a,c){Gr(a,c);var _=lt(c.value),E=c.type;if(_!=null)E==="number"?(_===0&&a.value===""||a.value!=_)&&(a.value=""+_):a.value!==""+_&&(a.value=""+_);else if(E==="submit"||E==="reset"){a.removeAttribute("value");return}c.hasOwnProperty("value")?ts(a,c.type,_):c.hasOwnProperty("defaultValue")&&ts(a,c.type,lt(c.defaultValue)),c.checked==null&&c.defaultChecked!=null&&(a.defaultChecked=!!c.defaultChecked)}function za(a,c,_){if(c.hasOwnProperty("value")||c.hasOwnProperty("defaultValue")){var E=c.type;if(!(E!=="submit"&&E!=="reset"||c.value!==void 0&&c.value!==null))return;c=""+a._wrapperState.initialValue,_||c===a.value||(a.value=c),a.defaultValue=c}_=a.name,_!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,_!==""&&(a.name=_)}function ts(a,c,_){(c!=="number"||ei(a.ownerDocument)!==a)&&(_==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+_&&(a.defaultValue=""+_))}var ti=Array.isArray;function gs(a,c,_,E){if(a=a.options,c){c={};for(var N=0;N<_.length;N++)c["$"+_[N]]=!0;for(_=0;_<a.length;_++)N=c.hasOwnProperty("$"+a[_].value),a[_].selected!==N&&(a[_].selected=N),N&&E&&(a[_].defaultSelected=!0)}else{for(_=""+lt(_),c=null,N=0;N<a.length;N++){if(a[N].value===_){a[N].selected=!0,E&&(a[N].defaultSelected=!0);return}c!==null||a[N].disabled||(c=a[N])}c!==null&&(c.selected=!0)}}function Js(a,c){if(c.dangerouslySetInnerHTML!=null)throw Error(y(91));return Je({},c,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function _t(a,c){var _=c.value;if(_==null){if(_=c.children,c=c.defaultValue,_!=null){if(c!=null)throw Error(y(92));if(ti(_)){if(1<_.length)throw Error(y(93));_=_[0]}c=_}c==null&&(c=""),_=c}a._wrapperState={initialValue:lt(_)}}function dr(a,c){var _=lt(c.value),E=lt(c.defaultValue);_!=null&&(_=""+_,_!==a.value&&(a.value=_),c.defaultValue==null&&a.defaultValue!==_&&(a.defaultValue=_)),E!=null&&(a.defaultValue=""+E)}function Br(a){var c=a.textContent;c===a._wrapperState.initialValue&&c!==""&&c!==null&&(a.value=c)}function qt(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function An(a,c){return a==null||a==="http://www.w3.org/1999/xhtml"?qt(c):a==="http://www.w3.org/2000/svg"&&c==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var Wr,ui=(function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(c,_,E,N){MSApp.execUnsafeLocalFunction(function(){return a(c,_,E,N)})}:a})(function(a,c){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=c;else{for(Wr=Wr||document.createElement("div"),Wr.innerHTML="<svg>"+c.valueOf().toString()+"</svg>",c=Wr.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;c.firstChild;)a.appendChild(c.firstChild)}});function En(a,c){if(c){var _=a.firstChild;if(_&&_===a.lastChild&&_.nodeType===3){_.nodeValue=c;return}}a.textContent=c}var xn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Xo=["Webkit","ms","Moz","O"];Object.keys(xn).forEach(function(a){Xo.forEach(function(c){c=c+a.charAt(0).toUpperCase()+a.substring(1),xn[c]=xn[a]})});function Ko(a,c,_){return c==null||typeof c=="boolean"||c===""?"":_||typeof c!="number"||c===0||xn.hasOwnProperty(a)&&xn[a]?(""+c).trim():c+"px"}function Ba(a,c){a=a.style;for(var _ in c)if(c.hasOwnProperty(_)){var E=_.indexOf("--")===0,N=Ko(_,c[_],E);_==="float"&&(_="cssFloat"),E?a.setProperty(_,N):a[_]=N}}var Fa=Je({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ya(a,c){if(c){if(Fa[a]&&(c.children!=null||c.dangerouslySetInnerHTML!=null))throw Error(y(137,a));if(c.dangerouslySetInnerHTML!=null){if(c.children!=null)throw Error(y(60));if(typeof c.dangerouslySetInnerHTML!="object"||!("__html"in c.dangerouslySetInnerHTML))throw Error(y(61))}if(c.style!=null&&typeof c.style!="object")throw Error(y(62))}}function xa(a,c){if(a.indexOf("-")===-1)return typeof c.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Oa=null;function Yo(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var pe=null,X=null,Y=null;function de(a){if(a=Tl(a)){if(typeof pe!="function")throw Error(y(280));var c=a.stateNode;c&&(c=uu(c),pe(a.stateNode,a.type,c))}}function we(a){X?Y?Y.push(a):Y=[a]:X=a}function Ae(){if(X){var a=X,c=Y;if(Y=X=null,de(a),c)for(a=0;a<c.length;a++)de(c[a])}}function Fe(a,c){return a(c)}function Re(){}var Ce=!1;function He(a,c,_){if(Ce)return a(c,_);Ce=!0;try{return Fe(a,c,_)}finally{Ce=!1,(X!==null||Y!==null)&&(Re(),Ae())}}function kt(a,c){var _=a.stateNode;if(_===null)return null;var E=uu(_);if(E===null)return null;_=E[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(E=!E.disabled)||(a=a.type,E=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!E;break e;default:a=!1}if(a)return null;if(_&&typeof _!="function")throw Error(y(231,c,typeof _));return _}var It=!1;if(B)try{var xt={};Object.defineProperty(xt,"passive",{get:function(){It=!0}}),window.addEventListener("test",xt,xt),window.removeEventListener("test",xt,xt)}catch{It=!1}function yr(a,c,_,E,N,O,J,xe,Pe){var rt=Array.prototype.slice.call(arguments,3);try{c.apply(_,rt)}catch(At){this.onError(At)}}var xr=!1,gr=null,vr=!1,Nr=null,Tn={onError:function(a){xr=!0,gr=a}};function $n(a,c,_,E,N,O,J,xe,Pe){xr=!1,gr=null,yr.apply(Tn,arguments)}function Si(a,c,_,E,N,O,J,xe,Pe){if($n.apply(this,arguments),xr){if(xr){var rt=gr;xr=!1,gr=null}else throw Error(y(198));vr||(vr=!0,Nr=rt)}}function _n(a){var c=a,_=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(_=c.return),a=c.return;while(a)}return c.tag===3?_:null}function Rs(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function ri(a){if(_n(a)!==a)throw Error(y(188))}function Di(a){var c=a.alternate;if(!c){if(c=_n(a),c===null)throw Error(y(188));return c!==a?null:a}for(var _=a,E=c;;){var N=_.return;if(N===null)break;var O=N.alternate;if(O===null){if(E=N.return,E!==null){_=E;continue}break}if(N.child===O.child){for(O=N.child;O;){if(O===_)return ri(N),a;if(O===E)return ri(N),c;O=O.sibling}throw Error(y(188))}if(_.return!==E.return)_=N,E=O;else{for(var J=!1,xe=N.child;xe;){if(xe===_){J=!0,_=N,E=O;break}if(xe===E){J=!0,E=N,_=O;break}xe=xe.sibling}if(!J){for(xe=O.child;xe;){if(xe===_){J=!0,_=O,E=N;break}if(xe===E){J=!0,E=O,_=N;break}xe=xe.sibling}if(!J)throw Error(y(189))}}if(_.alternate!==E)throw Error(y(190))}if(_.tag!==3)throw Error(y(188));return _.stateNode.current===_?a:c}function yo(a){return a=Di(a),a!==null?rd(a):null}function rd(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var c=rd(a);if(c!==null)return c;a=a.sibling}return null}var Vu=h.unstable_scheduleCallback,Zr=h.unstable_cancelCallback,$u=h.unstable_shouldYield,Xl=h.unstable_requestPaint,Pn=h.unstable_now,Wc=h.unstable_getCurrentPriorityLevel,ys=h.unstable_ImmediatePriority,Qs=h.unstable_UserBlockingPriority,Jo=h.unstable_NormalPriority,Gu=h.unstable_LowPriority,Ua=h.unstable_IdlePriority,xs=null,Vi=null;function at(a){if(Vi&&typeof Vi.onCommitFiberRoot=="function")try{Vi.onCommitFiberRoot(xs,a,void 0,(a.current.flags&128)===128)}catch{}}var ni=Math.clz32?Math.clz32:nd,Gn=Math.log,hi=Math.LN2;function nd(a){return a>>>=0,a===0?32:31-(Gn(a)/hi|0)|0}var rs=64,Qo=4194304;function el(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function _a(a,c){var _=a.pendingLanes;if(_===0)return 0;var E=0,N=a.suspendedLanes,O=a.pingedLanes,J=_&268435455;if(J!==0){var xe=J&~N;xe!==0?E=el(xe):(O&=J,O!==0&&(E=el(O)))}else J=_&~N,J!==0?E=el(J):O!==0&&(E=el(O));if(E===0)return 0;if(c!==0&&c!==E&&(c&N)===0&&(N=E&-E,O=c&-c,N>=O||N===16&&(O&4194240)!==0))return c;if((E&4)!==0&&(E|=_&16),c=a.entangledLanes,c!==0)for(a=a.entanglements,c&=E;0<c;)_=31-ni(c),N=1<<_,E|=a[_],c&=~N;return E}function Bt(a,c){switch(a){case 1:case 2:case 4:return c+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Lr(a,c){for(var _=a.suspendedLanes,E=a.pingedLanes,N=a.expirationTimes,O=a.pendingLanes;0<O;){var J=31-ni(O),xe=1<<J,Pe=N[J];Pe===-1?((xe&_)===0||(xe&E)!==0)&&(N[J]=Bt(xe,c)):Pe<=c&&(a.expiredLanes|=xe),O&=~xe}}function Ar(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function $i(){var a=rs;return rs<<=1,(rs&4194240)===0&&(rs=64),a}function ns(a){for(var c=[],_=0;31>_;_++)c.push(a);return c}function br(a,c,_){a.pendingLanes|=c,c!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,c=31-ni(c),a[c]=_}function is(a,c){var _=a.pendingLanes&~c;a.pendingLanes=c,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=c,a.mutableReadLanes&=c,a.entangledLanes&=c,c=a.entanglements;var E=a.eventTimes;for(a=a.expirationTimes;0<_;){var N=31-ni(_),O=1<<N;c[N]=0,E[N]=-1,a[N]=-1,_&=~O}}function xo(a,c){var _=a.entangledLanes|=c;for(a=a.entanglements;_;){var E=31-ni(_),N=1<<E;N&c|a[E]&c&&(a[E]|=c),_&=~N}}var Hr=0;function ss(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var dn,qc,ea,tl,rl,Kl=!1,Yl=[],_s=null,vs=null,zs=null,ta=new Map,di=new Map,on=[],Wu="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Zc(a,c){switch(a){case"focusin":case"focusout":_s=null;break;case"dragenter":case"dragleave":vs=null;break;case"mouseover":case"mouseout":zs=null;break;case"pointerover":case"pointerout":ta.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":di.delete(c.pointerId)}}function pi(a,c,_,E,N,O){return a===null||a.nativeEvent!==O?(a={blockedOn:c,domEventName:_,eventSystemFlags:E,nativeEvent:O,targetContainers:[N]},c!==null&&(c=Tl(c),c!==null&&qc(c)),a):(a.eventSystemFlags|=E,c=a.targetContainers,N!==null&&c.indexOf(N)===-1&&c.push(N),a)}function bs(a,c,_,E,N){switch(c){case"focusin":return _s=pi(_s,a,c,_,E,N),!0;case"dragenter":return vs=pi(vs,a,c,_,E,N),!0;case"mouseover":return zs=pi(zs,a,c,_,E,N),!0;case"pointerover":var O=N.pointerId;return ta.set(O,pi(ta.get(O)||null,a,c,_,E,N)),!0;case"gotpointercapture":return O=N.pointerId,di.set(O,pi(di.get(O)||null,a,c,_,E,N)),!0}return!1}function qu(a){var c=Hi(a.target);if(c!==null){var _=_n(c);if(_!==null){if(c=_.tag,c===13){if(c=Rs(_),c!==null){a.blockedOn=c,rl(a.priority,function(){ea(_)});return}}else if(c===3&&_.stateNode.current.memoizedState.isDehydrated){a.blockedOn=_.tag===3?_.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Va(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var _=Hu(a.domEventName,a.eventSystemFlags,c[0],a.nativeEvent);if(_===null){_=a.nativeEvent;var E=new _.constructor(_.type,_);Oa=E,_.target.dispatchEvent(E),Oa=null}else return c=Tl(_),c!==null&&qc(c),a.blockedOn=_,!1;c.shift()}return!0}function Cn(a,c,_){Va(a)&&_.delete(c)}function Jl(){Kl=!1,_s!==null&&Va(_s)&&(_s=null),vs!==null&&Va(vs)&&(vs=null),zs!==null&&Va(zs)&&(zs=null),ta.forEach(Cn),di.forEach(Cn)}function _o(a,c){a.blockedOn===c&&(a.blockedOn=null,Kl||(Kl=!0,h.unstable_scheduleCallback(h.unstable_NormalPriority,Jl)))}function Bs(a){function c(N){return _o(N,a)}if(0<Yl.length){_o(Yl[0],a);for(var _=1;_<Yl.length;_++){var E=Yl[_];E.blockedOn===a&&(E.blockedOn=null)}}for(_s!==null&&_o(_s,a),vs!==null&&_o(vs,a),zs!==null&&_o(zs,a),ta.forEach(c),di.forEach(c),_=0;_<on.length;_++)E=on[_],E.blockedOn===a&&(E.blockedOn=null);for(;0<on.length&&(_=on[0],_.blockedOn===null);)qu(_),_.blockedOn===null&&on.shift()}var zn=dt.ReactCurrentBatchConfig,nl=!0;function Zu(a,c,_,E){var N=Hr,O=zn.transition;zn.transition=null;try{Hr=1,ra(a,c,_,E)}finally{Hr=N,zn.transition=O}}function va(a,c,_,E){var N=Hr,O=zn.transition;zn.transition=null;try{Hr=4,ra(a,c,_,E)}finally{Hr=N,zn.transition=O}}function ra(a,c,_,E){if(nl){var N=Hu(a,c,_,E);if(N===null)gl(a,c,E,vo,_),Zc(a,E);else if(bs(N,a,c,_,E))E.stopPropagation();else if(Zc(a,E),c&4&&-1<Wu.indexOf(a)){for(;N!==null;){var O=Tl(N);if(O!==null&&dn(O),O=Hu(a,c,_,E),O===null&&gl(a,c,E,vo,_),O===N)break;N=O}N!==null&&E.stopPropagation()}else gl(a,c,E,null,_)}}var vo=null;function Hu(a,c,_,E){if(vo=null,a=Yo(E),a=Hi(a),a!==null)if(c=_n(a),c===null)a=null;else if(_=c.tag,_===13){if(a=Rs(c),a!==null)return a;a=null}else if(_===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null);return vo=a,null}function Hc(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Wc()){case ys:return 1;case Qs:return 4;case Jo:case Gu:return 16;case Ua:return 536870912;default:return 16}default:return 16}}var as=null,ws=null,il=null;function $a(){if(il)return il;var a,c=ws,_=c.length,E,N="value"in as?as.value:as.textContent,O=N.length;for(a=0;a<_&&c[a]===N[a];a++);var J=_-a;for(E=1;E<=J&&c[_-E]===N[O-E];E++);return il=N.slice(a,1<E?1-E:void 0)}function Ts(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function Ga(){return!0}function na(){return!1}function Ei(a){function c(_,E,N,O,J){this._reactName=_,this._targetInst=N,this.type=E,this.nativeEvent=O,this.target=J,this.currentTarget=null;for(var xe in a)a.hasOwnProperty(xe)&&(_=a[xe],this[xe]=_?_(O):O[xe]);return this.isDefaultPrevented=(O.defaultPrevented!=null?O.defaultPrevented:O.returnValue===!1)?Ga:na,this.isPropagationStopped=na,this}return Je(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var _=this.nativeEvent;_&&(_.preventDefault?_.preventDefault():typeof _.returnValue!="unknown"&&(_.returnValue=!1),this.isDefaultPrevented=Ga)},stopPropagation:function(){var _=this.nativeEvent;_&&(_.stopPropagation?_.stopPropagation():typeof _.cancelBubble!="unknown"&&(_.cancelBubble=!0),this.isPropagationStopped=Ga)},persist:function(){},isPersistent:Ga}),c}var Fs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bo=Ei(Fs),sl=Je({},Fs,{view:0,detail:0}),Xc=Ei(sl),Ql,ec,ia,Ur=Je({},sl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:rc,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==ia&&(ia&&a.type==="mousemove"?(Ql=a.screenX-ia.screenX,ec=a.screenY-ia.screenY):ec=Ql=0,ia=a),Ql)},movementY:function(a){return"movementY"in a?a.movementY:ec}}),id=Ei(Ur),Xu=Je({},Ur,{dataTransfer:0}),sd=Ei(Xu),Ku=Je({},sl,{relatedTarget:0}),Kc=Ei(Ku),Yu=Je({},Fs,{animationName:0,elapsedTime:0,pseudoElement:0}),al=Ei(Yu),Yc=Je({},Fs,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),ol=Ei(Yc),ba=Je({},Fs,{data:0}),Wa=Ei(ba),Jc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ad={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ju(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=tc[a])?!!c[a]:!1}function rc(){return Ju}var Qc=Je({},sl,{key:function(a){if(a.key){var c=Jc[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=Ts(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?ad[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:rc,charCode:function(a){return a.type==="keypress"?Ts(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Ts(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),eu=Ei(Qc),Qu=Je({},Ur,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fr=Ei(Qu),nc=Je({},sl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:rc}),od=Ei(nc),eh=Je({},Fs,{propertyName:0,elapsedTime:0,pseudoElement:0}),ld=Ei(eh),wo=Je({},Ur,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),th=Ei(wo),kp=[9,13,27,32],rh=B&&"CompositionEvent"in window,ic=null;B&&"documentMode"in document&&(ic=document.documentMode);var nh=B&&"TextEvent"in window&&!ic,tu=B&&(!rh||ic&&8<ic&&11>=ic),ru=" ",sc=!1;function ih(a,c){switch(a){case"keyup":return kp.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sh(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var ll=!1;function ac(a,c){switch(a){case"compositionend":return sh(c);case"keypress":return c.which!==32?null:(sc=!0,ru);case"textInput":return a=c.data,a===ru&&sc?null:a;default:return null}}function cl(a,c){if(ll)return a==="compositionend"||!rh&&ih(a,c)?(a=$a(),il=ws=as=null,ll=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return tu&&c.locale!=="ko"?null:c.data;default:return null}}var ah={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ul(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!ah[a.type]:c==="textarea"}function nu(a,c,_,E){we(E),c=qi(c,"onChange"),0<c.length&&(_=new bo("onChange","change",null,_,E),a.push({event:_,listeners:c}))}var Gi=null,qa=null;function oh(a){Co(a,0)}function To(a){var c=Po(a);if(Yt(c))return a}function cd(a,c){if(a==="change")return c}var iu=!1;if(B){var lh;if(B){var oc="oninput"in document;if(!oc){var lc=document.createElement("div");lc.setAttribute("oninput","return;"),oc=typeof lc.oninput=="function"}lh=oc}else lh=!1;iu=lh&&(!document.documentMode||9<document.documentMode)}function hl(){Gi&&(Gi.detachEvent("onpropertychange",ch),qa=Gi=null)}function ch(a){if(a.propertyName==="value"&&To(qa)){var c=[];nu(c,qa,a,Yo(a)),He(oh,c)}}function uh(a,c,_){a==="focusin"?(hl(),Gi=c,qa=_,Gi.attachEvent("onpropertychange",ch)):a==="focusout"&&hl()}function Sp(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return To(qa)}function hh(a,c){if(a==="click")return To(c)}function ud(a,c){if(a==="input"||a==="change")return To(c)}function cc(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var ks=typeof Object.is=="function"?Object.is:cc;function Za(a,c){if(ks(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var _=Object.keys(a),E=Object.keys(c);if(_.length!==E.length)return!1;for(E=0;E<_.length;E++){var N=_[E];if(!i.call(c,N)||!ks(a[N],c[N]))return!1}return!0}function dh(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ko(a,c){var _=dh(a);a=0;for(var E;_;){if(_.nodeType===3){if(E=a+_.textContent.length,a<=c&&E>=c)return{node:_,offset:c-a};a=E}e:{for(;_;){if(_.nextSibling){_=_.nextSibling;break e}_=_.parentNode}_=void 0}_=dh(_)}}function hd(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?hd(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function dd(){for(var a=window,c=ei();c instanceof a.HTMLIFrameElement;){try{var _=typeof c.contentWindow.location.href=="string"}catch{_=!1}if(_)a=c.contentWindow;else break;c=ei(a.document)}return c}function ph(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}function Ep(a){var c=dd(),_=a.focusedElem,E=a.selectionRange;if(c!==_&&_&&_.ownerDocument&&hd(_.ownerDocument.documentElement,_)){if(E!==null&&ph(_)){if(c=E.start,a=E.end,a===void 0&&(a=c),"selectionStart"in _)_.selectionStart=c,_.selectionEnd=Math.min(a,_.value.length);else if(a=(c=_.ownerDocument||document)&&c.defaultView||window,a.getSelection){a=a.getSelection();var N=_.textContent.length,O=Math.min(E.start,N);E=E.end===void 0?O:Math.min(E.end,N),!a.extend&&O>E&&(N=E,E=O,O=N),N=ko(_,O);var J=ko(_,E);N&&J&&(a.rangeCount!==1||a.anchorNode!==N.node||a.anchorOffset!==N.offset||a.focusNode!==J.node||a.focusOffset!==J.offset)&&(c=c.createRange(),c.setStart(N.node,N.offset),a.removeAllRanges(),O>E?(a.addRange(c),a.extend(J.node,J.offset)):(c.setEnd(J.node,J.offset),a.addRange(c)))}}for(c=[],a=_;a=a.parentNode;)a.nodeType===1&&c.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof _.focus=="function"&&_.focus(),_=0;_<c.length;_++)a=c[_],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var Cp=B&&"documentMode"in document&&11>=document.documentMode,So=null,dl=null,sa=null,su=!1;function fh(a,c,_){var E=_.window===_?_.document:_.nodeType===9?_:_.ownerDocument;su||So==null||So!==ei(E)||(E=So,"selectionStart"in E&&ph(E)?E={start:E.selectionStart,end:E.selectionEnd}:(E=(E.ownerDocument&&E.ownerDocument.defaultView||window).getSelection(),E={anchorNode:E.anchorNode,anchorOffset:E.anchorOffset,focusNode:E.focusNode,focusOffset:E.focusOffset}),sa&&Za(sa,E)||(sa=E,E=qi(dl,"onSelect"),0<E.length&&(c=new bo("onSelect","select",null,c,_),a.push({event:c,listeners:E}),c.target=So)))}function Ss(a,c){var _={};return _[a.toLowerCase()]=c.toLowerCase(),_["Webkit"+a]="webkit"+c,_["Moz"+a]="moz"+c,_}var wa={animationend:Ss("Animation","AnimationEnd"),animationiteration:Ss("Animation","AnimationIteration"),animationstart:Ss("Animation","AnimationStart"),transitionend:Ss("Transition","TransitionEnd")},Wi={},pl={};B&&(pl=document.createElement("div").style,"AnimationEvent"in window||(delete wa.animationend.animation,delete wa.animationiteration.animation,delete wa.animationstart.animation),"TransitionEvent"in window||delete wa.transitionend.transition);function uc(a){if(Wi[a])return Wi[a];if(!wa[a])return a;var c=wa[a],_;for(_ in c)if(c.hasOwnProperty(_)&&_ in pl)return Wi[a]=c[_];return a}var Ha=uc("animationend"),Eo=uc("animationiteration"),hc=uc("animationstart"),dc=uc("transitionend"),Vr=new Map,fl="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ta(a,c){Vr.set(a,c),A(c,[a])}for(var ml=0;ml<fl.length;ml++){var Xa=fl[ml],pd=Xa.toLowerCase(),au=Xa[0].toUpperCase()+Xa.slice(1);Ta(pd,"on"+au)}Ta(Ha,"onAnimationEnd"),Ta(Eo,"onAnimationIteration"),Ta(hc,"onAnimationStart"),Ta("dblclick","onDoubleClick"),Ta("focusin","onFocus"),Ta("focusout","onBlur"),Ta(dc,"onTransitionEnd"),I("onMouseEnter",["mouseout","mouseover"]),I("onMouseLeave",["mouseout","mouseover"]),I("onPointerEnter",["pointerout","pointerover"]),I("onPointerLeave",["pointerout","pointerover"]),A("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),A("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),A("onBeforeInput",["compositionend","keypress","textInput","paste"]),A("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),A("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),A("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var os="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fd=new Set("cancel close invalid load scroll toggle".split(" ").concat(os));function pc(a,c,_){var E=a.type||"unknown-event";a.currentTarget=_,Si(E,c,void 0,a),a.currentTarget=null}function Co(a,c){c=(c&4)!==0;for(var _=0;_<a.length;_++){var E=a[_],N=E.event;E=E.listeners;e:{var O=void 0;if(c)for(var J=E.length-1;0<=J;J--){var xe=E[J],Pe=xe.instance,rt=xe.currentTarget;if(xe=xe.listener,Pe!==O&&N.isPropagationStopped())break e;pc(N,xe,rt),O=Pe}else for(J=0;J<E.length;J++){if(xe=E[J],Pe=xe.instance,rt=xe.currentTarget,xe=xe.listener,Pe!==O&&N.isPropagationStopped())break e;pc(N,xe,rt),O=Pe}}}if(vr)throw a=Nr,vr=!1,Nr=null,a}function an(a,c){var _=c[cu];_===void 0&&(_=c[cu]=new Set);var E=a+"__bubble";_.has(E)||(mc(c,a,2,!1),_.add(E))}function fc(a,c,_){var E=0;c&&(E|=4),mc(_,a,E,c)}var Ka="_reactListening"+Math.random().toString(36).slice(2);function ka(a){if(!a[Ka]){a[Ka]=!0,w.forEach(function(_){_!=="selectionchange"&&(fd.has(_)||fc(_,!1,a),fc(_,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[Ka]||(c[Ka]=!0,fc("selectionchange",!1,c))}}function mc(a,c,_,E){switch(Hc(c)){case 1:var N=Zu;break;case 4:N=va;break;default:N=ra}_=N.bind(null,c,_,a),N=void 0,!It||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(N=!0),E?N!==void 0?a.addEventListener(c,_,{capture:!0,passive:N}):a.addEventListener(c,_,!0):N!==void 0?a.addEventListener(c,_,{passive:N}):a.addEventListener(c,_,!1)}function gl(a,c,_,E,N){var O=E;if((c&1)===0&&(c&2)===0&&E!==null)e:for(;;){if(E===null)return;var J=E.tag;if(J===3||J===4){var xe=E.stateNode.containerInfo;if(xe===N||xe.nodeType===8&&xe.parentNode===N)break;if(J===4)for(J=E.return;J!==null;){var Pe=J.tag;if((Pe===3||Pe===4)&&(Pe=J.stateNode.containerInfo,Pe===N||Pe.nodeType===8&&Pe.parentNode===N))return;J=J.return}for(;xe!==null;){if(J=Hi(xe),J===null)return;if(Pe=J.tag,Pe===5||Pe===6){E=O=J;continue e}xe=xe.parentNode}}E=E.return}He(function(){var rt=O,At=Yo(_),jt=[];e:{var Et=Vr.get(a);if(Et!==void 0){var Xt=bo,nr=a;switch(a){case"keypress":if(Ts(_)===0)break e;case"keydown":case"keyup":Xt=eu;break;case"focusin":nr="focus",Xt=Kc;break;case"focusout":nr="blur",Xt=Kc;break;case"beforeblur":case"afterblur":Xt=Kc;break;case"click":if(_.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Xt=id;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Xt=sd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Xt=od;break;case Ha:case Eo:case hc:Xt=al;break;case dc:Xt=ld;break;case"scroll":Xt=Xc;break;case"wheel":Xt=th;break;case"copy":case"cut":case"paste":Xt=ol;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Xt=Fr}var sr=(c&4)!==0,Jn=!sr&&a==="scroll",Ze=sr?Et!==null?Et+"Capture":null:Et;sr=[];for(var Ne=rt,Ke;Ne!==null;){Ke=Ne;var zt=Ke.stateNode;if(Ke.tag===5&&zt!==null&&(Ke=zt,Ze!==null&&(zt=kt(Ne,Ze),zt!=null&&sr.push(Dt(Ne,zt,Ke)))),Jn)break;Ne=Ne.return}0<sr.length&&(Et=new Xt(Et,nr,null,_,At),jt.push({event:Et,listeners:sr}))}}if((c&7)===0){e:{if(Et=a==="mouseover"||a==="pointerover",Xt=a==="mouseout"||a==="pointerout",Et&&_!==Oa&&(nr=_.relatedTarget||_.fromElement)&&(Hi(nr)||nr[Os]))break e;if((Xt||Et)&&(Et=At.window===At?At:(Et=At.ownerDocument)?Et.defaultView||Et.parentWindow:window,Xt?(nr=_.relatedTarget||_.toElement,Xt=rt,nr=nr?Hi(nr):null,nr!==null&&(Jn=_n(nr),nr!==Jn||nr.tag!==5&&nr.tag!==6)&&(nr=null)):(Xt=null,nr=rt),Xt!==nr)){if(sr=id,zt="onMouseLeave",Ze="onMouseEnter",Ne="mouse",(a==="pointerout"||a==="pointerover")&&(sr=Fr,zt="onPointerLeave",Ze="onPointerEnter",Ne="pointer"),Jn=Xt==null?Et:Po(Xt),Ke=nr==null?Et:Po(nr),Et=new sr(zt,Ne+"leave",Xt,_,At),Et.target=Jn,Et.relatedTarget=Ke,zt=null,Hi(At)===rt&&(sr=new sr(Ze,Ne+"enter",nr,_,At),sr.target=Ke,sr.relatedTarget=Jn,zt=sr),Jn=zt,Xt&&nr)t:{for(sr=Xt,Ze=nr,Ne=0,Ke=sr;Ke;Ke=Mo(Ke))Ne++;for(Ke=0,zt=Ze;zt;zt=Mo(zt))Ke++;for(;0<Ne-Ke;)sr=Mo(sr),Ne--;for(;0<Ke-Ne;)Ze=Mo(Ze),Ke--;for(;Ne--;){if(sr===Ze||Ze!==null&&sr===Ze.alternate)break t;sr=Mo(sr),Ze=Mo(Ze)}sr=null}else sr=null;Xt!==null&&yl(jt,Et,Xt,sr,!1),nr!==null&&Jn!==null&&yl(jt,Jn,nr,sr,!0)}}e:{if(Et=rt?Po(rt):window,Xt=Et.nodeName&&Et.nodeName.toLowerCase(),Xt==="select"||Xt==="input"&&Et.type==="file")var ar=cd;else if(ul(Et))if(iu)ar=ud;else{ar=Sp;var fr=uh}else(Xt=Et.nodeName)&&Xt.toLowerCase()==="input"&&(Et.type==="checkbox"||Et.type==="radio")&&(ar=hh);if(ar&&(ar=ar(a,rt))){nu(jt,ar,_,At);break e}fr&&fr(a,Et,rt),a==="focusout"&&(fr=Et._wrapperState)&&fr.controlled&&Et.type==="number"&&ts(Et,"number",Et.value)}switch(fr=rt?Po(rt):window,a){case"focusin":(ul(fr)||fr.contentEditable==="true")&&(So=fr,dl=rt,sa=null);break;case"focusout":sa=dl=So=null;break;case"mousedown":su=!0;break;case"contextmenu":case"mouseup":case"dragend":su=!1,fh(jt,_,At);break;case"selectionchange":if(Cp)break;case"keydown":case"keyup":fh(jt,_,At)}var mr;if(rh)e:{switch(a){case"compositionstart":var Ir="onCompositionStart";break e;case"compositionend":Ir="onCompositionEnd";break e;case"compositionupdate":Ir="onCompositionUpdate";break e}Ir=void 0}else ll?ih(a,_)&&(Ir="onCompositionEnd"):a==="keydown"&&_.keyCode===229&&(Ir="onCompositionStart");Ir&&(tu&&_.locale!=="ko"&&(ll||Ir!=="onCompositionStart"?Ir==="onCompositionEnd"&&ll&&(mr=$a()):(as=At,ws="value"in as?as.value:as.textContent,ll=!0)),fr=qi(rt,Ir),0<fr.length&&(Ir=new Wa(Ir,a,null,_,At),jt.push({event:Ir,listeners:fr}),mr?Ir.data=mr:(mr=sh(_),mr!==null&&(Ir.data=mr)))),(mr=nh?ac(a,_):cl(a,_))&&(rt=qi(rt,"onBeforeInput"),0<rt.length&&(At=new Wa("onBeforeInput","beforeinput",null,_,At),jt.push({event:At,listeners:rt}),At.data=mr))}Co(jt,c)})}function Dt(a,c,_){return{instance:a,listener:c,currentTarget:_}}function qi(a,c){for(var _=c+"Capture",E=[];a!==null;){var N=a,O=N.stateNode;N.tag===5&&O!==null&&(N=O,O=kt(a,_),O!=null&&E.unshift(Dt(a,O,N)),O=kt(a,c),O!=null&&E.push(Dt(a,O,N))),a=a.return}return E}function Mo(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function yl(a,c,_,E,N){for(var O=c._reactName,J=[];_!==null&&_!==E;){var xe=_,Pe=xe.alternate,rt=xe.stateNode;if(Pe!==null&&Pe===E)break;xe.tag===5&&rt!==null&&(xe=rt,N?(Pe=kt(_,O),Pe!=null&&J.unshift(Dt(_,Pe,xe))):N||(Pe=kt(_,O),Pe!=null&&J.push(Dt(_,Pe,xe)))),_=_.return}J.length!==0&&a.push({event:c,listeners:J})}var gc=/\r\n?/g,fi=/\u0000|\uFFFD/g;function xl(a){return(typeof a=="string"?a:""+a).replace(gc,`
`).replace(fi,"")}function Ao(a,c,_){if(c=xl(c),xl(a)!==c&&_)throw Error(y(425))}function _l(){}var vl=null,ou=null;function bl(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var Ya=typeof setTimeout=="function"?setTimeout:void 0,mh=typeof clearTimeout=="function"?clearTimeout:void 0,md=typeof Promise=="function"?Promise:void 0,gd=typeof queueMicrotask=="function"?queueMicrotask:typeof md<"u"?function(a){return md.resolve(null).then(a).catch(wl)}:Ya;function wl(a){setTimeout(function(){throw a})}function yc(a,c){var _=c,E=0;do{var N=_.nextSibling;if(a.removeChild(_),N&&N.nodeType===8)if(_=N.data,_==="/$"){if(E===0){a.removeChild(N),Bs(c);return}E--}else _!=="$"&&_!=="$?"&&_!=="$!"||E++;_=N}while(_);Bs(c)}function aa(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?")break;if(c==="/$")return null}}return a}function lu(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var _=a.data;if(_==="$"||_==="$!"||_==="$?"){if(c===0)return a;c--}else _==="/$"&&c++}a=a.previousSibling}return null}var Sa=Math.random().toString(36).slice(2),Zi="__reactFiber$"+Sa,Ea="__reactProps$"+Sa,Os="__reactContainer$"+Sa,cu="__reactEvents$"+Sa,gh="__reactListeners$"+Sa,yd="__reactHandles$"+Sa;function Hi(a){var c=a[Zi];if(c)return c;for(var _=a.parentNode;_;){if(c=_[Os]||_[Zi]){if(_=c.alternate,c.child!==null||_!==null&&_.child!==null)for(a=lu(a);a!==null;){if(_=a[Zi])return _;a=lu(a)}return c}a=_,_=a.parentNode}return null}function Tl(a){return a=a[Zi]||a[Os],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function Po(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(y(33))}function uu(a){return a[Ea]||null}var hu=[],Ja=-1;function Ca(a){return{current:a}}function vn(a){0>Ja||(a.current=hu[Ja],hu[Ja]=null,Ja--)}function Rr(a,c){Ja++,hu[Ja]=a.current,a.current=c}var Qa={},bi=Ca(Qa),Xi=Ca(!1),Io=Qa;function wi(a,c){var _=a.type.contextTypes;if(!_)return Qa;var E=a.stateNode;if(E&&E.__reactInternalMemoizedUnmaskedChildContext===c)return E.__reactInternalMemoizedMaskedChildContext;var N={},O;for(O in _)N[O]=c[O];return E&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=c,a.__reactInternalMemoizedMaskedChildContext=N),N}function Li(a){return a=a.childContextTypes,a!=null}function du(){vn(Xi),vn(bi)}function Es(a,c,_){if(bi.current!==Qa)throw Error(y(168));Rr(bi,c),Rr(Xi,_)}function Us(a,c,_){var E=a.stateNode;if(c=c.childContextTypes,typeof E.getChildContext!="function")return _;E=E.getChildContext();for(var N in E)if(!(N in c))throw Error(y(108,zr(a)||"Unknown",N));return Je({},_,E)}function oa(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Qa,Io=bi.current,Rr(bi,a),Rr(Xi,Xi.current),!0}function xc(a,c,_){var E=a.stateNode;if(!E)throw Error(y(169));_?(a=Us(a,c,Io),E.__reactInternalMemoizedMergedChildContext=a,vn(Xi),vn(bi),Rr(bi,a)):vn(Xi),Rr(Xi,_)}var Rt=null,kl=!1,_c=!1;function jo(a){Rt===null?Rt=[a]:Rt.push(a)}function No(a){kl=!0,jo(a)}function Nt(){if(!_c&&Rt!==null){_c=!0;var a=0,c=Hr;try{var _=Rt;for(Hr=1;a<_.length;a++){var E=_[a];do E=E(!0);while(E!==null)}Rt=null,kl=!1}catch(N){throw Rt!==null&&(Rt=Rt.slice(a+1)),Vu(ys,Nt),N}finally{Hr=c,_c=!1}}return null}var eo=[],Sl=0,vc=null,El=0,ls=[],cs=0,Do=null,Ma=1,Vs="";function Aa(a,c){eo[Sl++]=El,eo[Sl++]=vc,vc=a,El=c}function pu(a,c,_){ls[cs++]=Ma,ls[cs++]=Vs,ls[cs++]=Do,Do=a;var E=Ma;a=Vs;var N=32-ni(E)-1;E&=~(1<<N),_+=1;var O=32-ni(c)+N;if(30<O){var J=N-N%5;O=(E&(1<<J)-1).toString(32),E>>=J,N-=J,Ma=1<<32-ni(c)+N|_<<N|E,Vs=O+a}else Ma=1<<O|_<<N|E,Vs=a}function to(a){a.return!==null&&(Aa(a,1),pu(a,1,0))}function d(a){for(;a===vc;)vc=eo[--Sl],eo[Sl]=null,El=eo[--Sl],eo[Sl]=null;for(;a===Do;)Do=ls[--cs],ls[cs]=null,Vs=ls[--cs],ls[cs]=null,Ma=ls[--cs],ls[cs]=null}var n=null,o=null,f=!1,x=null;function b(a,c){var _=Ai(5,null,null,0);_.elementType="DELETED",_.stateNode=c,_.return=a,c=a.deletions,c===null?(a.deletions=[_],a.flags|=16):c.push(_)}function C(a,c){switch(a.tag){case 5:var _=a.type;return c=c.nodeType!==1||_.toLowerCase()!==c.nodeName.toLowerCase()?null:c,c!==null?(a.stateNode=c,n=a,o=aa(c.firstChild),!0):!1;case 6:return c=a.pendingProps===""||c.nodeType!==3?null:c,c!==null?(a.stateNode=c,n=a,o=null,!0):!1;case 13:return c=c.nodeType!==8?null:c,c!==null?(_=Do!==null?{id:Ma,overflow:Vs}:null,a.memoizedState={dehydrated:c,treeContext:_,retryLane:1073741824},_=Ai(18,null,null,0),_.stateNode=c,_.return=a,a.child=_,n=a,o=null,!0):!1;default:return!1}}function M(a){return(a.mode&1)!==0&&(a.flags&128)===0}function j(a){if(f){var c=o;if(c){var _=c;if(!C(a,c)){if(M(a))throw Error(y(418));c=aa(_.nextSibling);var E=n;c&&C(a,c)?b(E,_):(a.flags=a.flags&-4097|2,f=!1,n=a)}}else{if(M(a))throw Error(y(418));a.flags=a.flags&-4097|2,f=!1,n=a}}}function F(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;n=a}function z(a){if(a!==n)return!1;if(!f)return F(a),f=!0,!1;var c;if((c=a.tag!==3)&&!(c=a.tag!==5)&&(c=a.type,c=c!=="head"&&c!=="body"&&!bl(a.type,a.memoizedProps)),c&&(c=o)){if(M(a))throw G(),Error(y(418));for(;c;)b(a,c),c=aa(c.nextSibling)}if(F(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(y(317));e:{for(a=a.nextSibling,c=0;a;){if(a.nodeType===8){var _=a.data;if(_==="/$"){if(c===0){o=aa(a.nextSibling);break e}c--}else _!=="$"&&_!=="$!"&&_!=="$?"||c++}a=a.nextSibling}o=null}}else o=n?aa(a.stateNode.nextSibling):null;return!0}function G(){for(var a=o;a;)a=aa(a.nextSibling)}function Q(){o=n=null,f=!1}function re(a){x===null?x=[a]:x.push(a)}var ie=dt.ReactCurrentBatchConfig;function ne(a,c,_){if(a=_.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(_._owner){if(_=_._owner,_){if(_.tag!==1)throw Error(y(309));var E=_.stateNode}if(!E)throw Error(y(147,a));var N=E,O=""+a;return c!==null&&c.ref!==null&&typeof c.ref=="function"&&c.ref._stringRef===O?c.ref:(c=function(J){var xe=N.refs;J===null?delete xe[O]:xe[O]=J},c._stringRef=O,c)}if(typeof a!="string")throw Error(y(284));if(!_._owner)throw Error(y(290,a))}return a}function se(a,c){throw a=Object.prototype.toString.call(c),Error(y(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a))}function W(a){var c=a._init;return c(a._payload)}function te(a){function c(Ze,Ne){if(a){var Ke=Ze.deletions;Ke===null?(Ze.deletions=[Ne],Ze.flags|=16):Ke.push(Ne)}}function _(Ze,Ne){if(!a)return null;for(;Ne!==null;)c(Ze,Ne),Ne=Ne.sibling;return null}function E(Ze,Ne){for(Ze=new Map;Ne!==null;)Ne.key!==null?Ze.set(Ne.key,Ne):Ze.set(Ne.index,Ne),Ne=Ne.sibling;return Ze}function N(Ze,Ne){return Ze=zl(Ze,Ne),Ze.index=0,Ze.sibling=null,Ze}function O(Ze,Ne,Ke){return Ze.index=Ke,a?(Ke=Ze.alternate,Ke!==null?(Ke=Ke.index,Ke<Ne?(Ze.flags|=2,Ne):Ke):(Ze.flags|=2,Ne)):(Ze.flags|=1048576,Ne)}function J(Ze){return a&&Ze.alternate===null&&(Ze.flags|=2),Ze}function xe(Ze,Ne,Ke,zt){return Ne===null||Ne.tag!==6?(Ne=Yp(Ke,Ze.mode,zt),Ne.return=Ze,Ne):(Ne=N(Ne,Ke),Ne.return=Ze,Ne)}function Pe(Ze,Ne,Ke,zt){var ar=Ke.type;return ar===$e?At(Ze,Ne,Ke.props.children,zt,Ke.key):Ne!==null&&(Ne.elementType===ar||typeof ar=="object"&&ar!==null&&ar.$$typeof===Jt&&W(ar)===Ne.type)?(zt=N(Ne,Ke.props),zt.ref=ne(Ze,Ne,Ke),zt.return=Ze,zt):(zt=Fd(Ke.type,Ke.key,Ke.props,null,Ze.mode,zt),zt.ref=ne(Ze,Ne,Ke),zt.return=Ze,zt)}function rt(Ze,Ne,Ke,zt){return Ne===null||Ne.tag!==4||Ne.stateNode.containerInfo!==Ke.containerInfo||Ne.stateNode.implementation!==Ke.implementation?(Ne=Jp(Ke,Ze.mode,zt),Ne.return=Ze,Ne):(Ne=N(Ne,Ke.children||[]),Ne.return=Ze,Ne)}function At(Ze,Ne,Ke,zt,ar){return Ne===null||Ne.tag!==7?(Ne=Nc(Ke,Ze.mode,zt,ar),Ne.return=Ze,Ne):(Ne=N(Ne,Ke),Ne.return=Ze,Ne)}function jt(Ze,Ne,Ke){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number")return Ne=Yp(""+Ne,Ze.mode,Ke),Ne.return=Ze,Ne;if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case St:return Ke=Fd(Ne.type,Ne.key,Ne.props,null,Ze.mode,Ke),Ke.ref=ne(Ze,null,Ne),Ke.return=Ze,Ke;case ce:return Ne=Jp(Ne,Ze.mode,Ke),Ne.return=Ze,Ne;case Jt:var zt=Ne._init;return jt(Ze,zt(Ne._payload),Ke)}if(ti(Ne)||Be(Ne))return Ne=Nc(Ne,Ze.mode,Ke,null),Ne.return=Ze,Ne;se(Ze,Ne)}return null}function Et(Ze,Ne,Ke,zt){var ar=Ne!==null?Ne.key:null;if(typeof Ke=="string"&&Ke!==""||typeof Ke=="number")return ar!==null?null:xe(Ze,Ne,""+Ke,zt);if(typeof Ke=="object"&&Ke!==null){switch(Ke.$$typeof){case St:return Ke.key===ar?Pe(Ze,Ne,Ke,zt):null;case ce:return Ke.key===ar?rt(Ze,Ne,Ke,zt):null;case Jt:return ar=Ke._init,Et(Ze,Ne,ar(Ke._payload),zt)}if(ti(Ke)||Be(Ke))return ar!==null?null:At(Ze,Ne,Ke,zt,null);se(Ze,Ke)}return null}function Xt(Ze,Ne,Ke,zt,ar){if(typeof zt=="string"&&zt!==""||typeof zt=="number")return Ze=Ze.get(Ke)||null,xe(Ne,Ze,""+zt,ar);if(typeof zt=="object"&&zt!==null){switch(zt.$$typeof){case St:return Ze=Ze.get(zt.key===null?Ke:zt.key)||null,Pe(Ne,Ze,zt,ar);case ce:return Ze=Ze.get(zt.key===null?Ke:zt.key)||null,rt(Ne,Ze,zt,ar);case Jt:var fr=zt._init;return Xt(Ze,Ne,Ke,fr(zt._payload),ar)}if(ti(zt)||Be(zt))return Ze=Ze.get(Ke)||null,At(Ne,Ze,zt,ar,null);se(Ne,zt)}return null}function nr(Ze,Ne,Ke,zt){for(var ar=null,fr=null,mr=Ne,Ir=Ne=0,Pi=null;mr!==null&&Ir<Ke.length;Ir++){mr.index>Ir?(Pi=mr,mr=null):Pi=mr.sibling;var Jr=Et(Ze,mr,Ke[Ir],zt);if(Jr===null){mr===null&&(mr=Pi);break}a&&mr&&Jr.alternate===null&&c(Ze,mr),Ne=O(Jr,Ne,Ir),fr===null?ar=Jr:fr.sibling=Jr,fr=Jr,mr=Pi}if(Ir===Ke.length)return _(Ze,mr),f&&Aa(Ze,Ir),ar;if(mr===null){for(;Ir<Ke.length;Ir++)mr=jt(Ze,Ke[Ir],zt),mr!==null&&(Ne=O(mr,Ne,Ir),fr===null?ar=mr:fr.sibling=mr,fr=mr);return f&&Aa(Ze,Ir),ar}for(mr=E(Ze,mr);Ir<Ke.length;Ir++)Pi=Xt(mr,Ze,Ir,Ke[Ir],zt),Pi!==null&&(a&&Pi.alternate!==null&&mr.delete(Pi.key===null?Ir:Pi.key),Ne=O(Pi,Ne,Ir),fr===null?ar=Pi:fr.sibling=Pi,fr=Pi);return a&&mr.forEach(function(da){return c(Ze,da)}),f&&Aa(Ze,Ir),ar}function sr(Ze,Ne,Ke,zt){var ar=Be(Ke);if(typeof ar!="function")throw Error(y(150));if(Ke=ar.call(Ke),Ke==null)throw Error(y(151));for(var fr=ar=null,mr=Ne,Ir=Ne=0,Pi=null,Jr=Ke.next();mr!==null&&!Jr.done;Ir++,Jr=Ke.next()){mr.index>Ir?(Pi=mr,mr=null):Pi=mr.sibling;var da=Et(Ze,mr,Jr.value,zt);if(da===null){mr===null&&(mr=Pi);break}a&&mr&&da.alternate===null&&c(Ze,mr),Ne=O(da,Ne,Ir),fr===null?ar=da:fr.sibling=da,fr=da,mr=Pi}if(Jr.done)return _(Ze,mr),f&&Aa(Ze,Ir),ar;if(mr===null){for(;!Jr.done;Ir++,Jr=Ke.next())Jr=jt(Ze,Jr.value,zt),Jr!==null&&(Ne=O(Jr,Ne,Ir),fr===null?ar=Jr:fr.sibling=Jr,fr=Jr);return f&&Aa(Ze,Ir),ar}for(mr=E(Ze,mr);!Jr.done;Ir++,Jr=Ke.next())Jr=Xt(mr,Ze,Ir,Jr.value,zt),Jr!==null&&(a&&Jr.alternate!==null&&mr.delete(Jr.key===null?Ir:Jr.key),Ne=O(Jr,Ne,Ir),fr===null?ar=Jr:fr.sibling=Jr,fr=Jr);return a&&mr.forEach(function(mm){return c(Ze,mm)}),f&&Aa(Ze,Ir),ar}function Jn(Ze,Ne,Ke,zt){if(typeof Ke=="object"&&Ke!==null&&Ke.type===$e&&Ke.key===null&&(Ke=Ke.props.children),typeof Ke=="object"&&Ke!==null){switch(Ke.$$typeof){case St:e:{for(var ar=Ke.key,fr=Ne;fr!==null;){if(fr.key===ar){if(ar=Ke.type,ar===$e){if(fr.tag===7){_(Ze,fr.sibling),Ne=N(fr,Ke.props.children),Ne.return=Ze,Ze=Ne;break e}}else if(fr.elementType===ar||typeof ar=="object"&&ar!==null&&ar.$$typeof===Jt&&W(ar)===fr.type){_(Ze,fr.sibling),Ne=N(fr,Ke.props),Ne.ref=ne(Ze,fr,Ke),Ne.return=Ze,Ze=Ne;break e}_(Ze,fr);break}else c(Ze,fr);fr=fr.sibling}Ke.type===$e?(Ne=Nc(Ke.props.children,Ze.mode,zt,Ke.key),Ne.return=Ze,Ze=Ne):(zt=Fd(Ke.type,Ke.key,Ke.props,null,Ze.mode,zt),zt.ref=ne(Ze,Ne,Ke),zt.return=Ze,Ze=zt)}return J(Ze);case ce:e:{for(fr=Ke.key;Ne!==null;){if(Ne.key===fr)if(Ne.tag===4&&Ne.stateNode.containerInfo===Ke.containerInfo&&Ne.stateNode.implementation===Ke.implementation){_(Ze,Ne.sibling),Ne=N(Ne,Ke.children||[]),Ne.return=Ze,Ze=Ne;break e}else{_(Ze,Ne);break}else c(Ze,Ne);Ne=Ne.sibling}Ne=Jp(Ke,Ze.mode,zt),Ne.return=Ze,Ze=Ne}return J(Ze);case Jt:return fr=Ke._init,Jn(Ze,Ne,fr(Ke._payload),zt)}if(ti(Ke))return nr(Ze,Ne,Ke,zt);if(Be(Ke))return sr(Ze,Ne,Ke,zt);se(Ze,Ke)}return typeof Ke=="string"&&Ke!==""||typeof Ke=="number"?(Ke=""+Ke,Ne!==null&&Ne.tag===6?(_(Ze,Ne.sibling),Ne=N(Ne,Ke),Ne.return=Ze,Ze=Ne):(_(Ze,Ne),Ne=Yp(Ke,Ze.mode,zt),Ne.return=Ze,Ze=Ne),J(Ze)):_(Ze,Ne)}return Jn}var le=te(!0),ue=te(!1),ke=Ca(null),Ee=null,Se=null,je=null;function Ie(){je=Se=Ee=null}function Ve(a){var c=ke.current;vn(ke),a._currentValue=c}function yt(a,c,_){for(;a!==null;){var E=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,E!==null&&(E.childLanes|=c)):E!==null&&(E.childLanes&c)!==c&&(E.childLanes|=c),a===_)break;a=a.return}}function ze(a,c){Ee=a,je=Se=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&c)!==0&&(Ci=!0),a.firstContext=null)}function nt(a){var c=a._currentValue;if(je!==a)if(a={context:a,memoizedValue:c,next:null},Se===null){if(Ee===null)throw Error(y(308));Se=a,Ee.dependencies={lanes:0,firstContext:a}}else Se=Se.next=a;return c}var We=null;function mt(a){We===null?We=[a]:We.push(a)}function Ue(a,c,_,E){var N=c.interleaved;return N===null?(_.next=_,mt(c)):(_.next=N.next,N.next=_),c.interleaved=_,it(a,E)}function it(a,c){a.lanes|=c;var _=a.alternate;for(_!==null&&(_.lanes|=c),_=a,a=a.return;a!==null;)a.childLanes|=c,_=a.alternate,_!==null&&(_.childLanes|=c),_=a,a=a.return;return _.tag===3?_.stateNode:null}var ft=!1;function pt(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vt(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function Wt(a,c){return{eventTime:a,lane:c,tag:0,payload:null,callback:null,next:null}}function or(a,c,_){var E=a.updateQueue;if(E===null)return null;if(E=E.shared,(rr&2)!==0){var N=E.pending;return N===null?c.next=c:(c.next=N.next,N.next=c),E.pending=c,it(a,_)}return N=E.interleaved,N===null?(c.next=c,mt(E)):(c.next=N.next,N.next=c),E.interleaved=c,it(a,_)}function Vt(a,c,_){if(c=c.updateQueue,c!==null&&(c=c.shared,(_&4194240)!==0)){var E=c.lanes;E&=a.pendingLanes,_|=E,c.lanes=_,xo(a,_)}}function tr(a,c){var _=a.updateQueue,E=a.alternate;if(E!==null&&(E=E.updateQueue,_===E)){var N=null,O=null;if(_=_.firstBaseUpdate,_!==null){do{var J={eventTime:_.eventTime,lane:_.lane,tag:_.tag,payload:_.payload,callback:_.callback,next:null};O===null?N=O=J:O=O.next=J,_=_.next}while(_!==null);O===null?N=O=c:O=O.next=c}else N=O=c;_={baseState:E.baseState,firstBaseUpdate:N,lastBaseUpdate:O,shared:E.shared,effects:E.effects},a.updateQueue=_;return}a=_.lastBaseUpdate,a===null?_.firstBaseUpdate=c:a.next=c,_.lastBaseUpdate=c}function Sr(a,c,_,E){var N=a.updateQueue;ft=!1;var O=N.firstBaseUpdate,J=N.lastBaseUpdate,xe=N.shared.pending;if(xe!==null){N.shared.pending=null;var Pe=xe,rt=Pe.next;Pe.next=null,J===null?O=rt:J.next=rt,J=Pe;var At=a.alternate;At!==null&&(At=At.updateQueue,xe=At.lastBaseUpdate,xe!==J&&(xe===null?At.firstBaseUpdate=rt:xe.next=rt,At.lastBaseUpdate=Pe))}if(O!==null){var jt=N.baseState;J=0,At=rt=Pe=null,xe=O;do{var Et=xe.lane,Xt=xe.eventTime;if((E&Et)===Et){At!==null&&(At=At.next={eventTime:Xt,lane:0,tag:xe.tag,payload:xe.payload,callback:xe.callback,next:null});e:{var nr=a,sr=xe;switch(Et=c,Xt=_,sr.tag){case 1:if(nr=sr.payload,typeof nr=="function"){jt=nr.call(Xt,jt,Et);break e}jt=nr;break e;case 3:nr.flags=nr.flags&-65537|128;case 0:if(nr=sr.payload,Et=typeof nr=="function"?nr.call(Xt,jt,Et):nr,Et==null)break e;jt=Je({},jt,Et);break e;case 2:ft=!0}}xe.callback!==null&&xe.lane!==0&&(a.flags|=64,Et=N.effects,Et===null?N.effects=[xe]:Et.push(xe))}else Xt={eventTime:Xt,lane:Et,tag:xe.tag,payload:xe.payload,callback:xe.callback,next:null},At===null?(rt=At=Xt,Pe=jt):At=At.next=Xt,J|=Et;if(xe=xe.next,xe===null){if(xe=N.shared.pending,xe===null)break;Et=xe,xe=Et.next,Et.next=null,N.lastBaseUpdate=Et,N.shared.pending=null}}while(!0);if(At===null&&(Pe=jt),N.baseState=Pe,N.firstBaseUpdate=rt,N.lastBaseUpdate=At,c=N.shared.interleaved,c!==null){N=c;do J|=N.lane,N=N.next;while(N!==c)}else O===null&&(N.shared.lanes=0);Fn|=J,a.lanes=J,a.memoizedState=jt}}function Pr(a,c,_){if(a=c.effects,c.effects=null,a!==null)for(c=0;c<a.length;c++){var E=a[c],N=E.callback;if(N!==null){if(E.callback=null,E=_,typeof N!="function")throw Error(y(191,N));N.call(E)}}}var Zt={},Dr=Ca(Zt),Xr=Ca(Zt),Kr=Ca(Zt);function qr(a){if(a===Zt)throw Error(y(174));return a}function mi(a,c){switch(Rr(Kr,c),Rr(Xr,a),Rr(Dr,Zt),a=c.nodeType,a){case 9:case 11:c=(c=c.documentElement)?c.namespaceURI:An(null,"");break;default:a=a===8?c.parentNode:c,c=a.namespaceURI||null,a=a.tagName,c=An(c,a)}vn(Dr),Rr(Dr,c)}function In(){vn(Dr),vn(Xr),vn(Kr)}function us(a){qr(Kr.current);var c=qr(Dr.current),_=An(c,a.type);c!==_&&(Rr(Xr,a),Rr(Dr,_))}function Cs(a){Xr.current===a&&(vn(Dr),vn(Xr))}var _r=Ca(0);function tn(a){for(var c=a;c!==null;){if(c.tag===13){var _=c.memoizedState;if(_!==null&&(_=_.dehydrated,_===null||_.data==="$?"||_.data==="$!"))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var $r=[];function jn(){for(var a=0;a<$r.length;a++)$r[a]._workInProgressVersionPrimary=null;$r.length=0}var gi=dt.ReactCurrentDispatcher,ln=dt.ReactCurrentBatchConfig,Hn=0,bn=null,kn=null,Bn=null,Ms=!1,As=!1,$s=0,fu=0;function Xn(){throw Error(y(321))}function bc(a,c){if(c===null)return!1;for(var _=0;_<c.length&&_<a.length;_++)if(!ks(a[_],c[_]))return!1;return!0}function xd(a,c,_,E,N,O){if(Hn=O,bn=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,gi.current=a===null||a.memoizedState===null?tm:rm,a=_(E,N),As){O=0;do{if(As=!1,$s=0,25<=O)throw Error(y(301));O+=1,Bn=kn=null,c.updateQueue=null,gi.current=Ia,a=_(E,N)}while(As)}if(gi.current=Ri,c=kn!==null&&kn.next!==null,Hn=0,Bn=kn=bn=null,Ms=!1,c)throw Error(y(300));return a}function _d(){var a=$s!==0;return $s=0,a}function ro(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bn===null?bn.memoizedState=Bn=a:Bn=Bn.next=a,Bn}function Ps(){if(kn===null){var a=bn.alternate;a=a!==null?a.memoizedState:null}else a=kn.next;var c=Bn===null?bn.memoizedState:Bn.next;if(c!==null)Bn=c,kn=a;else{if(a===null)throw Error(y(310));kn=a,a={memoizedState:kn.memoizedState,baseState:kn.baseState,baseQueue:kn.baseQueue,queue:kn.queue,next:null},Bn===null?bn.memoizedState=Bn=a:Bn=Bn.next=a}return Bn}function Cl(a,c){return typeof c=="function"?c(a):c}function vd(a){var c=Ps(),_=c.queue;if(_===null)throw Error(y(311));_.lastRenderedReducer=a;var E=kn,N=E.baseQueue,O=_.pending;if(O!==null){if(N!==null){var J=N.next;N.next=O.next,O.next=J}E.baseQueue=N=O,_.pending=null}if(N!==null){O=N.next,E=E.baseState;var xe=J=null,Pe=null,rt=O;do{var At=rt.lane;if((Hn&At)===At)Pe!==null&&(Pe=Pe.next={lane:0,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null}),E=rt.hasEagerState?rt.eagerState:a(E,rt.action);else{var jt={lane:At,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null};Pe===null?(xe=Pe=jt,J=E):Pe=Pe.next=jt,bn.lanes|=At,Fn|=At}rt=rt.next}while(rt!==null&&rt!==O);Pe===null?J=E:Pe.next=xe,ks(E,c.memoizedState)||(Ci=!0),c.memoizedState=E,c.baseState=J,c.baseQueue=Pe,_.lastRenderedState=E}if(a=_.interleaved,a!==null){N=a;do O=N.lane,bn.lanes|=O,Fn|=O,N=N.next;while(N!==a)}else N===null&&(_.lanes=0);return[c.memoizedState,_.dispatch]}function yh(a){var c=Ps(),_=c.queue;if(_===null)throw Error(y(311));_.lastRenderedReducer=a;var E=_.dispatch,N=_.pending,O=c.memoizedState;if(N!==null){_.pending=null;var J=N=N.next;do O=a(O,J.action),J=J.next;while(J!==N);ks(O,c.memoizedState)||(Ci=!0),c.memoizedState=O,c.baseQueue===null&&(c.baseState=O),_.lastRenderedState=O}return[O,E]}function xh(){}function no(a,c){var _=bn,E=Ps(),N=c(),O=!ks(E.memoizedState,N);if(O&&(E.memoizedState=N,Ci=!0),E=E.queue,io(Ap.bind(null,_,E,a),[a]),E.getSnapshot!==c||O||Bn!==null&&Bn.memoizedState.tag&1){if(_.flags|=2048,wc(9,Mp.bind(null,_,E,N,c),void 0,null),xi===null)throw Error(y(349));(Hn&30)!==0||_h(_,c,N)}return N}function _h(a,c,_){a.flags|=16384,a={getSnapshot:c,value:_},c=bn.updateQueue,c===null?(c={lastEffect:null,stores:null},bn.updateQueue=c,c.stores=[a]):(_=c.stores,_===null?c.stores=[a]:_.push(a))}function Mp(a,c,_,E){c.value=_,c.getSnapshot=E,Hf(c)&&Xf(a)}function Ap(a,c,_){return _(function(){Hf(c)&&Xf(a)})}function Hf(a){var c=a.getSnapshot;a=a.value;try{var _=c();return!ks(a,_)}catch{return!0}}function Xf(a){var c=it(a,1);c!==null&&La(c,a,1,-1)}function Kf(a){var c=ro();return typeof a=="function"&&(a=a()),c.memoizedState=c.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Cl,lastRenderedState:a},c.queue=a,a=a.dispatch=Wn.bind(null,bn,a),[c.memoizedState,a]}function wc(a,c,_,E){return a={tag:a,create:c,destroy:_,deps:E,next:null},c=bn.updateQueue,c===null?(c={lastEffect:null,stores:null},bn.updateQueue=c,c.lastEffect=a.next=a):(_=c.lastEffect,_===null?c.lastEffect=a.next=a:(E=_.next,_.next=a,a.next=E,c.lastEffect=a)),a}function mu(){return Ps().memoizedState}function Lo(a,c,_,E){var N=ro();bn.flags|=a,N.memoizedState=wc(1|c,_,void 0,E===void 0?null:E)}function la(a,c,_,E){var N=Ps();E=E===void 0?null:E;var O=void 0;if(kn!==null){var J=kn.memoizedState;if(O=J.destroy,E!==null&&bc(E,J.deps)){N.memoizedState=wc(c,_,O,E);return}}bn.flags|=a,N.memoizedState=wc(1|c,_,O,E)}function ca(a,c){return Lo(8390656,8,a,c)}function io(a,c){return la(2048,8,a,c)}function Ro(a,c){return la(4,2,a,c)}function Ml(a,c){return la(4,4,a,c)}function Yf(a,c){if(typeof c=="function")return a=a(),c(a),function(){c(null)};if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function Jf(a,c,_){return _=_!=null?_.concat([a]):null,la(4,4,Yf.bind(null,c,a),_)}function Pp(){}function Qf(a,c){var _=Ps();c=c===void 0?null:c;var E=_.memoizedState;return E!==null&&c!==null&&bc(c,E[1])?E[0]:(_.memoizedState=[a,c],a)}function Ip(a,c){var _=Ps();c=c===void 0?null:c;var E=_.memoizedState;return E!==null&&c!==null&&bc(c,E[1])?E[0]:(a=a(),_.memoizedState=[a,c],a)}function jp(a,c,_){return(Hn&21)===0?(a.baseState&&(a.baseState=!1,Ci=!0),a.memoizedState=_):(ks(_,c)||(_=$i(),bn.lanes|=_,Fn|=_,a.baseState=!0),c)}function Pa(a,c){var _=Hr;Hr=_!==0&&4>_?_:4,a(!0);var E=ln.transition;ln.transition={};try{a(!1),c()}finally{Hr=_,ln.transition=E}}function em(){return Ps().memoizedState}function dg(a,c,_){var E=uo(a);if(_={lane:E,action:_,hasEagerState:!1,eagerState:null,next:null},Qt(a))zo(c,_);else if(_=Ue(a,c,_,E),_!==null){var N=ps();La(_,a,E,N),vh(_,c,E)}}function Wn(a,c,_){var E=uo(a),N={lane:E,action:_,hasEagerState:!1,eagerState:null,next:null};if(Qt(a))zo(c,N);else{var O=a.alternate;if(a.lanes===0&&(O===null||O.lanes===0)&&(O=c.lastRenderedReducer,O!==null))try{var J=c.lastRenderedState,xe=O(J,_);if(N.hasEagerState=!0,N.eagerState=xe,ks(xe,J)){var Pe=c.interleaved;Pe===null?(N.next=N,mt(c)):(N.next=Pe.next,Pe.next=N),c.interleaved=N;return}}catch{}finally{}_=Ue(a,c,N,E),_!==null&&(N=ps(),La(_,a,E,N),vh(_,c,E))}}function Qt(a){var c=a.alternate;return a===bn||c!==null&&c===bn}function zo(a,c){As=Ms=!0;var _=a.pending;_===null?c.next=c:(c.next=_.next,_.next=c),a.pending=c}function vh(a,c,_){if((_&4194240)!==0){var E=c.lanes;E&=a.pendingLanes,_|=E,c.lanes=_,xo(a,_)}}var Ri={readContext:nt,useCallback:Xn,useContext:Xn,useEffect:Xn,useImperativeHandle:Xn,useInsertionEffect:Xn,useLayoutEffect:Xn,useMemo:Xn,useReducer:Xn,useRef:Xn,useState:Xn,useDebugValue:Xn,useDeferredValue:Xn,useTransition:Xn,useMutableSource:Xn,useSyncExternalStore:Xn,useId:Xn,unstable_isNewReconciler:!1},tm={readContext:nt,useCallback:function(a,c){return ro().memoizedState=[a,c===void 0?null:c],a},useContext:nt,useEffect:ca,useImperativeHandle:function(a,c,_){return _=_!=null?_.concat([a]):null,Lo(4194308,4,Yf.bind(null,c,a),_)},useLayoutEffect:function(a,c){return Lo(4194308,4,a,c)},useInsertionEffect:function(a,c){return Lo(4,2,a,c)},useMemo:function(a,c){var _=ro();return c=c===void 0?null:c,a=a(),_.memoizedState=[a,c],a},useReducer:function(a,c,_){var E=ro();return c=_!==void 0?_(c):c,E.memoizedState=E.baseState=c,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:c},E.queue=a,a=a.dispatch=dg.bind(null,bn,a),[E.memoizedState,a]},useRef:function(a){var c=ro();return a={current:a},c.memoizedState=a},useState:Kf,useDebugValue:Pp,useDeferredValue:function(a){return ro().memoizedState=a},useTransition:function(){var a=Kf(!1),c=a[0];return a=Pa.bind(null,a[1]),ro().memoizedState=a,[c,a]},useMutableSource:function(){},useSyncExternalStore:function(a,c,_){var E=bn,N=ro();if(f){if(_===void 0)throw Error(y(407));_=_()}else{if(_=c(),xi===null)throw Error(y(349));(Hn&30)!==0||_h(E,c,_)}N.memoizedState=_;var O={value:_,getSnapshot:c};return N.queue=O,ca(Ap.bind(null,E,O,a),[a]),E.flags|=2048,wc(9,Mp.bind(null,E,O,_,c),void 0,null),_},useId:function(){var a=ro(),c=xi.identifierPrefix;if(f){var _=Vs,E=Ma;_=(E&~(1<<32-ni(E)-1)).toString(32)+_,c=":"+c+"R"+_,_=$s++,0<_&&(c+="H"+_.toString(32)),c+=":"}else _=fu++,c=":"+c+"r"+_.toString(32)+":";return a.memoizedState=c},unstable_isNewReconciler:!1},rm={readContext:nt,useCallback:Qf,useContext:nt,useEffect:io,useImperativeHandle:Jf,useInsertionEffect:Ro,useLayoutEffect:Ml,useMemo:Ip,useReducer:vd,useRef:mu,useState:function(){return vd(Cl)},useDebugValue:Pp,useDeferredValue:function(a){var c=Ps();return jp(c,kn.memoizedState,a)},useTransition:function(){var a=vd(Cl)[0],c=Ps().memoizedState;return[a,c]},useMutableSource:xh,useSyncExternalStore:no,useId:em,unstable_isNewReconciler:!1},Ia={readContext:nt,useCallback:Qf,useContext:nt,useEffect:io,useImperativeHandle:Jf,useInsertionEffect:Ro,useLayoutEffect:Ml,useMemo:Ip,useReducer:yh,useRef:mu,useState:function(){return yh(Cl)},useDebugValue:Pp,useDeferredValue:function(a){var c=Ps();return kn===null?c.memoizedState=a:jp(c,kn.memoizedState,a)},useTransition:function(){var a=yh(Cl)[0],c=Ps().memoizedState;return[a,c]},useMutableSource:xh,useSyncExternalStore:no,useId:em,unstable_isNewReconciler:!1};function Gs(a,c){if(a&&a.defaultProps){c=Je({},c),a=a.defaultProps;for(var _ in a)c[_]===void 0&&(c[_]=a[_]);return c}return c}function Bo(a,c,_,E){c=a.memoizedState,_=_(E,c),_=_==null?c:Je({},c,_),a.memoizedState=_,a.lanes===0&&(a.updateQueue.baseState=_)}var Al={isMounted:function(a){return(a=a._reactInternals)?_n(a)===a:!1},enqueueSetState:function(a,c,_){a=a._reactInternals;var E=ps(),N=uo(a),O=Wt(E,N);O.payload=c,_!=null&&(O.callback=_),c=or(a,O,N),c!==null&&(La(c,a,N,E),Vt(c,a,N))},enqueueReplaceState:function(a,c,_){a=a._reactInternals;var E=ps(),N=uo(a),O=Wt(E,N);O.tag=1,O.payload=c,_!=null&&(O.callback=_),c=or(a,O,N),c!==null&&(La(c,a,N,E),Vt(c,a,N))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var _=ps(),E=uo(a),N=Wt(_,E);N.tag=2,c!=null&&(N.callback=c),c=or(a,N,E),c!==null&&(La(c,a,E,_),Vt(c,a,E))}};function Pl(a,c,_,E,N,O,J){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(E,O,J):c.prototype&&c.prototype.isPureReactComponent?!Za(_,E)||!Za(N,O):!0}function bd(a,c,_){var E=!1,N=Qa,O=c.contextType;return typeof O=="object"&&O!==null?O=nt(O):(N=Li(c)?Io:bi.current,E=c.contextTypes,O=(E=E!=null)?wi(a,N):Qa),c=new c(_,O),a.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=Al,a.stateNode=c,c._reactInternals=a,E&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=N,a.__reactInternalMemoizedMaskedChildContext=O),c}function bh(a,c,_,E){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(_,E),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(_,E),c.state!==a&&Al.enqueueReplaceState(c,c.state,null)}function wd(a,c,_,E){var N=a.stateNode;N.props=_,N.state=a.memoizedState,N.refs={},pt(a);var O=c.contextType;typeof O=="object"&&O!==null?N.context=nt(O):(O=Li(c)?Io:bi.current,N.context=wi(a,O)),N.state=a.memoizedState,O=c.getDerivedStateFromProps,typeof O=="function"&&(Bo(a,c,O,_),N.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof N.getSnapshotBeforeUpdate=="function"||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(c=N.state,typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount(),c!==N.state&&Al.enqueueReplaceState(N,N.state,null),Sr(a,_,N,E),N.state=a.memoizedState),typeof N.componentDidMount=="function"&&(a.flags|=4194308)}function Tc(a,c){try{var _="",E=c;do _+=pr(E),E=E.return;while(E);var N=_}catch(O){N=`
Error generating stack: `+O.message+`
`+O.stack}return{value:a,source:c,stack:N,digest:null}}function Np(a,c,_){return{value:a,source:null,stack:_??null,digest:c??null}}function wh(a,c){try{console.error(c.value)}catch(_){setTimeout(function(){throw _})}}var nm=typeof WeakMap=="function"?WeakMap:Map;function gu(a,c,_){_=Wt(-1,_),_.tag=3,_.payload={element:null};var E=c.value;return _.callback=function(){jh||(jh=!0,$p=E),wh(a,c)},_}function kc(a,c,_){_=Wt(-1,_),_.tag=3;var E=a.type.getDerivedStateFromError;if(typeof E=="function"){var N=c.value;_.payload=function(){return E(N)},_.callback=function(){wh(a,c)}}var O=a.stateNode;return O!==null&&typeof O.componentDidCatch=="function"&&(_.callback=function(){wh(a,c),typeof E!="function"&&(Yi===null?Yi=new Set([this]):Yi.add(this));var J=c.stack;this.componentDidCatch(c.value,{componentStack:J!==null?J:""})}),_}function so(a,c,_){var E=a.pingCache;if(E===null){E=a.pingCache=new nm;var N=new Set;E.set(c,N)}else N=E.get(c),N===void 0&&(N=new Set,E.set(c,N));N.has(_)||(N.add(_),a=Kp.bind(null,a,c,_),c.then(a,a))}function Td(a){do{var c;if((c=a.tag===13)&&(c=a.memoizedState,c=c!==null?c.dehydrated!==null:!0),c)return a;a=a.return}while(a!==null);return null}function Dp(a,c,_,E,N){return(a.mode&1)===0?(a===c?a.flags|=65536:(a.flags|=128,_.flags|=131072,_.flags&=-52805,_.tag===1&&(_.alternate===null?_.tag=17:(c=Wt(-1,1),c.tag=2,or(_,c,1))),_.lanes|=1),a):(a.flags|=65536,a.lanes=N,a)}var Th=dt.ReactCurrentOwner,Ci=!1;function Sn(a,c,_,E){c.child=a===null?ue(c,null,_,E):le(c,a.child,_,E)}function yu(a,c,_,E,N){_=_.render;var O=c.ref;return ze(c,N),E=xd(a,c,_,E,O,N),_=_d(),a!==null&&!Ci?(c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~N,ao(a,c,N)):(f&&_&&to(c),c.flags|=1,Sn(a,c,E,N),c.child)}function zi(a,c,_,E,N){if(a===null){var O=_.type;return typeof O=="function"&&!jc(O)&&O.defaultProps===void 0&&_.compare===null&&_.defaultProps===void 0?(c.tag=15,c.type=O,Ws(a,c,O,E,N)):(a=Fd(_.type,null,E,c,c.mode,N),a.ref=c.ref,a.return=c,c.child=a)}if(O=a.child,(a.lanes&N)===0){var J=O.memoizedProps;if(_=_.compare,_=_!==null?_:Za,_(J,E)&&a.ref===c.ref)return ao(a,c,N)}return c.flags|=1,a=zl(O,E),a.ref=c.ref,a.return=c,c.child=a}function Ws(a,c,_,E,N){if(a!==null){var O=a.memoizedProps;if(Za(O,E)&&a.ref===c.ref)if(Ci=!1,c.pendingProps=E=O,(a.lanes&N)!==0)(a.flags&131072)!==0&&(Ci=!0);else return c.lanes=a.lanes,ao(a,c,N)}return Sd(a,c,_,E,N)}function kd(a,c,_){var E=c.pendingProps,N=E.children,O=a!==null?a.memoizedState:null;if(E.mode==="hidden")if((c.mode&1)===0)c.memoizedState={baseLanes:0,cachePool:null,transitions:null},Rr(Mi,qn),qn|=_;else{if((_&1073741824)===0)return a=O!==null?O.baseLanes|_:_,c.lanes=c.childLanes=1073741824,c.memoizedState={baseLanes:a,cachePool:null,transitions:null},c.updateQueue=null,Rr(Mi,qn),qn|=a,null;c.memoizedState={baseLanes:0,cachePool:null,transitions:null},E=O!==null?O.baseLanes:_,Rr(Mi,qn),qn|=E}else O!==null?(E=O.baseLanes|_,c.memoizedState=null):E=_,Rr(Mi,qn),qn|=E;return Sn(a,c,N,_),c.child}function Nn(a,c){var _=c.ref;(a===null&&_!==null||a!==null&&a.ref!==_)&&(c.flags|=512,c.flags|=2097152)}function Sd(a,c,_,E,N){var O=Li(_)?Io:bi.current;return O=wi(c,O),ze(c,N),_=xd(a,c,_,E,O,N),E=_d(),a!==null&&!Ci?(c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~N,ao(a,c,N)):(f&&E&&to(c),c.flags|=1,Sn(a,c,_,N),c.child)}function xu(a,c,_,E,N){if(Li(_)){var O=!0;oa(c)}else O=!1;if(ze(c,N),c.stateNode===null)Sh(a,c),bd(c,_,E),wd(c,_,E,N),E=!0;else if(a===null){var J=c.stateNode,xe=c.memoizedProps;J.props=xe;var Pe=J.context,rt=_.contextType;typeof rt=="object"&&rt!==null?rt=nt(rt):(rt=Li(_)?Io:bi.current,rt=wi(c,rt));var At=_.getDerivedStateFromProps,jt=typeof At=="function"||typeof J.getSnapshotBeforeUpdate=="function";jt||typeof J.UNSAFE_componentWillReceiveProps!="function"&&typeof J.componentWillReceiveProps!="function"||(xe!==E||Pe!==rt)&&bh(c,J,E,rt),ft=!1;var Et=c.memoizedState;J.state=Et,Sr(c,E,J,N),Pe=c.memoizedState,xe!==E||Et!==Pe||Xi.current||ft?(typeof At=="function"&&(Bo(c,_,At,E),Pe=c.memoizedState),(xe=ft||Pl(c,_,xe,E,Et,Pe,rt))?(jt||typeof J.UNSAFE_componentWillMount!="function"&&typeof J.componentWillMount!="function"||(typeof J.componentWillMount=="function"&&J.componentWillMount(),typeof J.UNSAFE_componentWillMount=="function"&&J.UNSAFE_componentWillMount()),typeof J.componentDidMount=="function"&&(c.flags|=4194308)):(typeof J.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=E,c.memoizedState=Pe),J.props=E,J.state=Pe,J.context=rt,E=xe):(typeof J.componentDidMount=="function"&&(c.flags|=4194308),E=!1)}else{J=c.stateNode,vt(a,c),xe=c.memoizedProps,rt=c.type===c.elementType?xe:Gs(c.type,xe),J.props=rt,jt=c.pendingProps,Et=J.context,Pe=_.contextType,typeof Pe=="object"&&Pe!==null?Pe=nt(Pe):(Pe=Li(_)?Io:bi.current,Pe=wi(c,Pe));var Xt=_.getDerivedStateFromProps;(At=typeof Xt=="function"||typeof J.getSnapshotBeforeUpdate=="function")||typeof J.UNSAFE_componentWillReceiveProps!="function"&&typeof J.componentWillReceiveProps!="function"||(xe!==jt||Et!==Pe)&&bh(c,J,E,Pe),ft=!1,Et=c.memoizedState,J.state=Et,Sr(c,E,J,N);var nr=c.memoizedState;xe!==jt||Et!==nr||Xi.current||ft?(typeof Xt=="function"&&(Bo(c,_,Xt,E),nr=c.memoizedState),(rt=ft||Pl(c,_,rt,E,Et,nr,Pe)||!1)?(At||typeof J.UNSAFE_componentWillUpdate!="function"&&typeof J.componentWillUpdate!="function"||(typeof J.componentWillUpdate=="function"&&J.componentWillUpdate(E,nr,Pe),typeof J.UNSAFE_componentWillUpdate=="function"&&J.UNSAFE_componentWillUpdate(E,nr,Pe)),typeof J.componentDidUpdate=="function"&&(c.flags|=4),typeof J.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof J.componentDidUpdate!="function"||xe===a.memoizedProps&&Et===a.memoizedState||(c.flags|=4),typeof J.getSnapshotBeforeUpdate!="function"||xe===a.memoizedProps&&Et===a.memoizedState||(c.flags|=1024),c.memoizedProps=E,c.memoizedState=nr),J.props=E,J.state=nr,J.context=Pe,E=rt):(typeof J.componentDidUpdate!="function"||xe===a.memoizedProps&&Et===a.memoizedState||(c.flags|=4),typeof J.getSnapshotBeforeUpdate!="function"||xe===a.memoizedProps&&Et===a.memoizedState||(c.flags|=1024),E=!1)}return qs(a,c,_,E,O,N)}function qs(a,c,_,E,N,O){Nn(a,c);var J=(c.flags&128)!==0;if(!E&&!J)return N&&xc(c,_,!1),ao(a,c,O);E=c.stateNode,Th.current=c;var xe=J&&typeof _.getDerivedStateFromError!="function"?null:E.render();return c.flags|=1,a!==null&&J?(c.child=le(c,a.child,null,O),c.child=le(c,null,xe,O)):Sn(a,c,xe,O),c.memoizedState=E.state,N&&xc(c,_,!0),c.child}function im(a){var c=a.stateNode;c.pendingContext?Es(a,c.pendingContext,c.pendingContext!==c.context):c.context&&Es(a,c.context,!1),mi(a,c.containerInfo)}function sm(a,c,_,E,N){return Q(),re(N),c.flags|=256,Sn(a,c,_,E),c.child}var Ed={dehydrated:null,treeContext:null,retryLane:0};function Cd(a){return{baseLanes:a,cachePool:null,transitions:null}}function Il(a,c,_){var E=c.pendingProps,N=_r.current,O=!1,J=(c.flags&128)!==0,xe;if((xe=J)||(xe=a!==null&&a.memoizedState===null?!1:(N&2)!==0),xe?(O=!0,c.flags&=-129):(a===null||a.memoizedState!==null)&&(N|=1),Rr(_r,N&1),a===null)return j(c),a=c.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((c.mode&1)===0?c.lanes=1:a.data==="$!"?c.lanes=8:c.lanes=1073741824,null):(J=E.children,a=E.fallback,O?(E=c.mode,O=c.child,J={mode:"hidden",children:J},(E&1)===0&&O!==null?(O.childLanes=0,O.pendingProps=J):O=Od(J,E,0,null),a=Nc(a,E,_,null),O.return=c,a.return=c,O.sibling=a,c.child=O,c.child.memoizedState=Cd(_),c.memoizedState=Ed,a):Md(c,J));if(N=a.memoizedState,N!==null&&(xe=N.dehydrated,xe!==null))return am(a,c,J,E,xe,N,_);if(O){O=E.fallback,J=c.mode,N=a.child,xe=N.sibling;var Pe={mode:"hidden",children:E.children};return(J&1)===0&&c.child!==N?(E=c.child,E.childLanes=0,E.pendingProps=Pe,c.deletions=null):(E=zl(N,Pe),E.subtreeFlags=N.subtreeFlags&14680064),xe!==null?O=zl(xe,O):(O=Nc(O,J,_,null),O.flags|=2),O.return=c,E.return=c,E.sibling=O,c.child=E,E=O,O=c.child,J=a.child.memoizedState,J=J===null?Cd(_):{baseLanes:J.baseLanes|_,cachePool:null,transitions:J.transitions},O.memoizedState=J,O.childLanes=a.childLanes&~_,c.memoizedState=Ed,E}return O=a.child,a=O.sibling,E=zl(O,{mode:"visible",children:E.children}),(c.mode&1)===0&&(E.lanes=_),E.return=c,E.sibling=null,a!==null&&(_=c.deletions,_===null?(c.deletions=[a],c.flags|=16):_.push(a)),c.child=E,c.memoizedState=null,E}function Md(a,c){return c=Od({mode:"visible",children:c},a.mode,0,null),c.return=a,a.child=c}function kh(a,c,_,E){return E!==null&&re(E),le(c,a.child,null,_),a=Md(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function am(a,c,_,E,N,O,J){if(_)return c.flags&256?(c.flags&=-257,E=Np(Error(y(422))),kh(a,c,J,E)):c.memoizedState!==null?(c.child=a.child,c.flags|=128,null):(O=E.fallback,N=c.mode,E=Od({mode:"visible",children:E.children},N,0,null),O=Nc(O,N,J,null),O.flags|=2,E.return=c,O.return=c,E.sibling=O,c.child=E,(c.mode&1)!==0&&le(c,a.child,null,J),c.child.memoizedState=Cd(J),c.memoizedState=Ed,O);if((c.mode&1)===0)return kh(a,c,J,null);if(N.data==="$!"){if(E=N.nextSibling&&N.nextSibling.dataset,E)var xe=E.dgst;return E=xe,O=Error(y(419)),E=Np(O,E,void 0),kh(a,c,J,E)}if(xe=(J&a.childLanes)!==0,Ci||xe){if(E=xi,E!==null){switch(J&-J){case 4:N=2;break;case 16:N=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:N=32;break;case 536870912:N=268435456;break;default:N=0}N=(N&(E.suspendedLanes|J))!==0?0:N,N!==0&&N!==O.retryLane&&(O.retryLane=N,it(a,N),La(E,a,N,-1))}return qp(),E=Np(Error(y(421))),kh(a,c,J,E)}return N.data==="$?"?(c.flags|=128,c.child=a.child,c=xg.bind(null,a),N._reactRetry=c,null):(a=O.treeContext,o=aa(N.nextSibling),n=c,f=!0,x=null,a!==null&&(ls[cs++]=Ma,ls[cs++]=Vs,ls[cs++]=Do,Ma=a.id,Vs=a.overflow,Do=c),c=Md(c,E.children),c.flags|=4096,c)}function Lp(a,c,_){a.lanes|=c;var E=a.alternate;E!==null&&(E.lanes|=c),yt(a.return,c,_)}function Rp(a,c,_,E,N){var O=a.memoizedState;O===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:E,tail:_,tailMode:N}:(O.isBackwards=c,O.rendering=null,O.renderingStartTime=0,O.last=E,O.tail=_,O.tailMode=N)}function om(a,c,_){var E=c.pendingProps,N=E.revealOrder,O=E.tail;if(Sn(a,c,E.children,_),E=_r.current,(E&2)!==0)E=E&1|2,c.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Lp(a,_,c);else if(a.tag===19)Lp(a,_,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}E&=1}if(Rr(_r,E),(c.mode&1)===0)c.memoizedState=null;else switch(N){case"forwards":for(_=c.child,N=null;_!==null;)a=_.alternate,a!==null&&tn(a)===null&&(N=_),_=_.sibling;_=N,_===null?(N=c.child,c.child=null):(N=_.sibling,_.sibling=null),Rp(c,!1,N,_,O);break;case"backwards":for(_=null,N=c.child,c.child=null;N!==null;){if(a=N.alternate,a!==null&&tn(a)===null){c.child=N;break}a=N.sibling,N.sibling=_,_=N,N=a}Rp(c,!0,_,null,O);break;case"together":Rp(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function Sh(a,c){(c.mode&1)===0&&a!==null&&(a.alternate=null,c.alternate=null,c.flags|=2)}function ao(a,c,_){if(a!==null&&(c.dependencies=a.dependencies),Fn|=c.lanes,(_&c.childLanes)===0)return null;if(a!==null&&c.child!==a.child)throw Error(y(153));if(c.child!==null){for(a=c.child,_=zl(a,a.pendingProps),c.child=_,_.return=c;a.sibling!==null;)a=a.sibling,_=_.sibling=zl(a,a.pendingProps),_.return=c;_.sibling=null}return c.child}function Eh(a,c,_){switch(c.tag){case 3:im(c),Q();break;case 5:us(c);break;case 1:Li(c.type)&&oa(c);break;case 4:mi(c,c.stateNode.containerInfo);break;case 10:var E=c.type._context,N=c.memoizedProps.value;Rr(ke,E._currentValue),E._currentValue=N;break;case 13:if(E=c.memoizedState,E!==null)return E.dehydrated!==null?(Rr(_r,_r.current&1),c.flags|=128,null):(_&c.child.childLanes)!==0?Il(a,c,_):(Rr(_r,_r.current&1),a=ao(a,c,_),a!==null?a.sibling:null);Rr(_r,_r.current&1);break;case 19:if(E=(_&c.childLanes)!==0,(a.flags&128)!==0){if(E)return om(a,c,_);c.flags|=128}if(N=c.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),Rr(_r,_r.current),E)break;return null;case 22:case 23:return c.lanes=0,kd(a,c,_)}return ao(a,c,_)}var Ad,Ch,Pd,Bi;Ad=function(a,c){for(var _=c.child;_!==null;){if(_.tag===5||_.tag===6)a.appendChild(_.stateNode);else if(_.tag!==4&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===c)break;for(;_.sibling===null;){if(_.return===null||_.return===c)return;_=_.return}_.sibling.return=_.return,_=_.sibling}},Ch=function(){},Pd=function(a,c,_,E){var N=a.memoizedProps;if(N!==E){a=c.stateNode,qr(Dr.current);var O=null;switch(_){case"input":N=Rn(a,N),E=Rn(a,E),O=[];break;case"select":N=Je({},N,{value:void 0}),E=Je({},E,{value:void 0}),O=[];break;case"textarea":N=Js(a,N),E=Js(a,E),O=[];break;default:typeof N.onClick!="function"&&typeof E.onClick=="function"&&(a.onclick=_l)}ya(_,E);var J;_=null;for(rt in N)if(!E.hasOwnProperty(rt)&&N.hasOwnProperty(rt)&&N[rt]!=null)if(rt==="style"){var xe=N[rt];for(J in xe)xe.hasOwnProperty(J)&&(_||(_={}),_[J]="")}else rt!=="dangerouslySetInnerHTML"&&rt!=="children"&&rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&rt!=="autoFocus"&&(k.hasOwnProperty(rt)?O||(O=[]):(O=O||[]).push(rt,null));for(rt in E){var Pe=E[rt];if(xe=N?.[rt],E.hasOwnProperty(rt)&&Pe!==xe&&(Pe!=null||xe!=null))if(rt==="style")if(xe){for(J in xe)!xe.hasOwnProperty(J)||Pe&&Pe.hasOwnProperty(J)||(_||(_={}),_[J]="");for(J in Pe)Pe.hasOwnProperty(J)&&xe[J]!==Pe[J]&&(_||(_={}),_[J]=Pe[J])}else _||(O||(O=[]),O.push(rt,_)),_=Pe;else rt==="dangerouslySetInnerHTML"?(Pe=Pe?Pe.__html:void 0,xe=xe?xe.__html:void 0,Pe!=null&&xe!==Pe&&(O=O||[]).push(rt,Pe)):rt==="children"?typeof Pe!="string"&&typeof Pe!="number"||(O=O||[]).push(rt,""+Pe):rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&(k.hasOwnProperty(rt)?(Pe!=null&&rt==="onScroll"&&an("scroll",a),O||xe===Pe||(O=[])):(O=O||[]).push(rt,Pe))}_&&(O=O||[]).push("style",_);var rt=O;(c.updateQueue=rt)&&(c.flags|=4)}},Bi=function(a,c,_,E){_!==E&&(c.flags|=4)};function Sc(a,c){if(!f)switch(a.tailMode){case"hidden":c=a.tail;for(var _=null;c!==null;)c.alternate!==null&&(_=c),c=c.sibling;_===null?a.tail=null:_.sibling=null;break;case"collapsed":_=a.tail;for(var E=null;_!==null;)_.alternate!==null&&(E=_),_=_.sibling;E===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:E.sibling=null}}function Fi(a){var c=a.alternate!==null&&a.alternate.child===a.child,_=0,E=0;if(c)for(var N=a.child;N!==null;)_|=N.lanes|N.childLanes,E|=N.subtreeFlags&14680064,E|=N.flags&14680064,N.return=a,N=N.sibling;else for(N=a.child;N!==null;)_|=N.lanes|N.childLanes,E|=N.subtreeFlags,E|=N.flags,N.return=a,N=N.sibling;return a.subtreeFlags|=E,a.childLanes=_,c}function oo(a,c,_){var E=c.pendingProps;switch(d(c),c.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fi(c),null;case 1:return Li(c.type)&&du(),Fi(c),null;case 3:return E=c.stateNode,In(),vn(Xi),vn(bi),jn(),E.pendingContext&&(E.context=E.pendingContext,E.pendingContext=null),(a===null||a.child===null)&&(z(c)?c.flags|=4:a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,x!==null&&(Oo(x),x=null))),Ch(a,c),Fi(c),null;case 5:Cs(c);var N=qr(Kr.current);if(_=c.type,a!==null&&c.stateNode!=null)Pd(a,c,_,E,N),a.ref!==c.ref&&(c.flags|=512,c.flags|=2097152);else{if(!E){if(c.stateNode===null)throw Error(y(166));return Fi(c),null}if(a=qr(Dr.current),z(c)){E=c.stateNode,_=c.type;var O=c.memoizedProps;switch(E[Zi]=c,E[Ea]=O,a=(c.mode&1)!==0,_){case"dialog":an("cancel",E),an("close",E);break;case"iframe":case"object":case"embed":an("load",E);break;case"video":case"audio":for(N=0;N<os.length;N++)an(os[N],E);break;case"source":an("error",E);break;case"img":case"image":case"link":an("error",E),an("load",E);break;case"details":an("toggle",E);break;case"input":nn(E,O),an("invalid",E);break;case"select":E._wrapperState={wasMultiple:!!O.multiple},an("invalid",E);break;case"textarea":_t(E,O),an("invalid",E)}ya(_,O),N=null;for(var J in O)if(O.hasOwnProperty(J)){var xe=O[J];J==="children"?typeof xe=="string"?E.textContent!==xe&&(O.suppressHydrationWarning!==!0&&Ao(E.textContent,xe,a),N=["children",xe]):typeof xe=="number"&&E.textContent!==""+xe&&(O.suppressHydrationWarning!==!0&&Ao(E.textContent,xe,a),N=["children",""+xe]):k.hasOwnProperty(J)&&xe!=null&&J==="onScroll"&&an("scroll",E)}switch(_){case"input":Vn(E),za(E,O,!0);break;case"textarea":Vn(E),Br(E);break;case"select":case"option":break;default:typeof O.onClick=="function"&&(E.onclick=_l)}E=N,c.updateQueue=E,E!==null&&(c.flags|=4)}else{J=N.nodeType===9?N:N.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=qt(_)),a==="http://www.w3.org/1999/xhtml"?_==="script"?(a=J.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof E.is=="string"?a=J.createElement(_,{is:E.is}):(a=J.createElement(_),_==="select"&&(J=a,E.multiple?J.multiple=!0:E.size&&(J.size=E.size))):a=J.createElementNS(a,_),a[Zi]=c,a[Ea]=E,Ad(a,c,!1,!1),c.stateNode=a;e:{switch(J=xa(_,E),_){case"dialog":an("cancel",a),an("close",a),N=E;break;case"iframe":case"object":case"embed":an("load",a),N=E;break;case"video":case"audio":for(N=0;N<os.length;N++)an(os[N],a);N=E;break;case"source":an("error",a),N=E;break;case"img":case"image":case"link":an("error",a),an("load",a),N=E;break;case"details":an("toggle",a),N=E;break;case"input":nn(a,E),N=Rn(a,E),an("invalid",a);break;case"option":N=E;break;case"select":a._wrapperState={wasMultiple:!!E.multiple},N=Je({},E,{value:void 0}),an("invalid",a);break;case"textarea":_t(a,E),N=Js(a,E),an("invalid",a);break;default:N=E}ya(_,N),xe=N;for(O in xe)if(xe.hasOwnProperty(O)){var Pe=xe[O];O==="style"?Ba(a,Pe):O==="dangerouslySetInnerHTML"?(Pe=Pe?Pe.__html:void 0,Pe!=null&&ui(a,Pe)):O==="children"?typeof Pe=="string"?(_!=="textarea"||Pe!=="")&&En(a,Pe):typeof Pe=="number"&&En(a,""+Pe):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(k.hasOwnProperty(O)?Pe!=null&&O==="onScroll"&&an("scroll",a):Pe!=null&&Qe(a,O,Pe,J))}switch(_){case"input":Vn(a),za(a,E,!1);break;case"textarea":Vn(a),Br(a);break;case"option":E.value!=null&&a.setAttribute("value",""+lt(E.value));break;case"select":a.multiple=!!E.multiple,O=E.value,O!=null?gs(a,!!E.multiple,O,!1):E.defaultValue!=null&&gs(a,!!E.multiple,E.defaultValue,!0);break;default:typeof N.onClick=="function"&&(a.onclick=_l)}switch(_){case"button":case"input":case"select":case"textarea":E=!!E.autoFocus;break e;case"img":E=!0;break e;default:E=!1}}E&&(c.flags|=4)}c.ref!==null&&(c.flags|=512,c.flags|=2097152)}return Fi(c),null;case 6:if(a&&c.stateNode!=null)Bi(a,c,a.memoizedProps,E);else{if(typeof E!="string"&&c.stateNode===null)throw Error(y(166));if(_=qr(Kr.current),qr(Dr.current),z(c)){if(E=c.stateNode,_=c.memoizedProps,E[Zi]=c,(O=E.nodeValue!==_)&&(a=n,a!==null))switch(a.tag){case 3:Ao(E.nodeValue,_,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&Ao(E.nodeValue,_,(a.mode&1)!==0)}O&&(c.flags|=4)}else E=(_.nodeType===9?_:_.ownerDocument).createTextNode(E),E[Zi]=c,c.stateNode=E}return Fi(c),null;case 13:if(vn(_r),E=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(f&&o!==null&&(c.mode&1)!==0&&(c.flags&128)===0)G(),Q(),c.flags|=98560,O=!1;else if(O=z(c),E!==null&&E.dehydrated!==null){if(a===null){if(!O)throw Error(y(318));if(O=c.memoizedState,O=O!==null?O.dehydrated:null,!O)throw Error(y(317));O[Zi]=c}else Q(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Fi(c),O=!1}else x!==null&&(Oo(x),x=null),O=!0;if(!O)return c.flags&65536?c:null}return(c.flags&128)!==0?(c.lanes=_,c):(E=E!==null,E!==(a!==null&&a.memoizedState!==null)&&E&&(c.child.flags|=8192,(c.mode&1)!==0&&(a===null||(_r.current&1)!==0?Yr===0&&(Yr=3):qp())),c.updateQueue!==null&&(c.flags|=4),Fi(c),null);case 4:return In(),Ch(a,c),a===null&&ka(c.stateNode.containerInfo),Fi(c),null;case 10:return Ve(c.type._context),Fi(c),null;case 17:return Li(c.type)&&du(),Fi(c),null;case 19:if(vn(_r),O=c.memoizedState,O===null)return Fi(c),null;if(E=(c.flags&128)!==0,J=O.rendering,J===null)if(E)Sc(O,!1);else{if(Yr!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(J=tn(a),J!==null){for(c.flags|=128,Sc(O,!1),E=J.updateQueue,E!==null&&(c.updateQueue=E,c.flags|=4),c.subtreeFlags=0,E=_,_=c.child;_!==null;)O=_,a=E,O.flags&=14680066,J=O.alternate,J===null?(O.childLanes=0,O.lanes=a,O.child=null,O.subtreeFlags=0,O.memoizedProps=null,O.memoizedState=null,O.updateQueue=null,O.dependencies=null,O.stateNode=null):(O.childLanes=J.childLanes,O.lanes=J.lanes,O.child=J.child,O.subtreeFlags=0,O.deletions=null,O.memoizedProps=J.memoizedProps,O.memoizedState=J.memoizedState,O.updateQueue=J.updateQueue,O.type=J.type,a=J.dependencies,O.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),_=_.sibling;return Rr(_r,_r.current&1|2),c.child}a=a.sibling}O.tail!==null&&Pn()>ku&&(c.flags|=128,E=!0,Sc(O,!1),c.lanes=4194304)}else{if(!E)if(a=tn(J),a!==null){if(c.flags|=128,E=!0,_=a.updateQueue,_!==null&&(c.updateQueue=_,c.flags|=4),Sc(O,!0),O.tail===null&&O.tailMode==="hidden"&&!J.alternate&&!f)return Fi(c),null}else 2*Pn()-O.renderingStartTime>ku&&_!==1073741824&&(c.flags|=128,E=!0,Sc(O,!1),c.lanes=4194304);O.isBackwards?(J.sibling=c.child,c.child=J):(_=O.last,_!==null?_.sibling=J:c.child=J,O.last=J)}return O.tail!==null?(c=O.tail,O.rendering=c,O.tail=c.sibling,O.renderingStartTime=Pn(),c.sibling=null,_=_r.current,Rr(_r,E?_&1|2:_&1),c):(Fi(c),null);case 22:case 23:return zd(),E=c.memoizedState!==null,a!==null&&a.memoizedState!==null!==E&&(c.flags|=8192),E&&(c.mode&1)!==0?(qn&1073741824)!==0&&(Fi(c),c.subtreeFlags&6&&(c.flags|=8192)):Fi(c),null;case 24:return null;case 25:return null}throw Error(y(156,c.tag))}function pg(a,c){switch(d(c),c.tag){case 1:return Li(c.type)&&du(),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return In(),vn(Xi),vn(bi),jn(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 5:return Cs(c),null;case 13:if(vn(_r),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(y(340));Q()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return vn(_r),null;case 4:return In(),null;case 10:return Ve(c.type._context),null;case 22:case 23:return zd(),null;case 24:return null;default:return null}}var lo=!1,yi=!1,ua=typeof WeakSet=="function"?WeakSet:Set,$t=null;function _u(a,c){var _=a.ref;if(_!==null)if(typeof _=="function")try{_(null)}catch(E){Yn(a,c,E)}else _.current=null}function vu(a,c,_){try{_()}catch(E){Yn(a,c,E)}}var zp=!1;function fg(a,c){if(vl=nl,a=dd(),ph(a)){if("selectionStart"in a)var _={start:a.selectionStart,end:a.selectionEnd};else e:{_=(_=a.ownerDocument)&&_.defaultView||window;var E=_.getSelection&&_.getSelection();if(E&&E.rangeCount!==0){_=E.anchorNode;var N=E.anchorOffset,O=E.focusNode;E=E.focusOffset;try{_.nodeType,O.nodeType}catch{_=null;break e}var J=0,xe=-1,Pe=-1,rt=0,At=0,jt=a,Et=null;t:for(;;){for(var Xt;jt!==_||N!==0&&jt.nodeType!==3||(xe=J+N),jt!==O||E!==0&&jt.nodeType!==3||(Pe=J+E),jt.nodeType===3&&(J+=jt.nodeValue.length),(Xt=jt.firstChild)!==null;)Et=jt,jt=Xt;for(;;){if(jt===a)break t;if(Et===_&&++rt===N&&(xe=J),Et===O&&++At===E&&(Pe=J),(Xt=jt.nextSibling)!==null)break;jt=Et,Et=jt.parentNode}jt=Xt}_=xe===-1||Pe===-1?null:{start:xe,end:Pe}}else _=null}_=_||{start:0,end:0}}else _=null;for(ou={focusedElem:a,selectionRange:_},nl=!1,$t=c;$t!==null;)if(c=$t,a=c.child,(c.subtreeFlags&1028)!==0&&a!==null)a.return=c,$t=a;else for(;$t!==null;){c=$t;try{var nr=c.alternate;if((c.flags&1024)!==0)switch(c.tag){case 0:case 11:case 15:break;case 1:if(nr!==null){var sr=nr.memoizedProps,Jn=nr.memoizedState,Ze=c.stateNode,Ne=Ze.getSnapshotBeforeUpdate(c.elementType===c.type?sr:Gs(c.type,sr),Jn);Ze.__reactInternalSnapshotBeforeUpdate=Ne}break;case 3:var Ke=c.stateNode.containerInfo;Ke.nodeType===1?Ke.textContent="":Ke.nodeType===9&&Ke.documentElement&&Ke.removeChild(Ke.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(y(163))}}catch(zt){Yn(c,c.return,zt)}if(a=c.sibling,a!==null){a.return=c.return,$t=a;break}$t=c.return}return nr=zp,zp=!1,nr}function Ec(a,c,_){var E=c.updateQueue;if(E=E!==null?E.lastEffect:null,E!==null){var N=E=E.next;do{if((N.tag&a)===a){var O=N.destroy;N.destroy=void 0,O!==void 0&&vu(c,_,O)}N=N.next}while(N!==E)}}function Zs(a,c){if(c=c.updateQueue,c=c!==null?c.lastEffect:null,c!==null){var _=c=c.next;do{if((_.tag&a)===a){var E=_.create;_.destroy=E()}_=_.next}while(_!==c)}}function Fo(a){var c=a.ref;if(c!==null){var _=a.stateNode;switch(a.tag){case 5:a=_;break;default:a=_}typeof c=="function"?c(a):c.current=a}}function Bp(a){var c=a.alternate;c!==null&&(a.alternate=null,Bp(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&(delete c[Zi],delete c[Ea],delete c[cu],delete c[gh],delete c[yd])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function Fp(a){return a.tag===5||a.tag===3||a.tag===4}function lm(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Fp(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function bu(a,c,_){var E=a.tag;if(E===5||E===6)a=a.stateNode,c?_.nodeType===8?_.parentNode.insertBefore(a,c):_.insertBefore(a,c):(_.nodeType===8?(c=_.parentNode,c.insertBefore(a,_)):(c=_,c.appendChild(a)),_=_._reactRootContainer,_!=null||c.onclick!==null||(c.onclick=_l));else if(E!==4&&(a=a.child,a!==null))for(bu(a,c,_),a=a.sibling;a!==null;)bu(a,c,_),a=a.sibling}function Mh(a,c,_){var E=a.tag;if(E===5||E===6)a=a.stateNode,c?_.insertBefore(a,c):_.appendChild(a);else if(E!==4&&(a=a.child,a!==null))for(Mh(a,c,_),a=a.sibling;a!==null;)Mh(a,c,_),a=a.sibling}var Kn=null,Ki=!1;function ha(a,c,_){for(_=_.child;_!==null;)Ah(a,c,_),_=_.sibling}function Ah(a,c,_){if(Vi&&typeof Vi.onCommitFiberUnmount=="function")try{Vi.onCommitFiberUnmount(xs,_)}catch{}switch(_.tag){case 5:yi||_u(_,c);case 6:var E=Kn,N=Ki;Kn=null,ha(a,c,_),Kn=E,Ki=N,Kn!==null&&(Ki?(a=Kn,_=_.stateNode,a.nodeType===8?a.parentNode.removeChild(_):a.removeChild(_)):Kn.removeChild(_.stateNode));break;case 18:Kn!==null&&(Ki?(a=Kn,_=_.stateNode,a.nodeType===8?yc(a.parentNode,_):a.nodeType===1&&yc(a,_),Bs(a)):yc(Kn,_.stateNode));break;case 4:E=Kn,N=Ki,Kn=_.stateNode.containerInfo,Ki=!0,ha(a,c,_),Kn=E,Ki=N;break;case 0:case 11:case 14:case 15:if(!yi&&(E=_.updateQueue,E!==null&&(E=E.lastEffect,E!==null))){N=E=E.next;do{var O=N,J=O.destroy;O=O.tag,J!==void 0&&((O&2)!==0||(O&4)!==0)&&vu(_,c,J),N=N.next}while(N!==E)}ha(a,c,_);break;case 1:if(!yi&&(_u(_,c),E=_.stateNode,typeof E.componentWillUnmount=="function"))try{E.props=_.memoizedProps,E.state=_.memoizedState,E.componentWillUnmount()}catch(xe){Yn(_,c,xe)}ha(a,c,_);break;case 21:ha(a,c,_);break;case 22:_.mode&1?(yi=(E=yi)||_.memoizedState!==null,ha(a,c,_),yi=E):ha(a,c,_);break;default:ha(a,c,_)}}function Op(a){var c=a.updateQueue;if(c!==null){a.updateQueue=null;var _=a.stateNode;_===null&&(_=a.stateNode=new ua),c.forEach(function(E){var N=_g.bind(null,a,E);_.has(E)||(_.add(E),E.then(N,N))})}}function hs(a,c){var _=c.deletions;if(_!==null)for(var E=0;E<_.length;E++){var N=_[E];try{var O=a,J=c,xe=J;e:for(;xe!==null;){switch(xe.tag){case 5:Kn=xe.stateNode,Ki=!1;break e;case 3:Kn=xe.stateNode.containerInfo,Ki=!0;break e;case 4:Kn=xe.stateNode.containerInfo,Ki=!0;break e}xe=xe.return}if(Kn===null)throw Error(y(160));Ah(O,J,N),Kn=null,Ki=!1;var Pe=N.alternate;Pe!==null&&(Pe.return=null),N.return=null}catch(rt){Yn(N,c,rt)}}if(c.subtreeFlags&12854)for(c=c.child;c!==null;)Id(c,a),c=c.sibling}function Id(a,c){var _=a.alternate,E=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(hs(c,a),ja(a),E&4){try{Ec(3,a,a.return),Zs(3,a)}catch(sr){Yn(a,a.return,sr)}try{Ec(5,a,a.return)}catch(sr){Yn(a,a.return,sr)}}break;case 1:hs(c,a),ja(a),E&512&&_!==null&&_u(_,_.return);break;case 5:if(hs(c,a),ja(a),E&512&&_!==null&&_u(_,_.return),a.flags&32){var N=a.stateNode;try{En(N,"")}catch(sr){Yn(a,a.return,sr)}}if(E&4&&(N=a.stateNode,N!=null)){var O=a.memoizedProps,J=_!==null?_.memoizedProps:O,xe=a.type,Pe=a.updateQueue;if(a.updateQueue=null,Pe!==null)try{xe==="input"&&O.type==="radio"&&O.name!=null&&Gr(N,O),xa(xe,J);var rt=xa(xe,O);for(J=0;J<Pe.length;J+=2){var At=Pe[J],jt=Pe[J+1];At==="style"?Ba(N,jt):At==="dangerouslySetInnerHTML"?ui(N,jt):At==="children"?En(N,jt):Qe(N,At,jt,rt)}switch(xe){case"input":sn(N,O);break;case"textarea":dr(N,O);break;case"select":var Et=N._wrapperState.wasMultiple;N._wrapperState.wasMultiple=!!O.multiple;var Xt=O.value;Xt!=null?gs(N,!!O.multiple,Xt,!1):Et!==!!O.multiple&&(O.defaultValue!=null?gs(N,!!O.multiple,O.defaultValue,!0):gs(N,!!O.multiple,O.multiple?[]:"",!1))}N[Ea]=O}catch(sr){Yn(a,a.return,sr)}}break;case 6:if(hs(c,a),ja(a),E&4){if(a.stateNode===null)throw Error(y(162));N=a.stateNode,O=a.memoizedProps;try{N.nodeValue=O}catch(sr){Yn(a,a.return,sr)}}break;case 3:if(hs(c,a),ja(a),E&4&&_!==null&&_.memoizedState.isDehydrated)try{Bs(c.containerInfo)}catch(sr){Yn(a,a.return,sr)}break;case 4:hs(c,a),ja(a);break;case 13:hs(c,a),ja(a),N=a.child,N.flags&8192&&(O=N.memoizedState!==null,N.stateNode.isHidden=O,!O||N.alternate!==null&&N.alternate.memoizedState!==null||(Ih=Pn())),E&4&&Op(a);break;case 22:if(At=_!==null&&_.memoizedState!==null,a.mode&1?(yi=(rt=yi)||At,hs(c,a),yi=rt):hs(c,a),ja(a),E&8192){if(rt=a.memoizedState!==null,(a.stateNode.isHidden=rt)&&!At&&(a.mode&1)!==0)for($t=a,At=a.child;At!==null;){for(jt=$t=At;$t!==null;){switch(Et=$t,Xt=Et.child,Et.tag){case 0:case 11:case 14:case 15:Ec(4,Et,Et.return);break;case 1:_u(Et,Et.return);var nr=Et.stateNode;if(typeof nr.componentWillUnmount=="function"){E=Et,_=Et.return;try{c=E,nr.props=c.memoizedProps,nr.state=c.memoizedState,nr.componentWillUnmount()}catch(sr){Yn(E,_,sr)}}break;case 5:_u(Et,Et.return);break;case 22:if(Et.memoizedState!==null){Vp(jt);continue}}Xt!==null?(Xt.return=Et,$t=Xt):Vp(jt)}At=At.sibling}e:for(At=null,jt=a;;){if(jt.tag===5){if(At===null){At=jt;try{N=jt.stateNode,rt?(O=N.style,typeof O.setProperty=="function"?O.setProperty("display","none","important"):O.display="none"):(xe=jt.stateNode,Pe=jt.memoizedProps.style,J=Pe!=null&&Pe.hasOwnProperty("display")?Pe.display:null,xe.style.display=Ko("display",J))}catch(sr){Yn(a,a.return,sr)}}}else if(jt.tag===6){if(At===null)try{jt.stateNode.nodeValue=rt?"":jt.memoizedProps}catch(sr){Yn(a,a.return,sr)}}else if((jt.tag!==22&&jt.tag!==23||jt.memoizedState===null||jt===a)&&jt.child!==null){jt.child.return=jt,jt=jt.child;continue}if(jt===a)break e;for(;jt.sibling===null;){if(jt.return===null||jt.return===a)break e;At===jt&&(At=null),jt=jt.return}At===jt&&(At=null),jt.sibling.return=jt.return,jt=jt.sibling}}break;case 19:hs(c,a),ja(a),E&4&&Op(a);break;case 21:break;default:hs(c,a),ja(a)}}function ja(a){var c=a.flags;if(c&2){try{e:{for(var _=a.return;_!==null;){if(Fp(_)){var E=_;break e}_=_.return}throw Error(y(160))}switch(E.tag){case 5:var N=E.stateNode;E.flags&32&&(En(N,""),E.flags&=-33);var O=lm(a);Mh(a,O,N);break;case 3:case 4:var J=E.stateNode.containerInfo,xe=lm(a);bu(a,xe,J);break;default:throw Error(y(161))}}catch(Pe){Yn(a,a.return,Pe)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function wu(a,c,_){$t=a,Up(a)}function Up(a,c,_){for(var E=(a.mode&1)!==0;$t!==null;){var N=$t,O=N.child;if(N.tag===22&&E){var J=N.memoizedState!==null||lo;if(!J){var xe=N.alternate,Pe=xe!==null&&xe.memoizedState!==null||yi;xe=lo;var rt=yi;if(lo=J,(yi=Pe)&&!rt)for($t=N;$t!==null;)J=$t,Pe=J.child,J.tag===22&&J.memoizedState!==null?cm(N):Pe!==null?(Pe.return=J,$t=Pe):cm(N);for(;O!==null;)$t=O,Up(O),O=O.sibling;$t=N,lo=xe,yi=rt}jd(a)}else(N.subtreeFlags&8772)!==0&&O!==null?(O.return=N,$t=O):jd(a)}}function jd(a){for(;$t!==null;){var c=$t;if((c.flags&8772)!==0){var _=c.alternate;try{if((c.flags&8772)!==0)switch(c.tag){case 0:case 11:case 15:yi||Zs(5,c);break;case 1:var E=c.stateNode;if(c.flags&4&&!yi)if(_===null)E.componentDidMount();else{var N=c.elementType===c.type?_.memoizedProps:Gs(c.type,_.memoizedProps);E.componentDidUpdate(N,_.memoizedState,E.__reactInternalSnapshotBeforeUpdate)}var O=c.updateQueue;O!==null&&Pr(c,O,E);break;case 3:var J=c.updateQueue;if(J!==null){if(_=null,c.child!==null)switch(c.child.tag){case 5:_=c.child.stateNode;break;case 1:_=c.child.stateNode}Pr(c,J,_)}break;case 5:var xe=c.stateNode;if(_===null&&c.flags&4){_=xe;var Pe=c.memoizedProps;switch(c.type){case"button":case"input":case"select":case"textarea":Pe.autoFocus&&_.focus();break;case"img":Pe.src&&(_.src=Pe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(c.memoizedState===null){var rt=c.alternate;if(rt!==null){var At=rt.memoizedState;if(At!==null){var jt=At.dehydrated;jt!==null&&Bs(jt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(y(163))}yi||c.flags&512&&Fo(c)}catch(Et){Yn(c,c.return,Et)}}if(c===a){$t=null;break}if(_=c.sibling,_!==null){_.return=c.return,$t=_;break}$t=c.return}}function Vp(a){for(;$t!==null;){var c=$t;if(c===a){$t=null;break}var _=c.sibling;if(_!==null){_.return=c.return,$t=_;break}$t=c.return}}function cm(a){for(;$t!==null;){var c=$t;try{switch(c.tag){case 0:case 11:case 15:var _=c.return;try{Zs(4,c)}catch(Pe){Yn(c,_,Pe)}break;case 1:var E=c.stateNode;if(typeof E.componentDidMount=="function"){var N=c.return;try{E.componentDidMount()}catch(Pe){Yn(c,N,Pe)}}var O=c.return;try{Fo(c)}catch(Pe){Yn(c,O,Pe)}break;case 5:var J=c.return;try{Fo(c)}catch(Pe){Yn(c,J,Pe)}}}catch(Pe){Yn(c,c.return,Pe)}if(c===a){$t=null;break}var xe=c.sibling;if(xe!==null){xe.return=c.return,$t=xe;break}$t=c.return}}var mg=Math.ceil,jl=dt.ReactCurrentDispatcher,Nd=dt.ReactCurrentOwner,Ti=dt.ReactCurrentBatchConfig,rr=0,xi=null,pn=null,Mn=0,qn=0,Mi=Ca(0),Yr=0,Tu=null,Fn=0,Ph=0,Nl=0,Cc=null,ds=null,Ih=0,ku=1/0,Na=null,jh=!1,$p=null,Yi=null,co=!1,Da=null,Mc=0,Ac=0,Dd=null,Ld=-1,Nh=0;function ps(){return(rr&6)!==0?Pn():Ld!==-1?Ld:Ld=Pn()}function uo(a){return(a.mode&1)===0?1:(rr&2)!==0&&Mn!==0?Mn&-Mn:ie.transition!==null?(Nh===0&&(Nh=$i()),Nh):(a=Hr,a!==0||(a=window.event,a=a===void 0?16:Hc(a.type)),a)}function La(a,c,_,E){if(50<Ac)throw Ac=0,Dd=null,Error(y(185));br(a,_,E),((rr&2)===0||a!==xi)&&(a===xi&&((rr&2)===0&&(Ph|=_),Yr===4&&Dl(a,Mn)),Ji(a,E),_===1&&rr===0&&(c.mode&1)===0&&(ku=Pn()+500,kl&&Nt()))}function Ji(a,c){var _=a.callbackNode;Lr(a,c);var E=_a(a,a===xi?Mn:0);if(E===0)_!==null&&Zr(_),a.callbackNode=null,a.callbackPriority=0;else if(c=E&-E,a.callbackPriority!==c){if(_!=null&&Zr(_),c===1)a.tag===0?No(Pc.bind(null,a)):jo(Pc.bind(null,a)),gd(function(){(rr&6)===0&&Nt()}),_=null;else{switch(ss(E)){case 1:_=ys;break;case 4:_=Qs;break;case 16:_=Jo;break;case 536870912:_=Ua;break;default:_=Jo}_=Lh(_,Gp.bind(null,a))}a.callbackPriority=c,a.callbackNode=_}}function Gp(a,c){if(Ld=-1,Nh=0,(rr&6)!==0)throw Error(y(327));var _=a.callbackNode;if(Is()&&a.callbackNode!==_)return null;var E=_a(a,a===xi?Mn:0);if(E===0)return null;if((E&30)!==0||(E&a.expiredLanes)!==0||c)c=Dh(a,E);else{c=E;var N=rr;rr|=2;var O=Wp();(xi!==a||Mn!==c)&&(Na=null,ku=Pn()+500,Ic(a,c));do try{yg();break}catch(xe){hm(a,xe)}while(!0);Ie(),jl.current=O,rr=N,pn!==null?c=0:(xi=null,Mn=0,c=Yr)}if(c!==0){if(c===2&&(N=Ar(a),N!==0&&(E=N,c=Rd(a,N))),c===1)throw _=Tu,Ic(a,0),Dl(a,E),Ji(a,Pn()),_;if(c===6)Dl(a,E);else{if(N=a.current.alternate,(E&30)===0&&!um(N)&&(c=Dh(a,E),c===2&&(O=Ar(a),O!==0&&(E=O,c=Rd(a,O))),c===1))throw _=Tu,Ic(a,0),Dl(a,E),Ji(a,Pn()),_;switch(a.finishedWork=N,a.finishedLanes=E,c){case 0:case 1:throw Error(y(345));case 2:Rl(a,ds,Na);break;case 3:if(Dl(a,E),(E&130023424)===E&&(c=Ih+500-Pn(),10<c)){if(_a(a,0)!==0)break;if(N=a.suspendedLanes,(N&E)!==E){ps(),a.pingedLanes|=a.suspendedLanes&N;break}a.timeoutHandle=Ya(Rl.bind(null,a,ds,Na),c);break}Rl(a,ds,Na);break;case 4:if(Dl(a,E),(E&4194240)===E)break;for(c=a.eventTimes,N=-1;0<E;){var J=31-ni(E);O=1<<J,J=c[J],J>N&&(N=J),E&=~O}if(E=N,E=Pn()-E,E=(120>E?120:480>E?480:1080>E?1080:1920>E?1920:3e3>E?3e3:4320>E?4320:1960*mg(E/1960))-E,10<E){a.timeoutHandle=Ya(Rl.bind(null,a,ds,Na),E);break}Rl(a,ds,Na);break;case 5:Rl(a,ds,Na);break;default:throw Error(y(329))}}}return Ji(a,Pn()),a.callbackNode===_?Gp.bind(null,a):null}function Rd(a,c){var _=Cc;return a.current.memoizedState.isDehydrated&&(Ic(a,c).flags|=256),a=Dh(a,c),a!==2&&(c=ds,ds=_,c!==null&&Oo(c)),a}function Oo(a){ds===null?ds=a:ds.push.apply(ds,a)}function um(a){for(var c=a;;){if(c.flags&16384){var _=c.updateQueue;if(_!==null&&(_=_.stores,_!==null))for(var E=0;E<_.length;E++){var N=_[E],O=N.getSnapshot;N=N.value;try{if(!ks(O(),N))return!1}catch{return!1}}}if(_=c.child,c.subtreeFlags&16384&&_!==null)_.return=c,c=_;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Dl(a,c){for(c&=~Nl,c&=~Ph,a.suspendedLanes|=c,a.pingedLanes&=~c,a=a.expirationTimes;0<c;){var _=31-ni(c),E=1<<_;a[_]=-1,c&=~E}}function Pc(a){if((rr&6)!==0)throw Error(y(327));Is();var c=_a(a,0);if((c&1)===0)return Ji(a,Pn()),null;var _=Dh(a,c);if(a.tag!==0&&_===2){var E=Ar(a);E!==0&&(c=E,_=Rd(a,E))}if(_===1)throw _=Tu,Ic(a,0),Dl(a,c),Ji(a,Pn()),_;if(_===6)throw Error(y(345));return a.finishedWork=a.current.alternate,a.finishedLanes=c,Rl(a,ds,Na),Ji(a,Pn()),null}function Su(a,c){var _=rr;rr|=1;try{return a(c)}finally{rr=_,rr===0&&(ku=Pn()+500,kl&&Nt())}}function Ll(a){Da!==null&&Da.tag===0&&(rr&6)===0&&Is();var c=rr;rr|=1;var _=Ti.transition,E=Hr;try{if(Ti.transition=null,Hr=1,a)return a()}finally{Hr=E,Ti.transition=_,rr=c,(rr&6)===0&&Nt()}}function zd(){qn=Mi.current,vn(Mi)}function Ic(a,c){a.finishedWork=null,a.finishedLanes=0;var _=a.timeoutHandle;if(_!==-1&&(a.timeoutHandle=-1,mh(_)),pn!==null)for(_=pn.return;_!==null;){var E=_;switch(d(E),E.tag){case 1:E=E.type.childContextTypes,E!=null&&du();break;case 3:In(),vn(Xi),vn(bi),jn();break;case 5:Cs(E);break;case 4:In();break;case 13:vn(_r);break;case 19:vn(_r);break;case 10:Ve(E.type._context);break;case 22:case 23:zd()}_=_.return}if(xi=a,pn=a=zl(a.current,null),Mn=qn=c,Yr=0,Tu=null,Nl=Ph=Fn=0,ds=Cc=null,We!==null){for(c=0;c<We.length;c++)if(_=We[c],E=_.interleaved,E!==null){_.interleaved=null;var N=E.next,O=_.pending;if(O!==null){var J=O.next;O.next=N,E.next=J}_.pending=E}We=null}return a}function hm(a,c){do{var _=pn;try{if(Ie(),gi.current=Ri,Ms){for(var E=bn.memoizedState;E!==null;){var N=E.queue;N!==null&&(N.pending=null),E=E.next}Ms=!1}if(Hn=0,Bn=kn=bn=null,As=!1,$s=0,Nd.current=null,_===null||_.return===null){Yr=1,Tu=c,pn=null;break}e:{var O=a,J=_.return,xe=_,Pe=c;if(c=Mn,xe.flags|=32768,Pe!==null&&typeof Pe=="object"&&typeof Pe.then=="function"){var rt=Pe,At=xe,jt=At.tag;if((At.mode&1)===0&&(jt===0||jt===11||jt===15)){var Et=At.alternate;Et?(At.updateQueue=Et.updateQueue,At.memoizedState=Et.memoizedState,At.lanes=Et.lanes):(At.updateQueue=null,At.memoizedState=null)}var Xt=Td(J);if(Xt!==null){Xt.flags&=-257,Dp(Xt,J,xe,O,c),Xt.mode&1&&so(O,rt,c),c=Xt,Pe=rt;var nr=c.updateQueue;if(nr===null){var sr=new Set;sr.add(Pe),c.updateQueue=sr}else nr.add(Pe);break e}else{if((c&1)===0){so(O,rt,c),qp();break e}Pe=Error(y(426))}}else if(f&&xe.mode&1){var Jn=Td(J);if(Jn!==null){(Jn.flags&65536)===0&&(Jn.flags|=256),Dp(Jn,J,xe,O,c),re(Tc(Pe,xe));break e}}O=Pe=Tc(Pe,xe),Yr!==4&&(Yr=2),Cc===null?Cc=[O]:Cc.push(O),O=J;do{switch(O.tag){case 3:O.flags|=65536,c&=-c,O.lanes|=c;var Ze=gu(O,Pe,c);tr(O,Ze);break e;case 1:xe=Pe;var Ne=O.type,Ke=O.stateNode;if((O.flags&128)===0&&(typeof Ne.getDerivedStateFromError=="function"||Ke!==null&&typeof Ke.componentDidCatch=="function"&&(Yi===null||!Yi.has(Ke)))){O.flags|=65536,c&=-c,O.lanes|=c;var zt=kc(O,xe,c);tr(O,zt);break e}}O=O.return}while(O!==null)}Hp(_)}catch(ar){c=ar,pn===_&&_!==null&&(pn=_=_.return);continue}break}while(!0)}function Wp(){var a=jl.current;return jl.current=Ri,a===null?Ri:a}function qp(){(Yr===0||Yr===3||Yr===2)&&(Yr=4),xi===null||(Fn&268435455)===0&&(Ph&268435455)===0||Dl(xi,Mn)}function Dh(a,c){var _=rr;rr|=2;var E=Wp();(xi!==a||Mn!==c)&&(Na=null,Ic(a,c));do try{gg();break}catch(N){hm(a,N)}while(!0);if(Ie(),rr=_,jl.current=E,pn!==null)throw Error(y(261));return xi=null,Mn=0,Yr}function gg(){for(;pn!==null;)Zp(pn)}function yg(){for(;pn!==null&&!$u();)Zp(pn)}function Zp(a){var c=Bd(a.alternate,a,qn);a.memoizedProps=a.pendingProps,c===null?Hp(a):pn=c,Nd.current=null}function Hp(a){var c=a;do{var _=c.alternate;if(a=c.return,(c.flags&32768)===0){if(_=oo(_,c,qn),_!==null){pn=_;return}}else{if(_=pg(_,c),_!==null){_.flags&=32767,pn=_;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{Yr=6,pn=null;return}}if(c=c.sibling,c!==null){pn=c;return}pn=c=a}while(c!==null);Yr===0&&(Yr=5)}function Rl(a,c,_){var E=Hr,N=Ti.transition;try{Ti.transition=null,Hr=1,Xp(a,c,_,E)}finally{Ti.transition=N,Hr=E}return null}function Xp(a,c,_,E){do Is();while(Da!==null);if((rr&6)!==0)throw Error(y(327));_=a.finishedWork;var N=a.finishedLanes;if(_===null)return null;if(a.finishedWork=null,a.finishedLanes=0,_===a.current)throw Error(y(177));a.callbackNode=null,a.callbackPriority=0;var O=_.lanes|_.childLanes;if(is(a,O),a===xi&&(pn=xi=null,Mn=0),(_.subtreeFlags&2064)===0&&(_.flags&2064)===0||co||(co=!0,Lh(Jo,function(){return Is(),null})),O=(_.flags&15990)!==0,(_.subtreeFlags&15990)!==0||O){O=Ti.transition,Ti.transition=null;var J=Hr;Hr=1;var xe=rr;rr|=4,Nd.current=null,fg(a,_),Id(_,a),Ep(ou),nl=!!vl,ou=vl=null,a.current=_,wu(_),Xl(),rr=xe,Hr=J,Ti.transition=O}else a.current=_;if(co&&(co=!1,Da=a,Mc=N),O=a.pendingLanes,O===0&&(Yi=null),at(_.stateNode),Ji(a,Pn()),c!==null)for(E=a.onRecoverableError,_=0;_<c.length;_++)N=c[_],E(N.value,{componentStack:N.stack,digest:N.digest});if(jh)throw jh=!1,a=$p,$p=null,a;return(Mc&1)!==0&&a.tag!==0&&Is(),O=a.pendingLanes,(O&1)!==0?a===Dd?Ac++:(Ac=0,Dd=a):Ac=0,Nt(),null}function Is(){if(Da!==null){var a=ss(Mc),c=Ti.transition,_=Hr;try{if(Ti.transition=null,Hr=16>a?16:a,Da===null)var E=!1;else{if(a=Da,Da=null,Mc=0,(rr&6)!==0)throw Error(y(331));var N=rr;for(rr|=4,$t=a.current;$t!==null;){var O=$t,J=O.child;if(($t.flags&16)!==0){var xe=O.deletions;if(xe!==null){for(var Pe=0;Pe<xe.length;Pe++){var rt=xe[Pe];for($t=rt;$t!==null;){var At=$t;switch(At.tag){case 0:case 11:case 15:Ec(8,At,O)}var jt=At.child;if(jt!==null)jt.return=At,$t=jt;else for(;$t!==null;){At=$t;var Et=At.sibling,Xt=At.return;if(Bp(At),At===rt){$t=null;break}if(Et!==null){Et.return=Xt,$t=Et;break}$t=Xt}}}var nr=O.alternate;if(nr!==null){var sr=nr.child;if(sr!==null){nr.child=null;do{var Jn=sr.sibling;sr.sibling=null,sr=Jn}while(sr!==null)}}$t=O}}if((O.subtreeFlags&2064)!==0&&J!==null)J.return=O,$t=J;else e:for(;$t!==null;){if(O=$t,(O.flags&2048)!==0)switch(O.tag){case 0:case 11:case 15:Ec(9,O,O.return)}var Ze=O.sibling;if(Ze!==null){Ze.return=O.return,$t=Ze;break e}$t=O.return}}var Ne=a.current;for($t=Ne;$t!==null;){J=$t;var Ke=J.child;if((J.subtreeFlags&2064)!==0&&Ke!==null)Ke.return=J,$t=Ke;else e:for(J=Ne;$t!==null;){if(xe=$t,(xe.flags&2048)!==0)try{switch(xe.tag){case 0:case 11:case 15:Zs(9,xe)}}catch(ar){Yn(xe,xe.return,ar)}if(xe===J){$t=null;break e}var zt=xe.sibling;if(zt!==null){zt.return=xe.return,$t=zt;break e}$t=xe.return}}if(rr=N,Nt(),Vi&&typeof Vi.onPostCommitFiberRoot=="function")try{Vi.onPostCommitFiberRoot(xs,a)}catch{}E=!0}return E}finally{Hr=_,Ti.transition=c}}return!1}function fs(a,c,_){c=Tc(_,c),c=gu(a,c,1),a=or(a,c,1),c=ps(),a!==null&&(br(a,1,c),Ji(a,c))}function Yn(a,c,_){if(a.tag===3)fs(a,a,_);else for(;c!==null;){if(c.tag===3){fs(c,a,_);break}else if(c.tag===1){var E=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof E.componentDidCatch=="function"&&(Yi===null||!Yi.has(E))){a=Tc(_,a),a=kc(c,a,1),c=or(c,a,1),a=ps(),c!==null&&(br(c,1,a),Ji(c,a));break}}c=c.return}}function Kp(a,c,_){var E=a.pingCache;E!==null&&E.delete(c),c=ps(),a.pingedLanes|=a.suspendedLanes&_,xi===a&&(Mn&_)===_&&(Yr===4||Yr===3&&(Mn&130023424)===Mn&&500>Pn()-Ih?Ic(a,0):Nl|=_),Ji(a,c)}function dm(a,c){c===0&&((a.mode&1)===0?c=1:(c=Qo,Qo<<=1,(Qo&130023424)===0&&(Qo=4194304)));var _=ps();a=it(a,c),a!==null&&(br(a,c,_),Ji(a,_))}function xg(a){var c=a.memoizedState,_=0;c!==null&&(_=c.retryLane),dm(a,_)}function _g(a,c){var _=0;switch(a.tag){case 13:var E=a.stateNode,N=a.memoizedState;N!==null&&(_=N.retryLane);break;case 19:E=a.stateNode;break;default:throw Error(y(314))}E!==null&&E.delete(c),dm(a,_)}var Bd;Bd=function(a,c,_){if(a!==null)if(a.memoizedProps!==c.pendingProps||Xi.current)Ci=!0;else{if((a.lanes&_)===0&&(c.flags&128)===0)return Ci=!1,Eh(a,c,_);Ci=(a.flags&131072)!==0}else Ci=!1,f&&(c.flags&1048576)!==0&&pu(c,El,c.index);switch(c.lanes=0,c.tag){case 2:var E=c.type;Sh(a,c),a=c.pendingProps;var N=wi(c,bi.current);ze(c,_),N=xd(null,c,E,a,N,_);var O=_d();return c.flags|=1,typeof N=="object"&&N!==null&&typeof N.render=="function"&&N.$$typeof===void 0?(c.tag=1,c.memoizedState=null,c.updateQueue=null,Li(E)?(O=!0,oa(c)):O=!1,c.memoizedState=N.state!==null&&N.state!==void 0?N.state:null,pt(c),N.updater=Al,c.stateNode=N,N._reactInternals=c,wd(c,E,a,_),c=qs(null,c,E,!0,O,_)):(c.tag=0,f&&O&&to(c),Sn(null,c,N,_),c=c.child),c;case 16:E=c.elementType;e:{switch(Sh(a,c),a=c.pendingProps,N=E._init,E=N(E._payload),c.type=E,N=c.tag=vg(E),a=Gs(E,a),N){case 0:c=Sd(null,c,E,a,_);break e;case 1:c=xu(null,c,E,a,_);break e;case 11:c=yu(null,c,E,a,_);break e;case 14:c=zi(null,c,E,Gs(E.type,a),_);break e}throw Error(y(306,E,""))}return c;case 0:return E=c.type,N=c.pendingProps,N=c.elementType===E?N:Gs(E,N),Sd(a,c,E,N,_);case 1:return E=c.type,N=c.pendingProps,N=c.elementType===E?N:Gs(E,N),xu(a,c,E,N,_);case 3:e:{if(im(c),a===null)throw Error(y(387));E=c.pendingProps,O=c.memoizedState,N=O.element,vt(a,c),Sr(c,E,null,_);var J=c.memoizedState;if(E=J.element,O.isDehydrated)if(O={element:E,isDehydrated:!1,cache:J.cache,pendingSuspenseBoundaries:J.pendingSuspenseBoundaries,transitions:J.transitions},c.updateQueue.baseState=O,c.memoizedState=O,c.flags&256){N=Tc(Error(y(423)),c),c=sm(a,c,E,_,N);break e}else if(E!==N){N=Tc(Error(y(424)),c),c=sm(a,c,E,_,N);break e}else for(o=aa(c.stateNode.containerInfo.firstChild),n=c,f=!0,x=null,_=ue(c,null,E,_),c.child=_;_;)_.flags=_.flags&-3|4096,_=_.sibling;else{if(Q(),E===N){c=ao(a,c,_);break e}Sn(a,c,E,_)}c=c.child}return c;case 5:return us(c),a===null&&j(c),E=c.type,N=c.pendingProps,O=a!==null?a.memoizedProps:null,J=N.children,bl(E,N)?J=null:O!==null&&bl(E,O)&&(c.flags|=32),Nn(a,c),Sn(a,c,J,_),c.child;case 6:return a===null&&j(c),null;case 13:return Il(a,c,_);case 4:return mi(c,c.stateNode.containerInfo),E=c.pendingProps,a===null?c.child=le(c,null,E,_):Sn(a,c,E,_),c.child;case 11:return E=c.type,N=c.pendingProps,N=c.elementType===E?N:Gs(E,N),yu(a,c,E,N,_);case 7:return Sn(a,c,c.pendingProps,_),c.child;case 8:return Sn(a,c,c.pendingProps.children,_),c.child;case 12:return Sn(a,c,c.pendingProps.children,_),c.child;case 10:e:{if(E=c.type._context,N=c.pendingProps,O=c.memoizedProps,J=N.value,Rr(ke,E._currentValue),E._currentValue=J,O!==null)if(ks(O.value,J)){if(O.children===N.children&&!Xi.current){c=ao(a,c,_);break e}}else for(O=c.child,O!==null&&(O.return=c);O!==null;){var xe=O.dependencies;if(xe!==null){J=O.child;for(var Pe=xe.firstContext;Pe!==null;){if(Pe.context===E){if(O.tag===1){Pe=Wt(-1,_&-_),Pe.tag=2;var rt=O.updateQueue;if(rt!==null){rt=rt.shared;var At=rt.pending;At===null?Pe.next=Pe:(Pe.next=At.next,At.next=Pe),rt.pending=Pe}}O.lanes|=_,Pe=O.alternate,Pe!==null&&(Pe.lanes|=_),yt(O.return,_,c),xe.lanes|=_;break}Pe=Pe.next}}else if(O.tag===10)J=O.type===c.type?null:O.child;else if(O.tag===18){if(J=O.return,J===null)throw Error(y(341));J.lanes|=_,xe=J.alternate,xe!==null&&(xe.lanes|=_),yt(J,_,c),J=O.sibling}else J=O.child;if(J!==null)J.return=O;else for(J=O;J!==null;){if(J===c){J=null;break}if(O=J.sibling,O!==null){O.return=J.return,J=O;break}J=J.return}O=J}Sn(a,c,N.children,_),c=c.child}return c;case 9:return N=c.type,E=c.pendingProps.children,ze(c,_),N=nt(N),E=E(N),c.flags|=1,Sn(a,c,E,_),c.child;case 14:return E=c.type,N=Gs(E,c.pendingProps),N=Gs(E.type,N),zi(a,c,E,N,_);case 15:return Ws(a,c,c.type,c.pendingProps,_);case 17:return E=c.type,N=c.pendingProps,N=c.elementType===E?N:Gs(E,N),Sh(a,c),c.tag=1,Li(E)?(a=!0,oa(c)):a=!1,ze(c,_),bd(c,E,N),wd(c,E,N,_),qs(null,c,E,!0,a,_);case 19:return om(a,c,_);case 22:return kd(a,c,_)}throw Error(y(156,c.tag))};function Lh(a,c){return Vu(a,c)}function pm(a,c,_,E){this.tag=a,this.key=_,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=E,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ai(a,c,_,E){return new pm(a,c,_,E)}function jc(a){return a=a.prototype,!(!a||!a.isReactComponent)}function vg(a){if(typeof a=="function")return jc(a)?1:0;if(a!=null){if(a=a.$$typeof,a===tt)return 11;if(a===Mr)return 14}return 2}function zl(a,c){var _=a.alternate;return _===null?(_=Ai(a.tag,c,a.key,a.mode),_.elementType=a.elementType,_.type=a.type,_.stateNode=a.stateNode,_.alternate=a,a.alternate=_):(_.pendingProps=c,_.type=a.type,_.flags=0,_.subtreeFlags=0,_.deletions=null),_.flags=a.flags&14680064,_.childLanes=a.childLanes,_.lanes=a.lanes,_.child=a.child,_.memoizedProps=a.memoizedProps,_.memoizedState=a.memoizedState,_.updateQueue=a.updateQueue,c=a.dependencies,_.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},_.sibling=a.sibling,_.index=a.index,_.ref=a.ref,_}function Fd(a,c,_,E,N,O){var J=2;if(E=a,typeof a=="function")jc(a)&&(J=1);else if(typeof a=="string")J=5;else e:switch(a){case $e:return Nc(_.children,N,O,c);case Ge:J=8,N|=8;break;case Ye:return a=Ai(12,_,c,N|2),a.elementType=Ye,a.lanes=O,a;case ct:return a=Ai(13,_,c,N),a.elementType=ct,a.lanes=O,a;case Kt:return a=Ai(19,_,c,N),a.elementType=Kt,a.lanes=O,a;case Ht:return Od(_,N,O,c);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case ge:J=10;break e;case Pt:J=9;break e;case tt:J=11;break e;case Mr:J=14;break e;case Jt:J=16,E=null;break e}throw Error(y(130,a==null?a:typeof a,""))}return c=Ai(J,_,c,N),c.elementType=a,c.type=E,c.lanes=O,c}function Nc(a,c,_,E){return a=Ai(7,a,E,c),a.lanes=_,a}function Od(a,c,_,E){return a=Ai(22,a,E,c),a.elementType=Ht,a.lanes=_,a.stateNode={isHidden:!1},a}function Yp(a,c,_){return a=Ai(6,a,null,c),a.lanes=_,a}function Jp(a,c,_){return c=Ai(4,a.children!==null?a.children:[],a.key,c),c.lanes=_,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}function Qp(a,c,_,E,N){this.tag=c,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ns(0),this.expirationTimes=ns(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ns(0),this.identifierPrefix=E,this.onRecoverableError=N,this.mutableSourceEagerHydrationData=null}function ef(a,c,_,E,N,O,J,xe,Pe){return a=new Qp(a,c,_,xe,Pe),c===1?(c=1,O===!0&&(c|=8)):c=0,O=Ai(3,null,null,c),a.current=O,O.stateNode=a,O.memoizedState={element:E,isDehydrated:_,cache:null,transitions:null,pendingSuspenseBoundaries:null},pt(O),a}function Eu(a,c,_){var E=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ce,key:E==null?null:""+E,children:a,containerInfo:c,implementation:_}}function fm(a){if(!a)return Qa;a=a._reactInternals;e:{if(_n(a)!==a||a.tag!==1)throw Error(y(170));var c=a;do{switch(c.tag){case 3:c=c.stateNode.context;break e;case 1:if(Li(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break e}}c=c.return}while(c!==null);throw Error(y(171))}if(a.tag===1){var _=a.type;if(Li(_))return Us(a,_,c)}return c}function On(a,c,_,E,N,O,J,xe,Pe){return a=ef(_,E,!0,a,N,O,J,xe,Pe),a.context=fm(null),_=a.current,E=ps(),N=uo(_),O=Wt(E,N),O.callback=c??null,or(_,O,N),a.current.lanes=N,br(a,N,E),Ji(a,E),a}function Dc(a,c,_,E){var N=c.current,O=ps(),J=uo(N);return _=fm(_),c.context===null?c.context=_:c.pendingContext=_,c=Wt(O,J),c.payload={element:a},E=E===void 0?null:E,E!==null&&(c.callback=E),a=or(N,c,J),a!==null&&(La(a,N,J,O),Vt(a,N,J)),J}function Rh(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function zh(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var _=a.retryLane;a.retryLane=_!==0&&_<c?_:c}}function Cu(a,c){zh(a,c),(a=a.alternate)&&zh(a,c)}function Bh(){return null}var tf=typeof reportError=="function"?reportError:function(a){console.error(a)};function Ud(a){this._internalRoot=a}Bl.prototype.render=Ud.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(y(409));Dc(a,c,null,null)},Bl.prototype.unmount=Ud.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;Ll(function(){Dc(null,a,null,null)}),c[Os]=null}};function Bl(a){this._internalRoot=a}Bl.prototype.unstable_scheduleHydration=function(a){if(a){var c=tl();a={blockedOn:null,target:a,priority:c};for(var _=0;_<on.length&&c!==0&&c<on[_].priority;_++);on.splice(_,0,a),_===0&&qu(a)}};function Fh(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function Mu(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function Vd(){}function bg(a,c,_,E,N){if(N){if(typeof E=="function"){var O=E;E=function(){var rt=Rh(J);O.call(rt)}}var J=On(c,E,a,0,null,!1,!1,"",Vd);return a._reactRootContainer=J,a[Os]=J.current,ka(a.nodeType===8?a.parentNode:a),Ll(),J}for(;N=a.lastChild;)a.removeChild(N);if(typeof E=="function"){var xe=E;E=function(){var rt=Rh(Pe);xe.call(rt)}}var Pe=ef(a,0,!1,null,null,!1,!1,"",Vd);return a._reactRootContainer=Pe,a[Os]=Pe.current,ka(a.nodeType===8?a.parentNode:a),Ll(function(){Dc(c,Pe,_,E)}),Pe}function Oh(a,c,_,E,N){var O=_._reactRootContainer;if(O){var J=O;if(typeof N=="function"){var xe=N;N=function(){var Pe=Rh(J);xe.call(Pe)}}Dc(c,J,a,N)}else J=bg(_,c,a,N,E);return Rh(J)}dn=function(a){switch(a.tag){case 3:var c=a.stateNode;if(c.current.memoizedState.isDehydrated){var _=el(c.pendingLanes);_!==0&&(xo(c,_|1),Ji(c,Pn()),(rr&6)===0&&(ku=Pn()+500,Nt()))}break;case 13:Ll(function(){var E=it(a,1);if(E!==null){var N=ps();La(E,a,1,N)}}),Cu(a,1)}},qc=function(a){if(a.tag===13){var c=it(a,134217728);if(c!==null){var _=ps();La(c,a,134217728,_)}Cu(a,134217728)}},ea=function(a){if(a.tag===13){var c=uo(a),_=it(a,c);if(_!==null){var E=ps();La(_,a,c,E)}Cu(a,c)}},tl=function(){return Hr},rl=function(a,c){var _=Hr;try{return Hr=a,c()}finally{Hr=_}},pe=function(a,c,_){switch(c){case"input":if(sn(a,_),c=_.name,_.type==="radio"&&c!=null){for(_=a;_.parentNode;)_=_.parentNode;for(_=_.querySelectorAll("input[name="+JSON.stringify(""+c)+'][type="radio"]'),c=0;c<_.length;c++){var E=_[c];if(E!==a&&E.form===a.form){var N=uu(E);if(!N)throw Error(y(90));Yt(E),sn(E,N)}}}break;case"textarea":dr(a,_);break;case"select":c=_.value,c!=null&&gs(a,!!_.multiple,c,!1)}},Fe=Su,Re=Ll;var Uh={usingClientEntryPoint:!1,Events:[Tl,Po,uu,we,Ae,Su]},Vh={findFiberByHostInstance:Hi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},rf={bundleType:Vh.bundleType,version:Vh.version,rendererPackageName:Vh.rendererPackageName,rendererConfig:Vh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:dt.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=yo(a),a===null?null:a.stateNode},findFiberByHostInstance:Vh.findFiberByHostInstance||Bh,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $d=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$d.isDisabled&&$d.supportsFiber)try{xs=$d.inject(rf),Vi=$d}catch{}}return ma.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Uh,ma.createPortal=function(a,c){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Fh(c))throw Error(y(200));return Eu(a,c,null,_)},ma.createRoot=function(a,c){if(!Fh(a))throw Error(y(299));var _=!1,E="",N=tf;return c!=null&&(c.unstable_strictMode===!0&&(_=!0),c.identifierPrefix!==void 0&&(E=c.identifierPrefix),c.onRecoverableError!==void 0&&(N=c.onRecoverableError)),c=ef(a,1,!1,null,null,_,!1,E,N),a[Os]=c.current,ka(a.nodeType===8?a.parentNode:a),new Ud(c)},ma.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(y(188)):(a=Object.keys(a).join(","),Error(y(268,a)));return a=yo(c),a=a===null?null:a.stateNode,a},ma.flushSync=function(a){return Ll(a)},ma.hydrate=function(a,c,_){if(!Mu(c))throw Error(y(200));return Oh(null,a,c,!0,_)},ma.hydrateRoot=function(a,c,_){if(!Fh(a))throw Error(y(405));var E=_!=null&&_.hydratedSources||null,N=!1,O="",J=tf;if(_!=null&&(_.unstable_strictMode===!0&&(N=!0),_.identifierPrefix!==void 0&&(O=_.identifierPrefix),_.onRecoverableError!==void 0&&(J=_.onRecoverableError)),c=On(c,null,a,1,_??null,N,!1,O,J),a[Os]=c.current,ka(a),E)for(a=0;a<E.length;a++)_=E[a],N=_._getVersion,N=N(_._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[_,N]:c.mutableSourceEagerHydrationData.push(_,N);return new Bl(c)},ma.render=function(a,c,_){if(!Mu(c))throw Error(y(200));return Oh(null,a,c,!1,_)},ma.unmountComponentAtNode=function(a){if(!Mu(a))throw Error(y(40));return a._reactRootContainer?(Ll(function(){Oh(null,null,a,!1,function(){a._reactRootContainer=null,a[Os]=null})}),!0):!1},ma.unstable_batchedUpdates=Su,ma.unstable_renderSubtreeIntoContainer=function(a,c,_,E){if(!Mu(_))throw Error(y(200));if(a==null||a._reactInternals===void 0)throw Error(y(38));return Oh(a,c,_,!1,E)},ma.version="18.3.1-next-f1338f8080-20240426",ma}var C_;function i1(){if(C_)return ey.exports;C_=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(h){console.error(h)}}return u(),ey.exports=YT(),ey.exports}var M_;function JT(){if(M_)return Lm;M_=1;var u=i1();return Lm.createRoot=u.createRoot,Lm.hydrateRoot=u.hydrateRoot,Lm}var QT=JT();const ek=Yy(QT);/**
 * react-router v7.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var A_="popstate";function tk(u={}){function h(w,k){let{pathname:A,search:I,hash:B}=w.location;return Sy("",{pathname:A,search:I,hash:B},k.state&&k.state.usr||null,k.state&&k.state.key||"default")}function y(w,k){return typeof k=="string"?k:If(k)}return nk(h,y,null,u)}function ci(u,h){if(u===!1||u===null||typeof u>"u")throw new Error(h)}function Zl(u,h){if(!u){typeof console<"u"&&console.warn(h);try{throw new Error(h)}catch{}}}function rk(){return Math.random().toString(36).substring(2,10)}function P_(u,h){return{usr:u.state,key:u.key,idx:h}}function Sy(u,h,y=null,w){return{pathname:typeof u=="string"?u:u.pathname,search:"",hash:"",...typeof h=="string"?yp(h):h,state:y,key:h&&h.key||w||rk()}}function If({pathname:u="/",search:h="",hash:y=""}){return h&&h!=="?"&&(u+=h.charAt(0)==="?"?h:"?"+h),y&&y!=="#"&&(u+=y.charAt(0)==="#"?y:"#"+y),u}function yp(u){let h={};if(u){let y=u.indexOf("#");y>=0&&(h.hash=u.substring(y),u=u.substring(0,y));let w=u.indexOf("?");w>=0&&(h.search=u.substring(w),u=u.substring(0,w)),u&&(h.pathname=u)}return h}function nk(u,h,y,w={}){let{window:k=document.defaultView,v5Compat:A=!1}=w,I=k.history,B="POP",i=null,R=$();R==null&&(R=0,I.replaceState({...I.state,idx:R},""));function $(){return(I.state||{idx:null}).idx}function K(){B="POP";let Me=$(),Le=Me==null?null:Me-R;R=Me,i&&i({action:B,location:ye.location,delta:Le})}function Z(Me,Le){B="PUSH";let De=Sy(ye.location,Me,Le);R=$()+1;let Qe=P_(De,R),dt=ye.createHref(De);try{I.pushState(Qe,"",dt)}catch(St){if(St instanceof DOMException&&St.name==="DataCloneError")throw St;k.location.assign(dt)}A&&i&&i({action:B,location:ye.location,delta:1})}function he(Me,Le){B="REPLACE";let De=Sy(ye.location,Me,Le);R=$();let Qe=P_(De,R),dt=ye.createHref(De);I.replaceState(Qe,"",dt),A&&i&&i({action:B,location:ye.location,delta:0})}function Te(Me){return ik(Me)}let ye={get action(){return B},get location(){return u(k,I)},listen(Me){if(i)throw new Error("A history only accepts one active listener");return k.addEventListener(A_,K),i=Me,()=>{k.removeEventListener(A_,K),i=null}},createHref(Me){return h(k,Me)},createURL:Te,encodeLocation(Me){let Le=Te(Me);return{pathname:Le.pathname,search:Le.search,hash:Le.hash}},push:Z,replace:he,go(Me){return I.go(Me)}};return ye}function ik(u,h=!1){let y="http://localhost";typeof window<"u"&&(y=window.location.origin!=="null"?window.location.origin:window.location.href),ci(y,"No window.location.(origin|href) available to create URL");let w=typeof u=="string"?u:If(u);return w=w.replace(/ $/,"%20"),!h&&w.startsWith("//")&&(w=y+w),new URL(w,y)}function s1(u,h,y="/"){return sk(u,h,y,!1)}function sk(u,h,y,w){let k=typeof h=="string"?yp(h):h,A=Oc(k.pathname||"/",y);if(A==null)return null;let I=a1(u);ak(I);let B=null;for(let i=0;B==null&&i<I.length;++i){let R=yk(A);B=mk(I[i],R,w)}return B}function a1(u,h=[],y=[],w="",k=!1){let A=(I,B,i=k,R)=>{let $={relativePath:R===void 0?I.path||"":R,caseSensitive:I.caseSensitive===!0,childrenIndex:B,route:I};if($.relativePath.startsWith("/")){if(!$.relativePath.startsWith(w)&&i)return;ci($.relativePath.startsWith(w),`Absolute route path "${$.relativePath}" nested under path "${w}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),$.relativePath=$.relativePath.slice(w.length)}let K=zc([w,$.relativePath]),Z=y.concat($);I.children&&I.children.length>0&&(ci(I.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${K}".`),a1(I.children,h,Z,K,i)),!(I.path==null&&!I.index)&&h.push({path:K,score:pk(K,I.index),routesMeta:Z})};return u.forEach((I,B)=>{if(I.path===""||!I.path?.includes("?"))A(I,B);else for(let i of o1(I.path))A(I,B,!0,i)}),h}function o1(u){let h=u.split("/");if(h.length===0)return[];let[y,...w]=h,k=y.endsWith("?"),A=y.replace(/\?$/,"");if(w.length===0)return k?[A,""]:[A];let I=o1(w.join("/")),B=[];return B.push(...I.map(i=>i===""?A:[A,i].join("/"))),k&&B.push(...I),B.map(i=>u.startsWith("/")&&i===""?"/":i)}function ak(u){u.sort((h,y)=>h.score!==y.score?y.score-h.score:fk(h.routesMeta.map(w=>w.childrenIndex),y.routesMeta.map(w=>w.childrenIndex)))}var ok=/^:[\w-]+$/,lk=3,ck=2,uk=1,hk=10,dk=-2,I_=u=>u==="*";function pk(u,h){let y=u.split("/"),w=y.length;return y.some(I_)&&(w+=dk),h&&(w+=ck),y.filter(k=>!I_(k)).reduce((k,A)=>k+(ok.test(A)?lk:A===""?uk:hk),w)}function fk(u,h){return u.length===h.length&&u.slice(0,-1).every((w,k)=>w===h[k])?u[u.length-1]-h[h.length-1]:0}function mk(u,h,y=!1){let{routesMeta:w}=u,k={},A="/",I=[];for(let B=0;B<w.length;++B){let i=w[B],R=B===w.length-1,$=A==="/"?h:h.slice(A.length)||"/",K=Km({path:i.relativePath,caseSensitive:i.caseSensitive,end:R},$),Z=i.route;if(!K&&R&&y&&!w[w.length-1].route.index&&(K=Km({path:i.relativePath,caseSensitive:i.caseSensitive,end:!1},$)),!K)return null;Object.assign(k,K.params),I.push({params:k,pathname:zc([A,K.pathname]),pathnameBase:bk(zc([A,K.pathnameBase])),route:Z}),K.pathnameBase!=="/"&&(A=zc([A,K.pathnameBase]))}return I}function Km(u,h){typeof u=="string"&&(u={path:u,caseSensitive:!1,end:!0});let[y,w]=gk(u.path,u.caseSensitive,u.end),k=h.match(y);if(!k)return null;let A=k[0],I=A.replace(/(.)\/+$/,"$1"),B=k.slice(1);return{params:w.reduce((R,{paramName:$,isOptional:K},Z)=>{if($==="*"){let Te=B[Z]||"";I=A.slice(0,A.length-Te.length).replace(/(.)\/+$/,"$1")}const he=B[Z];return K&&!he?R[$]=void 0:R[$]=(he||"").replace(/%2F/g,"/"),R},{}),pathname:A,pathnameBase:I,pattern:u}}function gk(u,h=!1,y=!0){Zl(u==="*"||!u.endsWith("*")||u.endsWith("/*"),`Route path "${u}" will be treated as if it were "${u.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${u.replace(/\*$/,"/*")}".`);let w=[],k="^"+u.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(I,B,i)=>(w.push({paramName:B,isOptional:i!=null}),i?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return u.endsWith("*")?(w.push({paramName:"*"}),k+=u==="*"||u==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):y?k+="\\/*$":u!==""&&u!=="/"&&(k+="(?:(?=\\/|$))"),[new RegExp(k,h?void 0:"i"),w]}function yk(u){try{return u.split("/").map(h=>decodeURIComponent(h).replace(/\//g,"%2F")).join("/")}catch(h){return Zl(!1,`The URL path "${u}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${h}).`),u}}function Oc(u,h){if(h==="/")return u;if(!u.toLowerCase().startsWith(h.toLowerCase()))return null;let y=h.endsWith("/")?h.length-1:h.length,w=u.charAt(y);return w&&w!=="/"?null:u.slice(y)||"/"}function xk(u,h="/"){let{pathname:y,search:w="",hash:k=""}=typeof u=="string"?yp(u):u;return{pathname:y?y.startsWith("/")?y:_k(y,h):h,search:wk(w),hash:Tk(k)}}function _k(u,h){let y=h.replace(/\/+$/,"").split("/");return u.split("/").forEach(k=>{k===".."?y.length>1&&y.pop():k!=="."&&y.push(k)}),y.length>1?y.join("/"):"/"}function ny(u,h,y,w){return`Cannot include a '${u}' character in a manually specified \`to.${h}\` field [${JSON.stringify(w)}].  Please separate it out to the \`to.${y}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function vk(u){return u.filter((h,y)=>y===0||h.route.path&&h.route.path.length>0)}function l1(u){let h=vk(u);return h.map((y,w)=>w===h.length-1?y.pathname:y.pathnameBase)}function c1(u,h,y,w=!1){let k;typeof u=="string"?k=yp(u):(k={...u},ci(!k.pathname||!k.pathname.includes("?"),ny("?","pathname","search",k)),ci(!k.pathname||!k.pathname.includes("#"),ny("#","pathname","hash",k)),ci(!k.search||!k.search.includes("#"),ny("#","search","hash",k)));let A=u===""||k.pathname==="",I=A?"/":k.pathname,B;if(I==null)B=y;else{let K=h.length-1;if(!w&&I.startsWith("..")){let Z=I.split("/");for(;Z[0]==="..";)Z.shift(),K-=1;k.pathname=Z.join("/")}B=K>=0?h[K]:"/"}let i=xk(k,B),R=I&&I!=="/"&&I.endsWith("/"),$=(A||I===".")&&y.endsWith("/");return!i.pathname.endsWith("/")&&(R||$)&&(i.pathname+="/"),i}var zc=u=>u.join("/").replace(/\/\/+/g,"/"),bk=u=>u.replace(/\/+$/,"").replace(/^\/*/,"/"),wk=u=>!u||u==="?"?"":u.startsWith("?")?u:"?"+u,Tk=u=>!u||u==="#"?"":u.startsWith("#")?u:"#"+u;function kk(u){return u!=null&&typeof u.status=="number"&&typeof u.statusText=="string"&&typeof u.internal=="boolean"&&"data"in u}var u1=["POST","PUT","PATCH","DELETE"];new Set(u1);var Sk=["GET",...u1];new Set(Sk);var xp=H.createContext(null);xp.displayName="DataRouter";var ig=H.createContext(null);ig.displayName="DataRouterState";H.createContext(!1);var h1=H.createContext({isTransitioning:!1});h1.displayName="ViewTransition";var Ek=H.createContext(new Map);Ek.displayName="Fetchers";var Ck=H.createContext(null);Ck.displayName="Await";var Hl=H.createContext(null);Hl.displayName="Navigation";var Of=H.createContext(null);Of.displayName="Location";var Gc=H.createContext({outlet:null,matches:[],isDataRoute:!1});Gc.displayName="Route";var Qy=H.createContext(null);Qy.displayName="RouteError";function Mk(u,{relative:h}={}){ci(Uf(),"useHref() may be used only in the context of a <Router> component.");let{basename:y,navigator:w}=H.useContext(Hl),{hash:k,pathname:A,search:I}=Vf(u,{relative:h}),B=A;return y!=="/"&&(B=A==="/"?y:zc([y,A])),w.createHref({pathname:B,search:I,hash:k})}function Uf(){return H.useContext(Of)!=null}function Ou(){return ci(Uf(),"useLocation() may be used only in the context of a <Router> component."),H.useContext(Of).location}var d1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function p1(u){H.useContext(Hl).static||H.useLayoutEffect(u)}function _p(){let{isDataRoute:u}=H.useContext(Gc);return u?Uk():Ak()}function Ak(){ci(Uf(),"useNavigate() may be used only in the context of a <Router> component.");let u=H.useContext(xp),{basename:h,navigator:y}=H.useContext(Hl),{matches:w}=H.useContext(Gc),{pathname:k}=Ou(),A=JSON.stringify(l1(w)),I=H.useRef(!1);return p1(()=>{I.current=!0}),H.useCallback((i,R={})=>{if(Zl(I.current,d1),!I.current)return;if(typeof i=="number"){y.go(i);return}let $=c1(i,JSON.parse(A),k,R.relative==="path");u==null&&h!=="/"&&($.pathname=$.pathname==="/"?h:zc([h,$.pathname])),(R.replace?y.replace:y.push)($,R.state,R)},[h,y,A,k,u])}H.createContext(null);function Vf(u,{relative:h}={}){let{matches:y}=H.useContext(Gc),{pathname:w}=Ou(),k=JSON.stringify(l1(y));return H.useMemo(()=>c1(u,JSON.parse(k),w,h==="path"),[u,k,w,h])}function Pk(u,h){return f1(u,h)}function f1(u,h,y,w,k){ci(Uf(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:A}=H.useContext(Hl),{matches:I}=H.useContext(Gc),B=I[I.length-1],i=B?B.params:{},R=B?B.pathname:"/",$=B?B.pathnameBase:"/",K=B&&B.route;{let De=K&&K.path||"";m1(R,!K||De.endsWith("*")||De.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${R}" (under <Route path="${De}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${De}"> to <Route path="${De==="/"?"*":`${De}/*`}">.`)}let Z=Ou(),he;if(h){let De=typeof h=="string"?yp(h):h;ci($==="/"||De.pathname?.startsWith($),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${$}" but pathname "${De.pathname}" was given in the \`location\` prop.`),he=De}else he=Z;let Te=he.pathname||"/",ye=Te;if($!=="/"){let De=$.replace(/^\//,"").split("/");ye="/"+Te.replace(/^\//,"").split("/").slice(De.length).join("/")}let Me=s1(u,{pathname:ye});Zl(K||Me!=null,`No routes matched location "${he.pathname}${he.search}${he.hash}" `),Zl(Me==null||Me[Me.length-1].route.element!==void 0||Me[Me.length-1].route.Component!==void 0||Me[Me.length-1].route.lazy!==void 0,`Matched leaf route at location "${he.pathname}${he.search}${he.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Le=Lk(Me&&Me.map(De=>Object.assign({},De,{params:Object.assign({},i,De.params),pathname:zc([$,A.encodeLocation?A.encodeLocation(De.pathname).pathname:De.pathname]),pathnameBase:De.pathnameBase==="/"?$:zc([$,A.encodeLocation?A.encodeLocation(De.pathnameBase).pathname:De.pathnameBase])})),I,y,w,k);return h&&Le?H.createElement(Of.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...he},navigationType:"POP"}},Le):Le}function Ik(){let u=Ok(),h=kk(u)?`${u.status} ${u.statusText}`:u instanceof Error?u.message:JSON.stringify(u),y=u instanceof Error?u.stack:null,w="rgba(200,200,200, 0.5)",k={padding:"0.5rem",backgroundColor:w},A={padding:"2px 4px",backgroundColor:w},I=null;return console.error("Error handled by React Router default ErrorBoundary:",u),I=H.createElement(H.Fragment,null,H.createElement("p",null,"💿 Hey developer 👋"),H.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",H.createElement("code",{style:A},"ErrorBoundary")," or"," ",H.createElement("code",{style:A},"errorElement")," prop on your route.")),H.createElement(H.Fragment,null,H.createElement("h2",null,"Unexpected Application Error!"),H.createElement("h3",{style:{fontStyle:"italic"}},h),y?H.createElement("pre",{style:k},y):null,I)}var jk=H.createElement(Ik,null),Nk=class extends H.Component{constructor(u){super(u),this.state={location:u.location,revalidation:u.revalidation,error:u.error}}static getDerivedStateFromError(u){return{error:u}}static getDerivedStateFromProps(u,h){return h.location!==u.location||h.revalidation!=="idle"&&u.revalidation==="idle"?{error:u.error,location:u.location,revalidation:u.revalidation}:{error:u.error!==void 0?u.error:h.error,location:h.location,revalidation:u.revalidation||h.revalidation}}componentDidCatch(u,h){this.props.unstable_onError?this.props.unstable_onError(u,h):console.error("React Router caught the following error during render",u)}render(){return this.state.error!==void 0?H.createElement(Gc.Provider,{value:this.props.routeContext},H.createElement(Qy.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Dk({routeContext:u,match:h,children:y}){let w=H.useContext(xp);return w&&w.static&&w.staticContext&&(h.route.errorElement||h.route.ErrorBoundary)&&(w.staticContext._deepestRenderedBoundaryId=h.route.id),H.createElement(Gc.Provider,{value:u},y)}function Lk(u,h=[],y=null,w=null,k=null){if(u==null){if(!y)return null;if(y.errors)u=y.matches;else if(h.length===0&&!y.initialized&&y.matches.length>0)u=y.matches;else return null}let A=u,I=y?.errors;if(I!=null){let R=A.findIndex($=>$.route.id&&I?.[$.route.id]!==void 0);ci(R>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(I).join(",")}`),A=A.slice(0,Math.min(A.length,R+1))}let B=!1,i=-1;if(y)for(let R=0;R<A.length;R++){let $=A[R];if(($.route.HydrateFallback||$.route.hydrateFallbackElement)&&(i=R),$.route.id){let{loaderData:K,errors:Z}=y,he=$.route.loader&&!K.hasOwnProperty($.route.id)&&(!Z||Z[$.route.id]===void 0);if($.route.lazy||he){B=!0,i>=0?A=A.slice(0,i+1):A=[A[0]];break}}}return A.reduceRight((R,$,K)=>{let Z,he=!1,Te=null,ye=null;y&&(Z=I&&$.route.id?I[$.route.id]:void 0,Te=$.route.errorElement||jk,B&&(i<0&&K===0?(m1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),he=!0,ye=null):i===K&&(he=!0,ye=$.route.hydrateFallbackElement||null)));let Me=h.concat(A.slice(0,K+1)),Le=()=>{let De;return Z?De=Te:he?De=ye:$.route.Component?De=H.createElement($.route.Component,null):$.route.element?De=$.route.element:De=R,H.createElement(Dk,{match:$,routeContext:{outlet:R,matches:Me,isDataRoute:y!=null},children:De})};return y&&($.route.ErrorBoundary||$.route.errorElement||K===0)?H.createElement(Nk,{location:y.location,revalidation:y.revalidation,component:Te,error:Z,children:Le(),routeContext:{outlet:null,matches:Me,isDataRoute:!0},unstable_onError:w}):Le()},null)}function e0(u){return`${u} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Rk(u){let h=H.useContext(xp);return ci(h,e0(u)),h}function zk(u){let h=H.useContext(ig);return ci(h,e0(u)),h}function Bk(u){let h=H.useContext(Gc);return ci(h,e0(u)),h}function t0(u){let h=Bk(u),y=h.matches[h.matches.length-1];return ci(y.route.id,`${u} can only be used on routes that contain a unique "id"`),y.route.id}function Fk(){return t0("useRouteId")}function Ok(){let u=H.useContext(Qy),h=zk("useRouteError"),y=t0("useRouteError");return u!==void 0?u:h.errors?.[y]}function Uk(){let{router:u}=Rk("useNavigate"),h=t0("useNavigate"),y=H.useRef(!1);return p1(()=>{y.current=!0}),H.useCallback(async(k,A={})=>{Zl(y.current,d1),y.current&&(typeof k=="number"?u.navigate(k):await u.navigate(k,{fromRouteId:h,...A}))},[u,h])}var j_={};function m1(u,h,y){!h&&!j_[u]&&(j_[u]=!0,Zl(!1,y))}H.memo(Vk);function Vk({routes:u,future:h,state:y,unstable_onError:w}){return f1(u,void 0,y,w,h)}function Xs(u){ci(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function $k({basename:u="/",children:h=null,location:y,navigationType:w="POP",navigator:k,static:A=!1}){ci(!Uf(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let I=u.replace(/^\/*/,"/"),B=H.useMemo(()=>({basename:I,navigator:k,static:A,future:{}}),[I,k,A]);typeof y=="string"&&(y=yp(y));let{pathname:i="/",search:R="",hash:$="",state:K=null,key:Z="default"}=y,he=H.useMemo(()=>{let Te=Oc(i,I);return Te==null?null:{location:{pathname:Te,search:R,hash:$,state:K,key:Z},navigationType:w}},[I,i,R,$,K,Z,w]);return Zl(he!=null,`<Router basename="${I}"> is not able to match the URL "${i}${R}${$}" because it does not start with the basename, so the <Router> won't render anything.`),he==null?null:H.createElement(Hl.Provider,{value:B},H.createElement(Of.Provider,{children:h,value:he}))}function Gk({children:u,location:h}){return Pk(Ey(u),h)}function Ey(u,h=[]){let y=[];return H.Children.forEach(u,(w,k)=>{if(!H.isValidElement(w))return;let A=[...h,k];if(w.type===H.Fragment){y.push.apply(y,Ey(w.props.children,A));return}ci(w.type===Xs,`[${typeof w.type=="string"?w.type:w.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ci(!w.props.index||!w.props.children,"An index route cannot have child routes.");let I={id:w.props.id||A.join("-"),caseSensitive:w.props.caseSensitive,element:w.props.element,Component:w.props.Component,index:w.props.index,path:w.props.path,loader:w.props.loader,action:w.props.action,hydrateFallbackElement:w.props.hydrateFallbackElement,HydrateFallback:w.props.HydrateFallback,errorElement:w.props.errorElement,ErrorBoundary:w.props.ErrorBoundary,hasErrorBoundary:w.props.hasErrorBoundary===!0||w.props.ErrorBoundary!=null||w.props.errorElement!=null,shouldRevalidate:w.props.shouldRevalidate,handle:w.props.handle,lazy:w.props.lazy};w.props.children&&(I.children=Ey(w.props.children,A)),y.push(I)}),y}var Vm="get",$m="application/x-www-form-urlencoded";function sg(u){return u!=null&&typeof u.tagName=="string"}function Wk(u){return sg(u)&&u.tagName.toLowerCase()==="button"}function qk(u){return sg(u)&&u.tagName.toLowerCase()==="form"}function Zk(u){return sg(u)&&u.tagName.toLowerCase()==="input"}function Hk(u){return!!(u.metaKey||u.altKey||u.ctrlKey||u.shiftKey)}function Xk(u,h){return u.button===0&&(!h||h==="_self")&&!Hk(u)}var Rm=null;function Kk(){if(Rm===null)try{new FormData(document.createElement("form"),0),Rm=!1}catch{Rm=!0}return Rm}var Yk=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function iy(u){return u!=null&&!Yk.has(u)?(Zl(!1,`"${u}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${$m}"`),null):u}function Jk(u,h){let y,w,k,A,I;if(qk(u)){let B=u.getAttribute("action");w=B?Oc(B,h):null,y=u.getAttribute("method")||Vm,k=iy(u.getAttribute("enctype"))||$m,A=new FormData(u)}else if(Wk(u)||Zk(u)&&(u.type==="submit"||u.type==="image")){let B=u.form;if(B==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let i=u.getAttribute("formaction")||B.getAttribute("action");if(w=i?Oc(i,h):null,y=u.getAttribute("formmethod")||B.getAttribute("method")||Vm,k=iy(u.getAttribute("formenctype"))||iy(B.getAttribute("enctype"))||$m,A=new FormData(B,u),!Kk()){let{name:R,type:$,value:K}=u;if($==="image"){let Z=R?`${R}.`:"";A.append(`${Z}x`,"0"),A.append(`${Z}y`,"0")}else R&&A.append(R,K)}}else{if(sg(u))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');y=Vm,w=null,k=$m,I=u}return A&&k==="text/plain"&&(I=A,A=void 0),{action:w,method:y.toLowerCase(),encType:k,formData:A,body:I}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function r0(u,h){if(u===!1||u===null||typeof u>"u")throw new Error(h)}function Qk(u,h,y){let w=typeof u=="string"?new URL(u,typeof window>"u"?"server://singlefetch/":window.location.origin):u;return w.pathname==="/"?w.pathname=`_root.${y}`:h&&Oc(w.pathname,h)==="/"?w.pathname=`${h.replace(/\/$/,"")}/_root.${y}`:w.pathname=`${w.pathname.replace(/\/$/,"")}.${y}`,w}async function eS(u,h){if(u.id in h)return h[u.id];try{let y=await import(u.module);return h[u.id]=y,y}catch(y){return console.error(`Error loading route module \`${u.module}\`, reloading page...`),console.error(y),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function tS(u){return u==null?!1:u.href==null?u.rel==="preload"&&typeof u.imageSrcSet=="string"&&typeof u.imageSizes=="string":typeof u.rel=="string"&&typeof u.href=="string"}async function rS(u,h,y){let w=await Promise.all(u.map(async k=>{let A=h.routes[k.route.id];if(A){let I=await eS(A,y);return I.links?I.links():[]}return[]}));return aS(w.flat(1).filter(tS).filter(k=>k.rel==="stylesheet"||k.rel==="preload").map(k=>k.rel==="stylesheet"?{...k,rel:"prefetch",as:"style"}:{...k,rel:"prefetch"}))}function N_(u,h,y,w,k,A){let I=(i,R)=>y[R]?i.route.id!==y[R].route.id:!0,B=(i,R)=>y[R].pathname!==i.pathname||y[R].route.path?.endsWith("*")&&y[R].params["*"]!==i.params["*"];return A==="assets"?h.filter((i,R)=>I(i,R)||B(i,R)):A==="data"?h.filter((i,R)=>{let $=w.routes[i.route.id];if(!$||!$.hasLoader)return!1;if(I(i,R)||B(i,R))return!0;if(i.route.shouldRevalidate){let K=i.route.shouldRevalidate({currentUrl:new URL(k.pathname+k.search+k.hash,window.origin),currentParams:y[0]?.params||{},nextUrl:new URL(u,window.origin),nextParams:i.params,defaultShouldRevalidate:!0});if(typeof K=="boolean")return K}return!0}):[]}function nS(u,h,{includeHydrateFallback:y}={}){return iS(u.map(w=>{let k=h.routes[w.route.id];if(!k)return[];let A=[k.module];return k.clientActionModule&&(A=A.concat(k.clientActionModule)),k.clientLoaderModule&&(A=A.concat(k.clientLoaderModule)),y&&k.hydrateFallbackModule&&(A=A.concat(k.hydrateFallbackModule)),k.imports&&(A=A.concat(k.imports)),A}).flat(1))}function iS(u){return[...new Set(u)]}function sS(u){let h={},y=Object.keys(u).sort();for(let w of y)h[w]=u[w];return h}function aS(u,h){let y=new Set;return new Set(h),u.reduce((w,k)=>{let A=JSON.stringify(sS(k));return y.has(A)||(y.add(A),w.push({key:A,link:k})),w},[])}function g1(){let u=H.useContext(xp);return r0(u,"You must render this element inside a <DataRouterContext.Provider> element"),u}function oS(){let u=H.useContext(ig);return r0(u,"You must render this element inside a <DataRouterStateContext.Provider> element"),u}var n0=H.createContext(void 0);n0.displayName="FrameworkContext";function y1(){let u=H.useContext(n0);return r0(u,"You must render this element inside a <HydratedRouter> element"),u}function lS(u,h){let y=H.useContext(n0),[w,k]=H.useState(!1),[A,I]=H.useState(!1),{onFocus:B,onBlur:i,onMouseEnter:R,onMouseLeave:$,onTouchStart:K}=h,Z=H.useRef(null);H.useEffect(()=>{if(u==="render"&&I(!0),u==="viewport"){let ye=Le=>{Le.forEach(De=>{I(De.isIntersecting)})},Me=new IntersectionObserver(ye,{threshold:.5});return Z.current&&Me.observe(Z.current),()=>{Me.disconnect()}}},[u]),H.useEffect(()=>{if(w){let ye=setTimeout(()=>{I(!0)},100);return()=>{clearTimeout(ye)}}},[w]);let he=()=>{k(!0)},Te=()=>{k(!1),I(!1)};return y?u!=="intent"?[A,Z,{}]:[A,Z,{onFocus:wf(B,he),onBlur:wf(i,Te),onMouseEnter:wf(R,he),onMouseLeave:wf($,Te),onTouchStart:wf(K,he)}]:[!1,Z,{}]}function wf(u,h){return y=>{u&&u(y),y.defaultPrevented||h(y)}}function cS({page:u,...h}){let{router:y}=g1(),w=H.useMemo(()=>s1(y.routes,u,y.basename),[y.routes,u,y.basename]);return w?H.createElement(hS,{page:u,matches:w,...h}):null}function uS(u){let{manifest:h,routeModules:y}=y1(),[w,k]=H.useState([]);return H.useEffect(()=>{let A=!1;return rS(u,h,y).then(I=>{A||k(I)}),()=>{A=!0}},[u,h,y]),w}function hS({page:u,matches:h,...y}){let w=Ou(),{manifest:k,routeModules:A}=y1(),{basename:I}=g1(),{loaderData:B,matches:i}=oS(),R=H.useMemo(()=>N_(u,h,i,k,w,"data"),[u,h,i,k,w]),$=H.useMemo(()=>N_(u,h,i,k,w,"assets"),[u,h,i,k,w]),K=H.useMemo(()=>{if(u===w.pathname+w.search+w.hash)return[];let Te=new Set,ye=!1;if(h.forEach(Le=>{let De=k.routes[Le.route.id];!De||!De.hasLoader||(!R.some(Qe=>Qe.route.id===Le.route.id)&&Le.route.id in B&&A[Le.route.id]?.shouldRevalidate||De.hasClientLoader?ye=!0:Te.add(Le.route.id))}),Te.size===0)return[];let Me=Qk(u,I,"data");return ye&&Te.size>0&&Me.searchParams.set("_routes",h.filter(Le=>Te.has(Le.route.id)).map(Le=>Le.route.id).join(",")),[Me.pathname+Me.search]},[I,B,w,k,R,h,u,A]),Z=H.useMemo(()=>nS($,k),[$,k]),he=uS($);return H.createElement(H.Fragment,null,K.map(Te=>H.createElement("link",{key:Te,rel:"prefetch",as:"fetch",href:Te,...y})),Z.map(Te=>H.createElement("link",{key:Te,rel:"modulepreload",href:Te,...y})),he.map(({key:Te,link:ye})=>H.createElement("link",{key:Te,nonce:y.nonce,...ye})))}function dS(...u){return h=>{u.forEach(y=>{typeof y=="function"?y(h):y!=null&&(y.current=h)})}}var x1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{x1&&(window.__reactRouterVersion="7.8.2")}catch{}function pS({basename:u,children:h,window:y}){let w=H.useRef();w.current==null&&(w.current=tk({window:y,v5Compat:!0}));let k=w.current,[A,I]=H.useState({action:k.action,location:k.location}),B=H.useCallback(i=>{H.startTransition(()=>I(i))},[I]);return H.useLayoutEffect(()=>k.listen(B),[k,B]),H.createElement($k,{basename:u,children:h,location:A.location,navigationType:A.action,navigator:k})}var _1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,v1=H.forwardRef(function({onClick:h,discover:y="render",prefetch:w="none",relative:k,reloadDocument:A,replace:I,state:B,target:i,to:R,preventScrollReset:$,viewTransition:K,...Z},he){let{basename:Te}=H.useContext(Hl),ye=typeof R=="string"&&_1.test(R),Me,Le=!1;if(typeof R=="string"&&ye&&(Me=R,x1))try{let Ye=new URL(window.location.href),ge=R.startsWith("//")?new URL(Ye.protocol+R):new URL(R),Pt=Oc(ge.pathname,Te);ge.origin===Ye.origin&&Pt!=null?R=Pt+ge.search+ge.hash:Le=!0}catch{Zl(!1,`<Link to="${R}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let De=Mk(R,{relative:k}),[Qe,dt,St]=lS(w,Z),ce=gS(R,{replace:I,state:B,target:i,preventScrollReset:$,relative:k,viewTransition:K});function $e(Ye){h&&h(Ye),Ye.defaultPrevented||ce(Ye)}let Ge=H.createElement("a",{...Z,...St,href:Me||De,onClick:Le||A?h:$e,ref:dS(he,dt),target:i,"data-discover":!ye&&y==="render"?"true":void 0});return Qe&&!ye?H.createElement(H.Fragment,null,Ge,H.createElement(cS,{page:De})):Ge});v1.displayName="Link";var b1=H.forwardRef(function({"aria-current":h="page",caseSensitive:y=!1,className:w="",end:k=!1,style:A,to:I,viewTransition:B,children:i,...R},$){let K=Vf(I,{relative:R.relative}),Z=Ou(),he=H.useContext(ig),{navigator:Te,basename:ye}=H.useContext(Hl),Me=he!=null&&bS(K)&&B===!0,Le=Te.encodeLocation?Te.encodeLocation(K).pathname:K.pathname,De=Z.pathname,Qe=he&&he.navigation&&he.navigation.location?he.navigation.location.pathname:null;y||(De=De.toLowerCase(),Qe=Qe?Qe.toLowerCase():null,Le=Le.toLowerCase()),Qe&&ye&&(Qe=Oc(Qe,ye)||Qe);const dt=Le!=="/"&&Le.endsWith("/")?Le.length-1:Le.length;let St=De===Le||!k&&De.startsWith(Le)&&De.charAt(dt)==="/",ce=Qe!=null&&(Qe===Le||!k&&Qe.startsWith(Le)&&Qe.charAt(Le.length)==="/"),$e={isActive:St,isPending:ce,isTransitioning:Me},Ge=St?h:void 0,Ye;typeof w=="function"?Ye=w($e):Ye=[w,St?"active":null,ce?"pending":null,Me?"transitioning":null].filter(Boolean).join(" ");let ge=typeof A=="function"?A($e):A;return H.createElement(v1,{...R,"aria-current":Ge,className:Ye,ref:$,style:ge,to:I,viewTransition:B},typeof i=="function"?i($e):i)});b1.displayName="NavLink";var fS=H.forwardRef(({discover:u="render",fetcherKey:h,navigate:y,reloadDocument:w,replace:k,state:A,method:I=Vm,action:B,onSubmit:i,relative:R,preventScrollReset:$,viewTransition:K,...Z},he)=>{let Te=_S(),ye=vS(B,{relative:R}),Me=I.toLowerCase()==="get"?"get":"post",Le=typeof B=="string"&&_1.test(B),De=Qe=>{if(i&&i(Qe),Qe.defaultPrevented)return;Qe.preventDefault();let dt=Qe.nativeEvent.submitter,St=dt?.getAttribute("formmethod")||I;Te(dt||Qe.currentTarget,{fetcherKey:h,method:St,navigate:y,replace:k,state:A,relative:R,preventScrollReset:$,viewTransition:K})};return H.createElement("form",{ref:he,method:Me,action:ye,onSubmit:w?i:De,...Z,"data-discover":!Le&&u==="render"?"true":void 0})});fS.displayName="Form";function mS(u){return`${u} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function w1(u){let h=H.useContext(xp);return ci(h,mS(u)),h}function gS(u,{target:h,replace:y,state:w,preventScrollReset:k,relative:A,viewTransition:I}={}){let B=_p(),i=Ou(),R=Vf(u,{relative:A});return H.useCallback($=>{if(Xk($,h)){$.preventDefault();let K=y!==void 0?y:If(i)===If(R);B(u,{replace:K,state:w,preventScrollReset:k,relative:A,viewTransition:I})}},[i,B,R,y,w,h,u,k,A,I])}var yS=0,xS=()=>`__${String(++yS)}__`;function _S(){let{router:u}=w1("useSubmit"),{basename:h}=H.useContext(Hl),y=Fk();return H.useCallback(async(w,k={})=>{let{action:A,method:I,encType:B,formData:i,body:R}=Jk(w,h);if(k.navigate===!1){let $=k.fetcherKey||xS();await u.fetch($,y,k.action||A,{preventScrollReset:k.preventScrollReset,formData:i,body:R,formMethod:k.method||I,formEncType:k.encType||B,flushSync:k.flushSync})}else await u.navigate(k.action||A,{preventScrollReset:k.preventScrollReset,formData:i,body:R,formMethod:k.method||I,formEncType:k.encType||B,replace:k.replace,state:k.state,fromRouteId:y,flushSync:k.flushSync,viewTransition:k.viewTransition})},[u,h,y])}function vS(u,{relative:h}={}){let{basename:y}=H.useContext(Hl),w=H.useContext(Gc);ci(w,"useFormAction must be used inside a RouteContext");let[k]=w.matches.slice(-1),A={...Vf(u||".",{relative:h})},I=Ou();if(u==null){A.search=I.search;let B=new URLSearchParams(A.search),i=B.getAll("index");if(i.some($=>$==="")){B.delete("index"),i.filter(K=>K).forEach(K=>B.append("index",K));let $=B.toString();A.search=$?`?${$}`:""}}return(!u||u===".")&&k.route.index&&(A.search=A.search?A.search.replace(/^\?/,"?index&"):"?index"),y!=="/"&&(A.pathname=A.pathname==="/"?y:zc([y,A.pathname])),If(A)}function bS(u,{relative:h}={}){let y=H.useContext(h1);ci(y!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:w}=w1("useViewTransitionState"),k=Vf(u,{relative:h});if(!y.isTransitioning)return!1;let A=Oc(y.currentLocation.pathname,w)||y.currentLocation.pathname,I=Oc(y.nextLocation.pathname,w)||y.nextLocation.pathname;return Km(k.pathname,I)!=null||Km(k.pathname,A)!=null}var T1=i1();/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wS=u=>u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),k1=(...u)=>u.filter((h,y,w)=>!!h&&h.trim()!==""&&w.indexOf(h)===y).join(" ").trim();/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var TS={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kS=H.forwardRef(({color:u="currentColor",size:h=24,strokeWidth:y=2,absoluteStrokeWidth:w,className:k="",children:A,iconNode:I,...B},i)=>H.createElement("svg",{ref:i,...TS,width:h,height:h,stroke:u,strokeWidth:w?Number(y)*24/Number(h):y,className:k1("lucide",k),...B},[...I.map(([R,$])=>H.createElement(R,$)),...Array.isArray(A)?A:[A]]));/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=(u,h)=>{const y=H.forwardRef(({className:w,...k},A)=>H.createElement(kS,{ref:A,iconNode:h,className:k1(`lucide-${wS(u)}`,w),...k}));return y.displayName=`${u}`,y};/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SS=cr("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ES=cr("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CS=cr("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MS=cr("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AS=cr("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const up=cr("Bus",[["path",{d:"M8 6v6",key:"18i7km"}],["path",{d:"M15 6v6",key:"1sg6z9"}],["path",{d:"M2 12h19.6",key:"de5uta"}],["path",{d:"M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.4-.1-.8-.2-1.2l-1.4-5C20.1 6.8 19.1 6 18 6H4a2 2 0 0 0-2 2v10h3",key:"1wwztk"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M9 18h5",key:"lrx6i"}],["circle",{cx:"16",cy:"18",r:"2",key:"1v4tcr"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PS=cr("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IS=cr("CarFront",[["path",{d:"m21 8-2 2-1.5-3.7A2 2 0 0 0 15.646 5H8.4a2 2 0 0 0-1.903 1.257L5 10 3 8",key:"1imjwt"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 14h.01",key:"7oqj8z"}],["rect",{width:"18",height:"8",x:"3",y:"10",rx:"2",key:"a7itu8"}],["path",{d:"M5 18v2",key:"ppbyun"}],["path",{d:"M19 18v2",key:"gy7782"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jS=cr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i0=cr("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yh=cr("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cy=cr("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NS=cr("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const go=cr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DS=cr("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LS=cr("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RS=cr("Construction",[["rect",{x:"2",y:"6",width:"20",height:"8",rx:"1",key:"1estib"}],["path",{d:"M17 14v7",key:"7m2elx"}],["path",{d:"M7 14v7",key:"1cm7wv"}],["path",{d:"M17 3v3",key:"1v4jwn"}],["path",{d:"M7 3v3",key:"7o6guu"}],["path",{d:"M10 14 2.3 6.3",key:"1023jk"}],["path",{d:"m14 6 7.7 7.7",key:"1s8pl2"}],["path",{d:"m8 6 8 8",key:"hl96qh"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S1=cr("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zS=cr("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E1=cr("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s0=cr("Footprints",[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BS=cr("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FS=cr("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gm=cr("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OS=cr("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C1=cr("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M1=cr("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const US=cr("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VS=cr("Languages",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sy=cr("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const My=cr("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D_=cr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $S=cr("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a0=cr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GS=cr("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qi=cr("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o0=cr("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WS=cr("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qS=cr("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ym=cr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZS=cr("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uc=cr("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A1=cr("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HS=cr("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l0=cr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const td=cr("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P1=cr("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bc=cr("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hp=cr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jm=cr("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XS=cr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KS=cr("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I1=cr("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dp=cr("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YS=cr("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L_=cr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ag=cr("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JS=cr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jf=cr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QS=cr("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j1=cr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N1=cr("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);class eE extends n1.Component{constructor(h){super(h),this.state={hasError:!1,error:null}}static getDerivedStateFromError(h){return{hasError:!0,error:h}}componentDidCatch(h,y){console.error("Transit App Error:",h,y)}render(){return this.state.hasError?m.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:m.jsxs("div",{className:"max-w-md w-full glass-effect rounded-xl p-6 text-center",children:[m.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center",children:m.jsx(ag,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),m.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Something went wrong"}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"We're having trouble loading the transit data. Please try refreshing the page."}),m.jsxs("button",{onClick:()=>window.location.reload(),className:"btn-primary inline-flex items-center space-x-2",children:[m.jsx(td,{className:"w-4 h-4"}),m.jsx("span",{children:"Refresh Page"})]})]})}):this.props.children}}var Wm={exports:{}},tE=Wm.exports,R_;function rE(){return R_||(R_=1,(function(u,h){var y={ALLUSERSPROFILE:"C:\\ProgramData",ANDROID_SDK_ROOT:"C:\\Users\\DK\\AppData\\Local\\Android\\Sdk",APPDATA:"C:\\Users\\DK\\AppData\\Roaming",ChocolateyInstall:"C:\\ProgramData\\chocolatey",ChocolateyLastPathUpdate:"134009603195713645",COLOR:"1",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"DESKTOP-GKT5TG1",ComSpec:"C:\\WINDOWS\\system32\\cmd.exe",CURL_CA_BUNDLE:"C:\\Program Files\\PostgreSQL\\17\\ssl\\certs\\ca-bundle.crt",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EDITOR:"C:\\WINDOWS\\notepad.exe",EFC_15164_1262719628:"1",EFC_15164_1592913036:"1",EFC_15164_2283032206:"1",EFC_15164_2775293581:"1",EFC_15164_3789132940:"1",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GDAL_DATA:"C:\\Program Files\\PostgreSQL\\17\\gdal-data",HOME:"C:\\Users\\DK",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\DK",IGCCSVC_DB:"AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAA91WVuDPDmk+kgwcxL/CSmwQAAAACAAAAAAAQZgAAAAEAACAAAABf9GYnmTfhdV0P3u95zORhisnCpjH240/TlBGeInLgygAAAAAOgAAAAAIAACAAAABjZCZjCeCOmIpvBJkyJh8QmCm7VuqZ5b78lJUJSGtV1GAAAAAv3IIqG/iIK0zRuglW41eS5aHT8TH0ijVRg70hVeI7gUfflHQj0wlDlS31se30pdUf8uldMeJAiV+K9ExHg6El0J2GMwuW4Ufy3PqCrv5OD3IEhyvcaXfpSRRLWbOaZPJAAAAAd+y2NK8MnoTZiOGMGi0RnMisEEs/DZPqXd68qTmm6htOEyeTPLJHWpZ7iWx21v/l4t0FagkC93FNe4alD1W2yA==",INIT_CWD:"C:\\AddisTransit","IntelliJ IDEA":"C:\\Program Files\\JetBrains\\IntelliJ IDEA 2024.2\\bin;","IntelliJ IDEA Community Edition":"C:\\Program Files\\JetBrains\\IntelliJ IDEA Community Edition 2024.2.0.1\\bin;",INTEL_DEV_REDIST:"C:\\Program Files (x86)\\Common Files\\Intel\\Shared Libraries\\",Java:"C:\\Program Files\\Java\\jdk-15.0.1",LOCALAPPDATA:"C:\\Users\\DK\\AppData\\Local",LOGONSERVER:"\\\\DESKTOP-GKT5TG1",MIC_LD_LIBRARY_PATH:"C:\\Program Files (x86)\\Common Files\\Intel\\Shared Libraries\\compiler\\lib\\mic",NODE:"C:\\Program Files\\nodejs\\node.exe",NODE_ENV:"production",NODE_EXE:"C:\\Program Files\\nodejs\\\\node.exe",NPM_CLI_JS:"C:\\Program Files\\nodejs\\\\node_modules\\npm\\bin\\npm-cli.js",npm_command:"run-script",npm_config_cache:"C:\\Users\\DK\\AppData\\Local\\npm-cache",npm_config_globalconfig:"C:\\Users\\DK\\AppData\\Roaming\\npm\\etc\\npmrc",npm_config_global_prefix:"C:\\Users\\DK\\AppData\\Roaming\\npm",npm_config_init_module:"C:\\Users\\DK\\.npm-init.js",npm_config_local_prefix:"C:\\AddisTransit",npm_config_node_gyp:"C:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js",npm_config_noproxy:"",npm_config_npm_version:"10.8.2",npm_config_prefix:"C:\\Users\\DK\\AppData\\Roaming\\npm",npm_config_userconfig:"C:\\Users\\DK\\.npmrc",npm_config_user_agent:"npm/10.8.2 node/v20.19.4 win32 x64 workspaces/false",npm_execpath:"C:\\Program Files\\nodejs\\node_modules\\npm\\bin\\npm-cli.js",npm_lifecycle_event:"build",npm_lifecycle_script:"vite build",npm_node_execpath:"C:\\Program Files\\nodejs\\node.exe",npm_package_json:"C:\\AddisTransit\\package.json",npm_package_name:"my-v0-project",npm_package_version:"0.1.0",NPM_PREFIX_JS:"C:\\Program Files\\nodejs\\\\node_modules\\npm\\bin\\npm-prefix.js",NPM_PREFIX_NPM_CLI_JS:"C:\\Users\\DK\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npm-cli.js",NUMBER_OF_PROCESSORS:"8",OneDrive:"C:\\Users\\DK\\OneDrive",OPENSSL_CONF:"C:\\Program Files\\PostgreSQL\\psqlODBC\\etc\\openssl.cnf",OS:"Windows_NT",Path:"C:\\AddisTransit\\node_modules\\.bin;C:\\node_modules\\.bin;C:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Python313\\Scripts\\;C:\\Python313\\;C:\\Program Files (x86)\\Common Files\\Intel\\Shared Libraries\\redist\\intel64\\compiler;C:\\Users\\DK\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\python\\Scripts\\;C:\\Users\\DK\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\python\\;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Program Files\\dotnet\\;C:\\Program Files\\PostgreSQL\\16\\bin;C:\\Program Files\\PostgreSQL\\16\\lib;C:\\xampp\\php;C:\\Python;C:\\ProgramData\\ComposerSetup\\bin;C:\\Program Files\\OpenSSL-Win64\\bin;C:\\Program Files\\Git\\cmd;C:\\Program Files\\Git\\mingw64\\bin;C:\\Program Files\\Git\\usr\\bin;C:\\Program Files\\nodejs\\;C:\\ProgramData\\chocolatey\\bin;C:\\Program Files\\PowerShell\\7\\;C:\\ngrok\\;C:\\Program Files (x86)\\cloudflared\\;c:\\Users\\DK\\AppData\\Local\\Programs\\cursor\\resources\\app\\codeBin;C:\\Users\\DK\\AppData\\Local\\Programs\\Python\\Python312\\Scripts\\;C:\\Users\\DK\\AppData\\Local\\Programs\\Python\\Python312\\;C:\\Users\\DK\\AppData\\Local\\Programs\\Python\\Python311\\Scripts\\;C:\\Users\\DK\\AppData\\Local\\Programs\\Python\\Python311\\;C:\\Program Files\\MySQL\\MySQL Shell 8.0\\bin\\;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\Program Files\\Python311\\Scripts\\;C:\\Program Files\\Python311\\;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Program Files\\dotnet\\;C:\\Users\\DK\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\DK\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Program Files\\nodejs;C:\\Program Files\\JetBrains\\PyCharm 2024.1.1\\bin;;C:\\Users\\DK\\AppData\\Local\\JetBrains\\PyCharm Community Edition 2024.1.1\\bin;;C:\\Users\\DK\\AppData\\Roaming\\Composer\\vendor\\bin;C:\\Program Files\\JetBrains\\IntelliJ IDEA 2024.2\\bin;;C:\\Program Files\\JetBrains\\IntelliJ IDEA Community Edition 2024.2.0.1\\bin;;C:\\Users\\DK\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\DK\\AppData\\Local\\GitHubDesktop\\bin;C:\\Users\\DK\\AppData\\Roaming\\npm;C:\\Users\\DK\\AppData\\Local\\Programs\\cursor\\resources\\app\\bin",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.PY;.PYW",POSTGIS_ENABLE_OUTDB_RASTERS:"1",POSTGIS_GDAL_ENABLED_DRIVERS:"GTiff PNG JPEG GIF XYZ DTED USGSDEM AAIGrid",POWERSHELL_DISTRIBUTION_CHANNEL:"MSI:Windows 10 Home",POWERSHELL_TELEMETRY_OPTOUT:"1",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 140 Stepping 2, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"8c02",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROJ_LIB:"C:\\Program Files\\PostgreSQL\\17\\share\\contrib\\postgis-3.5\\proj",PROMPT:"$P$G",PSModulePath:"C:\\Program Files\\WindowsPowerShell\\Modules;C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",PyCharm:"C:\\Program Files\\JetBrains\\PyCharm 2024.1.1\\bin;","PyCharm Community Edition":"C:\\Users\\DK\\AppData\\Local\\JetBrains\\PyCharm Community Edition 2024.1.1\\bin;","Pyhton 3.12.2":"C:\\Users\\DK\\AppData\\Local\\Packages\\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\\LocalCache\\local-packages\\Python312\\Scripts",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\WINDOWS",TEMP:"C:\\Users\\DK\\AppData\\Local\\Temp",TMP:"C:\\Users\\DK\\AppData\\Local\\Temp",USERDOMAIN:"DESKTOP-GKT5TG1",USERDOMAIN_ROAMINGPROFILE:"DESKTOP-GKT5TG1",USERNAME:"DK",USERPROFILE:"C:\\Users\\DK",VITE_API_URL:"https://calculator-php-transition-paint.trycloudflare.com",windir:"C:\\WINDOWS",ZES_ENABLE_SYSMAN:"1"};(function(w,k){u.exports=k()})(tE,(function(){var w,k,A;function I(i,R){if(!w)w=R;else if(!k)k=R;else{var $="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+w+")(sharedChunk); ("+k+")(sharedChunk); self.onerror = null;",K={};w(K),A=R(K),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(A.workerUrl=window.URL.createObjectURL(new Blob([$],{type:"text/javascript"})))}}I(["exports"],(function(i){var R=typeof self<"u"?self:{},$="2.15.0";let K;const Z={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(K==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{K=y.API_URL_REGEX!=null?new RegExp(y.API_URL_REGEX):t}catch{K=t}}return K},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Z.API_URL)return null;try{const t=new URL(Z.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},he={supported:!1,testSupport:function(t){!Me&&ye&&(Le?De(t):Te=t)}};let Te,ye,Me=!1,Le=!1;function De(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ye),t.isContextLost())return;he.supported=!0}catch{}t.deleteTexture(e),Me=!0}R.document&&(ye=R.document.createElement("img"),ye.onload=function(){Te&&De(Te),Te=null,Le=!0},ye.onerror=function(){Me=!0,Te=null},ye.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Qe="01";function dt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var St=ce;function ce(t,e,r,s){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=r,this.p2y=s}ce.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var r=t,s=0;s<8;s++){var l=this.sampleCurveX(r)-t;if(Math.abs(l)<e)return r;var p=this.sampleCurveDerivativeX(r);if(Math.abs(p)<1e-6)break;r-=l/p}var g=0,v=1;for(r=t,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-t)<e));s++)t>l?g=r:v=r,r=.5*(v-g)+g;return r},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var $e=dt(St),Ge=Ye;function Ye(t,e){this.x=t,this.y=e}Ye.prototype={clone:function(){return new Ye(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(t,e){var r=Math.cos(t),s=Math.sin(t),l=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ye.convert=function(t){return t instanceof Ye?t:Array.isArray(t)?new Ye(t[0],t[1]):t};var ge=dt(Ge);const Pt=Math.PI/180,tt=180/Math.PI;function ct(t){return t*Pt}function Kt(t){return t*tt}const Mr=[[0,0],[1,0],[1,1],[0,1]];function Jt(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function Ht(t,e,r,s){const l=new $e(t,e,r,s);return function(p){return l.solve(p)}}const Tt=Ht(.25,.1,.25,1);function Be(t,e,r){return Math.min(r,Math.max(e,t))}function Je(t,e,r){return(r=Be((r-t)/(e-t),0,1))*r*(3-2*r)}function ve(t,e,r){const s=r-e,l=((t-e)%s+s)%s+e;return l===e?r:l}function et(t,e,r){if(!t.length)return r(null,[]);let s=t.length;const l=new Array(t.length);let p=null;t.forEach(((g,v)=>{e(g,((T,S)=>{T&&(p=T),l[v]=S,--s==0&&r(p,l)}))}))}function Ut(t){const e=[];for(const r in t)e.push(t[r]);return e}function Ot(t,...e){for(const r of e)for(const s in r)t[s]=r[s];return t}let pr=1;function lr(){return pr++}function zr(){return(function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)})()}function lt(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function hr(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function ir(t,e){t.forEach((r=>{e[r]&&(e[r]=e[r].bind(e))}))}function Vn(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Yt(t,e,r){const s={};for(const l in t)s[l]=e.call(this,t[l],l,t);return s}function ei(t,e,r){const s={};for(const l in t)e.call(r||this,t[l],l,t)&&(s[l]=t[l]);return s}function Rn(t){return Array.isArray(t)?t.map(Rn):typeof t=="object"&&t?Yt(t,Rn):t}const nn={};function Gr(t){nn[t]||(typeof console<"u"&&console.warn(t),nn[t]=!0)}function sn(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function za(t){let e=0;for(let r,s,l=0,p=t.length,g=p-1;l<p;g=l++)r=t[l],s=t[g],e+=(s.x-r.x)*(r.y+s.y);return e}function ts(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ti(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,s,l,p)=>{const g=l||p;return e[s]=!g||g.toLowerCase(),""})),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let gs=null;function Js(t){if(gs==null){const e=t.navigator?t.navigator.userAgent:null;gs=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return gs}function _t(t){try{const e=R[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function dr(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const Br="mapbox-tiles";let qt=500,An=50,Wr,ui;function En(){try{return R.caches}catch{}}function xn(){En()&&!Wr&&(Wr=R.caches.open(Br))}function Xo(t){const e=t.indexOf("?");if(e<0)return t;const r=(function(l){const p=l.indexOf("?");return p>0?l.slice(p+1).split("&"):[]})(t),s=r.filter((l=>{const p=l.split("=");return p[0]==="language"||p[0]==="worldview"}));return s.length?`${t.slice(0,e)}?${s.join("&")}`:t.slice(0,e)}let Ko=1/0;const Ba={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ba);class Fa extends Error{constructor(e,r,s){r===401&&Fe(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ya=ts()?()=>self.worker&&self.worker.referrer:()=>(R.location.protocol==="blob:"?R.parent:R).location.href,xa=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(ya())&&!/^\w+:/.test(r))){if(R.fetch&&R.Request&&R.AbortController&&R.Request.prototype.hasOwnProperty("signal"))return(function(s,l){const p=new R.AbortController,g=new R.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:ya(),referrerPolicy:s.referrerPolicy,signal:p.signal});let v=!1,T=!1;const S=(P=g.url).indexOf("sku=")>0&&Fe(P);var P;s.type==="json"&&g.headers.set("Accept","application/json");const D=(U,V,q)=>{if(T)return;if(U&&U.message!=="SecurityError"&&Gr(U.toString()),V&&q)return L(V);const ee=Date.now();R.fetch(g).then((ae=>{if(ae.ok){const me=S?ae.clone():null;return L(ae,me,ee)}return l(new Fa(ae.statusText,ae.status,s.url))})).catch((ae=>{ae.name!=="AbortError"&&l(new Error(`${ae.message} ${s.url}`))}))},L=(U,V,q)=>{(s.type==="arrayBuffer"?U.arrayBuffer():s.type==="json"?U.json():U.text()).then((ee=>{T||(V&&q&&(function(ae,me,oe){if(xn(),!Wr)return;const fe={status:me.status,statusText:me.statusText,headers:new R.Headers};me.headers.forEach(((qe,Oe)=>fe.headers.set(Oe,qe)));const be=ti(me.headers.get("Cache-Control")||"");if(be["no-store"])return;be["max-age"]&&fe.headers.set("Expires",new Date(oe+1e3*be["max-age"]).toUTCString());const _e=fe.headers.get("Expires");_e&&(new Date(_e).getTime()-oe<42e4||(function(qe,Oe){if(ui===void 0)try{new Response(new ReadableStream),ui=!0}catch{ui=!1}ui?Oe(qe.body):qe.blob().then(Oe)})(me,(qe=>{const Oe=new R.Response(qe,fe);xn(),Wr&&Wr.then((ot=>ot.put(Xo(ae.url),Oe))).catch((ot=>Gr(ot.message)))})))})(g,V,q),v=!0,l(null,ee,U.headers.get("Cache-Control"),U.headers.get("Expires")))})).catch((ee=>{T||l(new Error(ee.message))}))};return S?(function(U,V){if(xn(),!Wr)return V(null);const q=Xo(U.url);Wr.then((ee=>{ee.match(q).then((ae=>{const me=(function(oe){if(!oe)return!1;const fe=new Date(oe.headers.get("Expires")||0),be=ti(oe.headers.get("Cache-Control")||"");return fe>Date.now()&&!be["no-cache"]})(ae);ee.delete(q),me&&ee.put(q,ae.clone()),V(null,ae,me)})).catch(V)})).catch(V)})(g,D):D(null,null),{cancel:()=>{T=!0,v||p.abort()}}})(t,e);if(ts()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return(function(s,l){const p=new R.XMLHttpRequest;p.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const g in s.headers)p.setRequestHeader(g,s.headers[g]);return s.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=s.credentials==="include",p.onerror=()=>{l(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let g=p.response;if(s.type==="json")try{g=JSON.parse(p.response)}catch(v){return l(v)}l(null,g,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else l(new Fa(p.statusText,p.status,s.url))},p.send(s.body),{cancel:()=>p.abort()}})(t,e)},Oa=function(t,e){return xa(Ot(t,{type:"arrayBuffer"}),e)};function Yo(t){const e=R.document.createElement("a");return e.href=t,e.protocol===R.document.location.protocol&&e.host===R.document.location.host}const pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let X,Y;X=[],Y=0;const de=function(t,e){if(he.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Y>=Z.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return X.push(p),p}Y++;let r=!1;const s=()=>{if(!r)for(r=!0,Y--;X.length&&Y<Z.MAX_PARALLEL_IMAGE_REQUESTS;){const p=X.shift(),{requestParameters:g,callback:v,cancelled:T}=p;T||(p.cancel=de(g,v).cancel)}},l=Oa(t,((p,g,v,T)=>{s(),p?e(p):g&&(R.createImageBitmap?(function(S,P){const D=new R.Blob([new Uint8Array(S)],{type:"image/png"});R.createImageBitmap(D).then((L=>{P(null,L)})).catch((L=>{P(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(g,((S,P)=>e(S,P,v,T))):(function(S,P){const D=new R.Image,L=R.URL;D.onload=()=>{P(null,D),L.revokeObjectURL(D.src),D.onload=null,R.requestAnimationFrame((()=>{D.src=pe}))},D.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const U=new R.Blob([new Uint8Array(S)],{type:"image/png"});D.src=S.byteLength?L.createObjectURL(U):pe})(g,((S,P)=>e(S,P,v,T))))}));return{cancel:()=>{l.cancel(),s()}}},we="NO_ACCESS_TOKEN";function Ae(t){return t.indexOf("mapbox:")===0}function Fe(t){return Z.API_URL_REGEX.test(t)}function Re(t){return Z.API_CDN_URL_REGEX.test(t)}function Ce(t){return Z.API_STYLE_REGEX.test(t)&&!He(t)}function He(t){return Z.API_SPRITE_REGEX.test(t)}const kt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function It(t){const e=t.match(kt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function xt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const yr="mapbox.eventData";function xr(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(R.atob(e[1]).split("").map((r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch{return null}}class gr{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=xr(Z.ACCESS_TOKEN);let s="";return s=r&&r.u?R.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,((l,p)=>String.fromCharCode(+("0x"+p))))):Z.ACCESS_TOKEN||"",e?`${yr}.${e}:${s}`:`${yr}:${s}`}fetchEventData(){const e=_t("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const l=R.localStorage.getItem(r);l&&(this.eventData=JSON.parse(l));const p=R.localStorage.getItem(s);p&&(this.anonId=p)}catch{Gr("Unable to read from LocalStorage")}}saveEventData(){const e=_t("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{R.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&R.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Gr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,s,l){if(!Z.EVENTS_URL)return;const p=It(Z.EVENTS_URL);p.params.push(`access_token=${l||Z.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(e).toISOString()},v=r?Ot(g,r):g,T={url:xt(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=(function(S,P){return xa(Ot(S,{method:"POST"}),P)})(T,(S=>{this.pendingRequest=null,s(S),this.saveEventData(),this.processRequests(l)}))}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const vr=new class extends gr{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Z.EVENTS_URL&&Z.ACCESS_TOKEN&&Array.isArray(t)&&t.some((r=>Ae(r)||Fe(r)))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=xr(Z.ACCESS_TOKEN),r=e?e.u:Z.ACCESS_TOKEN;let s=r!==this.eventData.tokenU;hr(this.anonId)||(this.anonId=zr(),s=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),g=new Date(l),v=(l-this.eventData.lastSuccess)/864e5;s=s||v>=1||v<-1||p.getDate()!==g.getDate()}else s=!0;s?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:$,skuId:Qe,"enabled.telemetry":!1,userId:this.anonId},(p=>{p||(this.eventData.lastSuccess=l,this.eventData.tokenU=r)}),t):this.processRequests()}},Nr=vr.postTurnstileEvent.bind(vr),Tn=new class extends gr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,s){this.skuToken=e,this.errorCb=s,Z.EVENTS_URL&&(r||Z.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(we)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),hr(this.anonId)||(this.anonId=zr()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:$,skuId:Qe,skuToken:this.skuToken,userId:this.anonId},(s=>{s?this.errorCb(s):e&&(this.success[e]=!0)}),t))}},$n=Tn.postMapLoadEvent.bind(Tn),Si=new class extends gr{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Z.EVENTS_URL&&(t||Z.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:r}=this.queue.shift(),s=(function(l){const p=R.performance.getEntriesByType("resource"),g=R.performance.getEntriesByType("mark"),v=(function(L){const U={};if(L){for(const V in L)if(V!=="other")for(const q of L[V]){const ee=`${V}ResolveRangeMin`,ae=`${V}ResolveRangeMax`,me=`${V}RequestCount`,oe=`${V}RequestCachedCount`;U[ee]=Math.min(U[ee]||1/0,q.startTime),U[ae]=Math.max(U[ae]||-1/0,q.responseEnd);const fe=be=>{U[be]===void 0&&(U[be]=0),++U[be]};q.transferSize!==void 0&&q.transferSize===0&&fe(oe),fe(me)}}return U})((function(L,U){const V={};if(L)for(const q of L){const ee=U(q);V[ee]===void 0&&(V[ee]=[]),V[ee].push(q)}return V})(p,Vu)),T=R.devicePixelRatio,S=R.navigator.connection||R.navigator.mozConnection||R.navigator.webkitConnection,P={counters:[],metadata:[],attributes:[]},D=(L,U,V)=>{V!=null&&L.push({name:U,value:V.toString()})};for(const L in v)D(P.counters,L,v[L]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(D(P.counters,"interactionRangeMin",l.interactionRange[0]),D(P.counters,"interactionRangeMax",l.interactionRange[1])),g)for(const L of Object.keys(yo)){const U=yo[L],V=g.find((q=>q.name===U));V&&D(P.counters,U,V.startTime)}return D(P.counters,"visibilityHidden",l.visibilityHidden),D(P.attributes,"style",(function(L){if(L)for(const U of L){const V=U.name.split("?")[0];if(Ce(V)){const q=V.split("/").slice(-2);if(q.length===2)return`mapbox://styles/${q[0]}/${q[1]}`}}})(p)),D(P.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),D(P.attributes,"fogEnabled",l.fogEnabled?"true":"false"),D(P.attributes,"projection",l.projection),D(P.attributes,"zoom",l.zoom),D(P.metadata,"devicePixelRatio",T),D(P.metadata,"connectionEffectiveType",S?S.effectiveType:void 0),D(P.metadata,"navigatorUserAgent",R.navigator.userAgent),D(P.metadata,"screenWidth",R.screen.width),D(P.metadata,"screenHeight",R.screen.height),D(P.metadata,"windowWidth",R.innerWidth),D(P.metadata,"windowHeight",R.innerHeight),D(P.metadata,"mapWidth",l.width/T),D(P.metadata,"mapHeight",l.height/T),D(P.metadata,"webglRenderer",l.renderer),D(P.metadata,"webglVendor",l.vendor),D(P.metadata,"sdkVersion",$),D(P.metadata,"sdkIdentifier","mapbox-gl-js"),P})(r);for(const l of s.metadata);for(const l of s.counters);for(const l of s.attributes);this.postEvent(e,s,(()=>{}),t)}},_n=Si.postPerformanceEvent.bind(Si),Rs=new class extends gr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,s){if(!Z.API_URL||!Z.SESSION_PATH)return;const l=It(Z.API_URL+Z.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${s||Z.ACCESS_TOKEN||""}`);const p={url:xt(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=(function(g,v){return xa(Ot(g,{method:"GET"}),v)})(p,(g=>{this.pendingRequest=null,r(g),this.saveEventData(),this.processRequests(s)}))}getSessionAPI(t,e,r,s){this.skuToken=e,this.errorCb=s,Z.SESSION_PATH&&Z.API_URL&&(r||Z.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(we)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,(s=>{s?this.errorCb(s):e&&(this.success[e]=!0)}),t)}},ri=Rs.getSessionAPI.bind(Rs),Di=new Set,yo={create:"create",load:"load",fullLoad:"fullLoad"},rd={mark(t){R.performance.mark(t)},measure(t,e,r){R.performance.measure(t,e,r)}};function Vu(t){const e=t.name.split("?")[0];return Re(e)&&e.includes("mapbox-gl.js")?"javascript":Re(e)&&e.includes("mapbox-gl.css")?"css":(function(r){return Z.API_FONTS_REGEX.test(r)})(e)?"fontRange":He(e)?"sprite":Ce(e)?"style":(function(r){return Z.API_TILEJSON_REGEX.test(r)})(e)?"tilejson":"other"}const Zr=R.performance;function $u(t){const e=t?t.url.toString():void 0;return Zr.getEntriesByName(e)}let Xl,Pn,Wc,ys;const Qs={now:()=>Wc!==void 0?Wc:R.performance.now(),setNow(t){Wc=t},restoreNow(){Wc=void 0},frame(t){const e=R.requestAnimationFrame(t);return{cancel:()=>R.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:r,height:s}=t;ys||(ys=R.document.createElement("canvas"));const l=ys.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(r>ys.width||s>ys.height)&&(ys.width=r,ys.height=s),l.clearRect(-e,-e,r+2*e,s+2*e),l.drawImage(t,0,0,r,s),l.getImageData(-e,-e,r+2*e,s+2*e)},resolveURL:t=>(Xl||(Xl=R.document.createElement("a")),Xl.href=t,Xl.href),get devicePixelRatio(){return R.devicePixelRatio},get prefersReducedMotion(){return!!R.matchMedia&&(Pn==null&&(Pn=R.matchMedia("(prefers-reduced-motion: reduce)")),Pn.matches)}};function Jo(t,e,r){r[t]&&r[t].indexOf(e)!==-1||(r[t]=r[t]||[],r[t].push(e))}function Gu(t,e,r){if(r&&r[t]){const s=r[t].indexOf(e);s!==-1&&r[t].splice(s,1)}}class Ua{constructor(e,r={}){Ot(this,r),this.type=e}}class xs extends Ua{constructor(e,r={}){super("error",Ot({error:e},r))}}class Vi{on(e,r){return this._listeners=this._listeners||{},Jo(e,r,this._listeners),this}off(e,r){return Gu(e,r,this._listeners),Gu(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Jo(e,r,this._oneTimeListeners),this):new Promise((s=>this.once(e,s)))}fire(e,r){typeof e=="string"&&(e=new Ua(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const v of l)v.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const v of p)Gu(s,v,this._oneTimeListeners),v.call(this,e);const g=this._eventedParent;g&&(Ot(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof xs&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var at=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ni(t,...e){for(const r of e)for(const s in r)t[s]=r[s];return t}function Gn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function hi(t){if(Array.isArray(t))return t.map(hi);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=hi(t[r]);return e}return Gn(t)}class nd extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var rs=nd;class Qo{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,l]of r)this.bindings[s]=l}concat(e){return new Qo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var el=Qo;const _a={kind:"null"},Bt={kind:"number"},Lr={kind:"string"},Ar={kind:"boolean"},$i={kind:"color"},ns={kind:"object"},br={kind:"value"},is={kind:"collator"},xo={kind:"formatted"},Hr={kind:"resolvedImage"};function ss(t,e){return{kind:"array",itemType:t,N:e}}function dn(t){if(t.kind==="array"){const e=dn(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const qc=[_a,Bt,Lr,Ar,$i,xo,ns,ss(br),Hr];function ea(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ea(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const r of qc)if(!ea(r,e))return null}}return`Expected ${dn(t)} but found ${dn(e)} instead.`}function tl(t,e){return e.some((r=>r.kind===t.kind))}function rl(t,e){return e.some((r=>r==="null"?t===null:r==="array"?Array.isArray(t):r==="object"?t&&!Array.isArray(t)&&typeof t=="object":r===typeof t))}var Kl,Yl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function _s(t){return(t=Math.round(t))<0?0:t>255?255:t}function vs(t){return _s(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function zs(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function ta(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{Kl={}.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in Yl)return Yl[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=r.indexOf("("),l=r.indexOf(")");if(s!==-1&&l+1===r.length){var p=r.substr(0,s),g=r.substr(s+1,l-(s+1)).split(","),v=1;switch(p){case"rgba":if(g.length!==4)return null;v=zs(g.pop());case"rgb":return g.length!==3?null:[vs(g[0]),vs(g[1]),vs(g[2]),v];case"hsla":if(g.length!==4)return null;v=zs(g.pop());case"hsl":if(g.length!==3)return null;var T=(parseFloat(g[0])%360+360)%360/360,S=zs(g[1]),P=zs(g[2]),D=P<=.5?P*(S+1):P+S-P*S,L=2*P-D;return[_s(255*ta(L,D,T+1/3)),_s(255*ta(L,D,T)),_s(255*ta(L,D,T-1/3)),v];default:return null}}return null}}catch{}class di{constructor(e,r,s,l=1){this.r=e,this.g=r,this.b=s,this.a=l}static parse(e){if(!e)return;if(e instanceof di)return e;if(typeof e!="string")return;const r=Kl(e);return r?new di(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,s,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(s)},${l})`}toArray(){const{r:e,g:r,b:s,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*r/l,255*s/l,l]}toArray01(){const{r:e,g:r,b:s,a:l}=this;return l===0?[0,0,0,0]:[e/l,r/l,s/l,l]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:s,a:l}=this;return[e,r,s,l]}}di.black=new di(0,0,0,1),di.white=new di(1,1,1,1),di.transparent=new di(0,0,0,0),di.red=new di(1,0,0,1),di.blue=new di(0,0,1,1);var on=di;class Wu{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Zc{constructor(e,r,s,l,p){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=s,this.fontStack=l,this.textColor=p}}class pi{constructor(e){this.sections=e}static fromString(e){return new pi([new Zc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof pi?e:pi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const s={};r.fontStack&&(s["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(s["font-scale"]=r.scale),r.textColor&&(s["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(s)}return e}}class bs{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new bs({name:e,available:!1}):null}serialize(){return["image",this.name]}}function qu(t,e,r,s){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[t,e,r,s]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Va(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof on||t instanceof Wu||t instanceof pi||t instanceof bs)return!0;if(Array.isArray(t)){for(const e of t)if(!Va(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Va(t[e]))return!1;return!0}return!1}function Cn(t){if(t===null)return _a;if(typeof t=="string")return Lr;if(typeof t=="boolean")return Ar;if(typeof t=="number")return Bt;if(t instanceof on)return $i;if(t instanceof Wu)return is;if(t instanceof pi)return xo;if(t instanceof bs)return Hr;if(Array.isArray(t)){const e=t.length;let r;for(const s of t){const l=Cn(s);if(r){if(r===l)continue;r=br;break}r=l}return ss(r||br,e)}return ns}function Jl(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof on||t instanceof pi||t instanceof bs?t.toString():JSON.stringify(t)}class _o{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Va(e[1]))return r.error("invalid value");const s=e[1];let l=Cn(s);const p=r.expectedType;return l.kind!=="array"||l.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(l=p),new _o(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof on?["rgba"].concat(this.value.toArray()):this.value instanceof pi?this.value.serialize():this.value}}var Bs=_o,zn=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const nl={string:Lr,number:Bt,boolean:Ar,object:ns};class Zu{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,l=1;const p=e[0];if(p==="array"){let v,T;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in nl)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=nl[S],l++}else v=br;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);T=e[2],l++}s=ss(v,T)}else s=nl[p];const g=[];for(;l<e.length;l++){const v=r.parse(e[l],l,br);if(!v)return null;g.push(v)}return new Zu(s,g)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!ea(this.type,Cn(s)))return s;if(r===this.args.length-1)throw new zn(`Expected value to be of type ${dn(this.type)}, but found ${dn(Cn(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){r.push(s.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&r.push(l)}}return r.concat(this.args.map((s=>s.serialize())))}}var va=Zu;class ra{constructor(e){this.type=xo,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const l=[];let p=!1;for(let g=1;g<=e.length-1;++g){const v=e[g];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let T=null;if(v["font-scale"]&&(T=r.parse(v["font-scale"],1,Bt),!T))return null;let S=null;if(v["text-font"]&&(S=r.parse(v["text-font"],1,ss(Lr)),!S))return null;let P=null;if(v["text-color"]&&(P=r.parse(v["text-color"],1,$i),!P))return null;const D=l[l.length-1];D.scale=T,D.font=S,D.textColor=P}else{const T=r.parse(e[g],1,br);if(!T)return null;const S=T.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,l.push({content:T,scale:null,font:null,textColor:null})}}return new ra(l)}evaluate(e){return new pi(this.sections.map((r=>{const s=r.content.evaluate(e);return Cn(s)===Hr?new Zc("",s,null,null,null):new Zc(Jl(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)})))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const s={};r.scale&&(s["font-scale"]=r.scale.serialize()),r.font&&(s["text-font"]=r.font.serialize()),r.textColor&&(s["text-color"]=r.textColor.serialize()),e.push(s)}return e}}class vo{constructor(e){this.type=Hr,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Lr);return s?new vo(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=bs.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Hu={"to-boolean":Ar,"to-color":$i,"to-number":Bt,"to-string":Lr};class Hc{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const l=Hu[s],p=[];for(let g=1;g<e.length;g++){const v=r.parse(e[g],g,br);if(!v)return null;p.push(v)}return new Hc(l,p)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,s;for(const l of this.args){if(r=l.evaluate(e),s=null,r instanceof on)return r;if(typeof r=="string"){const p=e.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:qu(r[0],r[1],r[2],r[3]),!s))return new on(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new zn(s||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new zn(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?pi.fromString(Jl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?bs.fromString(Jl(this.args[0].evaluate(e))):Jl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new ra([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new vo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((r=>{e.push(r.serialize())})),e}}var as=Hc;const ws=["Unknown","Point","LineString","Polygon"];var il=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ws[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-t[0])+this.featureDistanceData.bearing[1]*(s*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=on.parse(t)),e}};class $a{constructor(e,r,s,l){this.name=e,this.type=r,this._evaluate=s,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,r){const s=e[0],l=$a.definitions[s];if(!l)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(l)?l[0]:l.type,g=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,v=g.filter((([S])=>!Array.isArray(S)||S.length===e.length-1));let T=null;for(const[S,P]of v){T=new Ju(r.registry,r.path,null,r.scope);const D=[];let L=!1;for(let U=1;U<e.length;U++){const V=e[U],q=Array.isArray(S)?S[U-1]:S.type,ee=T.parse(V,1+D.length,q);if(!ee){L=!0;break}D.push(ee)}if(!L)if(Array.isArray(S)&&S.length!==D.length)T.error(`Expected ${S.length} arguments, but found ${D.length} instead.`);else{for(let U=0;U<D.length;U++){const V=Array.isArray(S)?S[U]:S.type,q=D[U];T.concat(U+1).checkSubtype(V,q.type)}if(T.errors.length===0)return new $a(s,p,P,D)}}if(v.length===1)r.errors.push(...T.errors);else{const S=(v.length?v:g).map((([D])=>{return L=D,Array.isArray(L)?`(${L.map(dn).join(", ")})`:`(${dn(L.type)}...)`;var L})).join(" | "),P=[];for(let D=1;D<e.length;D++){const L=r.parse(e[D],1+P.length);if(!L)return null;P.push(dn(L.type))}r.error(`Expected arguments of type ${S}, but found (${P.join(", ")}) instead.`)}return null}static register(e,r){$a.definitions=r;for(const s in r)e[s]=$a}}var Ts=$a;class Ga{constructor(e,r,s){this.type=is,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const l=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Ar);if(!l)return null;const p=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Ar);if(!p)return null;let g=null;return s.locale&&(g=r.parse(s.locale,1,Lr),!g)?null:new Ga(l,p,g)}evaluate(e){return new Wu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const na=8192;function Ei(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Fs(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function bo(t,e){const r=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*na),Math.round(s*l*na)]}function sl(t,e,r){const s=t[0]-e[0],l=t[1]-e[1],p=t[0]-r[0],g=t[1]-r[1];return s*g-p*l==0&&s*p<=0&&l*g<=0}function Xc(t,e){let r=!1;for(let g=0,v=e.length;g<v;g++){const T=e[g];for(let S=0,P=T.length;S<P-1;S++){if(sl(t,T[S],T[S+1]))return!1;(l=T[S])[1]>(s=t)[1]!=(p=T[S+1])[1]>s[1]&&s[0]<(p[0]-l[0])*(s[1]-l[1])/(p[1]-l[1])+l[0]&&(r=!r)}}var s,l,p;return r}function Ql(t,e){for(let r=0;r<e.length;r++)if(Xc(t,e[r]))return!0;return!1}function ec(t,e,r,s){const l=s[0]-r[0],p=s[1]-r[1],g=(t[0]-r[0])*p-l*(t[1]-r[1]),v=(e[0]-r[0])*p-l*(e[1]-r[1]);return g>0&&v<0||g<0&&v>0}function ia(t,e,r){for(const S of r)for(let P=0;P<S.length-1;++P)if((v=[(g=S[P+1])[0]-(p=S[P])[0],g[1]-p[1]])[0]*(T=[(l=e)[0]-(s=t)[0],l[1]-s[1]])[1]-v[1]*T[0]!=0&&ec(s,l,p,g)&&ec(p,g,s,l))return!0;var s,l,p,g,v,T;return!1}function Ur(t,e){for(let r=0;r<t.length;++r)if(!Xc(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(ia(t[r],t[r+1],e))return!1;return!0}function id(t,e){for(let r=0;r<e.length;r++)if(Ur(t,e[r]))return!0;return!1}function Xu(t,e,r){const s=[];for(let l=0;l<t.length;l++){const p=[];for(let g=0;g<t[l].length;g++){const v=bo(t[l][g],r);Ei(e,v),p.push(v)}s.push(p)}return s}function sd(t,e,r){const s=[];for(let l=0;l<t.length;l++){const p=Xu(t[l],e,r);s.push(p)}return s}function Ku(t,e,r,s){if(t[0]<r[0]||t[0]>r[2]){const l=.5*s;let p=t[0]-r[0]>l?-s:r[0]-t[0]>l?s:0;p===0&&(p=t[0]-r[2]>l?-s:r[2]-t[0]>l?s:0),t[0]+=p}Ei(e,t)}function Kc(t,e,r,s){const l=Math.pow(2,s.z)*na,p=[s.x*na,s.y*na],g=[];if(!t)return g;for(const v of t)for(const T of v){const S=[T.x+p[0],T.y+p[1]];Ku(S,e,r,l),g.push(S)}return g}function Yu(t,e,r,s){const l=Math.pow(2,s.z)*na,p=[s.x*na,s.y*na],g=[];if(!t)return g;for(const T of t){const S=[];for(const P of T){const D=[P.x+p[0],P.y+p[1]];Ei(e,D),S.push(D)}g.push(S)}if(e[2]-e[0]<=l/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const T of g)for(const S of T)Ku(S,e,r,l)}var v;return g}class al{constructor(e,r){this.type=Ar,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Va(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let l=0;l<s.features.length;++l){const p=s.features[l].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new al(s,s.features[l].geometry)}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new al(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new al(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(r,s){const l=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(!g)return!1;if(s.type==="Polygon"){const v=Xu(s.coordinates,p,g),T=Kc(r.geometry(),l,p,g);if(!Fs(l,p))return!1;for(const S of T)if(!Xc(S,v))return!1}if(s.type==="MultiPolygon"){const v=sd(s.coordinates,p,g),T=Kc(r.geometry(),l,p,g);if(!Fs(l,p))return!1;for(const S of T)if(!Ql(S,v))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(r,s){const l=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(!g)return!1;if(s.type==="Polygon"){const v=Xu(s.coordinates,p,g),T=Yu(r.geometry(),l,p,g);if(!Fs(l,p))return!1;for(const S of T)if(!Ur(S,v))return!1}if(s.type==="MultiPolygon"){const v=sd(s.coordinates,p,g),T=Yu(r.geometry(),l,p,g);if(!Fs(l,p))return!1;for(const S of T)if(!id(S,v))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Yc=al;function ol(t){if(t instanceof Ts&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Yc)return!1;let e=!0;return t.eachChild((r=>{e&&!ol(r)&&(e=!1)})),e}function ba(t){if(t instanceof Ts&&t.name==="feature-state")return!1;let e=!0;return t.eachChild((r=>{e&&!ba(r)&&(e=!1)})),e}function Wa(t,e){if(t instanceof Ts&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild((s=>{r&&!Wa(s,e)&&(r=!1)})),r}class Jc{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new Jc(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ad=Jc;class tc{constructor(e,r=[],s,l=new el,p=[]){this.registry=e,this.path=r,this.key=r.map((g=>`[${g}]`)).join(""),this.scope=l,this.errors=p,this.expectedType=s}parse(e,r,s,l,p={}){return r?this.concat(r,s,l)._parse(e,p):this._parse(e,p)}_parse(e,r){function s(l,p,g){return g==="assert"?new va(p,[l]):g==="coerce"?new as(p,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[l];if(p){let g=p.parse(e,this);if(!g)return null;if(this.expectedType){const v=this.expectedType,T=g.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||T.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(v,T))return null}else g=s(g,v,r.typeAnnotation||"coerce");else g=s(g,v,r.typeAnnotation||"assert")}if(!(g instanceof Bs)&&g.type.kind!=="resolvedImage"&&rc(g)){const v=new il;try{g=new Bs(g.type,g.evaluate(v))}catch(T){return this.error(T.message),null}}return g}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const l=typeof e=="number"?this.path.concat(e):this.path,p=s?this.scope.concat(s):this.scope;return new tc(this.registry,l,r||null,p,this.errors)}error(e,...r){const s=`${this.key}${r.map((l=>`[${l}]`)).join("")}`;this.errors.push(new rs(s,e))}checkSubtype(e,r){const s=ea(e,r);return s&&this.error(s),s}}var Ju=tc;function rc(t){if(t instanceof ad)return rc(t.boundExpression);if(t instanceof Ts&&t.name==="error"||t instanceof Ga||t instanceof Yc)return!1;const e=t instanceof as||t instanceof va;let r=!0;return t.eachChild((s=>{r=e?r&&rc(s):r&&s instanceof Bs})),!!r&&ol(t)&&Wa(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Qc(t,e){const r=t.length-1;let s,l,p=0,g=r,v=0;for(;p<=g;)if(v=Math.floor((p+g)/2),s=t[v],l=t[v+1],s<=e){if(v===r||e<l)return v;p=v+1}else{if(!(s>e))throw new zn("Input is not a number.");g=v-1}return 0}class eu{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,p]of s)this.labels.push(l),this.outputs.push(p)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Bt);if(!s)return null;const l=[];let p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let g=1;g<e.length;g+=2){const v=g===1?-1/0:e[g],T=e[g+1],S=g,P=g+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(l.length&&l[l.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const D=r.parse(T,P,p);if(!D)return null;p=p||D.type,l.push([v,D])}return new eu(p,s,l)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return s[0].evaluate(e);const p=r.length;return l>=r[p-1]?s[p-1].evaluate(e):s[Qc(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var Qu=eu;function Fr(t,e,r){return t*(1-r)+e*r}var nc=Object.freeze({__proto__:null,array:function(t,e,r){return t.map(((s,l)=>Fr(s,e[l],r)))},color:function(t,e,r){return new on(Fr(t.r,e.r,r),Fr(t.g,e.g,r),Fr(t.b,e.b,r),Fr(t.a,e.a,r))},number:Fr});const od=.95047,eh=1.08883,ld=4/29,wo=6/29,th=3*wo*wo,kp=wo*wo*wo,rh=Math.PI/180,ic=180/Math.PI;function nh(t){return t>kp?Math.pow(t,1/3):t/th+ld}function tu(t){return t>wo?t*t*t:th*(t-ld)}function ru(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function sc(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ih(t){const e=sc(t.r),r=sc(t.g),s=sc(t.b),l=nh((.4124564*e+.3575761*r+.1804375*s)/od),p=nh((.2126729*e+.7151522*r+.072175*s)/1);return{l:116*p-16,a:500*(l-p),b:200*(p-nh((.0193339*e+.119192*r+.9503041*s)/eh)),alpha:t.a}}function sh(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*tu(e),r=od*tu(r),s=eh*tu(s),new on(ru(3.2404542*r-1.5371385*e-.4985314*s),ru(-.969266*r+1.8760108*e+.041556*s),ru(.0556434*r-.2040259*e+1.0572252*s),t.alpha)}function ll(t,e,r){const s=e-t;return t+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const ac={forward:ih,reverse:sh,interpolate:function(t,e,r){return{l:Fr(t.l,e.l,r),a:Fr(t.a,e.a,r),b:Fr(t.b,e.b,r),alpha:Fr(t.alpha,e.alpha,r)}}},cl={forward:function(t){const{l:e,a:r,b:s}=ih(t),l=Math.atan2(s,r)*ic;return{h:l<0?l+360:l,c:Math.sqrt(r*r+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*rh,r=t.c;return sh({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:ll(t.h,e.h,r),c:Fr(t.c,e.c,r),l:Fr(t.l,e.l,r),alpha:Fr(t.alpha,e.alpha,r)}}};var ah=Object.freeze({__proto__:null,hcl:cl,lab:ac});class ul{constructor(e,r,s,l,p){this.type=e,this.operator=r,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[g,v]of p)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(e,r,s,l){let p=0;if(e.name==="exponential")p=nu(r,e.base,s,l);else if(e.name==="linear")p=nu(r,1,s,l);else if(e.name==="cubic-bezier"){const g=e.controlPoints;p=new $e(g[0],g[1],g[2],g[3]).solve(nu(r,1,s,l))}return p}static parse(e,r){let[s,l,p,...g]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const S=l[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:S}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const S=l.slice(1);if(S.length!==4||S.some((P=>typeof P!="number"||P<0||P>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,Bt),!p)return null;const v=[];let T=null;s==="interpolate-hcl"||s==="interpolate-lab"?T=$i:r.expectedType&&r.expectedType.kind!=="value"&&(T=r.expectedType);for(let S=0;S<g.length;S+=2){const P=g[S],D=g[S+1],L=S+3,U=S+4;if(typeof P!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(v.length&&v[v.length-1][0]>=P)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const V=r.parse(D,U,T);if(!V)return null;T=T||V.type,v.push([P,V])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new ul(T,s,l,p,v):r.error(`Type ${dn(T)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return s[0].evaluate(e);const p=r.length;if(l>=r[p-1])return s[p-1].evaluate(e);const g=Qc(r,l),v=ul.interpolationFactor(this.interpolation,l,r[g],r[g+1]),T=s[g].evaluate(e),S=s[g+1].evaluate(e);return this.operator==="interpolate"?nc[this.type.kind.toLowerCase()](T,S,v):this.operator==="interpolate-hcl"?cl.reverse(cl.interpolate(cl.forward(T),cl.forward(S),v)):ac.reverse(ac.interpolate(ac.forward(T),ac.forward(S),v))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)r.push(this.labels[s],this.outputs[s].serialize());return r}}function nu(t,e,r,s){const l=s-r,p=t-r;return l===0?0:e===1?p/l:(Math.pow(e,p)-1)/(Math.pow(e,l)-1)}var Gi=ul;class qa{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const l=r.expectedType;l&&l.kind!=="value"&&(s=l);const p=[];for(const v of e.slice(1)){const T=r.parse(v,1+p.length,s,void 0,{typeAnnotation:"omit"});if(!T)return null;s=s||T.type,p.push(T)}const g=l&&p.some((v=>ea(l,v.type)));return new qa(g?br:s,p)}evaluate(e){let r,s=null,l=0;for(const p of this.args){if(l++,s=p.evaluate(e),s&&s instanceof bs&&!s.available&&(r||(r=s),s=null,l===this.args.length))return r;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((r=>{e.push(r.serialize())})),e}}var oh=qa;class To{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let p=1;p<e.length-1;p+=2){const g=e[p];if(typeof g!="string")return r.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=r.parse(e[p+1],p+1);if(!v)return null;s.push([g,v])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return l?new To(s,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,s]of this.bindings)e.push(r,s.serialize());return e.push(this.result.serialize()),e}}var cd=To;class iu{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Bt),l=r.parse(e[2],2,ss(r.expectedType||br));return s&&l?new iu(l.type.itemType,s,l):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new zn(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new zn(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new zn(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var lh=iu;class oc{constructor(e,r){this.type=Ar,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,br),l=r.parse(e[2],2,br);return s&&l?tl(s.type,[Ar,Lr,Bt,_a,br])?new oc(s,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${dn(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!rl(r,["boolean","string","number","null"]))throw new zn(`Expected first argument to be of type boolean, string, number or null, but found ${dn(Cn(r))} instead.`);if(!rl(s,["string","array"]))throw new zn(`Expected second argument to be of type array or string, but found ${dn(Cn(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var lc=oc;class hl{constructor(e,r,s){this.type=Bt,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,br),l=r.parse(e[2],2,br);if(!s||!l)return null;if(!tl(s.type,[Ar,Lr,Bt,_a,br]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${dn(s.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,Bt);return p?new hl(s,l,p):null}return new hl(s,l)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!rl(r,["boolean","string","number","null"]))throw new zn(`Expected first argument to be of type boolean, string, number or null, but found ${dn(Cn(r))} instead.`);if(!rl(s,["string","array"]))throw new zn(`Expected second argument to be of type array or string, but found ${dn(Cn(s))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return s.indexOf(r,l)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ch=hl;class uh{constructor(e,r,s,l,p,g){this.inputType=e,this.type=r,this.input=s,this.cases=l,this.outputs=p,this.otherwise=g}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const p={},g=[];for(let S=2;S<e.length-1;S+=2){let P=e[S];const D=e[S+1];Array.isArray(P)||(P=[P]);const L=r.concat(S);if(P.length===0)return L.error("Expected at least one branch label.");for(const V of P){if(typeof V!="number"&&typeof V!="string")return L.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return L.error("Numeric branch labels must be integer values.");if(s){if(L.checkSubtype(s,Cn(V)))return null}else s=Cn(V);if(p[String(V)]!==void 0)return L.error("Branch labels must be unique.");p[String(V)]=g.length}const U=r.parse(D,S,l);if(!U)return null;l=l||U.type,g.push(U)}const v=r.parse(e[1],1,br);if(!v)return null;const T=r.parse(e[e.length-1],e.length-1,l);return T?v.type.kind!=="value"&&r.concat(1).checkSubtype(s,v.type)?null:new uh(s,l,v,p,g,T):null}evaluate(e){const r=this.input.evaluate(e);return(Cn(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),s=[],l={};for(const g of r){const v=l[this.cases[g]];v===void 0?(l[this.cases[g]]=s.length,s.push([this.cases[g],[g]])):s[v][1].push(g)}const p=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,v]of s)e.push(v.length===1?p(v[0]):v.map(p)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}var Sp=uh;class hh{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const l=[];for(let g=1;g<e.length-1;g+=2){const v=r.parse(e[g],g,Ar);if(!v)return null;const T=r.parse(e[g+1],g+1,s);if(!T)return null;l.push([v,T]),s=s||T.type}const p=r.parse(e[e.length-1],e.length-1,s);return p?new hh(s,l,p):null}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every((([e,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((r=>{e.push(r.serialize())})),e}}var ud=hh;class cc{constructor(e,r,s,l){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,br),l=r.parse(e[2],2,Bt);if(!s||!l)return null;if(!tl(s.type,[ss(br),Lr,br]))return r.error(`Expected first argument to be of type array or string, but found ${dn(s.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,Bt);return p?new cc(s.type,s,l,p):null}return new cc(s.type,s,l)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!rl(r,["string","array"]))throw new zn(`Expected first argument to be of type array or string, but found ${dn(Cn(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(s,l)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ks=cc;function Za(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function dh(t,e,r,s){return s.compare(e,r)===0}function ko(t,e,r){const s=t!=="=="&&t!=="!=";return class D1{constructor(p,g,v){this.type=Ar,this.lhs=p,this.rhs=g,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const v=p[0];let T=g.parse(p[1],1,br);if(!T)return null;if(!Za(v,T.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${dn(T.type)}'.`);let S=g.parse(p[2],2,br);if(!S)return null;if(!Za(v,S.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${dn(S.type)}'.`);if(T.type.kind!==S.type.kind&&T.type.kind!=="value"&&S.type.kind!=="value")return g.error(`Cannot compare types '${dn(T.type)}' and '${dn(S.type)}'.`);s&&(T.type.kind==="value"&&S.type.kind!=="value"?T=new va(S.type,[T]):T.type.kind!=="value"&&S.type.kind==="value"&&(S=new va(T.type,[S])));let P=null;if(p.length===4){if(T.type.kind!=="string"&&S.type.kind!=="string"&&T.type.kind!=="value"&&S.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(P=g.parse(p[3],3,is),!P)return null}return new D1(T,S,P)}evaluate(p){const g=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(s&&this.hasUntypedArgument){const T=Cn(g),S=Cn(v);if(T.kind!==S.kind||T.kind!=="string"&&T.kind!=="number")throw new zn(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${T.kind}, ${S.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const T=Cn(g),S=Cn(v);if(T.kind!=="string"||S.kind!=="string")return e(p,g,v)}return this.collator?r(p,g,v,this.collator.evaluate(p)):e(p,g,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[t];return this.eachChild((g=>{p.push(g.serialize())})),p}}}const hd=ko("==",(function(t,e,r){return e===r}),dh),dd=ko("!=",(function(t,e,r){return e!==r}),(function(t,e,r,s){return!dh(0,e,r,s)})),ph=ko("<",(function(t,e,r){return e<r}),(function(t,e,r,s){return s.compare(e,r)<0})),Ep=ko(">",(function(t,e,r){return e>r}),(function(t,e,r,s){return s.compare(e,r)>0})),Cp=ko("<=",(function(t,e,r){return e<=r}),(function(t,e,r,s){return s.compare(e,r)<=0})),So=ko(">=",(function(t,e,r){return e>=r}),(function(t,e,r,s){return s.compare(e,r)>=0}));class dl{constructor(e,r,s,l,p,g){this.type=Lr,this.number=e,this.locale=r,this.currency=s,this.unit=l,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Bt);if(!s)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let p=null;if(l.locale&&(p=r.parse(l.locale,1,Lr),!p))return null;let g=null;if(l.currency&&(g=r.parse(l.currency,1,Lr),!g))return null;let v=null;if(l.unit&&(v=r.parse(l.unit,1,Lr),!v))return null;let T=null;if(l["min-fraction-digits"]&&(T=r.parse(l["min-fraction-digits"],1,Bt),!T))return null;let S=null;return l["max-fraction-digits"]&&(S=r.parse(l["max-fraction-digits"],1,Bt),!S)?null:new dl(s,p,g,v,T,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class sa{constructor(e){this.type=Bt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${dn(s.type)} instead.`):new sa(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new zn(`Expected value to be of type string or array, but found ${dn(Cn(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((r=>{e.push(r.serialize())})),e}}const su={"==":hd,"!=":dd,">":Ep,"<":ph,">=":So,"<=":Cp,array:va,at:lh,boolean:va,case:ud,coalesce:oh,collator:Ga,format:ra,image:vo,in:lc,"index-of":ch,interpolate:Gi,"interpolate-hcl":Gi,"interpolate-lab":Gi,length:sa,let:cd,literal:Bs,match:Sp,number:va,"number-format":dl,object:va,slice:ks,step:Qu,string:va,"to-boolean":as,"to-color":as,"to-number":as,"to-string":as,var:ad,within:Yc};function fh(t,[e,r,s,l]){e=e.evaluate(t),r=r.evaluate(t),s=s.evaluate(t);const p=l?l.evaluate(t):1,g=qu(e,r,s,p);if(g)throw new zn(g);return new on(e/255*p,r/255*p,s/255*p,p)}function Ss(t,e){return t in e}function wa(t,e){const r=e[t];return r===void 0?null:r}function Wi(t){return{type:t}}Ts.register(su,{error:[{kind:"error"},[Lr],(t,[e])=>{throw new zn(e.evaluate(t))}],typeof:[Lr,[br],(t,[e])=>dn(Cn(e.evaluate(t)))],"to-rgba":[ss(Bt,4),[$i],(t,[e])=>e.evaluate(t).toArray()],rgb:[$i,[Bt,Bt,Bt],fh],rgba:[$i,[Bt,Bt,Bt,Bt],fh],has:{type:Ar,overloads:[[[Lr],(t,[e])=>Ss(e.evaluate(t),t.properties())],[[Lr,ns],(t,[e,r])=>Ss(e.evaluate(t),r.evaluate(t))]]},get:{type:br,overloads:[[[Lr],(t,[e])=>wa(e.evaluate(t),t.properties())],[[Lr,ns],(t,[e,r])=>wa(e.evaluate(t),r.evaluate(t))]]},"feature-state":[br,[Lr],(t,[e])=>wa(e.evaluate(t),t.featureState||{})],properties:[ns,[],t=>t.properties()],"geometry-type":[Lr,[],t=>t.geometryType()],id:[br,[],t=>t.id()],zoom:[Bt,[],t=>t.globals.zoom],pitch:[Bt,[],t=>t.globals.pitch||0],"distance-from-center":[Bt,[],t=>t.distanceFromCenter()],"heatmap-density":[Bt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Bt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Bt,[],t=>t.globals.skyRadialProgress||0],accumulated:[br,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Bt,Wi(Bt),(t,e)=>{let r=0;for(const s of e)r+=s.evaluate(t);return r}],"*":[Bt,Wi(Bt),(t,e)=>{let r=1;for(const s of e)r*=s.evaluate(t);return r}],"-":{type:Bt,overloads:[[[Bt,Bt],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[Bt],(t,[e])=>-e.evaluate(t)]]},"/":[Bt,[Bt,Bt],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[Bt,[Bt,Bt],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[Bt,[],()=>Math.LN2],pi:[Bt,[],()=>Math.PI],e:[Bt,[],()=>Math.E],"^":[Bt,[Bt,Bt],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[Bt,[Bt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Bt,[Bt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Bt,[Bt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Bt,[Bt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Bt,[Bt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Bt,[Bt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Bt,[Bt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Bt,[Bt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Bt,[Bt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Bt,[Bt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Bt,Wi(Bt),(t,e)=>Math.min(...e.map((r=>r.evaluate(t))))],max:[Bt,Wi(Bt),(t,e)=>Math.max(...e.map((r=>r.evaluate(t))))],abs:[Bt,[Bt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Bt,[Bt],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[Bt,[Bt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Bt,[Bt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Ar,[Lr,br],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[Ar,[br],(t,[e])=>t.id()===e.value],"filter-type-==":[Ar,[Lr],(t,[e])=>t.geometryType()===e.value],"filter-<":[Ar,[Lr,br],(t,[e,r])=>{const s=t.properties()[e.value],l=r.value;return typeof s==typeof l&&s<l}],"filter-id-<":[Ar,[br],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[Ar,[Lr,br],(t,[e,r])=>{const s=t.properties()[e.value],l=r.value;return typeof s==typeof l&&s>l}],"filter-id->":[Ar,[br],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[Ar,[Lr,br],(t,[e,r])=>{const s=t.properties()[e.value],l=r.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[Ar,[br],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[Ar,[Lr,br],(t,[e,r])=>{const s=t.properties()[e.value],l=r.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[Ar,[br],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[Ar,[br],(t,[e])=>e.value in t.properties()],"filter-has-id":[Ar,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Ar,[ss(Lr)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Ar,[ss(br)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Ar,[Lr,ss(br)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Ar,[Lr,ss(br)],(t,[e,r])=>(function(s,l,p,g){for(;p<=g;){const v=p+g>>1;if(l[v]===s)return!0;l[v]>s?g=v-1:p=v+1}return!1})(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Ar,overloads:[[[Ar,Ar],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[Wi(Ar),(t,e)=>{for(const r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:Ar,overloads:[[[Ar,Ar],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[Wi(Ar),(t,e)=>{for(const r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[Ar,[Ar],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Ar,[Lr],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[Lr,[Lr],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Lr,[Lr],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Lr,Wi(br),(t,e)=>e.map((r=>Jl(r.evaluate(t)))).join("")],"resolved-locale":[Lr,[is],(t,[e])=>e.evaluate(t).resolvedLocale()]});var pl=su;function uc(t){return{result:"success",value:t}}function Ha(t){return{result:"error",value:t}}function Eo(t){return t["property-type"]==="data-driven"}function hc(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function dc(t){return!!t.expression&&t.expression.interpolated}function Vr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function fl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Ta(t){return t}function ml(t,e){const r=e.type==="color",s=t.stops&&typeof t.stops[0][0]=="object",l=s||!(s||t.property!==void 0),p=t.type||(dc(e)?"exponential":"interval");if(r&&((t=ni({},t)).stops&&(t.stops=t.stops.map((S=>[S[0],on.parse(S[1])]))),t.default=on.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!ah[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let g,v,T;if(p==="exponential")g=os;else if(p==="interval")g=au;else if(p==="categorical"){g=pd,v=Object.create(null);for(const S of t.stops)v[S[0]]=S[1];T=typeof t.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);g=fd}if(s){const S={},P=[];for(let U=0;U<t.stops.length;U++){const V=t.stops[U],q=V[0].zoom;S[q]===void 0&&(S[q]={zoom:q,type:t.type,property:t.property,default:t.default,stops:[]},P.push(q)),S[q].stops.push([V[0].value,V[1]])}const D=[];for(const U of P)D.push([S[U].zoom,ml(S[U],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Gi.interpolationFactor.bind(void 0,L),zoomStops:D.map((U=>U[0])),evaluate:({zoom:U},V)=>os({stops:D,base:t.base},e,U).evaluate(U,V)}}if(l){const S=p==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Gi.interpolationFactor.bind(void 0,S),zoomStops:t.stops.map((P=>P[0])),evaluate:({zoom:P})=>g(t,e,P,v,T)}}return{kind:"source",evaluate(S,P){const D=P&&P.properties?P.properties[t.property]:void 0;return D===void 0?Xa(t.default,e.default):g(t,e,D,v,T)}}}function Xa(t,e,r){return t!==void 0?t:e!==void 0?e:r!==void 0?r:void 0}function pd(t,e,r,s,l){return Xa(typeof r===l?s[r]:void 0,t.default,e.default)}function au(t,e,r){if(Vr(r)!=="number")return Xa(t.default,e.default);const s=t.stops.length;if(s===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[s-1][0])return t.stops[s-1][1];const l=Qc(t.stops.map((p=>p[0])),r);return t.stops[l][1]}function os(t,e,r){const s=t.base!==void 0?t.base:1;if(Vr(r)!=="number")return Xa(t.default,e.default);const l=t.stops.length;if(l===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[l-1][0])return t.stops[l-1][1];const p=Qc(t.stops.map((P=>P[0])),r),g=(function(P,D,L,U){const V=U-L,q=P-L;return V===0?0:D===1?q/V:(Math.pow(D,q)-1)/(Math.pow(D,V)-1)})(r,s,t.stops[p][0],t.stops[p+1][0]),v=t.stops[p][1],T=t.stops[p+1][1];let S=nc[e.type]||Ta;if(t.colorSpace&&t.colorSpace!=="rgb"){const P=ah[t.colorSpace];S=(D,L)=>P.reverse(P.interpolate(P.forward(D),P.forward(L),g))}return typeof v.evaluate=="function"?{evaluate(...P){const D=v.evaluate.apply(void 0,P),L=T.evaluate.apply(void 0,P);if(D!==void 0&&L!==void 0)return S(D,L,g)}}:S(v,T,g)}function fd(t,e,r){return e.type==="color"?r=on.parse(r):e.type==="formatted"?r=pi.fromString(r.toString()):e.type==="resolvedImage"?r=bs.fromString(r.toString()):Vr(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Xa(r,t.default,e.default)}class pc{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new il,this._defaultValue=r?(function(s){return s.type==="color"&&(fl(s.default)||Array.isArray(s.default))?new on(0,0,0,0):s.type==="color"?on.parse(s.default)||null:s.default===void 0?null:s.default})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,l,p,g,v,T){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=l||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,l,p,g,v,T){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=T||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new zn(`Expected value to be one of ${Object.keys(this._enumValues).map((P=>JSON.stringify(P))).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function Co(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in pl}function an(t,e){const r=new Ju(pl,[],e?(function(l){const p={color:$i,string:Lr,number:Bt,enum:Lr,boolean:Ar,formatted:xo,resolvedImage:Hr};return l.type==="array"?ss(p[l.value]||br,l.length):p[l.type]})(e):void 0),s=r.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?uc(new pc(s,e)):Ha(r.errors)}class fc{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!ba(r.expression)}evaluateWithoutErrorHandling(e,r,s,l,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,l,p,g)}evaluate(e,r,s,l,p,g){return this._styleExpression.evaluate(e,r,s,l,p,g)}}class Ka{constructor(e,r,s,l){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!ba(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,s,l,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,l,p,g)}evaluate(e,r,s,l,p,g){return this._styleExpression.evaluate(e,r,s,l,p,g)}interpolationFactor(e,r,s){return this.interpolationType?Gi.interpolationFactor(this.interpolationType,e,r,s):0}}function ka(t,e){if((t=an(t,e)).result==="error")return t;const r=t.value.expression,s=ol(r);if(!s&&!Eo(e))return Ha([new rs("","data expressions not supported")]);const l=Wa(r,["zoom","pitch","distance-from-center"]);if(!l&&!hc(e))return Ha([new rs("","zoom expressions not supported")]);const p=gl(r);return p||l?p instanceof rs?Ha([p]):p instanceof Gi&&!dc(e)?Ha([new rs("",'"interpolate" expressions cannot be used with this property')]):uc(p?new Ka(s?"camera":"composite",t.value,p.labels,p instanceof Gi?p.interpolation:void 0):new fc(s?"constant":"source",t.value)):Ha([new rs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class mc{constructor(e,r){this._parameters=e,this._specification=r,ni(this,ml(this._parameters,this._specification))}static deserialize(e){return new mc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function gl(t){let e=null;if(t instanceof cd)e=gl(t.result);else if(t instanceof oh){for(const r of t.args)if(e=gl(r),e)break}else(t instanceof Qu||t instanceof Gi)&&t.input instanceof Ts&&t.input.name==="zoom"&&(e=t);return e instanceof rs||t.eachChild((r=>{const s=gl(r);s instanceof rs?e=s:!e&&s?e=new rs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new rs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}class Dt{constructor(e,r,s,l){this.message=(e?`${e}: `:"")+s,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function qi(t){const e=t.key,r=t.value,s=t.valueSpec||{},l=t.objectElementValidators||{},p=t.style,g=t.styleSpec;let v=[];const T=Vr(r);if(T!=="object")return[new Dt(e,r,`object expected, ${T} found`)];for(const S in r){const P=S.split(".")[0];let D;l[P]?D=l[P]:s[P]?D=Rr:l["*"]?D=l["*"]:s["*"]&&(D=Rr),D?v=v.concat(D({key:(e&&`${e}.`)+S,value:r[S],valueSpec:s[P]||s["*"],style:p,styleSpec:g,object:r,objectKey:S},r)):v.push(new Dt(e,r[S],`unknown property "${S}"`))}for(const S in s)l[S]||s[S].required&&s[S].default===void 0&&r[S]===void 0&&v.push(new Dt(e,r,`missing required property "${S}"`));return v}function Mo(t){const e=t.value,r=t.valueSpec,s=t.style,l=t.styleSpec,p=t.key,g=t.arrayElementValidator||Rr;if(Vr(e)!=="array")return[new Dt(p,e,`array expected, ${Vr(e)} found`)];if(r.length&&e.length!==r.length)return[new Dt(p,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Dt(p,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let v={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};l.$version<7&&(v.function=r.function),Vr(r.value)==="object"&&(v=r.value);let T=[];for(let S=0;S<e.length;S++)T=T.concat(g({array:e,arrayIndex:S,value:e[S],valueSpec:v,style:s,styleSpec:l,key:`${p}[${S}]`}));return T}function yl(t){const e=t.key,r=t.value,s=t.valueSpec;let l=Vr(r);if(l==="number"&&r!=r&&(l="NaN"),l!=="number")return[new Dt(e,r,`number expected, ${l} found`)];if("minimum"in s){let p=s.minimum;if(Vr(s.minimum)==="array"&&(p=s.minimum[t.arrayIndex]),r<p)return[new Dt(e,r,`${r} is less than the minimum value ${p}`)]}if("maximum"in s){let p=s.maximum;if(Vr(s.maximum)==="array"&&(p=s.maximum[t.arrayIndex]),r>p)return[new Dt(e,r,`${r} is greater than the maximum value ${p}`)]}return[]}function gc(t){const e=t.valueSpec,r=Gn(t.value.type);let s,l,p,g={};const v=r!=="categorical"&&t.value.property===void 0,T=!v,S=Vr(t.value.stops)==="array"&&Vr(t.value.stops[0])==="array"&&Vr(t.value.stops[0][0])==="object",P=qi({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(U){if(r==="identity")return[new Dt(U.key,U.value,'identity function may not have a "stops" property')];let V=[];const q=U.value;return V=V.concat(Mo({key:U.key,value:q,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:D})),Vr(q)==="array"&&q.length===0&&V.push(new Dt(U.key,q,"array must have at least one stop")),V},default:function(U){return Rr({key:U.key,value:U.value,valueSpec:e,style:U.style,styleSpec:U.styleSpec})}}});return r==="identity"&&v&&P.push(new Dt(t.key,t.value,'missing required property "property"')),r==="identity"||t.value.stops||P.push(new Dt(t.key,t.value,'missing required property "stops"')),r==="exponential"&&t.valueSpec.expression&&!dc(t.valueSpec)&&P.push(new Dt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(T&&!Eo(t.valueSpec)?P.push(new Dt(t.key,t.value,"property functions not supported")):v&&!hc(t.valueSpec)&&P.push(new Dt(t.key,t.value,"zoom functions not supported"))),r!=="categorical"&&!S||t.value.property!==void 0||P.push(new Dt(t.key,t.value,'"property" property is required')),P;function D(U){let V=[];const q=U.value,ee=U.key;if(Vr(q)!=="array")return[new Dt(ee,q,`array expected, ${Vr(q)} found`)];if(q.length!==2)return[new Dt(ee,q,`array length 2 expected, length ${q.length} found`)];if(S){if(Vr(q[0])!=="object")return[new Dt(ee,q,`object expected, ${Vr(q[0])} found`)];if(q[0].zoom===void 0)return[new Dt(ee,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new Dt(ee,q,"object stop key must have value")];const ae=Gn(q[0].zoom);if(typeof ae!="number")return[new Dt(ee,q[0].zoom,"stop zoom values must be numbers")];if(p&&p>ae)return[new Dt(ee,q[0].zoom,"stop zoom values must appear in ascending order")];ae!==p&&(p=ae,l=void 0,g={}),V=V.concat(qi({key:`${ee}[0]`,value:q[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:yl,value:L}}))}else V=V.concat(L({key:`${ee}[0]`,value:q[0],style:U.style,styleSpec:U.styleSpec},q));return Co(hi(q[1]))?V.concat([new Dt(`${ee}[1]`,q[1],"expressions are not allowed in function stops.")]):V.concat(Rr({key:`${ee}[1]`,value:q[1],valueSpec:e,style:U.style,styleSpec:U.styleSpec}))}function L(U,V){const q=Vr(U.value),ee=Gn(U.value),ae=U.value!==null?U.value:V;if(s){if(q!==s)return[new Dt(U.key,ae,`${q} stop domain type must match previous stop domain type ${s}`)]}else s=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof ee!="number"&&typeof ee!="string"&&typeof ee!="boolean")return[new Dt(U.key,ae,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&r!=="categorical"){let me=`number expected, ${q} found`;return Eo(e)&&r===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Dt(U.key,ae,me)]}return r!=="categorical"||q!=="number"||typeof ee=="number"&&isFinite(ee)&&Math.floor(ee)===ee?r!=="categorical"&&q==="number"&&typeof ee=="number"&&typeof l=="number"&&l!==void 0&&ee<l?[new Dt(U.key,ae,"stop domain values must appear in ascending order")]:(l=ee,r==="categorical"&&ee in g?[new Dt(U.key,ae,"stop domain values must be unique")]:(g[ee]=!0,[])):[new Dt(U.key,ae,`integer expected, found ${String(ee)}`)]}}function fi(t){const e=(t.expressionContext==="property"?ka:an)(hi(t.value),t.valueSpec);if(e.result==="error")return e.value.map((s=>new Dt(`${t.key}${s.key}`,t.value,s.message)));const r=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!r.outputDefined())return[new Dt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!ba(r))return[new Dt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return xl(r,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Wa(r,["zoom","feature-state"]))return[new Dt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!ol(r))return[new Dt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xl(t,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const l of e.valueSpec.expression.parameters)r.delete(l);if(r.size===0)return[];const s=[];return t instanceof Ts&&r.has(t.name)?[new Dt(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild((l=>{s.push(...xl(l,e))})),s)}function Ao(t){const e=t.key,r=t.value,s=t.valueSpec,l=[];return Array.isArray(s.values)?s.values.indexOf(Gn(r))===-1&&l.push(new Dt(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(Gn(r))===-1&&l.push(new Dt(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function _l(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!_l(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function vl(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};_l(t)||(t=wl(t));const r=t;let s=!0;try{s=(function(S){if(!Ya(S))return S;let P=hi(S);return bl(P),P=ou(P),P})(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const l=at[`filter_${e}`],p=an(s,l);let g=null;if(p.result==="error")throw new Error(p.value.map((S=>`${S.key}: ${S.message}`)).join(", "));g=(S,P,D)=>p.value.evaluate(S,P,{},D);let v=null,T=null;if(s!==r){const S=an(r,l);if(S.result==="error")throw new Error(S.value.map((P=>`${P.key}: ${P.message}`)).join(", "));v=(P,D,L,U,V)=>S.value.evaluate(P,D,{},L,void 0,void 0,U,V),T=!ol(S.value.expression)}return{filter:g,dynamicFilter:v||void 0,needGeometry:gd(s),needFeature:!!T}}function ou(t){if(!Array.isArray(t))return t;const e=(function(r){if(mh.has(r[0])){for(let s=1;s<r.length;s++)if(Ya(r[s]))return!0}return r})(t);return e===!0?e:e.map((r=>ou(r)))}function bl(t){let e=!1;const r=[];if(t[0]==="case"){for(let s=1;s<t.length-1;s+=2)e=e||Ya(t[s]),r.push(t[s+1]);r.push(t[t.length-1])}else if(t[0]==="match"){e=e||Ya(t[1]);for(let s=2;s<t.length-1;s+=2)r.push(t[s+1]);r.push(t[t.length-1])}else if(t[0]==="step"){e=e||Ya(t[1]);for(let s=1;s<t.length-1;s+=2)r.push(t[s+1])}e&&(t.length=0,t.push("any",...r));for(let s=1;s<t.length;s++)bl(t[s])}function Ya(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<t.length;r++)if(Ya(t[r]))return!0;return!1}const mh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function md(t,e){return t<e?-1:t>e?1:0}function gd(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(gd(t[e]))return!0;return!1}function wl(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?yc(t[1],t[2],"=="):e==="!="?Sa(yc(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?yc(t[1],t[2],e):e==="any"?(r=t.slice(1),["any"].concat(r.map(wl))):e==="all"?["all"].concat(t.slice(1).map(wl)):e==="none"?["all"].concat(t.slice(1).map(wl).map(Sa)):e==="in"?aa(t[1],t.slice(2)):e==="!in"?Sa(aa(t[1],t.slice(2))):e==="has"?lu(t[1]):e==="!has"?Sa(lu(t[1])):e!=="within"||t;var r}function yc(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function aa(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((r=>typeof r!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(md)]]:["filter-in-small",t,["literal",e]]}}function lu(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Sa(t){return["!",t]}function Zi(t){return _l(hi(t.value))?fi(ni({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Ea(t)}function Ea(t){const e=t.value,r=t.key;if(Vr(e)!=="array")return[new Dt(r,e,`array expected, ${Vr(e)} found`)];const s=t.styleSpec;let l,p=[];if(e.length<1)return[new Dt(r,e,"filter array must have at least 1 element")];switch(p=p.concat(Ao({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:t.style,styleSpec:t.styleSpec})),Gn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Gn(e[1])==="$type"&&p.push(new Dt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new Dt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=Vr(e[1]),l!=="string"&&p.push(new Dt(`${r}[1]`,e[1],`string expected, ${l} found`)));for(let g=2;g<e.length;g++)l=Vr(e[g]),Gn(e[1])==="$type"?p=p.concat(Ao({key:`${r}[${g}]`,value:e[g],valueSpec:s.geometry_type,style:t.style,styleSpec:t.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&p.push(new Dt(`${r}[${g}]`,e[g],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)p=p.concat(Ea({key:`${r}[${g}]`,value:e[g],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":l=Vr(e[1]),e.length!==2?p.push(new Dt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&p.push(new Dt(`${r}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=Vr(e[1]),e.length!==2?p.push(new Dt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&p.push(new Dt(`${r}[1]`,e[1],`object expected, ${l} found`))}return p}function Os(t,e){const r=t.key,s=t.style,l=t.styleSpec,p=t.value,g=t.objectKey,v=l[`${e}_${t.layerType}`];if(!v)return[];const T=g.match(/^(.*)-transition$/);if(e==="paint"&&T&&v[T[1]]&&v[T[1]].transition)return Rr({key:r,value:p,valueSpec:l.transition,style:s,styleSpec:l});const S=t.valueSpec||v[g];if(!S)return[new Dt(r,p,`unknown property "${g}"`)];let P;if(Vr(p)==="string"&&Eo(S)&&!S.tokens&&(P=/^{([^}]+)}$/.exec(p))){const L=`\`{ "type": "identity", "property": ${P?JSON.stringify(P[1]):'"_"'} }\``;return[new Dt(r,p,`"${g}" does not support interpolation syntax
Use an identity property function instead: ${L}.`)]}const D=[];return t.layerType==="symbol"&&(g==="text-field"&&s&&!s.glyphs&&D.push(new Dt(r,p,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&fl(hi(p))&&Gn(p.type)==="identity"&&D.push(new Dt(r,p,'"text-font" does not support identity functions'))),D.concat(Rr({key:t.key,value:p,valueSpec:S,style:s,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:g}))}function cu(t){return Os(t,"paint")}function gh(t){return Os(t,"layout")}function yd(t){let e=[];const r=t.value,s=t.key,l=t.style,p=t.styleSpec;r.type||r.ref||e.push(new Dt(s,r,'either "type" or "ref" is required'));let g=Gn(r.type);const v=Gn(r.ref);if(r.id){const T=Gn(r.id);for(let S=0;S<t.arrayIndex;S++){const P=l.layers[S];Gn(P.id)===T&&e.push(new Dt(s,r.id,`duplicate layer id "${r.id}", previously used at line ${P.id.__line__}`))}}if("ref"in r){let T;["type","source","source-layer","filter","layout"].forEach((S=>{S in r&&e.push(new Dt(s,r[S],`"${S}" is prohibited for ref layers`))})),l.layers.forEach((S=>{Gn(S.id)===v&&(T=S)})),T?T.ref?e.push(new Dt(s,r.ref,"ref cannot reference another ref layer")):g=Gn(T.type):typeof v=="string"&&e.push(new Dt(s,r.ref,`ref layer "${v}" not found`))}else if(g!=="background"&&g!=="sky")if(r.source){const T=l.sources&&l.sources[r.source],S=T&&Gn(T.type);T?S==="vector"&&g==="raster"?e.push(new Dt(s,r.source,`layer "${r.id}" requires a raster source`)):S==="raster"&&g!=="raster"?e.push(new Dt(s,r.source,`layer "${r.id}" requires a vector source`)):S!=="vector"||r["source-layer"]?S==="raster-dem"&&g!=="hillshade"?e.push(new Dt(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||S==="geojson"&&T.lineMetrics||e.push(new Dt(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Dt(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Dt(s,r.source,`source "${r.source}" not found`))}else e.push(new Dt(s,r,'missing required property "source"'));return e=e.concat(qi({key:s,value:r,valueSpec:p.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Rr({key:`${s}.type`,value:r.type,valueSpec:p.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"}),filter:T=>Zi(ni({layerType:g},T)),layout:T=>qi({layer:r,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":S=>gh(ni({layerType:g},S))}}),paint:T=>qi({layer:r,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":S=>cu(ni({layerType:g},S))}})}})),e}function Hi(t){const e=t.value,r=t.key,s=Vr(e);return s!=="string"?[new Dt(r,e,`string expected, ${s} found`)]:[]}const Tl={promoteId:function({key:t,value:e}){if(Vr(e)==="string")return Hi({key:t,value:e});{const r=[];for(const s in e)r.push(...Hi({key:`${t}.${s}`,value:e[s]}));return r}}};function Po(t){const e=t.value,r=t.key,s=t.styleSpec,l=t.style;if(!e.type)return[new Dt(r,e,'"type" is required')];const p=Gn(e.type);let g;switch(p){case"vector":case"raster":case"raster-dem":return g=qi({key:r,value:e,valueSpec:s[`source_${p.replace("-","_")}`],style:t.style,styleSpec:s,objectElementValidators:Tl}),g;case"geojson":if(g=qi({key:r,value:e,valueSpec:s.source_geojson,style:l,styleSpec:s,objectElementValidators:Tl}),e.cluster)for(const v in e.clusterProperties){const[T,S]=e.clusterProperties[v],P=typeof T=="string"?[T,["accumulated"],["get",v]]:T;g.push(...fi({key:`${r}.${v}.map`,value:S,expressionContext:"cluster-map"})),g.push(...fi({key:`${r}.${v}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return g;case"video":return qi({key:r,value:e,valueSpec:s.source_video,style:l,styleSpec:s});case"image":return qi({key:r,value:e,valueSpec:s.source_image,style:l,styleSpec:s});case"canvas":return[new Dt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ao({key:`${r}.type`,value:e.type,valueSpec:{values:uu(s)}})}}function uu(t){return t.source.reduce(((e,r)=>{const s=t[r];return s.type.type==="enum"&&(e=e.concat(Object.keys(s.type.values))),e}),[])}function hu(t){const e=t.value,r=t.styleSpec,s=r.light,l=t.style;let p=[];const g=Vr(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new Dt("light",e,`object expected, ${g} found`)]),p;for(const v in e){const T=v.match(/^(.*)-transition$/);p=p.concat(T&&s[T[1]]&&s[T[1]].transition?Rr({key:v,value:e[v],valueSpec:r.transition,style:l,styleSpec:r}):s[v]?Rr({key:v,value:e[v],valueSpec:s[v],style:l,styleSpec:r}):[new Dt(v,e[v],`unknown property "${v}"`)])}return p}function Ja(t){const e=t.value,r=t.key,s=t.style,l=t.styleSpec,p=l.terrain;let g=[];const v=Vr(e);if(e===void 0)return g;if(v!=="object")return g=g.concat([new Dt("terrain",e,`object expected, ${v} found`)]),g;for(const T in e){const S=T.match(/^(.*)-transition$/);g=g.concat(S&&p[S[1]]&&p[S[1]].transition?Rr({key:T,value:e[T],valueSpec:l.transition,style:s,styleSpec:l}):p[T]?Rr({key:T,value:e[T],valueSpec:p[T],style:s,styleSpec:l}):[new Dt(T,e[T],`unknown property "${T}"`)])}if(e.source){const T=s.sources&&s.sources[e.source],S=T&&Gn(T.type);T?S!=="raster-dem"&&g.push(new Dt(r,e.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):g.push(new Dt(r,e.source,`source "${e.source}" not found`))}else g.push(new Dt(r,e,'terrain is missing required property "source"'));return g}function Ca(t){const e=t.value,r=t.style,s=t.styleSpec,l=s.fog;let p=[];const g=Vr(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new Dt("fog",e,`object expected, ${g} found`)]),p;for(const v in e){const T=v.match(/^(.*)-transition$/);p=p.concat(T&&l[T[1]]&&l[T[1]].transition?Rr({key:v,value:e[v],valueSpec:s.transition,style:r,styleSpec:s}):l[v]?Rr({key:v,value:e[v],valueSpec:l[v],style:r,styleSpec:s}):[new Dt(v,e[v],`unknown property "${v}"`)])}return p}const vn={"*":()=>[],array:Mo,boolean:function(t){const e=t.value,r=t.key,s=Vr(e);return s!=="boolean"?[new Dt(r,e,`boolean expected, ${s} found`)]:[]},number:yl,color:function(t){const e=t.key,r=t.value,s=Vr(r);return s!=="string"?[new Dt(e,r,`color expected, ${s} found`)]:Kl(r)===null?[new Dt(e,r,`color expected, "${r}" found`)]:[]},enum:Ao,filter:Zi,function:gc,layer:yd,object:qi,source:Po,light:hu,terrain:Ja,fog:Ca,string:Hi,formatted:function(t){return Hi(t).length===0?[]:fi(t)},resolvedImage:function(t){return Hi(t).length===0?[]:fi(t)},projection:function(t){const e=t.value,r=t.styleSpec,s=r.projection,l=t.style;let p=[];const g=Vr(e);if(g==="object")for(const v in e)p=p.concat(Rr({key:v,value:e[v],valueSpec:s[v],style:l,styleSpec:r}));else g!=="string"&&(p=p.concat([new Dt("projection",e,`object or string expected, ${g} found`)]));return p}};function Rr(t){const e=t.value,r=t.valueSpec,s=t.styleSpec;return r.expression&&fl(Gn(e))?gc(t):r.expression&&Co(hi(e))?fi(t):r.type&&vn[r.type]?vn[r.type](t):qi(ni({},t,{valueSpec:r.type?s[r.type]:r}))}function Qa(t){const e=t.value,r=t.key,s=Hi(t);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new Dt(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new Dt(r,e,'"glyphs" url must include a "{range}" token'))),s}function bi(t,e=at){return wi(Rr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Qa,"*":()=>[]}}))}const Xi=t=>wi(cu(t)),Io=t=>wi(gh(t));function wi(t){return t.slice().sort(((e,r)=>e.line&&r.line?e.line-r.line:0))}function Li(t,e){let r=!1;if(e&&e.length)for(const s of e)t.fire(new xs(new Error(s.message))),r=!0;return r}var du=Us,Es=3;function Us(t,e,r){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var l=new Int32Array(this.arrayBuffer);t=l[0],this.d=(e=l[1])+2*(r=l[2]);for(var p=0;p<this.d*this.d;p++){var g=l[Es+p],v=l[Es+p+1];s.push(g===v?null:l.subarray(g,v))}var T=l[Es+s.length+1];this.keys=l.subarray(l[Es+s.length],T),this.bboxes=l.subarray(T),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var S=0;S<this.d*this.d;S++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var P=r/e*t;this.min=-P,this.max=t+P}Us.prototype.insert=function(t,e,r,s,l){this._forEachCell(e,r,s,l,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l)},Us.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Us.prototype._insertCell=function(t,e,r,s,l,p){this.cells[l].push(p)},Us.prototype.query=function(t,e,r,s,l){var p=this.min,g=this.max;if(t<=p&&e<=p&&g<=r&&g<=s&&!l)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(t,e,r,s,this._queryCell,v,{},l),v},Us.prototype._queryCell=function(t,e,r,s,l,p,g,v){var T=this.cells[l];if(T!==null)for(var S=this.keys,P=this.bboxes,D=0;D<T.length;D++){var L=T[D];if(g[L]===void 0){var U=4*L;(v?v(P[U+0],P[U+1],P[U+2],P[U+3]):t<=P[U+2]&&e<=P[U+3]&&r>=P[U+0]&&s>=P[U+1])?(g[L]=!0,p.push(S[L])):g[L]=!1}}},Us.prototype._forEachCell=function(t,e,r,s,l,p,g,v){for(var T=this._convertToCellCoord(t),S=this._convertToCellCoord(e),P=this._convertToCellCoord(r),D=this._convertToCellCoord(s),L=T;L<=P;L++)for(var U=S;U<=D;U++){var V=this.d*U+L;if((!v||v(this._convertFromCellCoord(L),this._convertFromCellCoord(U),this._convertFromCellCoord(L+1),this._convertFromCellCoord(U+1)))&&l.call(this,t,e,r,s,V,p,g,v))return}},Us.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Us.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Us.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Es+this.cells.length+1+1,r=0,s=0;s<this.cells.length;s++)r+=this.cells[s].length;var l=new Int32Array(e+r+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var p=e,g=0;g<t.length;g++){var v=t[g];l[Es+g]=p,l.set(v,p),p+=v.length}return l[Es+t.length]=p,l.set(this.keys,p),l[Es+t.length+1]=p+=this.keys.length,l.set(this.bboxes,p),p+=this.bboxes.length,l.buffer};var oa=dt(du);const xc={};function Rt(t,e,r={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),xc[e]={klass:t,omit:r.omit||[]}}Rt(Object,"Object"),oa.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},oa.deserialize=function(t){return new oa(t.buffer)},Object.defineProperty(oa,"name",{value:"Grid"}),Rt(oa,"Grid"),Rt(on,"Color"),Rt(Error,"Error"),Rt(Fa,"AJAXError"),Rt(bs,"ResolvedImage"),Rt(mc,"StylePropertyFunction"),Rt(pc,"StyleExpression",{omit:["_evaluator"]}),Rt(Ka,"ZoomDependentExpression"),Rt(fc,"ZoomConstantExpression"),Rt(Ts,"CompoundExpression",{omit:["_evaluate"]});for(const t in pl)xc[pl[t]._classRegistryKey]||Rt(pl[t],`Expression${t}`);function kl(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function _c(t){return R.ImageBitmap&&t instanceof R.ImageBitmap}function jo(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(kl(t)||_c(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const r=t;return e&&e.push(r.buffer),r}if(t instanceof R.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const s of t)r.push(jo(s,e));return r}if(typeof t=="object"){const r=t.constructor,s=r._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const l=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const p in t)t.hasOwnProperty(p)&&(xc[s].omit.indexOf(p)>=0||(l[p]=jo(t[p],e)));t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof t)}function No(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||kl(t)||_c(t)||ArrayBuffer.isView(t)||t instanceof R.ImageData)return t;if(Array.isArray(t))return t.map(No);if(typeof t=="object"){const e=t.$name||"Object",{klass:r}=xc[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);const s=Object.create(r.prototype);for(const l of Object.keys(t))l!=="$name"&&(s[l]=No(t[l]));return s}throw new Error("can't deserialize object of type "+typeof t)}const Nt={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function eo(t){for(const e of t)if(El(e.charCodeAt(0)))return!0;return!1}function Sl(t){for(const e of t)if(!vc(e.charCodeAt(0)))return!1;return!0}function vc(t){return!(Nt.Arabic(t)||Nt["Arabic Supplement"](t)||Nt["Arabic Extended-A"](t)||Nt["Arabic Presentation Forms-A"](t)||Nt["Arabic Presentation Forms-B"](t))}function El(t){return!(t!==746&&t!==747&&(t<4352||!(Nt["Bopomofo Extended"](t)||Nt.Bopomofo(t)||Nt["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Nt["CJK Compatibility Ideographs"](t)||Nt["CJK Compatibility"](t)||Nt["CJK Radicals Supplement"](t)||Nt["CJK Strokes"](t)||!(!Nt["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Nt["CJK Unified Ideographs Extension A"](t)||Nt["CJK Unified Ideographs"](t)||Nt["Enclosed CJK Letters and Months"](t)||Nt["Hangul Compatibility Jamo"](t)||Nt["Hangul Jamo Extended-A"](t)||Nt["Hangul Jamo Extended-B"](t)||Nt["Hangul Jamo"](t)||Nt["Hangul Syllables"](t)||Nt.Hiragana(t)||Nt["Ideographic Description Characters"](t)||Nt.Kanbun(t)||Nt["Kangxi Radicals"](t)||Nt["Katakana Phonetic Extensions"](t)||Nt.Katakana(t)&&t!==12540||!(!Nt["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Nt["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Nt["Unified Canadian Aboriginal Syllabics"](t)||Nt["Unified Canadian Aboriginal Syllabics Extended"](t)||Nt["Vertical Forms"](t)||Nt["Yijing Hexagram Symbols"](t)||Nt["Yi Syllables"](t)||Nt["Yi Radicals"](t))))}function ls(t){return!(El(t)||(function(e){return!!(Nt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Nt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Nt["Letterlike Symbols"](e)||Nt["Number Forms"](e)||Nt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Nt["Control Pictures"](e)&&e!==9251||Nt["Optical Character Recognition"](e)||Nt["Enclosed Alphanumerics"](e)||Nt["Geometric Shapes"](e)||Nt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Nt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Nt["CJK Symbols and Punctuation"](e)||Nt.Katakana(e)||Nt["Private Use Area"](e)||Nt["CJK Compatibility Forms"](e)||Nt["Small Form Variants"](e)||Nt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(t))}function cs(t){return t>=1424&&t<=2303||Nt["Arabic Presentation Forms-A"](t)||Nt["Arabic Presentation Forms-B"](t)}function Do(t,e){return!(!e&&cs(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Nt.Khmer(t))}function Ma(t){for(const e of t)if(cs(e.charCodeAt(0)))return!0;return!1}const Vs="deferred",Aa="loading",pu="loaded";let to=null,d="unavailable",n=null;const o=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(d="error"),to&&to(t)};function f(){x.fire(new Ua("pluginStateChange",{pluginStatus:d,pluginURL:n}))}const x=new Vi,b=function(){return d},C=function(){if(d!==Vs||!n)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");d=Aa,f(),n&&Oa({url:n},(t=>{t?o(t):(d=pu,f())}))},M={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>d===pu||M.applyArabicShaping!=null,isLoading:()=>d===Aa,setState(t){d=t.pluginStatus,n=t.pluginURL},isParsed:()=>M.applyArabicShaping!=null&&M.processBidirectionalText!=null&&M.processStyledBidirectionalText!=null,getPluginURL:()=>n};class j{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return(function(r,s){for(const l of r)if(!Do(l.charCodeAt(0),s))return!1;return!0})(e,M.isLoaded())}}class F{constructor(e,r){this.property=e,this.value=r,this.expression=(function(s,l){if(fl(s))return new mc(s,l);if(Co(s)){const p=ka(s,l);if(p.result==="error")throw new Error(p.value.map((g=>`${g.key}: ${g.message}`)).join(", "));return p.value}{let p=s;return typeof s=="string"&&l.type==="color"&&(p=on.parse(s)),{kind:"constant",evaluate:()=>p}}})(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class z{constructor(e){this.property=e,this.value=new F(e,void 0)}transitioned(e,r){return new Q(this.property,this.value,r,Ot({},e.transition,this.transition),e.now)}untransitioned(){return new Q(this.property,this.value,null,{},0)}}class G{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Rn(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new z(this._values[e].property)),this._values[e].value=new F(this._values[e].property,r===null?void 0:Rn(r))}getTransition(e){return Rn(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new z(this._values[e].property)),this._values[e].transition=Rn(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const s=new re(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(e,r._values[l]);return s}untransitioned(){const e=new re(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Q{constructor(e,r,s,l,p){const g=l.delay||0,v=l.duration||0;p=p||0,this.property=e,this.value=r,this.begin=p+g,this.end=this.begin+v,e.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const l=e.now||0,p=this.value.possiblyEvaluate(e,r,s),g=this.prior;if(g){if(l>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(l<this.begin)return g.possiblyEvaluate(e,r,s);{const v=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,r,s),p,Jt(v))}}return p}}class re{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const l=new se(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].possiblyEvaluate(e,r,s);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ie{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Rn(this._values[e].value)}setValue(e,r){this._values[e]=new F(this._values[e].property,r===null?void 0:Rn(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const l=new se(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].possiblyEvaluate(e,r,s);return l}}class ne{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,l){return this.property.evaluate(this.value,this.parameters,e,r,s,l)}}class se{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class W{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,s){const l=nc[this.specification.type];return l?l(e,r,s):e}}class te{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,l){return new ne(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,l)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new ne(this,{kind:"constant",value:void 0},e.parameters);const l=nc[this.specification.type];return l?new ne(this,{kind:"constant",value:l(e.value.value,r.value.value,s)},e.parameters):e}evaluate(e,r,s,l,p,g){return e.kind==="constant"?e.value:e.evaluate(r,s,l,p,g)}}class le{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,l){return!!e.expression.evaluate(r,null,{},s,l)}interpolate(){return!1}}class ue{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new j(0,{});for(const s in e){const l=e[s];l.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new F(l,void 0),g=this.defaultTransitionablePropertyValues[s]=new z(l);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate(r)}}}function ke(t,e){return 256*(t=Be(Math.floor(t),0,255))+Be(Math.floor(e),0,255)}Rt(te,"DataDrivenProperty"),Rt(W,"DataConstantProperty"),Rt(le,"ColorRampProperty");const Ee={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Se{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class je{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ie(t,e=1){let r=0,s=0;return{members:t.map((l=>{const p=Ee[l.type].BYTES_PER_ELEMENT,g=r=Ve(r,Math.max(e,p)),v=l.components||1;return s=Math.max(s,p),r+=p*v,{name:l.name,type:l.type,components:v,offset:g}})),size:Ve(r,Math.max(s,e)),alignment:e}}function Ve(t,e){return Math.ceil(t/e)*e}class yt extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=s,e}}yt.prototype.bytesPerElement=4,Rt(yt,"StructArrayLayout2i4");class ze extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const p=3*e;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=l,e}}ze.prototype.bytesPerElement=6,Rt(ze,"StructArrayLayout3i6");class nt extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,l)}emplace(e,r,s,l,p){const g=4*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=l,this.int16[g+3]=p,e}}nt.prototype.bytesPerElement=8,Rt(nt,"StructArrayLayout4i8");class We extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,p,g,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,s,l,p,g,v)}emplace(e,r,s,l,p,g,v,T){const S=6*e,P=12*e,D=3*e;return this.int16[S+0]=r,this.int16[S+1]=s,this.uint8[P+4]=l,this.uint8[P+5]=p,this.uint8[P+6]=g,this.uint8[P+7]=v,this.float32[D+2]=T,e}}We.prototype.bytesPerElement=12,Rt(We,"StructArrayLayout2i4ub1f12");class mt extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,l)}emplace(e,r,s,l,p){const g=4*e;return this.float32[g+0]=r,this.float32[g+1]=s,this.float32[g+2]=l,this.float32[g+3]=p,e}}mt.prototype.bytesPerElement=16,Rt(mt,"StructArrayLayout4f16");class Ue extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,s,l,p)}emplace(e,r,s,l,p,g){const v=6*e,T=3*e;return this.uint16[v+0]=r,this.uint16[v+1]=s,this.uint16[v+2]=l,this.uint16[v+3]=p,this.float32[T+2]=g,e}}Ue.prototype.bytesPerElement=12,Rt(Ue,"StructArrayLayout4ui1f12");class it extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,l)}emplace(e,r,s,l,p){const g=4*e;return this.uint16[g+0]=r,this.uint16[g+1]=s,this.uint16[g+2]=l,this.uint16[g+3]=p,e}}it.prototype.bytesPerElement=8,Rt(it,"StructArrayLayout4ui8");class ft extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,l,p,g)}emplace(e,r,s,l,p,g,v){const T=6*e;return this.int16[T+0]=r,this.int16[T+1]=s,this.int16[T+2]=l,this.int16[T+3]=p,this.int16[T+4]=g,this.int16[T+5]=v,e}}ft.prototype.bytesPerElement=12,Rt(ft,"StructArrayLayout6i12");class pt extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,p,g,v,T,S,P,D,L){const U=this.length;return this.resize(U+1),this.emplace(U,e,r,s,l,p,g,v,T,S,P,D,L)}emplace(e,r,s,l,p,g,v,T,S,P,D,L,U){const V=12*e;return this.int16[V+0]=r,this.int16[V+1]=s,this.int16[V+2]=l,this.int16[V+3]=p,this.uint16[V+4]=g,this.uint16[V+5]=v,this.uint16[V+6]=T,this.uint16[V+7]=S,this.int16[V+8]=P,this.int16[V+9]=D,this.int16[V+10]=L,this.int16[V+11]=U,e}}pt.prototype.bytesPerElement=24,Rt(pt,"StructArrayLayout4i4ui4i24");class vt extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,l,p,g)}emplace(e,r,s,l,p,g,v){const T=10*e,S=5*e;return this.int16[T+0]=r,this.int16[T+1]=s,this.int16[T+2]=l,this.float32[S+2]=p,this.float32[S+3]=g,this.float32[S+4]=v,e}}vt.prototype.bytesPerElement=20,Rt(vt,"StructArrayLayout3i3f20");class Wt extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Wt.prototype.bytesPerElement=4,Rt(Wt,"StructArrayLayout1ul4");class or extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,p,g,v,T,S,P,D,L,U){const V=this.length;return this.resize(V+1),this.emplace(V,e,r,s,l,p,g,v,T,S,P,D,L,U)}emplace(e,r,s,l,p,g,v,T,S,P,D,L,U,V){const q=20*e,ee=10*e;return this.int16[q+0]=r,this.int16[q+1]=s,this.int16[q+2]=l,this.int16[q+3]=p,this.int16[q+4]=g,this.float32[ee+3]=v,this.float32[ee+4]=T,this.float32[ee+5]=S,this.float32[ee+6]=P,this.int16[q+14]=D,this.uint32[ee+8]=L,this.uint16[q+18]=U,this.uint16[q+19]=V,e}}or.prototype.bytesPerElement=40,Rt(or,"StructArrayLayout5i4f1i1ul2ui40");class Vt extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,p,g,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,s,l,p,g,v)}emplace(e,r,s,l,p,g,v,T){const S=8*e;return this.int16[S+0]=r,this.int16[S+1]=s,this.int16[S+2]=l,this.int16[S+4]=p,this.int16[S+5]=g,this.int16[S+6]=v,this.int16[S+7]=T,e}}Vt.prototype.bytesPerElement=16,Rt(Vt,"StructArrayLayout3i2i2i16");class tr extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,s,l,p)}emplace(e,r,s,l,p,g){const v=4*e,T=8*e;return this.float32[v+0]=r,this.float32[v+1]=s,this.float32[v+2]=l,this.int16[T+6]=p,this.int16[T+7]=g,e}}tr.prototype.bytesPerElement=16,Rt(tr,"StructArrayLayout2f1f2i16");class Sr extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,l)}emplace(e,r,s,l,p){const g=12*e,v=3*e;return this.uint8[g+0]=r,this.uint8[g+1]=s,this.float32[v+1]=l,this.float32[v+2]=p,e}}Sr.prototype.bytesPerElement=12,Rt(Sr,"StructArrayLayout2ub2f12");class Pr extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const p=3*e;return this.float32[p+0]=r,this.float32[p+1]=s,this.float32[p+2]=l,e}}Pr.prototype.bytesPerElement=12,Rt(Pr,"StructArrayLayout3f12");class Zt extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,s)}emplace(e,r,s,l){const p=3*e;return this.uint16[p+0]=r,this.uint16[p+1]=s,this.uint16[p+2]=l,e}}Zt.prototype.bytesPerElement=6,Rt(Zt,"StructArrayLayout3ui6");class Dr extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,p,g,v,T,S,P,D,L,U,V,q,ee,ae,me,oe,fe,be){const _e=this.length;return this.resize(_e+1),this.emplace(_e,e,r,s,l,p,g,v,T,S,P,D,L,U,V,q,ee,ae,me,oe,fe,be)}emplace(e,r,s,l,p,g,v,T,S,P,D,L,U,V,q,ee,ae,me,oe,fe,be,_e){const qe=30*e,Oe=15*e,ot=60*e;return this.int16[qe+0]=r,this.int16[qe+1]=s,this.int16[qe+2]=l,this.float32[Oe+2]=p,this.float32[Oe+3]=g,this.uint16[qe+8]=v,this.uint16[qe+9]=T,this.uint32[Oe+5]=S,this.uint32[Oe+6]=P,this.uint32[Oe+7]=D,this.uint16[qe+16]=L,this.uint16[qe+17]=U,this.uint16[qe+18]=V,this.float32[Oe+10]=q,this.float32[Oe+11]=ee,this.uint8[ot+48]=ae,this.uint8[ot+49]=me,this.uint8[ot+50]=oe,this.uint32[Oe+13]=fe,this.int16[qe+28]=be,this.uint8[ot+58]=_e,e}}Dr.prototype.bytesPerElement=60,Rt(Dr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Xr extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,p,g,v,T,S,P,D,L,U,V,q,ee,ae,me,oe,fe,be,_e,qe,Oe,ot,bt,Xe,ut,ht,gt){const Ct=this.length;return this.resize(Ct+1),this.emplace(Ct,e,r,s,l,p,g,v,T,S,P,D,L,U,V,q,ee,ae,me,oe,fe,be,_e,qe,Oe,ot,bt,Xe,ut,ht,gt)}emplace(e,r,s,l,p,g,v,T,S,P,D,L,U,V,q,ee,ae,me,oe,fe,be,_e,qe,Oe,ot,bt,Xe,ut,ht,gt,Ct){const st=38*e,Lt=19*e;return this.int16[st+0]=r,this.int16[st+1]=s,this.int16[st+2]=l,this.float32[Lt+2]=p,this.float32[Lt+3]=g,this.int16[st+8]=v,this.int16[st+9]=T,this.int16[st+10]=S,this.int16[st+11]=P,this.int16[st+12]=D,this.int16[st+13]=L,this.uint16[st+14]=U,this.uint16[st+15]=V,this.uint16[st+16]=q,this.uint16[st+17]=ee,this.uint16[st+18]=ae,this.uint16[st+19]=me,this.uint16[st+20]=oe,this.uint16[st+21]=fe,this.uint16[st+22]=be,this.uint16[st+23]=_e,this.uint16[st+24]=qe,this.uint16[st+25]=Oe,this.uint16[st+26]=ot,this.uint16[st+27]=bt,this.uint16[st+28]=Xe,this.uint32[Lt+15]=ut,this.float32[Lt+16]=ht,this.float32[Lt+17]=gt,this.float32[Lt+18]=Ct,e}}Xr.prototype.bytesPerElement=76,Rt(Xr,"StructArrayLayout3i2f6i15ui1ul3f76");class Kr extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Kr.prototype.bytesPerElement=4,Rt(Kr,"StructArrayLayout1f4");class qr extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,s,l,p)}emplace(e,r,s,l,p,g){const v=5*e;return this.float32[v+0]=r,this.float32[v+1]=s,this.float32[v+2]=l,this.float32[v+3]=p,this.float32[v+4]=g,e}}qr.prototype.bytesPerElement=20,Rt(qr,"StructArrayLayout5f20");class mi extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,l)}emplace(e,r,s,l,p){const g=6*e;return this.uint32[3*e+0]=r,this.uint16[g+2]=s,this.uint16[g+3]=l,this.uint16[g+4]=p,e}}mi.prototype.bytesPerElement=12,Rt(mi,"StructArrayLayout1ul3ui12");class In extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=s,e}}In.prototype.bytesPerElement=4,Rt(In,"StructArrayLayout2ui4");class us extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}us.prototype.bytesPerElement=2,Rt(us,"StructArrayLayout1ui2");class Cs extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=s,e}}Cs.prototype.bytesPerElement=8,Rt(Cs,"StructArrayLayout2f8");class _r extends Se{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}_r.prototype.size=40;class tn extends or{get(e){return new _r(this,e)}}Rt(tn,"CollisionBoxArray");class $r extends Se{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}$r.prototype.size=60;class jn extends Dr{get(e){return new $r(this,e)}}Rt(jn,"PlacedSymbolArray");class gi extends Se{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}gi.prototype.size=76;class ln extends Xr{get(e){return new gi(this,e)}}Rt(ln,"SymbolInstanceArray");class Hn extends Kr{getoffsetX(e){return this.float32[1*e+0]}}Rt(Hn,"GlyphOffsetArray");class bn extends yt{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Rt(bn,"SymbolLineVertexArray");class kn extends Se{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}kn.prototype.size=12;class Bn extends mi{get(e){return new kn(this,e)}}Rt(Bn,"FeatureIndexArray");class Ms extends In{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Rt(Ms,"FillExtrusionCentroidArray");const As=Ie([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),$s=Ie([{name:"a_dash",components:4,type:"Uint16"}]);var fu={exports:{}},Xn={exports:{}};Xn.exports=function(t,e){var r,s,l,p,g,v,T,S;for(s=t.length-(r=3&t.length),l=e,g=3432918353,v=461845907,S=0;S<s;)T=255&t.charCodeAt(S)|(255&t.charCodeAt(++S))<<8|(255&t.charCodeAt(++S))<<16|(255&t.charCodeAt(++S))<<24,++S,l=27492+(65535&(p=5*(65535&(l=(l^=T=(65535&(T=(T=(65535&T)*g+(((T>>>16)*g&65535)<<16)&4294967295)<<15|T>>>17))*v+(((T>>>16)*v&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(T=0,r){case 3:T^=(255&t.charCodeAt(S+2))<<16;case 2:T^=(255&t.charCodeAt(S+1))<<8;case 1:l^=T=(65535&(T=(T=(65535&(T^=255&t.charCodeAt(S)))*g+(((T>>>16)*g&65535)<<16)&4294967295)<<15|T>>>17))*v+(((T>>>16)*v&65535)<<16)&4294967295}return l^=t.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var bc=Xn.exports,xd={exports:{}};xd.exports=function(t,e){for(var r,s=t.length,l=e^s,p=0;s>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(p)|(255&t.charCodeAt(++p))<<8|(255&t.charCodeAt(++p))<<16|(255&t.charCodeAt(++p))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++p;switch(s){case 3:l^=(255&t.charCodeAt(p+2))<<16;case 2:l^=(255&t.charCodeAt(p+1))<<8;case 1:l=1540483477*(65535&(l^=255&t.charCodeAt(p)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var _d=bc,ro=xd.exports;fu.exports=_d,fu.exports.murmur3=_d,fu.exports.murmur2=ro;var Ps=dt(fu.exports);class Cl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,l){this.ids.push(vd(e)),this.positions.push(r,s,l)}getPositions(e){const r=vd(e);let s=0,l=this.ids.length-1;for(;s<l;){const g=s+l>>1;this.ids[g]>=r?l=g:s=g+1}const p=[];for(;this.ids[s]===r;)p.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return p}static serialize(e,r){const s=new Float64Array(e.ids),l=new Uint32Array(e.positions);return yh(s,l,0,s.length-1),r&&r.push(s.buffer,l.buffer),{ids:s,positions:l}}static deserialize(e){const r=new Cl;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function vd(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Ps(String(t))}function yh(t,e,r,s){for(;r<s;){const l=t[r+s>>1];let p=r-1,g=s+1;for(;;){do p++;while(t[p]<l);do g--;while(t[g]>l);if(p>=g)break;xh(t,p,g),xh(e,3*p,3*g),xh(e,3*p+1,3*g+1),xh(e,3*p+2,3*g+2)}g-r<s-g?(yh(t,e,r,g),r=g+1):(yh(t,e,g+1,s),s=g)}}function xh(t,e,r){const s=t[e];t[e]=t[r],t[r]=s}Rt(Cl,"FeaturePositionMap");class no{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class _h extends no{constructor(e){super(e),this.current=0}set(e,r,s){this.fetchUniformLocation(e,r)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Mp extends no{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,s){this.fetchUniformLocation(e,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Ap extends no{constructor(e){super(e),this.current=on.transparent}set(e,r,s){this.fetchUniformLocation(e,r)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const Hf=new Float32Array(16),Xf=new Float32Array(9),Kf=new Float32Array(4);function wc(t){return[ke(255*t.r,255*t.g),ke(255*t.b,255*t.a)]}class mu{constructor(e,r,s){this.value=e,this.uniformNames=r.map((l=>`u_${l}`)),this.type=s}setUniform(e,r,s,l,p){r.set(e,p,l.constantOr(this.value))}getBinding(e,r){return this.type==="color"?new Ap(e):new _h(e)}}class Lo{constructor(e,r){this.uniformNames=r.map((s=>`u_${s}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,s,l,p){const g=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;g&&r.set(e,p,g)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new Mp(e):new _h(e)}}class la{constructor(e,r,s,l){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map((p=>({name:`a_${p}`,type:"Float32",components:s==="color"?2:1,offset:0}))),this.paintVertexArray=new l}populatePaintArray(e,r,s,l,p,g){const v=this.paintVertexArray.length,T=this.expression.evaluate(new j(0),r,{},p,l,g);this.paintVertexArray.resize(e),this._setPaintValue(v,e,T)}updatePaintArray(e,r,s,l,p){const g=this.expression.evaluate({zoom:0},s,l,void 0,p);this._setPaintValue(e,r,g)}_setPaintValue(e,r,s){if(this.type==="color"){const l=wc(s);for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ca{constructor(e,r,s,l,p,g){this.expression=e,this.uniformNames=r.map((v=>`u_${v}_t`)),this.type=s,this.useIntegerZoom=l,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map((v=>({name:`a_${v}`,type:"Float32",components:s==="color"?4:2,offset:0}))),this.paintVertexArray=new g}populatePaintArray(e,r,s,l,p,g){const v=this.expression.evaluate(new j(this.zoom),r,{},p,l,g),T=this.expression.evaluate(new j(this.zoom+1),r,{},p,l,g),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,v,T)}updatePaintArray(e,r,s,l,p){const g=this.expression.evaluate({zoom:this.zoom},s,l,void 0,p),v=this.expression.evaluate({zoom:this.zoom+1},s,l,void 0,p);this._setPaintValue(e,r,g,v)}_setPaintValue(e,r,s,l){if(this.type==="color"){const p=wc(s),g=wc(l);for(let v=e;v<r;v++)this.paintVertexArray.emplace(v,p[0],p[1],g[0],g[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,s,l,p){const g=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,v=Be(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);r.set(e,p,v)}getBinding(e,r){return new _h(e)}}class io{constructor(e,r,s,l,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(s==="array"?$s:As).members;for(let g=0;g<r.length;++g);this.paintVertexArray=new l}populatePaintArray(e,r,s){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,l,p,g){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],g)}_setPaintValues(e,r,s,l){if(!l||!s)return;const p=l[s];if(!p)return;const{tl:g,br:v,pixelRatio:T}=p;for(let S=e;S<r;S++)this.paintVertexArray.emplace(S,g[0],g[1],v[0],v[1],T)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ro{constructor(e,r,s=(()=>!0)){this.binders={},this._buffers=[];const l=[];for(const p in e.paint._values){if(!s(p))continue;const g=e.paint.get(p);if(!(g instanceof ne&&Eo(g.property.specification)))continue;const v=Jf(p,e.type),T=g.value,S=g.property.specification.type,P=!!g.property.useIntegerZoom,D=p==="line-dasharray"||p.endsWith("pattern"),L=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(T.kind!=="constant"||L)if(T.kind==="source"||L||D){const U=Ip(p,S,"source");this.binders[p]=D?new io(T,v,S,U,e.id):new la(T,v,S,U),l.push(`/a_${p}`)}else{const U=Ip(p,S,"composite");this.binders[p]=new ca(T,v,S,P,r,U),l.push(`/z_${p}`)}else this.binders[p]=D?new Lo(T.value,v):new mu(T.value,v,S),l.push(`/u_${p}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof la||r instanceof ca?r.maxValue:0}populatePaintArrays(e,r,s,l,p,g){for(const v in this.binders){const T=this.binders[v];(T instanceof la||T instanceof ca||T instanceof io)&&T.populatePaintArray(e,r,s,l,p,g)}}setConstantPatternPositions(e){for(const r in this.binders){const s=this.binders[r];s instanceof Lo&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,r,s,l,p,g){let v=!1;for(const T in e){const S=r.getPositions(T);for(const P of S){const D=s.feature(P.index);for(const L in this.binders){const U=this.binders[L];if((U instanceof la||U instanceof ca||U instanceof io)&&U.expression.isStateDependent===!0){const V=l.paint.get(L);U.expression=V.value,U.updatePaintArray(P.start,P.end,D,e[T],p,g),v=!0}}}}return v}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof mu||s instanceof Lo)&&e.push(...s.uniformNames.map((l=>`#define HAS_UNIFORM_${l}`)))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof la||s instanceof ca||s instanceof io)for(let l=0;l<s.paintVertexAttributes.length;l++)e.push(s.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof mu||s instanceof Lo||s instanceof ca)for(const l of s.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof mu||l instanceof Lo||l instanceof ca)for(const p of l.uniformNames)r.push({name:p,property:s,binding:l.getBinding(e,p)})}return r}setUniforms(e,r,s,l,p){for(const{name:g,property:v,binding:T}of s)this.binders[v].setUniform(e,T,p,l.get(v),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof la||r instanceof ca||r instanceof io)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof la||s instanceof ca||s instanceof io)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof la||r instanceof ca||r instanceof io)&&r.destroy()}}}class Ml{constructor(e,r,s=(()=>!0)){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Ro(l,r,s);this.needsUpload=!1,this._featureMap=new Cl,this._bufferOffset=0}populatePaintArrays(e,r,s,l,p,g,v){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,r,l,p,g,v);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,l,p){for(const g of s)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,r,g,l,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Yf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Jf(t,e){return Yf[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Pp={"line-pattern":{source:Ue,composite:Ue},"fill-pattern":{source:Ue,composite:Ue},"fill-extrusion-pattern":{source:Ue,composite:Ue},"line-dasharray":{source:it,composite:it}},Qf={color:{source:Cs,composite:mt},number:{source:Kr,composite:Cs}};function Ip(t,e,r){const s=Pp[t];return s&&s[r]||Qf[e][r]}Rt(mu,"ConstantBinder"),Rt(Lo,"PatternConstantBinder"),Rt(la,"SourceExpressionBinder"),Rt(io,"PatternCompositeBinder"),Rt(ca,"CompositeExpressionBinder"),Rt(Ro,"ProgramConfiguration",{omit:["_buffers"]}),Rt(Ml,"ProgramConfigurationSet");const jp="-transition";class Pa extends Vi{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new ie(r.layout)),r.paint)){this._transitionablePaint=new G(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new se(r.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(Io,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return Vn(e,jp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(Xi,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(Vn(e,jp))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[e],p=l.value.isDataDriven(),g=l.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const v=this._transitionablePaint._values[e].value,T=v.isDataDriven(),S=Vn(e,"pattern")||e==="line-dasharray";return T||p||S||this._handleOverridablePaintPropertyUpdate(e,g,v)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ei(e,((r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length)))}_validate(e,r,s,l,p={}){return(!p||p.validate!==!1)&&Li(this,e.call(bi,{key:r,layerType:this.type,objectKey:s,value:l,styleSpec:at,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof ne&&Eo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=vl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const em=Ie([{name:"a_pos",components:2,type:"Int16"}],4),dg=Ie([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Wn{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,l){let p=this.segments[this.segments.length-1];return e>Wn.MAX_VERTEX_ARRAY_LENGTH&&Gr(`Max vertices per segment is ${Wn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Wn.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==l)&&(p={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},l!==void 0&&(p.sortKey=l),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,l){return new Wn([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}Wn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Rt(Wn,"SegmentVector");var Qt=8192;class zo{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof rr?new rr(e.lng,e.lat):rr.convert(e),this}setSouthWest(e){return this._sw=e instanceof rr?new rr(e.lng,e.lat):rr.convert(e),this}extend(e){const r=this._sw,s=this._ne;let l,p;if(e instanceof rr)l=e,p=e;else{if(!(e instanceof zo))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(zo.convert(e)):this.extend(rr.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(rr.convert(e)):this;if(l=e._sw,p=e._ne,!l||!p)return this}return r||s?(r.lng=Math.min(l.lng,r.lng),r.lat=Math.min(l.lat,r.lat),s.lng=Math.max(p.lng,s.lng),s.lat=Math.max(p.lat,s.lat)):(this._sw=new rr(l.lng,l.lat),this._ne=new rr(p.lng,p.lat)),this}getCenter(){return new rr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new rr(this.getWest(),this.getNorth())}getSouthEast(){return new rr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:s}=rr.convert(e);let l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&l}static convert(e){return!e||e instanceof zo?e:new zo(e)}}var vh=1e-6,Ri=typeof Float32Array<"u"?Float32Array:Array;function tm(){var t=new Ri(9);return Ri!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function rm(t,e,r){var s=e[0],l=e[1],p=e[2],g=e[3],v=e[4],T=e[5],S=e[6],P=e[7],D=e[8],L=r[0],U=r[1],V=r[2],q=r[3],ee=r[4],ae=r[5],me=r[6],oe=r[7],fe=r[8];return t[0]=L*s+U*g+V*S,t[1]=L*l+U*v+V*P,t[2]=L*p+U*T+V*D,t[3]=q*s+ee*g+ae*S,t[4]=q*l+ee*v+ae*P,t[5]=q*p+ee*T+ae*D,t[6]=me*s+oe*g+fe*S,t[7]=me*l+oe*v+fe*P,t[8]=me*p+oe*T+fe*D,t}function Ia(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Gs(t,e){var r=e[0],s=e[1],l=e[2],p=e[3],g=e[4],v=e[5],T=e[6],S=e[7],P=e[8],D=e[9],L=e[10],U=e[11],V=e[12],q=e[13],ee=e[14],ae=e[15],me=r*v-s*g,oe=r*T-l*g,fe=r*S-p*g,be=s*T-l*v,_e=s*S-p*v,qe=l*S-p*T,Oe=P*q-D*V,ot=P*ee-L*V,bt=P*ae-U*V,Xe=D*ee-L*q,ut=D*ae-U*q,ht=L*ae-U*ee,gt=me*ht-oe*ut+fe*Xe+be*bt-_e*ot+qe*Oe;return gt?(t[0]=(v*ht-T*ut+S*Xe)*(gt=1/gt),t[1]=(l*ut-s*ht-p*Xe)*gt,t[2]=(q*qe-ee*_e+ae*be)*gt,t[3]=(L*_e-D*qe-U*be)*gt,t[4]=(T*bt-g*ht-S*ot)*gt,t[5]=(r*ht-l*bt+p*ot)*gt,t[6]=(ee*fe-V*qe-ae*oe)*gt,t[7]=(P*qe-L*fe+U*oe)*gt,t[8]=(g*ut-v*bt+S*Oe)*gt,t[9]=(s*bt-r*ut-p*Oe)*gt,t[10]=(V*_e-q*fe+ae*me)*gt,t[11]=(D*fe-P*_e-U*me)*gt,t[12]=(v*ot-g*Xe-T*Oe)*gt,t[13]=(r*Xe-s*ot+l*Oe)*gt,t[14]=(q*oe-V*be-ee*me)*gt,t[15]=(P*be-D*oe+L*me)*gt,t):null}function Bo(t,e,r){var s=e[0],l=e[1],p=e[2],g=e[3],v=e[4],T=e[5],S=e[6],P=e[7],D=e[8],L=e[9],U=e[10],V=e[11],q=e[12],ee=e[13],ae=e[14],me=e[15],oe=r[0],fe=r[1],be=r[2],_e=r[3];return t[0]=oe*s+fe*v+be*D+_e*q,t[1]=oe*l+fe*T+be*L+_e*ee,t[2]=oe*p+fe*S+be*U+_e*ae,t[3]=oe*g+fe*P+be*V+_e*me,t[4]=(oe=r[4])*s+(fe=r[5])*v+(be=r[6])*D+(_e=r[7])*q,t[5]=oe*l+fe*T+be*L+_e*ee,t[6]=oe*p+fe*S+be*U+_e*ae,t[7]=oe*g+fe*P+be*V+_e*me,t[8]=(oe=r[8])*s+(fe=r[9])*v+(be=r[10])*D+(_e=r[11])*q,t[9]=oe*l+fe*T+be*L+_e*ee,t[10]=oe*p+fe*S+be*U+_e*ae,t[11]=oe*g+fe*P+be*V+_e*me,t[12]=(oe=r[12])*s+(fe=r[13])*v+(be=r[14])*D+(_e=r[15])*q,t[13]=oe*l+fe*T+be*L+_e*ee,t[14]=oe*p+fe*S+be*U+_e*ae,t[15]=oe*g+fe*P+be*V+_e*me,t}function Al(t,e,r){var s,l,p,g,v,T,S,P,D,L,U,V,q=r[0],ee=r[1],ae=r[2];return e===t?(t[12]=e[0]*q+e[4]*ee+e[8]*ae+e[12],t[13]=e[1]*q+e[5]*ee+e[9]*ae+e[13],t[14]=e[2]*q+e[6]*ee+e[10]*ae+e[14],t[15]=e[3]*q+e[7]*ee+e[11]*ae+e[15]):(l=e[1],p=e[2],g=e[3],v=e[4],T=e[5],S=e[6],P=e[7],D=e[8],L=e[9],U=e[10],V=e[11],t[0]=s=e[0],t[1]=l,t[2]=p,t[3]=g,t[4]=v,t[5]=T,t[6]=S,t[7]=P,t[8]=D,t[9]=L,t[10]=U,t[11]=V,t[12]=s*q+v*ee+D*ae+e[12],t[13]=l*q+T*ee+L*ae+e[13],t[14]=p*q+S*ee+U*ae+e[14],t[15]=g*q+P*ee+V*ae+e[15]),t}function Pl(t,e,r){var s=r[0],l=r[1],p=r[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*l,t[5]=e[5]*l,t[6]=e[6]*l,t[7]=e[7]*l,t[8]=e[8]*p,t[9]=e[9]*p,t[10]=e[10]*p,t[11]=e[11]*p,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function bd(t,e,r){var s=Math.sin(r),l=Math.cos(r),p=e[4],g=e[5],v=e[6],T=e[7],S=e[8],P=e[9],D=e[10],L=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=p*l+S*s,t[5]=g*l+P*s,t[6]=v*l+D*s,t[7]=T*l+L*s,t[8]=S*l-p*s,t[9]=P*l-g*s,t[10]=D*l-v*s,t[11]=L*l-T*s,t}function bh(t,e,r){var s=Math.sin(r),l=Math.cos(r),p=e[0],g=e[1],v=e[2],T=e[3],S=e[8],P=e[9],D=e[10],L=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=p*l-S*s,t[1]=g*l-P*s,t[2]=v*l-D*s,t[3]=T*l-L*s,t[8]=p*s+S*l,t[9]=g*s+P*l,t[10]=v*s+D*l,t[11]=T*s+L*l,t}function wd(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Tc(t,e,r){var s,l,p,g=r[0],v=r[1],T=r[2],S=Math.hypot(g,v,T);return S<vh?null:(g*=S=1/S,v*=S,T*=S,s=Math.sin(e),l=Math.cos(e),t[0]=g*g*(p=1-l)+l,t[1]=v*g*p+T*s,t[2]=T*g*p-v*s,t[3]=0,t[4]=g*v*p-T*s,t[5]=v*v*p+l,t[6]=T*v*p+g*s,t[7]=0,t[8]=g*T*p+v*s,t[9]=v*T*p-g*s,t[10]=T*T*p+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Np=Bo;function wh(){var t=new Ri(3);return Ri!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function nm(t){var e=new Ri(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function gu(t){return Math.hypot(t[0],t[1],t[2])}function kc(t,e,r){var s=new Ri(3);return s[0]=t,s[1]=e,s[2]=r,s}function so(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function Td(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Dp(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Th(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function Ci(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function Sn(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function yu(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t}function zi(t,e){var r=e[0],s=e[1],l=e[2],p=r*r+s*s+l*l;return p>0&&(p=1/Math.sqrt(p)),t[0]=e[0]*p,t[1]=e[1]*p,t[2]=e[2]*p,t}function Ws(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function kd(t,e,r){var s=e[0],l=e[1],p=e[2],g=r[0],v=r[1],T=r[2];return t[0]=l*T-p*v,t[1]=p*g-s*T,t[2]=s*v-l*g,t}function Nn(t,e,r){var s=e[0],l=e[1],p=e[2],g=r[3]*s+r[7]*l+r[11]*p+r[15];return t[0]=(r[0]*s+r[4]*l+r[8]*p+r[12])/(g=g||1),t[1]=(r[1]*s+r[5]*l+r[9]*p+r[13])/g,t[2]=(r[2]*s+r[6]*l+r[10]*p+r[14])/g,t}function Sd(t,e,r){var s=r[0],l=r[1],p=r[2],g=e[0],v=e[1],T=e[2],S=l*T-p*v,P=p*g-s*T,D=s*v-l*g,L=l*D-p*P,U=p*S-s*D,V=s*P-l*S,q=2*r[3];return P*=q,D*=q,U*=2,V*=2,t[0]=g+(S*=q)+(L*=2),t[1]=v+P+U,t[2]=T+D+V,t}var xu,qs=Td,im=Dp,sm=gu;function Ed(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Cd(t,e){var r=e[0],s=e[1],l=e[2],p=e[3],g=r*r+s*s+l*l+p*p;return g>0&&(g=1/Math.sqrt(g)),t[0]=r*g,t[1]=s*g,t[2]=l*g,t[3]=p*g,t}function Il(t,e,r){var s=e[0],l=e[1],p=e[2],g=e[3];return t[0]=r[0]*s+r[4]*l+r[8]*p+r[12]*g,t[1]=r[1]*s+r[5]*l+r[9]*p+r[13]*g,t[2]=r[2]*s+r[6]*l+r[10]*p+r[14]*g,t[3]=r[3]*s+r[7]*l+r[11]*p+r[15]*g,t}function Md(){var t=new Ri(4);return Ri!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function kh(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function am(t,e,r){r*=.5;var s=e[0],l=e[1],p=e[2],g=e[3],v=Math.sin(r),T=Math.cos(r);return t[0]=s*T+g*v,t[1]=l*T+p*v,t[2]=p*T-l*v,t[3]=g*T-s*v,t}function Lp(t,e,r){r*=.5;var s=e[0],l=e[1],p=e[2],g=e[3],v=Math.sin(r),T=Math.cos(r);return t[0]=s*T-p*v,t[1]=l*T+g*v,t[2]=p*T+s*v,t[3]=g*T-l*v,t}wh(),xu=new Ri(4),Ri!=Float32Array&&(xu[0]=0,xu[1]=0,xu[2]=0,xu[3]=0);var Rp=Cd;wh(),kc(1,0,0),kc(0,1,0),Md(),Md(),tm();const om=Ie([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Sh}=om,ao=Ie([{name:"a_pos_3",components:3,type:"Int16"}]);var Eh=Ie([{name:"a_pos",type:"Int16",components:2}]);class Ad{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,s){const l=Ws(r,this.dir);if(Math.abs(l)<1e-6)return!1;const p=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/l;return s[0]=this.pos[0]+this.dir[0]*p,s[1]=this.pos[1]+this.dir[1]*p,s[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,r,s){if((function(U,V){var q=U[0],ee=U[1],ae=U[2],me=V[0],oe=V[1],fe=V[2];return Math.abs(q-me)<=vh*Math.max(1,Math.abs(q),Math.abs(me))&&Math.abs(ee-oe)<=vh*Math.max(1,Math.abs(ee),Math.abs(oe))&&Math.abs(ae-fe)<=vh*Math.max(1,Math.abs(ae),Math.abs(fe))})(this.pos,e)||r===0)return s[0]=s[1]=s[2]=0,!1;const[l,p,g]=this.dir,v=this.pos[0]-e[0],T=this.pos[1]-e[1],S=this.pos[2]-e[2],P=l*l+p*p+g*g,D=2*(v*l+T*p+S*g),L=D*D-4*P*(v*v+T*T+S*S-r*r);if(L<0){const U=Math.max(-D/2,0),V=v+l*U,q=T+p*U,ee=S+g*U,ae=Math.hypot(V,q,ee);return s[0]=V*r/ae,s[1]=q*r/ae,s[2]=ee*r/ae,!1}{const U=(-D-Math.sqrt(L))/(2*P);if(U<0){const V=Math.hypot(v,T,S);return s[0]=v*r/V,s[1]=T*r/V,s[2]=S*r/V,!1}return s[0]=v+l*U,s[1]=T+p*U,s[2]=S+g*U,!0}}}class Ch{constructor(e,r,s,l,p){this.TL=e,this.TR=r,this.BR=s,this.BL=l,this.horizon=p}static fromInvProjectionMatrix(e,r,s){const l=[-1,1,1],p=[1,1,1],g=[1,-1,1],v=[-1,-1,1],T=Nn(l,l,e),S=Nn(p,p,e),P=Nn(g,g,e),D=Nn(v,v,e);return new Ch(T,S,P,D,r/s)}}class Pd{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,s,l){const p=Math.pow(2,s),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((T=>{const S=Il([],T,e),P=1/S[3]/r*p;return(function(D,L,U){return D[0]=L[0]*U[0],D[1]=L[1]*U[1],D[2]=L[2]*U[2],D[3]=L[3]*U[3],D})(S,S,[P,P,l?1/S[3]:P,P])})),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((T=>{const S=zi([],kd([],qs([],g[T[0]],g[T[1]]),qs([],g[T[2]],g[T[1]]))),P=-Ws(S,g[T[1]]);return S.concat(P)}));return new Pd(g,v)}}class Bi{static fromPoints(e){const r=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const l of e)Th(r,r,l),Ci(s,s,l);return new Bi(r,s)}static applyTransform(e,r){const s=e.getCorners();for(let l=0;l<s.length;++l)Nn(s[l],s[l],r);return Bi.fromPoints(s)}constructor(e,r){this.min=e,this.max=r,this.center=Sn([],so([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],s=nm(this.min),l=nm(this.max);for(let p=0;p<r.length;p++)s[p]=r[p]?this.min[p]:this.center[p],l[p]=r[p]?this.center[p]:this.max[p];return l[2]=this.max[2],new Bi(s,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let s=!0;for(let l=0;l<e.planes.length;l++){const p=e.planes[l];let g=0;for(let v=0;v<r.length;v++)g+=Ws(p,r[v])+p[3]>=0;if(g===0)return 0;g!==r.length&&(s=!1)}if(s)return 2;for(let l=0;l<3;l++){let p=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let v=0;v<e.points.length;v++){const T=e.points[v][l]-this.min[l];p=Math.min(p,T),g=Math.max(g,T)}if(g<0||p>this.max[l]-this.min[l])return 0}return 1}}const Sc=5,Fi=6,oo=Qt/Math.PI/2,pg=16383,lo=64,yi=[lo,32,16],ua=-oo,$t=oo,_u=[new Bi([ua,ua,ua],[$t,$t,$t]),new Bi([ua,ua,ua],[0,0,$t]),new Bi([0,ua,ua],[$t,0,$t]),new Bi([ua,0,ua],[0,$t,$t]),new Bi([0,0,ua],[$t,$t,$t])];function vu(t){return t*oo/jl}function zp(t,e,r,s=!0){const l=Sn([],t._camera.position,t.worldSize),p=[e,r,1,1];Il(p,p,t.pixelMatrixInverse),Ed(p,p,1/p[3]);const g=zi([],qs([],p,l)),v=t.globeMatrix,T=[v[12],v[13],v[14]],S=qs([],T,l),P=gu(S),D=zi([],S),L=t.worldSize/(2*Math.PI),U=Ws(D,g),V=Math.asin(L/P);if(V<Math.acos(U)){if(!s)return null;const bt=[],Xe=[];Sn(bt,g,P/U),zi(Xe,qs(Xe,bt,S)),zi(g,so(g,S,Sn(g,Xe,Math.tan(V)*P)))}const q=[];new Ad(l,g).closestPointOnSphere(T,L,q);const ee=zi([],dr(v,0)),ae=zi([],dr(v,1)),me=zi([],dr(v,2)),oe=Ws(ee,q),fe=Ws(ae,q),be=Ws(me,q),_e=Kt(Math.asin(-fe/L));let qe=Kt(Math.atan2(oe,be));qe=t.center.lng+(function(bt,Xe){const ut=(Xe-bt+180)%360-180;return ut<-180?ut+360:ut})(t.center.lng,qe);const Oe=pn(qe),ot=Be(Mn(_e),0,1);return new Nl(Oe,ot)}class fg{constructor(e,r,s){this.a=qs([],e,s),this.b=qs([],r,s),this.center=s;const l=zi([],this.a),p=zi([],this.b);this.angle=Math.acos(Ws(l,p))}}function Ec(t,e){if(t.angle===0)return null;let r;return r=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),r<0||r>1?null:(function(s,l,p,g){const v=Math.sin(p);return s*(Math.sin((1-g)*p)/v)+l*(Math.sin(g*p)/v)})(t.a[e],t.b[e],t.angle,Be(r,0,1))+t.center[e]}function Zs(t){if(t.z<=1)return _u[t.z+2*t.y+t.x];const e=Mh(bu(t));return Bi.fromPoints(e)}function Fo(t,e,r){return Sn(t,t,1-r),yu(t,t,e,r)}function Bp(t,e){const r=wu(e.zoom);if(r===0)return Zs(t);const s=bu(t),l=Mh(s),p=pn(s.getWest())*e.worldSize,g=pn(s.getEast())*e.worldSize,v=Mn(s.getNorth())*e.worldSize,T=Mn(s.getSouth())*e.worldSize,S=[p,v,0],P=[g,v,0],D=[p,T,0],L=[g,T,0],U=Gs([],e.globeMatrix);return Nn(S,S,U),Nn(P,P,U),Nn(D,D,U),Nn(L,L,U),l[0]=Fo(l[0],D,r),l[1]=Fo(l[1],L,r),l[2]=Fo(l[2],P,r),l[3]=Fo(l[3],S,r),Bi.fromPoints(l)}function Fp(t,e,r){for(const s of t)Nn(s,s,e),Sn(s,s,r)}function lm(t,e,r){const s=e/t.worldSize,l=t.globeMatrix;if(r.z<=1){const Oe=Zs(r).getCorners();return Fp(Oe,l,s),Bi.fromPoints(Oe)}const p=bu(r),g=Mh(p);Fp(g,l,s);const v=Number.MAX_VALUE,T=[-v,-v,-v],S=[v,v,v];if(p.contains(t.center)){for(const bt of g)Th(S,S,bt),Ci(T,T,bt);T[2]=0;const Oe=t.point,ot=[Oe.x*s,Oe.y*s,0];return Th(S,S,ot),Ci(T,T,ot),new Bi(S,T)}const P=[l[12]*s,l[13]*s,l[14]*s],D=p.getCenter(),L=Be(t.center.lat,-Fn,Fn),U=Be(D.lat,-Fn,Fn),V=pn(t.center.lng),q=Mn(L);let ee=V-pn(D.lng);const ae=q-Mn(U);ee>.5?ee-=1:ee<-.5&&(ee+=1);let me=0;Math.abs(ee)>Math.abs(ae)?me=ee>=0?1:3:(me=ae>=0?0:2,yu(P,P,[l[4]*s,l[5]*s,l[6]*s],-Math.sin(ct(ae>=0?p.getSouth():p.getNorth()))*oo));const oe=g[me],fe=g[(me+1)%4],be=new fg(oe,fe,P),_e=[Ec(be,0)||oe[0],Ec(be,1)||oe[1],Ec(be,2)||oe[2]],qe=wu(t.zoom);if(qe>0){const Oe=(function({x:bt,y:Xe,z:ut},ht,gt,Ct,st){const Lt=1/(1<<ut);let Gt=bt*Lt,Ft=Gt+Lt,wr=Xe*Lt,Mt=wr+Lt,er=0;const Tr=(Gt+Ft)/2-Ct;return Tr>.5?er=-1:Tr<-.5&&(er=1),Gt=((Gt+er)*ht-(Ct*=ht))*gt+Ct,Ft=((Ft+er)*ht-Ct)*gt+Ct,wr=(wr*ht-(st*=ht))*gt+st,Mt=(Mt*ht-st)*gt+st,[[Gt,Mt,0],[Ft,Mt,0],[Ft,wr,0],[Gt,wr,0]]})(r,e,t._pixelsPerMercatorPixel,V,q);for(let bt=0;bt<g.length;bt++)Fo(g[bt],Oe[bt],qe);const ot=so([],Oe[me],Oe[(me+1)%4]);Sn(ot,ot,.5),Fo(_e,ot,qe)}for(const Oe of g)Th(S,S,Oe),Ci(T,T,Oe);return S[2]=Math.min(oe[2],fe[2]),Th(S,S,_e),Ci(T,T,_e),new Bi(S,T)}function bu({x:t,y:e,z:r}){const s=1/(1<<r),l=new rr(Mi(t*s),Yr((e+1)*s)),p=new rr(Mi((t+1)*s),Yr(e*s));return new zo(l,p)}function Mh(t){const e=ct(t.getNorth()),r=ct(t.getSouth()),s=Math.cos(e),l=Math.cos(r),p=Math.sin(e),g=Math.sin(r),v=t.getWest(),T=t.getEast();return[Kn(l,g,v),Kn(l,g,T),Kn(s,p,T),Kn(s,p,v)]}function Kn(t,e,r,s=oo){return r=ct(r),[t*Math.sin(r)*s,-e*s,t*Math.cos(r)*s]}function Ki(t,e,r){return Kn(Math.cos(ct(t)),Math.sin(ct(t)),e,r)}function ha(t,e,r,s){const l=1<<r.z,p=(t/Qt+r.x)/l;return Ki(Yr((e/Qt+r.y)/l),Mi(p),s)}function Ah({min:t,max:e}){return pg/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Op=new Float64Array(16);function hs(t){const e=Ah(t),r=wd(Op,[e,e,e]);return Al(r,r,((s=[])[0]=-(l=t.min)[0],s[1]=-l[1],s[2]=-l[2],s));var s,l}function Id(t){const e=(s=t.min,(r=Op)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=s[0],r[13]=s[1],r[14]=s[2],r[15]=1,r);var r,s;const l=1/Ah(t);return Pl(e,e,[l,l,l])}function ja(t,e,r,s,l){const p=(function(T){const S=Qt/(2*Math.PI);return T/(2*Math.PI)/S})(r),g=[t,e,-r/(2*Math.PI)],v=Ia(new Float64Array(16));return Al(v,v,g),Pl(v,v,[p,p,p]),bd(v,v,ct(-l)),bh(v,v,ct(-s)),v}function wu(t){return Je(Sc,Fi,t)}function Up(t,e){const r=Ki(e.lat,e.lng),s=(function(V){const q=Ki(V._center.lat,V._center.lng);let ee=kd([],kc(0,1,0),q);const ae=Tc([],-V.angle,q);ee=Nn(ee,ee,ae),Tc(ae,-V._pitch,ee);const me=zi([],q);return Sn(me,me,vu(V.cameraToCenterDistance/V.pixelsPerMeter)),Nn(me,me,ae),so([],q,me)})(t);return g=(l=Td([],s,r))[0],v=l[1],T=l[2],S=(p=r)[0],P=p[1],D=p[2],U=(L=Math.sqrt(g*g+v*v+T*T)*Math.sqrt(S*S+P*P+D*D))&&Ws(l,p)/L,Math.acos(Math.min(Math.max(U,-1),1));var l,p,g,v,T,S,P,D,L,U}function jd(t,e){return Up(t,e)>Math.PI/2*1.01}const Vp=ct(85),cm=Math.cos(Vp),mg=Math.sin(Vp),jl=63710088e-1,Nd=2*Math.PI*jl;class Ti{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ti(ve(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,l=e.lat*r,p=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return jl*Math.acos(Math.min(p,1))}toBounds(e=0){const r=360*e/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new zo(new Ti(this.lng-s,this.lat-r),new Ti(this.lng+s,this.lat+r))}toEcef(e){const r=vu(e);return Ki(this.lat,this.lng,oo+r)}static convert(e){if(e instanceof Ti)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ti(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ti(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var rr=Ti;function xi(t){return Nd*Math.cos(t*Math.PI/180)}function pn(t){return(180+t)/360}function Mn(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function qn(t,e){return t/xi(e)}function Mi(t){return 360*t-180}function Yr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Tu(t,e){return t*xi(Yr(e))}const Fn=85.051129;function Ph(t){return 1/Math.cos(t*Math.PI/180)}class Nl{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=rr.convert(e);return new Nl(pn(s.lng),Mn(s.lat),qn(r,s.lat))}toLngLat(){return new rr(Mi(this.x),Yr(this.y))}toAltitude(){return Tu(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Nd*Ph(Yr(this.y))}}function Cc(t,e,r,s,l,p,g,v,T){const S=(e+s)/2,P=(r+l)/2,D=new ge(S,P);v(D),(function(L,U,V,q,ee,ae){const me=V-ee,oe=q-ae;return Math.abs((q-U)*me-(V-L)*oe)/Math.hypot(me,oe)})(D.x,D.y,p.x,p.y,g.x,g.y)>=T?(Cc(t,e,r,S,P,p,D,v,T),Cc(t,S,P,s,l,D,g,v,T)):t.push(g)}function ds(t,e,r){let s=t[0],l=s.x,p=s.y;e(s);const g=[s];for(let v=1;v<t.length;v++){const T=t[v],{x:S,y:P}=T;e(T),Cc(g,l,p,S,P,s,T,e,r),l=S,p=P,s=T}return g}function Ih(t,e,r,s){if(s(e,r)){const l=e.add(r)._mult(.5);Ih(t,e,l,s),Ih(t,l,r,s)}else t.push(r)}function ku(t,e){let r=t[0];const s=[r];for(let l=1;l<t.length;l++){const p=t[l];Ih(s,r,p,e),r=p}return s}const Na=Math.pow(2,14)-1,jh=-Na-1;function $p(t,e){const r=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=Be(r,jh,Na),t.y=Be(s,jh,Na),(r<t.x||r>t.x+1||s<t.y||s>t.y+1)&&Gr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Yi(t,e,r){const s=t.loadGeometry(),l=t.extent,p=Qt/l;if(e&&r&&r.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:v,x:T,y:S,projection:P}=r,D=L=>{const U=Mi((e.x+L.x/l)/g),V=Yr((e.y+L.y/l)/g),q=P.project(U,V);L.x=(q.x*v-T)*l,L.y=(q.y*v-S)*l};for(let L=0;L<s.length;L++)if(t.type!==1)s[L]=ds(s[L],D,1);else{const U=[];for(const V of s[L])V.x<0||V.x>=l||V.y<0||V.y>=l||(D(V),U.push(V));s[L]=U}}for(const g of s)for(const v of g)$p(v,p);return s}function co(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Yi(t):[]}}function Da(t,e,r,s,l){t.emplaceBack(2*e+(s+1)/2,2*r+(l+1)/2)}function Mc(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Ac{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new yt,this.indexArray=new Zt,this.segments=new Wn,this.programConfigurations=new Ml(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,s,l){const p=this.layers[0],g=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:S,id:P,index:D,sourceLayerIndex:L}of e){const U=this.layers[0]._featureFilter.needGeometry,V=co(S,U);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),V,s))continue;const q=v?v.evaluate(V,{},s):void 0,ee={id:P,properties:S.properties,type:S.type,sourceLayerIndex:L,index:D,geometry:U?V.geometry:Yi(S,s,l),patterns:{},sortKey:q};g.push(ee)}v&&g.sort(((S,P)=>S.sortKey-P.sortKey));let T=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new ft,T=l.projection);for(const S of g){const{geometry:P,index:D,sourceLayerIndex:L}=S,U=e[D].feature;this.addFeature(S,P,D,r.availableImages,s,T),r.featureIndex.insert(U,P,D,L,this.index)}}update(e,r,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,em.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,dg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,s,l,p,g){for(const v of r)for(const T of v){const S=T.x,P=T.y;if(S<0||S>=Qt||P<0||P>=Qt)continue;if(g){const U=g.projectTilePoint(S,P,p),V=g.upVector(p,S,P),q=this.globeExtVertexArray;Mc(q,U,V),Mc(q,U,V),Mc(q,U,V),Mc(q,U,V)}const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),L=D.vertexLength;Da(this.layoutVertexArray,S,P,-1,-1),Da(this.layoutVertexArray,S,P,1,-1),Da(this.layoutVertexArray,S,P,1,1),Da(this.layoutVertexArray,S,P,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},l,p)}}function Dd(t,e){for(let r=0;r<t.length;r++)if(Oo(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(Oo(t,e[r]))return!0;return!!uo(t,e)}function Ld(t,e,r){return!!Oo(t,e)||!!Ji(e,t,r)}function Nh(t,e){if(t.length===1)return Rd(e,t[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let l=0;l<s.length;l++)if(Oo(t,s[l]))return!0}for(let r=0;r<t.length;r++)if(Rd(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(uo(t,e[r]))return!0;return!1}function ps(t,e,r){if(t.length>1){if(uo(t,e))return!0;for(let s=0;s<e.length;s++)if(Ji(e[s],t,r))return!0}for(let s=0;s<t.length;s++)if(Ji(t[s],e,r))return!0;return!1}function uo(t,e){if(t.length===0||e.length===0)return!1;for(let r=0;r<t.length-1;r++){const s=t[r],l=t[r+1];for(let p=0;p<e.length-1;p++)if(La(s,l,e[p],e[p+1]))return!0}return!1}function La(t,e,r,s){return sn(t,r,s)!==sn(e,r,s)&&sn(t,e,r)!==sn(t,e,s)}function Ji(t,e,r){const s=r*r;if(e.length===1)return t.distSqr(e[0])<s;for(let l=1;l<e.length;l++)if(Gp(t,e[l-1],e[l])<s)return!0;return!1}function Gp(t,e,r){const s=e.distSqr(r);if(s===0)return t.distSqr(e);const l=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/s;return t.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function Rd(t,e){let r,s,l,p=!1;for(let g=0;g<t.length;g++){r=t[g];for(let v=0,T=r.length-1;v<r.length;T=v++)s=r[v],l=r[T],s.y>e.y!=l.y>e.y&&e.x<(l.x-s.x)*(e.y-s.y)/(l.y-s.y)+s.x&&(p=!p)}return p}function Oo(t,e){let r=!1;for(let s=0,l=t.length-1;s<t.length;l=s++){const p=t[s],g=t[l];p.y>e.y!=g.y>e.y&&e.x<(g.x-p.x)*(e.y-p.y)/(g.y-p.y)+p.x&&(r=!r)}return r}function um(t,e,r,s,l){for(const g of t)if(e<=g.x&&r<=g.y&&s>=g.x&&l>=g.y)return!0;const p=[new ge(e,r),new ge(e,l),new ge(s,l),new ge(s,r)];if(t.length>2){for(const g of p)if(Oo(t,g))return!0}for(let g=0;g<t.length-1;g++)if(Dl(t[g],t[g+1],p))return!0;return!1}function Dl(t,e,r){const s=r[0],l=r[2];if(t.x<s.x&&e.x<s.x||t.x>l.x&&e.x>l.x||t.y<s.y&&e.y<s.y||t.y>l.y&&e.y>l.y)return!1;const p=sn(t,e,r[0]);return p!==sn(t,e,r[1])||p!==sn(t,e,r[2])||p!==sn(t,e,r[3])}function Pc(t,e,r){const s=e.paint.get(t).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(t)}function Su(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Ll(t,e,r,s,l){if(!e[0]&&!e[1])return t;const p=ge.convert(e)._mult(l);r==="viewport"&&p._rotate(-s);const g=[];for(let v=0;v<t.length;v++)g.push(t[v].sub(p));return g}function zd(t,e,r,s){const l=ge.convert(t)._mult(s);return e==="viewport"&&l._rotate(-r),l}Rt(Ac,"CircleBucket",{omit:["layers"]});const Ic=new ue({"circle-sort-key":new te(at.layout_circle["circle-sort-key"])});var hm={paint:new ue({"circle-radius":new te(at.paint_circle["circle-radius"]),"circle-color":new te(at.paint_circle["circle-color"]),"circle-blur":new te(at.paint_circle["circle-blur"]),"circle-opacity":new te(at.paint_circle["circle-opacity"]),"circle-translate":new W(at.paint_circle["circle-translate"]),"circle-translate-anchor":new W(at.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new W(at.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new W(at.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new te(at.paint_circle["circle-stroke-width"]),"circle-stroke-color":new te(at.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new te(at.paint_circle["circle-stroke-opacity"])}),layout:Ic};function Wp(t,e,r,s,l,p,g,v,T){if(p&&t.queryGeometry.isAboveHorizon)return!1;p&&(T*=t.pixelToTileUnitsFactor);const S=t.tileID.canonical,P=r.projection.upVectorScale(S,r.center.lat,r.worldSize).metersToTile;for(const D of e)for(const L of D){const U=L.add(v),V=l&&r.elevation?r.elevation.exaggeration()*l.getElevationAt(U.x,U.y,!0):0,q=r.projection.projectTilePoint(U.x,U.y,S);if(V>0){const oe=r.projection.upVector(S,U.x,U.y);q.x+=oe[0]*P*V,q.y+=oe[1]*P*V,q.z+=oe[2]*P*V}const ee=p?U:qp(q.x,q.y,q.z,s),ae=p?t.tilespaceRays.map((oe=>yg(oe,V))):t.queryGeometry.screenGeometry,me=Il([],[q.x,q.y,q.z,1],s);if(!g&&p?T*=me[3]/r.cameraToCenterDistance:g&&!p&&(T*=r.cameraToCenterDistance/me[3]),p){const oe=Yr((L.y/Qt+S.y)/(1<<S.z));T/=r.projection.pixelsPerMeter(oe,1)/qn(1,oe)}if(Ld(ae,ee,T))return!0}return!1}function qp(t,e,r,s){const l=Il([],[t,e,r,1],s);return new ge(l[0]/l[3],l[1]/l[3])}const Dh=kc(0,0,0),gg=kc(0,0,1);function yg(t,e){const r=wh();return Dh[2]=e,t.intersectsPlane(Dh,gg,r),new ge(r[0],r[1])}class Zp extends Ac{}function Hp(t,{width:e,height:r},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*s)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*r*s);return t.width=e,t.height=r,t.data=l,t}function Rl(t,e,r){const{width:s,height:l}=e;s===t.width&&l===t.height||(Xp(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,l)},r),t.width=s,t.height=l,t.data=e.data)}function Xp(t,e,r,s,l,p){if(l.width===0||l.height===0)return e;if(l.width>t.width||l.height>t.height||r.x>t.width-l.width||r.y>t.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||s.x>e.width-l.width||s.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const g=t.data,v=e.data;for(let T=0;T<l.height;T++){const S=((r.y+T)*t.width+r.x)*p,P=((s.y+T)*e.width+s.x)*p;for(let D=0;D<l.width*p;D++)v[P+D]=g[S+D]}return e}Rt(Zp,"HeatmapBucket",{omit:["layers"]});class Is{constructor(e,r){Hp(this,e,1,r)}resize(e){Rl(this,new Is(e),1)}clone(){return new Is({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,l,p){Xp(e,r,s,l,p,1)}}class fs{constructor(e,r){Hp(this,e,4,r)}resize(e){Rl(this,new fs(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new fs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,l,p){Xp(e,r,s,l,p,4)}}Rt(Is,"AlphaImage"),Rt(fs,"RGBAImage");var Yn={paint:new ue({"heatmap-radius":new te(at.paint_heatmap["heatmap-radius"]),"heatmap-weight":new te(at.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new W(at.paint_heatmap["heatmap-intensity"]),"heatmap-color":new le(at.paint_heatmap["heatmap-color"]),"heatmap-opacity":new W(at.paint_heatmap["heatmap-opacity"])})};function Kp(t){const e={},r=t.resolution||256,s=t.clips?t.clips.length:1,l=t.image||new fs({width:r,height:s}),p=(g,v,T)=>{e[t.evaluationKey]=T;const S=t.expression.evaluate(e);l.data[g+v+0]=Math.floor(255*S.r/S.a),l.data[g+v+1]=Math.floor(255*S.g/S.a),l.data[g+v+2]=Math.floor(255*S.b/S.a),l.data[g+v+3]=Math.floor(255*S.a)};if(t.clips)for(let g=0,v=0;g<s;++g,v+=4*r)for(let T=0,S=0;T<r;T++,S+=4){const P=T/(r-1),{start:D,end:L}=t.clips[g];p(v,S,D*(1-P)+L*P)}else for(let g=0,v=0;g<r;g++,v+=4)p(0,v,g/(r-1));return l}var dm={paint:new ue({"hillshade-illumination-direction":new W(at.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new W(at.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new W(at.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new W(at.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new W(at.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new W(at.paint_hillshade["hillshade-accent-color"])})};const xg=Ie([{name:"a_pos",components:2,type:"Int16"}],4),{members:_g}=xg;var Bd={exports:{}};function Lh(t,e,r){r=r||2;var s,l,p,g,v,T,S,P=e&&e.length,D=P?e[0]*r:t.length,L=pm(t,0,D,r,!0),U=[];if(!L||L.next===L.prev)return U;if(P&&(L=(function(q,ee,ae,me){var oe,fe,be,_e=[];for(oe=0,fe=ee.length;oe<fe;oe++)(be=pm(q,ee[oe]*me,oe<fe-1?ee[oe+1]*me:q.length,me,!1))===be.next&&(be.steiner=!0),_e.push(ef(be));for(_e.sort(Od),oe=0;oe<_e.length;oe++)ae=Yp(_e[oe],ae);return ae})(t,e,L,r)),t.length>80*r){s=p=t[0],l=g=t[1];for(var V=r;V<D;V+=r)(v=t[V])<s&&(s=v),(T=t[V+1])<l&&(l=T),v>p&&(p=v),T>g&&(g=T);S=(S=Math.max(p-s,g-l))!==0?32767/S:0}return jc(L,U,r,s,l,S,0),U}function pm(t,e,r,s,l){var p,g;if(l===Mu(t,e,r,s)>0)for(p=e;p<r;p+=s)g=Ud(p,t[p],t[p+1],g);else for(p=r-s;p>=e;p-=s)g=Ud(p,t[p],t[p+1],g);return g&&Dc(g,g.next)&&(Bl(g),g=g.next),g}function Ai(t,e){if(!t)return t;e||(e=t);var r,s=t;do if(r=!1,s.steiner||!Dc(s,s.next)&&On(s.prev,s,s.next)!==0)s=s.next;else{if(Bl(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function jc(t,e,r,s,l,p,g){if(t){!g&&p&&(function(P,D,L,U){var V=P;do V.z===0&&(V.z=Qp(V.x,V.y,D,L,U)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==P);V.prevZ.nextZ=null,V.prevZ=null,(function(q){var ee,ae,me,oe,fe,be,_e,qe,Oe=1;do{for(ae=q,q=null,fe=null,be=0;ae;){for(be++,me=ae,_e=0,ee=0;ee<Oe&&(_e++,me=me.nextZ);ee++);for(qe=Oe;_e>0||qe>0&&me;)_e!==0&&(qe===0||!me||ae.z<=me.z)?(oe=ae,ae=ae.nextZ,_e--):(oe=me,me=me.nextZ,qe--),fe?fe.nextZ=oe:q=oe,oe.prevZ=fe,fe=oe;ae=me}fe.nextZ=null,Oe*=2}while(be>1)})(V)})(t,s,l,p);for(var v,T,S=t;t.prev!==t.next;)if(v=t.prev,T=t.next,p?zl(t,s,l,p):vg(t))e.push(v.i/r|0),e.push(t.i/r|0),e.push(T.i/r|0),Bl(t),t=T.next,S=T.next;else if((t=T)===S){g?g===1?jc(t=Fd(Ai(t),e,r),e,r,s,l,p,2):g===2&&Nc(t,e,r,s,l,p):jc(Ai(t),e,r,s,l,p,1);break}}}function vg(t){var e=t.prev,r=t,s=t.next;if(On(e,r,s)>=0)return!1;for(var l=e.x,p=r.x,g=s.x,v=e.y,T=r.y,S=s.y,P=l<p?l<g?l:g:p<g?p:g,D=v<T?v<S?v:S:T<S?T:S,L=l>p?l>g?l:g:p>g?p:g,U=v>T?v>S?v:S:T>S?T:S,V=s.next;V!==e;){if(V.x>=P&&V.x<=L&&V.y>=D&&V.y<=U&&Eu(l,v,p,T,g,S,V.x,V.y)&&On(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function zl(t,e,r,s){var l=t.prev,p=t,g=t.next;if(On(l,p,g)>=0)return!1;for(var v=l.x,T=p.x,S=g.x,P=l.y,D=p.y,L=g.y,U=v<T?v<S?v:S:T<S?T:S,V=P<D?P<L?P:L:D<L?D:L,q=v>T?v>S?v:S:T>S?T:S,ee=P>D?P>L?P:L:D>L?D:L,ae=Qp(U,V,e,r,s),me=Qp(q,ee,e,r,s),oe=t.prevZ,fe=t.nextZ;oe&&oe.z>=ae&&fe&&fe.z<=me;){if(oe.x>=U&&oe.x<=q&&oe.y>=V&&oe.y<=ee&&oe!==l&&oe!==g&&Eu(v,P,T,D,S,L,oe.x,oe.y)&&On(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,fe.x>=U&&fe.x<=q&&fe.y>=V&&fe.y<=ee&&fe!==l&&fe!==g&&Eu(v,P,T,D,S,L,fe.x,fe.y)&&On(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;oe&&oe.z>=ae;){if(oe.x>=U&&oe.x<=q&&oe.y>=V&&oe.y<=ee&&oe!==l&&oe!==g&&Eu(v,P,T,D,S,L,oe.x,oe.y)&&On(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;fe&&fe.z<=me;){if(fe.x>=U&&fe.x<=q&&fe.y>=V&&fe.y<=ee&&fe!==l&&fe!==g&&Eu(v,P,T,D,S,L,fe.x,fe.y)&&On(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function Fd(t,e,r){var s=t;do{var l=s.prev,p=s.next.next;!Dc(l,p)&&Rh(l,s,s.next,p)&&Bh(l,p)&&Bh(p,l)&&(e.push(l.i/r|0),e.push(s.i/r|0),e.push(p.i/r|0),Bl(s),Bl(s.next),s=t=p),s=s.next}while(s!==t);return Ai(s)}function Nc(t,e,r,s,l,p){var g=t;do{for(var v=g.next.next;v!==g.prev;){if(g.i!==v.i&&fm(g,v)){var T=tf(g,v);return g=Ai(g,g.next),T=Ai(T,T.next),jc(g,e,r,s,l,p,0),void jc(T,e,r,s,l,p,0)}v=v.next}g=g.next}while(g!==t)}function Od(t,e){return t.x-e.x}function Yp(t,e){var r=(function(l,p){var g,v=p,T=l.x,S=l.y,P=-1/0;do{if(S<=v.y&&S>=v.next.y&&v.next.y!==v.y){var D=v.x+(S-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(D<=T&&D>P&&(P=D,g=v.x<v.next.x?v:v.next,D===T))return g}v=v.next}while(v!==p);if(!g)return null;var L,U=g,V=g.x,q=g.y,ee=1/0;v=g;do T>=v.x&&v.x>=V&&T!==v.x&&Eu(S<q?T:P,S,V,q,S<q?P:T,S,v.x,v.y)&&(L=Math.abs(S-v.y)/(T-v.x),Bh(v,l)&&(L<ee||L===ee&&(v.x>g.x||v.x===g.x&&Jp(g,v)))&&(g=v,ee=L)),v=v.next;while(v!==U);return g})(t,e);if(!r)return e;var s=tf(r,t);return Ai(s,s.next),Ai(r,r.next)}function Jp(t,e){return On(t.prev,t,e.prev)<0&&On(e.next,t,t.next)<0}function Qp(t,e,r,s,l){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ef(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Eu(t,e,r,s,l,p,g,v){return(l-g)*(e-v)>=(t-g)*(p-v)&&(t-g)*(s-v)>=(r-g)*(e-v)&&(r-g)*(p-v)>=(l-g)*(s-v)}function fm(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!(function(r,s){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==s.i&&l.next.i!==s.i&&Rh(l,l.next,r,s))return!0;l=l.next}while(l!==r);return!1})(t,e)&&(Bh(t,e)&&Bh(e,t)&&(function(r,s){var l=r,p=!1,g=(r.x+s.x)/2,v=(r.y+s.y)/2;do l.y>v!=l.next.y>v&&l.next.y!==l.y&&g<(l.next.x-l.x)*(v-l.y)/(l.next.y-l.y)+l.x&&(p=!p),l=l.next;while(l!==r);return p})(t,e)&&(On(t.prev,t,e.prev)||On(t,e.prev,e))||Dc(t,e)&&On(t.prev,t,t.next)>0&&On(e.prev,e,e.next)>0)}function On(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Dc(t,e){return t.x===e.x&&t.y===e.y}function Rh(t,e,r,s){var l=Cu(On(t,e,r)),p=Cu(On(t,e,s)),g=Cu(On(r,s,t)),v=Cu(On(r,s,e));return l!==p&&g!==v||!(l!==0||!zh(t,r,e))||!(p!==0||!zh(t,s,e))||!(g!==0||!zh(r,t,s))||!(v!==0||!zh(r,e,s))}function zh(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Cu(t){return t>0?1:t<0?-1:0}function Bh(t,e){return On(t.prev,t,t.next)<0?On(t,e,t.next)>=0&&On(t,t.prev,e)>=0:On(t,e,t.prev)<0||On(t,t.next,e)<0}function tf(t,e){var r=new Fh(t.i,t.x,t.y),s=new Fh(e.i,e.x,e.y),l=t.next,p=e.prev;return t.next=e,e.prev=t,r.next=l,l.prev=r,s.next=r,r.prev=s,p.next=s,s.prev=p,s}function Ud(t,e,r,s){var l=new Fh(t,e,r);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function Bl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Fh(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Mu(t,e,r,s){for(var l=0,p=e,g=r-s;p<r;p+=s)l+=(t[g]-t[p])*(t[p+1]+t[g+1]),g=p;return l}Bd.exports=Lh,Bd.exports.default=Lh,Lh.deviation=function(t,e,r,s){var l=e&&e.length,p=Math.abs(Mu(t,0,l?e[0]*r:t.length,r));if(l)for(var g=0,v=e.length;g<v;g++)p-=Math.abs(Mu(t,e[g]*r,g<v-1?e[g+1]*r:t.length,r));var T=0;for(g=0;g<s.length;g+=3){var S=s[g]*r,P=s[g+1]*r,D=s[g+2]*r;T+=Math.abs((t[S]-t[D])*(t[P+1]-t[S+1])-(t[S]-t[P])*(t[D+1]-t[S+1]))}return p===0&&T===0?0:Math.abs((T-p)/p)},Lh.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,l=0;l<t.length;l++){for(var p=0;p<t[l].length;p++)for(var g=0;g<e;g++)r.vertices.push(t[l][p][g]);l>0&&r.holes.push(s+=t[l-1].length)}return r};var Vd=dt(Bd.exports);function bg(t,e,r,s,l){Oh(t,e,r,s||t.length-1,l||Vh)}function Oh(t,e,r,s,l){for(;s>r;){if(s-r>600){var p=s-r+1,g=e-r+1,v=Math.log(p),T=.5*Math.exp(2*v/3),S=.5*Math.sqrt(v*T*(p-T)/p)*(g-p/2<0?-1:1);Oh(t,e,Math.max(r,Math.floor(e-g*T/p+S)),Math.min(s,Math.floor(e+(p-g)*T/p+S)),l)}var P=t[e],D=r,L=s;for(Uh(t,r,e),l(t[s],P)>0&&Uh(t,r,s);D<L;){for(Uh(t,D,L),D++,L--;l(t[D],P)<0;)D++;for(;l(t[L],P)>0;)L--}l(t[r],P)===0?Uh(t,r,L):Uh(t,++L,s),L<=e&&(r=L+1),e<=L&&(s=L-1)}}function Uh(t,e,r){var s=t[e];t[e]=t[r],t[r]=s}function Vh(t,e){return t<e?-1:t>e?1:0}function rf(t,e){const r=t.length;if(r<=1)return[t];const s=[];let l,p;for(let g=0;g<r;g++){const v=za(t[g]);v!==0&&(t[g].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(l&&s.push(l),l=[t[g]]):l.push(t[g]))}if(l&&s.push(l),e>1)for(let g=0;g<s.length;g++)s[g].length<=e||(bg(s[g],e,1,s[g].length-1,$d),s[g]=s[g].slice(0,e));return s}function $d(t,e){return e.area-t.area}function a(t,e,r){const s=r.patternDependencies;let l=!1;for(const p of e){const g=p.paint.get(`${t}-pattern`);g.isConstant()||(l=!0);const v=g.constantOr(null);v&&(l=!0,s[v]=!0)}return l}function c(t,e,r,s,l){const p=l.patternDependencies;for(const g of e){const v=g.paint.get(`${t}-pattern`).value;if(v.kind!=="constant"){let T=v.evaluate({zoom:s},r,{},l.availableImages);T=T&&T.name?T.name:T,p[T]=!0,r.patterns[g.id]=T}}return r}class _{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new yt,this.indexArray=new Zt,this.indexArray2=new In,this.programConfigurations=new Ml(e.layers,e.zoom),this.segments=new Wn,this.segments2=new Wn,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id)),this.projection=e.projection}populate(e,r,s,l){this.hasPattern=a("fill",this.layers,r);const p=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:v,id:T,index:S,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,L=co(v,D);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),L,s))continue;const U=p?p.evaluate(L,{},s,r.availableImages):void 0,V={id:T,properties:v.properties,type:v.type,sourceLayerIndex:P,index:S,geometry:D?L.geometry:Yi(v,s,l),patterns:{},sortKey:U};g.push(V)}p&&g.sort(((v,T)=>v.sortKey-T.sortKey));for(const v of g){const{geometry:T,index:S,sourceLayerIndex:P}=v;if(this.hasPattern){const D=c("fill",this.layers,v,this.zoom,r);this.patternFeatures.push(D)}else this.addFeature(v,T,S,s,{},r.availableImages);r.featureIndex.insert(e[S].feature,T,S,P,this.index)}}update(e,r,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,l)}addFeatures(e,r,s,l,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,r,s,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_g),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,l,p,g=[]){for(const v of rf(r,500)){let T=0;for(const V of v)T+=V.length;const S=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),P=S.vertexLength,D=[],L=[];for(const V of v){if(V.length===0)continue;V!==v[0]&&L.push(D.length/2);const q=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),ee=q.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(ee+V.length-1,ee),D.push(V[0].x),D.push(V[0].y);for(let ae=1;ae<V.length;ae++)this.layoutVertexArray.emplaceBack(V[ae].x,V[ae].y),this.indexArray2.emplaceBack(ee+ae-1,ee+ae),D.push(V[ae].x),D.push(V[ae].y);q.vertexLength+=V.length,q.primitiveLength+=V.length}const U=Vd(D,L);for(let V=0;V<U.length;V+=3)this.indexArray.emplaceBack(P+U[V],P+U[V+1],P+U[V+2]);S.vertexLength+=T,S.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,g,l)}}Rt(_,"FillBucket",{omit:["layers","patternFeatures"]});const E=new ue({"fill-sort-key":new te(at.layout_fill["fill-sort-key"])});var N={paint:new ue({"fill-antialias":new W(at.paint_fill["fill-antialias"]),"fill-opacity":new te(at.paint_fill["fill-opacity"]),"fill-color":new te(at.paint_fill["fill-color"]),"fill-outline-color":new te(at.paint_fill["fill-outline-color"]),"fill-translate":new W(at.paint_fill["fill-translate"]),"fill-translate-anchor":new W(at.paint_fill["fill-translate-anchor"]),"fill-pattern":new te(at.paint_fill["fill-pattern"])}),layout:E};const O=Ie([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),J=Ie([{name:"a_centroid_pos",components:2,type:"Uint16"}]),xe=Ie([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Pe}=O;var rt={},At=Ge,jt=Et;function Et(t,e,r,s,l){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=l,t.readFields(Xt,this,e)}function Xt(t,e,r){t==1?e.id=r.readVarint():t==2?(function(s,l){for(var p=s.readVarint()+s.pos;s.pos<p;){var g=l._keys[s.readVarint()],v=l._values[s.readVarint()];l.properties[g]=v}})(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function nr(t){for(var e,r,s=0,l=0,p=t.length,g=p-1;l<p;g=l++)s+=((r=t[g]).x-(e=t[l]).x)*(e.y+r.y);return s}Et.types=["Unknown","Point","LineString","Polygon"],Et.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,s=1,l=0,p=0,g=0,v=[];t.pos<r;){if(l<=0){var T=t.readVarint();s=7&T,l=T>>3}if(l--,s===1||s===2)p+=t.readSVarint(),g+=t.readSVarint(),s===1&&(e&&v.push(e),e=[]),e.push(new At(p,g));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&v.push(e),v},Et.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,s=0,l=0,p=0,g=1/0,v=-1/0,T=1/0,S=-1/0;t.pos<e;){if(s<=0){var P=t.readVarint();r=7&P,s=P>>3}if(s--,r===1||r===2)(l+=t.readSVarint())<g&&(g=l),l>v&&(v=l),(p+=t.readSVarint())<T&&(T=p),p>S&&(S=p);else if(r!==7)throw new Error("unknown command "+r)}return[g,T,v,S]},Et.prototype.toGeoJSON=function(t,e,r){var s,l,p=this.extent*Math.pow(2,r),g=this.extent*t,v=this.extent*e,T=this.loadGeometry(),S=Et.types[this.type];function P(U){for(var V=0;V<U.length;V++){var q=U[V];U[V]=[360*(q.x+g)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(s=0;s<T.length;s++)D[s]=T[s][0];P(T=D);break;case 2:for(s=0;s<T.length;s++)P(T[s]);break;case 3:for(T=(function(U){var V=U.length;if(V<=1)return[U];for(var q,ee,ae=[],me=0;me<V;me++){var oe=nr(U[me]);oe!==0&&(ee===void 0&&(ee=oe<0),ee===oe<0?(q&&ae.push(q),q=[U[me]]):q.push(U[me]))}return q&&ae.push(q),ae})(T),s=0;s<T.length;s++)for(l=0;l<T[s].length;l++)P(T[s][l])}T.length===1?T=T[0]:S="Multi"+S;var L={type:"Feature",geometry:{type:S,coordinates:T},properties:this.properties};return"id"in this&&(L.id=this.id),L};var sr=jt,Jn=Ze;function Ze(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ne,this,e),this.length=this._features.length}function Ne(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push((function(s){for(var l=null,p=s.readVarint()+s.pos;s.pos<p;){var g=s.readVarint()>>3;l=g===1?s.readString():g===2?s.readFloat():g===3?s.readDouble():g===4?s.readVarint64():g===5?s.readVarint():g===6?s.readSVarint():g===7?s.readBoolean():null}return l})(r))}Ze.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new sr(this._pbf,e,this.extent,this._keys,this._values)};var Ke=Jn;function zt(t,e,r){if(t===3){var s=new Ke(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}var ar=rt.VectorTile=function(t,e){this.layers=t.readFields(zt,{},e)},fr=rt.VectorTileFeature=jt;function mr(t,e,r,s){const l=[],p=s===0?(g,v,T,S,P,D)=>{g.push(new ge(D,T+(D-v)/(S-v)*(P-T)))}:(g,v,T,S,P,D)=>{g.push(new ge(v+(D-T)/(P-T)*(S-v),D))};for(const g of t){const v=[];for(const T of g){if(T.length<=2)continue;const S=[];for(let L=0;L<T.length-1;L++){const U=T[L].x,V=T[L].y,q=T[L+1].x,ee=T[L+1].y,ae=s===0?U:V,me=s===0?q:ee;ae<e?me>e&&p(S,U,V,q,ee,e):ae>r?me<r&&p(S,U,V,q,ee,r):S.push(T[L]),me<e&&ae>=e&&p(S,U,V,q,ee,e),me>r&&ae<=r&&p(S,U,V,q,ee,r)}let P=T[T.length-1];const D=s===0?P.x:P.y;D>=e&&D<=r&&S.push(P),S.length&&(P=S[S.length-1],S[0].x===P.x&&S[0].y===P.y||S.push(S[0]),v.push(S))}v.length&&l.push(v)}return l}rt.VectorTileLayer=Jn;const Ir=fr.types,Pi=Math.pow(2,13);function Jr(t,e,r,s,l,p,g,v){t.emplaceBack((e<<1)+g,(r<<1)+p,(Math.floor(s*Pi)<<1)+l,Math.round(v))}function da(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class mm{constructor(){this.acc=new ge(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ge(e.x,e.y),this.max=new ge(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,l=this.max;e.x<s.x?s.x=e.x:e.x>l.x&&(l.x=e.x),e.y<s.y?s.y=e.y:e.y>l.y&&(l.y=e.y),((e.x===0||e.x===Qt)&&e.x===r.x)!=((e.y===0||e.y===Qt)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,Fr(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Qt!=e.x>Qt&&this.addBorderIntersection(1,Fr(r.y,e.y,(Qt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Fr(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Qt!=e.y>Qt&&this.addBorderIntersection(3,Fr(r.x,e.x,(Qt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];r<s[0]&&(s[0]=r),r>s[1]&&(s[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,r.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,r.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce(((r,s)=>r+s.edges),0);return e!==0?this.acc.div(e)._round():new ge(0,0)}span(){return new ge(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((e,r)=>e+ +(r[0]!==Number.MAX_VALUE)),0)}}class nf{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new nt,this.centroidVertexArray=new Ms,this.indexArray=new Zt,this.programConfigurations=new Ml(e.layers,e.zoom),this.segments=new Wn,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id)),this.enableTerrain=e.enableTerrain}populate(e,r,s,l){this.features=[],this.hasPattern=a("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=(function(p){const g=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*g/(g*g+1)/Qt/(1<<p.z)})(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:p,id:g,index:v,sourceLayerIndex:T}of e){const S=this.layers[0]._featureFilter.needGeometry,P=co(p,S);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),P,s))continue;const D={id:g,sourceLayerIndex:T,index:v,geometry:S?P.geometry:Yi(p,s,l),properties:p.properties,type:p.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(c("fill-extrusion",this.layers,D,this.zoom,r)):this.addFeature(D,D.geometry,v,s,{},r.availableImages,l),r.featureIndex.insert(p,D.geometry,v,T,this.index,L)}this.sortBorders()}addFeatures(e,r,s,l,p){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,r,s,l,p)}this.sortBorders()}update(e,r,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pe),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,xe.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,J.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,l,p,g,v){const T=[new ge(0,0),new ge(Qt,Qt)],S=v.projection,P=S.name==="globe",D=this.enableTerrain&&!P?new mm:null,L=Ir[e.type]==="Polygon";P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ft);const U=rf(r,500);for(let ae=U.length-1;ae>=0;ae--){const me=U[ae];(me.length===0||(V=me[0]).every((oe=>oe.x<=0))||V.every((oe=>oe.x>=Qt))||V.every((oe=>oe.y<=0))||V.every((oe=>oe.y>=Qt)))&&U.splice(ae,1)}var V;let q;if(P)q=J0(U,T,l);else{q=[];for(const ae of U)q.push({polygon:ae,bounds:T})}const ee=L?this.edgeRadius:0;for(const{polygon:ae,bounds:me}of q){let oe=0,fe=0;for(const _e of ae)L&&!_e[0].equals(_e[_e.length-1])&&_e.push(_e[0]),fe+=L?_e.length-1:_e.length;const be=this.segments.prepareSegment((L?5:4)*fe,this.layoutVertexArray,this.indexArray);if(L){const _e=[],qe=[];oe=be.vertexLength;for(const ot of ae){let bt,Xe;ot.length&&ot!==ae[0]&&qe.push(_e.length/2),bt=ot[1].sub(ot[0])._perp()._unit();for(let ut=1;ut<ot.length;ut++){const ht=ot[ut],gt=ot[ut===ot.length-1?1:ut+1];let{x:Ct,y:st}=ht;if(ee){Xe=gt.sub(ht)._perp()._unit();const Lt=bt.add(Xe)._unit(),Gt=ee*Math.min(4,1/(bt.x*Lt.x+bt.y*Lt.y));Ct+=Gt*Lt.x,st+=Gt*Lt.y,bt=Xe}Jr(this.layoutVertexArray,Ct,st,0,0,1,1,0),be.vertexLength++,_e.push(ht.x,ht.y),P&&da(this.layoutVertexExtArray,S.projectTilePoint(Ct,st,l),S.upVector(l,Ct,st))}}const Oe=Vd(_e,qe);for(let ot=0;ot<Oe.length;ot+=3)this.indexArray.emplaceBack(oe+Oe[ot],oe+Oe[ot+2],oe+Oe[ot+1]),be.primitiveLength++}for(const _e of ae){D&&_e.length&&D.startRing(_e[0]);let qe,Oe,ot,bt=_e.length>4&&X0(_e[_e.length-2],_e[0],_e[1]),Xe=ee?Cw(_e[_e.length-2],_e[0],_e[1],ee):0;Oe=_e[1].sub(_e[0])._perp()._unit();let ut=!0;for(let ht=1,gt=0;ht<_e.length;ht++){let Ct=_e[ht-1],st=_e[ht];const Lt=_e[ht===_e.length-1?1:ht+1];if(D&&L&&D.currentPolyCount.top++,H0(st,Ct,me)){ee&&(Oe=Lt.sub(st)._perp()._unit(),ut=!ut);continue}D&&D.append(st,Ct);const Gt=st.sub(Ct)._perp(),Ft=Gt.x/(Math.abs(Gt.x)+Math.abs(Gt.y)),wr=Gt.y>0?1:0,Mt=Ct.dist(st);if(gt+Mt>32768&&(gt=0),ee){ot=Lt.sub(st)._perp()._unit();let kr=Z0(Ct,st,Lt,q0(Oe,ot),ee);isNaN(kr)&&(kr=0);const ur=st.sub(Ct)._unit();Ct=Ct.add(ur.mult(Xe))._round(),st=st.add(ur.mult(-kr))._round(),Xe=kr,Oe=ot}const er=be.vertexLength,Tr=_e.length>4&&X0(Ct,st,Lt);let Qr=K0(gt,bt,ut);if(Jr(this.layoutVertexArray,Ct.x,Ct.y,Ft,wr,0,0,Qr),Jr(this.layoutVertexArray,Ct.x,Ct.y,Ft,wr,0,1,Qr),gt+=Mt,Qr=K0(gt,Tr,!ut),bt=Tr,Jr(this.layoutVertexArray,st.x,st.y,Ft,wr,0,0,Qr),Jr(this.layoutVertexArray,st.x,st.y,Ft,wr,0,1,Qr),be.vertexLength+=4,this.indexArray.emplaceBack(er+0,er+1,er+2),this.indexArray.emplaceBack(er+1,er+3,er+2),be.primitiveLength+=2,ee){const kr=oe+(ht===1?_e.length-2:ht-2),ur=ht===1?oe:kr+1;if(this.indexArray.emplaceBack(er+1,kr,er+3),this.indexArray.emplaceBack(kr,ur,er+3),be.primitiveLength+=2,qe===void 0&&(qe=er),!H0(Lt,_e[ht],me)){const wn=ht===_e.length-1?qe:be.vertexLength;this.indexArray.emplaceBack(er+2,er+3,wn),this.indexArray.emplaceBack(er+3,wn+1,wn),this.indexArray.emplaceBack(er+3,ur,wn+1),be.primitiveLength+=3}ut=!ut}if(P){const kr=this.layoutVertexExtArray,ur=S.projectTilePoint(Ct.x,Ct.y,l),wn=S.projectTilePoint(st.x,st.y,l),Er=S.upVector(l,Ct.x,Ct.y),Cr=S.upVector(l,st.x,st.y);da(kr,ur,Er),da(kr,ur,Er),da(kr,wn,Cr),da(kr,wn,Cr)}}L&&(oe+=_e.length-1)}}if(D&&D.polyCount.length>0){if(D.borders){D.vertexArrayOffset=this.centroidVertexArray.length;const ae=D.borders,me=this.featuresOnBorder.push(D)-1;for(let oe=0;oe<4;oe++)ae[oe][0]!==Number.MAX_VALUE&&this.borders[oe].push(me)}this.encodeCentroid(D.borders?void 0:D.centroid(),D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,g,l)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort(((r,s)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[s].borders[e][0]))}encodeCentroid(e,r,s=!0){let l,p;if(e)if(e.y!==0){const v=r.span()._mult(this.tileToMeter);l=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(v.x/10)),p=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else l=Math.ceil(7*(e.x+450)),p=0;else l=0,p=+s;let g=s?this.centroidVertexArray.length:r.vertexArrayOffset;for(const v of r.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let T=0;T<v.top;T++)this.centroidVertexArray.emplace(g++,l,p);for(let T=0;T<2*v.edges;T++)this.centroidVertexArray.emplace(g++,0,p),this.centroidVertexArray.emplace(g++,l,p)}}}function q0(t,e){const r=t.add(e)._unit();return t.x*r.x+t.y*r.y}function Cw(t,e,r,s){const l=e.sub(t)._perp()._unit(),p=r.sub(e)._perp()._unit();return Z0(t,e,r,q0(l,p),s)}function Z0(t,e,r,s,l){const p=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(r)/3,l*p/s)}function H0(t,e,r){return t.x<r[0].x&&e.x<r[0].x||t.x>r[1].x&&e.x>r[1].x||t.y<r[0].y&&e.y<r[0].y||t.y>r[1].y&&e.y>r[1].y}function X0(t,e,r){if(t.x<0||t.x>=Qt||e.x<0||e.x>=Qt||r.x<0||r.x>=Qt)return!1;const s=r.sub(e),l=s.perp(),p=t.sub(e);return(s.x*p.x+s.y*p.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(p.x*p.x+p.y*p.y))>-.866&&l.x*p.x+l.y*p.y<0}function K0(t,e,r){const s=e?2|t:-3&t;return r?1|s:-2&s}function Y0(){const t=Math.PI/32,e=Math.tan(t),r=jl;return r*Math.sqrt(1+2*e*e)-r}function J0(t,e,r){const s=1<<r.z,l=Mi(r.x/s),p=Mi((r.x+1)/s),g=Yr(r.y/s),v=Yr((r.y+1)/s);return(function(T,S,P,D,L=0,U){const V=[];if(!T.length||!P||!D)return V;const q=(_e,qe)=>{for(const Oe of _e)V.push({polygon:Oe,bounds:qe})},ee=Math.ceil(Math.log2(P)),ae=Math.ceil(Math.log2(D)),me=ee-ae,oe=[];for(let _e=0;_e<Math.abs(me);_e++)oe.push(me>0?0:1);for(let _e=0;_e<Math.min(ee,ae);_e++)oe.push(0),oe.push(1);let fe=T;if(fe=mr(fe,S[0].y-L,S[1].y+L,1),fe=mr(fe,S[0].x-L,S[1].x+L,0),!fe.length)return V;const be=[];for(oe.length?be.push({polygons:fe,bounds:S,depth:0}):q(fe,S);be.length;){const _e=be.pop(),qe=_e.depth,Oe=oe[qe],ot=_e.bounds[0],bt=_e.bounds[1],Xe=Oe===0?ot.x:ot.y,ut=Oe===0?bt.x:bt.y,ht=U?U(Oe,Xe,ut):.5*(Xe+ut),gt=mr(_e.polygons,Xe-L,ht+L,Oe),Ct=mr(_e.polygons,ht-L,ut+L,Oe);if(gt.length){const st=[ot,new ge(Oe===0?ht:bt.x,Oe===1?ht:bt.y)];oe.length>qe+1?be.push({polygons:gt,bounds:st,depth:qe+1}):q(gt,st)}if(Ct.length){const st=[new ge(Oe===0?ht:ot.x,Oe===1?ht:ot.y),bt];oe.length>qe+1?be.push({polygons:Ct,bounds:st,depth:qe+1}):q(Ct,st)}}return V})(t,e,Math.ceil((p-l)/11.25),Math.ceil((g-v)/11.25),1,((T,S,P)=>{if(T===0)return .5*(S+P);{const D=Yr((r.y+S/Qt)/s);return(Mn(.5*(Yr((r.y+P/Qt)/s)+D))*s-r.y)*Qt}}))}Rt(nf,"FillExtrusionBucket",{omit:["layers","features"]}),Rt(mm,"PartMetadata");const Mw=new ue({"fill-extrusion-edge-radius":new W(at["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Aw={paint:new ue({"fill-extrusion-opacity":new W(at["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new te(at["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new W(at["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new W(at["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new te(at["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new te(at["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new te(at["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new W(at["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new W(at["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new W(at["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new W(at["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Mw};function Q0(t,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[t*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class gm{constructor(e,r,s){this.z=e,this.x=r,this.y=s,this.key=sf(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const s=(function(p,g,v){var T=Q0(256*p,256*(g=Math.pow(2,v)-g-1),v),S=Q0(256*(p+1),256*(g+1),v);return T[0]+","+T[1]+","+S[0]+","+S[1]})(this.x,this.y,this.z),l=(function(p,g,v){let T,S="";for(let P=p;P>0;P--)T=1<<P-1,S+=(g&T?1:0)+(v&T?2:0);return S})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ex{constructor(e,r){this.wrap=e,this.canonical=r,this.key=sf(e,r.z,r.z,r.x,r.y)}}class js{constructor(e,r,s,l,p){this.overscaledZ=e,this.wrap=r,this.canonical=new gm(s,+l,+p),this.key=r===0&&e===s?this.canonical.key:sf(r,e,s,l,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new js(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new js(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return sf(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return sf(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new js(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new js(r,this.wrap,r,s,l),new js(r,this.wrap,r,s+1,l),new js(r,this.wrap,r,s,l+1),new js(r,this.wrap,r,s+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new js(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new js(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ex(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function sf(t,e,r,s,l){const p=1<<Math.min(r,22);let g=p*(l%p)+s%p;return t&&r<22&&(g+=p*p*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*g+r)+(e-r)}Rt(gm,"CanonicalTileID"),Rt(js,"OverscaledTileID",{omit:["projMatrix"]});class Gd extends ge{constructor(e,r,s){super(e,r),this.z=s}}function af(t,e){return t.x*e.x+t.y*e.y}function tx(t,e){if(t.length===1){let r=0;const s=e[r++];let l;for(;!l||s.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const p=e[r],g=t[0],v=l.sub(s),T=p.sub(s),S=g.sub(s),P=af(v,v),D=af(v,T),L=af(T,T),U=af(S,v),V=af(S,T),q=P*L-D*D,ee=(L*U-D*V)/q,ae=(P*V-D*U)/q,me=s.z*(1-ee-ae)+l.z*ee+p.z*ae;if(isFinite(me))return me}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}function rx(t,e,r,s,l,p,g,v){const T=g*l.getElevationAt(t,e,!0,!0),S=p[0]!==0,P=S?p[1]===0?g*(p[0]/7-450):g*(function(D,L,U){const V=Math.floor(L[0]/8),q=Math.floor(L[1]/8),ee=10*(L[0]-8*V),ae=10*(L[1]-8*q),me=D.getElevationAt(V,q,!0,!0),oe=D.getMeterToDEM(U),fe=Math.floor(.5*(ee*oe-1)),be=Math.floor(.5*(ae*oe-1)),_e=D.tileCoordToPixel(V,q),qe=2*fe+1,Oe=2*be+1,ot=(function(Ct,st,Lt,Gt,Ft){return[Ct.getElevationAtPixel(st,Lt,!0),Ct.getElevationAtPixel(st+Ft,Lt,!0),Ct.getElevationAtPixel(st,Lt+Ft,!0),Ct.getElevationAtPixel(st+Gt,Lt+Ft,!0)]})(D,_e.x-fe,_e.y-be,qe,Oe),bt=Math.abs(ot[0]-ot[1]),Xe=Math.abs(ot[2]-ot[3]),ut=Math.abs(ot[0]-ot[2])+Math.abs(ot[1]-ot[3]),ht=Math.min(.25,.5*oe*(bt+Xe)/qe),gt=Math.min(.25,.5*oe*ut/Oe);return me+Math.max(ht*ee,gt*ae)})(l,p,v):T;return{base:T+(r===0)?-1:r,top:S?Math.max(P+s,T+r+2):T+s}}const Pw=Ie([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Iw}=Pw,jw=Ie([{name:"a_packed",components:4,type:"Float32"}]),{members:Nw}=jw,Dw=fr.types,Lw=Math.cos(Math.PI/180*37.5);class ym{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new We,this.layoutVertexArray2=new mt,this.indexArray=new Zt,this.programConfigurations=new Ml(e.layers,e.zoom),this.segments=new Wn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,s,l){this.hasPattern=a("line",this.layers,r);const p=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:P,id:D,index:L,sourceLayerIndex:U}of e){const V=this.layers[0]._featureFilter.needGeometry,q=co(P,V);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),q,s))continue;const ee=p?p.evaluate(q,{},s):void 0,ae={id:D,properties:P.properties,type:P.type,sourceLayerIndex:U,index:L,geometry:V?q.geometry:Yi(P,s,l),patterns:{},sortKey:ee};g.push(ae)}p&&g.sort(((P,D)=>P.sortKey-D.sortKey));const{lineAtlas:v,featureIndex:T}=r,S=this.addConstantDashes(v);for(const P of g){const{geometry:D,index:L,sourceLayerIndex:U}=P;if(S&&this.addFeatureDashes(P,v),this.hasPattern){const V=c("line",this.layers,P,this.zoom,r);this.patternFeatures.push(V)}else this.addFeature(P,D,L,s,v.positions,r.availableImages);T.insert(e[L].feature,D,L,U,this.index)}}addConstantDashes(e){let r=!1;for(const s of this.layers){const l=s.paint.get("line-dasharray").value,p=s.layout.get("line-cap").value;if(l.kind!=="constant"||p.kind!=="constant")r=!0;else{const g=p.value,v=l.value;if(!v)continue;e.addDash(v,g)}}return r}addFeatureDashes(e,r){const s=this.zoom;for(const l of this.layers){const p=l.paint.get("line-dasharray").value,g=l.layout.get("line-cap").value;if(p.kind==="constant"&&g.kind==="constant")continue;let v,T;if(p.kind==="constant"){if(v=p.value,!v)continue}else v=p.evaluate({zoom:s},e);T=g.kind==="constant"?g.value:g.evaluate({zoom:s},e),r.addDash(v,T),e.patterns[l.id]=r.getKey(v,T)}}update(e,r,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,l)}addFeatures(e,r,s,l,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,r,s,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Nw)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Iw),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,l,p,g){const v=this.layers[0].layout,T=v.get("line-join").evaluate(e,{}),S=v.get("line-cap").evaluate(e,{}),P=v.get("line-miter-limit"),D=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const L of r)this.addLine(L,e,T,S,P,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,g,l)}addLine(e,r,s,l,p,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ae=0;ae<e.length-1;ae++)this.totalDistance+=e[ae].dist(e[ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=Dw[r.type]==="Polygon";let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let S=0;for(;S<T-1&&e[S].equals(e[S+1]);)S++;if(T<(v?3:2))return;s==="bevel"&&(p=1.05);const P=this.overscaling<=16?15*Qt/(512*this.overscaling):0,D=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let L,U,V,q,ee;this.e1=this.e2=-1,v&&(L=e[T-2],ee=e[S].sub(L)._unit()._perp());for(let ae=S;ae<T;ae++){if(V=ae===T-1?v?e[S+1]:void 0:e[ae+1],V&&e[ae].equals(V))continue;ee&&(q=ee),L&&(U=L),L=e[ae],ee=V?V.sub(L)._unit()._perp():q,q=q||ee;let me=q.add(ee);me.x===0&&me.y===0||me._unit();const oe=q.x*ee.x+q.y*ee.y,fe=me.x*ee.x+me.y*ee.y,be=fe!==0?1/fe:1/0,_e=2*Math.sqrt(2-2*fe),qe=fe<Lw&&U&&V,Oe=q.x*ee.y-q.y*ee.x>0;if(qe&&ae>S){const Xe=L.dist(U);if(Xe>2*P){const ut=L.sub(L.sub(U)._mult(P/Xe)._round());this.updateDistance(U,ut),this.addCurrentVertex(ut,q,0,0,D),U=ut}}const ot=U&&V;let bt=ot?s:v?"butt":l;if(ot&&bt==="round"&&(be<g?bt="miter":be<=2&&(bt="fakeround")),bt==="miter"&&be>p&&(bt="bevel"),bt==="bevel"&&(be>2&&(bt="flipbevel"),be<p&&(bt="miter")),U&&this.updateDistance(U,L),bt==="miter")me._mult(be),this.addCurrentVertex(L,me,0,0,D);else if(bt==="flipbevel"){if(be>100)me=ee.mult(-1);else{const Xe=be*q.add(ee).mag()/q.sub(ee).mag();me._perp()._mult(Xe*(Oe?-1:1))}this.addCurrentVertex(L,me,0,0,D),this.addCurrentVertex(L,me.mult(-1),0,0,D)}else if(bt==="bevel"||bt==="fakeround"){const Xe=-Math.sqrt(be*be-1),ut=Oe?Xe:0,ht=Oe?0:Xe;if(U&&this.addCurrentVertex(L,q,ut,ht,D),bt==="fakeround"){const gt=Math.round(180*_e/Math.PI/20);for(let Ct=1;Ct<gt;Ct++){let st=Ct/gt;if(st!==.5){const Gt=st-.5;st+=st*Gt*(st-1)*((1.0904+oe*(oe*(3.55645-1.43519*oe)-3.2452))*Gt*Gt+(.848013+oe*(.215638*oe-1.06021)))}const Lt=ee.sub(q)._mult(st)._add(q)._unit()._mult(Oe?-1:1);this.addHalfVertex(L,Lt.x,Lt.y,!1,Oe,0,D)}}V&&this.addCurrentVertex(L,ee,-ut,-ht,D)}else if(bt==="butt")this.addCurrentVertex(L,me,0,0,D);else if(bt==="square"){const Xe=U?1:-1;U||this.addCurrentVertex(L,me,Xe,Xe,D),this.addCurrentVertex(L,me,0,0,D),U&&this.addCurrentVertex(L,me,Xe,Xe,D)}else bt==="round"&&(U&&(this.addCurrentVertex(L,q,0,0,D),this.addCurrentVertex(L,q,1,1,D,!0)),V&&(this.addCurrentVertex(L,ee,-1,-1,D,!0),this.addCurrentVertex(L,ee,0,0,D)));if(qe&&ae<T-1){const Xe=L.dist(V);if(Xe>2*P){const ut=L.add(V.sub(L)._mult(P/Xe)._round());this.updateDistance(L,ut),this.addCurrentVertex(ut,ee,0,0,D),L=ut}}}}addCurrentVertex(e,r,s,l,p,g=!1){const v=r.y*l-r.x,T=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,g,!1,s,p),this.addHalfVertex(e,v,T,g,!0,-l,p)}addHalfVertex({x:e,y:r},s,l,p,g,v,T){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(r<<1)+(g?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const S=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),T.primitiveLength++),g?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Rt(ym,"LineBucket",{omit:["layers","patternFeatures"]});const Rw=new ue({"line-cap":new te(at.layout_line["line-cap"]),"line-join":new te(at.layout_line["line-join"]),"line-miter-limit":new W(at.layout_line["line-miter-limit"]),"line-round-limit":new W(at.layout_line["line-round-limit"]),"line-sort-key":new te(at.layout_line["line-sort-key"])});var nx={paint:new ue({"line-opacity":new te(at.paint_line["line-opacity"]),"line-color":new te(at.paint_line["line-color"]),"line-translate":new W(at.paint_line["line-translate"]),"line-translate-anchor":new W(at.paint_line["line-translate-anchor"]),"line-width":new te(at.paint_line["line-width"]),"line-gap-width":new te(at.paint_line["line-gap-width"]),"line-offset":new te(at.paint_line["line-offset"]),"line-blur":new te(at.paint_line["line-blur"]),"line-dasharray":new te(at.paint_line["line-dasharray"]),"line-pattern":new te(at.paint_line["line-pattern"]),"line-gradient":new le(at.paint_line["line-gradient"]),"line-trim-offset":new W(at.paint_line["line-trim-offset"])}),layout:Rw};const ix=new class extends te{possiblyEvaluate(t,e){return e=new j(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,s){return e=Ot({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,s)}}(nx.paint.properties["line-width"].specification);function sx(t,e){return e>0?e+2*t:t}ix.useIntegerZoom=!0;const zw=Ie([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Bw=Ie([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Fw=Ie([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ie([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ow=Ie([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Uw=Ie([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ax=Ie([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Vw=Ie([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ie([{name:"triangle",components:3,type:"Uint16"}]),Ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ie([{type:"Float32",name:"offsetX"}]),Ie([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Oi=24;const Uo=128;function wg(t,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new j(t+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=r;let p=0;for(;p<s.length&&s[p]<=t;)p++;p=Math.max(0,p-1);let g=p;for(;g<s.length&&s[g]<t+1;)g++;g=Math.min(s.length-1,g);const v=s[p],T=s[g];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:T,interpolationType:l}:{kind:"camera",minZoom:v,maxZoom:T,minSize:r.evaluate(new j(v)),maxSize:r.evaluate(new j(T)),interpolationType:l}}}function xm(t,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:l}){return t.kind==="source"?s/Uo:t.kind==="composite"?Fr(s/Uo,l/Uo,r):e}function Wd(t,e){let r=0,s=0;if(t.kind==="constant")s=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:l,minZoom:p,maxZoom:g}=t,v=l?Be(Gi.interpolationFactor(l,e,p,g),0,1):0;t.kind==="camera"?s=Fr(t.minSize,t.maxSize,v):r=v}return{uSizeT:r,uSize:s}}var $w=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Uo,evaluateSizeForFeature:xm,evaluateSizeForZoom:Wd,getSizeData:wg});function Gw(t,e,r){return t.sections.forEach((s=>{s.text=(function(l,p,g){const v=p.layout.get("text-transform").evaluate(g,{});return v==="uppercase"?l=l.toLocaleUpperCase():v==="lowercase"&&(l=l.toLocaleLowerCase()),M.applyArabicShaping&&(l=M.applyArabicShaping(l)),l})(s.text,e,r)})),t}const of={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function Ww(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function qw(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}var ox=fn,lx=function(t,e,r,s,l){var p,g,v=8*l-s-1,T=(1<<v)-1,S=T>>1,P=-7,D=l-1,L=-1,U=t[e+D];for(D+=L,p=U&(1<<-P)-1,U>>=-P,P+=v;P>0;p=256*p+t[e+D],D+=L,P-=8);for(g=p&(1<<-P)-1,p>>=-P,P+=s;P>0;g=256*g+t[e+D],D+=L,P-=8);if(p===0)p=1-S;else{if(p===T)return g?NaN:1/0*(U?-1:1);g+=Math.pow(2,s),p-=S}return(U?-1:1)*g*Math.pow(2,p-s)},cx=function(t,e,r,s,l,p){var g,v,T,S=8*p-l-1,P=(1<<S)-1,D=P>>1,L=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=0,V=1,q=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,g=P):(g=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-g))<1&&(g--,T*=2),(e+=g+D>=1?L/T:L*Math.pow(2,1-D))*T>=2&&(g++,T/=2),g+D>=P?(v=0,g=P):g+D>=1?(v=(e*T-1)*Math.pow(2,l),g+=D):(v=e*Math.pow(2,D-1)*Math.pow(2,l),g=0));l>=8;t[r+U]=255&v,U+=V,v/=256,l-=8);for(g=g<<l|v,S+=l;S>0;t[r+U]=255&g,U+=V,g/=256,S-=8);t[r+U-V]|=128*q};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function fn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}fn.Varint=0,fn.Fixed64=1,fn.Bytes=2,fn.Fixed32=5;var Tg=4294967296,ux=1/Tg,hx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Lc(t){return t.type===fn.Bytes?t.readVarint()+t.pos:t.pos+1}function qd(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function dx(t,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var l=r.pos-1;l>=t;l--)r.buf[l+s]=r.buf[l]}function Zw(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Hw(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function Xw(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Kw(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Yw(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Jw(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function Qw(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function eT(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function tT(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function _m(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Zd(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function px(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}fn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),l=s>>3,p=this.pos;this.type=7&s,t(l,e,this),this.pos===p&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=_m(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=px(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=_m(this.buf,this.pos)+_m(this.buf,this.pos+4)*Tg;return this.pos+=8,t},readSFixed64:function(){var t=_m(this.buf,this.pos)+px(this.buf,this.pos+4)*Tg;return this.pos+=8,t},readFloat:function(){var t=lx(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=lx(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:(function(l,p,g){var v,T,S=g.buf;if(v=(112&(T=S[g.pos++]))>>4,T<128||(v|=(127&(T=S[g.pos++]))<<3,T<128)||(v|=(127&(T=S[g.pos++]))<<10,T<128)||(v|=(127&(T=S[g.pos++]))<<17,T<128)||(v|=(127&(T=S[g.pos++]))<<24,T<128)||(v|=(1&(T=S[g.pos++]))<<31,T<128))return qd(l,v,p);throw new Error("Expected varint not more than 10 bytes")})(e|=(15&(r=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&hx?(function(r,s,l){return hx.decode(r.subarray(s,l))})(this.buf,e,t):(function(r,s,l){for(var p="",g=s;g<l;){var v,T,S,P=r[g],D=null,L=P>239?4:P>223?3:P>191?2:1;if(g+L>l)break;L===1?P<128&&(D=P):L===2?(192&(v=r[g+1]))==128&&(D=(31&P)<<6|63&v)<=127&&(D=null):L===3?(T=r[g+2],(192&(v=r[g+1]))==128&&(192&T)==128&&((D=(15&P)<<12|(63&v)<<6|63&T)<=2047||D>=55296&&D<=57343)&&(D=null)):L===4&&(T=r[g+2],S=r[g+3],(192&(v=r[g+1]))==128&&(192&T)==128&&(192&S)==128&&((D=(15&P)<<18|(63&v)<<12|(63&T)<<6|63&S)<=65535||D>=1114112)&&(D=null)),D===null?(D=65533,L=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),g+=L}return p})(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==fn.Bytes)return t.push(this.readVarint(e));var r=Lc(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==fn.Bytes)return t.push(this.readSVarint());var e=Lc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==fn.Bytes)return t.push(this.readBoolean());var e=Lc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==fn.Bytes)return t.push(this.readFloat());var e=Lc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==fn.Bytes)return t.push(this.readDouble());var e=Lc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==fn.Bytes)return t.push(this.readFixed32());var e=Lc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==fn.Bytes)return t.push(this.readSFixed32());var e=Lc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==fn.Bytes)return t.push(this.readFixed64());var e=Lc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==fn.Bytes)return t.push(this.readSFixed64());var e=Lc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===fn.Varint)for(;this.buf[this.pos++]>127;);else if(e===fn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===fn.Fixed32)this.pos+=4;else{if(e!==fn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Zd(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Zd(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Zd(this.buf,-1&t,this.pos),Zd(this.buf,Math.floor(t*ux),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Zd(this.buf,-1&t,this.pos),Zd(this.buf,Math.floor(t*ux),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?(function(e,r){var s,l;if(e>=0?(s=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),(function(p,g,v){v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7)})(s,0,r),(function(p,g){var v=(7&p)<<4;g.buf[g.pos++]|=v|((p>>>=3)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p)))))})(l,r)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=(function(s,l,p){for(var g,v,T=0;T<l.length;T++){if((g=l.charCodeAt(T))>55295&&g<57344){if(!v){g>56319||T+1===l.length?(s[p++]=239,s[p++]=191,s[p++]=189):v=g;continue}if(g<56320){s[p++]=239,s[p++]=191,s[p++]=189,v=g;continue}g=v-55296<<10|g-56320|65536,v=null}else v&&(s[p++]=239,s[p++]=191,s[p++]=189,v=null);g<128?s[p++]=g:(g<2048?s[p++]=g>>6|192:(g<65536?s[p++]=g>>12|224:(s[p++]=g>>18|240,s[p++]=g>>12&63|128),s[p++]=g>>6&63|128),s[p++]=63&g|128)}return p})(this.buf,t,this.pos);var r=this.pos-e;r>=128&&dx(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),cx(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),cx(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var s=this.pos-r;s>=128&&dx(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,r){this.writeTag(t,fn.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Zw,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Hw,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Yw,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Xw,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Kw,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Jw,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Qw,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,eT,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,tT,e)},writeBytesField:function(t,e){this.writeTag(t,fn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,fn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,fn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,fn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,fn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,fn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,fn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,fn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,fn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,fn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var vm=dt(ox);const kg=3;function rT(t,e,r){e.glyphs=[],t===1&&r.readMessage(nT,e)}function nT(t,e,r){if(t===3){const{id:s,bitmap:l,width:p,height:g,left:v,top:T,advance:S}=r.readMessage(iT,{});e.glyphs.push({id:s,bitmap:new Is({width:p+2*kg,height:g+2*kg},l),metrics:{width:p,height:g,left:v,top:T,advance:S}})}else t===4?e.ascender=r.readSVarint():t===5&&(e.descender=r.readSVarint())}function iT(t,e,r){t===1?e.id=r.readVarint():t===2?e.bitmap=r.readBytes():t===3?e.width=r.readVarint():t===4?e.height=r.readVarint():t===5?e.left=r.readSVarint():t===6?e.top=r.readSVarint():t===7&&(e.advance=r.readVarint())}const fx=kg;function Sg(t){let e=0,r=0;for(const g of t)e+=g.w*g.h,r=Math.max(r,g.w);t.sort(((g,v)=>v.h-g.h));const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,p=0;for(const g of t)for(let v=s.length-1;v>=0;v--){const T=s[v];if(!(g.w>T.w||g.h>T.h)){if(g.x=T.x,g.y=T.y,p=Math.max(p,g.y+g.h),l=Math.max(l,g.x+g.w),g.w===T.w&&g.h===T.h){const S=s.pop();v<s.length&&(s[v]=S)}else g.h===T.h?(T.x+=g.w,T.w-=g.w):g.w===T.w?(T.y+=g.h,T.h-=g.h):(s.push({x:T.x+g.w,y:T.y,w:T.w-g.w,h:g.h}),T.y+=g.h,T.h-=g.h);break}}return{w:l,h:p,fill:e/(l*p)||0}}const Hs=1;class Eg{constructor(e,{pixelRatio:r,version:s,stretchX:l,stretchY:p,content:g}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=p,this.content=g,this.version=s}get tl(){return[this.paddedRect.x+Hs,this.paddedRect.y+Hs]}get br(){return[this.paddedRect.x+this.paddedRect.w-Hs,this.paddedRect.y+this.paddedRect.h-Hs]}get displaySize(){return[(this.paddedRect.w-2*Hs)/this.pixelRatio,(this.paddedRect.h-2*Hs)/this.pixelRatio]}}class mx{constructor(e,r){const s={},l={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,s,p),this.addImages(r,l,p);const{w:g,h:v}=Sg(p),T=new fs({width:g||1,height:v||1});for(const S in e){const P=e[S],D=s[S].paddedRect;fs.copy(P.data,T,{x:0,y:0},{x:D.x+Hs,y:D.y+Hs},P.data)}for(const S in r){const P=r[S],D=l[S].paddedRect,L=D.x+Hs,U=D.y+Hs,V=P.data.width,q=P.data.height;fs.copy(P.data,T,{x:0,y:0},{x:L,y:U},P.data),fs.copy(P.data,T,{x:0,y:q-1},{x:L,y:U-1},{width:V,height:1}),fs.copy(P.data,T,{x:0,y:0},{x:L,y:U+q},{width:V,height:1}),fs.copy(P.data,T,{x:V-1,y:0},{x:L-1,y:U},{width:1,height:q}),fs.copy(P.data,T,{x:0,y:0},{x:L+V,y:U},{width:1,height:q})}this.image=T,this.iconPositions=s,this.patternPositions=l}addImages(e,r,s){for(const l in e){const p=e[l],g={x:0,y:0,w:p.data.width+2*Hs,h:p.data.height+2*Hs};s.push(g),r[l]=new Eg(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((s=>e.hasImage(s))),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,p]=e.tl;s.update(r.data,void 0,{x:l,y:p})}}Rt(Eg,"ImagePosition"),Rt(mx,"ImageAtlas");const Ra={horizontal:1,vertical:2,horizontalOnly:3},gx=-17;class lf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new lf;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new lf;return r.imageName=e,r}}class Hd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new Hd;for(let l=0;l<e.sections.length;l++){const p=e.sections[l];p.image?s.addImageSection(p):s.addTextSection(p,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=(function(r,s){let l="";for(let p=0;p<r.length;p++){const g=r.charCodeAt(p+1)||null,v=r.charCodeAt(p-1)||null;l+=!s&&(g&&ls(g)&&!of[r[p+1]]||v&&ls(v)&&!of[r[p-1]])||!of[r[p]]?r[p]:of[r[p]]}return l})(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&bm[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&bm[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new Hd;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,r)=>Math.max(e,this.sections[r].scale)),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(lf.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Gr("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(lf.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Gr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Cg(t,e,r,s,l,p,g,v,T,S,P,D,L,U,V){const q=Hd.fromFeature(t,l);D===Ra.vertical&&q.verticalizePunctuation(L);let ee=[];const ae=(function(_e,qe,Oe,ot,bt,Xe){if(!_e)return[];const ut=[],ht=(function(Lt,Gt,Ft,wr,Mt,er){let Tr=0;for(let Qr=0;Qr<Lt.length();Qr++){const kr=Lt.getSection(Qr);Tr+=yx(Lt.getCharCode(Qr),kr,wr,Mt,Gt,er)}return Tr/Math.max(1,Math.ceil(Tr/Ft))})(_e,qe,Oe,ot,bt,Xe),gt=_e.text.indexOf("​")>=0;let Ct=0;for(let Lt=0;Lt<_e.length();Lt++){const Gt=_e.getSection(Lt),Ft=_e.getCharCode(Lt);if(bm[Ft]||(Ct+=yx(Ft,Gt,ot,bt,qe,Xe)),Lt<_e.length()-1){const wr=!((st=Ft)<11904||!(Nt["Bopomofo Extended"](st)||Nt.Bopomofo(st)||Nt["CJK Compatibility Forms"](st)||Nt["CJK Compatibility Ideographs"](st)||Nt["CJK Compatibility"](st)||Nt["CJK Radicals Supplement"](st)||Nt["CJK Strokes"](st)||Nt["CJK Symbols and Punctuation"](st)||Nt["CJK Unified Ideographs Extension A"](st)||Nt["CJK Unified Ideographs"](st)||Nt["Enclosed CJK Letters and Months"](st)||Nt["Halfwidth and Fullwidth Forms"](st)||Nt.Hiragana(st)||Nt["Ideographic Description Characters"](st)||Nt["Kangxi Radicals"](st)||Nt["Katakana Phonetic Extensions"](st)||Nt.Katakana(st)||Nt["Vertical Forms"](st)||Nt["Yi Radicals"](st)||Nt["Yi Syllables"](st)));(sT[Ft]||wr||Gt.imageName)&&ut.push(_x(Lt+1,Ct,ht,ut,aT(Ft,_e.getCharCode(Lt+1),wr&&gt),!1))}}var st;return vx(_x(_e.length(),Ct,ht,ut,0,!0))})(q,S,p,e,s,U),{processBidirectionalText:me,processStyledBidirectionalText:oe}=M;if(me&&q.sections.length===1){const _e=me(q.toString(),ae);for(const qe of _e){const Oe=new Hd;Oe.text=qe,Oe.sections=q.sections;for(let ot=0;ot<qe.length;ot++)Oe.sectionIndex.push(0);ee.push(Oe)}}else if(oe){const _e=oe(q.text,q.sectionIndex,ae);for(const qe of _e){const Oe=new Hd;Oe.text=qe[0],Oe.sectionIndex=qe[1],Oe.sections=q.sections,ee.push(Oe)}}else ee=(function(_e,qe){const Oe=[],ot=_e.text;let bt=0;for(const Xe of qe)Oe.push(_e.substring(bt,Xe)),bt=Xe;return bt<ot.length&&Oe.push(_e.substring(bt,ot.length)),Oe})(q,ae);const fe=[],be={positionedLines:fe,text:q.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return(function(_e,qe,Oe,ot,bt,Xe,ut,ht,gt,Ct,st,Lt){let Gt=0,Ft=0,wr=0;const Mt=ht==="right"?1:ht==="left"?0:.5;let er=!1;for(const Er of bt){const Cr=Er.getSections();for(const cn of Cr){if(cn.imageName)continue;const mn=qe[cn.fontStack];if(mn&&(er=mn.ascender!==void 0&&mn.descender!==void 0,!er))break}if(!er)break}let Tr=0;for(const Er of bt){Er.trim();const Cr=Er.getMaxScale(),cn=(Cr-1)*Oi,mn={positionedGlyphs:[],lineOffset:0};_e.positionedLines[Tr]=mn;const gn=mn.positionedGlyphs;let un=0;if(!Er.length()){Ft+=Xe,++Tr;continue}let Dn=0,Zn=0;for(let hn=0;hn<Er.length();hn++){const _i=Er.getSection(hn),si=Er.getSectionIndex(hn),Un=Er.getCharCode(hn);let rn=_i.scale,ai=null,yn=null,Ns=null,oi=Oi,Ui=0;const Ii=!(gt===Ra.horizontal||!st&&!El(Un)||st&&(bm[Un]||(Qr=Un,Nt.Arabic(Qr)||Nt["Arabic Supplement"](Qr)||Nt["Arabic Extended-A"](Qr)||Nt["Arabic Presentation Forms-A"](Qr)||Nt["Arabic Presentation Forms-B"](Qr))));if(_i.imageName){const Ds=ot[_i.imageName];if(!Ds)continue;Ns=_i.imageName,_e.iconsInText=_e.iconsInText||!0,yn=Ds.paddedRect;const ji=Ds.displaySize;rn=rn*Oi/Lt,ai={width:ji[0],height:ji[1],left:Hs,top:-fx,advance:Ii?ji[1]:ji[0],localGlyph:!1},Ui=er?-ai.height*rn:gx+Cr*Oi-ji[1]*rn,oi=ai.advance;const Go=(Ii?ji[0]:ji[1])*rn-Oi*Cr;Go>0&&Go>un&&(un=Go)}else{const Ds=Oe[_i.fontStack];if(!Ds)continue;Ds[Un]&&(yn=Ds[Un]);const ji=qe[_i.fontStack];if(!ji)continue;const Go=ji.glyphs[Un];if(!Go)continue;if(ai=Go.metrics,oi=Un!==8203?Oi:0,er){const tp=ji.ascender!==void 0?Math.abs(ji.ascender):0,xf=ji.descender!==void 0?Math.abs(ji.descender):0,_f=(tp+xf)*rn;Dn<_f&&(Dn=_f,Zn=(tp-xf)/2*rn),Ui=-tp*rn}else Ui=gx+(Cr-rn)*Oi}Ii?(_e.verticalizable=!0,gn.push({glyph:Un,imageName:Ns,x:Gt,y:Ft+Ui,vertical:Ii,scale:rn,localGlyph:ai.localGlyph,fontStack:_i.fontStack,sectionIndex:si,metrics:ai,rect:yn}),Gt+=oi*rn+Ct):(gn.push({glyph:Un,imageName:Ns,x:Gt,y:Ft+Ui,vertical:Ii,scale:rn,localGlyph:ai.localGlyph,fontStack:_i.fontStack,sectionIndex:si,metrics:ai,rect:yn}),Gt+=ai.advance*rn+Ct)}gn.length!==0&&(wr=Math.max(Gt-Ct,wr),er?bx(gn,Mt,un,Zn,Xe*Cr/2):bx(gn,Mt,un,0,Xe/2)),Gt=0;const ii=Xe*Cr+un;mn.lineOffset=Math.max(un,cn),Ft+=ii,++Tr}var Qr;const kr=Ft,{horizontalAlign:ur,verticalAlign:wn}=Mg(ut);(function(Er,Cr,cn,mn,gn,un){const Dn=(Cr-cn)*gn,Zn=-un*mn;for(const ii of Er)for(const hn of ii.positionedGlyphs)hn.x+=Dn,hn.y+=Zn})(_e.positionedLines,Mt,ur,wn,wr,kr),_e.top+=-wn*kr,_e.bottom=_e.top+kr,_e.left+=-ur*wr,_e.right=_e.left+wr,_e.hasBaseline=er})(be,e,r,s,ee,g,v,T,D,S,L,V),!(function(_e){for(const qe of _e)if(qe.positionedGlyphs.length!==0)return!1;return!0})(fe)&&be}const bm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function yx(t,e,r,s,l,p){if(e.imageName){const g=s[e.imageName];return g?g.displaySize[0]*e.scale*Oi/p+l:0}{const g=r[e.fontStack],v=g&&g.glyphs[t];return v?v.metrics.advance*e.scale+l:0}}function xx(t,e,r,s){const l=Math.pow(t-e,2);return s?t<e?l/2:2*l:l+Math.abs(r)*r}function aT(t,e,r){let s=0;return t===10&&(s-=1e4),r&&(s+=150),t!==40&&t!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function _x(t,e,r,s,l,p){let g=null,v=xx(e,r,l,p);for(const T of s){const S=xx(e-T.x,r,l,p)+T.badness;S<=v&&(g=T,v=S)}return{index:t,x:e,priorBreak:g,badness:v}}function vx(t){return t?vx(t.priorBreak).concat(t.index):[]}function Mg(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function bx(t,e,r,s,l){if(!(e||r||s||l))return;const p=t.length-1,g=t[p],v=(g.x+g.metrics.advance*g.scale)*e;for(let T=0;T<=p;T++)t[T].x-=v,t[T].y+=r+s+l}function oT(t,e,r){const{horizontalAlign:s,verticalAlign:l}=Mg(r),p=e[0]-t.displaySize[0]*s,g=e[1]-t.displaySize[1]*l;return{image:t,top:g,bottom:g+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function wx(t,e,r,s,l,p){const g=t.image;let v;if(g.content){const ee=g.content,ae=g.pixelRatio||1;v=[ee[0]/ae,ee[1]/ae,g.displaySize[0]-ee[2]/ae,g.displaySize[1]-ee[3]/ae]}const T=e.left*p,S=e.right*p;let P,D,L,U;r==="width"||r==="both"?(U=l[0]+T-s[3],D=l[0]+S+s[1]):(U=l[0]+(T+S-g.displaySize[0])/2,D=U+g.displaySize[0]);const V=e.top*p,q=e.bottom*p;return r==="height"||r==="both"?(P=l[1]+V-s[0],L=l[1]+q+s[2]):(P=l[1]+(V+q-g.displaySize[1])/2,L=P+g.displaySize[1]),{image:g,top:P,right:D,bottom:L,left:U,collisionPadding:v}}class Rc extends ge{constructor(e,r,s,l,p){super(e,r),this.angle=l,this.z=s,p!==void 0&&(this.segment=p)}clone(){return new Rc(this.x,this.y,this.z,this.angle,this.segment)}}function Tx(t,e,r,s,l){if(e.segment===void 0)return!0;let p=e,g=e.segment+1,v=0;for(;v>-r/2;){if(g--,g<0)return!1;v-=t[g].dist(p),p=t[g]}v+=t[g].dist(t[g+1]),g++;const T=[];let S=0;for(;v<r/2;){const P=t[g],D=t[g+1];if(!D)return!1;let L=t[g-1].angleTo(P)-P.angleTo(D);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:v,angleDelta:L}),S+=L;v-T[0].distance>s;)S-=T.shift().angleDelta;if(S>l)return!1;g++,v+=P.dist(D)}return!0}function kx(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function Sx(t,e,r){return t?.6*e*r:0}function Ex(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function lT(t,e,r,s,l,p){const g=Sx(r,l,p),v=Ex(r,s)*p;let T=0;const S=kx(t)/2;for(let P=0;P<t.length-1;P++){const D=t[P],L=t[P+1],U=D.dist(L);if(T+U>S){const V=(S-T)/U,q=Fr(D.x,L.x,V),ee=Fr(D.y,L.y,V),ae=new Rc(q,ee,0,L.angleTo(D),P);return!g||Tx(t,ae,v,g,e)?ae:void 0}T+=U}}function cT(t,e,r,s,l,p,g,v,T){const S=Sx(s,p,g),P=Ex(s,l),D=P*g,L=t[0].x===0||t[0].x===T||t[0].y===0||t[0].y===T;return e-D<e/4&&(e=D+e/4),Cx(t,L?e/2*v%e:(P/2+2*p)*g*v%e,e,S,r,D,L,!1,T)}function Cx(t,e,r,s,l,p,g,v,T){const S=p/2,P=kx(t);let D=0,L=e-r,U=[];for(let V=0;V<t.length-1;V++){const q=t[V],ee=t[V+1],ae=q.dist(ee),me=ee.angleTo(q);for(;L+r<D+ae;){L+=r;const oe=(L-D)/ae,fe=Fr(q.x,ee.x,oe),be=Fr(q.y,ee.y,oe);if(fe>=0&&fe<T&&be>=0&&be<T&&L-S>=0&&L+S<=P){const _e=new Rc(fe,be,0,me,V);_e._round(),s&&!Tx(t,_e,p,s,l)||U.push(_e)}}D+=ae}return v||U.length||g||(U=Cx(t,D/2,r,s,l,p,g,!0,T)),U}function Mx(t,e,r,s,l){const p=[];for(let g=0;g<t.length;g++){const v=t[g];let T;for(let S=0;S<v.length-1;S++){let P=v[S],D=v[S+1];P.x<e&&D.x<e||(P.x<e?P=new ge(e,P.y+(e-P.x)/(D.x-P.x)*(D.y-P.y))._round():D.x<e&&(D=new ge(e,P.y+(e-P.x)/(D.x-P.x)*(D.y-P.y))._round()),P.y<r&&D.y<r||(P.y<r?P=new ge(P.x+(r-P.y)/(D.y-P.y)*(D.x-P.x),r)._round():D.y<r&&(D=new ge(P.x+(r-P.y)/(D.y-P.y)*(D.x-P.x),r)._round()),P.x>=s&&D.x>=s||(P.x>=s?P=new ge(s,P.y+(s-P.x)/(D.x-P.x)*(D.y-P.y))._round():D.x>=s&&(D=new ge(s,P.y+(s-P.x)/(D.x-P.x)*(D.y-P.y))._round()),P.y>=l&&D.y>=l||(P.y>=l?P=new ge(P.x+(l-P.y)/(D.y-P.y)*(D.x-P.x),l)._round():D.y>=l&&(D=new ge(P.x+(l-P.y)/(D.y-P.y)*(D.x-P.x),l)._round()),T&&P.equals(T[T.length-1])||(T=[P],p.push(T)),T.push(D)))))}}return p}Rt(Rc,"Anchor");const cf=1e20;function Ax(t,e,r,s,l,p,g,v,T){for(let S=e;S<e+s;S++)Px(t,r*p+S,p,l,g,v,T);for(let S=r;S<r+l;S++)Px(t,S*p+e,1,s,g,v,T)}function Px(t,e,r,s,l,p,g){p[0]=0,g[0]=-cf,g[1]=cf,l[0]=t[e];for(let v=1,T=0,S=0;v<s;v++){l[v]=t[e+v*r];const P=v*v;do{const D=p[T];S=(l[v]-l[D]+P-D*D)/(v-D)/2}while(S<=g[T]&&--T>-1);T++,p[T]=v,g[T]=S,g[T+1]=cf}for(let v=0,T=0;v<s;v++){for(;g[T+1]<v;)T++;const S=p[T],P=v-S;t[e+v*r]=l[S]+P*P}}const Vo=2,Ag={none:0,ideographs:1,all:2};class Xd{constructor(e,r,s){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const s=[];for(const l in e)for(const p of e[l])s.push({stack:l,id:p});et(s,(({stack:l,id:p},g)=>{let v=this.entries[l];v||(v=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=v.glyphs[p];if(T!==void 0)return void g(null,{stack:l,id:p,glyph:T});if(T=this._tinySDF(v,l,p),T)return v.glyphs[p]=T,void g(null,{stack:l,id:p,glyph:T});const S=Math.floor(p/256);if(256*S>65535)return void g(new Error("glyphs > 65535 not supported"));if(v.ranges[S])return void g(null,{stack:l,id:p,glyph:T});let P=v.requests[S];P||(P=v.requests[S]=[],Xd.loadGlyphRange(l,S,this.url,this.requestManager,((D,L)=>{if(L){v.ascender=L.ascender,v.descender=L.descender;for(const U in L.glyphs)this._doesCharSupportLocalGlyph(+U)||(v.glyphs[+U]=L.glyphs[+U]);v.ranges[S]=!0}for(const U of P)U(D,L);delete v.requests[S]}))),P.push(((D,L)=>{D?g(D):L&&g(null,{stack:l,id:p,glyph:L.glyphs[p]||null})}))}),((l,p)=>{if(l)r(l);else if(p){const g={};for(const{stack:v,id:T,glyph:S}of p)g[v]===void 0&&(g[v]={}),g[v].glyphs===void 0&&(g[v].glyphs={}),g[v].glyphs[T]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},g[v].ascender=this.entries[v].ascender,g[v].descender=this.entries[v].descender;r(null,g)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ag.none&&(this.localGlyphMode===Ag.all?!!this.localFontFamily:!!this.localFontFamily&&(Nt["CJK Unified Ideographs"](e)||Nt["Hangul Syllables"](e)||Nt.Hiragana(e)||Nt.Katakana(e)||Nt["CJK Symbols and Punctuation"](e)))}_tinySDF(e,r,s){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(s))return;let p=e.tinySDF;if(!p){let q="400";/bold/i.test(r)?q="900":/medium/i.test(r)?q="500":/light/i.test(r)&&(q="200"),p=e.tinySDF=new Xd.TinySDF({fontFamily:l,fontWeight:q,fontSize:24*Vo,buffer:3*Vo,radius:8*Vo}),p.fontWeight=q}if(this.localGlyphs[p.fontWeight][s])return this.localGlyphs[p.fontWeight][s];const g=String.fromCharCode(s),{data:v,width:T,height:S,glyphWidth:P,glyphHeight:D,glyphLeft:L,glyphTop:U,glyphAdvance:V}=p.draw(g);return this.localGlyphs[p.fontWeight][s]={id:s,bitmap:new Is({width:T,height:S},v),metrics:{width:P/Vo,height:D/Vo,left:L/Vo,top:U/Vo-27,advance:V/Vo,localGlyph:!0}}}}Xd.loadGlyphRange=function(t,e,r,s,l){const p=256*e,g=p+255,v=s.transformRequest(s.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${p}-${g}`),Ba.Glyphs);Oa(v,((T,S)=>{if(T)l(T);else if(S){const P={},D=(function(L){return new vm(L).readFields(rT,{})})(S);for(const L of D.glyphs)P[L.id]=L;l(null,{glyphs:P,ascender:D.ascender,descender:D.descender})}}))},Xd.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:s=.25,fontFamily:l="sans-serif",fontWeight:p="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=r;const v=this.size=t+4*e,T=this._createCanvas(v),S=this.ctx=T.getContext("2d",{willReadFrequently:!0});S.font=`${g} ${p} ${t}px ${l}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:l,actualBoundingBoxRight:p}=this.ctx.measureText(t),g=Math.ceil(r),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-l))),T=Math.min(this.size-this.buffer,g+Math.ceil(s)),S=v+2*this.buffer,P=T+2*this.buffer,D=Math.max(S*P,0),L=new Uint8ClampedArray(D),U={data:L,width:S,height:P,glyphWidth:v,glyphHeight:T,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(v===0||T===0)return U;const{ctx:V,buffer:q,gridInner:ee,gridOuter:ae}=this;V.clearRect(q,q,v,T),V.fillText(t,q,q+g);const me=V.getImageData(q,q,v,T);ae.fill(cf,0,D),ee.fill(0,0,D);for(let oe=0;oe<T;oe++)for(let fe=0;fe<v;fe++){const be=me.data[4*(oe*v+fe)+3]/255;if(be===0)continue;const _e=(oe+q)*S+fe+q;if(be===1)ae[_e]=0,ee[_e]=cf;else{const qe=.5-be;ae[_e]=qe>0?qe*qe:0,ee[_e]=qe<0?qe*qe:0}}Ax(ae,0,0,S,P,S,this.f,this.v,this.z),Ax(ee,q,q,v,T,S,this.f,this.v,this.z);for(let oe=0;oe<D;oe++){const fe=Math.sqrt(ae[oe])-Math.sqrt(ee[oe]);L[oe]=Math.round(255-255*(fe/this.radius+this.cutoff))}return U}};const Kd=Hs;function Ix(t,e,r,s){const l=[],p=t.image,g=p.pixelRatio,v=p.paddedRect.w-2*Kd,T=p.paddedRect.h-2*Kd,S=t.right-t.left,P=t.bottom-t.top,D=p.stretchX||[[0,v]],L=p.stretchY||[[0,T]],U=(Xe,ut)=>Xe+ut[1]-ut[0],V=D.reduce(U,0),q=L.reduce(U,0),ee=v-V,ae=T-q;let me=0,oe=V,fe=0,be=q,_e=0,qe=ee,Oe=0,ot=ae;if(p.content&&s){const Xe=p.content;me=wm(D,0,Xe[0]),fe=wm(L,0,Xe[1]),oe=wm(D,Xe[0],Xe[2]),be=wm(L,Xe[1],Xe[3]),_e=Xe[0]-me,Oe=Xe[1]-fe,qe=Xe[2]-Xe[0]-oe,ot=Xe[3]-Xe[1]-be}const bt=(Xe,ut,ht,gt)=>{const Ct=Tm(Xe.stretch-me,oe,S,t.left),st=km(Xe.fixed-_e,qe,Xe.stretch,V),Lt=Tm(ut.stretch-fe,be,P,t.top),Gt=km(ut.fixed-Oe,ot,ut.stretch,q),Ft=Tm(ht.stretch-me,oe,S,t.left),wr=km(ht.fixed-_e,qe,ht.stretch,V),Mt=Tm(gt.stretch-fe,be,P,t.top),er=km(gt.fixed-Oe,ot,gt.stretch,q),Tr=new ge(Ct,Lt),Qr=new ge(Ft,Lt),kr=new ge(Ft,Mt),ur=new ge(Ct,Mt),wn=new ge(st/g,Gt/g),Er=new ge(wr/g,er/g),Cr=e*Math.PI/180;if(Cr){const gn=Math.sin(Cr),un=Math.cos(Cr),Dn=[un,-gn,gn,un];Tr._matMult(Dn),Qr._matMult(Dn),ur._matMult(Dn),kr._matMult(Dn)}const cn=Xe.stretch+Xe.fixed,mn=ut.stretch+ut.fixed;return{tl:Tr,tr:Qr,bl:ur,br:kr,tex:{x:p.paddedRect.x+Kd+cn,y:p.paddedRect.y+Kd+mn,w:ht.stretch+ht.fixed-cn,h:gt.stretch+gt.fixed-mn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:wn,pixelOffsetBR:Er,minFontScaleX:qe/g/S,minFontScaleY:ot/g/P,isSDF:r}};if(s&&(p.stretchX||p.stretchY)){const Xe=jx(D,ee,V),ut=jx(L,ae,q);for(let ht=0;ht<Xe.length-1;ht++){const gt=Xe[ht],Ct=Xe[ht+1];for(let st=0;st<ut.length-1;st++)l.push(bt(gt,ut[st],Ct,ut[st+1]))}}else l.push(bt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:T+1}));return l}function wm(t,e,r){let s=0;for(const l of t)s+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return s}function jx(t,e,r){const s=[{fixed:-Kd,stretch:0}];for(const[l,p]of t){const g=s[s.length-1];s.push({fixed:l-g.stretch,stretch:g.stretch}),s.push({fixed:l-g.stretch,stretch:g.stretch+(p-l)})}return s.push({fixed:e+Kd,stretch:r}),s}function Tm(t,e,r,s){return t/e*r+s}function km(t,e,r,s){return t-e*r/s}function uT(t,e,r,s){const l=e+t.positionedLines[s].lineOffset;return s===0?r+l/2:r+(l+(e+t.positionedLines[s-1].lineOffset))/2}class hT{constructor(e=[],r=dT){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,l=r[e];for(;e>0;){const p=e-1>>1,g=r[p];if(s(l,g)>=0)break;r[e]=g,e=p}r[e]=l}_down(e){const{data:r,compare:s}=this,l=this.length>>1,p=r[e];for(;e<l;){let g=1+(e<<1),v=r[g];const T=g+1;if(T<this.length&&s(r[T],v)<0&&(g=T,v=r[T]),s(v,p)>=0)break;r[e]=v,e=g}r[e]=p}}function dT(t,e){return t<e?-1:t>e?1:0}function pT(t,e=1,r=!1){let s=1/0,l=1/0,p=-1/0,g=-1/0;const v=t[0];for(let U=0;U<v.length;U++){const V=v[U];(!U||V.x<s)&&(s=V.x),(!U||V.y<l)&&(l=V.y),(!U||V.x>p)&&(p=V.x),(!U||V.y>g)&&(g=V.y)}const T=Math.min(p-s,g-l);let S=T/2;const P=new hT([],fT);if(T===0)return new ge(s,l);for(let U=s;U<p;U+=T)for(let V=l;V<g;V+=T)P.push(new Yd(U+S,V+S,S,t));let D=(function(U){let V=0,q=0,ee=0;const ae=U[0];for(let me=0,oe=ae.length,fe=oe-1;me<oe;fe=me++){const be=ae[me],_e=ae[fe],qe=be.x*_e.y-_e.x*be.y;q+=(be.x+_e.x)*qe,ee+=(be.y+_e.y)*qe,V+=3*qe}return new Yd(q/V,ee/V,0,U)})(t),L=P.length;for(;P.length;){const U=P.pop();(U.d>D.d||!D.d)&&(D=U,r&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,L)),U.max-D.d<=e||(S=U.h/2,P.push(new Yd(U.p.x-S,U.p.y-S,S,t)),P.push(new Yd(U.p.x+S,U.p.y-S,S,t)),P.push(new Yd(U.p.x-S,U.p.y+S,S,t)),P.push(new Yd(U.p.x+S,U.p.y+S,S,t)),L+=4)}return r&&(console.log(`num probes: ${L}`),console.log(`best distance: ${D.d}`)),D.p}function fT(t,e){return e.max-t.max}class Yd{constructor(e,r,s,l){this.p=new ge(e,r),this.h=s,this.d=(function(p,g){let v=!1,T=1/0;for(let S=0;S<g.length;S++){const P=g[S];for(let D=0,L=P.length,U=L-1;D<L;U=D++){const V=P[D],q=P[U];V.y>p.y!=q.y>p.y&&p.x<(q.x-V.x)*(p.y-V.y)/(q.y-V.y)+V.x&&(v=!v),T=Math.min(T,Gp(p,V,q))}}return(v?1:-1)*Math.sqrt(T)})(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const Jd=7,Pg=Number.POSITIVE_INFINITY,mT=Math.sqrt(2);function Nx(t,[e,r]){let s=0,l=0;if(r===Pg){e<0&&(e=0);const p=e/mT;switch(t){case"top-right":case"top-left":l=p-Jd;break;case"bottom-right":case"bottom-left":l=-p+Jd;break;case"bottom":l=-e+Jd;break;case"top":l=e-Jd}switch(t){case"top-right":case"bottom-right":s=-p;break;case"top-left":case"bottom-left":s=p;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":l=r-Jd;break;case"bottom-right":case"bottom-left":case"bottom":l=-r+Jd}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,l]}function gT(t,e,r,s,l,p,g,v,T,S){t.createArrays(),t.tilePixelRatio=Qt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const P=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,L={};if(t.textSizeData.kind==="composite"){const{minZoom:q,maxZoom:ee}=t.textSizeData;L.compositeTextSizes=[D["text-size"].possiblyEvaluate(new j(q),v),D["text-size"].possiblyEvaluate(new j(ee),v)]}if(t.iconSizeData.kind==="composite"){const{minZoom:q,maxZoom:ee}=t.iconSizeData;L.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new j(q),v),D["icon-size"].possiblyEvaluate(new j(ee),v)]}L.layoutTextSize=D["text-size"].possiblyEvaluate(new j(T+1),v),L.layoutIconSize=D["icon-size"].possiblyEvaluate(new j(T+1),v),L.textMaxSize=D["text-size"].possiblyEvaluate(new j(18),v);const U=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",V=P.get("text-size");for(const q of t.features){const ee=P.get("text-font").evaluate(q,{},v).join(","),ae=V.evaluate(q,{},v),me=L.layoutTextSize.evaluate(q,{},v),oe=(L.layoutIconSize.evaluate(q,{},v),{horizontal:{},vertical:void 0}),fe=q.text;let be,_e=[0,0];if(fe){const ot=fe.toString(),bt=P.get("text-letter-spacing").evaluate(q,{},v)*Oi,Xe=P.get("text-line-height").evaluate(q,{},v)*Oi,ut=Sl(ot)?bt:0,ht=P.get("text-anchor").evaluate(q,{},v),gt=P.get("text-variable-anchor");if(!gt){const Ft=P.get("text-radial-offset").evaluate(q,{},v);_e=Ft?Nx(ht,[Ft*Oi,Pg]):P.get("text-offset").evaluate(q,{},v).map((wr=>wr*Oi))}let Ct=U?"center":P.get("text-justify").evaluate(q,{},v);const st=P.get("symbol-placement")==="point",Lt=st?P.get("text-max-width").evaluate(q,{},v)*Oi:1/0,Gt=Ft=>{t.allowVerticalPlacement&&eo(ot)&&(oe.vertical=Cg(fe,e,r,l,ee,Lt,Xe,ht,Ft,ut,_e,Ra.vertical,!0,me,ae))};if(!U&&gt){const Ft=Ct==="auto"?gt.map((Mt=>Ig(Mt))):[Ct];let wr=!1;for(let Mt=0;Mt<Ft.length;Mt++){const er=Ft[Mt];if(!oe.horizontal[er])if(wr)oe.horizontal[er]=oe.horizontal[0];else{const Tr=Cg(fe,e,r,l,ee,Lt,Xe,"center",er,ut,_e,Ra.horizontal,!1,me,ae);Tr&&(oe.horizontal[er]=Tr,wr=Tr.positionedLines.length===1)}}Gt("left")}else{if(Ct==="auto"&&(Ct=Ig(ht)),st||P.get("text-writing-mode").indexOf("horizontal")>=0||!eo(ot)){const Ft=Cg(fe,e,r,l,ee,Lt,Xe,ht,Ct,ut,_e,Ra.horizontal,!1,me,ae);Ft&&(oe.horizontal[Ct]=Ft)}Gt(st?"left":Ct)}}let qe=!1;if(q.icon&&q.icon.name){const ot=s[q.icon.name];ot&&(be=oT(l[q.icon.name],P.get("icon-offset").evaluate(q,{},v),P.get("icon-anchor").evaluate(q,{},v)),qe=ot.sdf,t.sdfIcons===void 0?t.sdfIcons=ot.sdf:t.sdfIcons!==ot.sdf&&Gr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ot.pixelRatio!==t.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Oe=Lx(oe.horizontal)||oe.vertical;t.iconsInText||(t.iconsInText=!!Oe&&Oe.iconsInText),(Oe||be)&&yT(t,q,oe,be,s,L,me,0,_e,qe,g,v,S)}p&&t.generateCollisionDebugBuffers(T,t.collisionBoxArray)}function Ig(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function yT(t,e,r,s,l,p,g,v,T,S,P,D,L){let U=p.textMaxSize.evaluate(e,{},D);U===void 0&&(U=g);const V=t.layers[0].layout,q=V.get("icon-offset").evaluate(e,{},D),ee=Lx(r.horizontal)||r.vertical,ae=L.name==="globe",me=Oi,oe=g/me,fe=t.tilePixelRatio*U/me,be=(ht=t.overscaling,t.zoom>18&&ht>2&&(ht>>=1),Math.max(Qt/(512*ht),1)*V.get("symbol-spacing")),_e=V.get("text-padding")*t.tilePixelRatio,qe=V.get("icon-padding")*t.tilePixelRatio,Oe=ct(V.get("text-max-angle")),ot=V.get("text-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",bt=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Xe=V.get("symbol-placement"),ut=be/2;var ht;const gt=V.get("icon-text-fit");let Ct;s&&gt!=="none"&&(t.allowVerticalPlacement&&r.vertical&&(Ct=wx(s,r.vertical,gt,V.get("icon-text-fit-padding"),q,oe)),ee&&(s=wx(s,ee,gt,V.get("icon-text-fit-padding"),q,oe)));const st=(Lt,Gt,Ft)=>{if(Gt.x<0||Gt.x>=Qt||Gt.y<0||Gt.y>=Qt)return;let wr=null;if(ae){const{x:Mt,y:er,z:Tr}=L.projectTilePoint(Gt.x,Gt.y,Ft);wr={anchor:new Rc(Mt,er,Tr,0,void 0),up:L.upVector(Ft,Gt.x,Gt.y)}}(function(Mt,er,Tr,Qr,kr,ur,wn,Er,Cr,cn,mn,gn,un,Dn,Zn,ii,hn,_i,si,Un,rn,ai,yn,Ns,oi){const Ui=Mt.addToLineVertexArray(er,Qr);let Ii,Ds,ji,Go,tp,xf,_f,f_=0,m_=0,g_=0,y_=0,qg=-1,Zg=-1;const Vl={};let x_=Ps("");const Wh=Tr?Tr.anchor:er;let Hg=0,Xg=0;if(Cr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Hg,Xg]=Cr.layout.get("text-offset").evaluate(rn,{},oi).map((pa=>pa*Oi)):(Hg=Cr.layout.get("text-radial-offset").evaluate(rn,{},oi)*Oi,Xg=Pg),Mt.allowVerticalPlacement&&kr.vertical){const pa=kr.vertical;if(Zn)xf=jg(pa),Er&&(_f=jg(Er));else{const fa=Cr.layout.get("text-rotate").evaluate(rn,{},oi)+90;ji=Sm(cn,Wh,er,mn,gn,un,pa,Dn,fa,ii),Er&&(Go=Sm(cn,Wh,er,mn,gn,un,Er,_i,fa))}}if(ur){const pa=Cr.layout.get("icon-rotate").evaluate(rn,{},oi),fa=Cr.layout.get("icon-text-fit")!=="none",vf=Ix(ur,pa,yn,fa),Yg=Er?Ix(Er,pa,yn,fa):void 0;Ds=Sm(cn,Wh,er,mn,gn,un,ur,_i,pa),f_=4*vf.length;const __=Mt.iconSizeData;let qh=null;__.kind==="source"?(qh=[Uo*Cr.layout.get("icon-size").evaluate(rn,{},oi)],qh[0]>Au&&Gr(`${Mt.layerIds[0]}: Value for "icon-size" is >= ${uf}. Reduce your "icon-size".`)):__.kind==="composite"&&(qh=[Uo*ai.compositeIconSizes[0].evaluate(rn,{},oi),Uo*ai.compositeIconSizes[1].evaluate(rn,{},oi)],(qh[0]>Au||qh[1]>Au)&&Gr(`${Mt.layerIds[0]}: Value for "icon-size" is >= ${uf}. Reduce your "icon-size".`)),Mt.addSymbols(Mt.icon,vf,qh,Un,si,rn,!1,Tr,er,Ui.lineStartIndex,Ui.lineLength,-1,Ns,oi),qg=Mt.icon.placedSymbolArray.length-1,Yg&&(m_=4*Yg.length,Mt.addSymbols(Mt.icon,Yg,qh,Un,si,rn,Ra.vertical,Tr,er,Ui.lineStartIndex,Ui.lineLength,-1,Ns,oi),Zg=Mt.icon.placedSymbolArray.length-1)}for(const pa in kr.horizontal){const fa=kr.horizontal[pa];Ii||(x_=Ps(fa.text),Zn?tp=jg(fa):Ii=Sm(cn,Wh,er,mn,gn,un,fa,Dn,Cr.layout.get("text-rotate").evaluate(rn,{},oi),ii));const vf=fa.positionedLines.length===1;if(g_+=Dx(Mt,Tr,er,fa,wn,Cr,Zn,rn,ii,Ui,kr.vertical?Ra.horizontal:Ra.horizontalOnly,vf?Object.keys(kr.horizontal):[pa],Vl,qg,ai,Ns,oi),vf)break}kr.vertical&&(y_+=Dx(Mt,Tr,er,kr.vertical,wn,Cr,Zn,rn,ii,Ui,Ra.vertical,["vertical"],Vl,Zg,ai,Ns,oi));let Lu=-1;const Kg=(pa,fa)=>pa?Math.max(pa,fa):fa;Lu=Kg(tp,Lu),Lu=Kg(xf,Lu),Lu=Kg(_f,Lu);const WT=Lu>-1?1:0;Mt.glyphOffsetArray.length>=Iu.MAX_GLYPHS&&Gr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),rn.sortKey!==void 0&&Mt.addToSortKeyRanges(Mt.symbolInstances.length,rn.sortKey),Mt.symbolInstances.emplaceBack(Wh.x,Wh.y,Wh.z,er.x,er.y,Vl.right>=0?Vl.right:-1,Vl.center>=0?Vl.center:-1,Vl.left>=0?Vl.left:-1,Vl.vertical>=0?Vl.vertical:-1,qg,Zg,x_,Ii!==void 0?Ii:Mt.collisionBoxArray.length,Ii!==void 0?Ii+1:Mt.collisionBoxArray.length,ji!==void 0?ji:Mt.collisionBoxArray.length,ji!==void 0?ji+1:Mt.collisionBoxArray.length,Ds!==void 0?Ds:Mt.collisionBoxArray.length,Ds!==void 0?Ds+1:Mt.collisionBoxArray.length,Go||Mt.collisionBoxArray.length,Go?Go+1:Mt.collisionBoxArray.length,mn,g_,y_,f_,m_,WT,0,Hg,Xg,Lu)})(t,Gt,wr,Lt,r,s,l,Ct,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,_e,ot,T,0,qe,bt,q,e,p,S,P,D)};if(Xe==="line")for(const Lt of Mx(e.geometry,0,0,Qt,Qt)){const Gt=cT(Lt,be,Oe,r.vertical||ee,s,me,fe,t.overscaling,Qt);for(const Ft of Gt)ee&&xT(t,ee.text,ut,Ft)||st(Lt,Ft,D)}else if(Xe==="line-center"){for(const Lt of e.geometry)if(Lt.length>1){const Gt=lT(Lt,Oe,r.vertical||ee,s,me,fe);Gt&&st(Lt,Gt,D)}}else if(e.type==="Polygon")for(const Lt of rf(e.geometry,0)){const Gt=pT(Lt,16);st(Lt[0],new Rc(Gt.x,Gt.y,0,0,void 0),D)}else if(e.type==="LineString")for(const Lt of e.geometry)st(Lt,new Rc(Lt[0].x,Lt[0].y,0,0,void 0),D);else if(e.type==="Point")for(const Lt of e.geometry)for(const Gt of Lt)st([Gt],new Rc(Gt.x,Gt.y,0,0,void 0),D)}const uf=255,Au=uf*Uo;function Dx(t,e,r,s,l,p,g,v,T,S,P,D,L,U,V,q,ee){const ae=(function(fe,be,_e,qe,Oe,ot,bt,Xe){const ut=[];if(be.positionedLines.length===0)return ut;const ht=qe.layout.get("text-rotate").evaluate(ot,{})*Math.PI/180,gt=(function(Ft){const wr=Ft[0],Mt=Ft[1],er=wr*Mt;return er>0?[wr,-Mt]:er<0?[-wr,Mt]:wr===0?[Mt,wr]:[Mt,-wr]})(_e);let Ct=Math.abs(be.top-be.bottom);for(const Ft of be.positionedLines)Ct-=Ft.lineOffset;const st=be.positionedLines.length,Lt=Ct/st;let Gt=be.top-_e[1];for(let Ft=0;Ft<st;++Ft){const wr=be.positionedLines[Ft];Gt=uT(be,Lt,Gt,Ft);for(const Mt of wr.positionedGlyphs){if(!Mt.rect)continue;const er=Mt.rect||{};let Tr=fx+1,Qr=!0,kr=1,ur=0;if(Mt.imageName){const yn=bt[Mt.imageName];if(!yn)continue;if(yn.sdf){Gr("SDF images are not supported in formatted text and will be ignored.");continue}Qr=!1,kr=yn.pixelRatio,Tr=Hs/kr}const wn=(Oe||Xe)&&Mt.vertical,Er=Mt.metrics.advance*Mt.scale/2,Cr=Mt.metrics,cn=Mt.rect;if(cn===null)continue;Xe&&be.verticalizable&&(ur=Mt.imageName?Er-Mt.metrics.width*Mt.scale/2:0);const mn=Oe?[Mt.x+Er,Mt.y]:[0,0];let gn=[0,0],un=[0,0],Dn=!1;Oe||(wn?(un=[Mt.x+Er+gt[0],Mt.y+gt[1]-ur],Dn=!0):gn=[Mt.x+Er+_e[0],Mt.y+_e[1]-ur]);const Zn=cn.w*Mt.scale/(kr*(Mt.localGlyph?Vo:1)),ii=cn.h*Mt.scale/(kr*(Mt.localGlyph?Vo:1));let hn,_i,si,Un;if(wn){const yn=Mt.y-Gt,Ns=new ge(-Er,Er-yn),oi=-Math.PI/2,Ui=new ge(...un);hn=new ge(-Er+gn[0],gn[1]),hn._rotateAround(oi,Ns)._add(Ui),hn.x+=-yn+Er,hn.y-=(Cr.left-Tr)*Mt.scale;const Ii=Mt.imageName?Cr.advance*Mt.scale:Oi*Mt.scale,Ds=String.fromCharCode(Mt.glyph);Ww(Ds)?hn.x+=(1-Tr)*Mt.scale:qw(Ds)?hn.x+=Ii-Cr.height*Mt.scale+(-Tr-1)*Mt.scale:hn.x+=Mt.imageName||Cr.width+2*Tr===cn.w&&Cr.height+2*Tr===cn.h?(Ii-ii)/2:(Ii-(Cr.height+2*Tr)*Mt.scale)/2,_i=new ge(hn.x,hn.y-Zn),si=new ge(hn.x+ii,hn.y),Un=new ge(hn.x+ii,hn.y-Zn)}else{const yn=(Cr.left-Tr)*Mt.scale-Er+gn[0],Ns=(-Cr.top-Tr)*Mt.scale+gn[1],oi=yn+Zn,Ui=Ns+ii;hn=new ge(yn,Ns),_i=new ge(oi,Ns),si=new ge(yn,Ui),Un=new ge(oi,Ui)}if(ht){let yn;yn=Oe?new ge(0,0):Dn?new ge(gt[0],gt[1]):new ge(_e[0],_e[1]),hn._rotateAround(ht,yn),_i._rotateAround(ht,yn),si._rotateAround(ht,yn),Un._rotateAround(ht,yn)}const rn=new ge(0,0),ai=new ge(0,0);ut.push({tl:hn,tr:_i,bl:si,br:Un,tex:er,writingMode:be.writingMode,glyphOffset:mn,sectionIndex:Mt.sectionIndex,isSDF:Qr,pixelOffsetTL:rn,pixelOffsetBR:ai,minFontScaleX:0,minFontScaleY:0})}}return ut})(0,s,T,p,g,v,l,t.allowVerticalPlacement),me=t.textSizeData;let oe=null;me.kind==="source"?(oe=[Uo*p.layout.get("text-size").evaluate(v,{},ee)],oe[0]>Au&&Gr(`${t.layerIds[0]}: Value for "text-size" is >= ${uf}. Reduce your "text-size".`)):me.kind==="composite"&&(oe=[Uo*V.compositeTextSizes[0].evaluate(v,{},ee),Uo*V.compositeTextSizes[1].evaluate(v,{},ee)],(oe[0]>Au||oe[1]>Au)&&Gr(`${t.layerIds[0]}: Value for "text-size" is >= ${uf}. Reduce your "text-size".`)),t.addSymbols(t.text,ae,oe,T,g,v,P,e,r,S.lineStartIndex,S.lineLength,U,q,ee);for(const fe of D)L[fe]=t.text.placedSymbolArray.length-1;return 4*ae.length}function Lx(t){for(const e in t)return t[e];return null}function Sm(t,e,r,s,l,p,g,v,T,S){let P=g.top,D=g.bottom,L=g.left,U=g.right;const V=g.collisionPadding;if(V&&(L-=V[0],P-=V[1],U+=V[2],D+=V[3]),T){const q=new ge(L,P),ee=new ge(U,P),ae=new ge(L,D),me=new ge(U,D),oe=ct(T);let fe=new ge(0,0);S&&(fe=new ge(S[0],S[1])),q._rotateAround(oe,fe),ee._rotateAround(oe,fe),ae._rotateAround(oe,fe),me._rotateAround(oe,fe),L=Math.min(q.x,ee.x,ae.x,me.x),U=Math.max(q.x,ee.x,ae.x,me.x),P=Math.min(q.y,ee.y,ae.y,me.y),D=Math.max(q.y,ee.y,ae.y,me.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,L,P,U,D,v,s,l,p),t.length-1}function jg(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function xT(t,e,r,s){const l=t.compareText;if(e in l){const p=l[e];for(let g=p.length-1;g>=0;g--)if(s.dist(p[g])<r)return!0}else l[e]=[];return l[e].push(s),!1}function Rx(t,e){const r=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,l=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),p=Math.sin(r)*l/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),g=Math.sin(t._pitch)*p+l;return Math.min(1.01*g,l*(1/t._horizonShift))}function $h(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),s=t.x*r,l=(t.x+1)*r,p=t.y*r,g=(t.y+1)*r,v=Mi(s),T=Mi(l),S=Yr(p),P=Yr(g),D=e.project(v,S),L=e.project(T,S),U=e.project(T,P),V=e.project(v,P);let q=Math.min(D.x,L.x,U.x,V.x),ee=Math.min(D.y,L.y,U.y,V.y),ae=Math.max(D.x,L.x,U.x,V.x),me=Math.max(D.y,L.y,U.y,V.y);const oe=r/16;function fe(_e,qe,Oe,ot,bt,Xe){const ut=(Oe+bt)/2,ht=(ot+Xe)/2,gt=e.project(Mi(ut),Yr(ht)),Ct=Math.max(0,q-gt.x,ee-gt.y,gt.x-ae,gt.y-me);q=Math.min(q,gt.x),ae=Math.max(ae,gt.x),ee=Math.min(ee,gt.y),me=Math.max(me,gt.y),Ct>oe&&(fe(_e,gt,Oe,ot,ut,ht),fe(gt,qe,ut,ht,bt,Xe))}fe(D,L,s,p,l,p),fe(L,U,l,p,l,g),fe(U,V,l,g,s,g),fe(V,D,s,g,s,p),q-=oe,ee-=oe,ae+=oe,me+=oe;const be=1/Math.max(ae-q,me-ee);return{scale:be,x:q*be,y:ee*be,x2:ae*be,y2:me*be,projection:e}}const _T=Ia(new Float32Array(16));class Pu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new rr(0,0)}projectTilePoint(e,r,s){return{x:e,y:r,z:0}}locationPoint(e,r,s=!0){return e._coordinatePoint(e.locationCoordinate(r),s)}pixelsPerMeter(e,r){return qn(1,e)*r}pixelSpaceConversion(e,r,s){return 1}farthestPixelDistance(e){return Rx(e,e.pixelsPerMeter)}pointCoordinate(e,r,s,l){const p=e.horizonLineFromTop(!1),g=new ge(r,Math.max(p,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,l))}pointCoordinate3D(e,r,s){const l=new ge(r,s);if(e.elevation)return e.elevation.pointCoordinate(l);{const p=this.pointCoordinate(e,l.x,l.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const s=e.horizonLineFromTop();return r.y<s}createInversionMatrix(e,r){return _T}createTileMatrix(e,r,s){let l,p,g;const v=s.canonical,T=Ia(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=$h(v,this);l=1,p=S.x+s.wrap*S.scale,g=S.y,Pl(T,T,[l/S.scale,l/S.scale,e.pixelsPerMeter/r])}else l=r/e.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*s.wrap)*l,g=v.y*l;return Al(T,T,[p,g,0]),Pl(T,T,[l/Qt,l/Qt,1]),T}upVector(e,r,s){return[0,0,1]}upVectorScale(e,r,s){return{metersToTile:1}}}class vT extends Pu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,s]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(ct(r));this.n=(l+Math.sin(ct(s)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:s,c:l,r0:p}=this,g=ct(e-this.center[0]),v=ct(r),T=Math.sqrt(l-2*s*Math.sin(v))/s;return{x:T*Math.sin(g*s),y:T*Math.cos(g*s)-p,z:0}}unproject(e,r){const{n:s,c:l,r0:p}=this,g=p+r;let v=Math.atan2(e,Math.abs(g))*Math.sign(g);g*s<0&&(v-=Math.PI*Math.sign(e)*Math.sign(g));const T=ct(this.center[0])*s;v=ve(v,-Math.PI-T,Math.PI-T);const S=Be(Kt(v/s)+this.center[0],-180,180),P=Math.asin(Be((l-(e*e+g*g)*s*s)/(2*s),-1,1)),D=Be(Kt(P),-Fn,Fn);return new rr(S,D)}}const hf=1.340264,df=-.081106,pf=893e-6,ff=.003796,Em=Math.sqrt(3)/2;class bT extends Pu{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Em*Math.sin(r)),l=s*s,p=l*l*l;return{x:.5*(e*Math.cos(s)/(Em*(hf+3*df*l+p*(7*pf+9*ff*l)))/Math.PI+.5),y:1-.5*(s*(hf+df*l+p*(pf+ff*l))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,l=s*s,p=l*l*l;for(let P,D,L,U=0;U<12&&(D=s*(hf+df*l+p*(pf+ff*l))-r,L=hf+3*df*l+p*(7*pf+9*ff*l),P=D/L,s=Be(s-P,-Math.PI/3,Math.PI/3),l=s*s,p=l*l*l,!(Math.abs(P)<1e-12));++U);const g=Em*e*(hf+3*df*l+p*(7*pf+9*ff*l))/Math.cos(s),v=Math.asin(Math.sin(s)/Em),T=Be(180*g/Math.PI,-180,180),S=Be(180*v/Math.PI,-Fn,Fn);return new rr(T,S)}}class wT extends Pu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const s=360*(e-.5),l=Be(360*(.5-r),-Fn,Fn);return new rr(s,l)}}const Qd=Math.PI/2;function Cm(t){return Math.tan((Qd+t)/2)}class TT extends Pu{constructor(e){super(e),this.center=e.center||[0,30];const[r,s]=this.parallels=e.parallels||[30,30];let l=ct(r),p=ct(s);this.southernCenter=l+p<0,this.southernCenter&&(l=-l,p=-p);const g=Math.cos(l),v=Cm(l);this.n=l===p?Math.sin(l):Math.log(g/Math.cos(p))/Math.log(Cm(p)/v),this.f=g*Math.pow(Cm(l),this.n)/this.n}project(e,r){r=ct(r),this.southernCenter&&(r=-r),e=ct(e-this.center[0]);const s=1e-6,{n:l,f:p}=this;p>0?r<-Qd+s&&(r=-Qd+s):r>Qd-s&&(r=Qd-s);const g=p/Math.pow(Cm(r),l);let v=g*Math.sin(l*e),T=p-g*Math.cos(l*e);return v=.5*(v/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:v,y:this.southernCenter?T:1-T,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:s,f:l}=this,p=l-r,g=Math.sign(p),v=Math.sign(s)*Math.sqrt(e*e+p*p);let T=Math.atan2(e,Math.abs(p))*g;p*s<0&&(T-=Math.PI*Math.sign(e)*g);const S=Be(Kt(T/s)+this.center[0],-180,180),P=Be(Kt(2*Math.atan(Math.pow(l/v,1/s))-Qd),-Fn,Fn);return new rr(S,this.southernCenter?-P:P)}}class zx extends Pu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:pn(e),y:Mn(r),z:0}}unproject(e,r){const s=Mi(e),l=Yr(r);return new rr(s,l)}}const Bx=ct(Fn);class kT extends Pu{project(e,r){const s=(r=ct(r))*r,l=s*s;return{x:.5*((e=ct(e))*(.8707-.131979*s+l*(l*(.003971*s-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+s*(.015085+l*(.028874*s-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,l=25,p=0,g=s*s;do{g=s*s;const S=g*g;p=(s*(1.007226+g*(.015085+S*(.028874*g-.044475-.005916*S)))-r)/(1.007226+g*(.045255+S*(.259866*g-.311325-.005916*11*S))),s=Be(s-p,-Bx,Bx)}while(Math.abs(p)>1e-6&&--l>0);g=s*s;const v=Be(Kt(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),T=Kt(s);return new rr(v,T)}}const Fx=ct(Fn);class ST extends Pu{project(e,r){r=ct(r),e=ct(e);const s=Math.cos(r),l=2/Math.PI,p=Math.acos(s*Math.cos(e/2)),g=Math.sin(p)/p,v=.5*(e*l+2*s*Math.sin(e/2)/g)||0,T=.5*(r+Math.sin(r)/g)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(e,r){let s=e=(2*e-.5)*Math.PI,l=r=(2*(1-r)-1)*Math.PI,p=25;const g=1e-6;let v=0,T=0;do{const S=Math.cos(l),P=Math.sin(l),D=2*P*S,L=P*P,U=S*S,V=Math.cos(s/2),q=Math.sin(s/2),ee=2*V*q,ae=q*q,me=1-U*V*V,oe=me?1/me:0,fe=me?Math.acos(S*V)*Math.sqrt(1/me):0,be=.5*(2*fe*S*q+2*s/Math.PI)-e,_e=.5*(fe*P+l)-r,qe=.5*oe*(U*ae+fe*S*V*L)+1/Math.PI,Oe=oe*(ee*D/4-fe*P*q),ot=.125*oe*(D*q-fe*P*U*ee),bt=.5*oe*(L*V+fe*ae*S)+.5,Xe=Oe*ot-bt*qe;v=(_e*Oe-be*bt)/Xe,T=(be*ot-_e*qe)/Xe,s=Be(s-v,-Math.PI,Math.PI),l=Be(l-T,-Fx,Fx)}while((Math.abs(v)>g||Math.abs(T)>g)&&--p>0);return new rr(Kt(s),Kt(l))}}class Ox extends Pu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ct(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:s,cosPhi:l}=this;return{x:ct(e)*l*s+.5,y:-Math.sin(ct(r))/l*s+.5,z:0}}unproject(e,r){const{scale:s,cosPhi:l}=this,p=-(r-.5)/s,g=Be(Kt((e-.5)/s)/l,-180,180),v=Math.asin(Be(p*l,-1,1)),T=Be(Kt(v),-Fn,Fn);return new rr(g,T)}}class ET extends zx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,s){const l=ha(e,r,s);return Nn(l,l,hs(Zs(s))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,r){const s=Ki(r.lat,r.lng),l=zi([],s),p=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;yu(s,s,l,qn(1,0)*Qt*p);const g=Ia(new Float64Array(16));return Bo(g,e.pixelMatrix,e.globeMatrix),Nn(s,s,g),new ge(s[0],s[1])}pixelsPerMeter(e,r){return qn(1,0)*r}pixelSpaceConversion(e,r,s){const l=qn(1,e)*r,p=Fr(qn(1,45)*r,l,s);return this.pixelsPerMeter(e,r)/p}createTileMatrix(e,r,s){const l=Id(Zs(s.canonical));return Bo(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,r){const{center:s}=e,l=hs(Zs(r));return bh(l,l,ct(s.lng)),bd(l,l,ct(s.lat)),Pl(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,r,s,l){return zp(e,r,s,!0)||new Nl(0,0)}pointCoordinate3D(e,r,s){const l=this.pointCoordinate(e,r,s,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,r){return!zp(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=(function(l,p){const g=l.cameraToCenterDistance,v=l._centerAltitude*p,T=l._camera,S=l._camera.forward(),P=so([],Sn([],S,-g),[0,0,v]),D=l.worldSize/(2*Math.PI),L=[0,0,-D],U=l.width/l.height,V=Math.tan(l.fovAboveCenter),q=Sn([],T.up(),V),ee=Sn([],T.right(),V*U),ae=zi([],so([],so([],S,q),ee)),me=[];let oe;if(new Ad(P,ae).closestPointOnSphere(L,D,me)){const fe=so([],me,L),be=qs([],fe,P);oe=Math.cos(l.fovAboveCenter)*gu(be)}else{const fe=qs([],P,L),be=qs([],L,P);zi(be,be);const _e=gu(fe)-D;oe=Math.sqrt(_e*(_e+2*D));const qe=Math.acos(oe/(D+_e))-Math.acos(Ws(S,be));oe*=Math.cos(qe)}return 1.01*oe})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=wu(e.zoom);if(s>0){const l=Rx(e,qn(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Fr(r,l+p*(1-Math.cos(g)),Math.pow(s,10))}return r}upVector(e,r,s){return ha(r,s,e,1)}upVectorScale(e){return{metersToTile:vu(Ah(Zs(e)))}}}function Ux(t){const e=t.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new zx(t);case"equirectangular":return new wT(t);case"naturalEarth":return new kT(t);case"equalEarth":return new bT(t);case"winkelTripel":return new ST(t);case"albers":return r?new Ox(t):new vT(t);case"lambertConformalConic":return r?new Ox(t):new TT(t);case"globe":return new ET(t)}throw new Error(`Invalid projection name: ${t.name}`)}const CT=fr.types,MT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Mm(t,e,r,s,l,p,g,v,T,S,P,D,L){const U=v?Math.min(Au,Math.round(v[0])):0,V=v?Math.min(Au,Math.round(v[1])):0;t.emplaceBack(e,r,Math.round(32*s),Math.round(32*l),p,g,(U<<1)+(T?1:0),V,16*S,16*P,256*D,256*L)}function Am(t,e,r,s,l,p,g){t.emplaceBack(e,r,s,l,p,g)}function Pm(t,e,r,s,l){t.emplaceBack(e,r,s,l),t.emplaceBack(e,r,s,l),t.emplaceBack(e,r,s,l),t.emplaceBack(e,r,s,l)}function AT(t){for(const e of t.sections)if(Ma(e.text))return!0;return!1}class Ng{constructor(e){this.layoutVertexArray=new pt,this.indexArray=new Zt,this.programConfigurations=e,this.segments=new Wn,this.dynamicLayoutVertexArray=new mt,this.opacityVertexArray=new Wt,this.placedSymbolArray=new jn,this.globeExtVertexArray=new vt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Fw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,MT,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Bw.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Rt(Ng,"SymbolBuffers");class Dg{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new Wn,this.collisionVertexArray=new Sr,this.collisionVertexArrayExt=new Pr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Ow.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Uw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Rt(Dg,"CollisionBuffers");class Iu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ia([]),this.placementViewportMatrix=Ia([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wg(this.zoom,r["text-size"]),this.iconSizeData=wg(this.zoom,r["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),p=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map((g=>Ra[g])),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id)),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Ng(new Ml(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Ng(new Ml(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Hn,this.lineVertexArray=new bn,this.symbolInstances=new ln}calculateGlyphDependencies(e,r,s,l,p){for(let g=0;g<e.length;g++)if(r[e.charCodeAt(g)]=!0,l&&p){const v=of[e.charAt(g)];v&&(r[v.charCodeAt(0)]=!0)}}populate(e,r,s,l){const p=this.layers[0],g=p.layout,v=this.projection.name==="globe",T=g.get("text-font"),S=g.get("text-field"),P=g.get("icon-image"),D=(S.value.kind!=="constant"||S.value.value instanceof pi&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),L=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,U=g.get("symbol-sort-key");if(this.features=[],!D&&!L)return;const V=r.iconDependencies,q=r.glyphDependencies,ee=r.availableImages,ae=new j(this.zoom);for(const{feature:me,id:oe,index:fe,sourceLayerIndex:be}of e){const _e=p._featureFilter.needGeometry,qe=co(me,_e);if(!p._featureFilter.filter(ae,qe,s))continue;if(_e||(qe.geometry=Yi(me,s,l)),v&&me.type!==1&&s.z<=5){const Xe=qe.geometry,ut=.98078528056,ht=(gt,Ct)=>Ws(ha(gt.x,gt.y,s,1),ha(Ct.x,Ct.y,s,1))<ut;for(let gt=0;gt<Xe.length;gt++)Xe[gt]=ku(Xe[gt],ht)}let Oe,ot;if(D){const Xe=p.getValueAndResolveTokens("text-field",qe,s,ee),ut=pi.factory(Xe);AT(ut)&&(this.hasRTLText=!0),(!this.hasRTLText||b()==="unavailable"||this.hasRTLText&&M.isParsed())&&(Oe=Gw(ut,p,qe))}if(L){const Xe=p.getValueAndResolveTokens("icon-image",qe,s,ee);ot=Xe instanceof bs?Xe:bs.fromString(Xe)}if(!Oe&&!ot)continue;const bt=this.sortFeaturesByKey?U.evaluate(qe,{},s):void 0;if(this.features.push({id:oe,text:Oe,icon:ot,index:fe,sourceLayerIndex:be,geometry:qe.geometry,properties:me.properties,type:CT[me.type],sortKey:bt}),ot&&(V[ot.name]=!0),Oe){const Xe=T.evaluate(qe,{},s).join(","),ut=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ra.vertical)>=0;for(const ht of Oe.sections)if(ht.image)V[ht.image.name]=!0;else{const gt=eo(Oe.toString()),Ct=ht.fontStack||Xe,st=q[Ct]=q[Ct]||{};this.calculateGlyphDependencies(ht.text,st,ut,this.allowVerticalPlacement,gt)}}}g.get("symbol-placement")==="line"&&(this.features=(function(me){const oe={},fe={},be=[];let _e=0;function qe(Xe){be.push(me[Xe]),_e++}function Oe(Xe,ut,ht){const gt=fe[Xe];return delete fe[Xe],fe[ut]=gt,be[gt].geometry[0].pop(),be[gt].geometry[0]=be[gt].geometry[0].concat(ht[0]),gt}function ot(Xe,ut,ht){const gt=oe[ut];return delete oe[ut],oe[Xe]=gt,be[gt].geometry[0].shift(),be[gt].geometry[0]=ht[0].concat(be[gt].geometry[0]),gt}function bt(Xe,ut,ht){const gt=ht?ut[0][ut[0].length-1]:ut[0][0];return`${Xe}:${gt.x}:${gt.y}`}for(let Xe=0;Xe<me.length;Xe++){const ut=me[Xe],ht=ut.geometry,gt=ut.text?ut.text.toString():null;if(!gt){qe(Xe);continue}const Ct=bt(gt,ht),st=bt(gt,ht,!0);if(Ct in fe&&st in oe&&fe[Ct]!==oe[st]){const Lt=ot(Ct,st,ht),Gt=Oe(Ct,st,be[Lt].geometry);delete oe[Ct],delete fe[st],fe[bt(gt,be[Gt].geometry,!0)]=Gt,be[Lt].geometry=null}else Ct in fe?Oe(Ct,st,ht):st in oe?ot(Ct,st,ht):(qe(Xe),oe[Ct]=_e-1,fe[st]=_e-1)}return be.filter((Xe=>Xe.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((me,oe)=>me.sortKey-oe.sortKey))}update(e,r,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s,l),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Ux(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:p}of r)this.lineVertexArray.emplaceBack(l,p);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,l,p,g,v,T,S,P,D,L,U,V){const q=e.indexArray,ee=e.layoutVertexArray,ae=e.globeExtVertexArray,me=e.segments.prepareSegment(4*r.length,ee,q,this.canOverlap?g.sortKey:void 0),oe=this.glyphOffsetArray.length,fe=me.vertexLength,be=this.allowVerticalPlacement&&v===Ra.vertical?Math.PI/2:0,_e=g.text&&g.text.sections;for(let Oe=0;Oe<r.length;Oe++){const{tl:ot,tr:bt,bl:Xe,br:ut,tex:ht,pixelOffsetTL:gt,pixelOffsetBR:Ct,minFontScaleX:st,minFontScaleY:Lt,glyphOffset:Gt,isSDF:Ft,sectionIndex:wr}=r[Oe],Mt=me.vertexLength,er=Gt[1];if(Mm(ee,S.x,S.y,ot.x,er+ot.y,ht.x,ht.y,s,Ft,gt.x,gt.y,st,Lt),Mm(ee,S.x,S.y,bt.x,er+bt.y,ht.x+ht.w,ht.y,s,Ft,Ct.x,gt.y,st,Lt),Mm(ee,S.x,S.y,Xe.x,er+Xe.y,ht.x,ht.y+ht.h,s,Ft,gt.x,Ct.y,st,Lt),Mm(ee,S.x,S.y,ut.x,er+ut.y,ht.x+ht.w,ht.y+ht.h,s,Ft,Ct.x,Ct.y,st,Lt),T){const{x:Tr,y:Qr,z:kr}=T.anchor,[ur,wn,Er]=T.up;Am(ae,Tr,Qr,kr,ur,wn,Er),Am(ae,Tr,Qr,kr,ur,wn,Er),Am(ae,Tr,Qr,kr,ur,wn,Er),Am(ae,Tr,Qr,kr,ur,wn,Er),Pm(e.dynamicLayoutVertexArray,Tr,Qr,kr,be)}else Pm(e.dynamicLayoutVertexArray,S.x,S.y,S.z,be);q.emplaceBack(Mt,Mt+1,Mt+2),q.emplaceBack(Mt+1,Mt+2,Mt+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Gt[0]),Oe!==r.length-1&&wr===r[Oe+1].sectionIndex||e.programConfigurations.populatePaintArrays(ee.length,g,g.index,{},U,V,_e&&_e[wr])}const qe=T?T.anchor:S;e.placedSymbolArray.emplaceBack(qe.x,qe.y,qe.z,S.x,S.y,oe,this.glyphOffsetArray.length-oe,fe,P,D,S.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],v,0,!1,0,L,0)}_commitLayoutVertex(e,r,s,l,p,g,v){e.emplaceBack(r,s,l,p,g,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,r,s,l,p,g,v){const T=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),S=T.vertexLength,P=v.tileAnchorX,D=v.tileAnchorY;for(let U=0;U<4;U++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,l,p,g,P,D,new ge(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,l,p,g,P,D,new ge(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,l,p,g,P,D,new ge(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,l,p,g,P,D,new ge(e.x1,e.y2)),T.vertexLength+=4;const L=s.indexArray;L.emplaceBack(S,S+1),L.emplaceBack(S+1,S+2),L.emplaceBack(S+2,S+3),L.emplaceBack(S+3,S),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,s,l,p,g){for(let v=l;v<p;v++){const T=s.get(v),S=this.getSymbolInstanceTextSize(e,g,r,v);this._addCollisionDebugVertices(T,S,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,r,s,l,p,g){for(let v=l;v<p;v++){const T=s.get(v),S=this.getSymbolInstanceIconSize(e,r,g.placedIconSymbolIndex);this._addCollisionDebugVertices(T,S,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Dg(Vt,ax.members,In),this.iconCollisionBox=new Dg(Vt,ax.members,In);const s=Wd(this.iconSizeData,e),l=Wd(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(l,e,r,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(l,e,r,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,e,r,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,e,r,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,r,s,l){const p=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:l),g=xm(this.textSizeData,e,p)/Oi;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,r,s){const l=this.icon.placedSymbolArray.get(s),p=xm(this.iconSizeData,e,l);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,r,s){e.emplaceBack(r,-s,-s),e.emplaceBack(r,s,-s),e.emplaceBack(r,s,s),e.emplaceBack(r,-s,s)}_updateTextDebugCollisionBoxes(e,r,s,l,p,g){for(let v=l;v<p;v++){const T=s.get(v),S=this.getSymbolInstanceTextSize(e,g,r,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,T.padding)}}_updateIconDebugCollisionBoxes(e,r,s,l,p,g){for(let v=l;v<p;v++){const T=s.get(v),S=this.getSymbolInstanceIconSize(e,r,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,T.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Wd(this.iconSizeData,e),l=Wd(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(l,e,r,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(l,e,r,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(s,e,r,g.iconBoxStartIndex,g.iconBoxEndIndex,g.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,e,r,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,s,l,p,g,v,T,S){const P={};if(r<s){const{x1:D,y1:L,x2:U,y2:V,padding:q,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:me,tileAnchorX:oe,tileAnchorY:fe,featureIndex:be}=e.get(r);P.textBox={x1:D,y1:L,x2:U,y2:V,padding:q,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:me,tileAnchorX:oe,tileAnchorY:fe},P.textFeatureIndex=be}if(l<p){const{x1:D,y1:L,x2:U,y2:V,padding:q,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:me,tileAnchorX:oe,tileAnchorY:fe,featureIndex:be}=e.get(l);P.verticalTextBox={x1:D,y1:L,x2:U,y2:V,padding:q,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:me,tileAnchorX:oe,tileAnchorY:fe},P.verticalTextFeatureIndex=be}if(g<v){const{x1:D,y1:L,x2:U,y2:V,padding:q,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:me,tileAnchorX:oe,tileAnchorY:fe,featureIndex:be}=e.get(g);P.iconBox={x1:D,y1:L,x2:U,y2:V,padding:q,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:me,tileAnchorX:oe,tileAnchorY:fe},P.iconFeatureIndex=be}if(T<S){const{x1:D,y1:L,x2:U,y2:V,padding:q,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:me,tileAnchorX:oe,tileAnchorY:fe,featureIndex:be}=e.get(T);P.verticalIconBox={x1:D,y1:L,x2:U,y2:V,padding:q,projectedAnchorX:ee,projectedAnchorY:ae,projectedAnchorZ:me,tileAnchorX:oe,tileAnchorY:fe},P.verticalIconFeatureIndex=be}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),l=s.vertexStartIndex+4*s.numGlyphs;for(let p=s.vertexStartIndex;p<l;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),l=[],p=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);const T=this.symbolInstances.get(v);l.push(0|Math.round(r*T.tileAnchorX+s*T.tileAnchorY)),p.push(T.featureIndex)}return g.sort(((v,T)=>l[v]-l[T]||p[T]-p[v])),g}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:S}=s;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),p>=0&&p!==l&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&g!==l&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Rt(Iu,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Iu.MAX_GLYPHS=65535,Iu.addDynamicAttributes=Pm;const PT=new ue({"symbol-placement":new W(at.layout_symbol["symbol-placement"]),"symbol-spacing":new W(at.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new W(at.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new te(at.layout_symbol["symbol-sort-key"]),"symbol-z-order":new W(at.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new W(at.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new W(at.layout_symbol["icon-ignore-placement"]),"icon-optional":new W(at.layout_symbol["icon-optional"]),"icon-rotation-alignment":new W(at.layout_symbol["icon-rotation-alignment"]),"icon-size":new te(at.layout_symbol["icon-size"]),"icon-text-fit":new W(at.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new W(at.layout_symbol["icon-text-fit-padding"]),"icon-image":new te(at.layout_symbol["icon-image"]),"icon-rotate":new te(at.layout_symbol["icon-rotate"]),"icon-padding":new W(at.layout_symbol["icon-padding"]),"icon-keep-upright":new W(at.layout_symbol["icon-keep-upright"]),"icon-offset":new te(at.layout_symbol["icon-offset"]),"icon-anchor":new te(at.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new W(at.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new W(at.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new W(at.layout_symbol["text-rotation-alignment"]),"text-field":new te(at.layout_symbol["text-field"]),"text-font":new te(at.layout_symbol["text-font"]),"text-size":new te(at.layout_symbol["text-size"]),"text-max-width":new te(at.layout_symbol["text-max-width"]),"text-line-height":new te(at.layout_symbol["text-line-height"]),"text-letter-spacing":new te(at.layout_symbol["text-letter-spacing"]),"text-justify":new te(at.layout_symbol["text-justify"]),"text-radial-offset":new te(at.layout_symbol["text-radial-offset"]),"text-variable-anchor":new W(at.layout_symbol["text-variable-anchor"]),"text-anchor":new te(at.layout_symbol["text-anchor"]),"text-max-angle":new W(at.layout_symbol["text-max-angle"]),"text-writing-mode":new W(at.layout_symbol["text-writing-mode"]),"text-rotate":new te(at.layout_symbol["text-rotate"]),"text-padding":new W(at.layout_symbol["text-padding"]),"text-keep-upright":new W(at.layout_symbol["text-keep-upright"]),"text-transform":new te(at.layout_symbol["text-transform"]),"text-offset":new te(at.layout_symbol["text-offset"]),"text-allow-overlap":new W(at.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new W(at.layout_symbol["text-ignore-placement"]),"text-optional":new W(at.layout_symbol["text-optional"])});var Lg={paint:new ue({"icon-opacity":new te(at.paint_symbol["icon-opacity"]),"icon-color":new te(at.paint_symbol["icon-color"]),"icon-halo-color":new te(at.paint_symbol["icon-halo-color"]),"icon-halo-width":new te(at.paint_symbol["icon-halo-width"]),"icon-halo-blur":new te(at.paint_symbol["icon-halo-blur"]),"icon-translate":new W(at.paint_symbol["icon-translate"]),"icon-translate-anchor":new W(at.paint_symbol["icon-translate-anchor"]),"text-opacity":new te(at.paint_symbol["text-opacity"]),"text-color":new te(at.paint_symbol["text-color"],{runtimeType:$i,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new te(at.paint_symbol["text-halo-color"]),"text-halo-width":new te(at.paint_symbol["text-halo-width"]),"text-halo-blur":new te(at.paint_symbol["text-halo-blur"]),"text-translate":new W(at.paint_symbol["text-translate"]),"text-translate-anchor":new W(at.paint_symbol["text-translate-anchor"])}),layout:PT};class Vx{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:_a,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Rt(Vx,"FormatSectionOverride",{omit:["defaultValue"]});class Im extends Pa{constructor(e){super(e,Lg)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const p of s)l.indexOf(p)<0&&l.push(p);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,l){const p=this.layout.get(e).evaluate(r,{},s,l),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Co(g.value)||!p?p:(function(v,T){return T.replace(/{([^{}]+)}/g,((S,P)=>P in v?String(v[P]):""))})(r.properties,p)}createBucket(e){return new Iu(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Lg.paint.overridableProperties){if(!Im.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new Vx(r),l=new pc(s,r.property.specification);let p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new fc("source",l):new Ka("composite",l,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new ne(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Im.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),l=Lg.paint.properties[r];let p=!1;const g=v=>{for(const T of v)if(l.overrides&&l.overrides.hasOverride(T))return void(p=!0)};if(s.value.kind==="constant"&&s.value.value instanceof pi)g(s.value.value.sections);else if(s.value.kind==="source"){const v=S=>{p||(S instanceof Bs&&Cn(S.value)===xo?g(S.value.sections):S instanceof ra?g(S.sections):S.eachChild(v))},T=s.value;T._styleExpression&&v(T._styleExpression.expression)}return p}getProgramConfiguration(e){return new Ro(this,e)}}var IT={paint:new ue({"background-color":new W(at.paint_background["background-color"]),"background-pattern":new W(at.paint_background["background-pattern"]),"background-opacity":new W(at.paint_background["background-opacity"])})},jT={paint:new ue({"raster-opacity":new W(at.paint_raster["raster-opacity"]),"raster-hue-rotate":new W(at.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new W(at.paint_raster["raster-brightness-min"]),"raster-brightness-max":new W(at.paint_raster["raster-brightness-max"]),"raster-saturation":new W(at.paint_raster["raster-saturation"]),"raster-contrast":new W(at.paint_raster["raster-contrast"]),"raster-resampling":new W(at.paint_raster["raster-resampling"]),"raster-fade-duration":new W(at.paint_raster["raster-fade-duration"])})};class NT extends Pa{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var DT={paint:new ue({"sky-type":new W(at.paint_sky["sky-type"]),"sky-atmosphere-sun":new W(at.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new W(at.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new W(at.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new W(at.paint_sky["sky-gradient-radius"]),"sky-gradient":new le(at.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new W(at.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new W(at.paint_sky["sky-atmosphere-color"]),"sky-opacity":new W(at.paint_sky["sky-opacity"])})};function Rg(t,e,r){const s=[0,0,1],l=kh([]);return Lp(l,l,r?-ct(t)+Math.PI:ct(t)),am(l,l,-ct(e)),Sd(s,s,l),zi(s,s)}const LT={circle:class extends Pa{constructor(t){super(t,hm)}createBucket(t){return new Ac(t)}queryRadius(t){const e=t;return Pc("circle-radius",this,e)+Pc("circle-stroke-width",this,e)+Su(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,s,l,p,g,v){const T=zd(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,t.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Wp(t,s,p,g,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,S)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Ro(this,t)}},heatmap:class extends Pa{createBucket(t){return new Zp(t)}constructor(t){super(t,Yn),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Kp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Pc("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,s,l,p,g,v){const T=this.paint.get("heatmap-radius").evaluate(e,r);return Wp(t,s,p,g,v,!0,!0,new ge(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Ro(this,t)}},hillshade:class extends Pa{constructor(t){super(t,dm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Pa{constructor(t){super(t,N)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(t){return new Ro(this,t)}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new _(t)}queryRadius(){return Su(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,s,l,p){return!t.queryGeometry.isAboveHorizon&&Nh(Ll(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Pa{constructor(t){super(t,Aw)}createBucket(t){return new nf(t)}queryRadius(){return Su(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Ro(this,t)}queryIntersectsFeature(t,e,r,s,l,p,g,v,T){const S=zd(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,t.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(e,r),D=this.paint.get("fill-extrusion-base").evaluate(e,r),L=[0,0],U=v&&p.elevation,V=p.elevation?p.elevation.exaggeration():1,q=t.tile.getBucket(this);if(U&&q instanceof nf){const fe=q.centroidVertexArray,be=T+1;be<fe.length&&(L[0]=fe.geta_centroid_pos0(be),L[1]=fe.geta_centroid_pos1(be))}if(L[0]===0&&L[1]===1)return!1;p.projection.name==="globe"&&(s=J0([s],[new ge(0,0),new ge(Qt,Qt)],t.tileID.canonical).map((fe=>fe.polygon)).flat());const ee=U?v:null,[ae,me]=(function(fe,be,_e,qe,Oe,ot,bt,Xe,ut,ht,gt){return fe.projection.name==="globe"?(function(Ct,st,Lt,Gt,Ft,wr,Mt,er,Tr,Qr,kr){const ur=[],wn=[],Er=Ct.projection.upVectorScale(kr,Ct.center.lat,Ct.worldSize).metersToTile,Cr=[0,0,0,1],cn=[0,0,0,1],mn=(un,Dn,Zn,ii)=>{un[0]=Dn,un[1]=Zn,un[2]=ii,un[3]=1},gn=Y0();Lt>0&&(Lt+=gn),Gt+=gn;for(const un of st){const Dn=[],Zn=[];for(const ii of un){const hn=ii.x+Ft.x,_i=ii.y+Ft.y,si=Ct.projection.projectTilePoint(hn,_i,kr),Un=Ct.projection.upVector(kr,ii.x,ii.y);let rn=Lt,ai=Gt;if(Mt){const yn=rx(hn,_i,Lt,Gt,Mt,er,Tr,Qr);rn+=yn.base,ai+=yn.top}Lt!==0?mn(Cr,si.x+Un[0]*Er*rn,si.y+Un[1]*Er*rn,si.z+Un[2]*Er*rn):mn(Cr,si.x,si.y,si.z),mn(cn,si.x+Un[0]*Er*ai,si.y+Un[1]*Er*ai,si.z+Un[2]*Er*ai),Nn(Cr,Cr,wr),Nn(cn,cn,wr),Dn.push(new Gd(Cr[0],Cr[1],Cr[2])),Zn.push(new Gd(cn[0],cn[1],cn[2]))}ur.push(Dn),wn.push(Zn)}return[ur,wn]})(fe,be,_e,qe,Oe,ot,bt,Xe,ut,ht,gt):bt?(function(Ct,st,Lt,Gt,Ft,wr,Mt,er,Tr){const Qr=[],kr=[],ur=[0,0,0,1];for(const wn of Ct){const Er=[],Cr=[];for(const cn of wn){const mn=cn.x+Gt.x,gn=cn.y+Gt.y,un=rx(mn,gn,st,Lt,wr,Mt,er,Tr);ur[0]=mn,ur[1]=gn,ur[2]=un.base,ur[3]=1,Il(ur,ur,Ft),ur[3]=Math.max(ur[3],1e-5);const Dn=new Gd(ur[0]/ur[3],ur[1]/ur[3],ur[2]/ur[3]);ur[0]=mn,ur[1]=gn,ur[2]=un.top,ur[3]=1,Il(ur,ur,Ft),ur[3]=Math.max(ur[3],1e-5);const Zn=new Gd(ur[0]/ur[3],ur[1]/ur[3],ur[2]/ur[3]);Er.push(Dn),Cr.push(Zn)}Qr.push(Er),kr.push(Cr)}return[Qr,kr]})(be,_e,qe,Oe,ot,bt,Xe,ut,ht):(function(Ct,st,Lt,Gt,Ft){const wr=[],Mt=[],er=Ft[8]*st,Tr=Ft[9]*st,Qr=Ft[10]*st,kr=Ft[11]*st,ur=Ft[8]*Lt,wn=Ft[9]*Lt,Er=Ft[10]*Lt,Cr=Ft[11]*Lt;for(const cn of Ct){const mn=[],gn=[];for(const un of cn){const Dn=un.x+Gt.x,Zn=un.y+Gt.y,ii=Ft[0]*Dn+Ft[4]*Zn+Ft[12],hn=Ft[1]*Dn+Ft[5]*Zn+Ft[13],_i=Ft[2]*Dn+Ft[6]*Zn+Ft[14],si=Ft[3]*Dn+Ft[7]*Zn+Ft[15],Un=ii+er,rn=hn+Tr,ai=_i+Qr,yn=Math.max(si+kr,1e-5),Ns=ii+ur,oi=hn+wn,Ui=_i+Er,Ii=Math.max(si+Cr,1e-5);mn.push(new Gd(Un/yn,rn/yn,ai/yn)),gn.push(new Gd(Ns/Ii,oi/Ii,Ui/Ii))}wr.push(mn),Mt.push(gn)}return[wr,Mt]})(be,_e,qe,Oe,ot)})(p,s,D,P,S,g,ee,L,V,p.center.lat,t.tileID.canonical),oe=t.queryGeometry;return(function(fe,be,_e){let qe=1/0;Nh(_e,be)&&(qe=tx(_e,be[0]));for(let Oe=0;Oe<be.length;Oe++){const ot=be[Oe],bt=fe[Oe];for(let Xe=0;Xe<ot.length-1;Xe++){const ut=ot[Xe],ht=[ut,ot[Xe+1],bt[Xe+1],bt[Xe],ut];Dd(_e,ht)&&(qe=Math.min(qe,tx(_e,ht)))}}return qe!==1/0&&qe})(ae,me,oe.isPointQuery()?oe.screenBounds:oe.screenGeometry)}},line:class extends Pa{constructor(t){super(t,nx),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Qu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=ix.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new ym(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Ro(this,t)}queryRadius(t){const e=t,r=sx(Pc("line-width",this,e),Pc("line-gap-width",this,e)),s=Pc("line-offset",this,e);return r/2+Math.abs(s)+Su(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,s,l,p){if(t.queryGeometry.isAboveHorizon)return!1;const g=Ll(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,t.pixelToTileUnitsFactor),v=t.pixelToTileUnitsFactor/2*sx(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),T=this.paint.get("line-offset").evaluate(e,r);return T&&(s=(function(S,P){const D=[],L=new ge(0,0);for(let U=0;U<S.length;U++){const V=S[U],q=[];for(let ee=0;ee<V.length;ee++){const ae=V[ee],me=V[ee+1],oe=ee===0?L:ae.sub(V[ee-1])._unit()._perp(),fe=ee===V.length-1?L:me.sub(ae)._unit()._perp(),be=oe._add(fe)._unit();be._mult(1/(be.x*fe.x+be.y*fe.y)),q.push(be._mult(P)._add(ae))}D.push(q)}return D})(s,T*t.pixelToTileUnitsFactor)),(function(S,P,D){for(let L=0;L<P.length;L++){const U=P[L];if(S.length>=3){for(let V=0;V<U.length;V++)if(Oo(S,U[V]))return!0}if(ps(S,U,D))return!0}return!1})(g,s,v)}isTileClipped(){return!0}},symbol:Im,background:class extends Pa{constructor(t){super(t,IT)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Pa{constructor(t){super(t,jT)}getProgramIds(){return["raster"]}},sky:class extends Pa{constructor(t){super(t,DT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Kp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),l=!s,p=t.style.light,g=p.properties.get("position");return l&&p.properties.get("anchor")==="viewport"&&Gr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?Rg(g.azimuthal,90-g.polar,e):Rg(s[0],90-s[1],e)}const r=this.paint.get("sky-gradient-center");return Rg(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class mf{constructor(e,r,s,l){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(r,l)}update(e,r,s){const{width:l,height:p}=e,{context:g}=this,{gl:v}=g,{HTMLImageElement:T,HTMLCanvasElement:S,HTMLVideoElement:P,ImageData:D,ImageBitmap:L}=R;if(v.bindTexture(v.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!r||r.premultiply!==!1)),s||this.size&&this.size[0]===l&&this.size[1]===p){const{x:U,y:V}=s||{x:0,y:0};e instanceof T||e instanceof S||e instanceof P||e instanceof D||L&&e instanceof L?v.texSubImage2D(v.TEXTURE_2D,0,U,V,v.RGBA,v.UNSIGNED_BYTE,e):v.texSubImage2D(v.TEXTURE_2D,0,U,V,l,p,v.RGBA,v.UNSIGNED_BYTE,e.data)}else this.size=[l,p],e instanceof T||e instanceof S||e instanceof P||e instanceof D||L&&e instanceof L?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,e):v.texImage2D(v.TEXTURE_2D,0,this.format,l,p,0,this.format,v.UNSIGNED_BYTE,e.data);this.useMipmap=!!(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(e,r){const{context:s}=this,{gl:l}=s;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class RT{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class zT{constructor(){this.tasks={},this.taskQueue=[],ir(["process"],this),this.invoker=new RT(this.process),this.nextId=0}add(e,r){const s=this.nextId++,l=(function({type:p,isSymbolTile:g,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||g?p!=="parseTile"||g?p==="parseTile"&&g?300-v:p==="maybePrepare"&&g?400-v:500:200-v:100-v})(r);if(l===0){ts();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:r,priority:l,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){ts();try{if(this.taskQueue=this.taskQueue.filter((s=>!!this.tasks[s])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let l=0;l<this.taskQueue.length;l++){const p=this.tasks[this.taskQueue[l]];p.priority<r&&(r=p.priority,e=l)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class $x{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const BT=["tile","layer","source","sourceLayer","state"];class Gx{constructor(e,r,s,l,p){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=s,this._y=l,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of BT)this[r]!==void 0&&(e[r]=this[r]);return e}}const ho=32,Fl=33,ju=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,r=0,s=0,l=0,p=0,g=0,v=0;for(1&e?l=p=g=ho:r=s=v=ho;(e>>=1)>1;){const S=r+l>>1,P=s+p>>1;1&e?(l=r,p=s,r=g,s=v):(r=l,s=p,l=g,p=v),g=S,v=P}const T=4*t;ju[T+0]=r,ju[T+1]=s,ju[T+2]=l,ju[T+3]=p}const Ol=new Uint16Array(2178),Nu=new Uint8Array(1089),jm=new Uint16Array(1089);function Wx(t){return t===0?-.03125:t===32?.03125:0}var qx=Ie([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Zx={type:2,extent:Qt,loadGeometry:()=>[[new ge(0,0),new ge(Qt+1,0),new ge(Qt+1,Qt+1),new ge(0,Qt+1),new ge(0,0)]]};class zg{constructor(e,r,s,l,p){this.tileID=e,this.uid=lr(),this.uses=0,this.tileSize=r,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<Qs.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=$h(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(l,p){const g={};if(!p)return g;for(const v of l){const T=v.layerIds.map((S=>p.getLayer(S))).filter(Boolean);if(T.length!==0){v.layers=T,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map((S=>T.filter((P=>P.id===S))[0])));for(const S of T)g[S.id]=v}}return g})(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const p=this.buckets[l];if(p instanceof Iu){if(this.hasSymbolBuckets=!0,!s)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const p=this.buckets[l];if(p instanceof Iu&&p.hasRTLText){this.hasRTLText=!0,M.isLoading()||M.isLoaded()||b()!=="deferred"||C();break}}this.queryPadding=0;for(const l in this.buckets){const p=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(l).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new tn}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const l=this.buckets[s];l.uploadPending()&&l.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new mf(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new mf(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new mf(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,s,l,p,g,v,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:v,transform:g,params:p,tileTransform:this.tileTransform},e,r,s):{}}querySourceFeatures(e,r){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const l=s.loadVTLayers(),p=r?r.sourceLayer:"",g=l._geojsonTileLayer||l[p];if(!g)return;const v=vl(r&&r.filter),{z:T,x:S,y:P}=this.tileID.canonical,D={z:T,x:S,y:P};for(let L=0;L<g.length;L++){const U=g.feature(L);if(v.needGeometry){const ee=co(U,!0);if(!v.filter(new j(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!v.filter(new j(this.tileID.overscaledZ),U))continue;const V=s.getId(U,p),q=new Gx(U,T,S,P,V);q.tile=D,e.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const s=ti(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let l=!1;if(this.expirationTime>s)l=!1;else if(r)if(this.expirationTime<r)l=!0;else{const p=this.expirationTime-r;p?this.expirationTime=s+Math.max(p,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const s=this.latestFeatureIndex.loadVTLayers(),l=r.style.listImages();for(const p in this.buckets){if(!r.style.hasLayer(p))continue;const g=this.buckets[p],v=g.layers[0].sourceLayer||"_geojsonTileLayer",T=s[v],S=e[v];if(!T||!S||Object.keys(S).length===0)continue;if(g.update(S,T,l,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof ym||g instanceof _){const D=r.style._getSourceCache(g.layers[0].source);r._terrain&&r._terrain.enabled&&D&&g.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(D.id,this.tileID)}const P=r&&r.style&&r.style.getLayer(p);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Qs.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Qs.now()+e}setTexture(e,r){const s=r.context,l=s.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new mf(s,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE))}setDependencies(e,r){const s={};for(const l of r)s[l]=!0;this.dependencies[e]=s}hasDependency(e,r){for(const s of e){const l=this.dependencies[s];if(l){for(const p of r)if(l[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const s=Yi(Zx,this.tileID.canonical,this.tileTransform)[0],l=new yt,p=new us;for(let g=0;g<s.length;g++){const{x:v,y:T}=s[g];l.emplaceBack(v,T),p.emplaceBack(g)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(l,Eh.members),this._tileDebugSegments=Wn.simpleSegment(0,0,l.length,p.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const s=Yi(Zx,this.tileID.canonical,this.tileTransform)[0];let l,p;if(this.isRaster){const g=(function(v,T){const S=$h(v,T),P=Math.pow(2,v.z);for(let ee=0;ee<Fl;ee++)for(let ae=0;ae<Fl;ae++){const me=Mi((v.x+(ae+Wx(ae))/ho)/P),oe=Yr((v.y+(ee+Wx(ee))/ho)/P),fe=T.project(me,oe),be=ee*Fl+ae;Ol[2*be+0]=Math.round((fe.x*S.scale-S.x)*Qt),Ol[2*be+1]=Math.round((fe.y*S.scale-S.y)*Qt)}Nu.fill(0),jm.fill(0);for(let ee=2045;ee>=0;ee--){const ae=4*ee,me=ju[ae+0],oe=ju[ae+1],fe=ju[ae+2],be=ju[ae+3],_e=me+fe>>1,qe=oe+be>>1,Oe=_e+qe-oe,ot=qe+me-_e,bt=oe*Fl+me,Xe=be*Fl+fe,ut=qe*Fl+_e,ht=Math.hypot((Ol[2*bt+0]+Ol[2*Xe+0])/2-Ol[2*ut+0],(Ol[2*bt+1]+Ol[2*Xe+1])/2-Ol[2*ut+1])>=16;Nu[ut]=Nu[ut]||(ht?1:0),ee<1022&&(Nu[ut]=Nu[ut]||Nu[(oe+ot>>1)*Fl+(me+Oe>>1)]||Nu[(be+ot>>1)*Fl+(fe+Oe>>1)])}const D=new nt,L=new Zt;let U=0;function V(ee,ae){const me=ae*Fl+ee;return jm[me]===0&&(D.emplaceBack(Ol[2*me+0],Ol[2*me+1],ee*Qt/ho,ae*Qt/ho),jm[me]=++U),jm[me]-1}function q(ee,ae,me,oe,fe,be){const _e=ee+me>>1,qe=ae+oe>>1;if(Math.abs(ee-fe)+Math.abs(ae-be)>1&&Nu[qe*Fl+_e])q(fe,be,ee,ae,_e,qe),q(me,oe,fe,be,_e,qe);else{const Oe=V(ee,ae),ot=V(me,oe),bt=V(fe,be);L.emplaceBack(Oe,ot,bt)}}return q(0,0,ho,ho,ho,0),q(ho,ho,0,0,0,ho),{vertices:D,indices:L}})(this.tileID.canonical,r);l=g.vertices,p=g.indices}else{l=new nt,p=new Zt;for(const{x:v,y:T}of s)l.emplaceBack(v,T,0,0);const g=Vd(l.int16,void 0,4);for(let v=0;v<g.length;v+=3)p.emplaceBack(g[v],g[v+1],g[v+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,qx.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=Wn.simpleSegment(0,0,l.length,p.length)}_makeGlobeTileDebugBuffers(e,r){const s=r.projection;if(!s||s.name!=="globe"||r.freezeTileCoverage)return;const l=this.tileID.canonical,p=hs(Bp(l,r)),g=wu(r.zoom);let v;g>0&&(v=Gs(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,l,r,p,v,g),this._makeGlobeTileDebugTextBuffer(e,l,r,p,v,g)}_globePoint(e,r,s,l,p,g,v){let T=ha(e,r,s);if(g){const S=1<<s.z,P=pn(l.center.lng),D=Mn(l.center.lat),L=(s.x+.5)/S-P;let U=0;L>.5?U=-1:L<-.5&&(U=1);let V=(e/Qt+s.x)/S+U,q=(r/Qt+s.y)/S;V=(V-P)*l._pixelsPerMercatorPixel+P,q=(q-D)*l._pixelsPerMercatorPixel+D;const ee=[V*l.worldSize,q*l.worldSize,0];Nn(ee,ee,g),T=Fo(T,ee,v)}return Nn(T,T,p)}_makeGlobeTileDebugBorderBuffer(e,r,s,l,p,g){const v=new yt,T=new us,S=new ze,P=(L,U,V,q,ee)=>{const ae=(V-L)/(ee-1),me=(q-U)/(ee-1),oe=v.length;for(let fe=0;fe<ee;fe++){const be=L+fe*ae,_e=U+fe*me;v.emplaceBack(be,_e);const qe=this._globePoint(be,_e,r,s,l,p,g);S.emplaceBack(qe[0],qe[1],qe[2]),T.emplaceBack(oe+fe)}},D=Qt;P(0,0,D,0,16),P(D,0,D,D,16),P(D,D,0,D,16),P(0,D,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(T),this._tileDebugBuffer=e.createVertexBuffer(v,Eh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(S,ao.members),this._tileDebugSegments=Wn.simpleSegment(0,0,v.length,T.length)}_makeGlobeTileDebugTextBuffer(e,r,s,l,p,g){const v=Qt/4,T=new yt,S=new Zt,P=new ze,D=25;S.reserve(32),T.reserve(D),P.reserve(D);const L=(U,V)=>D*U+V;for(let U=0;U<D;U++){const V=U*v;for(let q=0;q<D;q++){const ee=q*v;T.emplaceBack(ee,V);const ae=this._globePoint(ee,V,r,s,l,p,g);P.emplaceBack(ae[0],ae[1],ae[2])}}for(let U=0;U<4;U++)for(let V=0;V<4;V++){const q=L(U,V),ee=L(U,V+1),ae=L(U+1,V),me=L(U+1,V+1);S.emplaceBack(q,ee,ae),S.emplaceBack(ae,ee,me)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(S),this._tileDebugTextBuffer=e.createVertexBuffer(T,Eh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(P,ao.members),this._tileDebugTextSegments=Wn.simpleSegment(0,0,D,32)}}class FT{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,s){const l=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},Ot(this.stateChanges[e][l],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==l&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const p in this.state[e][l])s[p]||(this.deletedStates[e][l][p]=null)}else for(const p in s)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][p]===null&&delete this.deletedStates[e][l][p]}removeFeatureState(e,r,s){if(this.deletedStates[e]===null)return;const l=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&r!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][s]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(s in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][s]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,r){const s=String(r),l=Ot({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][r];if(p===null)return{};for(const g in p)delete l[g]}return l}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const s={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const p={};for(const g in this.stateChanges[l])this.state[l][g]||(this.state[l][g]={}),Ot(this.state[l][g],this.stateChanges[l][g]),p[g]=this.state[l][g];s[l]=p}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const p={};if(this.deletedStates[l]===null)for(const g in this.state[l])p[g]={},this.state[l][g]={};else for(const g in this.deletedStates[l]){if(this.deletedStates[l][g]===null)this.state[l][g]={};else if(this.state[l][g])for(const v of Object.keys(this.deletedStates[l][g]))delete this.state[l][g][v];p[g]=this.state[l][g]}s[l]=s[l]||{},Ot(s[l],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(const l in e)e[l].setFeatureState(s,r)}}class Hx{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const s=this.toIdx(e,r);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function Xx(t,e,r,s){let l=0,p=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(s[g])<1e-15){if(r[g]<t[g]||r[g]>e[g])return null}else{const v=1/s[g];let T=(t[g]-r[g])*v,S=(e[g]-r[g])*v;if(T>S){const P=T;T=S,S=P}if(T>l&&(l=T),S<p&&(p=S),l>p)return null}return l}function Kx(t,e,r,s,l,p,g,v,T,S,P){const D=s-t,L=l-e,U=p-r,V=g-t,q=v-e,ee=T-r,ae=P[1]*ee-P[2]*q,me=P[2]*V-P[0]*ee,oe=P[0]*q-P[1]*V,fe=D*ae+L*me+U*oe;if(Math.abs(fe)<1e-15)return null;const be=1/fe,_e=S[0]-t,qe=S[1]-e,Oe=S[2]-r,ot=(_e*ae+qe*me+Oe*oe)*be;if(ot<0||ot>1)return null;const bt=qe*U-Oe*L,Xe=Oe*D-_e*U,ut=_e*L-qe*D,ht=(P[0]*bt+P[1]*Xe+P[2]*ut)*be;return ht<0||ot+ht>1?null:(V*bt+q*Xe+ee*ut)*be}function Yx(t,e,r){return(t-e)/(r-e)}function Jx(t,e,r,s,l,p,g,v,T){const S=1<<r,P=p-s,D=g-l,L=(t+1)/S*P+s,U=(e+0)/S*D+l,V=(e+1)/S*D+l;v[0]=(t+0)/S*P+s,v[1]=U,T[0]=L,T[1]=V}class Qx{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=(function(p){const g=Math.ceil(Math.log2(p.dim/8)),v=[];let T=Math.ceil(Math.pow(2,g));const S=1/T,P=(U,V,q,ee,ae)=>{const me=ee?1:0,oe=(U+1)*q-me,fe=V*q,be=(V+1)*q-me;ae[0]=U*q,ae[1]=fe,ae[2]=oe,ae[3]=be};let D=new Hx(T);const L=[];for(let U=0;U<T*T;U++){P(U%T,Math.floor(U/T),S,!1,L);const V=Du(L[0],L[1],p),q=Du(L[2],L[1],p),ee=Du(L[2],L[3],p),ae=Du(L[0],L[3],p);D.minimums.push(Math.min(V,q,ee,ae)),D.maximums.push(Math.max(V,q,ee,ae)),D.leaves.push(1)}for(v.push(D),T/=2;T>=1;T/=2){const U=v[v.length-1];D=new Hx(T);for(let V=0;V<T*T;V++){P(V%T,Math.floor(V/T),2,!0,L);const q=U.getElevation(L[0],L[1]),ee=U.getElevation(L[2],L[1]),ae=U.getElevation(L[2],L[3]),me=U.getElevation(L[0],L[3]),oe=U.isLeaf(L[0],L[1]),fe=U.isLeaf(L[2],L[1]),be=U.isLeaf(L[2],L[3]),_e=U.isLeaf(L[0],L[3]),qe=Math.min(q.min,ee.min,ae.min,me.min),Oe=Math.max(q.max,ee.max,ae.max,me.max),ot=oe&&fe&&be&&_e;D.maximums.push(Oe),D.minimums.push(qe),D.leaves.push(Oe-qe<=5&&ot?1:0)}v.push(D)}return v})(this.dem),s=r.length-1,l=r[s];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(r,0,0,s,0)}raycastRoot(e,r,s,l,p,g,v=1){return Xx([e,r,-100],[s,l,this.maximums[0]*v],p,g)}raycast(e,r,s,l,p,g,v=1){if(!this.nodeCount)return null;const T=this.raycastRoot(e,r,s,l,p,g,v);if(T==null)return null;const S=[],P=[],D=[],L=[],U=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;U.length>0;){const{idx:V,t:q,nodex:ee,nodey:ae,depth:me}=U.pop();if(this.leaves[V]){Jx(ee,ae,me,e,r,s,l,D,L);const fe=1<<me,be=(ee+0)/fe,_e=(ee+1)/fe,qe=(ae+0)/fe,Oe=(ae+1)/fe,ot=Du(be,qe,this.dem)*v,bt=Du(_e,qe,this.dem)*v,Xe=Du(_e,Oe,this.dem)*v,ut=Du(be,Oe,this.dem)*v,ht=Kx(D[0],D[1],ot,L[0],D[1],bt,L[0],L[1],Xe,p,g),gt=Kx(L[0],L[1],Xe,D[0],L[1],ut,D[0],D[1],ot,p,g),Ct=Math.min(ht!==null?ht:Number.MAX_VALUE,gt!==null?gt:Number.MAX_VALUE);if(Ct!==Number.MAX_VALUE)return Ct;{const st=yu([],p,g,q);if(e_(ot,bt,ut,Xe,Yx(st[0],D[0],L[0]),Yx(st[1],D[1],L[1]))>=st[2])return q}continue}let oe=0;for(let fe=0;fe<this._siblingOffset.length;fe++){Jx((ee<<1)+this._siblingOffset[fe][0],(ae<<1)+this._siblingOffset[fe][1],me+1,e,r,s,l,D,L),D[2]=-100,L[2]=this.maximums[this.childOffsets[V]+fe]*v;const be=Xx(D,L,p,g);if(be!=null){const _e=be;S[fe]=_e;let qe=!1;for(let Oe=0;Oe<oe&&!qe;Oe++)_e>=S[P[Oe]]&&(P.splice(Oe,0,fe),qe=!0);qe||(P[oe]=fe),oe++}}for(let fe=0;fe<oe;fe++){const be=P[fe];U.push({idx:this.childOffsets[V]+be,t:S[be],nodex:(ee<<1)+this._siblingOffset[be][0],nodey:(ae<<1)+this._siblingOffset[be][1],depth:me+1})}}return null}_addNode(e,r,s){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,s,l,p){if(e[l].isLeaf(r,s)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const g=l-1,v=e[g];let T=0,S=0;for(let P=0;P<this._siblingOffset.length;P++){const D=2*r+this._siblingOffset[P][0],L=2*s+this._siblingOffset[P][1],U=v.getElevation(D,L),V=v.isLeaf(D,L),q=this._addNode(U.min,U.max,V);V&&(T|=1<<P),S||(S=q)}for(let P=0;P<this._siblingOffset.length;P++)T&1<<P||this._construct(e,2*r+this._siblingOffset[P][0],2*s+this._siblingOffset[P][1],g,S+P)}}function e_(t,e,r,s,l,p){return Fr(Fr(t,r,p),Fr(e,s,p),l)}function Du(t,e,r){const s=r.dim,l=Be(t*s-.5,0,s-1),p=Be(e*s-.5,0,s-1),g=Math.floor(l),v=Math.floor(p),T=Math.min(g+1,s-1),S=Math.min(v+1,s-1);return e_(r.get(g,v),r.get(T,v),r.get(g,S),r.get(T,S),l-g,p-v)}const t_={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function OT(t,e,r){return(256*t*256+256*e+r)/10-1e4}function UT(t,e,r){return 256*t+e+r/256-32768}class Nm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,s,l=!1,p=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return Gr(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const g=this.dim=r.height-2,v=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=s||"mapbox",this.borderReady=l,!l){for(let T=0;T<g;T++)v[this._idx(-1,T)]=v[this._idx(0,T)],v[this._idx(g,T)]=v[this._idx(g-1,T)],v[this._idx(T,-1)]=v[this._idx(T,0)],v[this._idx(T,g)]=v[this._idx(T,g-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(g,-1)]=v[this._idx(g-1,0)],v[this._idx(-1,g)]=v[this._idx(0,g-1)],v[this._idx(g,g)]=v[this._idx(g-1,g-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Qx(this)}get(e,r,s=!1){s&&(e=Be(e,-1,this.dim),r=Be(r,-1,this.dim));const l=4*this._idx(e,r);return(this.encoding==="terrarium"?UT:OT)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}static getUnpackVector(e){return t_[e]}get unpackVector(){return t_[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const s=[0,0,0,0],l=Nm.getUnpackVector(r);let p=Math.floor((e+l[3])/l[2]);return s[2]=p%256,p=Math.floor(p/256),s[1]=p%256,p=Math.floor(p/256),s[0]=p,s}getPixels(){return new fs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,p=r*this.dim+this.dim,g=s*this.dim,v=s*this.dim+this.dim;switch(r){case-1:l=p-1;break;case 1:p=l+1}switch(s){case-1:g=v-1;break;case 1:v=g+1}const T=-r*this.dim,S=-s*this.dim;for(let P=g;P<v;P++)for(let D=l;D<p;D++){const L=4*this._idx(D,P),U=4*this._idx(D+T,P+S);this.pixels[L+0]=e.pixels[U+0],this.pixels[L+1]=e.pixels[U+1],this.pixels[L+2]=e.pixels[U+2],this.pixels[L+3]=e.pixels[U+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Rt(Nm,"DEMData"),Rt(Qx,"DemMinMaxQuadTree",{omit:["dem"]});class VT{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,s){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const p={value:r,timeout:void 0};if(s!==void 0&&(p.timeout=setTimeout((()=>{this.remove(e,p)}),s)),this.data[l].push(p),this.order.push(l),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const s=e.wrapped().key,l=r===void 0?0:this.data[s].indexOf(r),p=this.data[s][l];return this.data[s].splice(l,1),p.timeout&&clearTimeout(p.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(p.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const s in this.data)for(const l of this.data[s])e(l.value)||r.push(l);for(const s of r)this.remove(s.value.tileID,s)}}class ep{constructor(e,r,s){this.func=e,this.mask=r,this.range=s}}ep.ReadOnly=!1,ep.ReadWrite=!0,ep.disabled=new ep(519,ep.ReadOnly,[0,1]);const Bg=7680;class Fg{constructor(e,r,s,l,p,g){this.test=e,this.ref=r,this.mask=s,this.fail=l,this.depthFail=p,this.pass=g}}Fg.disabled=new Fg({func:519,mask:0},0,0,Bg,Bg,Bg);class Ul{constructor(e,r,s){this.blendFunction=e,this.blendColor=r,this.mask=s}}Ul.Replace=[1,0],Ul.disabled=new Ul(Ul.Replace,on.transparent,[!1,!1,!1,!1]),Ul.unblended=new Ul(Ul.Replace,on.transparent,[!0,!0,!0,!0]),Ul.alphaBlended=new Ul([1,771],on.transparent,[!0,!0,!0,!0]);const Og=1029,Ug=2305;class $o{constructor(e,r,s){this.enable=e,this.mode=r,this.frontFace=s}}$o.disabled=new $o(!1,Og,Ug),$o.backCCW=new $o(!0,Og,Ug),$o.backCW=new $o(!0,Og,2304),$o.frontCW=new $o(!0,1028,2304),$o.frontCCW=new $o(!0,1028,Ug);class Gh extends Vi{constructor(e,r,s){super(),this.id=e,this._onlySymbols=s,r.on("data",(l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),r.on("error",(()=>{this._sourceErrored=!0})),this._source=r,this._tiles={},this._cache=new VT(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new FT,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const s=this._tiles[r];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return Ut(this._tiles).map((e=>e.tileID)).sort(r_).map((e=>e.key))}getRenderableIds(e){const r=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&r.push(this._tiles[s]);return e?r.sort(((s,l)=>{const p=s.tileID,g=l.tileID,v=new ge(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),T=new ge(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-g.overscaledZ||T.y-v.y||T.x-v.x})).map((s=>s.tileID.key)):r.map((s=>s.tileID)).sort(r_).map((s=>s.key))}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=r),this._loadTile(s,this._tileLoaded.bind(this,s,e,r)))}_tileLoaded(e,r,s,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new xs(l,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Qs.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ua("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let l=0;l<r.length;l++){const p=r[l];if(e.neighboringTiles&&e.neighboringTiles[p]){const g=this.getTileByID(p);s(e,g),s(g,e)}}function s(l,p){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let g=p.tileID.canonical.x-l.tileID.canonical.x;const v=p.tileID.canonical.y-l.tileID.canonical.y,T=Math.pow(2,l.tileID.canonical.z),S=p.tileID.key;g===0&&v===0||Math.abs(v)>1||(Math.abs(g)>1&&(Math.abs(g+T)===1?g+=T:Math.abs(g-T)===1&&(g-=T)),p.dem&&l.dem&&(l.dem.backfillBorder(p.dem,g,v),l.neighboringTiles&&l.neighboringTiles[S]&&(l.neighboringTiles[S].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,s,l){for(const p in this._tiles){let g=this._tiles[p];if(l[p]||!g.hasData()||g.tileID.overscaledZ<=r||g.tileID.overscaledZ>s)continue;let v=g.tileID;for(;g&&g.tileID.overscaledZ>r+1;){const S=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[S.key],g&&g.hasData()&&(v=S)}let T=v;for(;T.overscaledZ>r;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){l[v.key]=v;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=r?s:null}for(let s=e.overscaledZ-1;s>=r;s--){const l=e.scaledTo(s),p=this._getLoadedTile(l);if(p)return p}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const s=Math.ceil(e.width/r)+1,l=Math.ceil(e.height/r)+1,p=Math.floor(s*l*5),g=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(v)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const s={};for(const l in this._tiles){const p=this._tiles[l];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+r),s[p.tileID.key]=p}this._tiles=s;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,r,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let l;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((v=>new js(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y))):(l=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter((v=>this._source.hasTile(v))))):l=[];const p=this._updateRetainedTiles(l);if(n_(this._source.type)&&l.length!==0){const v={},T={},S=Object.keys(p);for(const D of S){const L=p[D],U=this._tiles[D];if(!U||U.fadeEndTime&&U.fadeEndTime<=Qs.now())continue;const V=this.findLoadedParent(L,Math.max(L.overscaledZ-Gh.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),v[V.tileID.key]=V.tileID),T[D]=L}const P=l[l.length-1].overscaledZ;for(const D in this._tiles){const L=this._tiles[D];if(p[D]||!L.hasData())continue;let U=L.tileID;for(;U.overscaledZ>P;){U=U.scaledTo(U.overscaledZ-1);const V=this._tiles[U.key];if(V&&V.hasData()&&T[U.key]){p[D]=L.tileID;break}}}for(const D in v)p[D]||(this._coveredTiles[D]=!0,p[D]=v[D])}for(const v in p)this._tiles[v].clearFadeHold();const g=(function(v,T){const S=[];for(const P in v)P in T||S.push(P);return S})(this._tiles,p);for(const v of g){const T=this._tiles[v];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const s={},l=e.reduce(((S,P)=>Math.min(S,P.overscaledZ)),1/0),p=e[0].overscaledZ,g=Math.max(p-Gh.maxOverzooming,this._source.minzoom),v=Math.max(p+Gh.maxUnderzooming,this._source.minzoom),T={};for(const S of e){const P=this._addTile(S);r[S.key]=S,P.hasData()||l<this._source.maxzoom&&(T[S.key]=S)}this._retainLoadedChildren(T,l,v,r);for(const S of e){let P=this._tiles[S.key];if(P.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const L=S.children(this._source.maxzoom)[0],U=this.getTile(L);if(U&&U.hasData()){r[L.key]=L;continue}}else{const L=S.children(this._source.maxzoom);if(r[L[0].key]&&r[L[1].key]&&r[L[2].key]&&r[L[3].key])continue}let D=P.wasRequested();for(let L=S.overscaledZ-1;L>=g;--L){const U=S.scaledTo(L);if(s[U.key]||(s[U.key]=!0,P=this.getTile(U),!P&&D&&(P=this._addTile(U)),P&&(r[U.key]=U,D=P.wasRequested(),P.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let s,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){s=this._loadedParentTiles[l.key];break}r.push(l.key);const p=l.scaledTo(l.overscaledZ-1);if(s=this._getLoadedTile(p),s)break;l=p}for(const p of r)this._loadedParentTiles[p]=s}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const s=!!r;if(!s){const l=this.map?this.map.painter:null;r=new zg(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,s||this._source.fire(new Ua("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=r.getExpiryTimeout();s&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),s))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,s){const l=[],p=this.transform;if(!p)return l;const g=p.projection.name==="globe",v=pn(p.center.lng);for(const T in this._tiles){const S=this._tiles[T];if(s&&S.clearQueryDebugViz(),S.holdingForFade())continue;let P;if(g){const D=S.tileID.canonical;if(D.z===0){const L=[Math.abs(Be(v,...gf(D,-1))-v),Math.abs(Be(v,...gf(D,1))-v)];P=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs(Be(v,...gf(D,-1))-v),Math.abs(Be(v,...gf(D,0))-v),Math.abs(Be(v,...gf(D,1))-v)];P=[L.indexOf(Math.min(...L))-1]}}else P=[0];for(const D of P){const L=e.containsTile(S,p,r,D);L&&l.push(L)}}return l}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map((s=>this._tiles[s].tileID));for(const s of r)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(n_(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=Qs.now())return!0}return!1}setFeatureState(e,r,s){this._state.updateState(e=e||"_geojsonTileLayer",r,s)}removeFeatureState(e,r,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,s)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,s){const l=this._tiles[e];l&&l.setDependencies(r,s)}reloadTilesForDependencies(e,r){for(const s in this._tiles)this._tiles[s].hasDependency(e,r)&&this._reloadTile(+s,"reloading");this._cache.filter((s=>!s.hasDependency(e,r)))}_preloadTiles(e,r){if(!this._sourceLoaded){const v=()=>{this._sourceLoaded&&(this._source.off("data",v),this._preloadTiles(e,r))};return void this._source.on("data",v)}const s=new Map,l=Array.isArray(e)?e:[e],p=this.map.painter.terrain,g=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const v of l){const T=v.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of T)s.set(S.key,S);this.usedForTerrain&&v.updateElevation(!1)}et(Array.from(s.values()),((v,T)=>{const S=new zg(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,(P=>{this._source.type==="raster-dem"&&S.dem&&this._backfillDEM(S),T(P,S)}))}),r)}}function r_(t,e){const r=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function n_(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function gf(t,e){const r=1<<t.z;return[t.x/r+e,(t.x+1)/r+e]}Gh.maxOverzooming=10,Gh.maxUnderzooming=3;class Dm{constructor(e,r,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=s}static create(e,r,s){const l=s||e.findDEMTileFor(r);if(!l||!l.dem)return;const p=l.dem,g=l.tileID,v=1<<r.canonical.z-g.canonical.z;return new Dm(l,l.tileSize/Qt/v,[(r.canonical.x/v-g.canonical.x)*p.dim,(r.canonical.y/v-g.canonical.y)*p.dim])}tileCoordToPixel(e,r){const s=r*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(s);return new ge(l,p)}getElevationAt(e,r,s,l){const p=e*this._scale+this._offset[0],g=r*this._scale+this._offset[1],v=Math.floor(p),T=Math.floor(g),S=this._dem;return l=!!l,s?Fr(Fr(S.get(v,T,l),S.get(v,T+1,l),g-T),Fr(S.get(v+1,T,l),S.get(v+1,T+1,l),g-T),p-v):S.get(v,T,l)}getElevationAtPixel(e,r,s){return this._dem.get(e,r,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*qn(1,e)*this._dem.stride}}class i_{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new oa(Qt,16,0),this.featureIndexArray=new Bn,this.promoteId=r}insert(e,r,s,l,p,g=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,p,g);const T=this.grid;for(let S=0;S<r.length;S++){const P=r[S],D=[1/0,1/0,-1/0,-1/0];for(let L=0;L<P.length;L++){const U=P[L];D[0]=Math.min(D[0],U.x),D[1]=Math.min(D[1],U.y),D[2]=Math.max(D[2],U.x),D[3]=Math.max(D[3],U.y)}D[0]<Qt&&D[1]<Qt&&D[2]>=0&&D[3]>=0&&T.insert(v,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ar(new vm(this.rawTileData)).layers,this.sourceLayerCoder=new $x(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,s,l){this.loadVTLayers();const p=e.params||{},g=vl(p.filter),v=e.tileResult,T=e.transform,S=v.bufferedTilespaceBounds,P=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,((V,q,ee,ae)=>um(v.bufferedTilespaceGeometry,V,q,ee,ae)));P.sort($T);let D=null;T.elevation&&P.length>0&&(D=Dm.create(T.elevation,this.tileID));const L={};let U;for(let V=0;V<P.length;V++){const q=P[V];if(q===U)continue;U=q;const ee=this.featureIndexArray.get(q);let ae=null;this.loadMatchingFeature(L,ee,g,p.layers,p.availableImages,r,s,l,((me,oe,fe,be=0)=>(ae||(ae=Yi(me,this.tileID.canonical,e.tileTransform)),oe.queryIntersectsFeature(v,me,fe,ae,this.z,e.transform,e.pixelPosMatrix,D,be))))}return L}loadMatchingFeature(e,r,s,l,p,g,v,T,S){const{featureIndex:P,bucketIndex:D,sourceLayerIndex:L,layoutVertexArrayOffset:U}=r,V=this.bucketLayerIDs[D];if(l&&!(function(me,oe){for(let fe=0;fe<me.length;fe++)if(oe.indexOf(me[fe])>=0)return!0;return!1})(l,V))return;const q=this.sourceLayerCoder.decode(L),ee=this.vtLayers[q].feature(P);if(s.needGeometry){const me=co(ee,!0);if(!s.filter(new j(this.tileID.overscaledZ),me,this.tileID.canonical))return}else if(!s.filter(new j(this.tileID.overscaledZ),ee))return;const ae=this.getId(ee,q);for(let me=0;me<V.length;me++){const oe=V[me];if(l&&l.indexOf(oe)<0)continue;const fe=g[oe];if(!fe)continue;let be={};ae!==void 0&&T&&(be=T.getState(fe.sourceLayer||"_geojsonTileLayer",ae));const _e=Ot({},v[oe]);_e.paint=s_(_e.paint,fe.paint,ee,be,p),_e.layout=s_(_e.layout,fe.layout,ee,be,p);const qe=!S||S(ee,fe,be,U);if(!qe)continue;const Oe=new Gx(ee,this.z,this.x,this.y,ae);Oe.layer=_e;let ot=e[oe];ot===void 0&&(ot=e[oe]=[]),ot.push({featureIndex:P,feature:Oe,intersectionZ:qe})}}lookupSymbolFeatures(e,r,s,l,p,g,v,T){const S={};this.loadVTLayers();const P=vl(p);for(const D of e)this.loadMatchingFeature(S,{bucketIndex:s,sourceLayerIndex:l,featureIndex:D,layoutVertexArrayOffset:0},P,g,v,T,r);return S}loadFeature(e){const{featureIndex:r,sourceLayerIndex:s}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(s),p=this.vtFeatures[l];if(p[r])return p[r];const g=this.vtLayers[l].feature(r);return p[r]=g,g}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;if(this.promoteId){const l=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];l!=null&&(s=e.properties[l]),typeof s=="boolean"&&(s=Number(s))}return s}}function s_(t,e,r,s,l){return Yt(t,((p,g)=>{const v=e instanceof se?e.get(g):null;return v&&v.evaluate?v.evaluate(r,s,l):v}))}function $T(t,e){return e-t}Rt(i_,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class a_{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Is({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const s=this.getKey(e,r);return this.positions[s]}trim(){const e=this.width,r=this.height=lt(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,s){const l=[];let p=e.length%2==1?-e[e.length-1]*s:0,g=e[0]*s,v=!0;l.push({left:p,right:g,isDash:v,zeroLength:e[0]===0});let T=e[0];for(let S=1;S<e.length;S++){v=!v;const P=e[S];p=T*s,T+=P,g=T*s,l.push({left:p,right:g,isDash:v,zeroLength:P===0})}return l}addRoundDash(e,r,s){const l=r/2;for(let p=-s;p<=s;p++){const g=this.width*(this.nextRow+s+p);let v=0,T=e[v];for(let S=0;S<this.width;S++){S/T.right>1&&(T=e[++v]);const P=Math.abs(S-T.left),D=Math.abs(S-T.right),L=Math.min(P,D);let U;const V=p/s*(l+1);if(T.isDash){const q=l-Math.abs(V);U=Math.sqrt(L*L+q*q)}else U=l-Math.sqrt(L*L+V*V);this.image.data[g+S]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(e,r){for(let T=e.length-1;T>=0;--T){const S=e[T],P=e[T+1];S.zeroLength?e.splice(T,1):P&&P.isDash===S.isDash&&(P.left=S.left,e.splice(T,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const p=this.width*this.nextRow;let g=0,v=e[g];for(let T=0;T<this.width;T++){T/v.right>1&&(v=e[++g]);const S=Math.abs(T-v.left),P=Math.abs(T-v.right),D=Math.min(S,P);this.image.data[p+T]=Math.max(0,Math.min(255,(v.isDash?D:-D)+r+128))}}addDash(e,r){const s=this.getKey(e,r);if(this.positions[s])return this.positions[s];const l=r==="round",p=l?7:0,g=2*p+1;if(this.nextRow+g>this.height)return Gr("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let P=0;P<e.length;P++)e[P]<0&&(Gr("Negative value is found in line dasharray, replacing values with 0"),e[P]=0),v+=e[P];if(v!==0){const P=this.width/v,D=this.getDashRanges(e,this.width,P);l?this.addRoundDash(D,P,p):this.addRegularDash(D,r==="square"?.5*P:0)}const T=this.nextRow+p;this.nextRow+=g;const S={tl:[T,p],br:[v,0]};return this.positions[s]=S,S}}Rt(a_,"LineAtlas");const o_=1*Vo;class l_{constructor(e){const r={},s=[];for(const v in e){const T=e[v],S=r[v]={};for(const P in T.glyphs){const D=T.glyphs[+P];if(!D||D.bitmap.width===0||D.bitmap.height===0)continue;const L=D.metrics.localGlyph?o_:1,U={x:0,y:0,w:D.bitmap.width+2*L,h:D.bitmap.height+2*L};s.push(U),S[P]=U}}const{w:l,h:p}=Sg(s),g=new Is({width:l||1,height:p||1});for(const v in e){const T=e[v];for(const S in T.glyphs){const P=T.glyphs[+S];if(!P||P.bitmap.width===0||P.bitmap.height===0)continue;const D=r[v][S],L=P.metrics.localGlyph?o_:1;Is.copy(P.bitmap,g,{x:0,y:0},{x:D.x+L,y:D.y+L},P.bitmap)}}this.image=g,this.positions=r}}Rt(l_,"GlyphAtlas");class GT{constructor(e){this.tileID=new js(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=$h(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,s,l,p){this.status="parsing",this.data=e,this.collisionBoxArray=new tn;const g=new $x(Object.keys(e.layers).sort()),v=new i_(this.tileID,this.promoteId);v.bucketLayerIDs=[];const T={},S=new a_(256,256),P={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:s},D=r.familiesBySource[this.source];for(const be in D){const _e=e.layers[be];if(!_e)continue;let qe=!1,Oe=!1;for(const Xe of D[be])Xe[0].type==="symbol"?qe=!0:Oe=!0;if(this.isSymbolTile===!0&&!qe||this.isSymbolTile===!1&&!Oe)continue;_e.version===1&&Gr(`Vector tile source "${this.source}" layer "${be}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ot=g.encode(be),bt=[];for(let Xe=0;Xe<_e.length;Xe++){const ut=_e.feature(Xe),ht=v.getId(ut,be);bt.push({feature:ut,id:ht,index:Xe,sourceLayerIndex:ot})}for(const Xe of D[be]){const ut=Xe[0];this.isSymbolTile!==void 0&&ut.type==="symbol"!==this.isSymbolTile||ut.minzoom&&this.zoom<Math.floor(ut.minzoom)||ut.maxzoom&&this.zoom>=ut.maxzoom||ut.visibility!=="none"&&(Vg(Xe,this.zoom,s),(T[ut.id]=ut.createBucket({index:v.bucketLayerIDs.length,layers:Xe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ot,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(bt,P,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push(Xe.map((ht=>ht.id))))}}let L,U,V,q;S.trim();const ee={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ae=()=>{if(L)return p(L);if(U&&V&&q){const be=new l_(U),_e=new mx(V,q);for(const qe in T){const Oe=T[qe];Oe instanceof Iu?(Vg(Oe.layers,this.zoom,s),gT(Oe,U,be.positions,V,_e.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):Oe.hasPattern&&(Oe instanceof ym||Oe instanceof _||Oe instanceof nf)&&(Vg(Oe.layers,this.zoom,s),Oe.addFeatures(P,this.tileID.canonical,_e.patternPositions,s,this.tileTransform))}this.status="done",p(null,{buckets:Ut(T).filter((qe=>!qe.isEmpty())),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:be.image,lineAtlas:S,imageAtlas:_e,glyphMap:this.returnDependencies?U:null,iconMap:this.returnDependencies?V:null,glyphPositions:this.returnDependencies?be.positions:null})}},me=Yt(P.glyphDependencies,(be=>Object.keys(be).map(Number)));Object.keys(me).length?l.send("getGlyphs",{uid:this.uid,stacks:me},((be,_e)=>{L||(L=be,U=_e,ae())}),void 0,!1,ee):U={};const oe=Object.keys(P.iconDependencies);oe.length?l.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"icons"},((be,_e)=>{L||(L=be,V=_e,ae())}),void 0,!1,ee):V={};const fe=Object.keys(P.patternDependencies);fe.length?l.send("getImages",{icons:fe,source:this.source,tileID:this.tileID,type:"patterns"},((be,_e)=>{L||(L=be,q=_e,ae())}),void 0,!1,ee):q={},ae()}}function Vg(t,e,r){const s=new j(e);for(const l of t)l.recalculate(s,r)}class c_{constructor(e){this.entries={},this.scheduler=e}request(e,r,s,l){const p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){const[g,v]=p.result;return this.scheduler?this.scheduler.add((()=>{l(g,v)}),r):l(g,v),()=>{}}return p.callbacks.push(l),p.cancel||(p.cancel=s(((g,v)=>{p.result=[g,v];for(const T of p.callbacks)this.scheduler?this.scheduler.add((()=>{T(g,v)}),r):T(g,v);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{p.result||(p.callbacks=p.callbacks.filter((g=>g!==l)),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function u_(t,e,r){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},(l=>{const p=Oa(t.request,((g,v,T,S)=>{g?l(g):v&&l(null,{vectorTile:r?void 0:new ar(new vm(v)),rawData:v,cacheControl:T,expires:S})}));return()=>{p.cancel(),l()}}),e)}const h_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $g{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const p=h_[15&s];if(!p)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new $g(v,g,p,e)}constructor(e,r=64,s=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=h_.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+v+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=r,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Gg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:v}=this,T=[0,p.length-1,0],S=[];for(;T.length;){const P=T.pop()||0,D=T.pop()||0,L=T.pop()||0;if(D-L<=v){for(let ee=L;ee<=D;ee++){const ae=g[2*ee],me=g[2*ee+1];ae>=e&&ae<=s&&me>=r&&me<=l&&S.push(p[ee])}continue}const U=L+D>>1,V=g[2*U],q=g[2*U+1];V>=e&&V<=s&&q>=r&&q<=l&&S.push(p[U]),(P===0?e<=V:r<=q)&&(T.push(L),T.push(U-1),T.push(1-P)),(P===0?s>=V:l>=q)&&(T.push(U+1),T.push(D),T.push(1-P))}return S}within(e,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:p,nodeSize:g}=this,v=[0,l.length-1,0],T=[],S=s*s;for(;v.length;){const P=v.pop()||0,D=v.pop()||0,L=v.pop()||0;if(D-L<=g){for(let ee=L;ee<=D;ee++)p_(p[2*ee],p[2*ee+1],e,r)<=S&&T.push(l[ee]);continue}const U=L+D>>1,V=p[2*U],q=p[2*U+1];p_(V,q,e,r)<=S&&T.push(l[U]),(P===0?e-s<=V:r-s<=q)&&(v.push(L),v.push(U-1),v.push(1-P)),(P===0?e+s>=V:r+s>=q)&&(v.push(U+1),v.push(D),v.push(1-P))}return T}}function Gg(t,e,r,s,l,p){if(l-s<=r)return;const g=s+l>>1;d_(t,e,g,s,l,p),Gg(t,e,r,s,g-1,1-p),Gg(t,e,r,g+1,l,1-p)}function d_(t,e,r,s,l,p){for(;l>s;){if(l-s>600){const S=l-s+1,P=r-s+1,D=Math.log(S),L=.5*Math.exp(2*D/3),U=.5*Math.sqrt(D*L*(S-L)/S)*(P-S/2<0?-1:1);d_(t,e,r,Math.max(s,Math.floor(r-P*L/S+U)),Math.min(l,Math.floor(r+(S-P)*L/S+U)),p)}const g=e[2*r+p];let v=s,T=l;for(yf(t,e,s,r),e[2*l+p]>g&&yf(t,e,s,l);v<T;){for(yf(t,e,v,T),v++,T--;e[2*v+p]<g;)v++;for(;e[2*T+p]>g;)T--}e[2*s+p]===g?yf(t,e,s,T):(T++,yf(t,e,T,l)),T<=r&&(s=T+1),r<=T&&(l=T-1)}}function yf(t,e,r,s){Wg(t,r,s),Wg(e,2*r,2*s),Wg(e,2*r+1,2*s+1)}function Wg(t,e,r){const s=t[e];t[e]=t[r],t[r]=s}function p_(t,e,r,s){const l=t-r,p=e-s;return l*l+p*p}i.ARRAY_TYPE=Ri,i.AUTH_ERR_MSG=we,i.Aabb=Bi,i.Actor=class{constructor(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},ir(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ts()?t:R,this.scheduler=new zT}send(t,e,r,s,l=!1,p){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=p,this.callbacks[g]=r);const v=Js(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:t,hasCallback:!!r,targetMapId:s,mustQueue:l,sourceMapId:this.mapId,data:jo(e,v)},v),{cancel:()=>{r&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(t){const e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const s=this.cancelCallbacks[r];delete this.cancelCallbacks[r],s&&s.cancel()}else if(e.mustQueue||ts()){const s=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add((()=>this.processTask(r,e)),s&&s.metadata||{type:"message"})}else this.processTask(r,e)}processTask(t,e){if(e.type==="<response>"){const r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(No(e.error)):r(null,No(e.data)))}else{const r=Js(this.globalScope)?void 0:[],s=e.hasCallback?(p,g)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:p?jo(p):null,data:jo(g,r)},r)}:p=>{},l=No(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,l,s);else if(this.parent.getWorkerSource){const p=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,p[0],l.source)[p[1]](l,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},i.CanonicalTileID=gm,i.Color=on,i.ColorMode=Ul,i.CullFaceMode=$o,i.DEMData=Nm,i.DataConstantProperty=W,i.DedupedRequest=c_,i.DepthMode=ep,i.EXTENT=Qt,i.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const r=e.getSource().maxzoom,s=1<<r,l=Math.floor(t.x),p=Math.floor((t.x-l)*s),g=Math.floor(t.y*s),v=this.findDEMTileFor(new js(r,l,r,p,g));return!(!v||!v.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const l=s.getSource().maxzoom,p=1<<l,g=Math.floor(t.x),v=t.x-g,T=new js(l,g,l,Math.floor(v*p),Math.floor(t.y*p)),S=this.findDEMTileFor(T);if(!S||!S.dem)return e;const P=S.dem,D=1<<S.tileID.canonical.z,L=(v*D-S.tileID.canonical.x)*P.dim,U=(t.y*D-S.tileID.canonical.y)*P.dim,V=Math.floor(L),q=Math.floor(U);return(r?this.exaggeration():1)*Fr(Fr(P.get(V,q),P.get(V,q+1),U-q),Fr(P.get(V+1,q),P.get(V+1,q+1),U-q),L-V)}getAtTileOffset(t,e,r){const s=1<<t.canonical.z;return this.getAtPointOrZero(new Nl(t.wrap+(t.canonical.x+e/Qt)/s,(t.canonical.y+r/Qt)/s))}getAtTileOffsetFunc(t,e,r,s){return l=>{const p=this.getAtTileOffset(t,l.x,l.y),g=s.upVector(t.canonical,l.x,l.y);return Sn(g,g,p*s.upVectorScale(t.canonical,e,r).metersToTile),g}}getForTilePoints(t,e,r,s){if(this.isUsingMockSource())return!1;const l=Dm.create(this,t,s);return!!l&&(e.forEach((p=>{p[2]=this.exaggeration()*l.getElevationAt(p[0],p[1],r)})),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,s=e.tileID,l=1<<t.canonical.z-s.canonical.z;let p=t.canonical.x/l-s.canonical.x,g=t.canonical.y/l-s.canonical.y,v=0;for(let T=0;T<t.canonical.z-s.canonical.z&&!r.leaves[v];T++){p*=2,g*=2;const S=2*Math.floor(g)+Math.floor(p);v=r.childOffsets[v]+S,p%=1,g%=1}return{min:this.exaggeration()*r.minimums[v],max:this.exaggeration()*r.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},i.ErrorEvent=xs,i.EvaluationParameters=j,i.Event=Ua,i.Evented=Vi,i.FillExtrusionBucket=nf,i.Frustum=Pd,i.FrustumCorners=Ch,i.GLOBE_RADIUS=oo,i.GLOBE_SCALE_MATCH_LATITUDE=45,i.GLOBE_ZOOM_THRESHOLD_MAX=Fi,i.GLOBE_ZOOM_THRESHOLD_MIN=Sc,i.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const r=new yt,s=new Zt,l=[],p=t+1+2,g=e[0]+1,v=e[0]+1+(1+e.length),T=(S,P,D)=>{let L=S===p-1?S-2:S===0?S:S-1;return L+=D?24575:0,[L,P]};for(let S=0;S<p;++S)r.emplaceBack(...T(S,0,!0));for(let S=0;S<g;++S)for(let P=0;P<p;++P)r.emplaceBack(...T(P,S,(P===0||P===p-1)&&!0));for(let S=0;S<e.length;++S){const P=e[S];for(let D=0;D<p;++D)r.emplaceBack(...T(D,P,!0))}for(let S=0;S<e.length;++S){const P=s.length,D=e[S]+1+2,L=new Zt;for(let q=0;q<D-1;q++){const ee=q===D-2,ae=ee?p*(v-e.length+S-q):p;for(let me=0;me<p-1;me++){const oe=q*p+me;q===0||ee||me===0||me===p-2?(L.emplaceBack(oe+1,oe,oe+ae),L.emplaceBack(oe+ae,oe+ae+1,oe+1)):(s.emplaceBack(oe+1,oe,oe+ae),s.emplaceBack(oe+ae,oe+ae+1,oe+1))}}const U=Wn.simpleSegment(0,P,r.length,s.length-P);for(let q=0;q<L.uint16.length;q+=3)s.emplaceBack(L.uint16[q],L.uint16[q+1],L.uint16[q+2]);const V=Wn.simpleSegment(0,P,r.length,s.length-P);l.push({withoutSkirts:U,withSkirts:V})}return{vertices:r,indices:s,segments:l}}_createGrid(t){const e=this._fillGridMeshWithLods(lo,yi);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Eh.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Zt;for(let l=0;l<=lo;l++)e.emplaceBack(0,l+1,l+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const r=new qr,s=new qr;this._poleSegments=[];for(let l=0,p=0;l<Sc;l++){const g=360/(1<<l);r.emplaceBack(0,-oo,0,.5,0),s.emplaceBack(0,-oo,0,.5,1);for(let v=0;v<=lo;v++){const T=v/lo,S=Fr(0,g,T),[P,D,L]=Kn(cm,mg,S,oo);r.emplaceBack(P,D,L,T,0),s.emplaceBack(P,D,L,T,1)}this._poleSegments.push(Wn.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(r,Sh,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,Sh,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const r=new In,s=lo,l=s+1+2,p=1;this._wireframeSegments=[];for(let g=0,v=0;g<yi.length;g++){const T=yi[g];for(let P=p;P<T+p;P++)for(let D=p;D<s+p;D++){const L=P*l+D;r.emplaceBack(L,L+1),r.emplaceBack(L,L+l),r.emplaceBack(L,L+l+1)}const S=T*s*3;this._wireframeSegments.push(Wn.simpleSegment(0,v,(T+1)*l,S)),v+=S}this._wireframeIndexBuffer=t.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},i.GlyphManager=Xd,i.ImagePosition=Eg,i.KDBush=$g,i.LivePerformanceUtils=rd,i.LngLat=rr,i.LngLatBounds=zo,i.LocalGlyphMode=Ag,i.MAX_MERCATOR_LATITUDE=Fn,i.MercatorCoordinate=Nl,i.ONE_EM=Oi,i.OverscaledTileID=js,i.PerformanceMarkers=yo,i.Point=ge,i.Properties=ue,i.RGBAImage=fs,i.Ray=Ad,i.RequestManager=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=(function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Qe,e].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Ae(t))return t;const r=It(t);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Ae(t))return t;const r=It(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e,r,s){if(!Ae(t))return t;const l=It(t);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),r&&l.params.push(`language=${r}`),s&&l.params.push(`worldview=${s}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,s){const l=It(t);return Ae(t)?(l.path=`/styles/v1${l.path}/sprite${e}${r}`,this._makeAPIURL(l,this._customAccessToken||s)):(l.path+=`${e}${r}`,xt(l))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ae(t))return t;const s=It(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&s.authority!=="raster"&&r===512?"@2x":""}${he.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${Z.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${Z.TILE_URL_VERSION}${s.path}`);const l=this._customAccessToken||(function(p){for(const g of p){const v=g.match(/^access_token=(.*)$/);if(v)return v[1]}return null})(s.params)||Z.ACCESS_TOKEN;return Z.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,l)}canonicalizeTileURL(t,e){const r=It(t);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let s="mapbox://";r.path.match(/^\/raster\/v1\//)?s+=`raster/${r.path.replace(`/${Z.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${r.path.replace(`/${Z.TILE_URL_VERSION}/`,"")}`;let l=r.params;return e&&(l=l.filter((p=>!p.match(/^access_token=/)))),l.length&&(s+=`?${l.join("&")}`),s}canonicalizeTileset(t,e){const r=!!e&&Ae(e),s=[];for(const l of t.tiles||[])Fe(l)?s.push(this.canonicalizeTileURL(l,r)):s.push(l);return s}_makeAPIURL(t,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=It(Z.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,t.protocol==="http"){const l=t.params.indexOf("secure");l>=0&&t.params.splice(l,1)}if(s.path!=="/"&&(t.path=`${s.path}${t.path}`),!Z.REQUIRE_ACCESS_TOKEN)return xt(t);if(e=e||Z.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter((l=>l.indexOf("access_token")===-1)),t.params.push(`access_token=${e||""}`),xt(t)}},i.ResourceType=Ba,i.SegmentVector=Wn,i.SourceCache=Gh,i.StencilMode=Fg,i.StructArrayLayout1ui2=us,i.StructArrayLayout2f1f2i16=tr,i.StructArrayLayout2i4=yt,i.StructArrayLayout2ui4=In,i.StructArrayLayout3f12=Pr,i.StructArrayLayout3ui6=Zt,i.StructArrayLayout4i8=nt,i.StructArrayLayout5f20=qr,i.Texture=mf,i.Tile=zg,i.Transitionable=G,i.Uniform1f=_h,i.Uniform1i=class extends no{constructor(t){super(t),this.current=0}set(t,e,r){this.fetchUniformLocation(t,e)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},i.Uniform2f=class extends no{constructor(t){super(t),this.current=[0,0]}set(t,e,r){this.fetchUniformLocation(t,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}},i.Uniform3f=class extends no{constructor(t){super(t),this.current=[0,0,0]}set(t,e,r){this.fetchUniformLocation(t,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}},i.Uniform4f=Mp,i.UniformColor=Ap,i.UniformMatrix2f=class extends no{constructor(t){super(t),this.current=Kf}set(t,e,r){if(this.fetchUniformLocation(t,e)){for(let s=0;s<4;s++)if(r[s]!==this.current[s]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}},i.UniformMatrix3f=class extends no{constructor(t){super(t),this.current=Xf}set(t,e,r){if(this.fetchUniformLocation(t,e)){for(let s=0;s<9;s++)if(r[s]!==this.current[s]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},i.UniformMatrix4f=class extends no{constructor(t){super(t),this.current=Hf}set(t,e,r){if(this.fetchUniformLocation(t,e)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let s=1;s<16;s++)if(r[s]!==this.current[s]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}},i.UnwrappedTileID=ex,i.ValidationError=Dt,i.VectorTileFeature=fr,i.VectorTileWorkerSource=class extends Vi{constructor(t,e,r,s,l){super(),this.actor=t,this.layerIndex=e,this.availableImages=r,this.loadVectorData=l||u_,this.loading={},this.loaded={},this.deduped=new c_(t.scheduler),this.isSpriteLoaded=s,this.scheduler=t.scheduler}loadTile(t,e){const r=t.uid,s=t&&t.request,l=s&&s.collectResourceTiming,p=this.loading[r]=new GT(t);p.abort=this.loadVectorData(t,((g,v)=>{const T=!this.loading[r];if(delete this.loading[r],T||g||!v)return p.status="done",T||(this.loaded[r]=p),e(g);const S=v.rawData,P={};v.expires&&(P.expires=v.expires),v.cacheControl&&(P.cacheControl=v.cacheControl),p.vectorTile=v.vectorTile||new ar(new vm(S));const D=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,((L,U)=>{if(L||!U)return e(L);const V={};if(l){const q=$u(s);q.length>0&&(V.resourceTiming=JSON.parse(JSON.stringify(q)))}e(null,Ot({rawTileData:S.slice(0)},U,P,V))}))};this.isSpriteLoaded?D():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(D,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):D()})),this.loaded=this.loaded||{},this.loaded[r]=p}))}reloadTile(t,e){const r=this.loaded,s=t.uid,l=this;if(r&&r[s]){const p=r[s];p.showCollisionBoxes=t.showCollisionBoxes,p.enableTerrain=!!t.enableTerrain,p.projection=t.projection,p.tileTransform=$h(t.tileID.canonical,t.projection);const g=(v,T)=>{const S=p.reloadCallback;S&&(delete p.reloadCallback,p.parse(p.vectorTile,l.layerIndex,this.availableImages,l.actor,S)),e(v,T)};p.status==="parsing"?p.reloadCallback=g:p.status==="done"&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(t,e){const r=t.uid,s=this.loading[r];s&&(s.abort&&s.abort(),delete this.loading[r]),e()}removeTile(t,e){const r=this.loaded,s=t.uid;r&&r[s]&&delete r[s],e()}},i.WritingMode=Ra,i.ZoomDependentExpression=Ka,i.add=so,i.addDynamicAttributes=Pm,i.adjoint=function(t,e){var r=e[0],s=e[1],l=e[2],p=e[3],g=e[4],v=e[5],T=e[6],S=e[7],P=e[8];return t[0]=g*P-v*S,t[1]=l*S-s*P,t[2]=s*v-l*g,t[3]=v*T-p*P,t[4]=r*P-l*T,t[5]=l*p-r*v,t[6]=p*S-g*T,t[7]=s*T-r*S,t[8]=r*g-s*p,t},i.asyncAll=et,i.bezier=Ht,i.bindAll=ir,i.boundsAttributes=qx,i.bufferConvexPolygon=function(t,e){const r=[];for(let s=0;s<t.length;s++){const l=ve(s-1,-1,t.length-1),p=ve(s+1,-1,t.length-1),g=t[s],v=t[p],T=t[l].sub(g).unit(),S=v.sub(g).unit(),P=S.angleWithSep(T.x,T.y),D=T.add(S).unit().mult(-1*e/Math.sin(P/2));r.push(g.add(D))}return r},i.cacheEntryPossiblyAdded=function(t){Ko++,Ko>An&&(t.getActor().send("enforceCacheSizeLimit",qt),Ko=0)},i.calculateGlobeLabelMatrix=function(t,e){const{x:r,y:s}=t.point,l=ja(r,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Bo(l,l,Id(Zs(e)))},i.calculateGlobeMatrix=function(t){const{x:e,y:r}=t.point,{lng:s,lat:l}=t._center;return ja(e,r,t.worldSize,s,l)},i.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,r=e/qn(1,t.center.lat),s=Ia(new Float64Array(16));return Al(s,s,[t.point.x,t.point.y,0]),Pl(s,s,[r,r,e]),Float32Array.from(s)},i.circumferenceAtLatitude=xi,i.clamp=Be,i.clearTileCache=function(t){if(!En())return;const e=R.caches.delete(Br);t&&e.catch(t).then((()=>t()))},i.clipLine=Mx,i.clone=function(t){var e=new Ri(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},i.clone$1=Rn,i.collisionCircleLayout=Vw,i.config=Z,i.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},i.create=function(){var t=new Ri(16);return Ri!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},i.create$1=tm,i.createExpression=an,i.createLayout=Ie,i.createStyleLayer=function(t){return t.type==="custom"?new NT(t):new LT[t.type](t)},i.cross=kd,i.degToRad=ct,i.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},i.div=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},i.dot=Ws,i.earthRadius=jl,i.ease=Tt,i.easeCubicInOut=Jt,i.ecefToLatLng=function([t,e,r]){const s=Math.hypot(t,e,r),l=Math.atan2(t,r),p=.5*Math.PI-Math.acos(-e/s);return new rr(Kt(l),Kt(p))},i.emitValidationErrors=Li,i.endsWith=Vn,i.enforceCacheSizeLimit=function(t){xn(),Wr&&Wr.then((e=>{e.keys().then((r=>{for(let s=0;s<r.length-t;s++)e.delete(r[s])}))}))},i.evaluateSizeForFeature=xm,i.evaluateSizeForZoom=Wd,i.evaluateVariableOffset=Nx,i.evented=x,i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},i.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},i.exported=Qs,i.exported$1=he,i.extend=Ot,i.extend$1=ni,i.fillExtrusionHeightLift=Y0,i.filterObject=ei,i.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},i.fromQuat=function(t,e){var r=e[0],s=e[1],l=e[2],p=e[3],g=r+r,v=s+s,T=l+l,S=r*g,P=s*g,D=s*v,L=l*g,U=l*v,V=l*T,q=p*g,ee=p*v,ae=p*T;return t[0]=1-D-V,t[1]=P+ae,t[2]=L-ee,t[3]=0,t[4]=P-ae,t[5]=1-S-V,t[6]=U+q,t[7]=0,t[8]=L+ee,t[9]=U-q,t[10]=1-S-D,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.fromRotation=function(t,e){var r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=r,t[2]=0,t[3]=-r,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},i.fromScaling=wd,i.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return Mr[e]},i.getAABBPointSquareDist=function(t,e,r){let s=0;for(let l=0;l<2;++l){const p=r?r[l]:0;t[l]>p&&(s+=(t[l]-p)*(t[l]-p)),e[l]<p&&(s+=(p-e[l])*(p-e[l]))}return s},i.getAnchorAlignment=Mg,i.getAnchorJustification=Ig,i.getBounds=function(t){let e=1/0,r=1/0,s=-1/0,l=-1/0;for(const p of t)e=Math.min(e,p.x),r=Math.min(r,p.y),s=Math.max(s,p.x),l=Math.max(l,p.y);return{min:new ge(e,r),max:new ge(s,l)}},i.getColumn=dr,i.getDefaultExportFromCjs=dt,i.getGridMatrix=function(t,e,r,s){const l=e.getNorth(),p=e.getSouth(),g=e.getWest(),v=e.getEast(),T=1<<t.z,S=v-g,P=l-p,D=S/lo,L=-P/yi[r],U=[0,D,0,L,0,0,l,g,0];if(t.z>0){const V=180/s;rm(U,U,[V/S+1,0,0,0,V/P+1,0,-.5*V/D,.5*V/L,1])}return U[2]=T,U[5]=t.x,U[8]=t.y,U},i.getImage=de,i.getJSON=function(t,e){return xa(Ot(t,{type:"json"}),e)},i.getLatitudinalLod=function(t){const e=Fn-5;t=Be(t,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(ct(t))),3);return Math.round(r*(yi.length-1))},i.getMapSessionAPI=ri,i.getPerformanceMeasurement=$u,i.getProjection=Ux,i.getRTLTextPluginStatus=b,i.getReferrer=ya,i.getTilePoint=function(t,{x:e,y:r},s=0){return new ge(((e-s)*t.scale-t.x)*Qt,(r*t.scale-t.y)*Qt)},i.getTileVec3=function(t,e,r=0){return kc(((e.x-r)*t.scale-t.x)*Qt,(e.y*t.scale-t.y)*Qt,Tu(e.z,e.y))},i.getVideo=function(t,e){const r=R.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<t.length;s++){const l=R.document.createElement("source");Yo(t[s])||(r.crossOrigin="Anonymous"),l.src=t[s],r.appendChild(l)}return{cancel:()=>{}}},i.globeCenterToScreenPoint=function(t){const e=[0,0,0],r=Ia(new Float64Array(16));return Bo(r,t.pixelMatrix,t.globeMatrix),Nn(e,e,r),new ge(e[0],e[1])},i.globeDenormalizeECEF=Id,i.globeECEFOrigin=function(t,e){const r=[0,0,0];return Nn(r,r,hs(Zs(e.canonical))),Nn(r,r,t),r},i.globeMetersToEcef=vu,i.globeNormalizeECEF=hs,i.globePixelsToTileUnits=function(t,e){return Qt/(512*Math.pow(2,t))*Ah(Zs(e))},i.globePoleMatrixForTile=function(t,e,r){const s=Ia(new Float64Array(16)),l=(e/(1<<t)-.5)*Math.PI*2;return bh(s,r.globeMatrix,l),Float32Array.from(s)},i.globeTileBounds=Zs,i.globeTiltAtLngLat=Up,i.globeToMercatorTransition=wu,i.globeUseCustomAntiAliasing=function(t,e,r){const s=wu(r.zoom),l=t.style.map._antialias,p=!!e.extStandardDerivatives,g=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return s===0&&!l&&!g&&p},i.identity=Ia,i.identity$1=kh,i.invert=Gs,i.isFullscreen=function(){return!!R.document.fullscreenElement||!!R.document.webkitFullscreenElement},i.isLngLatBehindGlobe=jd,i.isMapAuthenticated=function(t){return Di.has(t)},i.isMapboxURL=Ae,i.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Js(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.latFromMercatorY=Yr,i.latLngToECEF=Ki,i.len=sm,i.length=gu,i.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},i.lngFromMercatorX=Mi,i.loadVectorTile=u_,i.makeRequest=xa,i.mapValue=function(t,e,r,s,l){return Be((t-e)/(r-e)*(l-s)+s,s,l)},i.mercatorScale=Ph,i.mercatorXfromLng=pn,i.mercatorYfromLat=Mn,i.mercatorZfromAltitude=qn,i.mul=Np,i.mul$1=im,i.multiply=Bo,i.multiply$1=rm,i.multiply$2=Dp,i.nextPowerOfTwo=lt,i.normalize=zi,i.normalize$1=Rp,i.normalize$2=Cd,i.number=Fr,i.ortho=function(t,e,r,s,l,p,g){var v=1/(e-r),T=1/(s-l),S=1/(p-g);return t[0]=-2*v,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*T,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*S,t[11]=0,t[12]=(e+r)*v,t[13]=(l+s)*T,t[14]=(g+p)*S,t[15]=1,t},i.pbf=ox,i.perspective=function(t,e,r,s,l){var p,g=1/Math.tan(e/2);return t[0]=g/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=(l+s)*(p=1/(s-l)),t[14]=2*l*s*p):(t[10]=-1,t[14]=-2*s),t},i.pick=function(t,e){const r={};for(let s=0;s<e.length;s++){const l=e[s];l in t&&(r[l]=t[l])}return r},i.plugin=M,i.pointGeometry=Ge,i.polesInViewport=function(t){const e=Ia(new Float64Array(16));Bo(e,t.pixelMatrix,t.globeMatrix);const r=[0,ua,0],s=[0,$t,0];return Nn(r,r,e),Nn(s,s,e),[r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!jd(t,new rr(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!jd(t,new rr(t.center.lat,-90))]},i.polygonContainsPoint=Oo,i.polygonIntersectsBox=um,i.polygonIntersectsPolygon=Dd,i.polygonizeBounds=function(t,e,r=0,s=!0){const l=new ge(r,r),p=t.sub(l),g=e.add(l),v=[p,new ge(g.x,p.y),g,new ge(p.x,g.y)];return s&&v.push(p.clone()),v},i.posAttributes=Eh,i.postMapLoadEvent=$n,i.postPerformanceEvent=_n,i.postTurnstileEvent=Nr,i.potpack=Sg,i.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},i.radToDeg=Kt,i.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.registerForPluginStateChange=function(t){return t({pluginStatus:d,pluginURL:n}),x.on("pluginStateChange",t),t},i.removeAuthState=function(t){Di.delete(t)},i.renderColorRamp=Kp,i.resample=ds,i.rotateX=bd,i.rotateX$1=am,i.rotateY=bh,i.rotateY$1=Lp,i.rotateZ=function(t,e,r){var s=Math.sin(r),l=Math.cos(r),p=e[0],g=e[1],v=e[2],T=e[3],S=e[4],P=e[5],D=e[6],L=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=p*l+S*s,t[1]=g*l+P*s,t[2]=v*l+D*s,t[3]=T*l+L*s,t[4]=S*l-p*s,t[5]=P*l-g*s,t[6]=D*l-v*s,t[7]=L*l-T*s,t},i.rotateZ$1=function(t,e,r){r*=.5;var s=e[0],l=e[1],p=e[2],g=e[3],v=Math.sin(r),T=Math.cos(r);return t[0]=s*T+l*v,t[1]=l*T-s*v,t[2]=p*T+g*v,t[3]=g*T-p*v,t},i.scale=Pl,i.scale$1=Ed,i.scale$2=Sn,i.scaleAndAdd=yu,i.set=function(t,e,r,s){return t[0]=e,t[1]=r,t[2]=s,t},i.setCacheLimits=function(t,e){qt=t,An=e},i.setColumn=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},i.setRTLTextPlugin=function(t,e,r=!1){if(d===Vs||d===Aa||d===pu)throw new Error("setRTLTextPlugin cannot be called multiple times.");n=Qs.resolveURL(t),d=Vs,to=e,f(),r||C()},i.smoothstep=Je,i.spec=at,i.squaredLength=function(t){var e=t[0],r=t[1],s=t[2];return e*e+r*r+s*s},i.storeAuthState=function(t,e){e?Di.add(t):Di.delete(t)},i.sub=qs,i.subtract=Td,i.symbolSize=$w,i.tileAABB=function(t,e,r,s,l,p,g,v,T){if(T.name==="globe")return lm(t,e,new gm(r,s,l));const S=$h({z:r,x:s,y:l},T);return new Bi([(p+S.x/S.scale)*e,e*(S.y/S.scale),g],[(p+S.x2/S.scale)*e,e*(S.y2/S.scale),v])},i.tileCornersToBounds=bu,i.tileTransform=$h,i.transformMat3=function(t,e,r){var s=e[0],l=e[1],p=e[2];return t[0]=s*r[0]+l*r[3]+p*r[6],t[1]=s*r[1]+l*r[4]+p*r[7],t[2]=s*r[2]+l*r[5]+p*r[8],t},i.transformMat4=Nn,i.transformMat4$1=Il,i.transformQuat=Sd,i.transitionTileAABBinECEF=Bp,i.translate=Al,i.transpose=function(t,e){if(t===e){var r=e[1],s=e[2],l=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=s,t[7]=l}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},i.triggerPluginCompletionEvent=o,i.uniqueId=lr,i.updateGlobeVertexNormal=function(t,e,r,s,l){const p=5*e+2;t.float32[p+0]=r,t.float32[p+1]=s,t.float32[p+2]=l},i.validateCustomStyleLayer=function(t){const e=[],r=t.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},i.validateFilter=t=>wi(Zi(t)),i.validateFog=t=>wi(Ca(t)),i.validateLayer=t=>wi(yd(t)),i.validateLight=t=>wi(hu(t)),i.validateSource=t=>wi(Po(t)),i.validateStyle=bi,i.validateTerrain=t=>wi(Ja(t)),i.values=Ut,i.vectorTile=rt,i.version=$,i.warnOnce=Gr,i.window=R,i.wrap=ve})),I(["./shared"],(function(i){function R(pe){if(typeof pe=="number"||typeof pe=="boolean"||typeof pe=="string"||pe==null)return JSON.stringify(pe);if(Array.isArray(pe)){let Y="[";for(const de of pe)Y+=`${R(de)},`;return`${Y}]`}let X="{";for(const Y of Object.keys(pe).sort())X+=`${Y}:${R(pe[Y])},`;return`${X}}`}function $(pe){let X="";for(const Y of i.refProperties)X+=`/${R(pe[Y])}`;return X}class K{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,Y){for(const we of X)this._layerConfigs[we.id]=we,(this._layers[we.id]=i.createStyleLayer(we)).compileFilter(),this.keyCache[we.id]&&delete this.keyCache[we.id];for(const we of Y)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const de=(function(we,Ae){const Fe={};for(let Ce=0;Ce<we.length;Ce++){const He=Ae&&Ae[we[Ce].id]||$(we[Ce]);Ae&&(Ae[we[Ce].id]=He);let kt=Fe[He];kt||(kt=Fe[He]=[]),kt.push(we[Ce])}const Re=[];for(const Ce in Fe)Re.push(Fe[Ce]);return Re})(i.values(this._layerConfigs),this.keyCache);for(const we of de){const Ae=we.map((It=>this._layers[It.id])),Fe=Ae[0];if(Fe.visibility==="none")continue;const Re=Fe.source||"";let Ce=this.familiesBySource[Re];Ce||(Ce=this.familiesBySource[Re]={});const He=Fe.sourceLayer||"_geojsonTileLayer";let kt=Ce[He];kt||(kt=Ce[He]=[]),kt.push(Ae)}}}class Z{loadTile(X,Y){const{uid:de,encoding:we,rawImageData:Ae,padding:Fe,buildQuadTree:Re}=X,Ce=i.window.ImageBitmap&&Ae instanceof i.window.ImageBitmap?this.getImageData(Ae,Fe):Ae;Y(null,new i.DEMData(de,Ce,we,Fe<1,Re))}getImageData(X,Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);const de=this.offscreenCanvasContext.getImageData(-Y,-Y,X.width+2*Y,X.height+2*Y);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}function he(pe,X){if(pe.length!==0){Te(pe[0],X);for(var Y=1;Y<pe.length;Y++)Te(pe[Y],!X)}}function Te(pe,X){for(var Y=0,de=0,we=0,Ae=pe.length,Fe=Ae-1;we<Ae;Fe=we++){var Re=(pe[we][0]-pe[Fe][0])*(pe[Fe][1]+pe[we][1]),Ce=Y+Re;de+=Math.abs(Y)>=Math.abs(Re)?Y-Ce+Re:Re-Ce+Y,Y=Ce}Y+de>=0!=!!X&&pe.reverse()}var ye=i.getDefaultExportFromCjs((function pe(X,Y){var de,we=X&&X.type;if(we==="FeatureCollection")for(de=0;de<X.features.length;de++)pe(X.features[de],Y);else if(we==="GeometryCollection")for(de=0;de<X.geometries.length;de++)pe(X.geometries[de],Y);else if(we==="Feature")pe(X.geometry,Y);else if(we==="Polygon")he(X.coordinates,Y);else if(we==="MultiPolygon")for(de=0;de<X.coordinates.length;de++)he(X.coordinates[de],Y);return X}));const Me=i.VectorTileFeature.prototype.toGeoJSON;var Le={exports:{}},De=i.pointGeometry,Qe=i.vectorTile.VectorTileFeature,dt=St;function St(pe,X){this.options=X||{},this.features=pe,this.length=pe.length}function ce(pe,X){this.id=typeof pe.id=="number"?pe.id:void 0,this.type=pe.type,this.rawGeometry=pe.type===1?[pe.geometry]:pe.geometry,this.properties=pe.tags,this.extent=X||4096}St.prototype.feature=function(pe){return new ce(this.features[pe],this.options.extent)},ce.prototype.loadGeometry=function(){var pe=this.rawGeometry;this.geometry=[];for(var X=0;X<pe.length;X++){for(var Y=pe[X],de=[],we=0;we<Y.length;we++)de.push(new De(Y[we][0],Y[we][1]));this.geometry.push(de)}return this.geometry},ce.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var pe=this.geometry,X=1/0,Y=-1/0,de=1/0,we=-1/0,Ae=0;Ae<pe.length;Ae++)for(var Fe=pe[Ae],Re=0;Re<Fe.length;Re++){var Ce=Fe[Re];X=Math.min(X,Ce.x),Y=Math.max(Y,Ce.x),de=Math.min(de,Ce.y),we=Math.max(we,Ce.y)}return[X,de,Y,we]},ce.prototype.toGeoJSON=Qe.prototype.toGeoJSON;var $e=i.pbf,Ge=dt;function Ye(pe){var X=new $e;return(function(Y,de){for(var we in Y.layers)de.writeMessage(3,ge,Y.layers[we])})(pe,X),X.finish()}function ge(pe,X){var Y;X.writeVarintField(15,pe.version||1),X.writeStringField(1,pe.name||""),X.writeVarintField(5,pe.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<pe.length;Y++)de.feature=pe.feature(Y),X.writeMessage(2,Pt,de);var we=de.keys;for(Y=0;Y<we.length;Y++)X.writeStringField(3,we[Y]);var Ae=de.values;for(Y=0;Y<Ae.length;Y++)X.writeMessage(4,Jt,Ae[Y])}function Pt(pe,X){var Y=pe.feature;Y.id!==void 0&&X.writeVarintField(1,Y.id),X.writeMessage(2,tt,pe),X.writeVarintField(3,Y.type),X.writeMessage(4,Mr,Y)}function tt(pe,X){var Y=pe.feature,de=pe.keys,we=pe.values,Ae=pe.keycache,Fe=pe.valuecache;for(var Re in Y.properties){var Ce=Y.properties[Re],He=Ae[Re];if(Ce!==null){He===void 0&&(de.push(Re),Ae[Re]=He=de.length-1),X.writeVarint(He);var kt=typeof Ce;kt!=="string"&&kt!=="boolean"&&kt!=="number"&&(Ce=JSON.stringify(Ce));var It=kt+":"+Ce,xt=Fe[It];xt===void 0&&(we.push(Ce),Fe[It]=xt=we.length-1),X.writeVarint(xt)}}}function ct(pe,X){return(X<<3)+(7&pe)}function Kt(pe){return pe<<1^pe>>31}function Mr(pe,X){for(var Y=pe.loadGeometry(),de=pe.type,we=0,Ae=0,Fe=Y.length,Re=0;Re<Fe;Re++){var Ce=Y[Re],He=1;de===1&&(He=Ce.length),X.writeVarint(ct(1,He));for(var kt=de===3?Ce.length-1:Ce.length,It=0;It<kt;It++){It===1&&de!==1&&X.writeVarint(ct(2,kt-1));var xt=Ce[It].x-we,yr=Ce[It].y-Ae;X.writeVarint(Kt(xt)),X.writeVarint(Kt(yr)),we+=xt,Ae+=yr}de===3&&X.writeVarint(ct(7,1))}}function Jt(pe,X){var Y=typeof pe;Y==="string"?X.writeStringField(1,pe):Y==="boolean"?X.writeBooleanField(7,pe):Y==="number"&&(pe%1!=0?X.writeDoubleField(3,pe):pe<0?X.writeSVarintField(6,pe):X.writeVarintField(5,pe))}Le.exports=Ye,Le.exports.fromVectorTileJs=Ye,Le.exports.fromGeojsonVt=function(pe,X){X=X||{};var Y={};for(var de in pe)Y[de]=new Ge(pe[de].features,X),Y[de].name=de,Y[de].version=X.version,Y[de].extent=X.extent;return Ye({layers:Y})},Le.exports.GeoJSONWrapper=Ge;var Ht=i.getDefaultExportFromCjs(Le.exports);const Tt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:pe=>pe},Be=Math.fround||(Je=new Float32Array(1),pe=>(Je[0]=+pe,Je[0]));var Je;const ve=3,et=5,Ut=6;class Ot{constructor(X){this.options=Object.assign(Object.create(Tt),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:Y,minZoom:de,maxZoom:we}=this.options;Y&&console.time("total time");const Ae=`prepare ${X.length} points`;Y&&console.time(Ae),this.points=X;const Fe=[];for(let Ce=0;Ce<X.length;Ce++){const He=X[Ce];if(!He.geometry)continue;const[kt,It]=He.geometry.coordinates,xt=Be(zr(kt)),yr=Be(lt(It));Fe.push(xt,yr,1/0,Ce,-1,1),this.options.reduce&&Fe.push(0)}let Re=this.trees[we+1]=this._createTree(Fe);Y&&console.timeEnd(Ae);for(let Ce=we;Ce>=de;Ce--){const He=+Date.now();Re=this.trees[Ce]=this._createTree(this._cluster(Re,Ce)),Y&&console.log("z%d: %d clusters in %dms",Ce,Re.numItems,+Date.now()-He)}return Y&&console.timeEnd("total time"),this}getClusters(X,Y){let de=((X[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,X[1]));let Ae=X[2]===180?180:((X[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)de=-180,Ae=180;else if(de>Ae){const It=this.getClusters([de,we,180,Fe],Y),xt=this.getClusters([-180,we,Ae,Fe],Y);return It.concat(xt)}const Re=this.trees[this._limitZoom(Y)],Ce=Re.range(zr(de),lt(Fe),zr(Ae),lt(we)),He=Re.data,kt=[];for(const It of Ce){const xt=this.stride*It;kt.push(He[xt+et]>1?pr(He,xt,this.clusterProps):this.points[He[xt+ve]])}return kt}getChildren(X){const Y=this._getOriginId(X),de=this._getOriginZoom(X),we="No cluster with the specified id.",Ae=this.trees[de];if(!Ae)throw new Error(we);const Fe=Ae.data;if(Y*this.stride>=Fe.length)throw new Error(we);const Re=this.options.radius/(this.options.extent*Math.pow(2,de-1)),Ce=Ae.within(Fe[Y*this.stride],Fe[Y*this.stride+1],Re),He=[];for(const kt of Ce){const It=kt*this.stride;Fe[It+4]===X&&He.push(Fe[It+et]>1?pr(Fe,It,this.clusterProps):this.points[Fe[It+ve]])}if(He.length===0)throw new Error(we);return He}getLeaves(X,Y,de){const we=[];return this._appendLeaves(we,X,Y=Y||10,de=de||0,0),we}getTile(X,Y,de){const we=this.trees[this._limitZoom(X)],Ae=Math.pow(2,X),{extent:Fe,radius:Re}=this.options,Ce=Re/Fe,He=(de-Ce)/Ae,kt=(de+1+Ce)/Ae,It={features:[]};return this._addTileFeatures(we.range((Y-Ce)/Ae,He,(Y+1+Ce)/Ae,kt),we.data,Y,de,Ae,It),Y===0&&this._addTileFeatures(we.range(1-Ce/Ae,He,1,kt),we.data,Ae,de,Ae,It),Y===Ae-1&&this._addTileFeatures(we.range(0,He,Ce/Ae,kt),we.data,-1,de,Ae,It),It.features.length?It:null}getClusterExpansionZoom(X){let Y=this._getOriginZoom(X)-1;for(;Y<=this.options.maxZoom;){const de=this.getChildren(X);if(Y++,de.length!==1)break;X=de[0].properties.cluster_id}return Y}_appendLeaves(X,Y,de,we,Ae){const Fe=this.getChildren(Y);for(const Re of Fe){const Ce=Re.properties;if(Ce&&Ce.cluster?Ae+Ce.point_count<=we?Ae+=Ce.point_count:Ae=this._appendLeaves(X,Ce.cluster_id,de,we,Ae):Ae<we?Ae++:X.push(Re),X.length===de)break}return Ae}_createTree(X){const Y=new i.KDBush(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<X.length;de+=this.stride)Y.add(X[de],X[de+1]);return Y.finish(),Y.data=X,Y}_addTileFeatures(X,Y,de,we,Ae,Fe){for(const Re of X){const Ce=Re*this.stride,He=Y[Ce+et]>1;let kt,It,xt;if(He)kt=lr(Y,Ce,this.clusterProps),It=Y[Ce],xt=Y[Ce+1];else{const gr=this.points[Y[Ce+ve]];kt=gr.properties;const[vr,Nr]=gr.geometry.coordinates;It=zr(vr),xt=lt(Nr)}const yr={type:1,geometry:[[Math.round(this.options.extent*(It*Ae-de)),Math.round(this.options.extent*(xt*Ae-we))]],tags:kt};let xr;xr=He||this.options.generateId?Y[Ce+ve]:this.points[Y[Ce+ve]].id,xr!==void 0&&(yr.id=xr),Fe.features.push(yr)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,Y){const{radius:de,extent:we,reduce:Ae,minPoints:Fe}=this.options,Re=de/(we*Math.pow(2,Y)),Ce=X.data,He=[],kt=this.stride;for(let It=0;It<Ce.length;It+=kt){if(Ce[It+2]<=Y)continue;Ce[It+2]=Y;const xt=Ce[It],yr=Ce[It+1],xr=X.within(Ce[It],Ce[It+1],Re),gr=Ce[It+et];let vr=gr;for(const Nr of xr){const Tn=Nr*kt;Ce[Tn+2]>Y&&(vr+=Ce[Tn+et])}if(vr>gr&&vr>=Fe){let Nr,Tn=xt*gr,$n=yr*gr,Si=-1;const _n=((It/kt|0)<<5)+(Y+1)+this.points.length;for(const Rs of xr){const ri=Rs*kt;if(Ce[ri+2]<=Y)continue;Ce[ri+2]=Y;const Di=Ce[ri+et];Tn+=Ce[ri]*Di,$n+=Ce[ri+1]*Di,Ce[ri+4]=_n,Ae&&(Nr||(Nr=this._map(Ce,It,!0),Si=this.clusterProps.length,this.clusterProps.push(Nr)),Ae(Nr,this._map(Ce,ri)))}Ce[It+4]=_n,He.push(Tn/vr,$n/vr,1/0,_n,-1,vr),Ae&&He.push(Si)}else{for(let Nr=0;Nr<kt;Nr++)He.push(Ce[It+Nr]);if(vr>1)for(const Nr of xr){const Tn=Nr*kt;if(!(Ce[Tn+2]<=Y)){Ce[Tn+2]=Y;for(let $n=0;$n<kt;$n++)He.push(Ce[Tn+$n])}}}}return He}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,Y,de){if(X[Y+et]>1){const Fe=this.clusterProps[X[Y+Ut]];return de?Object.assign({},Fe):Fe}const we=this.points[X[Y+ve]].properties,Ae=this.options.map(we);return de&&Ae===we?Object.assign({},Ae):Ae}}function pr(pe,X,Y){return{type:"Feature",id:pe[X+ve],properties:lr(pe,X,Y),geometry:{type:"Point",coordinates:[(de=pe[X],360*(de-.5)),hr(pe[X+1])]}};var de}function lr(pe,X,Y){const de=pe[X+et],we=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,Ae=pe[X+Ut],Fe=Ae===-1?{}:Object.assign({},Y[Ae]);return Object.assign(Fe,{cluster:!0,cluster_id:pe[X+ve],point_count:de,point_count_abbreviated:we})}function zr(pe){return pe/360+.5}function lt(pe){const X=Math.sin(pe*Math.PI/180),Y=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Y<0?0:Y>1?1:Y}function hr(pe){const X=(180-360*pe)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function ir(pe,X,Y,de){for(var we,Ae=de,Fe=Y-X>>1,Re=Y-X,Ce=pe[X],He=pe[X+1],kt=pe[Y],It=pe[Y+1],xt=X+3;xt<Y;xt+=3){var yr=Vn(pe[xt],pe[xt+1],Ce,He,kt,It);if(yr>Ae)we=xt,Ae=yr;else if(yr===Ae){var xr=Math.abs(xt-Fe);xr<Re&&(we=xt,Re=xr)}}Ae>de&&(we-X>3&&ir(pe,X,we,de),pe[we+2]=Ae,Y-we>3&&ir(pe,we,Y,de))}function Vn(pe,X,Y,de,we,Ae){var Fe=we-Y,Re=Ae-de;if(Fe!==0||Re!==0){var Ce=((pe-Y)*Fe+(X-de)*Re)/(Fe*Fe+Re*Re);Ce>1?(Y=we,de=Ae):Ce>0&&(Y+=Fe*Ce,de+=Re*Ce)}return(Fe=pe-Y)*Fe+(Re=X-de)*Re}function Yt(pe,X,Y,de){var we={id:pe===void 0?null:pe,type:X,geometry:Y,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return(function(Ae){var Fe=Ae.geometry,Re=Ae.type;if(Re==="Point"||Re==="MultiPoint"||Re==="LineString")ei(Ae,Fe);else if(Re==="Polygon"||Re==="MultiLineString")for(var Ce=0;Ce<Fe.length;Ce++)ei(Ae,Fe[Ce]);else if(Re==="MultiPolygon")for(Ce=0;Ce<Fe.length;Ce++)for(var He=0;He<Fe[Ce].length;He++)ei(Ae,Fe[Ce][He])})(we),we}function ei(pe,X){for(var Y=0;Y<X.length;Y+=3)pe.minX=Math.min(pe.minX,X[Y]),pe.minY=Math.min(pe.minY,X[Y+1]),pe.maxX=Math.max(pe.maxX,X[Y]),pe.maxY=Math.max(pe.maxY,X[Y+1])}function Rn(pe,X,Y,de){if(X.geometry){var we=X.geometry.coordinates,Ae=X.geometry.type,Fe=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),Re=[],Ce=X.id;if(Y.promoteId?Ce=X.properties[Y.promoteId]:Y.generateId&&(Ce=de||0),Ae==="Point")nn(we,Re);else if(Ae==="MultiPoint")for(var He=0;He<we.length;He++)nn(we[He],Re);else if(Ae==="LineString")Gr(we,Re,Fe,!1);else if(Ae==="MultiLineString"){if(Y.lineMetrics){for(He=0;He<we.length;He++)Gr(we[He],Re=[],Fe,!1),pe.push(Yt(Ce,"LineString",Re,X.properties));return}sn(we,Re,Fe,!1)}else if(Ae==="Polygon")sn(we,Re,Fe,!0);else{if(Ae!=="MultiPolygon"){if(Ae==="GeometryCollection"){for(He=0;He<X.geometry.geometries.length;He++)Rn(pe,{id:Ce,geometry:X.geometry.geometries[He],properties:X.properties},Y,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(He=0;He<we.length;He++){var kt=[];sn(we[He],kt,Fe,!0),Re.push(kt)}}pe.push(Yt(Ce,Ae,Re,X.properties))}}function nn(pe,X){X.push(za(pe[0])),X.push(ts(pe[1])),X.push(0)}function Gr(pe,X,Y,de){for(var we,Ae,Fe=0,Re=0;Re<pe.length;Re++){var Ce=za(pe[Re][0]),He=ts(pe[Re][1]);X.push(Ce),X.push(He),X.push(0),Re>0&&(Fe+=de?(we*He-Ce*Ae)/2:Math.sqrt(Math.pow(Ce-we,2)+Math.pow(He-Ae,2))),we=Ce,Ae=He}var kt=X.length-3;X[2]=1,ir(X,0,kt,Y),X[kt+2]=1,X.size=Math.abs(Fe),X.start=0,X.end=X.size}function sn(pe,X,Y,de){for(var we=0;we<pe.length;we++){var Ae=[];Gr(pe[we],Ae,Y,de),X.push(Ae)}}function za(pe){return pe/360+.5}function ts(pe){var X=Math.sin(pe*Math.PI/180),Y=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Y<0?0:Y>1?1:Y}function ti(pe,X,Y,de,we,Ae,Fe,Re){if(de/=X,Ae>=(Y/=X)&&Fe<de)return pe;if(Fe<Y||Ae>=de)return null;for(var Ce=[],He=0;He<pe.length;He++){var kt=pe[He],It=kt.geometry,xt=kt.type,yr=we===0?kt.minX:kt.minY,xr=we===0?kt.maxX:kt.maxY;if(yr>=Y&&xr<de)Ce.push(kt);else if(!(xr<Y||yr>=de)){var gr=[];if(xt==="Point"||xt==="MultiPoint")gs(It,gr,Y,de,we);else if(xt==="LineString")Js(It,gr,Y,de,we,!1,Re.lineMetrics);else if(xt==="MultiLineString")dr(It,gr,Y,de,we,!1);else if(xt==="Polygon")dr(It,gr,Y,de,we,!0);else if(xt==="MultiPolygon")for(var vr=0;vr<It.length;vr++){var Nr=[];dr(It[vr],Nr,Y,de,we,!0),Nr.length&&gr.push(Nr)}if(gr.length){if(Re.lineMetrics&&xt==="LineString"){for(vr=0;vr<gr.length;vr++)Ce.push(Yt(kt.id,xt,gr[vr],kt.tags));continue}xt!=="LineString"&&xt!=="MultiLineString"||(gr.length===1?(xt="LineString",gr=gr[0]):xt="MultiLineString"),xt!=="Point"&&xt!=="MultiPoint"||(xt=gr.length===3?"Point":"MultiPoint"),Ce.push(Yt(kt.id,xt,gr,kt.tags))}}}return Ce.length?Ce:null}function gs(pe,X,Y,de,we){for(var Ae=0;Ae<pe.length;Ae+=3){var Fe=pe[Ae+we];Fe>=Y&&Fe<=de&&(X.push(pe[Ae]),X.push(pe[Ae+1]),X.push(pe[Ae+2]))}}function Js(pe,X,Y,de,we,Ae,Fe){for(var Re,Ce,He=_t(pe),kt=we===0?qt:An,It=pe.start,xt=0;xt<pe.length-3;xt+=3){var yr=pe[xt],xr=pe[xt+1],gr=pe[xt+2],vr=pe[xt+3],Nr=pe[xt+4],Tn=we===0?yr:xr,$n=we===0?vr:Nr,Si=!1;Fe&&(Re=Math.sqrt(Math.pow(yr-vr,2)+Math.pow(xr-Nr,2))),Tn<Y?$n>Y&&(Ce=kt(He,yr,xr,vr,Nr,Y),Fe&&(He.start=It+Re*Ce)):Tn>de?$n<de&&(Ce=kt(He,yr,xr,vr,Nr,de),Fe&&(He.start=It+Re*Ce)):Br(He,yr,xr,gr),$n<Y&&Tn>=Y&&(Ce=kt(He,yr,xr,vr,Nr,Y),Si=!0),$n>de&&Tn<=de&&(Ce=kt(He,yr,xr,vr,Nr,de),Si=!0),!Ae&&Si&&(Fe&&(He.end=It+Re*Ce),X.push(He),He=_t(pe)),Fe&&(It+=Re)}var _n=pe.length-3;yr=pe[_n],xr=pe[_n+1],gr=pe[_n+2],(Tn=we===0?yr:xr)>=Y&&Tn<=de&&Br(He,yr,xr,gr),_n=He.length-3,Ae&&_n>=3&&(He[_n]!==He[0]||He[_n+1]!==He[1])&&Br(He,He[0],He[1],He[2]),He.length&&X.push(He)}function _t(pe){var X=[];return X.size=pe.size,X.start=pe.start,X.end=pe.end,X}function dr(pe,X,Y,de,we,Ae){for(var Fe=0;Fe<pe.length;Fe++)Js(pe[Fe],X,Y,de,we,Ae,!1)}function Br(pe,X,Y,de){pe.push(X),pe.push(Y),pe.push(de)}function qt(pe,X,Y,de,we,Ae){var Fe=(Ae-X)/(de-X);return pe.push(Ae),pe.push(Y+(we-Y)*Fe),pe.push(1),Fe}function An(pe,X,Y,de,we,Ae){var Fe=(Ae-Y)/(we-Y);return pe.push(X+(de-X)*Fe),pe.push(Ae),pe.push(1),Fe}function Wr(pe,X){for(var Y=[],de=0;de<pe.length;de++){var we,Ae=pe[de],Fe=Ae.type;if(Fe==="Point"||Fe==="MultiPoint"||Fe==="LineString")we=ui(Ae.geometry,X);else if(Fe==="MultiLineString"||Fe==="Polygon"){we=[];for(var Re=0;Re<Ae.geometry.length;Re++)we.push(ui(Ae.geometry[Re],X))}else if(Fe==="MultiPolygon")for(we=[],Re=0;Re<Ae.geometry.length;Re++){for(var Ce=[],He=0;He<Ae.geometry[Re].length;He++)Ce.push(ui(Ae.geometry[Re][He],X));we.push(Ce)}Y.push(Yt(Ae.id,Fe,we,Ae.tags))}return Y}function ui(pe,X){var Y=[];Y.size=pe.size,pe.start!==void 0&&(Y.start=pe.start,Y.end=pe.end);for(var de=0;de<pe.length;de+=3)Y.push(pe[de]+X,pe[de+1],pe[de+2]);return Y}function En(pe,X){if(pe.transformed)return pe;var Y,de,we,Ae=1<<pe.z,Fe=pe.x,Re=pe.y;for(Y=0;Y<pe.features.length;Y++){var Ce=pe.features[Y],He=Ce.geometry,kt=Ce.type;if(Ce.geometry=[],kt===1)for(de=0;de<He.length;de+=2)Ce.geometry.push(xn(He[de],He[de+1],X,Ae,Fe,Re));else for(de=0;de<He.length;de++){var It=[];for(we=0;we<He[de].length;we+=2)It.push(xn(He[de][we],He[de][we+1],X,Ae,Fe,Re));Ce.geometry.push(It)}}return pe.transformed=!0,pe}function xn(pe,X,Y,de,we,Ae){return[Math.round(Y*(pe*de-we)),Math.round(Y*(X*de-Ae))]}function Xo(pe,X,Y,de,we){for(var Ae=X===we.maxZoom?0:we.tolerance/((1<<X)*we.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:de,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Re=0;Re<pe.length;Re++){Fe.numFeatures++,Ko(Fe,pe[Re],Ae,we);var Ce=pe[Re].minX,He=pe[Re].minY,kt=pe[Re].maxX,It=pe[Re].maxY;Ce<Fe.minX&&(Fe.minX=Ce),He<Fe.minY&&(Fe.minY=He),kt>Fe.maxX&&(Fe.maxX=kt),It>Fe.maxY&&(Fe.maxY=It)}return Fe}function Ko(pe,X,Y,de){var we=X.geometry,Ae=X.type,Fe=[];if(Ae==="Point"||Ae==="MultiPoint")for(var Re=0;Re<we.length;Re+=3)Fe.push(we[Re]),Fe.push(we[Re+1]),pe.numPoints++,pe.numSimplified++;else if(Ae==="LineString")Ba(Fe,we,pe,Y,!1,!1);else if(Ae==="MultiLineString"||Ae==="Polygon")for(Re=0;Re<we.length;Re++)Ba(Fe,we[Re],pe,Y,Ae==="Polygon",Re===0);else if(Ae==="MultiPolygon")for(var Ce=0;Ce<we.length;Ce++){var He=we[Ce];for(Re=0;Re<He.length;Re++)Ba(Fe,He[Re],pe,Y,!0,Re===0)}if(Fe.length){var kt=X.tags||null;if(Ae==="LineString"&&de.lineMetrics){for(var It in kt={},X.tags)kt[It]=X.tags[It];kt.mapbox_clip_start=we.start/we.size,kt.mapbox_clip_end=we.end/we.size}var xt={geometry:Fe,type:Ae==="Polygon"||Ae==="MultiPolygon"?3:Ae==="LineString"||Ae==="MultiLineString"?2:1,tags:kt};X.id!==null&&(xt.id=X.id),pe.features.push(xt)}}function Ba(pe,X,Y,de,we,Ae){var Fe=de*de;if(de>0&&X.size<(we?Fe:de))Y.numPoints+=X.length/3;else{for(var Re=[],Ce=0;Ce<X.length;Ce+=3)(de===0||X[Ce+2]>Fe)&&(Y.numSimplified++,Re.push(X[Ce]),Re.push(X[Ce+1])),Y.numPoints++;we&&(function(He,kt){for(var It=0,xt=0,yr=He.length,xr=yr-2;xt<yr;xr=xt,xt+=2)It+=(He[xt]-He[xr])*(He[xt+1]+He[xr+1]);if(It>0===kt)for(xt=0,yr=He.length;xt<yr/2;xt+=2){var gr=He[xt],vr=He[xt+1];He[xt]=He[yr-2-xt],He[xt+1]=He[yr-1-xt],He[yr-2-xt]=gr,He[yr-1-xt]=vr}})(Re,Ae),pe.push(Re)}}function Fa(pe,X){var Y=(X=this.options=(function(we,Ae){for(var Fe in Ae)we[Fe]=Ae[Fe];return we})(Object.create(this.options),X)).debug;if(Y&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var de=(function(we,Ae){var Fe=[];if(we.type==="FeatureCollection")for(var Re=0;Re<we.features.length;Re++)Rn(Fe,we.features[Re],Ae,Re);else Rn(Fe,we.type==="Feature"?we:{geometry:we},Ae);return Fe})(pe,X);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=(function(we,Ae){var Fe=Ae.buffer/Ae.extent,Re=we,Ce=ti(we,1,-1-Fe,Fe,0,-1,2,Ae),He=ti(we,1,1-Fe,2+Fe,0,-1,2,Ae);return(Ce||He)&&(Re=ti(we,1,-Fe,1+Fe,0,-1,2,Ae)||[],Ce&&(Re=Wr(Ce,1).concat(Re)),He&&(Re=Re.concat(Wr(He,-1)))),Re})(de,X),de.length&&this.splitTile(de,0,0,0),Y&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ya(pe,X,Y){return 32*((1<<pe)*Y+X)+pe}function xa(pe,X){const Y=pe.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);const de=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!de)return X(null,null);const we=new class{constructor(Fe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.EXTENT,this.length=Fe.length,this._features=Fe}feature(Fe){return new class{constructor(Re){this._feature=Re,this.extent=i.EXTENT,this.type=Re.type,this.properties=Re.tags,"id"in Re&&!isNaN(Re.id)&&(this.id=parseInt(Re.id,10))}loadGeometry(){if(this._feature.type===1){const Re=[];for(const Ce of this._feature.geometry)Re.push([new i.Point(Ce[0],Ce[1])]);return Re}{const Re=[];for(const Ce of this._feature.geometry){const He=[];for(const kt of Ce)He.push(new i.Point(kt[0],kt[1]));Re.push(He)}return Re}}toGeoJSON(Re,Ce,He){return Me.call(this,Re,Ce,He)}}(this._features[Fe])}}(de.features);let Ae=Ht(we);Ae.byteOffset===0&&Ae.byteLength===Ae.buffer.byteLength||(Ae=new Uint8Array(Ae)),X(null,{vectorTile:we,rawData:Ae.buffer})}Fa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Fa.prototype.splitTile=function(pe,X,Y,de,we,Ae,Fe){for(var Re=[pe,X,Y,de],Ce=this.options,He=Ce.debug;Re.length;){de=Re.pop(),Y=Re.pop(),X=Re.pop(),pe=Re.pop();var kt=1<<X,It=ya(X,Y,de),xt=this.tiles[It];if(!xt&&(He>1&&console.time("creation"),xt=this.tiles[It]=Xo(pe,X,Y,de,Ce),this.tileCoords.push({z:X,x:Y,y:de}),He)){He>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,Y,de,xt.numFeatures,xt.numPoints,xt.numSimplified),console.timeEnd("creation"));var yr="z"+X;this.stats[yr]=(this.stats[yr]||0)+1,this.total++}if(xt.source=pe,we){if(X===Ce.maxZoom||X===we)continue;var xr=1<<we-X;if(Y!==Math.floor(Ae/xr)||de!==Math.floor(Fe/xr))continue}else if(X===Ce.indexMaxZoom||xt.numPoints<=Ce.indexMaxPoints)continue;if(xt.source=null,pe.length!==0){He>1&&console.time("clipping");var gr,vr,Nr,Tn,$n,Si,_n=.5*Ce.buffer/Ce.extent,Rs=.5-_n,ri=.5+_n,Di=1+_n;gr=vr=Nr=Tn=null,$n=ti(pe,kt,Y-_n,Y+ri,0,xt.minX,xt.maxX,Ce),Si=ti(pe,kt,Y+Rs,Y+Di,0,xt.minX,xt.maxX,Ce),pe=null,$n&&(gr=ti($n,kt,de-_n,de+ri,1,xt.minY,xt.maxY,Ce),vr=ti($n,kt,de+Rs,de+Di,1,xt.minY,xt.maxY,Ce),$n=null),Si&&(Nr=ti(Si,kt,de-_n,de+ri,1,xt.minY,xt.maxY,Ce),Tn=ti(Si,kt,de+Rs,de+Di,1,xt.minY,xt.maxY,Ce),Si=null),He>1&&console.timeEnd("clipping"),Re.push(gr||[],X+1,2*Y,2*de),Re.push(vr||[],X+1,2*Y,2*de+1),Re.push(Nr||[],X+1,2*Y+1,2*de),Re.push(Tn||[],X+1,2*Y+1,2*de+1)}}},Fa.prototype.getTile=function(pe,X,Y){var de=this.options,we=de.extent,Ae=de.debug;if(pe<0||pe>24)return null;var Fe=1<<pe,Re=ya(pe,X=(X%Fe+Fe)%Fe,Y);if(this.tiles[Re])return En(this.tiles[Re],we);Ae>1&&console.log("drilling down to z%d-%d-%d",pe,X,Y);for(var Ce,He=pe,kt=X,It=Y;!Ce&&He>0;)He--,kt=Math.floor(kt/2),It=Math.floor(It/2),Ce=this.tiles[ya(He,kt,It)];return Ce&&Ce.source?(Ae>1&&console.log("found parent tile z%d-%d-%d",He,kt,It),Ae>1&&console.time("drilling down"),this.splitTile(Ce.source,He,kt,It,pe,X,Y),Ae>1&&console.timeEnd("drilling down"),this.tiles[Re]?En(this.tiles[Re],we):null):null};class Oa extends i.VectorTileWorkerSource{constructor(X,Y,de,we,Ae){super(X,Y,de,we,xa),Ae&&(this.loadGeoJSON=Ae)}loadData(X,Y){const de=X&&X.request,we=de&&de.collectResourceTiming;this.loadGeoJSON(X,((Ae,Fe)=>{if(Ae||!Fe)return Y(Ae);if(typeof Fe!="object")return Y(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{ye(Fe,!0);try{if(X.filter){const Ce=i.createExpression(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ce.result==="error")throw new Error(Ce.value.map((kt=>`${kt.key}: ${kt.message}`)).join(", "));Fe={type:"FeatureCollection",features:Fe.features.filter((kt=>Ce.value.evaluate({zoom:0},kt)))}}this._geoJSONIndex=X.cluster?new Ot((function({superclusterOptions:Ce,clusterProperties:He}){if(!He||!Ce)return Ce;const kt={},It={},xt={accumulated:null,zoom:0},yr={properties:null},xr=Object.keys(He);for(const gr of xr){const[vr,Nr]=He[gr],Tn=i.createExpression(Nr),$n=i.createExpression(typeof vr=="string"?[vr,["accumulated"],["get",gr]]:vr);kt[gr]=Tn.value,It[gr]=$n.value}return Ce.map=gr=>{yr.properties=gr;const vr={};for(const Nr of xr)vr[Nr]=kt[Nr].evaluate(xt,yr);return vr},Ce.reduce=(gr,vr)=>{yr.properties=vr;for(const Nr of xr)xt.accumulated=gr[Nr],gr[Nr]=It[Nr].evaluate(xt,yr)},Ce})(X)).load(Fe.features):(function(Ce,He){return new Fa(Ce,He)})(Fe,X.geojsonVtOptions)}catch(Ce){return Y(Ce)}this.loaded={};const Re={};if(we){const Ce=i.getPerformanceMeasurement(de);Ce&&(Re.resourceTiming={},Re.resourceTiming[X.source]=JSON.parse(JSON.stringify(Ce)))}Y(null,Re)}}))}reloadTile(X,Y){const de=this.loaded;return de&&de[X.uid]?super.reloadTile(X,Y):this.loadTile(X,Y)}loadGeoJSON(X,Y){if(X.request)i.getJSON(X.request,Y);else{if(typeof X.data!="string")return Y(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));try{return Y(null,JSON.parse(X.data))}catch{return Y(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(X,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(de){Y(de)}}getClusterChildren(X,Y){try{Y(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(de){Y(de)}}getClusterLeaves(X,Y){try{Y(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(de){Y(de)}}}class Yo{constructor(X){this.self=X,this.actor=new i.Actor(X,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=i.getProjection({name:"mercator"}),this.workerSourceTypes={vector:i.VectorTileWorkerSource,geojson:Oa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Y,de)=>{if(this.workerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.workerSourceTypes[Y]=de},this.self.registerRTLTextPlugin=Y=>{if(i.plugin.isParsed())throw new Error("RTL text plugin already registered.");i.plugin.applyArabicShaping=Y.applyArabicShaping,i.plugin.processBidirectionalText=Y.processBidirectionalText,i.plugin.processStyledBidirectionalText=Y.processStyledBidirectionalText}}clearCaches(X,Y,de){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],de()}checkIfReady(X,Y,de){de()}setReferrer(X,Y){this.referrer=Y}spriteLoaded(X,Y){this.isSpriteLoaded[X]=Y;for(const de in this.workerSources[X]){const we=this.workerSources[X][de];for(const Ae in we)we[Ae]instanceof i.VectorTileWorkerSource&&(we[Ae].isSpriteLoaded=Y,we[Ae].fire(new i.Event("isSpriteLoaded")))}}setImages(X,Y,de){this.availableImages[X]=Y;for(const we in this.workerSources[X]){const Ae=this.workerSources[X][we];for(const Fe in Ae)Ae[Fe].availableImages=Y}de()}enableTerrain(X,Y,de){this.terrain=Y,de()}setProjection(X,Y){this.projections[X]=i.getProjection(Y)}setLayers(X,Y,de){this.getLayerIndex(X).replace(Y),de()}updateLayers(X,Y,de){this.getLayerIndex(X).update(Y.layers,Y.removedIds),de()}loadTile(X,Y,de){const we=this.enableTerrain?i.extend({enableTerrain:this.terrain},Y):Y;we.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,Y.type,Y.source).loadTile(we,de)}loadDEMTile(X,Y,de){const we=this.enableTerrain?i.extend({buildQuadTree:this.terrain},Y):Y;this.getDEMWorkerSource(X,Y.source).loadTile(we,de)}reloadTile(X,Y,de){const we=this.enableTerrain?i.extend({enableTerrain:this.terrain},Y):Y;we.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,Y.type,Y.source).reloadTile(we,de)}abortTile(X,Y,de){this.getWorkerSource(X,Y.type,Y.source).abortTile(Y,de)}removeTile(X,Y,de){this.getWorkerSource(X,Y.type,Y.source).removeTile(Y,de)}removeSource(X,Y,de){if(!this.workerSources[X]||!this.workerSources[X][Y.type]||!this.workerSources[X][Y.type][Y.source])return;const we=this.workerSources[X][Y.type][Y.source];delete this.workerSources[X][Y.type][Y.source],we.removeSource!==void 0?we.removeSource(Y,de):de()}loadWorkerSource(X,Y,de){try{this.self.importScripts(Y.url),de()}catch(we){de(we.toString())}}syncRTLPluginState(X,Y,de){try{i.plugin.setState(Y);const we=i.plugin.getPluginURL();if(i.plugin.isLoaded()&&!i.plugin.isParsed()&&we!=null){this.self.importScripts(we);const Ae=i.plugin.isParsed();de(Ae?void 0:new Error(`RTL Text Plugin failed to import scripts from ${we}`),Ae)}}catch(we){de(we.toString())}}getAvailableImages(X){let Y=this.availableImages[X];return Y||(Y=[]),Y}getLayerIndex(X){let Y=this.layerIndexes[X];return Y||(Y=this.layerIndexes[X]=new K),Y}getWorkerSource(X,Y,de){if(this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][Y]||(this.workerSources[X][Y]={}),!this.workerSources[X][Y][de]){const we={send:(Ae,Fe,Re,Ce,He,kt)=>{this.actor.send(Ae,Fe,Re,X,He,kt)},scheduler:this.actor.scheduler};this.workerSources[X][Y][de]=new this.workerSourceTypes[Y](we,this.getLayerIndex(X),this.getAvailableImages(X),this.isSpriteLoaded[X])}return this.workerSources[X][Y][de]}getDEMWorkerSource(X,Y){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][Y]||(this.demWorkerSources[X][Y]=new Z),this.demWorkerSources[X][Y]}enforceCacheSizeLimit(X,Y){i.enforceCacheSizeLimit(Y)}getWorkerPerformanceMetrics(X,Y,de){de(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Yo(self)),Yo})),I(["./shared"],(function(i){function R(d,n){if(Array.isArray(d)){if(!Array.isArray(n)||d.length!==n.length)return!1;for(let o=0;o<d.length;o++)if(!R(d[o],n[o]))return!1;return!0}if(typeof d=="object"&&d!==null&&n!==null){if(typeof n!="object"||Object.keys(d).length!==Object.keys(n).length)return!1;for(const o in d)if(!R(d[o],n[o]))return!1;return!0}return d===n}var $=K;function K(d){return!(function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,x,b=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(b);try{x=new Worker(C),f=!0}catch{f=!1}return x&&x.terminate(),URL.revokeObjectURL(C),f})()?"Uint8ClampedArray"in window?ArrayBuffer.isView?(function(){var f=document.createElement("canvas");f.width=f.height=1;var x=f.getContext("2d");if(!x)return!1;var b=x.getImageData(0,0,1,1);return b&&b.width===f.width})()?(Z[o=n&&n.failIfMajorPerformanceCaveat]===void 0&&(Z[o]=(function(f){var x,b=(function(C){var M=document.createElement("canvas"),j=Object.create(K.webGLContextAttributes);return j.failIfMajorPerformanceCaveat=C,M.getContext("webgl",j)||M.getContext("experimental-webgl",j)})(f);if(!b)return!1;try{x=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!x||b.isContextLost())&&(b.shaderSource(x,"void main() {}"),b.compileShader(x),b.getShaderParameter(x,b.COMPILE_STATUS)===!0)})(o)),Z[o]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var o})(d)}var Z={};function he(d,n,o){const f=i.window.document.createElement(d);return n!==void 0&&(f.className=n),o&&o.appendChild(f),f}function Te(d,n,o){const f=i.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const x of Object.keys(n))f.setAttributeNS(null,x,n[x]);return o&&o.appendChild(f),f}K.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ye=i.window.document&&i.window.document.documentElement.style,Me=ye&&ye.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Le;function De(){ye&&Me&&(Le=ye[Me],ye[Me]="none")}function Qe(){ye&&Me&&(ye[Me]=Le)}function dt(d){d.preventDefault(),d.stopPropagation(),i.window.removeEventListener("click",dt,!0)}function St(){i.window.addEventListener("click",dt,!0),i.window.setTimeout((()=>{i.window.removeEventListener("click",dt,!0)}),0)}function ce(d,n){const o=d.getBoundingClientRect();return Ye(d,o,n)}function $e(d,n){const o=d.getBoundingClientRect(),f=[];for(let x=0;x<n.length;x++)f.push(Ye(d,o,n[x]));return f}function Ge(d){return i.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&i.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function Ye(d,n,o){const f=d.offsetWidth===n.width?1:d.offsetWidth/n.width;return new i.Point((o.clientX-n.left)*f,(o.clientY-n.top)*f)}function ge(d,n){var o=n[0],f=n[1],x=n[2],b=n[3],C=o*b-x*f;return C?(d[0]=b*(C=1/C),d[1]=-f*C,d[2]=-x*C,d[3]=o*C,d):null}function Pt(d){const{userImage:n}=d;return!!(n&&n.render&&n.render())&&(d.data.replace(new Uint8Array(n.data.buffer)),!0)}class tt extends i.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new i.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:o,callback:f}of this.requestors)this._notify(o,f);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,o){this._validate(n,o)&&(this.images[n]=o)}_validate(n,o){let f=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new i.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),f=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new i.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),f=!1),this._validateContent(o.content,o)||(this.fire(new i.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),f=!1),f}_validateStretch(n,o){if(!n)return!0;let f=0;for(const x of n){if(x[0]<f||x[1]<x[0]||o<x[1])return!1;f=x[1]}return!0}_validateContent(n,o){return!(n&&(n.length!==4||n[0]<0||o.data.width<n[0]||n[1]<0||o.data.height<n[1]||n[2]<0||o.data.width<n[2]||n[3]<0||o.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,o){o.version=this.images[n].version+1,this.images[n]=o,this.updatedImages[n]=!0}removeImage(n){const o=this.images[n];delete this.images[n],delete this.patterns[n],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,o){let f=!0;if(!this.isLoaded())for(const x of n)this.images[x]||(f=!1);this.isLoaded()||f?this._notify(n,o):this.requestors.push({ids:n,callback:o})}_notify(n,o){const f={};for(const x of n){this.images[x]||this.fire(new i.Event("styleimagemissing",{id:x}));const b=this.images[x];b?f[x]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:i.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,f)}getPixelSize(){const{width:n,height:o}=this.atlasImage;return{width:n,height:o}}getPattern(n){const o=this.patterns[n],f=this.getImage(n);if(!f)return null;if(o&&o.position.version===f.version)return o.position;if(o)o.position.version=f.version;else{const x={w:f.data.width+2,h:f.data.height+2,x:0,y:0},b=new i.ImagePosition(x,f);this.patterns[n]={bin:x,position:b}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const o=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new i.Texture(n,this.atlasImage,o.RGBA),this.atlasTexture&&this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const b in this.patterns)n.push(this.patterns[b].bin);const{w:o,h:f}=i.potpack(n),x=this.atlasImage;x.resize({width:o||1,height:f||1});for(const b in this.patterns){const{bin:C}=this.patterns[b],M=C.x+1,j=C.y+1,F=this.images[b].data,z=F.width,G=F.height;i.RGBAImage.copy(F,x,{x:0,y:0},{x:M,y:j},{width:z,height:G}),i.RGBAImage.copy(F,x,{x:0,y:G-1},{x:M,y:j-1},{width:z,height:1}),i.RGBAImage.copy(F,x,{x:0,y:0},{x:M,y:j+G},{width:z,height:1}),i.RGBAImage.copy(F,x,{x:z-1,y:0},{x:M-1,y:j},{width:1,height:G}),i.RGBAImage.copy(F,x,{x:0,y:0},{x:M+z,y:j},{width:1,height:G})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const o of n){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const f=this.images[o];Pt(f)&&this.updateImage(o,f)}}}const ct=new i.Properties({anchor:new i.DataConstantProperty(i.spec.light.anchor),position:new class{constructor(){this.specification=i.spec.light.position}possiblyEvaluate(d,n){return(function([o,f,x]){const b=i.degToRad(f+90),C=i.degToRad(x);return{x:o*Math.cos(b)*Math.sin(C),y:o*Math.sin(b)*Math.sin(C),z:o*Math.cos(C),azimuthal:f,polar:x}})(d.expression.evaluate(n))}interpolate(d,n,o){return{x:i.number(d.x,n.x,o),y:i.number(d.y,n.y,o),z:i.number(d.z,n.z,o),azimuthal:i.number(d.azimuthal,n.azimuthal,o),polar:i.number(d.polar,n.polar,o)}}},color:new i.DataConstantProperty(i.spec.light.color),intensity:new i.DataConstantProperty(i.spec.light.intensity)});class Kt extends i.Evented{constructor(n){super(),this._transitionable=new i.Transitionable(ct),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,o={}){if(!this._validate(i.validateLight,n,o))for(const f in n){const x=n[f];i.endsWith(f,"-transition")?this._transitionable.setTransition(f.slice(0,-11),x):this._transitionable.setValue(f,x)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,o,f){return(!f||f.validate!==!1)&&i.emitValidationErrors(this,n.call(i.validateStyle,i.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.spec})))}}const Mr=new i.Properties({source:new i.DataConstantProperty(i.spec.terrain.source),exaggeration:new i.DataConstantProperty(i.spec.terrain.exaggeration)});let Jt=class extends i.Evented{constructor(d,n){super(),this._transitionable=new i.Transitionable(Mr),this.set(d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(d){for(const n in d){const o=d[n];i.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-11),o):this._transitionable.setValue(n,o)}}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}};function Ht(d,n,o,f){const x=i.smoothstep(45,65,o),[b,C]=Tt(d,f),M=i.length(n);let j=1-Math.min(1,Math.exp((M-b)/(C-b)*-6));return j*=j*j,j=Math.min(1,1.00747*j),j*x*d.alpha}function Tt(d,n){const o=.5/Math.tan(.5*n);return[d.range[0]+o,d.range[1]+o]}const Be=new i.Properties({range:new i.DataConstantProperty(i.spec.fog.range),color:new i.DataConstantProperty(i.spec.fog.color),"high-color":new i.DataConstantProperty(i.spec.fog["high-color"]),"space-color":new i.DataConstantProperty(i.spec.fog["space-color"]),"horizon-blend":new i.DataConstantProperty(i.spec.fog["horizon-blend"]),"star-intensity":new i.DataConstantProperty(i.spec.fog["star-intensity"])});class Je extends i.Evented{constructor(n,o){super(),this._transitionable=new i.Transitionable(Be),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=o}get state(){const n=this._transform,o=n.projection.name==="globe",f=i.globeToMercatorTransition(n.zoom),x=this.properties.get("range"),b=[.5,3];return{range:o?[i.number(b[0],x[0],f),i.number(b[1],x[1],f)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,o={}){if(!this._validate(i.validateFog,n,o)){for(const f of Object.keys(i.spec.fog))n&&n[f]===void 0&&(n[f]=i.spec.fog[f].default);for(const f in n){const x=n[f];i.endsWith(f,"-transition")?this._transitionable.setTransition(f.slice(0,-11),x):this._transitionable.setValue(f,x)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.smoothstep(45,65,n))*o.a}getOpacityAtLatLng(n,o){return this._transform.projection.supportsFog?(function(f,x,b){const C=i.MercatorCoordinate.fromLngLat(x),M=b.elevation?b.elevation.getAtPointOrZero(C):0,j=[C.x,C.y,M];return i.transformMat4(j,j,b.mercatorFogMatrix),Ht(f,j,b.pitch,b._fov)})(this.state,n,o):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Tt(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,o,f){return(!f||f.validate!==!1)&&i.emitValidationErrors(this,n.call(i.validateStyle,i.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.spec})))}}class ve{constructor(n,o){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=i.uniqueId();const f=this.workerPool.acquire(this.id);for(let x=0;x<f.length;x++){const b=new ve.Actor(f[x],o,this.id);b.name=`Worker ${x}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(n,o,f){i.asyncAll(this.actors,((x,b)=>{x.send(n,o,b)}),f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((n=>{n.remove()})),this.actors=[],this.workerPool.release(this.id)}}function et(d,n,o){return n*(i.EXTENT/(d.tileSize*Math.pow(2,o-d.tileID.overscaledZ)))}ve.Actor=i.Actor;class Ut{constructor(n,o,f,x){this.screenBounds=n,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(n,o){let f,x;if(n instanceof i.Point||typeof n[0]=="number"){const b=i.Point.convert(n);f=[b],x=o.isPointAboveHorizon(b)}else{const b=i.Point.convert(n[0]),C=i.Point.convert(n[1]);f=[b,C],x=i.polygonizeBounds(b,C).every((M=>o.isPointAboveHorizon(M)))}return new Ut(f,o.getCameraPoint(),x,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return i.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const o=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new i.Point(1,1)):this.screenBounds[1],x=i.polygonizeBounds(o,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<f.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?x[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(x[3]=this.cameraPoint)),i.bufferConvexPolygon(x,n)}bufferedCameraGeometryGlobe(n){const o=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new i.Point(1,1)):this.screenBounds[1],x=i.polygonizeBounds(o,f,n),b=this.cameraPoint.clone();switch(3*((b.y>o.y)+(b.y>f.y))+((b.x>o.x)+(b.x>f.x))){case 0:x[0]=b,x[4]=b.clone();break;case 1:x.splice(1,0,b);break;case 2:x[1]=b;break;case 3:x.splice(4,0,b);break;case 5:x.splice(2,0,b);break;case 6:x[3]=b;break;case 7:x.splice(3,0,b);break;case 8:x[2]=b}return x}containsTile(n,o,f,x=0){const b=n.queryPadding/o._pixelsPerMercatorPixel+1,C=f?this._bufferedCameraMercator(b,o):this._bufferedScreenMercator(b,o);let M=n.tileID.wrap+(C.unwrapped?x:0);const j=C.polygon.map((se=>i.getTilePoint(n.tileTransform,se,M)));if(!i.polygonIntersectsBox(j,0,0,i.EXTENT,i.EXTENT))return;M=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const F=this.screenGeometryMercator.polygon.map((se=>i.getTileVec3(n.tileTransform,se,M))),z=F.map((se=>new i.Point(se[0],se[1]))),G=o.getFreeCameraOptions().position||new i.MercatorCoordinate(0,0,0),Q=i.getTileVec3(n.tileTransform,G,M),re=F.map((se=>{const W=i.sub(se,se,Q);return i.normalize(W,W),new i.Ray(Q,W)})),ie=et(n,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:re,bufferedTilespaceGeometry:j,bufferedTilespaceBounds:(ne=i.getBounds(j),ne.min.x=i.clamp(ne.min.x,0,i.EXTENT),ne.min.y=i.clamp(ne.min.y,0,i.EXTENT),ne.max.x=i.clamp(ne.max.x,0,i.EXTENT),ne.max.y=i.clamp(ne.max.y,0,i.EXTENT),ne),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:ie};var ne}_bufferedScreenMercator(n,o){const f=lr(n);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let x;return x=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),o):{polygon:this.bufferedScreenGeometry(n).map((b=>o.pointCoordinate3D(b))),unwrapped:!0},this._screenRaycastCache[f]=x,x}}_bufferedCameraMercator(n,o){const f=lr(n);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let x;return x=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),o):{polygon:this.bufferedCameraGeometry(n).map((b=>o.pointCoordinate3D(b))),unwrapped:!0},this._cameraRaycastCache[f]=x,x}}_projectAndResample(n,o){const f=(function(b,C){const M=i.multiply([],C.pixelMatrix,C.globeMatrix),j=[0,-i.GLOBE_RADIUS,0,1],F=[0,i.GLOBE_RADIUS,0,1],z=[0,0,0,1];i.transformMat4$1(j,j,M),i.transformMat4$1(F,F,M),i.transformMat4$1(z,z,M);const G=new i.Point(j[0]/j[3],j[1]/j[3]),Q=new i.Point(F[0]/F[3],F[1]/F[3]),re=i.polygonContainsPoint(b,G)&&j[3]<z[3],ie=i.polygonContainsPoint(b,Q)&&F[3]<z[3];if(!re&&!ie)return null;const ne=(function(Se,je,Ie){for(let Ve=1;Ve<Se.length;Ve++){const yt=pr(je.pointCoordinate3D(Se[Ve-1]).x),ze=pr(je.pointCoordinate3D(Se[Ve]).x);if(Ie<0){if(yt<ze)return{idx:Ve,t:-yt/(ze-1-yt)}}else if(ze<yt)return{idx:Ve,t:(1-yt)/(ze+1-yt)}}return null})(b,C,re?-1:1);if(!ne)return null;const{idx:se,t:W}=ne;let te=se>1?Ot(b.slice(0,se),C):[],le=se<b.length?Ot(b.slice(se),C):[];te=te.map((Se=>new i.Point(pr(Se.x),Se.y))),le=le.map((Se=>new i.Point(pr(Se.x),Se.y)));const ue=[...te];ue.length===0&&ue.push(le[le.length-1]);const ke=i.number(ue[ue.length-1].y,(le.length===0?te[0]:le[0]).y,W);let Ee;return Ee=re?[new i.Point(0,ke),new i.Point(0,0),new i.Point(1,0),new i.Point(1,ke)]:[new i.Point(1,ke),new i.Point(1,1),new i.Point(0,1),new i.Point(0,ke)],ue.push(...Ee),le.length===0?ue.push(te[0]):ue.push(...le),{polygon:ue.map((Se=>new i.MercatorCoordinate(Se.x,Se.y))),unwrapped:!1}})(n,o);if(f)return f;const x=(function(b,C){let M=!1,j=-1/0,F=0;for(let G=0;G<b.length-1;G++)b[G].x>j&&(j=b[G].x,F=G);for(let G=0;G<b.length-1;G++){const Q=(F+G)%(b.length-1),re=b[Q],ie=b[Q+1];Math.abs(re.x-ie.x)>.5&&(re.x<ie.x?(re.x+=1,Q===0&&(b[b.length-1].x+=1)):(ie.x+=1,Q+1===b.length-1&&(b[0].x+=1)),M=!0)}const z=i.mercatorXfromLng(C.center.lng);return M&&z<Math.abs(z-1)&&b.forEach((G=>{G.x-=1})),{polygon:b,unwrapped:M}})(Ot(n,o).map((b=>new i.Point(pr(b.x),b.y))),o);return{polygon:x.polygon.map((b=>new i.MercatorCoordinate(b.x,b.y))),unwrapped:x.unwrapped}}}function Ot(d,n){return i.resample(d,(o=>{const f=n.pointCoordinate3D(o);o.x=f.x,o.y=f.y}),1/256)}function pr(d){return d<0?1+d%1:d%1}function lr(d){return 100*d|0}function zr(d,n,o,f,x){const b=function(C,M){if(C)return x(C);if(M){d.url&&M.tiles&&d.tiles&&delete d.tiles;const j=i.pick(i.extend(M,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(j.vectorLayers=M.vector_layers,j.vectorLayerIds=j.vectorLayers.map((F=>F.id))),j.tiles=n.canonicalizeTileset(j,d.url),x(null,j)}};return d.url?i.getJSON(n.transformRequest(n.normalizeSourceURL(d.url,null,o,f),i.ResourceType.Source),b):i.exported.frame((()=>b(null,d)))}class lt{constructor(n,o,f){this.bounds=i.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=o||0,this.maxzoom=f||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const o=Math.pow(2,n.z),f=Math.floor(i.mercatorXfromLng(this.bounds.getWest())*o),x=Math.floor(i.mercatorYfromLat(this.bounds.getNorth())*o),b=Math.ceil(i.mercatorXfromLng(this.bounds.getEast())*o),C=Math.ceil(i.mercatorYfromLat(this.bounds.getSouth())*o);return n.x>=f&&n.x<b&&n.y>=x&&n.y<C}}class hr{constructor(n,o,f){this.context=n;const x=n.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ir={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vn{constructor(n,o,f,x){this.length=o.length,this.attributes=f,this.itemSize=o.bytesPerElement,this.dynamicDraw=x,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),n.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,o){for(let f=0;f<this.attributes.length;f++){const x=o.attributes[this.attributes[f].name];x!==void 0&&n.enableVertexAttribArray(x)}}setVertexAttribPointers(n,o,f){for(let x=0;x<this.attributes.length;x++){const b=this.attributes[x],C=o.attributes[b.name];C!==void 0&&n.vertexAttribPointer(C,b.components,n[ir[b.type]],!1,this.itemSize,b.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Yt{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ei extends Yt{getDefault(){return i.Color.transparent}set(n){const o=this.current;(n.r!==o.r||n.g!==o.g||n.b!==o.b||n.a!==o.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Rn extends Yt{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class nn extends Yt{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Gr extends Yt{getDefault(){return[!0,!0,!0,!0]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class sn extends Yt{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class za extends Yt{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class ts extends Yt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const o=this.current;(n.func!==o.func||n.ref!==o.ref||n.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class ti extends Yt{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class gs extends Yt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=n,this.dirty=!1}}class Js extends Yt{getDefault(){return[0,1]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class _t extends Yt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=n,this.dirty=!1}}class dr extends Yt{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Br extends Yt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.BLEND):o.disable(o.BLEND),this.current=n,this.dirty=!1}}class qt extends Yt{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class An extends Yt{getDefault(){return i.Color.transparent}set(n){const o=this.current;(n.r!==o.r||n.g!==o.g||n.b!==o.b||n.a!==o.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Wr extends Yt{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class ui extends Yt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=n,this.dirty=!1}}class En extends Yt{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class xn extends Yt{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Xo,Ko=class extends Yt{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class Ba extends Yt{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Fa extends Yt{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class ya extends Yt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class xa extends Yt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Oa extends Yt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Yo extends Yt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class pe extends Yt{getDefault(){return null}set(n){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class X extends Yt{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Y extends Yt{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class de extends Yt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class we extends Yt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Ae extends Yt{constructor(n,o){super(n),this.context=n,this.parent=o}getDefault(){return null}}class Fe extends Ae{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Re extends Ae{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ce extends Re{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class He{constructor(n,o,f,x){this.context=n,this.width=o,this.height=f;const b=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Fe(n,b),x&&(this.depthAttachment=new Re(n,b))}destroy(){const n=this.context.gl,o=this.colorAttachment.get();if(o&&n.deleteTexture(o),this.depthAttachment){const f=this.depthAttachment.get();f&&n.deleteRenderbuffer(f)}n.deleteFramebuffer(this.framebuffer)}}class kt{constructor(n,o=!1){if(this.gl=n,this.isWebGL2=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),o){const f=n;this.extVertexArrayObject={createVertexArrayOES:f.createVertexArray.bind(n),deleteVertexArrayOES:f.deleteVertexArray.bind(n),bindVertexArrayOES:f.bindVertexArray.bind(n)}}this.clearColor=new ei(this),this.clearDepth=new Rn(this),this.clearStencil=new nn(this),this.colorMask=new Gr(this),this.depthMask=new sn(this),this.stencilMask=new za(this),this.stencilFunc=new ts(this),this.stencilOp=new ti(this),this.stencilTest=new gs(this),this.depthRange=new Js(this),this.depthTest=new _t(this),this.depthFunc=new dr(this),this.blend=new Br(this),this.blendFunc=new qt(this),this.blendColor=new An(this),this.blendEquation=new Wr(this),this.cullFace=new ui(this),this.cullFaceSide=new En(this),this.frontFace=new xn(this),this.program=new Ko(this),this.activeTexture=new Ba(this),this.viewport=new Fa(this),this.bindFramebuffer=new ya(this),this.bindRenderbuffer=new xa(this),this.bindTexture=new Oa(this),this.bindVertexBuffer=new Yo(this),this.bindElementBuffer=new pe(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new X(this),this.pixelStoreUnpack=new Y(this),this.pixelStoreUnpackPremultiplyAlpha=new de(this),this.pixelStoreUnpackFlipY=new we(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),o||(this.extTextureHalfFloat=n.getExtension("OES_texture_half_float")),(o||this.extTextureHalfFloat&&n.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=o||n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,o){return new hr(this,n,o)}createVertexBuffer(n,o,f){return new Vn(this,n,o,f)}createRenderbuffer(n,o,f){const x=this.gl,b=x.createRenderbuffer();return this.bindRenderbuffer.set(b),x.renderbufferStorage(x.RENDERBUFFER,n,o,f),this.bindRenderbuffer.set(null),b}createFramebuffer(n,o,f){return new He(this,n,o,f)}clear({color:n,depth:o,stencil:f}){const x=this.gl;let b=0;n&&(b|=x.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(b|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),f!==void 0&&(b|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),x.clear(b)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){R(n.blendFunction,i.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class It extends i.Evented{constructor(n,o,f,x){if(super(),this.id=n,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.extend(this,i.pick(o,["url","scheme","tileSize","promoteId"])),this._options=i.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new i.DedupedRequest}load(n){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=zr(this._options,this.map._requestManager,o,f,((x,b)=>{this._tileJSONRequest=null,this._loaded=!0,x?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new i.ErrorEvent(x))):b&&(i.extend(this,b),b.bounds&&(this.tileBounds=new lt(b.bounds,this.minzoom,this.maxzoom)),i.postTurnstileEvent(b.tiles,this.map._requestManager._customAccessToken),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(x)}))}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.extend({},this._options)}loadTile(n,o){const f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(f,i.ResourceType.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:i.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=o:n.request=n.actor.send("reloadTile",x,b.bind(this));else if(n.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",x,b.bind(this),void 0,!0);else{const C=i.loadVectorTile.call({deduped:this._deduped},x,((M,j)=>{M||!j?b.call(this,M):(x.data={cacheControl:j.cacheControl,expires:j.expires,rawData:j.rawData.slice(0)},n.actor&&n.actor.send("loadTile",x,b.bind(this),void 0,!0))}),!0);n.request={cancel:C}}function b(C,M){return delete n.request,n.aborted?o(null):C&&C.status!==404?o(C):(M&&M.resourceTiming&&(n.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&n.setExpiryData(M),n.loadVectorData(M,this.map.painter),i.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id})}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class xt extends i.Evented{constructor(n,o,f,x){super(),this.id=n,this.dispatcher=f,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.extend({type:"raster"},o),i.extend(this,i.pick(o,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=zr(this._options,this.map._requestManager,null,null,((o,f)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new i.ErrorEvent(o)):f&&(i.extend(this,f),f.bounds&&(this.tileBounds=new lt(f.bounds,this.minzoom,this.maxzoom)),i.postTurnstileEvent(f.tiles),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(o)}))}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,o){const f=i.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);n.request=i.getImage(this.map._requestManager.transformRequest(x,i.ResourceType.Tile),((b,C,M,j)=>(delete n.request,n.aborted?(n.state="unloaded",o(null)):b?(n.state="errored",o(b)):C?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:M,expires:j}),n.setTexture(C,this.map.painter),n.state="loaded",i.cacheEntryPossiblyAdded(this.dispatcher),void o(null)):o(null))))}static loadTileData(n,o,f){n.setTexture(o,f)}static unloadTileData(n,o){n.texture&&o.saveTileTexture(n.texture)}abortTile(n,o){n.request&&(n.request.cancel(),delete n.request),o()}unloadTile(n,o){n.texture&&this.map.painter.saveTileTexture(n.texture),o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function yr(d,n,o,f,x,b,C,M){const j=[d,o,x,n,f,b,1,1,1],F=[C,M,1],z=i.adjoint([],j),[G,Q,re]=i.transformMat3(F,F,i.transpose(z,z));return i.multiply$1(j,[G,0,0,0,Q,0,0,0,re],j)}class xr extends i.Evented{constructor(n,o,f,x){super(),this.id=n,this.dispatcher=f,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=o,this._dirty=!1}load(n,o){this._loaded=o||!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=i.getImage(this.map._requestManager.transformRequest(this.url,i.ResourceType.Image),((f,x)=>{if(this._imageRequest=null,this._loaded=!0,f)this.fire(new i.ErrorEvent(f));else if(x){const{HTMLImageElement:b}=i.window;this.image=x instanceof b?i.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const o=n.map(i.MercatorCoordinate.fromLngLat);return this.tileID=(function(f){let x=1/0,b=1/0,C=-1/0,M=-1/0;for(const G of f)x=Math.min(x,G.x),b=Math.min(b,G.y),C=Math.max(C,G.x),M=Math.max(M,G.y);const j=Math.max(C-x,M-b),F=Math.max(0,Math.floor(-Math.log(j)/Math.LN2)),z=Math.pow(2,F);return new i.CanonicalTileID(F,Math.floor((x+C)/2*z),Math.floor((b+M)/2*z))})(o),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const j in this.tiles){const F=this.tiles[j];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture)}if(this._boundsArray)return;const o=i.tileTransform(this.tileID,this.map.transform.projection),[f,x,b,C]=this.coordinates.map((j=>{const F=o.projection.project(j[0],j[1]);return i.getTilePoint(o,F)._round()}));this.perspectiveTransform=(function(j,F,z,G,Q,re,ie,ne,se,W){const te=yr(0,0,j,0,0,F,j,F),le=yr(z,G,Q,re,ie,ne,se,W);return i.multiply$1(le,i.adjoint(te,te),le),[le[6]/le[8]*j/i.EXTENT,le[7]/le[8]*F/i.EXTENT]})(this.width,this.height,f.x,f.y,x.x,x.y,C.x,C.y,b.x,b.y);const M=this._boundsArray=new i.StructArrayLayout4i8;M.emplaceBack(f.x,f.y,0,0),M.emplaceBack(x.x,x.y,i.EXTENT,0),M.emplaceBack(C.x,C.y,0,i.EXTENT),M.emplaceBack(b.x,b.y,i.EXTENT,i.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(M,i.boundsAttributes.members),this.boundsSegments=i.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,o=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new i.Texture(n,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,o){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},o(null)):(n.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const gr={vector:It,raster:xt,"raster-dem":class extends xt{constructor(d,n,o,f){super(d,n,o,f),this.type="raster-dem",this.maxzoom=22,this._options=i.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(d,n){const o=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(x,b){x&&(d.state="errored",n(x)),b&&(d.dem=b,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",n(null))}d.request=i.getImage(this.map._requestManager.transformRequest(o,i.ResourceType.Tile),(function(x,b,C,M){if(delete d.request,d.aborted)d.state="unloaded",n(null);else if(x)d.state="errored",n(x);else if(b){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:C,expires:M});const j=i.window.ImageBitmap&&b instanceof i.window.ImageBitmap&&(Xo==null&&(Xo=i.window.OffscreenCanvas&&new i.window.OffscreenCanvas(1,1).getContext("2d")&&typeof i.window.createImageBitmap=="function"),Xo),F=1-(b.width-i.prevPowerOfTwo(b.width))/2;F<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const z=j?b:i.exported.getImageData(b,F),G={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:F};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",G,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const n=d.canonical,o=Math.pow(2,n.z),f=(n.x-1+o)%o,x=n.x===0?d.wrap-1:d.wrap,b=(n.x+1+o)%o,C=n.x+1===o?d.wrap+1:d.wrap,M={};return M[new i.OverscaledTileID(d.overscaledZ,x,n.z,f,n.y).key]={backfilled:!1},M[new i.OverscaledTileID(d.overscaledZ,C,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(M[new i.OverscaledTileID(d.overscaledZ,x,n.z,f,n.y-1).key]={backfilled:!1},M[new i.OverscaledTileID(d.overscaledZ,d.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},M[new i.OverscaledTileID(d.overscaledZ,C,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<o&&(M[new i.OverscaledTileID(d.overscaledZ,x,n.z,f,n.y+1).key]={backfilled:!1},M[new i.OverscaledTileID(d.overscaledZ,d.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},M[new i.OverscaledTileID(d.overscaledZ,C,n.z,b,n.y+1).key]={backfilled:!1}),M}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends i.Evented{constructor(d,n,o,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(f),this._data=n.data,this._options=i.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const x=i.EXTENT/this.tileSize;this.workerOptions=i.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*x,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*x,extent:i.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:i.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*x,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},n),this}getClusterChildren(d,n){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},n),this}getClusterLeaves(d,n,o,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:n,offset:o},f),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=i.extend({},this.workerOptions),n=this._data;typeof n=="string"?(d.request=this.map._requestManager.transformRequest(i.exported.resolveURL(n),i.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,((o,f)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new i.ErrorEvent(o));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(x.resourceTiming=f.resourceTiming[this.id]),this.fire(new i.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(d,n){const o=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(o,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:i.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((f,x)=>(delete d.request,d.unloadVectorData(),d.aborted?n(null):f?n(f):(d.loadVectorData(x,this.map.painter,o==="reloadTile"),n(null)))),void 0,o==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends xr{constructor(d,n,o,f){super(d,n,o,f),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const n of d.urls)this.urls.push(this.map._requestManager.transformRequest(n,i.ResourceType.Source).url);i.getVideo(this.urls,((n,o)=>{this._loaded=!0,n?this.fire(new i.ErrorEvent(n)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const n=this.video.seekable;d<n.start(0)||d>n.end(0)?this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,n=d.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new i.Texture(d,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:xr,canvas:class extends xr{constructor(d,n,o,f){super(d,n,o,f),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some((x=>!Array.isArray(x)||x.length!==2||x.some((b=>typeof b!="number"))))||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof i.window.HTMLCanvasElement||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof i.window.HTMLCanvasElement?this.options.canvas:i.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends i.Evented{constructor(d,n,o,f){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=n,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new lt(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),i.extend(this,i.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:n,y:o,z:f}=d.canonical;return this._implementation.hasTile({x:n,y:o,z:f})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,n){const{x:o,y:f,z:x}=d.tileID.canonical,b=new i.window.AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:o,y:f,z:x},{signal:b.signal})).then((function(C){return delete d.request,d.aborted?(d.state="unloaded",n(null)):C===void 0?(d.state="errored",n(null)):C===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",n(null)):(function(M){return M instanceof i.window.ImageData||M instanceof i.window.HTMLCanvasElement||M instanceof i.window.ImageBitmap||M instanceof i.window.HTMLImageElement})(C)?(this.loadTileData(d,C),d.state="loaded",void n(null)):(d.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((C=>{C.code!==20&&(d.state="errored",n(C))})),d.request.cancel=()=>b.abort()}loadTileData(d,n){xt.loadTileData(d,n,this._map.painter)}unloadTileData(d){xt.unloadTileData(d,this._map.painter)}unloadTile(d,n){if(this.unloadTileData(d),this._implementation.unloadTile){const{x:o,y:f,z:x}=d.tileID.canonical;this._implementation.unloadTile({x:o,y:f,z:x})}n()}abortTile(d,n){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z})))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))}}},vr=function(d,n,o,f){const x=new gr[n.type](d,n,o,f);if(x.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${x.id}`);return i.bindAll(["load","abort","unload","serialize","prepare"],x),x};function Nr(d,n){const o=i.identity([]);return i.scale(o,o,[.5*d.width,.5*-d.height,1]),i.translate(o,o,[1,-1,0]),i.multiply(o,o,d.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(o)}function Tn(d,n,o,f,x,b,C,M=!1){const j=d.tilesIn(f,C,M);j.sort(Si);const F=[];for(const G of j)F.push({wrappedTileID:G.tile.tileID.wrapped().key,queryResults:G.tile.queryRenderedFeatures(n,o,d._state,G,x,b,Nr(d.transform,G.tile.tileID),M)});const z=(function(G){const Q={},re={};for(const ie of G){const ne=ie.queryResults,se=ie.wrappedTileID,W=re[se]=re[se]||{};for(const te in ne){const le=ne[te],ue=W[te]=W[te]||{},ke=Q[te]=Q[te]||[];for(const Ee of le)ue[Ee.featureIndex]||(ue[Ee.featureIndex]=!0,ke.push(Ee))}}return Q})(F);for(const G in z)z[G].forEach((Q=>{const re=Q.feature,ie=re.layer;ie&&ie.type!=="background"&&ie.type!=="sky"&&(re.source=ie.source,ie["source-layer"]&&(re.sourceLayer=ie["source-layer"]),re.state=re.id!==void 0?d.getFeatureState(ie["source-layer"],re.id):{})}));return z}function $n(d,n){const o=d.getRenderableIds().map((b=>d.getTileByID(b))),f=[],x={};for(let b=0;b<o.length;b++){const C=o[b],M=C.tileID.canonical.key;x[M]||(x[M]=!0,C.querySourceFeatures(f,n))}return f}function Si(d,n){const o=d.tileID,f=n.tileID;return o.overscaledZ-f.overscaledZ||o.canonical.y-f.canonical.y||o.wrap-f.wrap||o.canonical.x-f.canonical.x}function _n(){return to.workerClass!=null?new to.workerClass:new i.window.Worker(to.workerUrl)}const Rs="mapboxgl_preloaded_worker_pool";class ri{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<ri.workerCount;)this.workers.push(new _n);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach((o=>{o.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Rs]}numActive(){return Object.keys(this.active).length}}let Di;function yo(){return Di||(Di=new ri),Di}function rd(d,n){const o={};for(const f in d)f!=="ref"&&(o[f]=d[f]);return i.refProperties.forEach((f=>{f in n&&(o[f]=n[f])})),o}function Vu(d){d=d.slice();const n=Object.create(null);for(let o=0;o<d.length;o++)n[d[o].id]=d[o];for(let o=0;o<d.length;o++)"ref"in d[o]&&(d[o]=rd(d[o],n[d[o].ref]));return d}ri.workerCount=2;const Zr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function $u(d,n,o){o.push({command:Zr.addSource,args:[d,n[d]]})}function Xl(d,n,o){n.push({command:Zr.removeSource,args:[d]}),o[d]=!0}function Pn(d,n,o,f){Xl(d,o,f),$u(d,n,o)}function Wc(d,n,o){let f;for(f in d[o])if(d[o].hasOwnProperty(f)&&f!=="data"&&!R(d[o][f],n[o][f]))return!1;for(f in n[o])if(n[o].hasOwnProperty(f)&&f!=="data"&&!R(d[o][f],n[o][f]))return!1;return!0}function ys(d,n,o,f,x,b){let C;for(C in n=n||{},d=d||{})d.hasOwnProperty(C)&&(R(d[C],n[C])||o.push({command:b,args:[f,C,n[C],x]}));for(C in n)n.hasOwnProperty(C)&&!d.hasOwnProperty(C)&&(R(d[C],n[C])||o.push({command:b,args:[f,C,n[C],x]}))}function Qs(d){return d.id}function Jo(d,n){return d[n.id]=n,d}class Gu{constructor(n,o){this.reset(n,o)}reset(n,o){this.points=n||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=i.clamp(n,0,1);let o=1,f=this._distances[o];const x=n*this.paddedLength+this.padding;for(;f<x&&o<this._distances.length;)f=this._distances[++o];const b=o-1,C=this._distances[b],M=f-C,j=M>0?(x-C)/M:0;return this.points[b].mult(1-j).add(this.points[o].mult(j))}}class Ua{constructor(n,o,f){const x=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/f),this.yCellCount=Math.ceil(o/f);for(let C=0;C<this.xCellCount*this.yCellCount;C++)x.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=o,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,o,f,x,b){this._forEachCell(o,f,x,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(o),this.bboxes.push(f),this.bboxes.push(x),this.bboxes.push(b)}insertCircle(n,o,f,x){this._forEachCell(o-x,f-x,o+x,f+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(o),this.circles.push(f),this.circles.push(x)}_insertBoxCell(n,o,f,x,b,C){this.boxCells[b].push(C)}_insertCircleCell(n,o,f,x,b,C){this.circleCells[b].push(C)}_query(n,o,f,x,b,C){if(f<0||n>this.width||x<0||o>this.height)return!b&&[];const M=[];if(n<=0&&o<=0&&this.width<=f&&this.height<=x){if(b)return!0;for(let j=0;j<this.boxKeys.length;j++)M.push({key:this.boxKeys[j],x1:this.bboxes[4*j],y1:this.bboxes[4*j+1],x2:this.bboxes[4*j+2],y2:this.bboxes[4*j+3]});for(let j=0;j<this.circleKeys.length;j++){const F=this.circles[3*j],z=this.circles[3*j+1],G=this.circles[3*j+2];M.push({key:this.circleKeys[j],x1:F-G,y1:z-G,x2:F+G,y2:z+G})}return C?M.filter(C):M}return this._forEachCell(n,o,f,x,this._queryCell,M,{hitTest:b,seenUids:{box:{},circle:{}}},C),b?M.length>0:M}_queryCircle(n,o,f,x,b){const C=n-f,M=n+f,j=o-f,F=o+f;if(M<0||C>this.width||F<0||j>this.height)return!x&&[];const z=[];return this._forEachCell(C,j,M,F,this._queryCellCircle,z,{hitTest:x,circle:{x:n,y:o,radius:f},seenUids:{box:{},circle:{}}},b),x?z.length>0:z}query(n,o,f,x,b){return this._query(n,o,f,x,!1,b)}hitTest(n,o,f,x,b){return this._query(n,o,f,x,!0,b)}hitTestCircle(n,o,f,x){return this._queryCircle(n,o,f,!0,x)}_queryCell(n,o,f,x,b,C,M,j){const F=M.seenUids,z=this.boxCells[b];if(z!==null){const Q=this.bboxes;for(const re of z)if(!F.box[re]){F.box[re]=!0;const ie=4*re;if(n<=Q[ie+2]&&o<=Q[ie+3]&&f>=Q[ie+0]&&x>=Q[ie+1]&&(!j||j(this.boxKeys[re]))){if(M.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[re],x1:Q[ie],y1:Q[ie+1],x2:Q[ie+2],y2:Q[ie+3]})}}}const G=this.circleCells[b];if(G!==null){const Q=this.circles;for(const re of G)if(!F.circle[re]){F.circle[re]=!0;const ie=3*re;if(this._circleAndRectCollide(Q[ie],Q[ie+1],Q[ie+2],n,o,f,x)&&(!j||j(this.circleKeys[re]))){if(M.hitTest)return C.push(!0),!0;{const ne=Q[ie],se=Q[ie+1],W=Q[ie+2];C.push({key:this.circleKeys[re],x1:ne-W,y1:se-W,x2:ne+W,y2:se+W})}}}}}_queryCellCircle(n,o,f,x,b,C,M,j){const F=M.circle,z=M.seenUids,G=this.boxCells[b];if(G!==null){const re=this.bboxes;for(const ie of G)if(!z.box[ie]){z.box[ie]=!0;const ne=4*ie;if(this._circleAndRectCollide(F.x,F.y,F.radius,re[ne+0],re[ne+1],re[ne+2],re[ne+3])&&(!j||j(this.boxKeys[ie])))return C.push(!0),!0}}const Q=this.circleCells[b];if(Q!==null){const re=this.circles;for(const ie of Q)if(!z.circle[ie]){z.circle[ie]=!0;const ne=3*ie;if(this._circlesCollide(re[ne],re[ne+1],re[ne+2],F.x,F.y,F.radius)&&(!j||j(this.circleKeys[ie])))return C.push(!0),!0}}}_forEachCell(n,o,f,x,b,C,M,j){const F=this._convertToXCellCoord(n),z=this._convertToYCellCoord(o),G=this._convertToXCellCoord(f),Q=this._convertToYCellCoord(x);for(let re=F;re<=G;re++)for(let ie=z;ie<=Q;ie++)if(b.call(this,n,o,f,x,this.xCellCount*ie+re,C,M,j))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,o,f,x,b,C){const M=x-n,j=b-o,F=f+C;return F*F>M*M+j*j}_circleAndRectCollide(n,o,f,x,b,C,M){const j=(C-x)/2,F=Math.abs(n-(x+j));if(F>j+f)return!1;const z=(M-b)/2,G=Math.abs(o-(b+z));if(G>z+f)return!1;if(F<=j||G<=z)return!0;const Q=F-j,re=G-z;return Q*Q+re*re<=f*f}}const xs={unknown:0,flipRequired:1,flipNotRequired:2},Vi=Math.tan(85*Math.PI/180);function at(d,n,o,f,x,b,C){const M=i.create();if(o)if(b.name==="globe"){const j=i.calculateGlobeLabelMatrix(x,n);i.multiply(M,M,j)}else{const j=ge([],C);M[0]=j[0],M[1]=j[1],M[4]=j[2],M[5]=j[3],f||i.rotateZ(M,M,x.angle)}else i.multiply(M,x.labelPlaneMatrix,d);return M}function ni(d,n,o,f,x,b,C){const M=at(d,n,o,f,x,b,C);return b.name==="globe"&&o||(M[2]=M[6]=M[10]=M[14]=0),M}function Gn(d,n,o,f,x,b,C){if(o){if(b.name==="globe"){const M=at(d,n,o,f,x,b,C);return i.invert(M,M),i.multiply(M,d,M),M}{const M=i.clone(d),j=i.identity([]);return j[0]=C[0],j[1]=C[1],j[4]=C[2],j[5]=C[3],i.multiply(M,M,j),f||i.rotateZ(M,M,-x.angle),M}}return x.glCoordMatrix}function hi(d,n,o,f){const x=[d,n,o,1];o?i.transformMat4$1(x,x,f):br(x,x,f);const b=x[3];return x[0]/=b,x[1]/=b,x[2]/=b,x}function nd(d,n){return Math.min(.5+d/n*.5,1.5)}function rs(d,n){const o=d[0]/d[3],f=d[1]/d[3];return o>=-n[0]&&o<=n[0]&&f>=-n[1]&&f<=n[1]}function Qo(d,n,o,f,x,b,C,M,j,F){const z=o.transform,G=f?d.textSizeData:d.iconSizeData,Q=i.evaluateSizeForZoom(G,o.transform.zoom),re=z.projection.name==="globe",ie=[256/o.width*2+1,256/o.height*2+1],ne=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;ne.clear();let se=null;re&&(se=f?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const W=d.lineVertexArray,te=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,le=o.transform.width/o.transform.height;let ue,ke=!1;for(let Ee=0;Ee<te.length;Ee++){const Se=te.get(Ee),{numGlyphs:je,writingMode:Ie}=Se;if(Ie!==i.WritingMode.vertical||ke||ue===i.WritingMode.horizontal||(ke=!0),ue=Ie,(Se.hidden||Ie===i.WritingMode.vertical)&&!ke){ns(je,ne);continue}ke=!1;const Ve=new i.Point(Se.tileAnchorX,Se.tileAnchorY);let{x:yt,y:ze,z:nt}=z.projection.projectTilePoint(Ve.x,Ve.y,F.canonical);if(j){const[or,Vt,tr]=j(Ve);yt+=or,ze+=Vt,nt+=tr}const We=[yt,ze,nt,1];if(i.transformMat4$1(We,We,n),!rs(We,ie)){ns(je,ne);continue}const mt=nd(o.transform.cameraToCenterDistance,We[3]),Ue=i.evaluateSizeForFeature(G,Q,Se),it=C?Ue/mt:Ue*mt,ft=hi(yt,ze,nt,x);if(ft[3]<=0){ns(je,ne);continue}let pt={};const vt=C?null:j,Wt=Bt(Se,it,!1,M,n,x,b,d.glyphOffsetArray,W,ne,se,ft,Ve,pt,le,vt,z.projection,F,C);ke=Wt.useVertical,vt&&Wt.needsFlipping&&(pt={}),(Wt.notEnoughRoom||ke||Wt.needsFlipping&&Bt(Se,it,!0,M,n,x,b,d.glyphOffsetArray,W,ne,se,ft,Ve,pt,le,vt,z.projection,F,C).notEnoughRoom)&&ns(je,ne)}f?(d.text.dynamicLayoutVertexBuffer.updateData(ne),se&&d.text.globeExtVertexBuffer.updateData(se)):(d.icon.dynamicLayoutVertexBuffer.updateData(ne),se&&d.icon.globeExtVertexBuffer.updateData(se))}function el(d,n,o,f,x,b,C,M,j,F,z,G,Q,re,ie,ne){const{lineStartIndex:se,glyphStartIndex:W,segment:te}=M,le=W+M.numGlyphs,ue=se+M.lineLength,ke=n.getoffsetX(W),Ee=n.getoffsetX(le-1),Se=$i(d*ke,o,f,x,b,C,te,se,ue,j,F,z,G,Q,!0,re,ie,ne);if(!Se)return null;const je=$i(d*Ee,o,f,x,b,C,te,se,ue,j,F,z,G,Q,!0,re,ie,ne);return je?{first:Se,last:je}:null}function _a(d,n,o,f){return d===i.WritingMode.horizontal&&Math.abs(f)>Math.abs(o)?{useVertical:!0}:d===i.WritingMode.vertical?f>0?{needsFlipping:!0}:null:n!==xs.unknown&&(function(x,b){return x===0||Math.abs(b/x)>Vi})(o,f)?n===xs.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function Bt(d,n,o,f,x,b,C,M,j,F,z,G,Q,re,ie,ne,se,W,te){const le=n/24,ue=d.lineOffsetX*le,ke=d.lineOffsetY*le,{lineStartIndex:Ee,glyphStartIndex:Se,numGlyphs:je,segment:Ie,writingMode:Ve,flipState:yt}=d,ze=Ee+d.lineLength,nt=We=>{if(z){const[ft,pt,vt]=We.up,Wt=F.length;i.updateGlobeVertexNormal(z,Wt+0,ft,pt,vt),i.updateGlobeVertexNormal(z,Wt+1,ft,pt,vt),i.updateGlobeVertexNormal(z,Wt+2,ft,pt,vt),i.updateGlobeVertexNormal(z,Wt+3,ft,pt,vt)}const[mt,Ue,it]=We.point;i.addDynamicAttributes(F,mt,Ue,it,We.angle)};if(je>1){const We=el(le,M,ue,ke,o,G,Q,d,j,b,re,ne,!1,se,W,te);if(!We)return{notEnoughRoom:!0};if(f&&!o){let[mt,Ue,it]=We.first.point,[ft,pt,vt]=We.last.point;[mt,Ue]=hi(mt,Ue,it,C),[ft,pt]=hi(ft,pt,vt,C);const Wt=_a(Ve,yt,(ft-mt)*ie,pt-Ue);if(d.flipState=Wt&&Wt.needsFlipping?xs.flipRequired:xs.flipNotRequired,Wt)return Wt}nt(We.first);for(let mt=Se+1;mt<Se+je-1;mt++){const Ue=$i(le*M.getoffsetX(mt),ue,ke,o,G,Q,Ie,Ee,ze,j,b,re,ne,!1,!1,se,W,te);if(!Ue)return F.length-=4*(mt-Se),{notEnoughRoom:!0};nt(Ue)}nt(We.last)}else{if(f&&!o){const mt=hi(Q.x,Q.y,0,x),Ue=Ee+Ie+1,it=new i.Point(j.getx(Ue),j.gety(Ue)),ft=hi(it.x,it.y,0,x),pt=ft[3]>0?ft:Ar(Q,it,mt,1,x,void 0,se,W.canonical),vt=_a(Ve,yt,(pt[0]-mt[0])*ie,pt[1]-mt[1]);if(d.flipState=vt&&vt.needsFlipping?xs.flipRequired:xs.flipNotRequired,vt)return vt}const We=$i(le*M.getoffsetX(Se),ue,ke,o,G,Q,Ie,Ee,ze,j,b,re,ne,!1,!1,se,W,te);if(!We)return{notEnoughRoom:!0};nt(We)}return{}}function Lr(d,n,o,f,x){const{x:b,y:C,z:M}=f.projectTilePoint(d.x,d.y,n);if(!x)return hi(b,C,M,o);const[j,F,z]=x(d);return hi(b+j,C+F,M+z,o)}function Ar(d,n,o,f,x,b,C,M){const j=Lr(d.sub(n)._unit()._add(d),M,x,C,b);return i.sub(j,o,j),i.normalize(j,j),i.scaleAndAdd(j,o,j,f)}function $i(d,n,o,f,x,b,C,M,j,F,z,G,Q,re,ie,ne,se,W){const te=f?d-n:d+n;let le=te>0?1:-1,ue=0;f&&(le*=-1,ue=Math.PI),le<0&&(ue+=Math.PI);let ke=M+C+(le>0?0:1)|0,Ee=x,Se=x,je=0,Ie=0;const Ve=Math.abs(te),yt=[],ze=[];let nt=b,We=nt;const mt=()=>Ar(We,nt,Se,Ve-je+1,z,Q,ne,se.canonical);for(;je+Ie<=Ve;){if(ke+=le,ke<M||ke>=j)return null;if(Se=Ee,We=nt,yt.push(Se),re&&ze.push(We),nt=new i.Point(F.getx(ke),F.gety(ke)),Ee=G[ke],!Ee){const tr=Lr(nt,se.canonical,z,ne,Q);Ee=tr[3]>0?G[ke]=tr:mt()}je+=Ie,Ie=i.distance(Se,Ee)}ie&&Q&&(G[ke]&&(Ee=mt(),Ie=i.distance(Se,Ee)),G[ke]=Ee);const Ue=(Ve-je)/Ie,it=nt.sub(We)._mult(Ue)._add(We),ft=i.sub([],Ee,Se),pt=i.scaleAndAdd([],Se,ft,Ue);let vt=[0,0,1],Wt=ft[0],or=ft[1];if(W&&(vt=ne.upVector(se.canonical,it.x,it.y),vt[0]!==0||vt[1]!==0||vt[2]!==1)){const tr=[vt[2],0,-vt[0]],Sr=i.cross([],vt,tr);i.normalize(tr,tr),i.normalize(Sr,Sr),Wt=i.dot(ft,tr),or=i.dot(ft,Sr)}if(o){const tr=i.cross([],vt,ft);i.normalize(tr,tr),i.scaleAndAdd(pt,pt,tr,o*le)}const Vt=ue+Math.atan2(or,Wt);return yt.push(pt),re&&ze.push(it),{point:pt,angle:Vt,path:yt,tilePath:ze,up:vt}}function ns(d,n){const o=n.length,f=o+4*d;n.resize(f),n.float32.fill(-1/0,4*o,4*f)}function br(d,n,o){const f=n[0],x=n[1];return d[0]=o[0]*f+o[4]*x+o[12],d[1]=o[1]*f+o[5]*x+o[13],d[3]=o[3]*f+o[7]*x+o[15],d}const is=100;class xo{constructor(n,o,f=new Ua(n.width+200,n.height+200,25),x=new Ua(n.width+200,n.height+200,25)){this.transform=n,this.grid=f,this.ignoredGrid=x,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+is,this.screenBottomBoundary=n.height+is,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=o}placeCollisionBox(n,o,f,x,b,C,M,j){let F=f.projectedAnchorX,z=f.projectedAnchorY,G=f.projectedAnchorZ;const Q=f.elevation,re=f.tileID,ie=n.getProjection();if(Q&&re){const[Ee,Se,je]=ie.upVector(re.canonical,f.tileAnchorX,f.tileAnchorY),Ie=ie.upVectorScale(re.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=Ee*Q*Ie,z+=Se*Q*Ie,G+=je*Q*Ie}const ne=this.projectAndGetPerspectiveRatio(M,F,z,G,f.tileID,ie.name==="globe"||!!Q||this.transform.pitch>0,ie),se=C*ne.perspectiveRatio,W=(f.x1*o+x.x-f.padding)*se+ne.point.x,te=(f.y1*o+x.y-f.padding)*se+ne.point.y,le=(f.x2*o+x.x+f.padding)*se+ne.point.x,ue=(f.y2*o+x.y+f.padding)*se+ne.point.y,ke=ne.perspectiveRatio<=.55||ne.occluded;return!this.isInsideGrid(W,te,le,ue)||!b&&this.grid.hitTest(W,te,le,ue,j)||ke?{box:[],offscreen:!1,occluded:ne.occluded}:{box:[W,te,le,ue],offscreen:this.isOffscreen(W,te,le,ue),occluded:!1}}placeCollisionCircles(n,o,f,x,b,C,M,j,F,z,G,Q,re,ie,ne){const se=[],W=this.transform.elevation,te=n.getProjection(),le=W?W.getAtTileOffsetFunc(ne,this.transform.center.lat,this.transform.worldSize,te):null,ue=new i.Point(f.tileAnchorX,f.tileAnchorY);let{x:ke,y:Ee,z:Se}=te.projectTilePoint(ue.x,ue.y,ne.canonical);if(le){const[it,ft,pt]=le(ue);ke+=it,Ee+=ft,Se+=pt}const je=te.name==="globe",Ie=this.projectAndGetPerspectiveRatio(M,ke,Ee,Se,ne,je||!!W||this.transform.pitch>0,te),{perspectiveRatio:Ve}=Ie,yt=(G?C/Ve:C*Ve)/i.ONE_EM,ze=hi(ke,Ee,Se,j),nt=Ie.signedDistanceFromCamera>0?el(yt,b,f.lineOffsetX*yt,f.lineOffsetY*yt,!1,ze,ue,f,x,j,{},W&&!G?le:null,G&&!!W,te,ne,G):null;let We=!1,mt=!1,Ue=!0;if(nt&&!Ie.occluded){const it=.5*re*Ve+ie,ft=new i.Point(-100,-100),pt=new i.Point(this.screenRightBoundary,this.screenBottomBoundary),vt=new Gu,{first:Wt,last:or}=nt,Vt=Wt.path.length;let tr=[];for(let Zt=Vt-1;Zt>=1;Zt--)tr.push(Wt.path[Zt]);for(let Zt=1;Zt<or.path.length;Zt++)tr.push(or.path[Zt]);const Sr=2.5*it;F&&(tr=tr.map((([Zt,Dr,Xr],Kr)=>(le&&!je&&(Xr=le(Kr<Vt-1?Wt.tilePath[Vt-1-Kr]:or.tilePath[Kr-Vt+2])[2]),hi(Zt,Dr,Xr,F)))),tr.some((Zt=>Zt[3]<=0))&&(tr=[]));let Pr=[];if(tr.length>0){let Zt=1/0,Dr=-1/0,Xr=1/0,Kr=-1/0;for(const qr of tr)Zt=Math.min(Zt,qr[0]),Xr=Math.min(Xr,qr[1]),Dr=Math.max(Dr,qr[0]),Kr=Math.max(Kr,qr[1]);Dr>=ft.x&&Zt<=pt.x&&Kr>=ft.y&&Xr<=pt.y&&(Pr=[tr.map((qr=>new i.Point(qr[0],qr[1])))],(Zt<ft.x||Dr>pt.x||Xr<ft.y||Kr>pt.y)&&(Pr=i.clipLine(Pr,ft.x,ft.y,pt.x,pt.y)))}for(const Zt of Pr){vt.reset(Zt,.25*it);let Dr=0;Dr=vt.length<=.5*it?1:Math.ceil(vt.paddedLength/Sr)+1;for(let Xr=0;Xr<Dr;Xr++){const Kr=Xr/Math.max(Dr-1,1),qr=vt.lerp(Kr),mi=qr.x+is,In=qr.y+is;se.push(mi,In,it,0);const us=mi-it,Cs=In-it,_r=mi+it,tn=In+it;if(Ue=Ue&&this.isOffscreen(us,Cs,_r,tn),mt=mt||this.isInsideGrid(us,Cs,_r,tn),!o&&this.grid.hitTestCircle(mi,In,it,Q)&&(We=!0,!z))return{circles:[],offscreen:!1,collisionDetected:We,occluded:!1}}}}return{circles:!z&&We||!mt?[]:se,offscreen:Ue,collisionDetected:We,occluded:Ie.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let f=1/0,x=1/0,b=-1/0,C=-1/0;for(const z of n){const G=new i.Point(z.x+is,z.y+is);f=Math.min(f,G.x),x=Math.min(x,G.y),b=Math.max(b,G.x),C=Math.max(C,G.y),o.push(G)}const M=this.grid.query(f,x,b,C).concat(this.ignoredGrid.query(f,x,b,C)),j={},F={};for(const z of M){const G=z.key;if(j[G.bucketInstanceId]===void 0&&(j[G.bucketInstanceId]={}),j[G.bucketInstanceId][G.featureIndex])continue;const Q=[new i.Point(z.x1,z.y1),new i.Point(z.x2,z.y1),new i.Point(z.x2,z.y2),new i.Point(z.x1,z.y2)];i.polygonIntersectsPolygon(o,Q)&&(j[G.bucketInstanceId][G.featureIndex]=!0,F[G.bucketInstanceId]===void 0&&(F[G.bucketInstanceId]=[]),F[G.bucketInstanceId].push(G.featureIndex))}return F}insertCollisionBox(n,o,f,x,b){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:x,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,o,f,x,b){const C=o?this.ignoredGrid:this.grid,M={bucketInstanceId:f,featureIndex:x,collisionGroupID:b};for(let j=0;j<n.length;j+=4)C.insertCircle(M,n[j],n[j+1],n[j+2])}projectAndGetPerspectiveRatio(n,o,f,x,b,C,M){const j=[o,f,x,1];let F=!1;x||this.transform.pitch>0?(i.transformMat4$1(j,j,n),this.fogState&&b&&M.name!=="globe"&&(F=(function(Q,re,ie,ne,se,W){const te=W.calculateFogTileMatrix(se),le=[re,ie,ne];return i.transformMat4(le,le,te),Ht(Q,le,W.pitch,W._fov)})(this.fogState,o,f,x,b.toUnwrapped(),this.transform)>.9)):br(j,j,n);const z=j[3];return{point:new i.Point((j[0]/z+1)/2*this.transform.width+is,(-j[1]/z+1)/2*this.transform.height+is),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/z*.5,1.5),signedDistanceFromCamera:z,occluded:C&&j[2]>z||F}}isOffscreen(n,o,f,x){return f<is||n>=this.screenRightBoundary||x<is||o>this.screenBottomBoundary}isInsideGrid(n,o,f,x){return f>=0&&n<this.gridRightBoundary&&x>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const n=i.identity([]);return i.translate(n,n,[-100,-100,0]),n}}function Hr(d,n,o){const f=n.createTileMatrix(d,d.worldSize,o.toUnwrapped());return i.multiply(new Float32Array(16),d.projMatrix,f)}function ss(d,n,o){if(n.projection.name===o.projection.name)return d.projMatrix;const f=o.clone();return f.setProjection(n.projection),Hr(f,n.getProjection(),d)}function dn(d,n,o){return n.name===o.projection.name?d.projMatrix:Hr(o,n,d)}class qc{constructor(n,o,f,x){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?o:-o))):x&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class ea{constructor(n,o,f,x,b,C=!1){this.text=new qc(n?n.text:null,o,f,b),this.icon=new qc(n?n.icon:null,o,x,b),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class tl{constructor(n,o,f,x=!1){this.text=n,this.icon=o,this.skipFade=f,this.clipped=x}}class rl{constructor(){this.invProjMatrix=i.create(),this.viewportMatrix=i.create(),this.circles=[]}}class Kl{constructor(n,o,f,x,b){this.bucketInstanceId=n,this.featureIndex=o,this.sourceLayerIndex=f,this.bucketIndex=x,this.tileID=b}}class Yl{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const o=++this.maxGroupID;this.collisionGroups[n]={ID:o,predicate:f=>f.collisionGroupID===o}}return this.collisionGroups[n]}}function _s(d,n,o,f,x){const{horizontalAlign:b,verticalAlign:C}=i.getAnchorAlignment(d),M=-(b-.5)*n,j=-(C-.5)*o,F=i.evaluateVariableOffset(d,f);return new i.Point(M+F[0]*x,j+F[1]*x)}function vs(d,n,o,f,x){const b=new i.Point(d,n);return o&&b._rotate(f?x:-x),b}class zs{constructor(n,o,f,x,b){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new xo(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Yl(f),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,o,f,x){const b=f.getBucket(o),C=f.latestFeatureIndex;if(!b||!C||o.id!==b.layerIds[0])return;const M=b.layers[0].layout,j=f.collisionBoxArray,F=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),z=f.tileSize/i.EXTENT,G=f.tileID.toUnwrapped();this.transform.setProjection(b.projection);const Q=(re=f.tileID,ie=b.getProjection(),ne=this.transform,ie.name===this.projection?ne.calculateProjMatrix(re.toUnwrapped()):Hr(ne,ie,re));var re,ie,ne;const se=M.get("text-pitch-alignment")==="map",W=M.get("text-rotation-alignment")==="map";o.compileFilter();const te=o.dynamicFilter(),le=o.dynamicFilterNeedsFeature(),ue=this.transform.calculatePixelsToTileUnitsMatrix(f),ke=ni(Q,f.tileID.canonical,se,W,this.transform,b.getProjection(),ue);let Ee=null;if(se){const Ie=Gn(Q,f.tileID.canonical,se,W,this.transform,b.getProjection(),ue);Ee=i.multiply([],this.transform.labelPlaneMatrix,Ie)}let Se=null;te&&f.latestFeatureIndex&&(Se={unwrappedTileID:G,dynamicFilter:te,dynamicFilterNeedsFeature:le,featureIndex:f.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Kl(b.bucketInstanceId,C,b.sourceLayerIndex,b.index,f.tileID);const je={bucket:b,layout:M,posMatrix:Q,textLabelPlaneMatrix:ke,labelToScreenMatrix:Ee,clippingData:Se,scale:F,textPixelRatio:z,holdingForFade:f.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:i.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:i.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(x)for(const Ie of b.sortKeyRanges){const{sortKey:Ve,symbolInstanceStart:yt,symbolInstanceEnd:ze}=Ie;n.push({sortKey:Ve,symbolInstanceStart:yt,symbolInstanceEnd:ze,parameters:je})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:je})}attemptAnchorPlacement(n,o,f,x,b,C,M,j,F,z,G,Q,re,ie,ne,se,W,te){const{textOffset0:le,textOffset1:ue,crossTileID:ke}=Q,Ee=[le,ue],Se=_s(n,f,x,Ee,b),je=this.collisionIndex.placeCollisionBox(ie,b,o,vs(Se.x,Se.y,C,M,this.transform.angle),G,j,F,z.predicate);if(se){const Ie=ie.getSymbolInstanceIconSize(te,this.transform.zoom,Q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ie,Ie,se,vs(Se.x,Se.y,C,M,this.transform.angle),G,j,F,z.predicate).box.length===0)return}if(je.box.length>0){let Ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[ke]&&this.prevPlacement.placements[ke]&&this.prevPlacement.placements[ke].text&&(Ie=this.prevPlacement.variableOffsets[ke].anchor),this.variableOffsets[ke]={textOffset:Ee,width:f,height:x,anchor:n,textScale:b,prevAnchor:Ie},this.markUsedJustification(ie,n,Q,ne),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,ne,Q),this.placedOrientations[ke]=ne),{shift:Se,placedGlyphBoxes:je}}}placeLayerBucketPart(n,o,f,x){const{bucket:b,layout:C,posMatrix:M,textLabelPlaneMatrix:j,labelToScreenMatrix:F,clippingData:z,textPixelRatio:G,holdingForFade:Q,collisionBoxArray:re,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:ne,collisionGroup:se}=n.parameters,W=C.get("text-optional"),te=C.get("icon-optional"),le=C.get("text-allow-overlap"),ue=C.get("icon-allow-overlap"),ke=C.get("text-rotation-alignment")==="map",Ee=C.get("text-pitch-alignment")==="map",Se=C.get("icon-text-fit")!=="none",je=C.get("symbol-z-order")==="viewport-y";this.transform.setProjection(b.projection);let Ie=le&&(ue||!b.hasIconData()||te),Ve=ue&&(le||!b.hasTextData()||W);!b.collisionArrays&&re&&b.deserializeCollisionBoxes(re),f&&x&&b.updateCollisionDebugBuffers(this.transform.zoom,re);const yt=(ze,nt,We)=>{const{crossTileID:mt,numVerticalGlyphVertices:Ue}=ze;if(z){const _r={zoom:this.transform.zoom,pitch:this.transform.pitch};let tn=null;if(z.dynamicFilterNeedsFeature){const $r=this.retainedQueryData[b.bucketInstanceId];tn=z.featureIndex.loadFeature({featureIndex:ze.featureIndex,bucketIndex:$r.bucketIndex,sourceLayerIndex:$r.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(_r,tn,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new i.Point(ze.tileAnchorX,ze.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[mt]=new tl(!1,!1,!1,!0),void o.add(mt)}if(o.has(mt))return;if(Q)return void(this.placements[mt]=new tl(!1,!1,!1));let it=!1,ft=!1,pt=!0,vt=!1,Wt=!1,or=null,Vt={box:null,offscreen:null,occluded:null},tr={box:null},Sr=null,Pr=null,Zt=null,Dr=0,Xr=0,Kr=0;We.textFeatureIndex?Dr=We.textFeatureIndex:ze.useRuntimeCollisionCircles&&(Dr=ze.featureIndex),We.verticalTextFeatureIndex&&(Xr=We.verticalTextFeatureIndex);const qr=_r=>{_r.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const tn=this.transform.elevation;(tn||_r.elevation)&&(_r.elevation=tn?tn.getAtTileOffset(_r.tileID,_r.tileAnchorX,_r.tileAnchorY):0)},mi=We.textBox;if(mi){qr(mi);const _r=$r=>{let jn=i.WritingMode.horizontal;if(b.allowVerticalPlacement&&!$r&&this.prevPlacement){const gi=this.prevPlacement.placedOrientations[mt];gi&&(this.placedOrientations[mt]=gi,jn=gi,this.markUsedOrientation(b,jn,ze))}return jn},tn=($r,jn)=>{if(b.allowVerticalPlacement&&Ue>0&&We.verticalTextBox){for(const gi of b.writingModes)if(gi===i.WritingMode.vertical?(Vt=jn(),tr=Vt):Vt=$r(),Vt&&Vt.box&&Vt.box.length)break}else Vt=$r()};if(C.get("text-variable-anchor")){let $r=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[mt]){const ln=this.prevPlacement.variableOffsets[mt];$r.indexOf(ln.anchor)>0&&($r=$r.filter((Hn=>Hn!==ln.anchor)),$r.unshift(ln.anchor))}const jn=(ln,Hn,bn)=>{const kn=b.getSymbolInstanceTextSize(ie,ze,this.transform.zoom,nt),Bn=(ln.x2-ln.x1)*kn+2*ln.padding,Ms=(ln.y2-ln.y1)*kn+2*ln.padding,As=Se&&!ue?Hn:null;As&&qr(As);let $s={box:[],offscreen:!1,occluded:!1};const fu=le?2*$r.length:$r.length;for(let Xn=0;Xn<fu;++Xn){const bc=this.attemptAnchorPlacement($r[Xn%$r.length],ln,Bn,Ms,kn,ke,Ee,G,M,se,Xn>=$r.length,ze,nt,b,bn,As,ie,ne);if(bc&&($s=bc.placedGlyphBoxes,$s&&$s.box&&$s.box.length)){it=!0,or=bc.shift;break}}return $s};tn((()=>jn(mi,We.iconBox,i.WritingMode.horizontal)),(()=>{const ln=We.verticalTextBox;return ln&&qr(ln),b.allowVerticalPlacement&&!(Vt&&Vt.box&&Vt.box.length)&&Ue>0&&ln?jn(ln,We.verticalIconBox,i.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),Vt&&(it=Vt.box,pt=Vt.offscreen,vt=Vt.occluded);const gi=_r(!(!Vt||!Vt.box));if(!it&&this.prevPlacement){const ln=this.prevPlacement.variableOffsets[mt];ln&&(this.variableOffsets[mt]=ln,this.markUsedJustification(b,ln.anchor,ze,gi))}}else{const $r=(jn,gi)=>{const ln=b.getSymbolInstanceTextSize(ie,ze,this.transform.zoom,nt),Hn=this.collisionIndex.placeCollisionBox(b,ln,jn,new i.Point(0,0),le,G,M,se.predicate);return Hn&&Hn.box&&Hn.box.length&&(this.markUsedOrientation(b,gi,ze),this.placedOrientations[mt]=gi),Hn};tn((()=>$r(mi,i.WritingMode.horizontal)),(()=>{const jn=We.verticalTextBox;return b.allowVerticalPlacement&&Ue>0&&jn?(qr(jn),$r(jn,i.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),_r(!!(Vt&&Vt.box&&Vt.box.length))}}if(Sr=Vt,it=Sr&&Sr.box&&Sr.box.length>0,pt=Sr&&Sr.offscreen,vt=Sr&&Sr.occluded,ze.useRuntimeCollisionCircles){const _r=b.text.placedSymbolArray.get(ze.centerJustifiedTextSymbolIndex>=0?ze.centerJustifiedTextSymbolIndex:ze.verticalPlacedTextSymbolIndex),tn=i.evaluateSizeForFeature(b.textSizeData,ie,_r),$r=C.get("text-padding");Pr=this.collisionIndex.placeCollisionCircles(b,le,_r,b.lineVertexArray,b.glyphOffsetArray,tn,M,j,F,f,Ee,se.predicate,ze.collisionCircleDiameter*tn/i.ONE_EM,$r,this.retainedQueryData[b.bucketInstanceId].tileID),it=le||Pr.circles.length>0&&!Pr.collisionDetected,pt=pt&&Pr.offscreen,vt=Pr.occluded}if(We.iconFeatureIndex&&(Kr=We.iconFeatureIndex),We.iconBox){const _r=tn=>{qr(tn);const $r=Se&&or?vs(or.x,or.y,ke,Ee,this.transform.angle):new i.Point(0,0),jn=b.getSymbolInstanceIconSize(ne,this.transform.zoom,ze.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,jn,tn,$r,ue,G,M,se.predicate)};tr&&tr.box&&tr.box.length&&We.verticalIconBox?(Zt=_r(We.verticalIconBox),ft=Zt.box.length>0):(Zt=_r(We.iconBox),ft=Zt.box.length>0),pt=pt&&Zt.offscreen,Wt=Zt.occluded}const In=W||ze.numHorizontalGlyphVertices===0&&Ue===0,us=te||ze.numIconVertices===0;if(In||us?us?In||(ft=ft&&it):it=ft&&it:ft=it=ft&&it,it&&Sr&&Sr.box&&this.collisionIndex.insertCollisionBox(Sr.box,C.get("text-ignore-placement"),b.bucketInstanceId,tr&&tr.box&&Xr?Xr:Dr,se.ID),ft&&Zt&&this.collisionIndex.insertCollisionBox(Zt.box,C.get("icon-ignore-placement"),b.bucketInstanceId,Kr,se.ID),Pr&&(it&&this.collisionIndex.insertCollisionCircles(Pr.circles,C.get("text-ignore-placement"),b.bucketInstanceId,Dr,se.ID),f)){const _r=b.bucketInstanceId;let tn=this.collisionCircleArrays[_r];tn===void 0&&(tn=this.collisionCircleArrays[_r]=new rl);for(let $r=0;$r<Pr.circles.length;$r+=4)tn.circles.push(Pr.circles[$r+0]),tn.circles.push(Pr.circles[$r+1]),tn.circles.push(Pr.circles[$r+2]),tn.circles.push(Pr.collisionDetected?1:0)}const Cs=b.projection.name!=="globe";Ie=Ie&&(Cs||!vt),Ve=Ve&&(Cs||!Wt),this.placements[mt]=new tl(it||Ie,ft||Ve,pt||b.justReloaded),o.add(mt)};if(je){const ze=b.getSortedSymbolIndexes(this.transform.angle);for(let nt=ze.length-1;nt>=0;--nt){const We=ze[nt];yt(b.symbolInstances.get(We),We,b.collisionArrays[We])}}else for(let ze=n.symbolInstanceStart;ze<n.symbolInstanceEnd;ze++)yt(b.symbolInstances.get(ze),ze,b.collisionArrays[ze]);if(f&&b.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[b.bucketInstanceId];i.invert(ze.invProjMatrix,M),ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(n,o,f,x){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:j,crossTileID:F}=f,z=i.getAnchorJustification(o),G=x===i.WritingMode.vertical?j:z==="left"?b:z==="center"?C:z==="right"?M:-1;b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=G>=0&&b!==G?0:F),C>=0&&(n.text.placedSymbolArray.get(C).crossTileID=G>=0&&C!==G?0:F),M>=0&&(n.text.placedSymbolArray.get(M).crossTileID=G>=0&&M!==G?0:F),j>=0&&(n.text.placedSymbolArray.get(j).crossTileID=G>=0&&j!==G?0:F)}markUsedOrientation(n,o,f){const x=o===i.WritingMode.horizontal||o===i.WritingMode.horizontalOnly?o:0,b=o===i.WritingMode.vertical?o:0,{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:j,verticalPlacedTextSymbolIndex:F}=f,z=n.text.placedSymbolArray;C>=0&&(z.get(C).placedOrientation=x),M>=0&&(z.get(M).placedOrientation=x),j>=0&&(z.get(j).placedOrientation=x),F>=0&&(z.get(F).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let f=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const x=o?o.symbolFadeChange(n):1,b=o?o.opacities:{},C=o?o.variableOffsets:{},M=o?o.placedOrientations:{};for(const j in this.placements){const F=this.placements[j],z=b[j];z?(this.opacities[j]=new ea(z,x,F.text,F.icon,null,F.clipped),f=f||F.text!==z.text.placed||F.icon!==z.icon.placed):(this.opacities[j]=new ea(null,x,F.text,F.icon,F.skipFade,F.clipped),f=f||F.text||F.icon)}for(const j in b){const F=b[j];if(!this.opacities[j]){const z=new ea(F,x,!1,!1);z.isHidden()||(this.opacities[j]=z,f=f||F.text.placed||F.icon.placed)}}for(const j in C)this.variableOffsets[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.variableOffsets[j]=C[j]);for(const j in M)this.placedOrientations[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.placedOrientations[j]=M[j]);f?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:n)}updateLayerOpacities(n,o){const f=new Set;for(const x of o){const b=x.getBucket(n);b&&x.latestFeatureIndex&&n.id===b.layerIds[0]&&this.updateBucketOpacities(b,f,x.collisionBoxArray)}}updateBucketOpacities(n,o,f){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const x=n.layers[0].layout,b=!!n.layers[0].dynamicFilter(),C=new ea(null,0,!1,!1,!0),M=x.get("text-allow-overlap"),j=x.get("icon-allow-overlap"),F=x.get("text-variable-anchor"),z=x.get("text-rotation-alignment")==="map",G=x.get("text-pitch-alignment")==="map",Q=x.get("icon-text-fit")!=="none",re=new ea(null,0,M&&(j||!n.hasIconData()||x.get("icon-optional")),j&&(M||!n.hasTextData()||x.get("text-optional")),!0);!n.collisionArrays&&f&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(f);const ie=(se,W,te)=>{for(let le=0;le<W/4;le++)se.opacityVertexArray.emplaceBack(te)};let ne=0;for(let se=0;se<n.symbolInstances.length;se++){const W=n.symbolInstances.get(se),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:le,crossTileID:ue,numIconVertices:ke}=W,Ee=o.has(ue);let Se=this.opacities[ue];Ee?Se=C:Se||(Se=re,this.opacities[ue]=Se),o.add(ue);const je=te>0||le>0,Ie=ke>0,Ve=this.placedOrientations[ue],yt=Ve===i.WritingMode.vertical,ze=Ve===i.WritingMode.horizontal||Ve===i.WritingMode.horizontalOnly;if(!je&&!Ie||Se.isHidden()||ne++,je){const nt=Va(Se.text);ie(n.text,te,yt?Cn:nt),ie(n.text,le,ze?Cn:nt);const We=Se.text.isHidden(),{leftJustifiedTextSymbolIndex:mt,centerJustifiedTextSymbolIndex:Ue,rightJustifiedTextSymbolIndex:it,verticalPlacedTextSymbolIndex:ft}=W,pt=n.text.placedSymbolArray,vt=We||yt?1:0;mt>=0&&(pt.get(mt).hidden=vt),Ue>=0&&(pt.get(Ue).hidden=vt),it>=0&&(pt.get(it).hidden=vt),ft>=0&&(pt.get(ft).hidden=We||ze?1:0);const Wt=this.variableOffsets[ue];Wt&&this.markUsedJustification(n,Wt.anchor,W,Ve);const or=this.placedOrientations[ue];or&&(this.markUsedJustification(n,"left",W,or),this.markUsedOrientation(n,or,W))}if(Ie){const nt=Va(Se.icon),{placedIconSymbolIndex:We,verticalPlacedIconSymbolIndex:mt}=W,Ue=n.icon.placedSymbolArray,it=Se.icon.isHidden()?1:0;We>=0&&(ie(n.icon,ke,yt?Cn:nt),Ue.get(We).hidden=it),mt>=0&&(ie(n.icon,W.numVerticalIconVertices,ze?Cn:nt),Ue.get(mt).hidden=it)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const nt=n.collisionArrays[se];if(nt){let We=new i.Point(0,0),mt=!0;if(nt.textBox||nt.verticalTextBox){if(F){const it=this.variableOffsets[ue];it?(We=_s(it.anchor,it.width,it.height,it.textOffset,it.textScale),z&&We._rotate(G?this.transform.angle:-this.transform.angle)):mt=!1}b&&(mt=!Se.clipped),nt.textBox&&ta(n.textCollisionBox.collisionVertexArray,Se.text.placed,!mt||yt,We.x,We.y),nt.verticalTextBox&&ta(n.textCollisionBox.collisionVertexArray,Se.text.placed,!mt||ze,We.x,We.y)}const Ue=mt&&!!(!ze&&nt.verticalIconBox);nt.iconBox&&ta(n.iconCollisionBox.collisionVertexArray,Se.icon.placed,Ue,Q?We.x:0,Q?We.y:0),nt.verticalIconBox&&ta(n.iconCollisionBox.collisionVertexArray,Se.icon.placed,!Ue,Q?We.x:0,Q?We.y:0)}}}if(n.fullyClipped=ne===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=se.invProjMatrix,n.placementViewportMatrix=se.viewportMatrix,n.collisionCircleArray=se.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,o){const f=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*f>n}setStale(){this.stale=!0}}function ta(d,n,o,f,x){d.emplaceBack(n?1:0,o?1:0,f||0,x||0),d.emplaceBack(n?1:0,o?1:0,f||0,x||0),d.emplaceBack(n?1:0,o?1:0,f||0,x||0),d.emplaceBack(n?1:0,o?1:0,f||0,x||0)}const di=Math.pow(2,25),on=Math.pow(2,24),Wu=Math.pow(2,17),Zc=Math.pow(2,16),pi=Math.pow(2,9),bs=Math.pow(2,8),qu=Math.pow(2,1);function Va(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const n=d.placed?1:0,o=Math.floor(127*d.opacity);return o*di+n*on+o*Wu+n*Zc+o*pi+n*bs+o*qu+n}const Cn=0;class Jl{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,o,f,x,b){const C=this._bucketParts;for(;this._currentTileIndex<n.length;)if(o.getBucketParts(C,x,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(((M,j)=>M.sortKey-j.sortKey)));this._currentPartIndex<C.length;){const M=C[this._currentPartIndex];if(o.placeLayerBucketPart(M,this._seenCrossTileIDs,f,M.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class _o{constructor(n,o,f,x,b,C,M,j){this.placement=new zs(n,b,C,M,j),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(n,o,f){const x=i.exported.now(),b=()=>{const C=i.exported.now()-x;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=o[n[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=M)&&(!C.maxzoom||C.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Jl(C)),this._inProgressLayer.continuePlacement(f[C.source],this.placement,this._showCollisionBoxes,C,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Bs=512/i.EXTENT/2;class zn{constructor(n,o,f){this.tileID=n,this.bucketInstanceId=f,this.index=new i.KDBush(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=n.canonical.x*i.EXTENT,b=n.canonical.y*i.EXTENT;for(let C=0;C<o.length;C++){const{key:M,crossTileID:j,tileAnchorX:F,tileAnchorY:z}=o.get(C),G=Math.floor((x+F)*Bs),Q=Math.floor((b+z)*Bs);this.index.add(G,Q),this.keys.push(M),this.crossTileIDs.push(j)}this.index.finish()}findMatches(n,o,f){const x=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),b=Bs/Math.pow(2,o.canonical.z-this.tileID.canonical.z),C=o.canonical.x*i.EXTENT,M=o.canonical.y*i.EXTENT;for(let j=0;j<n.length;j++){const F=n.get(j);if(F.crossTileID)continue;const{key:z,tileAnchorX:G,tileAnchorY:Q}=F,re=Math.floor((C+G)*b),ie=Math.floor((M+Q)*b),ne=this.index.range(re-x,ie-x,re+x,ie+x);for(const se of ne){const W=this.crossTileIDs[se];if(this.keys[se]===z&&!f.has(W)){f.add(W),F.crossTileID=W;break}}}}}class nl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Zu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const o=Math.round((n-this.lng)/360);if(o!==0)for(const f in this.indexes){const x=this.indexes[f],b={};for(const C in x){const M=x[C];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+o),b[M.tileID.key]=M}this.indexes[f]=b}this.lng=n}addBucket(n,o,f){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<o.symbolInstances.length;b++)o.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const x=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const C=this.indexes[b];if(Number(b)>n.overscaledZ)for(const M in C){const j=C[M];j.tileID.isChildOf(n)&&j.findMatches(o.symbolInstances,n,x)}else{const M=C[n.scaledTo(Number(b)).key];M&&M.findMatches(o.symbolInstances,n,x)}}for(let b=0;b<o.symbolInstances.length;b++){const C=o.symbolInstances.get(b);C.crossTileID||(C.crossTileID=f.generate(),x.add(C.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new zn(n,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(n,o){for(const f of o.crossTileIDs)this.usedCrossTileIDs[n].delete(f)}removeStaleBuckets(n){let o=!1;for(const f in this.indexes){const x=this.indexes[f];for(const b in x)n[x[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,x[b]),delete x[b],o=!0)}return o}}class va{constructor(){this.layerIndexes={},this.crossTileIDs=new nl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,o,f,x){let b=this.layerIndexes[n.id];b===void 0&&(b=this.layerIndexes[n.id]=new Zu);let C=!1;const M={};x.name!=="globe"&&b.handleWrapJump(f);for(const j of o){const F=j.getBucket(n);F&&n.id===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(j.tileID,F,this.crossTileIDs)&&(C=!0),M[F.bucketInstanceId]=!0)}return b.removeStaleBuckets(M)&&(C=!0),C}pruneUnusedLayers(n){const o={};n.forEach((f=>{o[f]=!0}));for(const f in this.layerIndexes)o[f]||delete this.layerIndexes[f]}}const ra=(d,n)=>i.emitValidationErrors(d,n&&n.filter((o=>o.identifier!=="source.canvas"))),vo=i.pick(Zr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Hu=i.pick(Zr,["setCenter","setZoom","setBearing","setPitch"]),Hc={version:8,layers:[],sources:{}},as={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ws extends i.Evented{constructor(n,o={}){super(),this.map=n,this.dispatcher=new ve(yo(),this),this.imageManager=new tt,this.imageManager.setEventedParent(this),this.glyphManager=new i.GlyphManager(n._requestManager,o.localFontFamily?i.LocalGlyphMode.all:o.localIdeographFontFamily?i.LocalGlyphMode.ideographs:i.LocalGlyphMode.none,o.localFontFamily||o.localIdeographFontFamily),this.crossTileSymbolIndex=new va,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",i.getReferrer());const f=this;this._rtlTextPluginCallback=ws.registerForPluginStateChange((x=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},((b,C)=>{if(i.triggerPluginCompletionEvent(b),C&&C.every((M=>M)))for(const M in f._sourceCaches){const j=f._sourceCaches[M],F=j.getSource().type;F!=="vector"&&F!=="geojson"||j.reload()}}))})),this.on("data",(x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const b=this.getSource(x.sourceId);if(b&&b.vectorLayerIds)for(const C in this._layers){const M=this._layers[C];M.source===b.id&&this._validateLayer(M)}}))}loadURL(n,o={}){this.fire(new i.Event("dataloading",{dataType:"style"}));const f=typeof o.validate=="boolean"?o.validate:!i.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,o.accessToken);const x=this.map._requestManager.transformRequest(n,i.ResourceType.Style);this._request=i.getJSON(x,((b,C)=>{this._request=null,b?this.fire(new i.ErrorEvent(b)):C&&this._load(C,f)}))}loadJSON(n,o={}){this.fire(new i.Event("dataloading",{dataType:"style"})),this._request=i.exported.frame((()=>{this._request=null,this._load(n,o.validate!==!1)}))}loadEmpty(){this.fire(new i.Event("dataloading",{dataType:"style"})),this._load(Hc,!1)}_updateLayerCount(n,o){const f=o?1:-1;n.is3D()&&(this._num3DLayers+=f),n.type==="circle"&&(this._numCircleLayers+=f),n.type==="symbol"&&(this._numSymbolLayers+=f)}_load(n,o){if(o&&ra(this,i.validateStyle(n)))return;this._loaded=!0,this.stylesheet=i.clone$1(n),this._updateMapProjection();for(const x in n.sources)this.addSource(x,n.sources[x],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const f=Vu(this.stylesheet.layers);this._order=f.map((x=>x.id)),this._layers={},this._serializedLayers={};for(const x of f){const b=i.createStyleLayer(x);b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Kt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new i.Event("data",{dataType:"style"})),this.fire(new i.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=(function(o,f,x){let b,C,M;const j=i.exported.devicePixelRatio>1?"@2x":"";let F=i.getJSON(f.transformRequest(f.normalizeSpriteURL(o,j,".json"),i.ResourceType.SpriteJSON),((Q,re)=>{F=null,M||(M=Q,b=re,G())})),z=i.getImage(f.transformRequest(f.normalizeSpriteURL(o,j,".png"),i.ResourceType.SpriteImage),((Q,re)=>{z=null,M||(M=Q,C=re,G())}));function G(){if(M)x(M);else if(b&&C){const Q=i.exported.getImageData(C),re={};for(const ie in b){const{width:ne,height:se,x:W,y:te,sdf:le,pixelRatio:ue,stretchX:ke,stretchY:Ee,content:Se}=b[ie],je=new i.RGBAImage({width:ne,height:se});i.RGBAImage.copy(Q,je,{x:W,y:te},{x:0,y:0},{width:ne,height:se}),re[ie]={data:je,pixelRatio:ue,sdf:le,stretchX:ke,stretchY:Ee,content:Se}}x(null,re)}}return{cancel(){F&&(F.cancel(),F=null),z&&(z.cancel(),z=null)}}})(n,this.map._requestManager,((o,f)=>{if(this._spriteRequest=null,o)this.fire(new i.ErrorEvent(o));else if(f)for(const x in f)this.imageManager.addImage(x,f[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new i.Event("data",{dataType:"style"}))}))}_validateLayer(n){const o=this.getSource(n.source);if(!o)return;const f=n.sourceLayer;f&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(f)===-1)&&this.fire(new i.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${o.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const o=[];for(const f of n){const x=this._layers[f];x.type!=="custom"&&o.push(x.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&(typeof n.isLayerDraped=="function"?n.isLayerDraped():as[n.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const o=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(x.length||b.length)&&this._updateWorkerLayers(x,b);for(const C in this._updatedSources){const M=this._updatedSources[C];M==="reload"?this._reloadSource(C):M==="clear"&&this._clearSource(C)}this._updateTilesForChangedImages();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const f={};for(const x in this._sourceCaches){const b=this._sourceCaches[x];f[x]=b.used,b.used=!1}for(const x of this._order){const b=this._layers[x];if(b.recalculate(n,this._availableImages),!b.isHidden(n.zoom)){const M=this._getLayerSourceCache(b);M&&(M.used=!0)}const C=this.map.painter;if(C){const M=b.getProgramIds();if(!M)continue;const j=b.getProgramConfiguration(n.zoom);for(const F of M)C.useProgram(F,j)}}for(const x in f){const b=this._sourceCaches[x];f[x]!==b.used&&b.getSource().fire(new i.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new i.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),ra(this,i.validateStyle(n)))return!1;(n=i.clone$1(n)).layers=Vu(n.layers);const o=(function(x,b){if(!x)return[{command:Zr.setStyle,args:[b]}];let C=[];try{if(!R(x.version,b.version))return[{command:Zr.setStyle,args:[b]}];R(x.center,b.center)||C.push({command:Zr.setCenter,args:[b.center]}),R(x.zoom,b.zoom)||C.push({command:Zr.setZoom,args:[b.zoom]}),R(x.bearing,b.bearing)||C.push({command:Zr.setBearing,args:[b.bearing]}),R(x.pitch,b.pitch)||C.push({command:Zr.setPitch,args:[b.pitch]}),R(x.sprite,b.sprite)||C.push({command:Zr.setSprite,args:[b.sprite]}),R(x.glyphs,b.glyphs)||C.push({command:Zr.setGlyphs,args:[b.glyphs]}),R(x.transition,b.transition)||C.push({command:Zr.setTransition,args:[b.transition]}),R(x.light,b.light)||C.push({command:Zr.setLight,args:[b.light]}),R(x.fog,b.fog)||C.push({command:Zr.setFog,args:[b.fog]}),R(x.projection,b.projection)||C.push({command:Zr.setProjection,args:[b.projection]});const M={},j=[];(function(G,Q,re,ie){let ne;for(ne in Q=Q||{},G=G||{})G.hasOwnProperty(ne)&&(Q.hasOwnProperty(ne)||Xl(ne,re,ie));for(ne in Q){if(!Q.hasOwnProperty(ne))continue;const se=Q[ne];G.hasOwnProperty(ne)?R(G[ne],se)||(G[ne].type==="geojson"&&se.type==="geojson"&&Wc(G,Q,ne)?re.push({command:Zr.setGeoJSONSourceData,args:[ne,se.data]}):Pn(ne,Q,re,ie)):$u(ne,Q,re)}})(x.sources,b.sources,j,M);const F=[];x.layers&&x.layers.forEach((G=>{G.source&&M[G.source]?C.push({command:Zr.removeLayer,args:[G.id]}):F.push(G)}));let z=x.terrain;z&&M[z.source]&&(C.push({command:Zr.setTerrain,args:[void 0]}),z=void 0),C=C.concat(j),R(z,b.terrain)||C.push({command:Zr.setTerrain,args:[b.terrain]}),(function(G,Q,re){Q=Q||[];const ie=(G=G||[]).map(Qs),ne=Q.map(Qs),se=G.reduce(Jo,{}),W=Q.reduce(Jo,{}),te=ie.slice(),le=Object.create(null);let ue,ke,Ee,Se,je,Ie,Ve;for(ue=0,ke=0;ue<ie.length;ue++)Ee=ie[ue],W.hasOwnProperty(Ee)?ke++:(re.push({command:Zr.removeLayer,args:[Ee]}),te.splice(te.indexOf(Ee,ke),1));for(ue=0,ke=0;ue<ne.length;ue++)Ee=ne[ne.length-1-ue],te[te.length-1-ue]!==Ee&&(se.hasOwnProperty(Ee)?(re.push({command:Zr.removeLayer,args:[Ee]}),te.splice(te.lastIndexOf(Ee,te.length-ke),1)):ke++,Ie=te[te.length-ue],re.push({command:Zr.addLayer,args:[W[Ee],Ie]}),te.splice(te.length-ue,0,Ee),le[Ee]=!0);for(ue=0;ue<ne.length;ue++)if(Ee=ne[ue],Se=se[Ee],je=W[Ee],!le[Ee]&&!R(Se,je))if(R(Se.source,je.source)&&R(Se["source-layer"],je["source-layer"])&&R(Se.type,je.type)){for(Ve in ys(Se.layout,je.layout,re,Ee,null,Zr.setLayoutProperty),ys(Se.paint,je.paint,re,Ee,null,Zr.setPaintProperty),R(Se.filter,je.filter)||re.push({command:Zr.setFilter,args:[Ee,je.filter]}),R(Se.minzoom,je.minzoom)&&R(Se.maxzoom,je.maxzoom)||re.push({command:Zr.setLayerZoomRange,args:[Ee,je.minzoom,je.maxzoom]}),Se)Se.hasOwnProperty(Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?ys(Se[Ve],je[Ve],re,Ee,Ve.slice(6),Zr.setPaintProperty):R(Se[Ve],je[Ve])||re.push({command:Zr.setLayerProperty,args:[Ee,Ve,je[Ve]]}));for(Ve in je)je.hasOwnProperty(Ve)&&!Se.hasOwnProperty(Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?ys(Se[Ve],je[Ve],re,Ee,Ve.slice(6),Zr.setPaintProperty):R(Se[Ve],je[Ve])||re.push({command:Zr.setLayerProperty,args:[Ee,Ve,je[Ve]]}))}else re.push({command:Zr.removeLayer,args:[Ee]}),Ie=te[te.lastIndexOf(Ee)+1],re.push({command:Zr.addLayer,args:[je,Ie]})})(F,b.layers,C)}catch(M){console.warn("Unable to compute style diff:",M),C=[{command:Zr.setStyle,args:[b]}]}return C})(this.serialize(),n).filter((x=>!(x.command in Hu)));if(o.length===0)return!1;const f=o.filter((x=>!(x.command in vo)));if(f.length>0)throw new Error(`Unimplemented: ${f.map((x=>x.command)).join(", ")}.`);return o.forEach((x=>{x.command!=="setTransition"&&x.command!=="setProjection"&&this[x.command].apply(this,x.args)})),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,o){return this.getImage(n)?this.fire(new i.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,o),this._afterImageUpdated(n),this)}updateImage(n,o){this.imageManager.updateImage(n,o)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new i.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new i.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,o,f={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(i.validateSource,`sources.${n}`,o,null,f))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const x=vr(n,o,this.dispatcher,this);x.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:x.serialize(),sourceId:n})));const b=C=>{const M=(C?"symbol:":"other:")+n,j=this._sourceCaches[M]=new i.SourceCache(M,x,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[n]=j,j.style=this,j.onAdd(this.map)};b(!1),o.type!=="vector"&&o.type!=="geojson"||b(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const o=this.getSource(n);if(!o)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===n)return this.fire(new i.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new i.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const f=this._getSourceCaches(n);for(const x of f)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new i.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,o){this._checkLoaded(),this.getSource(n).setData(o),this._changed=!0}getSource(n){const o=this._getSourceCache(n);return o&&o.getSource()}_getSources(){const n=[];for(const o in this._otherSourceCaches){const f=this._getSourceCache(o);f&&n.push(f.getSource())}return n}addLayer(n,o,f={}){this._checkLoaded();const x=n.id;if(this.getLayer(x))return void this.fire(new i.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let b;if(n.type==="custom"){if(ra(this,i.validateCustomStyleLayer(n)))return;b=i.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(x,n.source),n=i.clone$1(n),n=i.extend(n,{source:x})),this._validate(i.validateLayer,`layers.${x}`,n,{arrayIndex:-1},f))return;b=i.createStyleLayer(n),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const C=o?this._order.indexOf(o):this._order.length;if(o&&C===-1)return void this.fire(new i.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`)));this._order.splice(C,0,x),this._layerOrderChanged=!0,this._layers[x]=b;const M=this._getLayerSourceCache(b);if(this._removedLayers[x]&&b.source&&M&&b.type!=="custom"){const j=this._removedLayers[x];delete this._removedLayers[x],j.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",M.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,o){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new i.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===o)return;const f=this._order.indexOf(n);this._order.splice(f,1);const x=o?this._order.indexOf(o):this._order.length;o&&x===-1?this.fire(new i.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`))):(this._order.splice(x,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const o=this._layers[n];if(!o)return void this.fire(new i.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));o.setEventedParent(null),this._updateLayerCount(o,!1);const f=this._order.indexOf(n);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=o,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],o.onRemove&&o.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const o in this._layers)if(this._layers[o].type===n)return!0;return!1}setLayerZoomRange(n,o,f){this._checkLoaded();const x=this.getLayer(n);x?x.minzoom===o&&x.maxzoom===f||(o!=null&&(x.minzoom=o),f!=null&&(x.maxzoom=f),this._updateLayer(x)):this.fire(new i.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,o,f={}){this._checkLoaded();const x=this.getLayer(n);if(x){if(!R(x.filter,o))return o==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(i.validateFilter,`layers.${x.id}.filter`,o,{layerType:x.type},f)||(x.filter=i.clone$1(o),this._updateLayer(x)))}else this.fire(new i.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const o=this.getLayer(n);return o&&i.clone$1(o.filter)}setLayoutProperty(n,o,f,x={}){this._checkLoaded();const b=this.getLayer(n);b?R(b.getLayoutProperty(o),f)||(b.setLayoutProperty(o,f,x),this._updateLayer(b)):this.fire(new i.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,o){const f=this.getLayer(n);if(f)return f.getLayoutProperty(o);this.fire(new i.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,o,f,x={}){this._checkLoaded();const b=this.getLayer(n);b?R(b.getPaintProperty(o),f)||(b.setPaintProperty(o,f,x)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new i.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,o){const f=this.getLayer(n);return f&&f.getPaintProperty(o)}setFeatureState(n,o){this._checkLoaded();const f=n.source,x=n.sourceLayer,b=this.getSource(f);if(!b)return void this.fire(new i.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const C=b.type;if(C==="geojson"&&x)return void this.fire(new i.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(C==="vector"&&!x)return void this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new i.ErrorEvent(new Error("The feature id parameter must be provided.")));const M=this._getSourceCaches(f);for(const j of M)j.setFeatureState(x,n.id,o)}removeFeatureState(n,o){this._checkLoaded();const f=n.source,x=this.getSource(f);if(!x)return void this.fire(new i.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const b=x.type,C=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!C)return void this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new i.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const M=this._getSourceCaches(f);for(const j of M)j.removeFeatureState(C,n.id,o)}getFeatureState(n){this._checkLoaded();const o=n.source,f=n.sourceLayer,x=this.getSource(o);if(x){if(x.type!=="vector"||f)return n.id===void 0&&this.fire(new i.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(o)[0].getFeatureState(f,n.id);this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new i.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return i.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const o in this._sourceCaches){const f=this._sourceCaches[o].getSource();n[f.id]||(n[f.id]=f.serialize())}return i.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},(o=>o!==void 0))}_updateLayer(n){this._updatedLayers[n.id]=!0;const o=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&o&&o.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",o.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const o=C=>this._layers[C].type==="fill-extrusion",f={},x=[];for(let C=this._order.length-1;C>=0;C--){const M=this._order[C];if(o(M)){f[M]=C;for(const j of n){const F=j[M];if(F)for(const z of F)x.push(z)}}}x.sort(((C,M)=>M.intersectionZ-C.intersectionZ));const b=[];for(let C=this._order.length-1;C>=0;C--){const M=this._order[C];if(o(M))for(let j=x.length-1;j>=0;j--){const F=x[j].feature;if(f[F.layer.id]<C)break;b.push(F),x.pop()}else for(const j of n){const F=j[M];if(F)for(const z of F)b.push(z.feature)}}return b}queryRenderedFeatures(n,o,f){o&&o.filter&&this._validate(i.validateFilter,"queryRenderedFeatures.filter",o.filter,null,o);const x={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new i.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const j of o.layers){const F=this._layers[j];if(!F)return this.fire(new i.ErrorEvent(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];x[F.source]=!0}}const b=[];o.availableImages=this._availableImages;const C=o&&o.layers?o.layers.some((j=>{const F=this.getLayer(j);return F&&F.is3D()})):this.has3DLayers(),M=Ut.createFromScreenPoints(n,f);for(const j in this._sourceCaches){const F=this._sourceCaches[j].getSource().id;o.layers&&!x[F]||b.push(Tn(this._sourceCaches[j],this._layers,this._serializedLayers,M,o,f,C,!!this.map._showQueryGeometry))}return this.placement&&b.push((function(j,F,z,G,Q,re,ie){const ne={},se=re.queryRenderedSymbols(G),W=[];for(const te of Object.keys(se).map(Number))W.push(ie[te]);W.sort(Si);for(const te of W){const le=te.featureIndex.lookupSymbolFeatures(se[te.bucketInstanceId],F,te.bucketIndex,te.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,j);for(const ue in le){const ke=ne[ue]=ne[ue]||[],Ee=le[ue];Ee.sort(((Se,je)=>{const Ie=te.featureSortOrder;if(Ie){const Ve=Ie.indexOf(Se.featureIndex);return Ie.indexOf(je.featureIndex)-Ve}return je.featureIndex-Se.featureIndex}));for(const Se of Ee)ke.push(Se)}}for(const te in ne)ne[te].forEach((le=>{const ue=le.feature,ke=z(j[te]);if(!ke)return;const Ee=ke.getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=Ee}));return ne})(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),M.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(n,o){o&&o.filter&&this._validate(i.validateFilter,"querySourceFeatures.filter",o.filter,null,o);const f=this._getSourceCaches(n);let x=[];for(const b of f)x=x.concat($n(b,o));return x}addSourceType(n,o,f){return ws.getSourceType(n)?f(new Error(`A source type called "${n}" already exists.`)):(ws.setSourceType(n,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:o.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(n,o={}){this._checkLoaded();const f=this.light.getLight();let x=!1;for(const C in n)if(!R(n[C],f[C])){x=!0;break}if(!x)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,o),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,o=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let f=n;if(o===1){if(typeof f.source=="object"){const x="terrain-dem-src";this.addSource(x,f.source),f=i.clone$1(f),f=i.extend(f,{source:x})}if(this._validate(i.validateTerrain,"terrain",f))return}if(!this.terrain||this.terrain&&o!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,o)}else{const x=this.terrain,b=x.get();for(const C of Object.keys(i.spec.terrain))!f.hasOwnProperty(C)&&i.spec.terrain[C].default&&(f[C]=i.spec.terrain[C].default);for(const C in f)if(!R(f[C],b[C])){x.set(f),this.stylesheet.terrain=f;const M=this._setTransitionParameters({duration:0});x.updateTransitions(M);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const o=this.fog=new Je(n,this.map.transform);this.stylesheet.fog=n;const f=this._setTransitionParameters({duration:0});o.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const n of this.map._markers)n._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog,f=o.get();Object.keys(n).length===0&&o.set(n);for(const x in n)if(!R(n[x],f[x])){o.set(n),this.stylesheet.fog=n;const b=this._setTransitionParameters({duration:0});o.updateTransitions(b);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:i.exported.now(),transition:i.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter((f=>this.isLayerDraped(this._layers[f]))),o=this._order.filter((f=>!this.isLayerDraped(this._layers[f])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...o)}_createTerrain(n,o){const f=this.terrain=new Jt(n,o);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});f.updateTransitions(x)}_force3DLayerUpdate(){for(const n in this._layers){const o=this._layers[n];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const o=this._layers[n];o.type==="symbol"&&this._updateLayer(o)}}_validate(n,o,f,x,b={}){return(!b||b.validate!==!1)&&ra(this,n.call(i.validateStyle,i.extend({key:o,style:this.serialize(),value:f,styleSpec:i.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const o=this._getSourceCaches(n);for(const f of o)f.clearTiles()}_reloadSource(n){const o=this._getSourceCaches(n);for(const f of o)f.resume(),f.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const o in this._sourceCaches)this._sourceCaches[o].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const o=this._sourceCaches[n];o.resume(),o.reload()}}_updatePlacement(n,o,f,x,b=!1){let C=!1,M=!1;const j={};for(const F of this._order){const z=this._layers[F];if(z.type!=="symbol")continue;if(!j[z.source]){const Q=this._getLayerSourceCache(z);if(!Q)continue;j[z.source]=Q.getRenderableIds(!0).map((re=>Q.getTileByID(re))).sort(((re,ie)=>ie.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(ie.tileID)?-1:1)))}const G=this.crossTileSymbolIndex.addLayer(z,j[z.source],n.center.lng,n.projection);C=C||G}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new i.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.exported.now(),n.zoom))&&(this.pauseablePlacement=new _o(n,this._order,b,o,f,x,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.exported.now()),M=!0),C&&this.pauseablePlacement.placement.setStale()),M||C)for(const F of this._order){const z=this._layers[F];z.type==="symbol"&&this.placement.updateLayerOpacities(z,j[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,o,f){this.imageManager.getImages(o.icons,f),this._updateTilesForChangedImages();const x=b=>{b&&b.setDependencies(o.tileID.key,o.type,o.icons)};x(this._otherSourceCaches[o.source]),x(this._symbolSourceCaches[o.source])}getGlyphs(n,o,f){this.glyphManager.getGlyphs(o.stacks,f)}getResource(n,o,f){return i.makeRequest(o,f)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const o=[];return this._otherSourceCaches[n]&&o.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&o.push(this._symbolSourceCaches[n]),o}_isSourceCacheLoaded(n){const o=this._getSourceCaches(n);return o.length===0?(this.fire(new i.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):o.every((f=>f.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ws.getSourceType=function(d){return gr[d]},ws.setSourceType=function(d,n){gr[d]=n},ws.registerForPluginStateChange=i.registerForPluginStateChange;var il=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,$a="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ts=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Ga=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,na=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Ei={},Fs={};const bo=[];ia(il,bo),ia(Ts,bo),ia(Ga,bo),ia(na,bo),Ei=Ur("",Ts),Fs=Ur(na,Ga);const sl=Ur(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Xc=il,Ql=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var ec={background:Ur(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ur(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ur(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ur("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ur(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ur(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ur("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ur("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ur("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ur(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ur(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ur(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ur(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ur(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Ur(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Ur(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ur(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ur(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ur(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ur(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Ur(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Ur(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Ur(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Ur(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Ur(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ur(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,$a),skyboxGradient:Ur(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,$a),skyboxCapture:Ur(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ur(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ur(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function ia(d,n){const o=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of o)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=f.split(" ");for(const b of x)n.includes(b)||n.push(b)}}function Ur(d,n){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},b=[...bo];return ia(d,b),ia(n,b),{fragmentSource:d=d.replace(o,((C,M,j,F,z)=>(x[z]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${z}
varying ${j} ${F} ${z};
#else
uniform ${j} ${F} u_${z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${z}
    ${j} ${F} ${z} = u_${z};
#endif
`))),vertexSource:n=n.replace(o,((C,M,j,F,z)=>{const G=F==="float"?"vec2":"vec4",Q=z.match(/color/)?"color":G;return x[z]?M==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${j} ${G} a_${z};
varying ${j} ${F} ${z};
#else
uniform ${j} ${F} u_${z};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${j} ${F} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${Q}(a_${z}, u_${z}_t);
#else
    ${j} ${F} ${z} = u_${z};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${j} ${G} a_${z};
#else
uniform ${j} ${F} u_${z};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${j} ${F} ${z} = a_${z};
#else
    ${j} ${F} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${j} ${F} ${z} = unpack_mix_${Q}(a_${z}, u_${z}_t);
#else
    ${j} ${F} ${z} = u_${z};
#endif
`})),staticAttributes:f,usedDefines:b}}class id{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,o,f,x,b,C,M){this.context=n;let j=this.boundPaintVertexBuffers.length!==x.length;for(let z=0;!j&&z<x.length;z++)this.boundPaintVertexBuffers[z]!==x[z]&&(j=!0);let F=this.boundDynamicVertexBuffers.length!==M.length;for(let z=0;!F&&z<M.length;z++)this.boundDynamicVertexBuffers[z]!==M[z]&&(F=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==f||j||F||this.boundIndexBuffer!==b||this.boundVertexOffset!==C)this.freshBind(o,f,x,b,C,M);else{n.bindVertexArrayOES.set(this.vao);for(const z of M)z&&z.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(n,o,f,x,b,C){let M;const j=n.numAttributes,F=this.context,z=F.gl;if(F.extVertexArrayObject)this.vao&&this.destroy(),this.vao=F.extVertexArrayObject.createVertexArrayOES(),F.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=n,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=x,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=C;else{M=F.currentNumAttributes||0;for(let G=j;G<M;G++)z.disableVertexAttribArray(G)}o.enableAttributes(z,n),o.bind(),o.setVertexAttribPointers(z,n,b);for(const G of f)G.enableAttributes(z,n),G.bind(),G.setVertexAttribPointers(z,n,b);for(const G of C)G&&(G.enableAttributes(z,n),G.bind(),G.setVertexAttribPointers(z,n,b));x&&x.bind(),F.currentNumAttributes=j}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Xu(d,n){const o=Math.pow(2,n.canonical.z),f=n.canonical.y;return[new i.MercatorCoordinate(0,f/o).toLngLat().lat,new i.MercatorCoordinate(0,(f+1)/o).toLngLat().lat]}function sd(d,n,o,f,x,b,C){const M=d.context,j=M.gl,F=o.fbo;if(!F)return;d.prepareDrawTile();const z=d.useProgram("hillshade");M.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,F.colorAttachment.get());const G=((ne,se,W,te)=>{const le=W.paint.get("hillshade-shadow-color"),ue=W.paint.get("hillshade-highlight-color"),ke=W.paint.get("hillshade-accent-color");let Ee=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ee-=ne.transform.angle);const Se=!ne.options.moving;return{u_matrix:te||ne.transform.calculateProjMatrix(se.tileID.toUnwrapped(),Se),u_image:0,u_latrange:Xu(0,se.tileID),u_light:[W.paint.get("hillshade-exaggeration"),Ee],u_shadow:le,u_highlight:ue,u_accent:ke}})(d,o,f,d.terrain?n.projMatrix:null);d.prepareDrawProgram(M,z,n.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:re,tileBoundsSegments:ie}=d.getTileBoundsBuffers(o);z.draw(M,j.TRIANGLES,x,b,C,i.CullFaceMode.disabled,G,f.id,Q,re,ie)}function Ku(d,n,o){if(!n.needsDEMTextureUpload)return;const f=d.context,x=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||d.getTileTexture(o.stride);const b=o.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new i.Texture(f,b,x.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Kc(d,n,o,f,x,b){const C=d.context,M=C.gl;if(!n.dem)return;const j=n.dem;if(C.activeTexture.set(M.TEXTURE1),Ku(d,n,j),!n.demTexture)return;n.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);const F=j.dim;C.activeTexture.set(M.TEXTURE0);let z=n.fbo;if(!z){const ie=new i.Texture(C,{width:F,height:F,data:null},M.RGBA);ie.bind(M.LINEAR,M.CLAMP_TO_EDGE),z=n.fbo=C.createFramebuffer(F,F,!0),z.colorAttachment.set(ie.texture)}C.bindFramebuffer.set(z.framebuffer),C.viewport.set([0,0,F,F]);const{tileBoundsBuffer:G,tileBoundsIndexBuffer:Q,tileBoundsSegments:re}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(C,M.TRIANGLES,f,x,b,i.CullFaceMode.disabled,((ie,ne)=>{const se=ne.stride,W=i.create();return i.ortho(W,0,i.EXTENT,-i.EXTENT,0,0,1),i.translate(W,W,[0,-i.EXTENT,0]),{u_matrix:W,u_image:1,u_dimension:[se,se],u_zoom:ie.overscaledZ,u_unpack:ne.unpackVector}})(n.tileID,j),o.id,G,Q,re),n.needsHillshadePrepare=!1}const Yu=d=>({u_matrix:new i.UniformMatrix4f(d),u_image0:new i.Uniform1i(d),u_skirt_height:new i.Uniform1f(d)}),al=(d,n)=>({u_matrix:d,u_image0:0,u_skirt_height:n}),Yc=(d,n,o,f,x,b,C,M,j,F,z,G,Q,re,ie)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:o,u_zoom_transition:x,u_merc_center:b,u_image0:0,u_frustum_tl:C,u_frustum_tr:M,u_frustum_br:j,u_frustum_bl:F,u_globe_pos:z,u_globe_radius:G,u_viewport:Q,u_grid_matrix:ie?Float32Array.from(ie):new Float32Array(9),u_skirt_height:re});function ol(d,n){return d!=null&&n!=null&&!(!d.hasData()||!n.hasData())&&d.demTexture!=null&&n.demTexture!=null&&d.tileID.key!==n.tileID.key}const ba=new class{constructor(){this.operations={}}newMorphing(d,n,o,f,x){if(d in this.operations){const b=this.operations[d];b.to.tileID.key!==o.tileID.key&&(b.queued=o)}else this.operations[d]={startTime:f,phase:0,duration:x,from:n,to:o,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const n=this.operations[d];return{from:n.from,to:n.to,phase:n.phase}}update(d){for(const n in this.operations){const o=this.operations[n];for(o.phase=(d-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,d)){delete this.operations[n];break}}}_nextOp(d,n){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=n,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Wa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Jc(d){return 6*Math.pow(1.5,22-d)}function ad(d,n){const o=1<<d.z;return!n&&(d.x===0||d.x===o-1)||d.y===0||d.y===o-1}const tc=d=>({u_matrix:d});function Ju(d,n,o,f,x){if(x>0){const b=i.exported.now(),C=(b-d.timeAdded)/x,M=n?(b-n.timeAdded)/x:-1,j=o.getSource(),F=f.coveringZoomLevel({tileSize:j.tileSize,roundZoom:j.roundZoom}),z=!n||Math.abs(n.tileID.overscaledZ-F)>Math.abs(d.tileID.overscaledZ-F),G=z&&d.refreshedUponExpiration?1:i.clamp(z?C:1-M,0,1);return d.refreshedUponExpiration&&C>=1&&(d.refreshedUponExpiration=!1),n?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}class rc extends i.SourceCache{constructor(n){const o={type:"raster-dem",maxzoom:n.transform.maxZoom},f=new ve(yo(),null),x=vr("mock-dem",o,f,n.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,o){n.state="loaded",o(null)}}class Qc extends i.SourceCache{constructor(n){const o=vr("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new ve(yo(),null),n.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,o,f){if(n.freezeTileCoverage)return;this.transform=n;const x=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((b,C)=>{if(b[C.key]="",!this._tiles[C.key]){const M=new i.Tile(C,this._source.tileSize*C.overscaleFactor(),n.tileZoom);M.state="loaded",this._tiles[C.key]=M}return b}),{});for(const b in this._tiles)b in x||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const o=this.proxyCachedFBO[n];if(o!==void 0){const f=Object.values(o);this.renderCachePool.push(...f),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach((n=>n.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class eu extends i.OverscaledTileID{constructor(n,o,f){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=o,this.projMatrix=f}}class Qu extends i.Elevation{constructor(n,o){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,x,b]=(function(j){const F=new i.StructArrayLayout2i4,z=new i.StructArrayLayout3ui6,G=131;F.reserve(17161),z.reserve(33800);const Q=i.EXTENT/128,re=i.EXTENT+Q/2,ie=re+Q;for(let se=-Q;se<ie;se+=Q)for(let W=-Q;W<ie;W+=Q){const te=W<0||W>re||se<0||se>re?24575:0,le=i.clamp(Math.round(W),0,i.EXTENT),ue=i.clamp(Math.round(se),0,i.EXTENT);F.emplaceBack(le+te,ue)}const ne=(se,W)=>{const te=W*G+se;z.emplaceBack(te+1,te,te+G),z.emplaceBack(te+G,te+G+1,te+1)};for(let se=1;se<129;se++)for(let W=1;W<129;W++)ne(W,se);return[0,129].forEach((se=>{for(let W=0;W<130;W++)ne(W,se),ne(se,W)})),[F,z,32768]})(),C=n.context;this.gridBuffer=C.createVertexBuffer(f,i.posAttributes.members),this.gridIndexBuffer=C.createIndexBuffer(x),this.gridSegments=i.SegmentVector.simpleSegment(0,0,f.length,x.length),this.gridNoSkirtSegments=i.SegmentVector.simpleSegment(0,0,f.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Qc(o.map),this.orthoMatrix=i.create(),i.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.EXTENT,0,i.EXTENT,0,1);const M=C.gl;this._overlapStencilMode=new i.StencilMode({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new rc(o.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(n,o,f){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const x=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const b=()=>{this.sourceCache.used&&i.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const C=this.getScaledDemTileSize();this.sourceCache.update(o,C,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),o.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&i.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((n=>n.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(i.MercatorCoordinate.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=o.getIds().map((j=>{const F=o.getTileByID(j).tileID;return F.projMatrix=f.calculateProjMatrix(F.toUnwrapped()),F}));(function(j,F){const z=F.transform.pointCoordinate(F.transform.getCameraPoint()),G=new i.Point(z.x,z.y);j.sort(((Q,re)=>{if(re.overscaledZ-Q.overscaledZ)return re.overscaledZ-Q.overscaledZ;const ie=new i.Point(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),ne=new i.Point(re.canonical.x+(1<<re.canonical.z)*re.wrap,re.canonical.y),se=G.mult(1<<Q.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(ie)-se.distSqr(ne)}))})(x,this.painter),this._previousZoom=f.zoom;const b=this.proxyToSource||{};this.proxyToSource={},x.forEach((j=>{this.proxyToSource[j.key]={}})),this.terrainTileForTile={};const C=this._style._sourceCaches;for(const j in C){const F=C[j];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,n[j],b),F.usedForTerrain))continue;const z=n[j];F.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[o.id]=x.map((j=>new eu(j,j.key,this.orthoMatrix))),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=i.exported.now();const M={};this._visibleDemTiles=[];for(const j of this.proxyCoords){const F=this.terrainTileForTile[j.key];if(!F)continue;const z=F.tileID.key;z in M||(this._visibleDemTiles.push(F),M[z]=z)}}_assignTerrainTiles(n){this._initializing||n.forEach((o=>{if(this.terrainTileForTile[o.key])return;const f=this._findTileCoveringTileID(o,this.sourceCache);f&&(this.terrainTileForTile[o.key]=f)}))}_prepareDEMTextures(){const n=this.painter.context,o=n.gl;for(const f in this.terrainTileForTile){const x=this.terrainTileForTile[f],b=x.dem;!b||x.demTexture&&!x.needsDEMTextureUpload||(n.activeTexture.set(o.TEXTURE1),Ku(this.painter,x,b))}}_prepareDemTileUniforms(n,o,f,x){if(!o||o.demTexture==null)return!1;const b=n.tileID.canonical,C=Math.pow(2,o.tileID.canonical.z-b.z),M=x||"";return f[`u_dem_tl${M}`]=[b.x*C%1,b.y*C%1],f[`u_dem_scale${M}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,o=n.gl;if(!this._emptyDepthBufferTexture){const f=new i.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new i.Texture(n,f,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const o=this._visibleDemTiles.reduce(((f,x)=>{if(!x.dem)return f;const b=x.dem.tree.minimums[0];return b>0&&n++,f+b}),0);return n?o/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,o=n.gl;n.activeTexture.set(o.TEXTURE2);const f=this._getLoadedAreaMinimum(),x=new i.RGBAImage({width:1,height:1},new Uint8Array(i.DEMData.pack(f,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(x,{premultiply:!1}):b=this._emptyDEMTexture=new i.Texture(n,x,o.RGBA,{premultiply:!1}),b}setupElevationDraw(n,o,f){const x=this.painter.context,b=x.gl,C=(M=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:i.DEMData.getUnpackVector(M),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var M;C.u_dem_size=this.sourceCache.getSource().tileSize,C.u_exaggeration=this.exaggeration();let j=null,F=null,z=1;if(f&&f.morphing&&this._useVertexMorphing){const G=f.morphing.srcDemTile,Q=f.morphing.dstDemTile;z=f.morphing.phase,G&&Q&&(this._prepareDemTileUniforms(n,G,C,"_prev")&&(F=G),this._prepareDemTileUniforms(n,Q,C)&&(j=Q))}if(F&&j?(x.activeTexture.set(b.TEXTURE2),j.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),x.activeTexture.set(b.TEXTURE4),F.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),C.u_dem_lerp=z):(j=this.terrainTileForTile[n.tileID.key],x.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(n,j,C)?j.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),x.activeTexture.set(b.TEXTURE3),f&&f.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(C.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),C.u_depth_size_inv=[1,1]),f&&f.useMeterToDem&&j){const G=(1<<j.tileID.canonical.z)*i.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=G}if(f&&f.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),o.setTerrainUniformValues(x,C),this.painter.transform.projection.name==="globe"){const G=this.globeUniformValues(this.painter.transform,n.tileID.canonical,f&&f.useDenormalizedUpVectorScale);o.setGlobeUniformValues(x,G)}}globeUniformValues(n,o,f){const x=n.projection;return{u_tile_tl_up:x.upVector(o,0,0),u_tile_tr_up:x.upVector(o,i.EXTENT,0),u_tile_br_up:x.upVector(o,i.EXTENT,i.EXTENT),u_tile_bl_up:x.upVector(o,0,i.EXTENT),u_tile_up_scale:f?i.globeMetersToEcef(1):x.upVectorScale(o,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const o=this.painter,f=this.painter.context;n.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(x,b,C,M,j){if(x.transform.projection.name==="globe")(function(F,z,G,Q,re){const ie=F.context,ne=ie.gl;let se,W;const te=F.options.showTerrainWireframe?2:0,le=F.transform,ue=i.globeUseCustomAntiAliasing(F,ie,le),ke=(mt,Ue)=>{if(W===mt)return;const it=[Wa[mt],"PROJECTION_GLOBE_VIEW"];ue&&it.push("CUSTOM_ANTIALIASING"),Ue&&it.push(Wa[te]),se=F.useProgram("globeRaster",null,it),W=mt},Ee=F.colorModeForRenderPass(),Se=new i.DepthMode(ne.LEQUAL,i.DepthMode.ReadWrite,F.depthRangeFor3D);ba.update(re);const je=i.calculateGlobeMercatorMatrix(le),Ie=[i.mercatorXfromLng(le.center.lng),i.mercatorYfromLat(le.center.lat)],Ve=te?[!1,!0]:[!1],yt=F.globeSharedBuffers,ze=[le.width*i.exported.devicePixelRatio,le.height*i.exported.devicePixelRatio],nt=Float32Array.from(le.globeMatrix),We={useDenormalizedUpVectorScale:!0};if(Ve.forEach((mt=>{const Ue=F.transform,it=Jc(Ue.zoom)*z.exaggeration();W=-1;const ft=mt?ne.LINES:ne.TRIANGLES;for(const pt of Q){const vt=G.getTile(pt),Wt=i.StencilMode.disabled,or=z.prevTerrainTileForTile[pt.key],Vt=z.terrainTileForTile[pt.key];ol(or,Vt)&&ba.newMorphing(pt.key,or,Vt,re,250),ie.activeTexture.set(ne.TEXTURE0),vt.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const tr=ba.getMorphValuesForProxy(pt.key),Sr=tr?1:0;tr&&i.extend$1(We,{morphing:{srcDemTile:tr.from,dstDemTile:tr.to,phase:i.easeCubicInOut(tr.phase)}});const Pr=i.tileCornersToBounds(pt.canonical),Zt=i.getLatitudinalLod(Pr.getCenter().lat),Dr=i.getGridMatrix(pt.canonical,Pr,Zt,Ue.worldSize/Ue._pixelsPerMercatorPixel),Xr=i.globeNormalizeECEF(i.globeTileBounds(pt.canonical)),Kr=Yc(Ue.projMatrix,nt,je,Xr,i.globeToMercatorTransition(Ue.zoom),Ie,Ue.frustumCorners.TL,Ue.frustumCorners.TR,Ue.frustumCorners.BR,Ue.frustumCorners.BL,Ue.globeCenterInViewSpace,Ue.globeRadius,ze,it,Dr);if(ke(Sr,mt),z.setupElevationDraw(vt,se,We),F.prepareDrawProgram(ie,se,pt.toUnwrapped()),yt){const[qr,mi,In]=mt?yt.getWirefameBuffers(F.context,Zt):yt.getGridBuffers(Zt,it!==0);se.draw(ie,ft,Se,Wt,Ee,i.CullFaceMode.backCCW,Kr,"globe_raster",qr,mi,In)}}})),yt){const mt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ue&&mt.push("CUSTOM_ANTIALIASING"),se=F.useProgram("globeRaster",null,mt);for(const Ue of Q){const{x:it,y:ft,z:pt}=Ue.canonical,vt=ft===0,Wt=ft===(1<<pt)-1,[or,Vt,tr,Sr]=yt.getPoleBuffers(pt);if(Sr&&(vt||Wt)){const Pr=G.getTile(Ue);ie.activeTexture.set(ne.TEXTURE0),Pr.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);let Zt=i.globePoleMatrixForTile(pt,it,le);const Dr=i.globeNormalizeECEF(i.globeTileBounds(Ue.canonical)),Xr=(Kr,qr)=>Kr.draw(ie,ne.TRIANGLES,Se,i.StencilMode.disabled,Ee,i.CullFaceMode.disabled,Yc(le.projMatrix,Zt,Zt,Dr,0,Ie,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,ze,0),"globe_pole_raster",qr,tr,Sr);z.setupElevationDraw(Pr,se,We),F.prepareDrawProgram(ie,se,Ue.toUnwrapped()),vt&&Xr(se,or),Wt&&(Zt=i.scale(i.create(),Zt,[1,-1,1]),Xr(se,Vt))}}}})(x,b,C,M,j);else{const F=x.context,z=F.gl;let G,Q;const re=x.options.showTerrainWireframe?2:0,ie=(le,ue)=>{if(Q===le)return;const ke=[Wa[le]];ue&&ke.push(Wa[re]),G=x.useProgram("terrainRaster",null,ke),Q=le},ne=x.colorModeForRenderPass(),se=new i.DepthMode(z.LEQUAL,i.DepthMode.ReadWrite,x.depthRangeFor3D);ba.update(j);const W=x.transform,te=Jc(W.zoom)*b.exaggeration();(re?[!1,!0]:[!1]).forEach((le=>{Q=-1;const ue=le?z.LINES:z.TRIANGLES,[ke,Ee]=le?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const Se of M){const je=C.getTile(Se),Ie=i.StencilMode.disabled,Ve=b.prevTerrainTileForTile[Se.key],yt=b.terrainTileForTile[Se.key];ol(Ve,yt)&&ba.newMorphing(Se.key,Ve,yt,j,250),F.activeTexture.set(z.TEXTURE0),je.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const ze=ba.getMorphValuesForProxy(Se.key),nt=ze?1:0;let We;ze&&(We={morphing:{srcDemTile:ze.from,dstDemTile:ze.to,phase:i.easeCubicInOut(ze.phase)}});const mt=al(Se.projMatrix,ad(Se.canonical,W.renderWorldCopies)?te/10:te);ie(nt,le),b.setupElevationDraw(je,G,We),x.prepareDrawProgram(F,G,Se.toUnwrapped()),G.draw(F,ue,se,Ie,ne,i.CullFaceMode.backCCW,mt,"terrain_raster",b.gridBuffer,ke,Ee)}}))}})(o,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const o=this.painter,f=this.painter.context,x=this.proxySourceCache,b=this.proxiedCoords[x.id],C=this._drapedRenderBatches.shift(),M=[],j=o.style.order;let F=0;for(const z of b){const G=x.getTileByID(z.proxyTileKey),Q=x.proxyCachedFBO[z.key]?x.proxyCachedFBO[z.key][n]:void 0,re=Q!==void 0?x.renderCache[Q]:this.pool[F++],ie=Q!==void 0;if(G.texture=re.tex,ie&&!re.dirty){M.push(G.tileID);continue}let ne;f.bindFramebuffer.set(re.fb.framebuffer),this.renderedToTile=!1,re.dirty&&(f.clear({color:i.Color.transparent,stencil:0}),re.dirty=!1);for(let se=C.start;se<=C.end;++se){const W=o.style._layers[j[se]];if(W.isHidden(o.transform.zoom))continue;const te=o.style._getLayerSourceCache(W),le=te?this.proxyToSource[z.key][te.id]:[z];if(!le)continue;const ue=le;f.viewport.set([0,0,re.fb.width,re.fb.height]),ne!==(te?te.id:null)&&(this._setupStencil(re,le,W,te),ne=te?te.id:null),o.renderLayer(o,te,W,ue)}this.renderedToTile?(re.dirty=!0,M.push(G.tileID)):ie||--F,F===5&&(F=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,o.width,o.height]),C.end+1}postRender(){}renderCacheEfficiency(n){const o=n.order.length;if(o===0)return{efficiency:100};let f,x=0,b=0,C=!1;for(let M=0;M<o;++M){const j=n._layers[n.order[M]];this._style.isLayerDraped(j)?(C&&++x,++b):C||(C=!0,f=j.id)}return b===0?{efficiency:100}:{efficiency:100*(1-x/b),firstUndrapedLayer:f}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter((o=>o.dem)).forEach((o=>{n=Math.min(n,o.dem.tree.minimums[0])})),n===0?n:(n-30)*this._exaggeration}raycast(n,o,f){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter((b=>b.dem)).map((b=>{const C=b.tileID,M=1<<C.overscaledZ,{x:j,y:F}=C.canonical,z=j/M,G=(j+1)/M,Q=F/M,re=(F+1)/M;return{minx:z,miny:Q,maxx:G,maxy:re,t:b.dem.tree.raycastRoot(z,Q,G,re,n,o,f),tile:b}}));x.sort(((b,C)=>(b.t!==null?b.t:Number.MAX_VALUE)-(C.t!==null?C.t:Number.MAX_VALUE)));for(const b of x){if(b.t==null)return null;const C=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,o,f);if(C!=null)return C}return null}_createFBO(){const n=this.painter.context,o=n.gl,f=this.drapeBufferSize;n.activeTexture.set(o.TEXTURE0);const x=new i.Texture(n,{width:f[0],height:f[1],data:null},o.RGBA);x.bind(o.LINEAR,o.CLAMP_TO_EDGE);const b=n.createFramebuffer(f[0],f[1],!1);return b.colorAttachment.set(x.texture),b.depthAttachment=new Ce(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&o.texParameterf(o.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some((n=>{const o=this._style._layers[n],f=o.isHidden(this.painter.transform.zoom);return o.type==="custom"?!f&&o.shouldRedrape():!f&&o.hasTransition()}))}_clearLineLayersFromRenderCache(){let n=!1;for(const f of this._style._getSources())if(f instanceof It){n=!0;break}if(!n)return;const o={};for(let f=0;f<this._style.order.length;++f){const x=this._style._layers[this._style.order[f]],b=this._style._getLayerSourceCache(x);if(b&&!o[b.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof i.ZoomDependentExpression){o[b.id]=!0;for(const C of this.proxyCoords){const M=this.proxyToSource[C.key][b.id];if(M)for(const j of M)this._clearRenderCacheForTile(b.id,j)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const f in this._style._sourceCaches)if(this._style._sourceCaches[f]._source instanceof xt){n=!0;break}if(!n)return;const o={};for(let f=0;f<this._style.order.length;++f){const x=this._style._layers[this._style.order[f]],b=this._style._getLayerSourceCache(x);if(!b||o[b.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const C=x.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const j=this.proxyToSource[M.key][b.id];if(j)for(const F of j){const z=Ju(b.getTile(F),b.findLoadedParent(F,0),b,this.painter.transform,C);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(b.id,F)}}}}_setupDrapedRenderBatches(){const n=this._style.order,o=n.length;if(o===0)return;const f=[];let x,b=0,C=this._style._layers[n[b]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++b<o;)C=this._style._layers[n[b]];for(;b<o;++b){const M=this._style._layers[n[b]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?x===void 0&&(x=b):x!==void 0&&(f.push({start:x,end:b-1}),x=void 0))}x!==void 0&&f.push({start:x,end:b-1}),this._drapedRenderBatches=f}_setupRenderCache(n){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const C=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let M=0;M<C.length;++M){const j=Object.values(C[M]);o.renderCachePool.push(...j)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,x=this._tilesDirty;for(let C=f.length-1;C>=0;C--){const M=f[C];if(o.getTileByID(M.key),o.proxyCachedFBO[M.key]!==void 0){const j=n[M.key],F=this.proxyToSource[M.key];let z=0;for(const G in F){const Q=F[G],re=j[G];if(!re||re.length!==Q.length||Q.some(((ie,ne)=>ie!==re[ne]||x[G]&&x[G].hasOwnProperty(ie.key)))){z=-1;break}++z}for(const G in o.proxyCachedFBO[M.key])o.renderCache[o.proxyCachedFBO[M.key][G]].dirty=z<0||z!==Object.values(j).length}}const b=[...this._drapedRenderBatches];b.sort(((C,M)=>M.end-M.start-(C.end-C.start)));for(const C of b)for(const M of f){if(o.proxyCachedFBO[M.key])continue;let j=o.renderCachePool.pop();j===void 0&&o.renderCache.length<50&&(j=o.renderCache.length,o.renderCache.push(this._createFBO())),j!==void 0&&(o.proxyCachedFBO[M.key]={},o.proxyCachedFBO[M.key][C.start]=j,o.renderCache[j].dirty=!0)}this._tilesDirty={}}_setupStencil(n,o,f,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,C=b.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let M;if(f.isTileClipped())M=o.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):i.StencilMode.disabled}_renderTileClippingMasks(n,o){const f=this.painter,x=this.painter.context,b=x.gl;f._tileClippingMaskIDs={},x.setColorMode(i.ColorMode.disabled),x.setDepthMode(i.DepthMode.disabled);const C=f.useProgram("clippingMask");for(const M of n){const j=f._tileClippingMaskIDs[M.key]=--o;C.draw(x,b.TRIANGLES,i.DepthMode.disabled,new i.StencilMode({func:b.ALWAYS,mask:0},j,255,b.KEEP,b.KEEP,b.REPLACE),i.ColorMode.disabled,i.CullFaceMode.disabled,tc(M.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(n){const o=this.painter.transform;if(n.x<0||n.x>o.width||n.y<0||n.y>o.height)return null;const f=[n.x,n.y,1,1];i.transformMat4$1(f,f,o.pixelMatrixInverse),i.scale$1(f,f,1/f[3]),f[0]/=o.worldSize,f[1]/=o.worldSize;const x=o._camera.position,b=i.mercatorZfromAltitude(1,o.center.lat),C=[x[0],x[1],x[2]/b,0],M=i.subtract([],f.slice(0,3),C);i.normalize(M,M);const j=this.raycast(C,M,this._exaggeration);return j!==null&&j?(i.scaleAndAdd(C,C,M,j),C[3]=C[2],C[2]*=b,C):null}drawDepth(){const n=this.painter,o=n.context,f=this.proxySourceCache,x=Math.ceil(n.width),b=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const C=o.gl,M=o.createFramebuffer(x,b,!0);o.activeTexture.set(C.TEXTURE0);const j=new i.Texture(o,{width:x,height:b,data:null},C.RGBA);j.bind(C.NEAREST,C.CLAMP_TO_EDGE),M.colorAttachment.set(j.texture);const F=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,x,b);M.depthAttachment.set(F),this._depthFBO=M,this._depthTexture=j}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,x,b]),(function(C,M,j,F){if(C.transform.projection.name==="globe")return;const z=C.context,G=z.gl;z.clear({depth:1});const Q=C.useProgram("terrainDepth"),re=new i.DepthMode(G.LESS,i.DepthMode.ReadWrite,C.depthRangeFor3D);for(const ie of F){const ne=j.getTile(ie),se=al(ie.projMatrix,0);M.setupElevationDraw(ne,Q),Q.draw(z,G.TRIANGLES,re,i.StencilMode.disabled,i.ColorMode.unblended,i.CullFaceMode.backCCW,se,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}})(n,this,f,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,o,f){if(n.getSource()instanceof xr)return this._setupProxiedCoordsForImageSource(n,o,f);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const x=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let M=0;M<b.length;M++){const j=b[M],F=this._findTileCoveringTileID(j,n);if(F){const z=this._createProxiedId(j,F,f[j.key]&&f[j.key][n.id]);x.push(z),this.proxyToSource[j.key][n.id]=[z]}}let C=!1;for(let M=0;M<o.length;M++){const j=n.getTile(o[M]);if(!j||!j.hasData())continue;const F=this._findTileCoveringTileID(j.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==j.tileID.canonical.z){const z=this.proxyToSource[F.tileID.key][n.id],G=this._createProxiedId(F.tileID,j,f[F.tileID.key]&&f[F.tileID.key][n.id]);z?z.splice(z.length-1,0,G):this.proxyToSource[F.tileID.key][n.id]=[G],x.push(G),C=!0}}this._sourceTilesOverlap[n.id]=C}_setupProxiedCoordsForImageSource(n,o,f){if(!n.getSource().loaded())return;const x=this.proxiedCoords[n.id]=[],b=this.proxyCoords,C=n.getSource(),M=new i.Point(C.tileID.x,C.tileID.y)._div(1<<C.tileID.z),j=C.coordinates.map(i.MercatorCoordinate.fromLngLat).reduce(((z,G)=>(z.min.x=Math.min(z.min.x,G.x-M.x),z.min.y=Math.min(z.min.y,G.y-M.y),z.max.x=Math.max(z.max.x,G.x-M.x),z.max.y=Math.max(z.max.y,G.y-M.y),z)),{min:new i.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(z,G)=>{const Q=z.wrap+z.canonical.x/(1<<z.canonical.z),re=z.canonical.y/(1<<z.canonical.z),ie=i.EXTENT/(1<<z.canonical.z),ne=G.wrap+G.canonical.x/(1<<G.canonical.z),se=G.canonical.y/(1<<G.canonical.z);return Q+ie<ne+j.min.x||Q>ne+j.max.x||re+ie<se+j.min.y||re>se+j.max.y};for(let z=0;z<b.length;z++){const G=b[z];for(let Q=0;Q<o.length;Q++){const re=n.getTile(o[Q]);if(!re||!re.hasData()||F(G,re.tileID))continue;const ie=this._createProxiedId(G,re,f[G.key]&&f[G.key][n.id]),ne=this.proxyToSource[G.key][n.id];ne?ne.push(ie):this.proxyToSource[G.key][n.id]=[ie],x.push(ie)}}}_createProxiedId(n,o,f){let x=this.orthoMatrix;if(f){const b=f.find((C=>C.key===o.tileID.key));if(b)return b}if(o.tileID.key!==n.key){const b=n.canonical.z-o.tileID.canonical.z;let C,M,j;x=i.create();const F=o.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(C=i.EXTENT>>b,M=C*((o.tileID.canonical.x<<b)-n.canonical.x+F),j=C*((o.tileID.canonical.y<<b)-n.canonical.y)):(C=i.EXTENT<<-b,M=i.EXTENT*(o.tileID.canonical.x-(n.canonical.x+F<<-b)),j=i.EXTENT*(o.tileID.canonical.y-(n.canonical.y<<-b))),i.ortho(x,0,C,0,C,0,1),i.translate(x,x,[M,j,0])}return new eu(o.tileID,n.key,x)}_findTileCoveringTileID(n,o){let f=o.getTile(n);if(f&&f.hasData())return f;const x=this._findCoveringTileCache[o.id],b=x[n.key];if(f=b?o.getTileByID(b):null,f&&f.hasData()||b===null)return f;let C=f?f.tileID:n,M=C.overscaledZ;const j=o.getSource().minzoom,F=[];if(!b){const G=o.getSource().maxzoom;if(n.canonical.z>=G){const Q=n.canonical.z-G;o.getSource().reparseOverscaled?(M=Math.max(n.canonical.z+2,o.transform.tileZoom),C=new i.OverscaledTileID(M,n.wrap,G,n.canonical.x>>Q,n.canonical.y>>Q)):Q!==0&&(M=G,C=new i.OverscaledTileID(M,n.wrap,G,n.canonical.x>>Q,n.canonical.y>>Q))}C.key!==n.key&&(F.push(C.key),f=o.getTile(C))}const z=G=>{F.forEach((Q=>{x[Q]=G})),F.length=0};for(M-=1;M>=j&&(!f||!f.hasData());M--){f&&z(f.tileID.key);const G=C.calculateScaledKey(M);if(f=o.getTileByID(G),f&&f.hasData())break;const Q=x[G];if(Q===null)break;Q===void 0?F.push(G):f=o.getTileByID(Q)}return z(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,o){let f=this._tilesDirty[n];f||(f=this._tilesDirty[n]={}),f[o.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=(function(o){let f=0;const x=new i.StructArrayLayout2ui4,b=131;for(let C=1;C<129;C++){for(let M=1;M<129;M++)f=C*b+M,x.emplaceBack(f,f+1),x.emplaceBack(f,f+b),x.emplaceBack(f+1,f+b),C===128&&x.emplaceBack(f+b,f+b+1);x.emplaceBack(f+1,f+1+b)}return x})();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=i.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Fr{static cacheKey(n,o,f,x){let b=`${o}${x?x.cacheKey:""}`;for(const C of f)n.usedDefines.includes(C)&&(b+=`/${C}`);return b}constructor(n,o,f,x,b,C){const M=n.gl;this.program=M.createProgram();const j=(function(W){const te=[];for(let le=0;le<W.length;le++){if(W[le]===null)continue;const ue=W[le].split(" ");te.push(ue.pop())}return te})(f.staticAttributes),F=x?x.getBinderAttributes():[],z=j.concat(F);let G=x?x.defines():[];G=G.concat(C.map((W=>`#define ${W}`)));const Q=n.isWebGL2?`#version 300 es
`:"",re=Q+G.concat(n.extStandardDerivatives&&Q.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Ql):Ql,Ql,Xc,sl.fragmentSource,Fs.fragmentSource,f.fragmentSource).join(`
`),ie=Q+G.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Xc,sl.vertexSource,Fs.vertexSource,Ei.vertexSource,f.vertexSource).join(`
`),ne=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(ne,re),M.compileShader(ne),M.attachShader(this.program,ne);const se=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(se,ie),M.compileShader(se),M.attachShader(this.program,se),this.attributes={},this.numAttributes=z.length;for(let W=0;W<this.numAttributes;W++)z[W]&&(M.bindAttribLocation(this.program,W,z[W]),this.attributes[z[W]]=W);M.linkProgram(this.program),M.deleteShader(se),M.deleteShader(ne),this.fixedUniforms=b(n),this.binderUniforms=x?x.getUniforms(n):[],C.includes("TERRAIN")&&(this.terrainUniforms=(W=>({u_dem:new i.Uniform1i(W),u_dem_prev:new i.Uniform1i(W),u_dem_unpack:new i.Uniform4f(W),u_dem_tl:new i.Uniform2f(W),u_dem_scale:new i.Uniform1f(W),u_dem_tl_prev:new i.Uniform2f(W),u_dem_scale_prev:new i.Uniform1f(W),u_dem_size:new i.Uniform1f(W),u_dem_lerp:new i.Uniform1f(W),u_exaggeration:new i.Uniform1f(W),u_depth:new i.Uniform1i(W),u_depth_size_inv:new i.Uniform2f(W),u_meter_to_dem:new i.Uniform1f(W),u_label_plane_matrix_inv:new i.UniformMatrix4f(W)}))(n)),C.includes("GLOBE")&&(this.globeUniforms=(W=>({u_tile_tl_up:new i.Uniform3f(W),u_tile_tr_up:new i.Uniform3f(W),u_tile_br_up:new i.Uniform3f(W),u_tile_bl_up:new i.Uniform3f(W),u_tile_up_scale:new i.Uniform1f(W)}))(n)),C.includes("FOG")&&(this.fogUniforms=(W=>({u_fog_matrix:new i.UniformMatrix4f(W),u_fog_range:new i.Uniform2f(W),u_fog_color:new i.Uniform4f(W),u_fog_horizon_blend:new i.Uniform1f(W),u_fog_temporal_offset:new i.Uniform1f(W),u_frustum_tl:new i.Uniform3f(W),u_frustum_tr:new i.Uniform3f(W),u_frustum_br:new i.Uniform3f(W),u_frustum_bl:new i.Uniform3f(W),u_globe_pos:new i.Uniform3f(W),u_globe_radius:new i.Uniform1f(W),u_globe_transition:new i.Uniform1f(W),u_is_globe:new i.Uniform1i(W),u_viewport:new i.Uniform2f(W)}))(n))}}setTerrainUniformValues(n,o){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in o)f[x]&&f[x].set(this.program,x,o[x])}}setGlobeUniformValues(n,o){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in o)f[x]&&f[x].set(this.program,x,o[x])}}setFogUniformValues(n,o){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in o)f[x].set(this.program,x,o[x])}}draw(n,o,f,x,b,C,M,j,F,z,G,Q,re,ie,ne){const se=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(f),n.setStencilMode(x),n.setColorMode(b),n.setCullFace(C);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(this.program,te,M[te]);ie&&ie.setUniforms(this.program,n,this.binderUniforms,Q,{zoom:re});const W={[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[o];for(const te of G.get()){const le=te.vaos||(te.vaos={});(le[j]||(le[j]=new id)).bind(n,this,F,ie?ie.getPaintVertexBuffers():[],z,te.vertexOffset,ne||[]),se.drawElements(o,te.primitiveLength*W,se.UNSIGNED_SHORT,te.primitiveOffset*W*2)}}}function nc(d,n){const o=Math.pow(2,n.tileID.overscaledZ),f=n.tileSize*Math.pow(2,d.transform.tileZoom)/o,x=f*(n.tileID.canonical.x+n.tileID.wrap*o),b=f*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_tile_units_to_pixels:1/et(n,1,d.transform.tileZoom),u_pixel_coord_upper:[x>>16,b>>16],u_pixel_coord_lower:[65535&x,65535&b]}}const od=i.create(),eh=(d,n,o,f,x,b,C,M,j,F,z)=>{const G=n.style.light,Q=G.properties.get("position"),re=[Q.x,Q.y,Q.z],ie=i.create$1();G.properties.get("anchor")==="viewport"&&(i.fromRotation(ie,-n.transform.angle),i.transformMat3(re,re,ie));const ne=G.properties.get("color"),se=n.transform,W={u_matrix:d,u_lightpos:re,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+o,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:od,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:b};return se.projection.name==="globe"&&(W.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],W.u_zoom_transition=j,W.u_inv_rot_matrix=z,W.u_merc_center=F,W.u_up_dir=se.projection.upVector(new i.CanonicalTileID(0,0,0),F[0]*i.EXTENT,F[1]*i.EXTENT),W.u_height_lift=M),W},ld=(d,n,o,f,x,b,C,M,j,F,z,G)=>{const Q=eh(d,n,o,f,x,b,C,j,F,z,G),re={u_height_factor:-Math.pow(2,C.overscaledZ)/M.tileSize/8};return i.extend(Q,nc(n,M),re)},wo=d=>({u_matrix:d}),th=(d,n,o)=>i.extend(wo(d),nc(n,o)),kp=(d,n)=>({u_matrix:d,u_world:n}),rh=(d,n,o,f)=>i.extend(th(d,n,o),{u_world:f}),ic=i.create(),nh=(d,n,o,f,x,b)=>{const C=d.transform,M=C.projection.name==="globe";let j;if(b.paint.get("circle-pitch-alignment")==="map")if(M){const z=i.globePixelsToTileUnits(C.zoom,n.canonical)*C._pixelsPerMercatorPixel;j=Float32Array.from([z,0,0,z])}else j=C.calculatePixelsToTileUnitsMatrix(o);else j=new Float32Array([C.pixelsToGLUnits[0],0,0,C.pixelsToGLUnits[1]]);const F={u_camera_to_center_distance:C.cameraToCenterDistance,u_matrix:d.translatePosMatrix(n.projMatrix,o,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:i.exported.devicePixelRatio,u_extrude_scale:j,u_inv_rot_matrix:ic,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){F.u_inv_rot_matrix=f,F.u_merc_center=x,F.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],F.u_zoom_transition=i.globeToMercatorTransition(C.zoom);const z=x[0]*i.EXTENT,G=x[1]*i.EXTENT;F.u_up_dir=C.projection.upVector(new i.CanonicalTileID(0,0,0),z,G)}return F},tu=d=>{const n=[];return d.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},ru=(d,n,o,f)=>{const x=i.EXTENT/o.tileSize;return{u_matrix:d,u_camera_to_center_distance:n.getCameraToCenterDistance(f),u_extrude_scale:[n.pixelsToGLUnits[0]/x,n.pixelsToGLUnits[1]/x]}},sc=(d,n,o=1)=>({u_matrix:d,u_color:n,u_overlay:0,u_overlay_scale:o}),ih=i.create(),sh=(d,n,o,f,x,b,C)=>{const M=d.transform,j=M.projection.name==="globe",F=j?i.globePixelsToTileUnits(M.zoom,n.canonical)*M._pixelsPerMercatorPixel:et(o,1,b),z={u_matrix:n.projMatrix,u_extrude_scale:F,u_intensity:C,u_inv_rot_matrix:ih,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(j){z.u_inv_rot_matrix=f,z.u_merc_center=x,z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],z.u_zoom_transition=i.globeToMercatorTransition(M.zoom);const G=x[0]*i.EXTENT,Q=x[1]*i.EXTENT;z.u_up_dir=M.projection.upVector(new i.CanonicalTileID(0,0,0),G,Q)}return z},ll=(d,n,o,f,x,b,C)=>{const M=d.transform,j=M.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:ah(d,n,o,f),u_pixels_to_tile_units:j,u_device_pixel_ratio:b,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:ul(o)?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:cl(n,d.transform),u_alpha_discard_threshold:0,u_trim_offset:C}},ac=(d,n,o,f,x)=>{const b=d.transform;return{u_matrix:ah(d,n,o,f),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:cl(n,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function cl(d,n){return 1/et(d,1,n.tileZoom)}function ah(d,n,o,f){return d.translatePosMatrix(f||n.tileID.projMatrix,n,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}function ul(d){const n=d.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const nu=(d,n,o,f,x,b)=>{return{u_matrix:d,u_tl_parent:n,u_scale_parent:o,u_fade_t:f.mix,u_opacity:f.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(M=x.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(C=x.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:Gi(x.paint.get("raster-hue-rotate")),u_perspective_transform:b};var C,M};function Gi(d){d*=Math.PI/180;const n=Math.sin(d),o=Math.cos(d);return[(2*o+1)/3,(-Math.sqrt(3)*n-o+1)/3,(Math.sqrt(3)*n-o+1)/3]}const qa=i.create(),oh=(d,n,o,f,x,b,C,M,j,F,z,G,Q,re,ie,ne)=>{const se=x.transform,W={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_rotate_symbol:+o,u_aspect_ratio:se.width/se.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:C,u_coord_matrix:M,u_is_text:+j,u_pitch_with_map:+f,u_texsize:F,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:qa,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:qa,u_up_vector:[0,-1,0]};return ne.name==="globe"&&(W.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],W.u_zoom_transition=G,W.u_inv_rot_matrix=re,W.u_merc_center=Q,W.u_camera_forward=se._camera.forward(),W.u_ecef_origin=i.globeECEFOrigin(se.globeMatrix,z.toUnwrapped()),W.u_tile_matrix=Float32Array.from(se.globeMatrix),W.u_up_vector=ie),W},To=(d,n,o,f,x,b,C,M,j,F,z,G,Q,re,ie,ne,se)=>i.extend(oh(d,n,o,f,x,b,C,M,j,F,G,Q,re,ie,ne,se),{u_gamma_scale:f?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:i.exported.devicePixelRatio,u_is_halo:1}),cd=(d,n,o,f,x,b,C,M,j,F,z,G,Q,re,ie,ne)=>i.extend(To(d,n,o,f,x,b,C,M,!0,j,!0,z,G,Q,re,ie,ne),{u_texsize_icon:F,u_texture_icon:1}),iu=(d,n,o)=>({u_matrix:d,u_opacity:n,u_color:o}),lh=(d,n,o,f,x)=>i.extend((function(b,C,M){const j=C.imageManager.getPattern(b.toString()),{width:F,height:z}=C.imageManager.getPixelSize(),G=Math.pow(2,M.tileID.overscaledZ),Q=M.tileSize*Math.pow(2,C.transform.tileZoom)/G,re=Q*(M.tileID.canonical.x+M.tileID.wrap*G),ie=Q*M.tileID.canonical.y;return{u_image:0,u_pattern_tl:j.tl,u_pattern_br:j.br,u_texsize:[F,z],u_pattern_size:j.displaySize,u_tile_units_to_pixels:1/et(M,1,C.transform.tileZoom),u_pixel_coord_upper:[re>>16,ie>>16],u_pixel_coord_lower:[65535&re,65535&ie]}})(f,o,x),{u_matrix:d,u_opacity:n}),oc={fillExtrusion:d=>({u_matrix:new i.UniformMatrix4f(d),u_lightpos:new i.Uniform3f(d),u_lightintensity:new i.Uniform1f(d),u_lightcolor:new i.Uniform3f(d),u_vertical_gradient:new i.Uniform1f(d),u_opacity:new i.Uniform1f(d),u_edge_radius:new i.Uniform1f(d),u_ao:new i.Uniform2f(d),u_tile_id:new i.Uniform3f(d),u_zoom_transition:new i.Uniform1f(d),u_inv_rot_matrix:new i.UniformMatrix4f(d),u_merc_center:new i.Uniform2f(d),u_up_dir:new i.Uniform3f(d),u_height_lift:new i.Uniform1f(d)}),fillExtrusionPattern:d=>({u_matrix:new i.UniformMatrix4f(d),u_lightpos:new i.Uniform3f(d),u_lightintensity:new i.Uniform1f(d),u_lightcolor:new i.Uniform3f(d),u_vertical_gradient:new i.Uniform1f(d),u_height_factor:new i.Uniform1f(d),u_edge_radius:new i.Uniform1f(d),u_ao:new i.Uniform2f(d),u_tile_id:new i.Uniform3f(d),u_zoom_transition:new i.Uniform1f(d),u_inv_rot_matrix:new i.UniformMatrix4f(d),u_merc_center:new i.Uniform2f(d),u_up_dir:new i.Uniform3f(d),u_height_lift:new i.Uniform1f(d),u_image:new i.Uniform1i(d),u_texsize:new i.Uniform2f(d),u_pixel_coord_upper:new i.Uniform2f(d),u_pixel_coord_lower:new i.Uniform2f(d),u_tile_units_to_pixels:new i.Uniform1f(d),u_opacity:new i.Uniform1f(d)}),fill:d=>({u_matrix:new i.UniformMatrix4f(d)}),fillPattern:d=>({u_matrix:new i.UniformMatrix4f(d),u_image:new i.Uniform1i(d),u_texsize:new i.Uniform2f(d),u_pixel_coord_upper:new i.Uniform2f(d),u_pixel_coord_lower:new i.Uniform2f(d),u_tile_units_to_pixels:new i.Uniform1f(d)}),fillOutline:d=>({u_matrix:new i.UniformMatrix4f(d),u_world:new i.Uniform2f(d)}),fillOutlinePattern:d=>({u_matrix:new i.UniformMatrix4f(d),u_world:new i.Uniform2f(d),u_image:new i.Uniform1i(d),u_texsize:new i.Uniform2f(d),u_pixel_coord_upper:new i.Uniform2f(d),u_pixel_coord_lower:new i.Uniform2f(d),u_tile_units_to_pixels:new i.Uniform1f(d)}),circle:d=>({u_camera_to_center_distance:new i.Uniform1f(d),u_extrude_scale:new i.UniformMatrix2f(d),u_device_pixel_ratio:new i.Uniform1f(d),u_matrix:new i.UniformMatrix4f(d),u_inv_rot_matrix:new i.UniformMatrix4f(d),u_merc_center:new i.Uniform2f(d),u_tile_id:new i.Uniform3f(d),u_zoom_transition:new i.Uniform1f(d),u_up_dir:new i.Uniform3f(d)}),collisionBox:d=>({u_matrix:new i.UniformMatrix4f(d),u_camera_to_center_distance:new i.Uniform1f(d),u_extrude_scale:new i.Uniform2f(d)}),collisionCircle:d=>({u_matrix:new i.UniformMatrix4f(d),u_inv_matrix:new i.UniformMatrix4f(d),u_camera_to_center_distance:new i.Uniform1f(d),u_viewport_size:new i.Uniform2f(d)}),debug:d=>({u_color:new i.UniformColor(d),u_matrix:new i.UniformMatrix4f(d),u_overlay:new i.Uniform1i(d),u_overlay_scale:new i.Uniform1f(d)}),clippingMask:d=>({u_matrix:new i.UniformMatrix4f(d)}),heatmap:d=>({u_extrude_scale:new i.Uniform1f(d),u_intensity:new i.Uniform1f(d),u_matrix:new i.UniformMatrix4f(d),u_inv_rot_matrix:new i.UniformMatrix4f(d),u_merc_center:new i.Uniform2f(d),u_tile_id:new i.Uniform3f(d),u_zoom_transition:new i.Uniform1f(d),u_up_dir:new i.Uniform3f(d)}),heatmapTexture:d=>({u_image:new i.Uniform1i(d),u_color_ramp:new i.Uniform1i(d),u_opacity:new i.Uniform1f(d)}),hillshade:d=>({u_matrix:new i.UniformMatrix4f(d),u_image:new i.Uniform1i(d),u_latrange:new i.Uniform2f(d),u_light:new i.Uniform2f(d),u_shadow:new i.UniformColor(d),u_highlight:new i.UniformColor(d),u_accent:new i.UniformColor(d)}),hillshadePrepare:d=>({u_matrix:new i.UniformMatrix4f(d),u_image:new i.Uniform1i(d),u_dimension:new i.Uniform2f(d),u_zoom:new i.Uniform1f(d),u_unpack:new i.Uniform4f(d)}),line:d=>({u_matrix:new i.UniformMatrix4f(d),u_pixels_to_tile_units:new i.UniformMatrix2f(d),u_device_pixel_ratio:new i.Uniform1f(d),u_units_to_pixels:new i.Uniform2f(d),u_dash_image:new i.Uniform1i(d),u_gradient_image:new i.Uniform1i(d),u_image_height:new i.Uniform1f(d),u_texsize:new i.Uniform2f(d),u_tile_units_to_pixels:new i.Uniform1f(d),u_alpha_discard_threshold:new i.Uniform1f(d),u_trim_offset:new i.Uniform2f(d)}),linePattern:d=>({u_matrix:new i.UniformMatrix4f(d),u_texsize:new i.Uniform2f(d),u_pixels_to_tile_units:new i.UniformMatrix2f(d),u_device_pixel_ratio:new i.Uniform1f(d),u_image:new i.Uniform1i(d),u_units_to_pixels:new i.Uniform2f(d),u_tile_units_to_pixels:new i.Uniform1f(d),u_alpha_discard_threshold:new i.Uniform1f(d)}),raster:d=>({u_matrix:new i.UniformMatrix4f(d),u_tl_parent:new i.Uniform2f(d),u_scale_parent:new i.Uniform1f(d),u_fade_t:new i.Uniform1f(d),u_opacity:new i.Uniform1f(d),u_image0:new i.Uniform1i(d),u_image1:new i.Uniform1i(d),u_brightness_low:new i.Uniform1f(d),u_brightness_high:new i.Uniform1f(d),u_saturation_factor:new i.Uniform1f(d),u_contrast_factor:new i.Uniform1f(d),u_spin_weights:new i.Uniform3f(d),u_perspective_transform:new i.Uniform2f(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new i.Uniform1i(d),u_is_size_feature_constant:new i.Uniform1i(d),u_size_t:new i.Uniform1f(d),u_size:new i.Uniform1f(d),u_camera_to_center_distance:new i.Uniform1f(d),u_rotate_symbol:new i.Uniform1i(d),u_aspect_ratio:new i.Uniform1f(d),u_fade_change:new i.Uniform1f(d),u_matrix:new i.UniformMatrix4f(d),u_label_plane_matrix:new i.UniformMatrix4f(d),u_coord_matrix:new i.UniformMatrix4f(d),u_is_text:new i.Uniform1i(d),u_pitch_with_map:new i.Uniform1i(d),u_texsize:new i.Uniform2f(d),u_tile_id:new i.Uniform3f(d),u_zoom_transition:new i.Uniform1f(d),u_inv_rot_matrix:new i.UniformMatrix4f(d),u_merc_center:new i.Uniform2f(d),u_camera_forward:new i.Uniform3f(d),u_tile_matrix:new i.UniformMatrix4f(d),u_up_vector:new i.Uniform3f(d),u_ecef_origin:new i.Uniform3f(d),u_texture:new i.Uniform1i(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new i.Uniform1i(d),u_is_size_feature_constant:new i.Uniform1i(d),u_size_t:new i.Uniform1f(d),u_size:new i.Uniform1f(d),u_camera_to_center_distance:new i.Uniform1f(d),u_rotate_symbol:new i.Uniform1i(d),u_aspect_ratio:new i.Uniform1f(d),u_fade_change:new i.Uniform1f(d),u_matrix:new i.UniformMatrix4f(d),u_label_plane_matrix:new i.UniformMatrix4f(d),u_coord_matrix:new i.UniformMatrix4f(d),u_is_text:new i.Uniform1i(d),u_pitch_with_map:new i.Uniform1i(d),u_texsize:new i.Uniform2f(d),u_texture:new i.Uniform1i(d),u_gamma_scale:new i.Uniform1f(d),u_device_pixel_ratio:new i.Uniform1f(d),u_tile_id:new i.Uniform3f(d),u_zoom_transition:new i.Uniform1f(d),u_inv_rot_matrix:new i.UniformMatrix4f(d),u_merc_center:new i.Uniform2f(d),u_camera_forward:new i.Uniform3f(d),u_tile_matrix:new i.UniformMatrix4f(d),u_up_vector:new i.Uniform3f(d),u_ecef_origin:new i.Uniform3f(d),u_is_halo:new i.Uniform1i(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new i.Uniform1i(d),u_is_size_feature_constant:new i.Uniform1i(d),u_size_t:new i.Uniform1f(d),u_size:new i.Uniform1f(d),u_camera_to_center_distance:new i.Uniform1f(d),u_rotate_symbol:new i.Uniform1i(d),u_aspect_ratio:new i.Uniform1f(d),u_fade_change:new i.Uniform1f(d),u_matrix:new i.UniformMatrix4f(d),u_label_plane_matrix:new i.UniformMatrix4f(d),u_coord_matrix:new i.UniformMatrix4f(d),u_is_text:new i.Uniform1i(d),u_pitch_with_map:new i.Uniform1i(d),u_texsize:new i.Uniform2f(d),u_texsize_icon:new i.Uniform2f(d),u_texture:new i.Uniform1i(d),u_texture_icon:new i.Uniform1i(d),u_gamma_scale:new i.Uniform1f(d),u_device_pixel_ratio:new i.Uniform1f(d),u_is_halo:new i.Uniform1i(d)}),background:d=>({u_matrix:new i.UniformMatrix4f(d),u_opacity:new i.Uniform1f(d),u_color:new i.UniformColor(d)}),backgroundPattern:d=>({u_matrix:new i.UniformMatrix4f(d),u_opacity:new i.Uniform1f(d),u_image:new i.Uniform1i(d),u_pattern_tl:new i.Uniform2f(d),u_pattern_br:new i.Uniform2f(d),u_texsize:new i.Uniform2f(d),u_pattern_size:new i.Uniform2f(d),u_pixel_coord_upper:new i.Uniform2f(d),u_pixel_coord_lower:new i.Uniform2f(d),u_tile_units_to_pixels:new i.Uniform1f(d)}),terrainRaster:Yu,terrainDepth:Yu,skybox:d=>({u_matrix:new i.UniformMatrix4f(d),u_sun_direction:new i.Uniform3f(d),u_cubemap:new i.Uniform1i(d),u_opacity:new i.Uniform1f(d),u_temporal_offset:new i.Uniform1f(d)}),skyboxGradient:d=>({u_matrix:new i.UniformMatrix4f(d),u_color_ramp:new i.Uniform1i(d),u_center_direction:new i.Uniform3f(d),u_radius:new i.Uniform1f(d),u_opacity:new i.Uniform1f(d),u_temporal_offset:new i.Uniform1f(d)}),skyboxCapture:d=>({u_matrix_3f:new i.UniformMatrix3f(d),u_sun_direction:new i.Uniform3f(d),u_sun_intensity:new i.Uniform1f(d),u_color_tint_r:new i.Uniform4f(d),u_color_tint_m:new i.Uniform4f(d),u_luminance:new i.Uniform1f(d)}),globeRaster:d=>({u_proj_matrix:new i.UniformMatrix4f(d),u_globe_matrix:new i.UniformMatrix4f(d),u_normalize_matrix:new i.UniformMatrix4f(d),u_merc_matrix:new i.UniformMatrix4f(d),u_zoom_transition:new i.Uniform1f(d),u_merc_center:new i.Uniform2f(d),u_image0:new i.Uniform1i(d),u_grid_matrix:new i.UniformMatrix3f(d),u_skirt_height:new i.Uniform1f(d),u_frustum_tl:new i.Uniform3f(d),u_frustum_tr:new i.Uniform3f(d),u_frustum_br:new i.Uniform3f(d),u_frustum_bl:new i.Uniform3f(d),u_globe_pos:new i.Uniform3f(d),u_globe_radius:new i.Uniform1f(d),u_viewport:new i.Uniform2f(d)}),globeAtmosphere:d=>({u_frustum_tl:new i.Uniform3f(d),u_frustum_tr:new i.Uniform3f(d),u_frustum_br:new i.Uniform3f(d),u_frustum_bl:new i.Uniform3f(d),u_horizon:new i.Uniform1f(d),u_transition:new i.Uniform1f(d),u_fadeout_range:new i.Uniform1f(d),u_color:new i.Uniform4f(d),u_high_color:new i.Uniform4f(d),u_space_color:new i.Uniform4f(d),u_star_intensity:new i.Uniform1f(d),u_star_density:new i.Uniform1f(d),u_star_size:new i.Uniform1f(d),u_temporal_offset:new i.Uniform1f(d),u_horizon_angle:new i.Uniform1f(d),u_rotation_matrix:new i.UniformMatrix4f(d)})};let lc;function hl(d,n,o,f,x,b,C){const M=d.context,j=M.gl,F=d.transform,z=d.useProgram("collisionBox"),G=[];let Q=0,re=0;for(let ue=0;ue<f.length;ue++){const ke=f[ue],Ee=n.getTile(ke),Se=Ee.getBucket(o);if(!Se)continue;const je=ss(ke,Se,F);let Ie=je;x[0]===0&&x[1]===0||(Ie=d.translatePosMatrix(je,Ee,x,b));const Ve=C?Se.textCollisionBox:Se.iconCollisionBox,yt=Se.collisionCircleArray;if(yt.length>0){const ze=i.create(),nt=Ie;i.mul(ze,Se.placementInvProjMatrix,F.glCoordMatrix),i.mul(ze,ze,Se.placementViewportMatrix),G.push({circleArray:yt,circleOffset:re,transform:nt,invTransform:ze,projection:Se.getProjection()}),Q+=yt.length/4,re=Q}Ve&&(d.terrain&&d.terrain.setupElevationDraw(Ee,z),z.draw(M,j.LINES,i.DepthMode.disabled,i.StencilMode.disabled,d.colorModeForRenderPass(),i.CullFaceMode.disabled,ru(Ie,F,Ee,Se.getProjection()),o.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,null,F.zoom,null,[Ve.collisionVertexBuffer,Ve.collisionVertexBufferExt]))}if(!C||!G.length)return;const ie=d.useProgram("collisionCircle"),ne=new i.StructArrayLayout2f1f2i16;ne.resize(4*Q),ne._trim();let se=0;for(const ue of G)for(let ke=0;ke<ue.circleArray.length/4;ke++){const Ee=4*ke,Se=ue.circleArray[Ee+0],je=ue.circleArray[Ee+1],Ie=ue.circleArray[Ee+2],Ve=ue.circleArray[Ee+3];ne.emplace(se++,Se,je,Ie,Ve,0),ne.emplace(se++,Se,je,Ie,Ve,1),ne.emplace(se++,Se,je,Ie,Ve,2),ne.emplace(se++,Se,je,Ie,Ve,3)}(!lc||lc.length<2*Q)&&(lc=(function(ue){const ke=2*ue,Ee=new i.StructArrayLayout3ui6;Ee.resize(ke),Ee._trim();for(let Se=0;Se<ke;Se++){const je=6*Se;Ee.uint16[je+0]=4*Se+0,Ee.uint16[je+1]=4*Se+1,Ee.uint16[je+2]=4*Se+2,Ee.uint16[je+3]=4*Se+2,Ee.uint16[je+4]=4*Se+3,Ee.uint16[je+5]=4*Se+0}return Ee})(Q));const W=M.createIndexBuffer(lc,!0),te=M.createVertexBuffer(ne,i.collisionCircleLayout.members,!0);for(const ue of G){const ke={u_matrix:ue.transform,u_inv_matrix:ue.invTransform,u_camera_to_center_distance:(le=F).getCameraToCenterDistance(ue.projection),u_viewport_size:[le.width,le.height]};ie.draw(M,j.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,d.colorModeForRenderPass(),i.CullFaceMode.disabled,ke,o.id,te,W,i.SegmentVector.simpleSegment(0,2*ue.circleOffset,ue.circleArray.length,ue.circleArray.length/2),null,F.zoom)}var le;te.destroy(),W.destroy()}const ch=i.create();function uh({width:d,height:n,anchor:o,textOffset:f,textScale:x},b){const{horizontalAlign:C,verticalAlign:M}=i.getAnchorAlignment(o),j=-(C-.5)*d,F=-(M-.5)*n,z=i.evaluateVariableOffset(o,f);return new i.Point((j/x+z[0])*b,(F/x+z[1])*b)}function Sp(d,n,o,f,x,b,C,M,j,F,z){const G=d.text.placedSymbolArray,Q=d.text.dynamicLayoutVertexArray,re=d.icon.dynamicLayoutVertexArray,ie={},ne=d.getProjection(),se=dn(M,ne,b),W=b.elevation,te=ne.upVectorScale(M.canonical,b.center.lat,b.worldSize).metersToTile;Q.clear();for(let le=0;le<G.length;le++){const ue=G.get(le),{tileAnchorX:ke,tileAnchorY:Ee,numGlyphs:Se}=ue,je=ue.hidden||!ue.crossTileID||d.allowVerticalPlacement&&!ue.placedOrientation?null:f[ue.crossTileID];if(je){let Ie=0,Ve=0,yt=0;if(W){const vt=W?W.getAtTileOffset(M,ke,Ee):0,[Wt,or,Vt]=ne.upVector(M.canonical,ke,Ee);Ie=vt*Wt*te,Ve=vt*or*te,yt=vt*Vt*te}let[ze,nt,We,mt]=hi(ue.projectedAnchorX+Ie,ue.projectedAnchorY+Ve,ue.projectedAnchorZ+yt,o?se:C);const Ue=nd(b.getCameraToCenterDistance(ne),mt);let it=x.evaluateSizeForFeature(d.textSizeData,F,ue)*Ue/i.ONE_EM;o&&(it*=d.tilePixelRatio/j);const ft=uh(je,it);o?({x:ze,y:nt,z:We}=ne.projectTilePoint(ke+ft.x,Ee+ft.y,M.canonical),[ze,nt,We]=hi(ze+Ie,nt+Ve,We+yt,C)):(n&&ft._rotate(-b.angle),ze+=ft.x,nt+=ft.y,We=0);const pt=d.allowVerticalPlacement&&ue.placedOrientation===i.WritingMode.vertical?Math.PI/2:0;for(let vt=0;vt<Se;vt++)i.addDynamicAttributes(Q,ze,nt,We,pt);z&&ue.associatedIconIndex>=0&&(ie[ue.associatedIconIndex]={x:ze,y:nt,z:We,angle:pt})}else ns(Se,Q)}if(z){re.clear();const le=d.icon.placedSymbolArray;for(let ue=0;ue<le.length;ue++){const ke=le.get(ue),{numGlyphs:Ee}=ke,Se=ie[ue];if(ke.hidden||!Se)ns(Ee,re);else{const{x:je,y:Ie,z:Ve,angle:yt}=Se;for(let ze=0;ze<Ee;ze++)i.addDynamicAttributes(re,je,Ie,Ve,yt)}}d.icon.dynamicLayoutVertexBuffer.updateData(re)}d.text.dynamicLayoutVertexBuffer.updateData(Q)}function hh(d,n,o){return o.iconsInText&&n?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function ud(d,n,o,f,x,b,C,M,j,F,z,G){const Q=d.context,re=Q.gl,ie=d.transform,ne=M==="map",se=j==="map",W=ne&&o.layout.get("symbol-placement")!=="point",te=ne&&!se&&!W,le=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ue=!1;const ke=d.depthModeForSublayer(0,i.DepthMode.ReadOnly),Ee=[i.mercatorXfromLng(ie.center.lng),i.mercatorYfromLat(ie.center.lat)],Se=o.layout.get("text-variable-anchor"),je=ie.projection.name==="globe",Ie=[],Ve=[0,-1,0];let yt=Ve;!je&&!ie.mercatorFromTransition||ne||(yt=(function(ze){const nt=ze._camera.getWorldToCamera(ze.worldSize,1),We=i.multiply([],nt,ze.globeMatrix);i.invert(We,We);const mt=[0,0,0],Ue=[0,1,0,0];return i.transformMat4$1(Ue,Ue,We),mt[0]=Ue[0],mt[1]=Ue[1],mt[2]=Ue[2],i.normalize(mt,mt),mt})(ie));for(const ze of f){const nt=n.getTile(ze),We=nt.getBucket(o);if(!We||We.projection.name==="mercator"&&je)continue;const mt=x?We.text:We.icon;if(!mt||We.fullyClipped||!mt.segments.get().length)continue;const Ue=mt.programConfigurations.get(o.id),it=x||We.sdfIcons,ft=x?We.textSizeData:We.iconSizeData,pt=se||ie.pitch!==0,vt=i.evaluateSizeForZoom(ft,ie.zoom);let Wt,or,Vt,tr,Sr=[0,0],Pr=null;if(x)or=nt.glyphAtlasTexture,Vt=re.LINEAR,Wt=nt.glyphAtlasTexture.size,We.iconsInText&&(Sr=nt.imageAtlasTexture.size,Pr=nt.imageAtlasTexture,tr=pt||d.options.rotating||d.options.zooming||ft.kind==="composite"||ft.kind==="camera"?re.LINEAR:re.NEAREST);else{const Ms=o.layout.get("icon-size").constantOr(0)!==1||We.iconsNeedLinear;or=nt.imageAtlasTexture,Vt=it||d.options.rotating||d.options.zooming||Ms||pt?re.LINEAR:re.NEAREST,Wt=nt.imageAtlasTexture.size}const Zt=We.projection.name==="globe",Dr=Zt?yt:Ve,Xr=Zt?i.globeToMercatorTransition(ie.zoom):0,Kr=dn(ze,We.getProjection(),ie),qr=ie.calculatePixelsToTileUnitsMatrix(nt),mi=at(Kr,nt.tileID.canonical,se,ne,ie,We.getProjection(),qr),In=d.terrain&&se&&W?i.invert(i.create(),mi):ch,us=Gn(Kr,nt.tileID.canonical,se,ne,ie,We.getProjection(),qr),Cs=Se&&We.hasTextData(),_r=o.layout.get("icon-text-fit")!=="none"&&Cs&&We.hasIconData();if(W){const Ms=ie.elevation,As=Ms?Ms.getAtTileOffsetFunc(ze,ie.center.lat,ie.worldSize,We.getProjection()):null,$s=ni(Kr,nt.tileID.canonical,se,ne,ie,We.getProjection(),qr);Qo(We,Kr,d,x,$s,us,se,F,As,ze)}const tn=W||x&&Se||_r,$r=d.translatePosMatrix(Kr,nt,b,C),jn=tn?ch:mi,gi=d.translatePosMatrix(us,nt,b,C,!0),ln=We.getProjection().createInversionMatrix(ie,ze.canonical),Hn=[];d.terrainRenderModeElevated()&&se&&Hn.push("PITCH_WITH_MAP_TERRAIN"),Zt&&Hn.push("PROJECTION_GLOBE_VIEW"),tn&&Hn.push("PROJECTED_POS_ON_VIEWPORT");const bn=it&&o.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let kn;kn=it?We.iconsInText?cd(ft.kind,vt,te,se,d,$r,jn,gi,Wt,Sr,ze,Xr,Ee,ln,Dr,We.getProjection()):To(ft.kind,vt,te,se,d,$r,jn,gi,x,Wt,!0,ze,Xr,Ee,ln,Dr,We.getProjection()):oh(ft.kind,vt,te,se,d,$r,jn,gi,x,Wt,ze,Xr,Ee,ln,Dr,We.getProjection());const Bn={program:d.useProgram(hh(it,x,We),Ue,Hn),buffers:mt,uniformValues:kn,atlasTexture:or,atlasTextureIcon:Pr,atlasInterpolation:Vt,atlasInterpolationIcon:tr,isSDF:it,hasHalo:bn,tile:nt,labelPlaneMatrixInv:In};if(le&&We.canOverlap){ue=!0;const Ms=mt.segments.get();for(const As of Ms)Ie.push({segments:new i.SegmentVector([As]),sortKey:As.sortKey,state:Bn})}else Ie.push({segments:mt.segments,sortKey:0,state:Bn})}ue&&Ie.sort(((ze,nt)=>ze.sortKey-nt.sortKey));for(const ze of Ie){const nt=ze.state;if(d.terrain&&d.terrain.setupElevationDraw(nt.tile,nt.program,{useDepthForOcclusion:!je,labelPlaneMatrixInv:nt.labelPlaneMatrixInv}),Q.activeTexture.set(re.TEXTURE0),nt.atlasTexture.bind(nt.atlasInterpolation,re.CLAMP_TO_EDGE),nt.atlasTextureIcon&&(Q.activeTexture.set(re.TEXTURE1),nt.atlasTextureIcon&&nt.atlasTextureIcon.bind(nt.atlasInterpolationIcon,re.CLAMP_TO_EDGE)),nt.isSDF){const We=nt.uniformValues;nt.hasHalo&&(We.u_is_halo=1,cc(nt.buffers,ze.segments,o,d,nt.program,ke,z,G,We)),We.u_is_halo=0}cc(nt.buffers,ze.segments,o,d,nt.program,ke,z,G,nt.uniformValues)}}function cc(d,n,o,f,x,b,C,M,j){const F=f.context,z=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.globeExtVertexBuffer];x.draw(F,F.gl.TRIANGLES,b,C,M,i.CullFaceMode.disabled,j,o.id,d.layoutVertexBuffer,d.indexBuffer,n,o.paint,f.transform.zoom,d.programConfigurations.get(o.id),z)}function ks(d,n,o,f,x,b,C){const M=d.context.gl,j=o.paint.get("fill-pattern"),F=j&&j.constantOr(1);let z,G,Q,re,ie;C?(G=F&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=M.LINES):(G=F?"fillPattern":"fill",z=M.TRIANGLES);for(const ne of f){const se=n.getTile(ne);if(F&&!se.patternsLoaded())continue;const W=se.getBucket(o);if(!W)continue;d.prepareDrawTile();const te=W.programConfigurations.get(o.id),le=d.useProgram(G,te);F&&(d.context.activeTexture.set(M.TEXTURE0),se.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),te.updatePaintBuffers());const ue=j.constantOr(null);if(ue&&se.imageAtlas){const Ee=se.imageAtlas.patternPositions[ue.toString()];Ee&&te.setConstantPatternPositions(Ee)}const ke=d.translatePosMatrix(ne.projMatrix,se,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(C){re=W.indexBuffer2,ie=W.segments2;const Ee=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];Q=G==="fillOutlinePattern"&&F?rh(ke,d,se,Ee):kp(ke,Ee)}else re=W.indexBuffer,ie=W.segments,Q=F?th(ke,d,se):wo(ke);d.prepareDrawProgram(d.context,le,ne.toUnwrapped()),le.draw(d.context,z,x,d.stencilModeForClipping(ne),b,i.CullFaceMode.disabled,Q,o.id,W.layoutVertexBuffer,re,ie,o.paint,d.transform.zoom,te)}}function Za(d,n,o,f,x,b,C){const M=d.context,j=M.gl,F=d.transform,z=o.paint.get("fill-extrusion-pattern"),G=z.constantOr(1),Q=o.paint.get("fill-extrusion-opacity"),re=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),o.paint.get("fill-extrusion-ambient-occlusion-radius")],ie=o.layout.get("fill-extrusion-edge-radius"),ne=ie>0&&!o.paint.get("fill-extrusion-rounded-roof"),se=ne?0:ie,W=F.projection.name==="globe"?i.fillExtrusionHeightLift():0,te=F.projection.name==="globe",le=te?i.globeToMercatorTransition(F.zoom):0,ue=[i.mercatorXfromLng(F.center.lng),i.mercatorYfromLat(F.center.lat)],ke=[];te&&ke.push("PROJECTION_GLOBE_VIEW"),re[0]>0&&ke.push("FAUX_AO"),ne&&ke.push("ZERO_ROOF_RADIUS");for(const Ee of f){const Se=n.getTile(Ee),je=Se.getBucket(o);if(!je||je.projection.name!==F.projection.name)continue;const Ie=je.programConfigurations.get(o.id),Ve=d.useProgram(G?"fillExtrusionPattern":"fillExtrusion",Ie,ke);if(d.terrain){const it=d.terrain;if(d.style.terrainSetForDrapingOnly())it.setupElevationDraw(Se,Ve,{useMeterToDem:!0});else{if(!je.enableTerrain)continue;if(it.setupElevationDraw(Se,Ve,{useMeterToDem:!0}),dh(M,n,Ee,je,o,it),!je.centroidVertexBuffer){const ft=Ve.attributes.a_centroid_pos;ft!==void 0&&j.vertexAttrib2f(ft,0,0)}}}G&&(d.context.activeTexture.set(j.TEXTURE0),Se.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Ie.updatePaintBuffers());const yt=z.constantOr(null);if(yt&&Se.imageAtlas){const it=Se.imageAtlas.patternPositions[yt.toString()];it&&Ie.setConstantPatternPositions(it)}const ze=d.translatePosMatrix(Ee.projMatrix,Se,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),nt=F.projection.createInversionMatrix(F,Ee.canonical),We=o.paint.get("fill-extrusion-vertical-gradient"),mt=G?ld(ze,d,We,Q,re,se,Ee,Se,W,le,ue,nt):eh(ze,d,We,Q,re,se,Ee,W,le,ue,nt);d.prepareDrawProgram(M,Ve,Ee.toUnwrapped());const Ue=[];d.terrain&&Ue.push(je.centroidVertexBuffer),te&&Ue.push(je.layoutVertexExtBuffer),Ve.draw(M,M.gl.TRIANGLES,x,b,C,i.CullFaceMode.backCCW,mt,o.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,o.paint,d.transform.zoom,Ie,Ue)}}function dh(d,n,o,f,x,b){const C=[W=>{let te=W.canonical.x-1,le=W.wrap;return te<0&&(te=(1<<W.canonical.z)-1,le--),new i.OverscaledTileID(W.overscaledZ,le,W.canonical.z,te,W.canonical.y)},W=>{let te=W.canonical.x+1,le=W.wrap;return te===1<<W.canonical.z&&(te=0,le++),new i.OverscaledTileID(W.overscaledZ,le,W.canonical.z,te,W.canonical.y)},W=>new i.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,(W.canonical.y===0?1<<W.canonical.z:W.canonical.y)-1),W=>new i.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y===(1<<W.canonical.z)-1?0:W.canonical.y+1)],M=W=>{const te=n.getSource().minzoom,le=ke=>{const Ee=n.getTileByID(ke);if(Ee&&Ee.hasData())return Ee.getBucket(x)},ue=[0,-1,1];for(const ke of ue){if(W.overscaledZ+ke<te)continue;const Ee=le(W.calculateScaledKey(W.overscaledZ+ke));if(Ee)return Ee}},j=[0,0,0],F=(W,te)=>(j[0]=Math.min(W.min.y,te.min.y),j[1]=Math.max(W.max.y,te.max.y),j[2]=i.EXTENT-te.min.x>W.max.x?te.min.x-i.EXTENT:W.max.x,j),z=(W,te)=>(j[0]=Math.min(W.min.x,te.min.x),j[1]=Math.max(W.max.x,te.max.x),j[2]=i.EXTENT-te.min.y>W.max.y?te.min.y-i.EXTENT:W.max.y,j),G=[(W,te)=>F(W,te),(W,te)=>F(te,W),(W,te)=>z(W,te),(W,te)=>z(te,W)],Q=new i.Point(0,0);let re,ie,ne;const se=(W,te,le,ue,ke)=>{const Ee=[[ue?le:W,ue?W:le,0],[ue?le:te,ue?te:le,0]],Se=ke<0?i.EXTENT+ke:ke,je=[ue?Se:(W+te)/2,ue?(W+te)/2:Se,0];return le===0&&ke<0||le!==0&&ke>0?b.getForTilePoints(ne,[je],!0,ie):Ee.push(je),b.getForTilePoints(o,Ee,!0,re),Math.max(Ee[0][2],Ee[1][2],je[2])/b.exaggeration()};for(let W=0;W<4;W++){const te=(W<2?1:5)-W,le=f.borders[W];if(le.length===0)continue;const ue=ne=C[W](o),ke=M(ue);if(!(ke&&ke instanceof i.FillExtrusionBucket&&ke.enableTerrain)||f.borderDoneWithNeighborZ[W]===ke.canonical.z&&ke.borderDoneWithNeighborZ[te]===f.canonical.z||(ie=b.findDEMTileFor(ue),!ie||!ie.dem))continue;if(!re){const Ie=b.findDEMTileFor(o);if(!Ie||!Ie.dem)return;re=Ie}const Ee=ke.borders[te];let Se=0;const je=ke.borderDoneWithNeighborZ[te]!==f.canonical.z;if(f.canonical.z===ke.canonical.z){for(let Ie=0;Ie<le.length;Ie++){const Ve=f.featuresOnBorder[le[Ie]],yt=Ve.borders[W];let ze;for(;Se<Ee.length&&(ze=ke.featuresOnBorder[Ee[Se]],!(ze.borders[te][1]>yt[0]+3));)je&&ke.encodeCentroid(void 0,ze,!1),Se++;if(ze&&Se<Ee.length){const nt=Se;let We=0;for(;!(ze.borders[te][0]>yt[1]-3)&&(We++,++Se!==Ee.length);)ze=ke.featuresOnBorder[Ee[Se]];if(ze=ke.featuresOnBorder[Ee[nt]],Ve.intersectsCount()>1||ze.intersectsCount()>1||We!==1){We!==1&&(Se=nt),f.encodeCentroid(void 0,Ve,!1),je&&ke.encodeCentroid(void 0,ze,!1);continue}const mt=G[W](Ve,ze),Ue=W%2?i.EXTENT-1:0;Q.x=se(mt[0],Math.min(i.EXTENT-1,mt[1]),Ue,W<2,mt[2]),Q.y=0,f.encodeCentroid(Q,Ve,!1),je&&ke.encodeCentroid(Q,ze,!1)}else f.encodeCentroid(void 0,Ve,!1)}f.borderDoneWithNeighborZ[W]=ke.canonical.z,f.needsCentroidUpdate=!0,je&&(ke.borderDoneWithNeighborZ[te]=f.canonical.z,ke.needsCentroidUpdate=!0)}else{for(const Ie of le)f.encodeCentroid(void 0,f.featuresOnBorder[Ie],!1);if(je){for(const Ie of Ee)ke.encodeCentroid(void 0,ke.featuresOnBorder[Ie],!1);ke.borderDoneWithNeighborZ[te]=f.canonical.z,ke.needsCentroidUpdate=!0}f.borderDoneWithNeighborZ[W]=ke.canonical.z,f.needsCentroidUpdate=!0}}(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(d)}const ko=new i.Color(1,0,0,1),hd=new i.Color(0,1,0,1),dd=new i.Color(0,0,1,1),ph=new i.Color(1,0,1,1),Ep=new i.Color(0,1,1,1);function Cp(d,n,o){const f=d.context,x=d.transform,b=f.gl,C=x.projection.name==="globe",M=C?["PROJECTION_GLOBE_VIEW"]:null;let j=o.projMatrix;if(C&&i.globeToMercatorTransition(x.zoom)>0){const Ve=i.transitionTileAABBinECEF(o.canonical,x),yt=i.globeDenormalizeECEF(Ve);j=i.multiply(new Float32Array(16),x.globeMatrix,yt),i.multiply(j,x.projMatrix,j)}const F=d.useProgram("debug",null,M),z=n.getTileByID(o.key);d.terrain&&d.terrain.setupElevationDraw(z,F);const G=i.DepthMode.disabled,Q=i.StencilMode.disabled,re=d.colorModeForRenderPass(),ie="$debug";f.activeTexture.set(b.TEXTURE0),d.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),C?z._makeGlobeTileDebugBuffers(d.context,x):z._makeDebugTileBoundsBuffers(d.context,x.projection);const ne=z._tileDebugBuffer||d.debugBuffer,se=z._tileDebugIndexBuffer||d.debugIndexBuffer,W=z._tileDebugSegments||d.debugSegments;F.draw(f,b.LINE_STRIP,G,Q,re,i.CullFaceMode.disabled,sc(j,i.Color.red),ie,ne,se,W,null,null,null,[z._globeTileDebugBorderBuffer]);const te=z.latestRawTileData,le=Math.floor((te&&te.byteLength||0)/1024),ue=n.getTile(o).tileSize,ke=512/Math.min(ue,512)*(o.overscaledZ/x.zoom)*.5;let Ee=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Ee+=` => ${o.overscaledZ}`),Ee+=` ${le}kb`,(function(Ve,yt){Ve.initDebugOverlayCanvas();const ze=Ve.debugOverlayCanvas,nt=Ve.context.gl,We=Ve.debugOverlayCanvas.getContext("2d");We.clearRect(0,0,ze.width,ze.height),We.shadowColor="white",We.shadowBlur=2,We.lineWidth=1.5,We.strokeStyle="white",We.textBaseline="top",We.font="bold 36px Open Sans, sans-serif",We.fillText(yt,5,5),We.strokeText(yt,5,5),Ve.debugOverlayTexture.update(ze),Ve.debugOverlayTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE)})(d,Ee);const Se=z._tileDebugTextBuffer||d.debugBuffer,je=z._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Ie=z._tileDebugTextSegments||d.debugSegments;F.draw(f,b.TRIANGLES,G,Q,i.ColorMode.alphaBlended,i.CullFaceMode.disabled,sc(j,i.Color.transparent,ke),ie,Se,je,Ie,null,null,null,[z._globeTileDebugTextBuffer])}function So(d,n,o,f){sa(d,0,n+o/2,d.transform.width,o,f)}function dl(d,n,o,f){sa(d,n-o/2,0,o,d.transform.height,f)}function sa(d,n,o,f,x,b){const C=d.context,M=C.gl;M.enable(M.SCISSOR_TEST),M.scissor(n*i.exported.devicePixelRatio,o*i.exported.devicePixelRatio,f*i.exported.devicePixelRatio,x*i.exported.devicePixelRatio),C.clear({color:b}),M.disable(M.SCISSOR_TEST)}const su=i.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:fh}=su;function Ss(d,n,o,f){d.emplaceBack(n,o,f)}class wa{constructor(n){this.vertexArray=new i.StructArrayLayout3f12,this.indices=new i.StructArrayLayout3ui6,Ss(this.vertexArray,-1,-1,1),Ss(this.vertexArray,1,-1,1),Ss(this.vertexArray,-1,1,1),Ss(this.vertexArray,1,1,1),Ss(this.vertexArray,-1,-1,-1),Ss(this.vertexArray,1,-1,-1),Ss(this.vertexArray,-1,1,-1),Ss(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,fh),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=i.SegmentVector.simpleSegment(0,0,36,12)}}function Wi(d,n,o,f,x,b){const C=d.gl,M=n.paint.get("sky-atmosphere-color"),j=n.paint.get("sky-atmosphere-halo-color"),F=n.paint.get("sky-atmosphere-sun-intensity"),z=((G,Q,re,ie,ne)=>({u_matrix_3f:G,u_sun_direction:Q,u_sun_intensity:re,u_color_tint_r:[ie.r,ie.g,ie.b,ie.a],u_color_tint_m:[ne.r,ne.g,ne.b,ne.a],u_luminance:5e-5}))(i.fromMat4(i.create$1(),f),x,F,M,j);C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),o.draw(d,C.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,i.ColorMode.unblended,i.CullFaceMode.frontCW,z,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const pl=i.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class uc{constructor(n){const o=new i.StructArrayLayout5f20;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const f=new i.StructArrayLayout3ui6;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(o,pl.members),this.indexBuffer=n.createIndexBuffer(f),this.segments=i.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ha={symbol:function(d,n,o,f,x){if(d.renderPass!=="translucent")return;const b=i.StencilMode.disabled,C=d.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&(function(M,j,F,z,G,Q,re){const ie=j.transform,ne=G==="map",se=Q==="map";for(const W of M){const te=z.getTile(W),le=te.getBucket(F);if(!le||!le.text||!le.text.segments.get().length)continue;const ue=i.evaluateSizeForZoom(le.textSizeData,ie.zoom),ke=dn(W,le.getProjection(),ie),Ee=ie.calculatePixelsToTileUnitsMatrix(te),Se=at(ke,te.tileID.canonical,se,ne,ie,le.getProjection(),Ee),je=F.layout.get("icon-text-fit")!=="none"&&le.hasIconData();if(ue){const Ie=Math.pow(2,ie.zoom-te.tileID.overscaledZ);Sp(le,ne,se,re,i.symbolSize,ie,Se,W,Ie,ue,je)}}})(f,d,o,n,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),x),o.paint.get("icon-opacity").constantOr(1)!==0&&ud(d,n,o,f,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),b,C),o.paint.get("text-opacity").constantOr(1)!==0&&ud(d,n,o,f,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),b,C),n.map.showCollisionBoxes&&(hl(d,n,o,f,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),hl(d,n,o,f,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(d,n,o,f){if(d.renderPass!=="translucent")return;const x=o.paint.get("circle-opacity"),b=o.paint.get("circle-stroke-width"),C=o.paint.get("circle-stroke-opacity"),M=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)===0&&(b.constantOr(1)===0||C.constantOr(1)===0))return;const j=d.context,F=j.gl,z=d.transform,G=d.depthModeForSublayer(0,i.DepthMode.ReadOnly),Q=i.StencilMode.disabled,re=d.colorModeForRenderPass(),ie=z.projection.name==="globe",ne=[i.mercatorXfromLng(z.center.lng),i.mercatorYfromLat(z.center.lat)],se=[];for(let te=0;te<f.length;te++){const le=f[te],ue=n.getTile(le),ke=ue.getBucket(o);if(!ke||ke.projection.name!==z.projection.name)continue;const Ee=ke.programConfigurations.get(o.id),Se=tu(o);ie&&Se.push("PROJECTION_GLOBE_VIEW");const je=d.useProgram("circle",Ee,Se),Ie=ke.layoutVertexBuffer,Ve=ke.globeExtVertexBuffer,yt=ke.indexBuffer,ze=z.projection.createInversionMatrix(z,le.canonical),nt={programConfiguration:Ee,program:je,layoutVertexBuffer:Ie,globeExtVertexBuffer:Ve,indexBuffer:yt,uniformValues:nh(d,le,ue,ze,ne,o),tile:ue};if(M){const We=ke.segments.get();for(const mt of We)se.push({segments:new i.SegmentVector([mt]),sortKey:mt.sortKey,state:nt})}else se.push({segments:ke.segments,sortKey:0,state:nt})}M&&se.sort(((te,le)=>te.sortKey-le.sortKey));const W={useDepthForOcclusion:!ie};for(const te of se){const{programConfiguration:le,program:ue,layoutVertexBuffer:ke,globeExtVertexBuffer:Ee,indexBuffer:Se,uniformValues:je,tile:Ie}=te.state,Ve=te.segments;d.terrain&&d.terrain.setupElevationDraw(Ie,ue,W),d.prepareDrawProgram(j,ue,Ie.tileID.toUnwrapped()),ue.draw(j,F.TRIANGLES,G,Q,re,i.CullFaceMode.disabled,je,o.id,ke,Se,Ve,o.paint,z.zoom,le,[Ee])}},heatmap:function(d,n,o,f){if(o.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const x=d.context,b=x.gl,C=i.StencilMode.disabled,M=new i.ColorMode([b.ONE,b.ONE],i.Color.transparent,[!0,!0,!0,!0]);(function(re,ie,ne,se){const W=re.gl,te=ie.width*se,le=ie.height*se;re.activeTexture.set(W.TEXTURE1),re.viewport.set([0,0,te,le]);let ue=ne.heatmapFbo;if(!ue||ue&&(ue.width!==te||ue.height!==le)){ue&&ue.destroy();const ke=W.createTexture();W.bindTexture(W.TEXTURE_2D,ke),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),ue=ne.heatmapFbo=re.createFramebuffer(te,le,!1),(function(Ee,Se,je,Ie,Ve,yt){const ze=Ee.gl;ze.texImage2D(ze.TEXTURE_2D,0,Ee.isWebGL2&&Ee.extRenderToTextureHalfFloat?ze.RGBA16F:ze.RGBA,Ve,yt,0,ze.RGBA,Ee.extRenderToTextureHalfFloat?Ee.isWebGL2?ze.HALF_FLOAT:Ee.extTextureHalfFloat.HALF_FLOAT_OES:ze.UNSIGNED_BYTE,null),Ie.colorAttachment.set(je)})(re,0,ke,ue,te,le)}else W.bindTexture(W.TEXTURE_2D,ue.colorAttachment.get()),re.bindFramebuffer.set(ue.framebuffer)})(x,d,o,d.transform.projection.name==="globe"?.5:.25),x.clear({color:i.Color.transparent});const j=d.transform,F=j.projection.name==="globe",z=F?["PROJECTION_GLOBE_VIEW"]:null,G=F?i.CullFaceMode.frontCCW:i.CullFaceMode.disabled,Q=[i.mercatorXfromLng(j.center.lng),i.mercatorYfromLat(j.center.lat)];for(let re=0;re<f.length;re++){const ie=f[re];if(n.hasRenderableParent(ie))continue;const ne=n.getTile(ie),se=ne.getBucket(o);if(!se||se.projection.name!==j.projection.name)continue;const W=se.programConfigurations.get(o.id),te=d.useProgram("heatmap",W,z),{zoom:le}=d.transform;d.terrain&&d.terrain.setupElevationDraw(ne,te),d.prepareDrawProgram(x,te,ie.toUnwrapped());const ue=j.projection.createInversionMatrix(j,ie.canonical);te.draw(x,b.TRIANGLES,i.DepthMode.disabled,C,M,G,sh(d,ie,ne,ue,Q,le,o.paint.get("heatmap-intensity")),o.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,o.paint,d.transform.zoom,W,F?[se.globeExtVertexBuffer]:null)}x.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),(function(x,b){const C=x.context,M=C.gl,j=b.heatmapFbo;if(!j)return;C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,j.colorAttachment.get()),C.activeTexture.set(M.TEXTURE1);let F=b.colorRampTexture;F||(F=b.colorRampTexture=new i.Texture(C,b.colorRamp,M.RGBA)),F.bind(M.LINEAR,M.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(C,M.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,x.colorModeForRenderPass(),i.CullFaceMode.disabled,((z,G,Q,re)=>({u_image:0,u_color_ramp:1,u_opacity:G.paint.get("heatmap-opacity")}))(0,b),b.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,b.paint,x.transform.zoom)})(d,o))},line:function(d,n,o,f){if(d.renderPass!=="translucent")return;const x=o.paint.get("line-opacity"),b=o.paint.get("line-width");if(x.constantOr(1)===0||b.constantOr(1)===0)return;const C=d.depthModeForSublayer(0,i.DepthMode.ReadOnly),M=d.colorModeForRenderPass(),j=d.terrain&&d.terrain.renderingToTexture?1:i.exported.devicePixelRatio,F=o.paint.get("line-dasharray"),z=F.constantOr(1),G=o.layout.get("line-cap"),Q=o.paint.get("line-pattern"),re=Q.constantOr(1),ie=o.paint.get("line-gradient"),ne=re?"linePattern":"line",se=d.context,W=se.gl,te=(ue=>{const ke=[];ul(ue)&&ke.push("RENDER_LINE_DASH"),ue.paint.get("line-gradient")&&ke.push("RENDER_LINE_GRADIENT");const Ee=ue.paint.get("line-trim-offset");Ee[0]===0&&Ee[1]===0||ke.push("RENDER_LINE_TRIM_OFFSET");const Se=ue.paint.get("line-pattern").constantOr(1),je=ue.paint.get("line-opacity").constantOr(1)!==1;return!Se&&je&&ke.push("RENDER_LINE_ALPHA_DISCARD"),ke})(o);let le=te.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(le=!1);for(const ue of f){const ke=n.getTile(ue);if(re&&!ke.patternsLoaded())continue;const Ee=ke.getBucket(o);if(!Ee)continue;d.prepareDrawTile();const Se=Ee.programConfigurations.get(o.id),je=d.useProgram(ne,Se,te),Ie=Q.constantOr(null);if(Ie&&ke.imageAtlas){const it=ke.imageAtlas.patternPositions[Ie.toString()];it&&Se.setConstantPatternPositions(it)}const Ve=F.constantOr(null),yt=G.constantOr(null);if(!re&&Ve&&yt&&ke.lineAtlas){const it=ke.lineAtlas.getDash(Ve,yt);it&&Se.setConstantPatternPositions(it)}let[ze,nt]=o.paint.get("line-trim-offset");(yt==="round"||yt==="square")&&ze!==nt&&(ze===0&&(ze-=1),nt===1&&(nt+=1));const We=d.terrain?ue.projMatrix:null,mt=re?ac(d,ke,o,We,j):ll(d,ke,o,We,Ee.lineClipsArray.length,j,[ze,nt]);if(ie){const it=Ee.gradients[o.id];let ft=it.texture;if(o.gradientVersion!==it.version){let pt=256;if(o.stepInterpolant){const vt=n.getSource().maxzoom,Wt=ue.canonical.z===vt?Math.ceil(1<<d.transform.maxZoom-ue.canonical.z):1;pt=i.clamp(i.nextPowerOfTwo(Ee.maxLineLength/i.EXTENT*1024*Wt),256,se.maxTextureSize)}it.gradient=i.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:pt,image:it.gradient||void 0,clips:Ee.lineClipsArray}),it.texture?it.texture.update(it.gradient):it.texture=new i.Texture(se,it.gradient,W.RGBA),it.version=o.gradientVersion,ft=it.texture}se.activeTexture.set(W.TEXTURE1),ft.bind(o.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}z&&(se.activeTexture.set(W.TEXTURE0),ke.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),Se.updatePaintBuffers()),re&&(se.activeTexture.set(W.TEXTURE0),ke.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Se.updatePaintBuffers()),d.prepareDrawProgram(se,je,ue.toUnwrapped());const Ue=it=>{je.draw(se,W.TRIANGLES,C,it,M,i.CullFaceMode.disabled,mt,o.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,o.paint,d.transform.zoom,Se,[Ee.layoutVertexBuffer2])};if(le){const it=d.stencilModeForClipping(ue).ref;it===0&&d.terrain&&se.clear({stencil:0});const ft={func:W.EQUAL,mask:255};mt.u_alpha_discard_threshold=.8,Ue(new i.StencilMode(ft,it,255,W.KEEP,W.KEEP,W.INVERT)),mt.u_alpha_discard_threshold=0,Ue(new i.StencilMode(ft,it,255,W.KEEP,W.KEEP,W.KEEP))}else Ue(d.stencilModeForClipping(ue))}le&&(d.resetStencilClippingMasks(),d.terrain&&se.clear({stencil:0}))},fill:function(d,n,o,f){const x=o.paint.get("fill-color"),b=o.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const C=d.colorModeForRenderPass(),M=o.paint.get("fill-pattern"),j=d.opaquePassEnabledForLayer()&&!M.constantOr(1)&&x.constantOr(i.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===j){const F=d.depthModeForSublayer(1,d.renderPass==="opaque"?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly);ks(d,n,o,f,F,C,!1)}if(d.renderPass==="translucent"&&o.paint.get("fill-antialias")){const F=d.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,i.DepthMode.ReadOnly);ks(d,n,o,f,F,C,!0)}},"fill-extrusion":function(d,n,o,f){const x=o.paint.get("fill-extrusion-opacity");if(x!==0&&d.renderPass==="translucent"){const b=new i.DepthMode(d.context.gl.LEQUAL,i.DepthMode.ReadWrite,d.depthRangeFor3D);if(x!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))Za(d,n,o,f,b,i.StencilMode.disabled,i.ColorMode.disabled),Za(d,n,o,f,b,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const C=d.colorModeForRenderPass();Za(d,n,o,f,b,i.StencilMode.disabled,C)}}},hillshade:function(d,n,o,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const x=d.context,b=d.depthModeForSublayer(0,i.DepthMode.ReadOnly),C=d.colorModeForRenderPass(),M=d.terrain&&d.terrain.renderingToTexture,[j,F]=d.renderPass!=="translucent"||M?[{},f]:d.stencilConfigForOverlap(f);for(const z of F){const G=n.getTile(z);if(G.needsHillshadePrepare&&d.renderPass==="offscreen")Kc(d,G,o,b,i.StencilMode.disabled,C);else if(d.renderPass==="translucent"){const Q=M&&d.terrain?d.terrain.stencilModeForRTTOverlap(z):j[z.overscaledZ];sd(d,z,G,o,b,Q,C)}}x.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,n,o,f,x,b){if(d.renderPass!=="translucent"||o.paint.get("raster-opacity")===0||!f.length)return;const C=d.context,M=C.gl,j=n.getSource(),F=d.useProgram("raster"),z=d.colorModeForRenderPass(),G=d.terrain&&d.terrain.renderingToTexture,[Q,re]=j instanceof xr||G?[{},f]:d.stencilConfigForOverlap(f),ie=re[re.length-1].overscaledZ,ne=!d.options.moving;for(const se of re){const W=G?i.DepthMode.disabled:d.depthModeForSublayer(se.overscaledZ-ie,o.paint.get("raster-opacity")===1?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly,M.LESS),te=se.toUnwrapped(),le=n.getTile(se);if(G&&(!le||!le.hasData()))continue;const ue=G?se.projMatrix:d.transform.calculateProjMatrix(te,ne),ke=d.terrain&&G?d.terrain.stencilModeForRTTOverlap(se):Q[se.overscaledZ],Ee=b?0:o.paint.get("raster-fade-duration");le.registerFadeDuration(Ee);const Se=n.findLoadedParent(se,0),je=Ju(le,Se,n,d.transform,Ee);let Ie,Ve;d.terrain&&d.terrain.prepareDrawTile();const yt=o.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;C.activeTexture.set(M.TEXTURE0),le.texture.bind(yt,M.CLAMP_TO_EDGE),C.activeTexture.set(M.TEXTURE1),Se?(Se.texture.bind(yt,M.CLAMP_TO_EDGE),Ie=Math.pow(2,Se.tileID.overscaledZ-le.tileID.overscaledZ),Ve=[le.tileID.canonical.x*Ie%1,le.tileID.canonical.y*Ie%1]):le.texture.bind(yt,M.CLAMP_TO_EDGE),le.texture.useMipmap&&C.extTextureFilterAnisotropic&&d.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);const ze=nu(ue,Ve||[0,0],Ie||1,je,o,j instanceof xr?j.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(C,F,te),j instanceof xr)j.boundsBuffer&&j.boundsSegments&&F.draw(C,M.TRIANGLES,W,i.StencilMode.disabled,z,i.CullFaceMode.disabled,ze,o.id,j.boundsBuffer,d.quadTriangleIndexBuffer,j.boundsSegments);else{const{tileBoundsBuffer:nt,tileBoundsIndexBuffer:We,tileBoundsSegments:mt}=d.getTileBoundsBuffers(le);F.draw(C,M.TRIANGLES,W,ke,z,i.CullFaceMode.disabled,ze,o.id,nt,We,mt)}}d.resetStencilClippingMasks()},background:function(d,n,o,f){const x=o.paint.get("background-color"),b=o.paint.get("background-opacity");if(b===0)return;const C=d.context,M=C.gl,j=d.transform,F=j.tileSize,z=o.paint.get("background-pattern");if(d.isPatternMissing(z))return;const G=!z&&x.a===1&&b===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==G)return;const Q=i.StencilMode.disabled,re=d.depthModeForSublayer(0,G==="opaque"?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly),ie=d.colorModeForRenderPass(),ne=d.useProgram(z?"backgroundPattern":"background");let se,W=f;W||(se=d.getBackgroundTiles(),W=Object.values(se).map((te=>te.tileID))),z&&(C.activeTexture.set(M.TEXTURE0),d.imageManager.bind(d.context));for(const te of W){const le=te.toUnwrapped(),ue=f?te.projMatrix:d.transform.calculateProjMatrix(le);d.prepareDrawTile();const ke=n?n.getTile(te):se?se[te.key]:new i.Tile(te,F,j.zoom,d),Ee=z?lh(ue,b,d,z,{tileID:te,tileSize:F}):iu(ue,b,x);d.prepareDrawProgram(C,ne,le);const{tileBoundsBuffer:Se,tileBoundsIndexBuffer:je,tileBoundsSegments:Ie}=d.getTileBoundsBuffers(ke);ne.draw(C,M.TRIANGLES,re,Q,ie,i.CullFaceMode.disabled,Ee,o.id,Se,je,Ie)}},sky:function(d,n,o){const f=d.transform,x=f.projection.name==="mercator"||f.projection.name==="globe"?1:i.smoothstep(7,8,f.zoom),b=o.paint.get("sky-opacity")*x;if(b===0)return;const C=d.context,M=o.paint.get("sky-type"),j=new i.DepthMode(C.gl.LEQUAL,i.DepthMode.ReadOnly,[0,1]),F=d.frameCounter/1e3%1;M==="atmosphere"?d.renderPass==="offscreen"?o.needsSkyboxCapture(d)&&((function(z,G,Q,re){const ie=z.context,ne=ie.gl;let se=G.skyboxFbo;if(!se){se=G.skyboxFbo=ie.createFramebuffer(32,32,!1),G.skyboxGeometry=new wa(ie),G.skyboxTexture=ie.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,G.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let ue=0;ue<6;++ue)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}ie.bindFramebuffer.set(se.framebuffer),ie.viewport.set([0,0,32,32]);const W=G.getCenter(z,!0),te=z.useProgram("skyboxCapture"),le=new Float64Array(16);i.identity(le),i.rotateY(le,le,.5*-Math.PI),Wi(ie,G,te,le,W,0),i.identity(le),i.rotateY(le,le,.5*Math.PI),Wi(ie,G,te,le,W,1),i.identity(le),i.rotateX(le,le,.5*-Math.PI),Wi(ie,G,te,le,W,2),i.identity(le),i.rotateX(le,le,.5*Math.PI),Wi(ie,G,te,le,W,3),i.identity(le),Wi(ie,G,te,le,W,4),i.identity(le),i.rotateY(le,le,Math.PI),Wi(ie,G,te,le,W,5),ie.viewport.set([0,0,z.width,z.height])})(d,o),o.markSkyboxValid(d)):d.renderPass==="sky"&&(function(z,G,Q,re,ie){const ne=z.context,se=ne.gl,W=z.transform,te=z.useProgram("skybox");ne.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,G.skyboxTexture);const le=((ue,ke,Ee,Se,je)=>({u_matrix:ue,u_sun_direction:ke,u_cubemap:0,u_opacity:Se,u_temporal_offset:je}))(W.skyboxMatrix,G.getCenter(z,!1),0,re,ie);z.prepareDrawProgram(ne,te),te.draw(ne,se.TRIANGLES,Q,i.StencilMode.disabled,z.colorModeForRenderPass(),i.CullFaceMode.backCW,le,"skybox",G.skyboxGeometry.vertexBuffer,G.skyboxGeometry.indexBuffer,G.skyboxGeometry.segment)})(d,o,j,b,F):M==="gradient"&&d.renderPass==="sky"&&(function(z,G,Q,re,ie){const ne=z.context,se=ne.gl,W=z.transform,te=z.useProgram("skyboxGradient");G.skyboxGeometry||(G.skyboxGeometry=new wa(ne)),ne.activeTexture.set(se.TEXTURE0);let le=G.colorRampTexture;le||(le=G.colorRampTexture=new i.Texture(ne,G.colorRamp,se.RGBA)),le.bind(se.LINEAR,se.CLAMP_TO_EDGE);const ue=((ke,Ee,Se,je,Ie)=>({u_matrix:ke,u_color_ramp:0,u_center_direction:Ee,u_radius:i.degToRad(Se),u_opacity:je,u_temporal_offset:Ie}))(W.skyboxMatrix,G.getCenter(z,!1),G.paint.get("sky-gradient-radius"),re,ie);z.prepareDrawProgram(ne,te),te.draw(ne,se.TRIANGLES,Q,i.StencilMode.disabled,z.colorModeForRenderPass(),i.CullFaceMode.backCW,ue,"skyboxGradient",G.skyboxGeometry.vertexBuffer,G.skyboxGeometry.indexBuffer,G.skyboxGeometry.segment)})(d,o,j,b,F)},debug:function(d,n,o){for(let f=0;f<o.length;f++)Cp(d,n,o[f])},custom:function(d,n,o,f){const x=d.context,b=o.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&o.isLayerDraped()){if(d.renderPass==="offscreen"){const C=b.prerender;if(C){if(d.setCustomLayerDefaults(),x.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const M=d.transform.pointMerc;C.call(b,x.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),i.globeToMercatorTransition(d.transform.zoom),[M.x,M.y],d.transform.pixelsPerMeterRatio)}else C.call(b,x.gl,d.transform.customLayerMatrix());x.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const M=b.renderToTile;if(M){const j=f[0].canonical,F=new i.MercatorCoordinate(j.x+f[0].wrap*(1<<j.z),j.y,j.z);x.setDepthMode(i.DepthMode.disabled),x.setStencilMode(i.StencilMode.disabled),x.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),M.call(b,x.gl,F),x.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),x.setColorMode(d.colorModeForRenderPass()),x.setStencilMode(i.StencilMode.disabled);const C=b.renderingMode==="3d"?new i.DepthMode(d.context.gl.LEQUAL,i.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,i.DepthMode.ReadOnly);if(x.setDepthMode(C),d.transform.projection.name==="globe"){const M=d.transform.pointMerc;b.render(x.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),i.globeToMercatorTransition(d.transform.zoom),[M.x,M.y],d.transform.pixelsPerMeterRatio)}else b.render(x.gl,d.transform.customLayerMatrix());x.setDirty(),d.setBaseState(),x.bindFramebuffer.set(null)}}else i.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Eo{constructor(n,o,f=!1){this.context=new kt(n,f),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=i.SourceCache.maxUnderzooming+i.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,o){const f=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Qu(this,n));const x=this._terrain;this.transform.elevation=f?x:null,x.update(n,this.transform,o)}_updateFog(n){const o=n.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,x]=o.getFovAdjustedRange(this.transform._fov);if(f>x)return void(this.transform.fogCullDistSq=null);const b=f+.78*(x-f);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,o){if(this.width=n*i.exported.devicePixelRatio,this.height=o*i.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._layers[f].resize()}setup(){const n=this.context,o=new i.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(i.EXTENT,0),o.emplaceBack(0,i.EXTENT),o.emplaceBack(i.EXTENT,i.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(o,i.posAttributes.members),this.tileExtentSegments=i.SegmentVector.simpleSegment(0,0,4,2);const f=new i.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(i.EXTENT,0),f.emplaceBack(0,i.EXTENT),f.emplaceBack(i.EXTENT,i.EXTENT),this.debugBuffer=n.createVertexBuffer(f,i.posAttributes.members),this.debugSegments=i.SegmentVector.simpleSegment(0,0,4,5);const x=new i.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(x,i.posAttributes.members),this.viewportSegments=i.SegmentVector.simpleSegment(0,0,4,2);const b=new i.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(i.EXTENT,0,i.EXTENT,0),b.emplaceBack(0,i.EXTENT,0,i.EXTENT),b.emplaceBack(i.EXTENT,i.EXTENT,i.EXTENT,i.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(b,i.boundsAttributes.members),this.mercatorBoundsSegments=i.SegmentVector.simpleSegment(0,0,4,2);const C=new i.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(C);const M=new i.StructArrayLayout1ui2;for(const F of[0,1,3,2,0])M.emplaceBack(F);this.debugIndexBuffer=n.createIndexBuffer(M),this.emptyTexture=new i.Texture(n,new i.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=i.create();const j=this.context.gl;this.stencilClearMode=new i.StencilMode({func:j.ALWAYS,mask:0},0,255,j.ZERO,j.ZERO,j.ZERO),this.loadTimeStamps.push(i.window.performance.now()),this.atmosphereBuffer=new uc(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,o=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,o.TRIANGLES,i.DepthMode.disabled,this.stencilClearMode,i.ColorMode.disabled,i.CullFaceMode.disabled,tc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,o,f){if(!o||this.currentStencilSource===o.id||!n.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const j of f)if(this._tileClippingMaskIDs[j.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=o.id;const x=this.context,b=x.gl;this.nextStencilID+f.length>256&&this.clearStencil(),x.setColorMode(i.ColorMode.disabled),x.setDepthMode(i.DepthMode.disabled);const C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of f){const j=o.getTile(M),F=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:G,tileBoundsSegments:Q}=this.getTileBoundsBuffers(j);C.draw(x,b.TRIANGLES,i.DepthMode.disabled,new i.StencilMode({func:b.ALWAYS,mask:0},F,255,b.KEEP,b.KEEP,b.REPLACE),i.ColorMode.disabled,i.CullFaceMode.disabled,tc(M.projMatrix),"$clipping",z,G,Q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,o=this.context.gl;return new i.StencilMode({func:o.NOTEQUAL,mask:255},n,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const o=this.context.gl;return new i.StencilMode({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(n){const o=this.context.gl,f=n.sort(((C,M)=>M.overscaledZ-C.overscaledZ)),x=f[f.length-1].overscaledZ,b=f[0].overscaledZ-x+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const C={};for(let M=0;M<b;M++)C[M+x]=new i.StencilMode({func:o.GEQUAL,mask:255},M+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=b,[C,f]}return[{[x]:i.StencilMode.disabled},f]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new i.ColorMode([n.CONSTANT_COLOR,n.ONE],new i.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?i.ColorMode.unblended:i.ColorMode.alphaBlended}depthModeForSublayer(n,o,f){if(!this.opaquePassEnabledForLayer())return i.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new i.DepthMode(f||this.context.gl.LEQUAL,o,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,o){this.style=n,this.options=o,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(i.exported.now()),this.imageManager.beginFrame();const f=this.style.order,x=this.style._sourceCaches;for(const F in x){const z=x[F];z.used&&z.prepare(this.context)}const b={},C={},M={};for(const F in x){const z=x[F];b[F]=z.getVisibleCoordinates(),C[F]=b[F].slice().reverse(),M[F]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<f.length;F++)if(this.style._layers[f[F]].is3D()){this.opaquePassCutoff=F;break}if(this.terrain&&(this.terrain.updateTileBinding(M),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.GlobeSharedBuffers(this.context)),!i.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const F of f){const z=this.style._layers[F],G=n._getLayerSourceCache(z);if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const Q=G?C[G.id]:void 0;(z.type==="custom"||z.isSky()||Q&&Q.length)&&this.renderLayer(this,G,z,Q)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon];const j=this.terrain;if(j&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&j.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:o.showOverdrawInspector?i.Color.black:i.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[f[this.currentLayer]],z=n._getLayerSourceCache(F);if(F.isSky())continue;const G=z?C[z.id]:void 0;this._renderTileClippingMasks(F,z,G),this.renderLayer(this,z,F,G)}if(this.style.fog&&this.transform.projection.supportsFog&&(function(F,z){const G=F.context,Q=G.gl,re=F.transform,ie=new i.DepthMode(Q.LEQUAL,i.DepthMode.ReadOnly,[0,1]),ne=F.useProgram("globeAtmosphere",null,re.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),se=i.globeToMercatorTransition(re.zoom),W=z.properties.get("color").toArray01(),te=z.properties.get("high-color").toArray01(),le=z.properties.get("space-color").toArray01PremultipliedAlpha(),ue=i.identity$1([]);i.rotateY$1(ue,ue,-i.degToRad(re._center.lng)),i.rotateX$1(ue,ue,i.degToRad(re._center.lat)),i.rotateZ$1(ue,ue,re.angle),i.rotateX$1(ue,ue,-re._pitch);const ke=i.fromQuat(new Float32Array(16),ue),Ee=i.mapValue(z.properties.get("star-intensity"),0,1,0,.25),Se=5e-4,je=i.mapValue(z.properties.get("horizon-blend"),0,1,Se,.25),Ie=i.globeUseCustomAntiAliasing(F,G,re)&&je===Se?re.worldSize/(2*Math.PI*1.025)-1:re.globeRadius,Ve=F.frameCounter/1e3%1,yt=i.length(re.globeCenterInViewSpace),ze=Math.sqrt(Math.pow(yt,2)-Math.pow(Ie,2)),nt=Math.acos(ze/yt),We=((Ue,it,ft,pt,vt,Wt,or,Vt,tr,Sr,Pr,Zt,Dr,Xr)=>({u_frustum_tl:Ue,u_frustum_tr:it,u_frustum_br:ft,u_frustum_bl:pt,u_horizon:vt,u_transition:Wt,u_fadeout_range:or,u_color:Vt,u_high_color:tr,u_space_color:Sr,u_star_intensity:Pr,u_star_size:5*i.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Zt,u_horizon_angle:Dr,u_rotation_matrix:Xr}))(re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.frustumCorners.horizon,se,je,W,te,le,Ee,Ve,nt,ke);F.prepareDrawProgram(G,ne);const mt=F.atmosphereBuffer;mt&&ne.draw(G,Q.TRIANGLES,ie,i.StencilMode.disabled,i.ColorMode.alphaBlended,i.CullFaceMode.backCW,We,"skybox",mt.vertexBuffer,mt.indexBuffer,mt.segments)})(this,this.style.fog),this.renderPass="sky",(i.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const F=this.style._layers[f[this.currentLayer]],z=n._getLayerSourceCache(F);F.isSky()&&this.renderLayer(this,z,F,z?C[z.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;){const F=this.style._layers[f[this.currentLayer]],z=n._getLayerSourceCache(F);if(F.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(F)){if(F.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const G=z?(F.type==="symbol"?M:C)[z.id]:void 0;this._renderTileClippingMasks(F,z,z?b[z.id]:void 0),this.renderLayer(this,z,F,G),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let F=null;i.values(this.style._layers).forEach((z=>{const G=n._getLayerSourceCache(z);G&&!z.isHidden(this.transform.zoom)&&(!F||F.getSource().maxzoom<G.getSource().maxzoom)&&(F=G)})),F&&this.options.showTileBoundaries&&Ha.debug(this,F,F.getVisibleCoordinates())}this.options.showPadding&&(function(F){const z=F.transform.padding;So(F,F.transform.height-(z.top||0),3,ko),So(F,z.bottom||0,3,hd),dl(F,z.left||0,3,dd),dl(F,F.transform.width-(z.right||0),3,ph);const G=F.transform.centerPoint;(function(Q,re,ie,ne){sa(Q,re-1,ie-10,2,20,ne),sa(Q,re-10,ie-1,20,2,ne)})(F,G.x,F.transform.height-G.y,Ep)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(i.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,o,f,x){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||x&&x.length)&&(this.id=f.id,this.gpuTimingStart(f),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(f.type)||n.terrain&&f.type==="custom")&&Ha[f.type](n,o,f,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;let f=this.gpuTimers[n.id];f||(f=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),f.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,f.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,o=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(o),n.beginQueryEXT(n.TIME_ELAPSED_EXT,o)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const o={};for(const f in n){const x=n[f],b=this.context.extTimerQuery,C=b.getQueryObjectEXT(x.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(x.query),o[f]=C}return o}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.extTimerQuery;let f=0;for(const x of n)f+=o.getQueryObjectEXT(x,o.QUERY_RESULT_EXT)/1e6,o.deleteQueryEXT(x);return f}translatePosMatrix(n,o,f,x,b){if(!f[0]&&!f[1])return n;const C=b?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(C){const F=Math.sin(C),z=Math.cos(C);f=[f[0]*z-f[1]*F,f[0]*F+f[1]*z]}const M=[b?f[0]:et(o,f[0],this.transform.zoom),b?f[1]:et(o,f[1],this.transform.zoom),0],j=new Float32Array(16);return i.translate(j,n,M),j}saveTileTexture(n){const o=this._tileTextures[n.size[0]];o?o.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const o=this._tileTextures[n];return o&&o.length>0?o.pop():null}isPatternMissing(n){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,o=this.terrain&&this.terrain.exaggeration()===0,f=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),this.transform.projection.name==="globe"&&x.push("GLOBE"),o&&x.push("ZERO_EXAGGERATION"),f&&!n&&f.getOpacity(this.transform.pitch)!==0&&x.push("FOG"),n&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(n,o,f){this.cache=this.cache||{};const x=f||[],b=this.currentGlobalDefines().concat(x),C=Fr.cacheKey(ec[n],n,b,o);return this.cache[C]||(this.cache[C]=new Fr(this.context,n,ec[n],o,oc[n],b)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=i.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,o,f){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const b=x.getOpacity(this.transform.pitch),C=((M,j,F,z,G,Q,re,ie,ne,se,W)=>{const te=M.transform,le=j.properties.get("color").toArray01();le[3]=z;const ue=M.frameCounter/1e3%1;return{u_fog_matrix:F?te.calculateFogTileMatrix(F):M.identityMat,u_fog_range:j.getFovAdjustedRange(te._fov),u_fog_color:le,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_temporal_offset:ue,u_frustum_tl:G,u_frustum_tr:Q,u_frustum_br:re,u_frustum_bl:ie,u_globe_pos:ne,u_globe_radius:se,u_viewport:W,u_globe_transition:i.globeToMercatorTransition(te.zoom),u_is_globe:+(te.projection.name==="globe")}})(this,x,f,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.exported.devicePixelRatio,this.transform.height*i.exported.devicePixelRatio]);o.setFogUniformValues(n,C)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,o=n.createTexture();return n.bindTexture(n.TEXTURE_2D,o),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,o=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const x of f)o[x.key]=n[x.key]||new i.Tile(x,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}}class hc{constructor(n=0,o=0,f=0,x=0){if(isNaN(n)||n<0||isNaN(o)||o<0||isNaN(f)||f<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=o,this.left=f,this.right=x}interpolate(n,o,f){return o.top!=null&&n.top!=null&&(this.top=i.number(n.top,o.top,f)),o.bottom!=null&&n.bottom!=null&&(this.bottom=i.number(n.bottom,o.bottom,f)),o.left!=null&&n.left!=null&&(this.left=i.number(n.left,o.left,f)),o.right!=null&&n.right!=null&&(this.right=i.number(n.right,o.right,f)),this}getCenter(n,o){const f=i.clamp((this.left+n-this.right)/2,0,n),x=i.clamp((this.top+o-this.bottom)/2,0,o);return new i.Point(f,x)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new hc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function dc(d,n){const o=i.getColumn(d,3);i.fromQuat(d,n),i.setColumn(d,3,o)}function Vr(d,n){const o=i.identity$1([]);return i.rotateZ$1(o,o,-n),i.rotateX$1(o,o,-d),o}function fl(d,n){const o=[d[0],d[1],0],f=[n[0],n[1],0];if(i.length(o)>=1e-15){const C=i.normalize([],o);i.scale$2(f,C,i.dot(f,C)),n[0]=f[0],n[1]=f[1]}const x=i.cross([],n,d);if(i.len(x)<1e-15)return null;const b=Math.atan2(-x[1],x[0]);return Vr(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),b)}class Ta{constructor(n,o){this.position=n,this.orientation=o}get position(){return this._position}set position(n){if(n){const o=n instanceof i.MercatorCoordinate?n:new i.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(o.x=i.wrap(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(n,o){if(this.orientation=null,!this.position)return;const f=this.position,x=this._elevation?this._elevation.getAtPointOrZero(i.MercatorCoordinate.fromLngLat(n)):0,b=i.MercatorCoordinate.fromLngLat(n,x),C=[b.x-f.x,b.y-f.y,b.z-f.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=fl(C,o)}setPitchBearing(n,o){this.orientation=Vr(i.degToRad(n),i.degToRad(-o))}}class ml{constructor(n,o){this._transform=i.identity([]),this.orientation=o,this.position=n}get mercatorPosition(){const n=this.position;return new i.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=i.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var o;n&&i.setColumn(this._transform,3,[(o=n)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||i.identity$1([]),n&&dc(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,o){this._orientation=Vr(n,o),dc(this._transform,this._orientation)}forward(){const n=i.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=i.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=i.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,o){const f=new Float64Array(16);return i.invert(f,this.getWorldToCamera(n,o)),f}getWorldToCameraPosition(n,o,f){const x=this.position;i.scale$2(x,x,-n);const b=new Float64Array(16);return i.fromScaling(b,[f,f,f]),i.translate(b,b,x),b[10]*=o,b}getWorldToCamera(n,o){const f=new Float64Array(16),x=new Float64Array(4),b=this.position;return i.conjugate(x,this._orientation),i.scale$2(b,b,-n),i.fromQuat(f,x),i.translate(f,f,b),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=o,f[9]*=o,f[10]*=o,f[11]*=o,f}getCameraToClipPerspective(n,o,f,x){const b=new Float64Array(16);return i.perspective(b,n,o,f,x),b}getDistanceToElevation(n,o=!1){const f=n===0?0:i.mercatorZfromAltitude(n,o?i.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(f-this.position[2])/x[2]}clone(){return new ml([...this.position],[...this.orientation])}}function Xa(d,n){const o=au(d.projection,d.zoom,d.width,d.height),f=(function(b,C,M,j,F){const z=new i.LngLat(M.lng-180*os,M.lat),G=new i.LngLat(M.lng+180*os,M.lat),Q=b.project(z.lng,z.lat),re=b.project(G.lng,G.lat),ie=-Math.atan2(re.y-Q.y,re.x-Q.x),ne=i.MercatorCoordinate.fromLngLat(M);ne.y=i.clamp(ne.y,-1+os,1-os);const se=ne.toLngLat(),W=b.project(se.lng,se.lat),te=i.MercatorCoordinate.fromLngLat(se);te.x+=os;const le=te.toLngLat(),ue=b.project(le.lng,le.lat),ke=pc(ue.x-W.x,ue.y-W.y,ie),Ee=i.MercatorCoordinate.fromLngLat(se);Ee.y+=os;const Se=Ee.toLngLat(),je=b.project(Se.lng,Se.lat),Ie=pc(je.x-W.x,je.y-W.y,ie),Ve=Math.abs(ke.x)/Math.abs(Ie.y),yt=i.identity([]);i.rotateZ(yt,yt,-ie*(1-(F?0:j)));const ze=i.identity([]);return i.scale(ze,ze,[1,1-(1-Ve)*j,1]),ze[4]=-Ie.x/Ie.y*j,i.rotateZ(ze,ze,ie),i.multiply(ze,yt,ze),ze})(d.projection,0,d.center,o,n),x=pd(d);return i.scale(f,f,[x,x,1]),f}function pd(d){const n=d.projection,o=au(d.projection,d.zoom,d.width,d.height),f=fd(n,d.center),x=fd(n,i.LngLat.convert(n.center));return Math.pow(2,f*o+(1-o)*x)}function au(d,n,o,f,x=1/0){const b=d.range;if(!b)return 0;const C=Math.min(x,Math.max(o,f)),M=Math.log(C/1024)/Math.LN2;return i.smoothstep(b[0]+M,b[1]+M,n)}const os=1/4e4;function fd(d,n){const o=i.clamp(n.lat,-i.MAX_MERCATOR_LATITUDE,i.MAX_MERCATOR_LATITUDE),f=new i.LngLat(n.lng-180*os,o),x=new i.LngLat(n.lng+180*os,o),b=d.project(f.lng,o),C=d.project(x.lng,o),M=i.MercatorCoordinate.fromLngLat(f),j=i.MercatorCoordinate.fromLngLat(x),F=C.x-b.x,z=C.y-b.y,G=j.x-M.x,Q=j.y-M.y,re=Math.sqrt((G*G+Q*Q)/(F*F+z*z));return Math.log(re)/Math.LN2}function pc(d,n,o){const f=Math.cos(o),x=Math.sin(o);return{x:d*f-n*x,y:d*x+n*f}}class Co{constructor(n,o,f,x,b,C,M){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=o||22,this._minPitch=f??0,this._maxPitch=x??60,this.setProjection(C),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new i.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new hc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ml,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new Co(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n,o=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(n||f)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return i.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=i.getProjection(this.projectionOptions);const f=!R(o,this.getProjection());return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.getProjection({name:"mercator"});const o=n!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.Point(this.width,this.height)}get bearing(){return i.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const o=-n*Math.PI/180;var f;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=(f=new i.ARRAY_TYPE(4),i.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f),(function(x,b,C){var M=b[0],j=b[1],F=b[2],z=b[3],G=Math.sin(C),Q=Math.cos(C);x[0]=M*Q+F*G,x[1]=j*Q+z*G,x[2]=M*-G+F*Q,x[3]=j*-G+z*Q})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const o=i.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=i.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const o=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let x=0,b=0;for(let C=0;C<o.length;C++){const M=new i.Point(o[C][0]*this.width,f+o[C][1]*(this.height-f)),j=n.pointCoordinate(M);if(!j)continue;const F=1/Math.hypot(j[0]-this._camera.position[0],j[1]-this._camera.position[1]);x+=j[3]*F,b+=F}return b===0?NaN:x/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*o,x=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),C=Math.max(x-f,b);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let f;f=n.z<this._camera.position[2]?[o.x,o.y,o.z]:[n.x,n.y,n.z];const x=i.length(i.sub([],this._camera.position,f));return i.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let o=!1;if(n.orientation&&!i.exactEquals(n.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(n.orientation)),n.position){const f=[n.position.x,n.position.y,n.position.z];i.exactEquals$1(f,this._camera.position)||(this._setCameraPosition(f),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,o=new Ta;return o.position=new i.MercatorCoordinate(n[0],n[1],n[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(n){if(!i.length$1(n))return!1;i.normalize$1(n,n);const o=i.transformQuat([],[0,0,-1],n),f=i.transformQuat([],[0,-1,0],n);if(f[2]<0)return!1;const x=fl(o,f);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(n){const o=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;n[2]=i.clamp(n[2],x/f,x/o),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,o,f){this._unmodified=!1,this._edgeInsets.interpolate(n,o,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const o=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(n){const o=[new i.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const f=this.pointCoordinate(new i.Point(0,0)),x=this.pointCoordinate(new i.Point(this.width,0)),b=this.pointCoordinate(new i.Point(this.width,this.height)),C=this.pointCoordinate(new i.Point(0,this.height)),M=Math.floor(Math.min(f.x,x.x,b.x,C.x)),j=Math.floor(Math.max(f.x,x.x,b.x,C.x)),F=1;for(let z=M-F;z<=j+F;z++)z!==0&&o.push(new i.UnwrappedTileID(z,n))}return o}coveringTiles(n){let o=this.coveringZoomLevel(n);const f=o,x=this.elevation&&!n.isTerrainDEM,b=this.projection.name==="mercator";if(n.minzoom!==void 0&&o<n.minzoom)return[];n.maxzoom!==void 0&&o>n.maxzoom&&(o=n.maxzoom);const C=this.locationCoordinate(this.center),M=this.center.lat,j=1<<o,F=[j*C.x,j*C.y,0],z=this.projection.name==="globe",G=!z,Q=i.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,G),re=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ie=j*i.mercatorZfromAltitude(1,this.center.lat),ne=this._camera.position[2]/i.mercatorZfromAltitude(1,this.center.lat),se=[j*re.x,j*re.y,ne*(G?1:ie)],W=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?o:0,le=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ue=n.isTerrainDEM?-le:this._elevation?this._elevation.getMinElevationBelowMSL():0,ke=this.projection.isReprojectedInTileSpace?pd(this):1,Ee=Ue=>{const ft=new i.MercatorCoordinate(Ue.x+25e-6,Ue.y,Ue.z),pt=new i.MercatorCoordinate(Ue.x,Ue.y+25e-6,Ue.z),vt=Ue.toLngLat(),Wt=ft.toLngLat(),or=pt.toLngLat(),Vt=this.locationCoordinate(vt),tr=this.locationCoordinate(Wt),Sr=this.locationCoordinate(or),Pr=Math.hypot(tr.x-Vt.x,tr.y-Vt.y),Zt=Math.hypot(Sr.x-Vt.x,Sr.y-Vt.y);return Math.sqrt(Pr*Zt)*ke/25e-6},Se=Ue=>{const it=le,ft=ue;return{aabb:i.tileAABB(this,j,0,0,0,Ue,ft,it,this.projection),zoom:0,x:0,y:0,minZ:ft,maxZ:it,wrap:Ue,fullyVisible:!1}},je=[];let Ie=[];const Ve=o,yt=n.reparseOverscaled?f:o,ze=Ue=>Ue*Ue,nt=ze((ne-this._centerAltitude)*ie),We=Ue=>{if(!this._elevation||!Ue.tileID||!b)return;const it=this._elevation.getMinMaxForTile(Ue.tileID),ft=Ue.aabb;it?(ft.min[2]=it.min,ft.max[2]=it.max,ft.center[2]=(ft.min[2]+ft.max[2])/2):(Ue.shouldSplit=mt(Ue),Ue.shouldSplit||(ft.min[2]=ft.max[2]=ft.center[2]=this._centerAltitude))},mt=Ue=>{if(Ue.zoom<te)return!0;if(Ue.zoom===Ve)return!1;if(Ue.shouldSplit!=null)return Ue.shouldSplit;const it=Ue.aabb.distanceX(se),ft=Ue.aabb.distanceY(se);let pt=nt,vt=1;if(z){pt=ze(Ue.aabb.distanceZ(se));const Vt=Math.pow(2,Ue.zoom),tr=i.latFromMercatorY((Ue.y+1)/Vt),Sr=i.latFromMercatorY(Ue.y/Vt),Pr=Math.min(Math.max(M,tr),Sr),Zt=i.circumferenceAtLatitude(Pr)/i.circumferenceAtLatitude(M);if(vt=Pr===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Zt/this._mercatorScaleRatio),this.zoom<=i.GLOBE_ZOOM_THRESHOLD_MIN&&Ue.zoom===Ve-1&&Zt>=.9)return!0}else if(x&&(pt=ze(Ue.aabb.distanceZ(se)*ie)),this.projection.isReprojectedInTileSpace&&f<=5){const Vt=Math.pow(2,Ue.zoom),tr=Ee(new i.MercatorCoordinate((Ue.x+.5)/Vt,(Ue.y+.5)/Vt));vt=tr>.85?1:tr}const Wt=it*it+ft*ft+pt,or=ze((1<<Ve-Ue.zoom)*W*vt*((Vt,tr)=>{if(tr*ze(.707)<Vt)return 1;const Sr=Math.sqrt(tr/Vt);return Sr/(1.4144271570014144+(Math.pow(1.1,Sr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(pt,nt),Wt));return Wt<or};if(this.renderWorldCopies)for(let Ue=1;Ue<=3;Ue++)je.push(Se(-Ue)),je.push(Se(Ue));for(je.push(Se(0));je.length>0;){const Ue=je.pop(),it=Ue.x,ft=Ue.y;let pt=Ue.fullyVisible;if(!pt){const vt=Ue.aabb.intersects(Q);if(vt===0)continue;pt=vt===2}if(Ue.zoom!==Ve&&mt(Ue))for(let vt=0;vt<4;vt++){const Wt=(it<<1)+vt%2,or=(ft<<1)+(vt>>1),Vt={aabb:b?Ue.aabb.quadrant(vt):i.tileAABB(this,j,Ue.zoom+1,Wt,or,Ue.wrap,Ue.minZ,Ue.maxZ,this.projection),zoom:Ue.zoom+1,x:Wt,y:or,wrap:Ue.wrap,fullyVisible:pt,tileID:void 0,shouldSplit:void 0,minZ:Ue.minZ,maxZ:Ue.maxZ};x&&!z&&(Vt.tileID=new i.OverscaledTileID(Ue.zoom+1===Ve?yt:Ue.zoom+1,Ue.wrap,Ue.zoom+1,Wt,or),We(Vt)),je.push(Vt)}else{const vt=Ue.zoom===Ve?yt:Ue.zoom;if(n.minzoom&&n.minzoom>vt)continue;const Wt=F[0]-(.5+it+(Ue.wrap<<Ue.zoom))*(1<<o-Ue.zoom),or=F[1]-.5-ft,Vt=Ue.tileID?Ue.tileID:new i.OverscaledTileID(vt,Ue.wrap,Ue.zoom,it,ft);Ie.push({tileID:Vt,distanceSq:Wt*Wt+or*or})}}if(this.fogCullDistSq){const Ue=this.fogCullDistSq,it=this.horizonLineFromTop();Ie=Ie.filter((ft=>{const pt=[0,0,0,1],vt=[i.EXTENT,i.EXTENT,0,1],Wt=this.calculateFogTileMatrix(ft.tileID.toUnwrapped());i.transformMat4$1(pt,pt,Wt),i.transformMat4$1(vt,vt,Wt);const or=i.getAABBPointSquareDist(pt,vt);if(or===0)return!0;let Vt=!1;const tr=this._elevation;if(tr&&or>Ue&&it!==0){const Sr=this.calculateProjMatrix(ft.tileID.toUnwrapped());let Pr;n.isTerrainDEM||(Pr=tr.getMinMaxForTile(ft.tileID)),Pr||(Pr={min:ue,max:le});const Zt=i.furthestTileCorner(this.rotation),Dr=[Zt[0]*i.EXTENT,Zt[1]*i.EXTENT,Pr.max];i.transformMat4(Dr,Dr,Sr),Vt=(1-Dr[1])*this.height*.5<it}return or<Ue||Vt}))}return Ie.sort(((Ue,it)=>Ue.distanceSq-it.distanceSq)).map((Ue=>Ue.tileID))}resize(n,o){this.width=n,this.height=o,this.pixelsToGLUnits=[2/n,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const o=i.clamp(n.lat,-i.MAX_MERCATOR_LATITUDE,i.MAX_MERCATOR_LATITUDE),f=this.projection.project(n.lng,o);return new i.Point(f.x*this.worldSize,f.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,o){let f,x;const b=this.centerPoint;if(this.projection.name==="globe"){const M=this.worldSize;f=(o.x-b.x)/M,x=(o.y-b.y)/M}else{const M=this.pointCoordinate(o),j=this.pointCoordinate(b);f=M.x-j.x,x=M.y-j.y}const C=this.locationCoordinate(n);this.setLocation(new i.MercatorCoordinate(C.x-f,C.y-x))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,o){const f=o?i.mercatorZfromAltitude(o,n.lat):void 0,x=this.projection.project(n.lng,n.lat);return new i.MercatorCoordinate(x.x,x.y,f)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,o){const f=o??this._centerAltitude,x=[n.x,n.y,0,1],b=[n.x,n.y,1,1];i.transformMat4$1(x,x,this.pixelMatrixInverse),i.transformMat4$1(b,b,this.pixelMatrixInverse);const C=b[3];i.scale$1(x,x,1/x[3]),i.scale$1(b,b,1/C);const M=x[2],j=b[2];return{p0:x,p1:b,t:M===j?0:(f-M)/(j-M)}}screenPointToMercatorRay(n){const o=[n.x,n.y,0,1],f=[n.x,n.y,1,1];return i.transformMat4$1(o,o,this.pixelMatrixInverse),i.transformMat4$1(f,f,this.pixelMatrixInverse),i.scale$1(o,o,1/o[3]),i.scale$1(f,f,1/f[3]),o[2]=i.mercatorZfromAltitude(o[2],this._center.lat)*this.worldSize,f[2]=i.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,i.scale$1(o,o,1/this.worldSize),i.scale$1(f,f,1/this.worldSize),new i.Ray([o[0],o[1],o[2]],i.normalize([],i.sub([],f,o)))}rayIntersectionCoordinate(n){const{p0:o,p1:f,t:x}=n,b=i.mercatorZfromAltitude(o[2],this._center.lat),C=i.mercatorZfromAltitude(f[2],this._center.lat);return new i.MercatorCoordinate(i.number(o[0],f[0],x)/this.worldSize,i.number(o[1],f[1],x)/this.worldSize,i.number(b,C,x))}pointCoordinate(n,o=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,o)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let o=this.projection.pointCoordinate3D(this,n.x,n.y);if(o)return new i.MercatorCoordinate(o[0],o[1],o[2]);let f=0,x=this.horizonLineFromTop();if(n.y>x)return this.pointCoordinate(n);const b=.02*x,C=n.clone();for(let M=0;M<10&&x-f>b;M++){C.y=i.number(f,x,.66);const j=this.projection.pointCoordinate3D(this,C.x,C.y);j?(x=C.y,o=j):f=C.y}return o?new i.MercatorCoordinate(o[0],o[1],o[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=i.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(n);const o=this.pointCoordinate(n);return o.y>=0&&o.y<=1}_coordinatePoint(n,o){const f=o&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,x=[n.x*this.worldSize,n.y*this.worldSize,f+n.toAltitude(),1];return i.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new i.Point(x[0]/x[3],x[1]/x[3]):new i.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:o}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,b=this.pointLocation3D(new i.Point(o,n)),C=this.pointLocation3D(new i.Point(x,n)),M=this.pointLocation3D(new i.Point(x,f)),j=this.pointLocation3D(new i.Point(o,f));let F=Math.min(b.lng,C.lng,M.lng,j.lng),z=Math.max(b.lng,C.lng,M.lng,j.lng),G=Math.min(b.lat,C.lat,M.lat,j.lat),Q=Math.max(b.lat,C.lat,M.lat,j.lat);const re=Math.pow(2,-this.zoom)/16*270,ie=this.projection.name==="globe"?1:4,ne=(se,W,te,le,ue)=>{const ke=(se+te)/2,Ee=(W+le)/2,Se=new i.Point(ke,Ee),{lng:je,lat:Ie}=this.pointLocation3D(Se),Ve=Math.max(0,F-je,G-Ie,je-z,Ie-Q);F=Math.min(F,je),z=Math.max(z,je),G=Math.min(G,Ie),Q=Math.max(Q,Ie),(ue<ie||Ve>re)&&(ne(se,W,ke,Ee,ue+1),ne(ke,Ee,te,le,ue+1))};if(ne(o,n,x,n,1),ne(x,n,x,f,1),ne(x,f,o,f,1),ne(o,f,o,n,1),this.projection.name==="globe"){const[se,W]=i.polesInViewport(this);se?(Q=90,z=180,F=-180):W&&(G=-90,z=180,F=-180)}return new i.LngLatBounds(new i.LngLat(F,G),new i.LngLat(z,Q))}_getBoundsRectangular(n,o){const{top:f,left:x}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,M=new i.Point(x,f),j=new i.Point(C,f),F=new i.Point(C,b),z=new i.Point(x,b);let G=this.pointCoordinate(M,n),Q=this.pointCoordinate(j,n);const re=this.pointCoordinate(F,o),ie=this.pointCoordinate(z,o),ne=(se,W)=>(W.y-se.y)/(W.x-se.x);return G.y>1&&Q.y>=0?G=new i.MercatorCoordinate((1-ie.y)/ne(ie,G)+ie.x,1):G.y<0&&Q.y<=1&&(G=new i.MercatorCoordinate(-ie.y/ne(ie,G)+ie.x,0)),Q.y>1&&G.y>=0?Q=new i.MercatorCoordinate((1-re.y)/ne(re,Q)+re.x,1):Q.y<0&&G.y<=1&&(Q=new i.MercatorCoordinate(-re.y/ne(re,Q)+re.x,0)),new i.LngLatBounds().extend(this.coordinateLocation(G)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(ie)).extend(this.coordinateLocation(re))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=n.visibleDemTiles.reduce(((f,x)=>{if(x.dem){const b=x.dem.tree;f.min=Math.min(f.min,b.minimums[0]),f.max=Math.max(f.max,b.maximums[0])}return f}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*n.exaggeration(),o.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,f=this.height/2-o*(1-this._horizonShift);return n?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-i.MAX_MERCATOR_LATITUDE,this.maxLat=i.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=i.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=i.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=i.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,o){return this.projection.createTileMatrix(this,o,n)}calculateDistanceTileData(n){const o=n.key,f=this._distanceTileDataCache;if(f[o])return f[o];const x=n.canonical,b=1/this.height,C=this.cameraWorldSize,M=C/this.zoomScale(x.z),j=(x.x+Math.pow(2,x.z)*n.wrap)*M,F=x.y*M,z=this.point;z.x*=C/this.worldSize,z.y*=C/this.worldSize;const G=this.angle,Q=Math.sin(-G),re=-Math.cos(-G);return f[o]={bearing:[Q,re],center:[(z.x-j)*b,(z.y-F)*b],scale:M/i.EXTENT*b},f[o]}calculateFogTileMatrix(n){const o=n.key,f=this._fogTileMatrixCache;if(f[o])return f[o];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return i.multiply(x,this.worldToFogMatrix,x),f[o]=new Float32Array(x),f[o]}calculateProjMatrix(n,o=!1){const f=n.key,x=o?this._alignedProjMatrixCache:this._projMatrixCache;if(x[f])return x[f];const b=this.calculatePosMatrix(n,this.worldSize);return i.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.alignedProjMatrix:this.projMatrix,b),x[f]=new Float32Array(b),x[f]}calculatePixelsToTileUnitsMatrix(n){const o=n.tileID.key,f=this._pixelsToTileUnitsCache;if(f[o])return f[o];const x=(function(b,C){const{scale:M}=b.tileTransform,j=M*i.EXTENT/(b.tileSize*Math.pow(2,C.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return F=new Float32Array(4),Q=(z=C.inverseAdjustmentMatrix)[1],re=z[2],ie=z[3],se=(G=[j,j])[1],F[0]=z[0]*(ne=G[0]),F[1]=Q*ne,F[2]=re*se,F[3]=ie*se,F;var F,z,G,Q,re,ie,ne,se})(n,this);return f[o]=x,f[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,o=i.fromScaling([],[n,n,n]);return i.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const o=i.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(o),x=this._camera.forward(),b=i.mercatorZfromAltitude(1,this._center.lat);f[2]/=b,x[2]/=b,i.normalize(x,x);const C=n.raycast(f,x,n.exaggeration());if(C){const M=i.scaleAndAdd([],f,x,C),j=new i.MercatorCoordinate(M[0],M[1],i.mercatorZfromAltitude(M[2],i.latFromMercatorY(M[1]))),F=(j.z+i.length([j.x-f[0],j.y-f[1],j.z-f[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(F),this._centerAltitude=j.toAltitude(),this._center=this.coordinateLocation(j),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const o=this._elevation,f=i.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(f),b=o.getAtPointOrZero(new i.MercatorCoordinate(...x)),C=this.pixelsPerMeter/this.worldSize*b,M=this._minimumHeightOverTerrain(),j=x[2]-C;if(j<=M)if(j<0||n){const F=this.locationCoordinate(this._center,this._centerAltitude),z=[x[0],x[1],F.z-x[2]],G=i.length(z);z[2]-=(M-j)/this._pixelsPerMercatorPixel;const Q=i.length(z);if(Q===0)return;i.scale$2(z,z,G/Q*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],F.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const Q=this.center;return Q.lat=i.clamp(Q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(Q.lng=i.clamp(Q.lng,this.minLng,this.maxLng)),this.center=Q,void(this._constraining=!1)}const o=this._unmodified,{x:f,y:x}=this.point;let b=0,C=f,M=x;const j=this.width/2,F=this.height/2,z=this.worldMinY*this.scale,G=this.worldMaxY*this.scale;if(x-F<z&&(M=z+F),x+F>G&&(M=G-F),G-z<this.height&&(b=Math.max(b,this.height/(G-z)),M=(G+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Q=this.worldMinX*this.scale,re=this.worldMaxX*this.scale,ie=this.worldSize/2-(Q+re)/2;C=(f+ie+this.worldSize)%this.worldSize-ie,C-j<Q&&(C=Q+j),C+j>re&&(C=re-j),re-Q<this.width&&(b=Math.max(b,this.width/(re-Q)),C=(re+Q)/2)}C===f&&M===x||(this.center=this.unproject(new i.Point(C,M))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,o=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.mercatorZfromAltitude(1,this.center.lat)/i.mercatorZfromAltitude(1,i.GLOBE_SCALE_MATCH_LATITUDE));const f=au(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,f),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?o:1,b=this._camera.getWorldToCamera(this.worldSize,x),C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);C[8]=2*-n.x/this.width,C[9]=2*n.y/this.height;let M=i.mul([],C,b);if(this.projection.isReprojectedInTileSpace){const Ee=this.locationCoordinate(this.center),Se=i.identity([]);i.translate(Se,Se,[Ee.x*this.worldSize,Ee.y*this.worldSize,0]),i.multiply(Se,Se,Xa(this)),i.translate(Se,Se,[-Ee.x*this.worldSize,-Ee.y*this.worldSize,0]),i.multiply(M,M,Se),this.inverseAdjustmentMatrix=(function(je){const Ie=Xa(je,!0);return ge([],[Ie[0],Ie[1],Ie[4],Ie[5]])})(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=i.scale([],M,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=M,this.invProjMatrix=i.invert(new Float64Array(16),this.projMatrix);const j=i.invert([],C);this.frustumCorners=i.FrustumCorners.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height);const F=new Float32Array(16);i.identity(F),i.scale(F,F,[1,-1,1]),i.rotateX(F,F,this._pitch),i.rotateZ(F,F,this.angle);const z=i.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),G=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-n.x/this.width,z[9]=2*(n.y+G)/this.height,this.skyboxMatrix=i.multiply(F,z,F);const Q=this.point,re=Q.x,ie=Q.y,ne=this.width%2/2,se=this.height%2/2,W=Math.cos(this.angle),te=Math.sin(this.angle),le=re-Math.round(re)+W*ne+te*se,ue=ie-Math.round(ie)+W*se+te*ne,ke=new Float64Array(M);if(i.translate(ke,ke,[le>.5?le-1:le,ue>.5?ue-1:ue,0]),this.alignedProjMatrix=ke,M=i.create(),i.scale(M,M,[this.width/2,-this.height/2,1]),i.translate(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=i.create(),i.scale(M,M,[1,-1,1]),i.translate(M,M,[-1,-1,0]),i.scale(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=i.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},M=i.invert(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=M,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.calculateGlobeMatrix(this);const Ee=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.transformMat4(Ee,Ee,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=M;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,f=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,b=[n,n,o];i.scale$2(b,b,x),i.scale$2(f,f,-1),i.multiply$2(f,f,b);const C=i.create();i.translate(C,C,f),i.scale(C,C,b),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,o,x)}_computeCameraPosition(n){const o=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),x=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-n/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-f[0]*b,x.y/this.worldSize-f[1]*b,n/this.worldSize*this._centerAltitude-f[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],x=n[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(b=Math.min((o-f)/x,1)),this._camera.position=i.scaleAndAdd([],this._camera.position,n,b),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,o=this._camera.forward(),{pitch:f,bearing:x}=this._camera.getPitchBearing(),b=i.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.degToRad(this._maxPitch)),M=Math.max((n[2]-b)/Math.cos(f),C),j=this._zoomFromMercatorZ(M);i.scaleAndAdd(n,n,o,M),this._pitch=i.clamp(f,i.degToRad(this.minPitch),i.degToRad(this.maxPitch)),this.angle=i.wrap(x,-Math.PI,Math.PI),this._setZoom(i.clamp(j,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let o=0,f=i.GLOBE_ZOOM_THRESHOLD_MAX,x=0,b=1/0;for(;f-o>1e-6&&f>o;){const C=o+.5*(f-o),M=this.tileSize*Math.pow(2,C),j=this.getCameraToCenterDistance(this.projection,C,M),F=this.scaleZoom(j/(n*this.tileSize)),z=Math.abs(C-F);z<b&&(b=z,x=C),C<F?o=C:f=C}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,o){const f=Math.min(n.x,o.x),x=Math.max(n.x,o.x),b=Math.min(n.y,o.y),C=Math.max(n.y,o.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const M=[new i.Point(f,b),new i.Point(x,C),new i.Point(f,C),new i.Point(x,b)],j=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const z of M){const G=this.pointRayIntersection(z);if(G.t<0)return!0;const Q=this.rayIntersectionCoordinate(G);if(Q.x<j||Q.y<0||Q.x>F||Q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.Point(0,0),new i.Point(this.width,this.height))}zoomDeltaToMovement(n,o){const f=i.length(i.sub([],this._camera.position,n)),x=this._zoomFromMercatorZ(f)+o;return f-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const n=(function([o,f,x],b){const C=[o,f,x,1];i.transformMat4$1(C,C,b);const M=C[3]=Math.max(C[3],1e-6);return C[0]/=M,C[1]/=M,C[2]/=M,C})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.Point(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.Point(0,n))}}getCameraToCenterDistance(n,o=this.zoom,f=this.worldSize){const x=au(n,o,this.width,this.height,1024),b=n.pixelSpaceConversion(this.center.lat,f,x);return .5/Math.tan(.5*this._fov)*this.height*b}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.multiply(n,n,this.globeMatrix),n}}function an(d,n){let o=!1,f=null;const x=()=>{f=null,o&&(d(),f=setTimeout(x,n),o=!1)};return()=>(o=!0,f||x(),f)}class fc{constructor(n){this._hashName=n&&encodeURIComponent(n),i.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=an(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,i.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),i.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const o=Ka(n);if(this._hashName){const f=this._hashName;let x=!1;const b=i.window.location.hash.slice(1).split("&").map((C=>{const M=C.split("=")[0];return M===f?(x=!0,`${M}=${o}`):C})).filter((C=>C));return x||b.push(`${f}=${o}`),`#${b.join("&")}`}return`#${o}`}_getCurrentHash(){const n=i.window.location.hash.replace("#","");if(this._hashName){let o;return n.split("&").map((f=>f.split("="))).forEach((f=>{f[0]===this._hashName&&(o=f)})),(o&&o[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some((f=>isNaN(f)))){const f=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(o[3]||0):n.getBearing();return n.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:f,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=i.window.location.href.replace(/(#.+)?$/,this.getHashString());i.window.history.replaceState(i.window.history.state,null,n)}}function Ka(d,n){const o=d.getCenter(),f=Math.round(100*d.getZoom())/100,x=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,x),C=Math.round(o.lng*b)/b,M=Math.round(o.lat*b)/b,j=d.getBearing(),F=d.getPitch();let z=n?`/${C}/${M}/${f}`:`${f}/${M}/${C}`;return(j||F)&&(z+="/"+Math.round(10*j)/10),F&&(z+=`/${Math.round(F)}`),z}const ka={linearity:.3,easing:i.bezier(0,0,.3,1)},mc=i.extend({deceleration:2500,maxSpeed:1400},ka),gl=i.extend({deceleration:20,maxSpeed:1400},ka),Dt=i.extend({deceleration:1e3,maxSpeed:360},ka),qi=i.extend({deceleration:1e3,maxSpeed:90},ka);class Mo{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,o=i.exported.now();for(;n.length>0&&o-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new i.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)o.zoom+=b.zoomDelta||0,o.bearing+=b.bearingDelta||0,o.pitch+=b.pitchDelta||0,b.panDelta&&o.pan._add(b.panDelta),b.around&&(o.around=b.around),b.pinchAround&&(o.pinchAround=b.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(o.pan.mag()){const b=gc(o.pan.mag(),f,i.extend({},mc,n||{}));x.offset=o.pan.mult(b.amount/o.pan.mag()),x.center=this._map.transform.center,yl(x,b)}if(o.zoom){const b=gc(o.zoom,f,gl);x.zoom=this._map.transform.zoom+b.amount,yl(x,b)}if(o.bearing){const b=gc(o.bearing,f,Dt);x.bearing=this._map.transform.bearing+i.clamp(b.amount,-179,179),yl(x,b)}if(o.pitch){const b=gc(o.pitch,f,qi);x.pitch=this._map.transform.pitch+b.amount,yl(x,b)}if(x.zoom||x.bearing){const b=o.pinchAround===void 0?o.around:o.pinchAround;x.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function yl(d,n){(!d.duration||d.duration<n.duration)&&(d.duration=n.duration,d.easing=n.easing)}function gc(d,n,o){const{maxSpeed:f,linearity:x,deceleration:b}=o,C=i.clamp(d*x/(n/1e3),-f,f),M=Math.abs(C)/(b*x);return{easing:o.easing,duration:1e3*M,amount:C*(M/2)}}class fi extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,f,x={}){const b=ce(o.getCanvasContainer(),f),C=o.unproject(b);super(n,i.extend({point:b,lngLat:C,originalEvent:f},x)),this._defaultPrevented=!1,this.target=o}}class xl extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,f){const x=n==="touchend"?f.changedTouches:f.touches,b=$e(o.getCanvasContainer(),x),C=b.map((j=>o.unproject(j))),M=b.reduce(((j,F,z,G)=>j.add(F.div(G.length))),new i.Point(0,0));super(n,{points:b,point:M,lngLats:C,lngLat:o.unproject(M),originalEvent:f}),this._defaultPrevented=!1}}class Ao extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,f){super(n,{originalEvent:f}),this._defaultPrevented=!1}}class _l{constructor(n,o){this._map=n,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Ao(n.type,this._map,n))}mousedown(n,o){return this._mousedownPos=o,this._firePreventable(new fi(n.type,this._map,n))}mouseup(n){this._map.fire(new fi(n.type,this._map,n))}preclick(n){const o=i.extend({},n);o.type="preclick",this._map.fire(new fi(o.type,this._map,o))}click(n,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(n),this._map.fire(new fi(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new fi(n.type,this._map,n))}mouseover(n){this._map.fire(new fi(n.type,this._map,n))}mouseout(n){this._map.fire(new fi(n.type,this._map,n))}touchstart(n){return this._firePreventable(new xl(n.type,this._map,n))}touchmove(n){this._map.fire(new xl(n.type,this._map,n))}touchend(n){this._map.fire(new xl(n.type,this._map,n))}touchcancel(n){this._map.fire(new xl(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vl{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new fi(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new fi(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ou{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,o){this.isEnabled()&&n.shiftKey&&n.button===0&&(De(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(n,o){if(!this._active)return;const f=o,x=this._startPos,b=this._lastPos;if(!x||!b||b.equals(f)||!this._box&&f.dist(x)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=he("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const C=Math.min(x.x,f.x),M=Math.max(x.x,f.x),j=Math.min(x.y,f.y),F=Math.max(x.y,f.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${C}px,${j}px)`,this._box.style.width=M-C+"px",this._box.style.height=F-j+"px")}))}mouseupWindow(n,o){if(!this._active)return;const f=this._startPos,x=o;if(f&&n.button===0){if(this.reset(),St(),f.x!==x.x||f.y!==x.y)return this._map.fire(new i.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(f,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Qe(),delete this._startPos,delete this._lastPos}_fireEvent(n,o){return this._map.fire(new i.Event(n,{originalEvent:o}))}}function bl(d,n){const o={};for(let f=0;f<d.length;f++)o[d[f].identifier]=n[f];return o}class Ya{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,o,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),f.length===this.numTouches&&(this.centroid=(function(x){const b=new i.Point(0,0);for(const C of x)b._add(C);return b.div(x.length)})(o),this.touches=bl(f,o)))}touchmove(n,o,f){if(this.aborted||!this.centroid)return;const x=bl(f,o);for(const b in this.touches){const C=x[b];(!C||C.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,o,f){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class mh{constructor(n){this.singleTap=new Ya(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,o,f){this.singleTap.touchstart(n,o,f)}touchmove(n,o,f){this.singleTap.touchmove(n,o,f)}touchend(n,o,f){const x=this.singleTap.touchend(n,o,f);if(x){const b=n.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(x)<30;if(b&&C||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class md{constructor(){this._zoomIn=new mh({numTouches:1,numTaps:2}),this._zoomOut=new mh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,o,f){this._zoomIn.touchstart(n,o,f),this._zoomOut.touchstart(n,o,f)}touchmove(n,o,f){this._zoomIn.touchmove(n,o,f),this._zoomOut.touchmove(n,o,f)}touchend(n,o,f){const x=this._zoomIn.touchend(n,o,f),b=this._zoomOut.touchend(n,o,f);return x?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(x)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const gd={0:1,2:2};class wl{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,o){return!1}_move(n,o){return{}}mousedown(n,o){if(this._lastPoint)return;const f=Ge(n);this._correctButton(n,f)&&(this._lastPoint=o,this._eventButton=f)}mousemoveWindow(n,o){const f=this._lastPoint;if(f){if(n.preventDefault(),this._eventButton!=null&&(function(x,b){const C=gd[b];return x.buttons===void 0||(x.buttons&C)!==C})(n,this._eventButton))this.reset();else if(this._moved||!(o.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(f,o)}}mouseupWindow(n){this._lastPoint&&Ge(n)===this._eventButton&&(this._moved&&St(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yc extends wl{mousedown(n,o){super.mousedown(n,o),this._lastPoint&&(this._active=!0)}_correctButton(n,o){return o===0&&!n.ctrlKey}_move(n,o){return{around:o,panDelta:o.sub(n)}}}class aa extends wl{_correctButton(n,o){return o===0&&n.ctrlKey||o===2}_move(n,o){const f=.8*(o.x-n.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(n){n.preventDefault()}}class lu extends wl{_correctButton(n,o){return o===0&&n.ctrlKey||o===2}_move(n,o){const f=-.5*(o.y-n.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(n){n.preventDefault()}}class Sa{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),i.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.Point(0,0)}touchstart(n,o,f){return this._calculateTransform(n,o,f)}touchmove(n,o,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!i.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,o,f)}}touchend(n,o,f){this._calculateTransform(n,o,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,o,f){f.length>0&&(this._active=!0);const x=bl(f,o),b=new i.Point(0,0),C=new i.Point(0,0);let M=0;for(const F in x){const z=x[F],G=this._touches[F];G&&(b._add(z),C._add(z.sub(G)),M++,x[F]=z)}if(this._touches=x,M<this._minTouches||!C.mag())return;const j=C.div(M);return this._sum._add(j),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:j}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=he("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")}),500)}}class Zi{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,o,f){return{}}touchstart(n,o,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([o[0],o[1]]))}touchmove(n,o,f){const x=this._firstTwoTouches;if(!x)return;n.preventDefault();const[b,C]=x,M=Ea(f,o,b),j=Ea(f,o,C);if(!M||!j)return;const F=this._aroundCenter?null:M.add(j).div(2);return this._move([M,j],F,n)}touchend(n,o,f){if(!this._firstTwoTouches)return;const[x,b]=this._firstTwoTouches,C=Ea(f,o,x),M=Ea(f,o,b);C&&M||(this._active&&St(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ea(d,n,o){for(let f=0;f<d.length;f++)if(d[f].identifier===o)return n[f]}function Os(d,n){return Math.log(d/n)/Math.LN2}class cu extends Zi{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,o){const f=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Os(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Os(this._distance,f),pinchAround:o}}}function gh(d,n){return 180*d.angleWith(n)/Math.PI}class yd extends Zi{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,o){const f=this._vector;if(this._vector=n[0].sub(n[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:gh(this._vector,f),pinchAround:o}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const o=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const x=gh(n,f);return Math.abs(x)<o}}function Hi(d){return Math.abs(d.y)>Math.abs(d.x)}class Tl extends Zi{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Hi(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,o,f){const x=this._lastPoints;if(!x)return;const b=n[0].sub(x[0]),C=n[1].sub(x[1]);return this._map._cooperativeGestures&&!i.isFullscreen()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(b,C,f.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+C.y)/2*-.5})}gestureBeginsVertically(n,o,f){if(this._valid!==void 0)return this._valid;const x=n.mag()>=2,b=o.mag()>=2;if(!x&&!b)return;if(!x||!b)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const C=n.y>0==o.y>0;return Hi(n)&&Hi(o)&&C}}const Po={panStep:100,bearingStep:15,pitchStep:10};class uu{constructor(){const n=Po;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let o=0,f=0,x=0,b=0,C=0;switch(n.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:n.shiftKey?f=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?f=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?x=1:(n.preventDefault(),C=-1);break;case 40:n.shiftKey?x=-1:(n.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(f=0,x=0),{cameraAnimation:M=>{const j=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:hu,zoom:o?Math.round(j)+o*(n.shiftKey?2:1):j,bearing:M.getBearing()+f*this._bearingStep,pitch:M.getPitch()+x*this._pitchStep,offset:[-b*this._panStep,-C*this._panStep],center:M.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function hu(d){return d*(2-d)}const Ja=4.000244140625;class Ca{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,i.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||i.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=n.deltaMode===i.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const f=i.exported.now(),x=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,o!==0&&o%Ja==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(x*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),n.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=n,this._delta-=o,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=ce(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const j=this._type==="wheel"&&Math.abs(this._delta)>Ja?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*j)));this._delta<0&&F!==0&&(F=1/F);const z=o(),G=Math.pow(2,z),Q=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):G;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(Q*F))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:o(),x=this._startZoom,b=this._easing;let C,M=!1;if(this._type==="wheel"&&x&&b){const j=Math.min((i.exported.now()-this._lastWheelEventTime)/200,1),F=b(j);C=i.number(x,f,F),j<1?this._frameId||(this._frameId=!0):M=!0}else C=f,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:C-o(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let o=i.ease;if(this._prevEase){const f=this._prevEase,x=(i.exported.now()-f.start)/f.duration,b=f.easing(x+.01)-f.easing(x),C=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-C*C);o=i.bezier(C,M,.25,1)}return this._prevEase={start:i.exported.now(),duration:n,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=he("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(i.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")}),200)}}class vn{constructor(n,o){this._clickZoom=n,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Rr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,o){return n.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(n.shiftKey?-1:1),around:f.unproject(o)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qa{constructor(){this._tap=new mh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,o,f){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=o[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(n,o,f))}touchmove(n,o,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const x=o[0],b=x.y-this._swipePoint.y;return this._swipePoint=x,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,o,f)}touchend(n,o,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(n,o,f)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bi{constructor(n,o,f){this._el=n,this._mousePan=o,this._touchPan=f}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Xi{constructor(n,o,f){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=o,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Io{constructor(n,o,f,x){this._el=n,this._touchZoom=o,this._touchRotate=f,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const wi=d=>d.zoom||d.drag||d.pitch||d.rotate;class Li extends i.Event{}class du{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,o){const f=i.sub([],o,n);this.radius=i.length(f[2]<0?i.div([],f,this.constants):[f[0],f[1],0])}projectRay(n){i.div(n,n,this.constants),i.normalize(n,n),i.mul$1(n,n,this.constants);const o=i.scale$2([],n,this.radius);if(o[2]>0){const f=i.scale$2([],[0,0,1],i.dot(o,[0,0,1])),x=i.scale$2([],i.normalize([],[o[0],o[1],0]),this.radius),b=i.add([],o,i.scale$2([],i.sub([],i.add([],x,f),o),2));o[0]=b[0],o[1]=b[1]}return o}}function Es(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Us{constructor(n,o){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mo(n),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new du,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),i.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[i.window.document,"mousemove",{capture:!0}],[i.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[i.window,"blur",void 0]];for(const[x,b,C]of this._listeners)x.addEventListener(b,x===i.window.document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[n,o,f]of this._listeners)n.removeEventListener(o,n===i.window.document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(n){const o=this._map,f=o.getCanvasContainer();this._add("mapEvent",new _l(o,n));const x=o.boxZoom=new ou(o,n);this._add("boxZoom",x);const b=new md,C=new Rr;o.doubleClickZoom=new vn(C,b),this._add("tapZoom",b),this._add("clickZoom",C);const M=new Qa;this._add("tapDragZoom",M);const j=o.touchPitch=new Tl(o);this._add("touchPitch",j);const F=new aa(n),z=new lu(n);o.dragRotate=new Xi(n,F,z),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const G=new yc(n),Q=new Sa(o,n);o.dragPan=new bi(f,G,Q),this._add("mousePan",G),this._add("touchPan",Q,["touchZoom","touchRotate"]);const re=new yd,ie=new cu;o.touchZoomRotate=new Io(f,ie,re,M),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new vl(o));const ne=o.scrollZoom=new Ca(o,this);this._add("scrollZoom",ne,["mousePan"]);const se=o.keyboard=new uu;this._add("keyboard",se);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[W]&&o[W].enable(n[W])}_add(n,o,f){this._handlers.push({handlerName:n,handler:o,allowed:f}),this._handlersById[n]=o}stop(n){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wi(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,o,f){for(const x in n)if(x!==f&&(!o||o.indexOf(x)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const o=[];for(const f of n)this._el.contains(f.target)&&o.push(f);return o}handleEvent(n,o){this._updatingCamera=!0;const f=n.type==="renderFrame",x=f?void 0:n,b={needsRenderFrame:!1},C={},M={},j=n.touches?this._getMapTouches(n.touches):void 0,F=j?$e(this._el,j):f?void 0:ce(this._el,n);for(const{handlerName:Q,handler:re,allowed:ie}of this._handlers){if(!re.isEnabled())continue;let ne;this._blockedByActive(M,ie,Q)?re.reset():re[o||n.type]&&(ne=re[o||n.type](n,F,j),this.mergeHandlerResult(b,C,ne,Q,x),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||re.isActive())&&(M[Q]=re)}const z={};for(const Q in this._previousActiveHandlers)M[Q]||(z[Q]=x);this._previousActiveHandlers=M,(Object.keys(z).length||Es(b))&&(this._changes.push([b,C,z]),this._triggerRenderFrame()),(Object.keys(M).length||Es(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=b;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))}mergeHandlerResult(n,o,f,x,b){if(!f)return;i.extend(n,f);const C={handlerName:x,originalEvent:f.originalEvent||b};f.zoomDelta!==void 0&&(o.zoom=C),f.panDelta!==void 0&&(o.drag=C),f.pitchDelta!==void 0&&(o.pitch=C),f.bearingDelta!==void 0&&(o.rotate=C)}_applyChanges(){const n={},o={},f={};for(const[x,b,C]of this._changes)x.panDelta&&(n.panDelta=(n.panDelta||new i.Point(0,0))._add(x.panDelta)),x.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(n.around=x.around),x.aroundCoord!==void 0&&(n.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(n.pinchAround=x.pinchAround),x.noInertia&&(n.noInertia=x.noInertia),i.extend(o,b),i.extend(f,C);this._updateMapTransform(n,o,f),this._changes=[]}_updateMapTransform(n,o,f){const x=this._map,b=x.transform,C=te=>[te.x,te.y,te.z];if((te=>{const le=this._eventsInProgress.drag;return le&&!this._handlersById[le.handlerName].isActive()})()&&!Es(n)){const te=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",te!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&x._stop(!0),!Es(n))return void this._fireEvents(o,f,!0);let{panDelta:M,zoomDelta:j,bearingDelta:F,pitchDelta:z,around:G,aroundCoord:Q,pinchAround:re}=n;b._isCameraConstrained&&(j>0&&(j=0),b._isCameraConstrained=!1),re!==void 0&&(G=re),(j||(te=>o[te]&&!this._eventsInProgress[te])("drag"))&&G&&(this._dragOrigin=C(b.pointCoordinate3D(G)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",x._stop(!0),G=G||x.transform.centerPoint,F&&(b.bearing+=F),z&&(b.pitch+=z),b._updateCameraState();const ie=[0,0,0];if(M)if(b.projection.name==="mercator"){const te=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(G).dir),le=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(G.sub(M)).dir);ie[0]=le[0]-te[0],ie[1]=le[1]-te[1]}else{const te=b.pointCoordinate(G);if(b.projection.name==="globe"){M=M.rotate(-b.angle);const le=b._pixelsPerMercatorPixel/b.worldSize;ie[0]=-M.x*i.mercatorScale(i.latFromMercatorY(te.y))*le,ie[1]=-M.y*i.mercatorScale(b.center.lat)*le}else{const le=b.pointCoordinate(G.sub(M));te&&le&&(ie[0]=le.x-te.x,ie[1]=le.y-te.y)}}const ne=b.zoom,se=[0,0,0];if(j){const te=C(Q||b.pointCoordinate3D(G)),le={dir:i.normalize([],i.sub([],te,b._camera.position))};if(le.dir[2]<0){const ue=b.zoomDeltaToMovement(te,j);i.scale$2(se,le.dir,ue)}}const W=i.add(ie,ie,se);b._translateCameraConstrained(W),j&&Math.abs(b.zoom-ne)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(o,f,!0)}_fireEvents(n,o,f){const x=wi(this._eventsInProgress),b=wi(n),C={};for(const z in n){const{originalEvent:G}=n[z];this._eventsInProgress[z]||(C[`${z}start`]=G),this._eventsInProgress[z]=n[z]}!x&&b&&this._fireEvent("movestart",b.originalEvent);for(const z in C)this._fireEvent(z,C[z]);b&&this._fireEvent("move",b.originalEvent);for(const z in n){const{originalEvent:G}=n[z];this._fireEvent(z,G)}const M={};let j;for(const z in this._eventsInProgress){const{handlerName:G,originalEvent:Q}=this._eventsInProgress[z];this._handlersById[G].isActive()||(delete this._eventsInProgress[z],j=o[G]||Q,M[`${z}end`]=j)}for(const z in M)this._fireEvent(z,M[z]);const F=wi(this._eventsInProgress);if(f&&(x||b)&&!F){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=Q=>Q!==0&&-this._bearingSnap<Q&&Q<this._bearingSnap;z?(G(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:j})):(this._map.fire(new i.Event("moveend",{originalEvent:j})),G(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,o){this._map.fire(new i.Event(n,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((n=>{this._frameId=void 0,this.handleEvent(new Li("renderFrame",{timeStamp:n})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const oa="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class xc extends i.Evented{constructor(n,o){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,i.bindAll(["_renderFrameCallback"],this)}getCenter(){return new i.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,o){return this.jumpTo({center:n},o)}panBy(n,o,f){return n=i.Point.convert(n).mult(-1),this.panTo(this.transform.center,i.extend({offset:n},o),f)}panTo(n,o,f){return this.easeTo(i.extend({center:n},o),f)}getZoom(){return this.transform.zoom}setZoom(n,o){return this.jumpTo({zoom:n},o),this}zoomTo(n,o,f){return this.easeTo(i.extend({zoom:n},o),f)}zoomIn(n,o){return this.zoomTo(this.getZoom()+1,n,o),this}zoomOut(n,o){return this.zoomTo(this.getZoom()-1,n,o),this}getBearing(){return this.transform.bearing}setBearing(n,o){return this.jumpTo({bearing:n},o),this}getPadding(){return this.transform.padding}setPadding(n,o){return this.jumpTo({padding:n},o),this}rotateTo(n,o,f){return this.easeTo(i.extend({bearing:n},o),f)}resetNorth(n,o){return this.rotateTo(0,i.extend({duration:1e3},n),o),this}resetNorthPitch(n,o){return this.easeTo(i.extend({bearing:0,pitch:0,duration:1e3},n),o),this}snapToNorth(n,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,o):this}getPitch(){return this.transform.pitch}setPitch(n,o){return this.jumpTo({pitch:n},o),this}cameraForBounds(n,o){n=i.LngLatBounds.convert(n);const f=o&&o.bearing||0,x=o&&o.pitch||0,b=n.getNorthWest(),C=n.getSouthEast();return this._cameraForBounds(this.transform,b,C,f,x,o)}_extendCameraOptions(n){const o={top:0,bottom:0,right:0,left:0};if(typeof(n=i.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const f=n.padding;n.padding={top:f,bottom:f,right:f,left:f}}return n.padding=i.extend(o,n.padding),n}_minimumAABBFrustumDistance(n,o){const f=o.max[0]-o.min[0],x=o.max[1]-o.min[1];return f/x>n.aspect?f/(2*Math.tan(.5*n.fovX)*n.aspect):x/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,o,f,x,b,C){const M=n.clone(),j=this._extendCameraOptions(C);M.bearing=x,M.pitch=b;const F=i.LngLat.convert(o),z=i.LngLat.convert(f),G=.5*(F.lat+z.lat),Q=.5*(F.lng+z.lng),re=i.latLngToECEF(G,Q),ie=i.normalize([],re),ne=i.normalize([],i.cross([],ie,[0,1,0])),se=i.cross([],ne,ie),W=[ne[0],ne[1],ne[2],0,se[0],se[1],se[2],0,ie[0],ie[1],ie[2],0,0,0,0,1],te=[re,i.latLngToECEF(F.lat,F.lng),i.latLngToECEF(z.lat,F.lng),i.latLngToECEF(z.lat,z.lng),i.latLngToECEF(F.lat,z.lng),i.latLngToECEF(G,F.lng),i.latLngToECEF(G,z.lng),i.latLngToECEF(F.lat,Q),i.latLngToECEF(z.lat,Q)];let le=i.Aabb.fromPoints(te.map((pt=>[i.dot(ne,pt),i.dot(se,pt),i.dot(ie,pt)])));const ue=i.transformMat4([],le.center,W);i.squaredLength(ue)===0&&i.set(ue,0,0,1),i.normalize(ue,ue),i.scale$2(ue,ue,i.GLOBE_RADIUS),M.center=i.ecefToLatLng(ue);const ke=M.getWorldToCameraMatrix(),Ee=i.invert(new Float64Array(16),ke);le=i.Aabb.applyTransform(le,i.multiply([],ke,W)),i.transformMat4(ue,ue,ke);const Se=.5*(le.max[2]-le.min[2]),je=this._minimumAABBFrustumDistance(M,le),Ie=i.scale$2([],[0,0,1],Se),Ve=i.add(Ie,ue,Ie),yt=je+(M.pitch===0?0:i.distance(ue,Ve)),ze=M.globeCenterInViewSpace,nt=i.sub([],ue,[ze[0],ze[1],ze[2]]);i.normalize(nt,nt),i.scale$2(nt,nt,yt);const We=i.add([],ue,nt);i.transformMat4(We,We,Ee);const mt=i.earthRadius/i.GLOBE_RADIUS,Ue=i.length(We),it=i.mercatorZfromAltitude(Math.max(Ue*mt-i.earthRadius,Number.EPSILON),0),ft=Math.min(M.zoomFromMercatorZAdjusted(it),j.maxZoom);return ft>.5*(i.GLOBE_ZOOM_THRESHOLD_MIN+i.GLOBE_ZOOM_THRESHOLD_MAX)?(M.setProjection({name:"mercator"}),M.zoom=ft,this._cameraForBounds(M,o,f,x,b,C)):{center:M.center,zoom:ft,bearing:x,pitch:b}}queryTerrainElevation(n,o){const f=this.transform.elevation;return f?(o=i.extend({},{exaggerated:!0},o),f.getAtPoint(i.MercatorCoordinate.fromLngLat(n),null,o.exaggerated)):null}_cameraForBounds(n,o,f,x,b,C){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,o,f,x,b,C);const M=n.clone(),j=this._extendCameraOptions(C),F=M.padding;M.bearing=x,M.pitch=b;const z=i.LngLat.convert(o),G=i.LngLat.convert(f),Q=new i.LngLat(z.lng,G.lat),re=new i.LngLat(G.lng,z.lat),ie=M.project(z),ne=M.project(G),se=this.queryTerrainElevation(z),W=this.queryTerrainElevation(G),te=this.queryTerrainElevation(Q),le=this.queryTerrainElevation(re),ue=[[ie.x,ie.y,Math.min(se||0,W||0,te||0,le||0)],[ne.x,ne.y,Math.max(se||0,W||0,te||0,le||0)]];let ke=i.Aabb.fromPoints(ue);const Ee=M.getWorldToCameraMatrix(),Se=i.invert(new Float64Array(16),Ee);ke=i.Aabb.applyTransform(ke,Ee);const je=i.sub([],ke.max,ke.min),Ie=F.left||0,Ve=F.right||0,yt=F.bottom||0,ze=F.top||0,{left:nt,right:We,top:mt,bottom:Ue}=j.padding,it=.5*(Ie+Ve),ft=.5*(ze+yt),pt=Math.min(M.scaleZoom(M.scale*Math.min((M.width-(Ie+Ve+nt+We))/je[0],(M.height-(yt+ze+Ue+mt))/je[1])),j.maxZoom),vt=M.scale/M.zoomScale(pt);ke=new i.Aabb([ke.min[0]-(nt+it)*vt,ke.min[1]-(Ue+ft)*vt,ke.min[2]],[ke.max[0]+(We+it)*vt,ke.max[1]+(mt+ft)*vt,ke.max[2]]);const Wt=.5*je[2],or=this._minimumAABBFrustumDistance(M,ke),Vt=[0,0,1,0];i.transformMat4$1(Vt,Vt,Ee),i.normalize$2(Vt,Vt);const tr=i.scale$2([],Vt,or+Wt),Sr=i.add([],ke.center,tr),Pr=(typeof j.offset.x=="number"&&typeof j.offset.y=="number"?new i.Point(j.offset.x,j.offset.y):i.Point.convert(j.offset)).rotate(-i.degToRad(x));ke.center[0]-=Pr.x*vt,ke.center[1]+=Pr.y*vt,i.transformMat4(ke.center,ke.center,Se),i.transformMat4(Sr,Sr,Se);const Zt=[ke.center[0],ke.center[1],Sr[2]*M.pixelsPerMeter];i.scale$2(Zt,Zt,1/M.worldSize);const Dr=i.lngFromMercatorX(Zt[0]),Xr=i.latFromMercatorY(Zt[1]),Kr=Math.min(M._zoomFromMercatorZ(Zt[2]),j.maxZoom),qr=new i.LngLat(Dr,Xr);return M.mercatorFromTransition&&Kr<.5*(i.GLOBE_ZOOM_THRESHOLD_MIN+i.GLOBE_ZOOM_THRESHOLD_MAX)?(M.setProjection({name:"globe"}),M.zoom=Kr,this._cameraForBounds(M,o,f,x,b,C)):{center:qr,zoom:Kr,bearing:x,pitch:b}}fitBounds(n,o,f){const x=this.cameraForBounds(n,o);return this._fitInternal(x,o,f)}fitScreenCoordinates(n,o,f,x,b){const C=i.Point.convert(n),M=i.Point.convert(o),j=new i.Point(Math.min(C.x,M.x),Math.min(C.y,M.y)),F=new i.Point(Math.max(C.x,M.x),Math.max(C.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(C,M))return this;const z=this.transform.pointLocation3D(j),G=this.transform.pointLocation3D(F),Q=this.transform.pointLocation3D(new i.Point(j.x,F.y)),re=this.transform.pointLocation3D(new i.Point(F.x,j.y)),ie=[Math.min(z.lng,G.lng,Q.lng,re.lng),Math.min(z.lat,G.lat,Q.lat,re.lat)],ne=[Math.max(z.lng,G.lng,Q.lng,re.lng),Math.max(z.lat,G.lat,Q.lat,re.lat)],se=x&&x.pitch?x.pitch:this.getPitch(),W=this._cameraForBounds(this.transform,ie,ne,f,se,x);return this._fitInternal(W,x,b)}_fitInternal(n,o,f){return n?(delete(o=i.extend(n,o)).padding,o.linear?this.easeTo(o,f):this.flyTo(o,f)):this}jumpTo(n,o){this.stop();const f=n.preloadOnly?this.transform.clone():this.transform;let x=!1,b=!1,C=!1;return"zoom"in n&&f.zoom!==+n.zoom&&(x=!0,f.zoom=+n.zoom),n.center!==void 0&&(f.center=i.LngLat.convert(n.center)),"bearing"in n&&f.bearing!==+n.bearing&&(b=!0,f.bearing=+n.bearing),"pitch"in n&&f.pitch!==+n.pitch&&(C=!0,f.pitch=+n.pitch),n.padding==null||f.isPaddingEqual(n.padding)||(f.padding=n.padding),n.preloadOnly?(this._preloadTiles(f),this):(this.fire(new i.Event("movestart",o)).fire(new i.Event("move",o)),x&&this.fire(new i.Event("zoomstart",o)).fire(new i.Event("zoom",o)).fire(new i.Event("zoomend",o)),b&&this.fire(new i.Event("rotatestart",o)).fire(new i.Event("rotate",o)).fire(new i.Event("rotateend",o)),C&&this.fire(new i.Event("pitchstart",o)).fire(new i.Event("pitch",o)).fire(new i.Event("pitchend",o)),this.fire(new i.Event("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.warnOnce(oa),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,o){const f=this.transform;if(!f.projection.supportsFreeCamera)return i.warnOnce(oa),this;this.stop();const x=f.zoom,b=f.pitch,C=f.bearing;f.setFreeCameraOptions(n);const M=x!==f.zoom,j=b!==f.pitch,F=C!==f.bearing;return this.fire(new i.Event("movestart",o)).fire(new i.Event("move",o)),M&&this.fire(new i.Event("zoomstart",o)).fire(new i.Event("zoom",o)).fire(new i.Event("zoomend",o)),F&&this.fire(new i.Event("rotatestart",o)).fire(new i.Event("rotate",o)).fire(new i.Event("rotateend",o)),j&&this.fire(new i.Event("pitchstart",o)).fire(new i.Event("pitch",o)).fire(new i.Event("pitchend",o)),this.fire(new i.Event("moveend",o)),this}easeTo(n,o){this._stop(!1,n.easeId),((n=i.extend({offset:[0,0],duration:500,easing:i.ease},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const f=this.transform,x=this.getZoom(),b=this.getBearing(),C=this.getPitch(),M=this.getPadding(),j="zoom"in n?+n.zoom:x,F="bearing"in n?this._normalizeBearing(n.bearing,b):b,z="pitch"in n?+n.pitch:C,G="padding"in n?n.padding:f.padding,Q=i.Point.convert(n.offset);let re,ie,ne;if(f.projection.name==="globe"){const Ie=i.MercatorCoordinate.fromLngLat(f.center),Ve=Q.rotate(-f.angle);Ie.x+=Ve.x/f.worldSize,Ie.y+=Ve.y/f.worldSize;const yt=Ie.toLngLat(),ze=i.LngLat.convert(n.center||yt);this._normalizeCenter(ze),re=f.centerPoint.add(Ve),ie=new i.Point(Ie.x,Ie.y).mult(f.worldSize),ne=new i.Point(i.mercatorXfromLng(ze.lng),i.mercatorYfromLat(ze.lat)).mult(f.worldSize).sub(ie)}else{re=f.centerPoint.add(Q);const Ie=f.pointLocation(re),Ve=i.LngLat.convert(n.center||Ie);this._normalizeCenter(Ve),ie=f.project(Ie),ne=f.project(Ve).sub(ie)}const se=f.zoomScale(j-x);let W,te;n.around&&(W=i.LngLat.convert(n.around),te=f.locationPoint(W));const le=this._zooming||j!==x,ue=this._rotating||b!==F,ke=this._pitching||z!==C,Ee=!f.isPaddingEqual(G),Se=Ie=>Ve=>{if(le&&(Ie.zoom=i.number(x,j,Ve)),ue&&(Ie.bearing=i.number(b,F,Ve)),ke&&(Ie.pitch=i.number(C,z,Ve)),Ee&&(Ie.interpolatePadding(M,G,Ve),re=Ie.centerPoint.add(Q)),W)Ie.setLocationAtPoint(W,te);else{const yt=Ie.zoomScale(Ie.zoom-x),ze=j>x?Math.min(2,se):Math.max(.5,se),nt=Math.pow(ze,1-Ve),We=Ie.unproject(ie.add(ne.mult(Ve*nt)).mult(yt));Ie.setLocationAtPoint(Ie.renderWorldCopies?We.wrap():We,re)}return n.preloadOnly||this._fireMoveEvents(o),Ie};if(n.preloadOnly){const Ie=this._emulate(Se,n.duration,f);return this._preloadTiles(Ie),this}const je={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=le,this._rotating=ue,this._pitching=ke,this._padding=Ee,this._easeId=n.easeId,this._prepareEase(o,n.noMoveStart,je),this._ease(Se(f),(Ie=>{f.recenterOnTerrain(),this._afterEase(o,Ie)}),n),this}_prepareEase(n,o,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",o||f.moving||this.fire(new i.Event("movestart",n)),this._zooming&&!f.zooming&&this.fire(new i.Event("zoomstart",n)),this._rotating&&!f.rotating&&this.fire(new i.Event("rotatestart",n)),this._pitching&&!f.pitching&&this.fire(new i.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new i.Event("move",n)),this._zooming&&this.fire(new i.Event("zoom",n)),this._rotating&&this.fire(new i.Event("rotate",n)),this._pitching&&this.fire(new i.Event("pitch",n))}_afterEase(n,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new i.Event("zoomend",n)),x&&this.fire(new i.Event("rotateend",n)),b&&this.fire(new i.Event("pitchend",n)),this.fire(new i.Event("moveend",n))}flyTo(n,o){if(this._prefersReducedMotion(n)){const pt=i.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(pt,o)}this.stop(),n=i.extend({offset:[0,0],speed:1.2,curve:1.42,easing:i.ease},n);const f=this.transform,x=this.getZoom(),b=this.getBearing(),C=this.getPitch(),M=this.getPadding(),j="zoom"in n?i.clamp(+n.zoom,f.minZoom,f.maxZoom):x,F="bearing"in n?this._normalizeBearing(n.bearing,b):b,z="pitch"in n?+n.pitch:C,G="padding"in n?n.padding:f.padding,Q=f.zoomScale(j-x),re=i.Point.convert(n.offset);let ie=f.centerPoint.add(re);const ne=f.pointLocation(ie),se=i.LngLat.convert(n.center||ne);this._normalizeCenter(se);const W=f.project(ne),te=f.project(se).sub(W);let le=n.curve;const ue=Math.max(f.width,f.height),ke=ue/Q,Ee=te.mag();if("minZoom"in n){const pt=i.clamp(Math.min(n.minZoom,x,j),f.minZoom,f.maxZoom),vt=ue/f.zoomScale(pt-x);le=Math.sqrt(vt/Ee*2)}const Se=le*le;function je(pt){const vt=(ke*ke-ue*ue+(pt?-1:1)*Se*Se*Ee*Ee)/(2*(pt?ke:ue)*Se*Ee);return Math.log(Math.sqrt(vt*vt+1)-vt)}function Ie(pt){return(Math.exp(pt)-Math.exp(-pt))/2}function Ve(pt){return(Math.exp(pt)+Math.exp(-pt))/2}const yt=je(0);let ze=function(pt){return Ve(yt)/Ve(yt+le*pt)},nt=function(pt){return ue*((Ve(yt)*(Ie(vt=yt+le*pt)/Ve(vt))-Ie(yt))/Se)/Ee;var vt},We=(je(1)-yt)/le;if(Math.abs(Ee)<1e-6||!isFinite(We)){if(Math.abs(ue-ke)<1e-6)return this.easeTo(n,o);const pt=ke<ue?-1:1;We=Math.abs(Math.log(ke/ue))/le,nt=function(){return 0},ze=function(vt){return Math.exp(pt*le*vt)}}n.duration="duration"in n?+n.duration:1e3*We/("screenSpeed"in n?+n.screenSpeed/le:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const mt=b!==F,Ue=z!==C,it=!f.isPaddingEqual(G),ft=pt=>vt=>{const Wt=vt*We,or=1/ze(Wt);pt.zoom=vt===1?j:x+pt.scaleZoom(or),mt&&(pt.bearing=i.number(b,F,vt)),Ue&&(pt.pitch=i.number(C,z,vt)),it&&(pt.interpolatePadding(M,G,vt),ie=pt.centerPoint.add(re));const Vt=vt===1?se:pt.unproject(W.add(te.mult(nt(Wt))).mult(or));return pt.setLocationAtPoint(pt.renderWorldCopies?Vt.wrap():Vt,ie),pt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(o),pt};if(n.preloadOnly){const pt=this._emulate(ft,n.duration,f);return this._preloadTiles(pt),this}return this._zooming=!0,this._rotating=mt,this._pitching=Ue,this._padding=it,this._prepareEase(o,!1),this._ease(ft(f),(()=>this._afterEase(o)),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,o)}if(!n){const f=this.handlers;f&&f.stop(!1)}return this}_ease(n,o,f){f.animate===!1||f.duration===0?(n(1),o()):(this._easeStart=i.exported.now(),this._easeOptions=f,this._onEaseFrame=n,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((i.exported.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,o){n=i.wrap(n,-180,180);const f=Math.abs(n-o);return Math.abs(n-360-o)<f&&(n-=360),Math.abs(n+360-o)<f&&(n+=360),n}_normalizeCenter(n){const o=this.transform;if(!o.renderWorldCopies||o.maxBounds)return;const f=n.lng-o.center.lng;n.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&i.exported.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,o,f){const x=Math.ceil(15*o/1e3),b=[],C=n(f.clone());for(let M=0;M<=x;M++){const j=C(M/x);b.push(j.clone())}return b}}class Rt{constructor(n={}){this.options=n,i.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const o=this.options&&this.options.compact;return this._map=n,this._container=he("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=he("button","mapboxgl-ctrl-attrib-button",this._container),he("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=he("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,o){const f=this._map._getUIString(`AttributionControl.${o}`);n.setAttribute("aria-label",f),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",f)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.config.ACCESS_TOKEN}];if(n){const f=o.reduce(((x,b,C)=>(b.value&&(x+=`${b.key}=${b.value}${C<o.length-1?"&":""}`),x)),"?");n.href=`${i.config.FEEDBACK_URL}/${f}#${Ka(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const o=this._map.style._sourceCaches;for(const x in o){const b=o[x];if(b.used){const C=b.getSource();C.attribution&&n.indexOf(C.attribution)<0&&n.push(C.attribution)}}n.sort(((x,b)=>x.length-b.length)),n=n.filter(((x,b)=>{for(let C=b+1;C<n.length;C++)if(n[C].indexOf(x)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const f=n.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,n.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class kl{constructor(){i.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=he("div","mapboxgl-ctrl");const o=he("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const o in n){const f=n[o].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const o=n[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class _c{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const o=++this._id;return this._queue.push({callback:n,id:o,cancelled:!1}),o}remove(n){const o=this._currentlyRunning,f=o?this._queue.concat(o):this._queue;for(const x of f)if(x.id===n)return void(x.cancelled=!0)}run(n=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const f of o)if(!f.cancelled&&(f.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function jo(d,n,o){if(d=new i.LngLat(d.lng,d.lat),n){const f=new i.LngLat(d.lng-360,d.lat),x=new i.LngLat(d.lng+360,d.lat),b=360*Math.ceil(Math.abs(d.lng-o.center.lng)/360),C=o.locationPoint(d).distSqr(n),M=n.x<0||n.y<0||n.x>o.width||n.y>o.height;o.locationPoint(f).distSqr(n)<C&&(M||Math.abs(f.lng-o.center.lng)<b)?d=f:o.locationPoint(x).distSqr(n)<C&&(M||Math.abs(x.lng-o.center.lng)<b)&&(d=x)}for(;Math.abs(d.lng-o.center.lng)>180;){const f=o.locationPoint(d);if(f.x>=0&&f.y>=0&&f.x<=o.width&&f.y<=o.height)break;d.lng>o.center.lng?d.lng-=360:d.lng+=360}return d}const No={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Nt extends i.Evented{constructor(n,o){if(super(),(n instanceof i.window.HTMLElement||o)&&(n=i.extend({element:n},o)),i.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=i.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=he("div");const x=41,b=27,C=Te("svg",{display:"block",height:x*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${x}`},this._element),M=Te("radialGradient",{id:"shadowGradient"},Te("defs",{},C));Te("stop",{offset:"10%","stop-opacity":.4},M),Te("stop",{offset:"100%","stop-opacity":.05},M),Te("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),Te("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),Te("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),Te("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=i.Point.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(x=>{x.preventDefault()})),this._element.addEventListener("mousedown",(x=>{x.preventDefault()}));const f=this._element.classList;for(const x in No)f.remove(`mapboxgl-marker-anchor-${x}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=i.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const o=n.code,f=n.charCode||n.keyCode;o!=="Space"&&o!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(n){const o=n.originalEvent.target,f=this._element;this._popup&&(o===f||f.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,o=this._pos;if(!n||!o)return!1;const f=n.unproject(o),x=n.getFreeCameraOptions();if(!x.position)return!1;const b=x.position.toLngLat();return b.distanceTo(f)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const o=this._pos;if(!o||o.x<0||o.x>n.transform.width||o.y<0||o.y>n.transform.height)return void this._clearFadeTimer();const f=n.unproject(o);let x;n._showingGlobe()&&i.isLngLatBehindGlobe(n.transform,this._lngLat)?x=0:(x=1-n._queryFogOpacity(f),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${No[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const n=this._pos,o=this._map,f=this.getPitchAlignment();if(!o||!n||f!=="map")return"";if(!o._showingGlobe()){const j=o.getPitch();return j?`rotateX(${j}deg)`:""}const x=i.radToDeg(i.globeTiltAtLngLat(o.transform,this._lngLat)),b=n.sub(i.globeCenterToScreenPoint(o.transform)),C=Math.abs(b.x)+Math.abs(b.y);if(C===0)return"";const M=x/C;return`rotateX(${-b.y*M}deg) rotateY(${b.x*M}deg)`}_calculateZTransform(){const n=this._pos,o=this._map;if(!o||!n)return"";let f=0;const x=this.getRotationAlignment();if(x==="map")if(o._showingGlobe()){const b=o.project(new i.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),C=o.project(new i.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);f=i.radToDeg(Math.atan2(C.y,C.x))-90}else f=-o.getBearing();else if(x==="horizon"){const b=i.smoothstep(4,6,o.getZoom()),C=i.globeCenterToScreenPoint(o.transform);C.y+=b*o.transform.height;const M=n.sub(C),j=i.radToDeg(Math.atan2(M.y,M.x));f=(j>90?j-270:j+90)*(1-b)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(n){i.window.cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=jo(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),n===!0?this._updateFrameId=i.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),o._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(n){return this._offset=i.Point.convert(n),this._update(),this}_onMove(n){const o=this._map;if(!o)return;const f=this._pointerdownPos,x=this._positionDelta;if(f&&x){if(!this._isDragging){const b=this._clickTolerance||o._clickTolerance;if(n.point.dist(f)<b)return;this._isDragging=!0}this._pos=n.point.sub(x),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.Event("dragstart"))),this.fire(new i.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.Event("dragend")),this._state="inactive"}_addDragHandler(n){const o=this._map,f=this._pos;o&&f&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(f),this._pointerdownPos=n.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const o=this._map;return o&&(n?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const eo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Sl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vc(d=new i.Point(0,0),n="bottom"){if(typeof d=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(n){case"top":return new i.Point(0,d);case"top-left":return new i.Point(o,o);case"top-right":return new i.Point(-o,o);case"bottom":return new i.Point(0,-d);case"bottom-left":return new i.Point(o,-o);case"bottom-right":return new i.Point(-o,-o);case"left":return new i.Point(d,0);case"right":return new i.Point(-d,0)}return new i.Point(0,0)}return d instanceof i.Point||Array.isArray(d)?i.Point.convert(d):i.Point.convert(d[n]||[0,0])}class El{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const o=i.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,o,f){this._start=this.getValue(o),this._end=n,this._startTime=o,this._endTime=o+f}}const ls={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},cs={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Do={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ma{constructor(n,o,f=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new aa({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,f&&(this.mousePitch=new lu({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),i.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(n,o){this.mouseRotate.mousedown(n,o),this.mousePitch&&this.mousePitch.mousedown(n,o),De()}move(n,o){const f=this.map,x=this.mouseRotate.mousemoveWindow(n,o),b=x&&x.bearingDelta;if(b&&f.setBearing(f.getBearing()+b),this.mousePitch){const C=this.mousePitch.mousemoveWindow(n,o),M=C&&C.pitchDelta;M&&f.setPitch(f.getPitch()+M)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Qe(),i.window.removeEventListener("mousemove",this.mousemove),i.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(i.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),ce(this.element,n)),i.window.addEventListener("mousemove",this.mousemove),i.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,ce(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=$e(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=$e(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Vs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Aa={maxWidth:100,unit:"metric"},pu={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},to={version:i.version,supported:$,setRTLTextPlugin:i.setRTLTextPlugin,getRTLTextPluginStatus:i.getRTLTextPluginStatus,Map:class extends xc{constructor(d){if(i.LivePerformanceUtils.mark(i.PerformanceMarkers.create),(d=i.extend({},cs,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&i.isSafariWithAntialiasingBug(i.window)&&(d.antialias=!1,i.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Co(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._useWebGL2=d.useWebGL2,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new _c,this._domRenderTaskQueue=new _c,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.uniqueId(),this._locale=i.extend({},ls,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new El(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new i.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=i.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof i.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&i.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),i.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),i.window!==void 0&&(i.window.addEventListener("online",this._onWindowOnline,!1),i.window.addEventListener("resize",this._onWindowResize,!1),i.window.addEventListener("orientationchange",this._onWindowResize,!1),i.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),i.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Us(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new fc(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,i.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new Rt({customAttribution:d.customAttribution})),this._logoControl=new kl,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(n=>{this._update(n.dataType==="style"),this.fire(new i.Event(`${n.dataType}data`,n))})),this.on("dataloading",(n=>{this.fire(new i.Event(`${n.dataType}dataloading`,n))}))}_getMapId(){return this._mapId}addControl(d,n){if(n===void 0&&(n=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new i.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[n];return n.indexOf("bottom")!==-1?f.insertBefore(o,f.firstChild):f.appendChild(o),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new i.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(d);return n>-1&&this._controls.splice(n,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new i.Event("movestart",d)).fire(new i.Event("move",d)),this.fire(new i.Event("resize",d)),n&&this.fire(new i.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(i.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new i.Event("zoomstart")).fire(new i.Event("zoom")).fire(new i.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new i.Event("zoomstart")).fire(new i.Event("zoom")).fire(new i.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new i.Event("pitchstart")).fire(new i.Event("pitch")).fire(new i.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new i.Event("pitchstart")).fire(new i.Event("pitch")).fire(new i.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?i.window.navigator.language:Array.isArray(d)?d.length===0?void 0:d.map((n=>n==="auto"?i.window.navigator.language:n)):d}setLanguage(d){const n=this._parseLanguage(d);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,n=d.projection.name;let o;n==="globe"&&d.zoom>=i.GLOBE_ZOOM_THRESHOLD_MAX?(d.setMercatorFromTransition(),o=!0):n==="mercator"&&d.zoom<i.GLOBE_ZOOM_THRESHOLD_MAX&&(d.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,n){return this._updateProjection(d||n||{name:"mercator"})}_updateProjection(d){let n;if(n=d.name==="globe"&&this.transform.zoom>=i.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const o in this.style._sourceCaches)this.style._sourceCaches[o].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(d){return this.transform.locationPoint3D(i.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(i.Point.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,n,o){if(d==="mouseenter"||d==="mouseover"){let f=!1;const x=C=>{const M=n.filter((F=>this.getLayer(F))),j=M.length?this.queryRenderedFeatures(C.point,{layers:M}):[];j.length?f||(f=!0,o.call(this,new fi(d,this,C.originalEvent,{features:j}))):f=!1},b=()=>{f=!1};return{layers:new Set(n),listener:o,delegates:{mousemove:x,mouseout:b}}}if(d==="mouseleave"||d==="mouseout"){let f=!1;const x=C=>{const M=n.filter((j=>this.getLayer(j)));(M.length?this.queryRenderedFeatures(C.point,{layers:M}):[]).length?f=!0:f&&(f=!1,o.call(this,new fi(d,this,C.originalEvent)))},b=C=>{f&&(f=!1,o.call(this,new fi(d,this,C.originalEvent)))};return{layers:new Set(n),listener:o,delegates:{mousemove:x,mouseout:b}}}{const f=x=>{const b=n.filter((M=>this.getLayer(M))),C=b.length?this.queryRenderedFeatures(x.point,{layers:b}):[];C.length&&(x.features=C,o.call(this,x),delete x.features)};return{layers:new Set(n),listener:o,delegates:{[d]:f}}}}on(d,n,o){if(o===void 0)return super.on(d,n);Array.isArray(n)||(n=[n]);const f=this._createDelegatedListener(d,n,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const x in f.delegates)this.on(x,f.delegates[x]);return this}once(d,n,o){if(o===void 0)return super.once(d,n);Array.isArray(n)||(n=[n]);const f=this._createDelegatedListener(d,n,o);for(const x in f.delegates)this.once(x,f.delegates[x]);return this}off(d,n,o){if(o===void 0)return super.off(d,n);n=new Set(Array.isArray(n)?n:[n]);const f=(b,C)=>{if(b.size!==C.size)return!1;for(const M of b)if(!C.has(M))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[d]:void 0;return x&&(b=>{for(let C=0;C<b.length;C++){const M=b[C];if(M.listener===o&&f(M.layers,n)){for(const j in M.delegates)this.off(j,M.delegates[j]);return b.splice(C,1),this}}})(x),this}queryRenderedFeatures(d,n){return this.style?(n!==void 0||d===void 0||d instanceof i.Point||Array.isArray(d)||(n=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(d,n){return this.style.querySourceFeatures(d,n)}isPointOnSurface(d){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&i.warnOnce(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.Point.convert(d))}setStyle(d,n){return(n=i.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(d,n))}_getUIString(d){const n=this._locale[d];if(n==null)throw new Error(`Missing UI string '${d}'`);return n}_updateStyle(d,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new ws(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ws(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,n){if(typeof d=="string"){const o=this._requestManager.normalizeStyleURL(d),f=this._requestManager.transformRequest(o,i.ResourceType.Style);i.getJSON(f,((x,b)=>{x?this.fire(new i.ErrorEvent(x)):b&&this._updateDiff(b,n)}))}else typeof d=="object"&&this._updateDiff(d,n)}_updateDiff(d,n){try{this.style.setState(d)&&this._update(!0)}catch(o){i.warnOnce(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(d,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.warnOnce("There is no style added to the map."),!1)}addSource(d,n){return this._lazyInitEmptyStyle(),this.style.addSource(d,n),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const n in d){const o=d[n]._tiles;for(const f in o){const x=o[f];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}addSourceType(d,n,o){this._lazyInitEmptyStyle(),this.style.addSourceType(d,n,o)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,n,{pixelRatio:o=1,sdf:f=!1,stretchX:x,stretchY:b,content:C}={}){if(this._lazyInitEmptyStyle(),n instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&n instanceof i.window.ImageBitmap){const{width:M,height:j,data:F}=i.exported.getImageData(n);this.style.addImage(d,{data:new i.RGBAImage({width:M,height:j},F),pixelRatio:o,stretchX:x,stretchY:b,content:C,sdf:f,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new i.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:j}=n,F=n;this.style.addImage(d,{data:new i.RGBAImage({width:M,height:j},new Uint8Array(F.data)),pixelRatio:o,stretchX:x,stretchY:b,content:C,sdf:f,version:0,userImage:F}),F.onAdd&&F.onAdd(this,d)}}updateImage(d,n){const o=this.style.getImage(d);if(!o)return void this.fire(new i.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=n instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&n instanceof i.window.ImageBitmap?i.exported.getImageData(n):n,{width:x,height:b}=f;x!==void 0&&b!==void 0?x===o.data.width&&b===o.data.height?(o.data.replace(f.data,!(n instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&n instanceof i.window.ImageBitmap)),this.style.updateImage(d,o)):this.fire(new i.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${b})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`))):this.fire(new i.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new i.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,n){i.getImage(this._requestManager.transformRequest(d,i.ResourceType.Image),((o,f)=>{n(o,f instanceof i.window.HTMLImageElement?i.exported.getImageData(f):f)}))}listImages(){return this.style.listImages()}addLayer(d,n){return this._lazyInitEmptyStyle(),this.style.addLayer(d,n),this._update(!0)}moveLayer(d,n){return this.style.moveLayer(d,n),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,n,o){return this.style.setLayerZoomRange(d,n,o),this._update(!0)}setFilter(d,n,o={}){return this.style.setFilter(d,n,o),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,n,o,f={}){return this.style.setPaintProperty(d,n,o,f),this._update(!0)}getPaintProperty(d,n){return this.style.getPaintProperty(d,n)}setLayoutProperty(d,n,o,f={}){return this.style.setLayoutProperty(d,n,o,f),this._update(!0)}getLayoutProperty(d,n){return this.style.getLayoutProperty(d,n)}setLight(d,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.LngLat.convert(d),this.transform):0}setFeatureState(d,n){return this.style.setFeatureState(d,n),this._update()}removeFeatureState(d,n){return this.style.removeFeatureState(d,n),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let o,f,x,b=this._container;for(;b&&(!f||!x);){const C=i.window.getComputedStyle(b).transform;C&&C!=="none"&&(o=C.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(f=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(x=o[3])),b=b.parentElement}this._containerWidth=f?Math.abs(d/f):d,this._containerHeight=x?Math.abs(n/x):n}_detectMissingCSS(){i.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=he("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=he("div","mapboxgl-canvas-container",d);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=he("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=he("div","mapboxgl-control-container",d),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((x=>{f[x]=he("div",`mapboxgl-ctrl-${x}`,o)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,n){const o=i.exported.devicePixelRatio||1;this._canvas.width=o*Math.ceil(d),this._canvas.height=o*Math.ceil(n),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${n}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const n=this._markers.indexOf(d);n!==-1&&this._markers.splice(n,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const n=this._popups.indexOf(d);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const d=i.extend({},$.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",d),o=n||this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);o?(this._useWebGL2&&!n&&i.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),i.storeAuthState(o,!0),this.painter=new Eo(o,this.transform,!!n),this.on("data",(f=>{f.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),i.exported$1.testSupport(o)):this.fire(new i.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new i.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let n;const o=this.painter.context.extTimerQuery,f=i.exported.now();if(this.listens("gpu-timing-frame")&&(n=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],i.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],i.window.performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,j=this.transform.pitch,F=i.exported.now(),z=new i.EvaluationParameters(M,{now:F,fadeDuration:x,pitch:j,transition:this.style.getTransition()});this.style.update(z)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(f),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(f),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new i.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const M=i.exported.now()-f;o.endQueryEXT(o.TIME_ELAPSED_EXT,n),setTimeout((()=>{const j=o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(n),this.fire(new i.Event("gpu-timing-frame",{cpuTime:M,gpuTime:j})),i.window.performance.mark("frame-gpu",{startTime:f,detail:{gpuTime:j}})}),50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout((()=>{const j=this.painter.queryGpuTimers(M);this.fire(new i.Event("gpu-timing-layer",{layerTimes:j}))}),50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const j=this.painter.queryGpuTimeDeferredRender(M);this.fire(new i.Event("gpu-timing-deferred-render",{gpuTime:j}))}),50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(C||this._repaint)this.triggerRepaint();else{const M=!this.isMoving()&&this.loaded();if(M&&(b=this._updateAverageElevation(f,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new i.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new i.Event("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,i.LivePerformanceUtils.mark(i.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&i.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const n of this._markers)d&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!d||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(d,n=!1){const o=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);if((n||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const f=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=d;const C=Math.abs(f-x);if(C>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(x),o(x);this._averageElevation.easeTo(x,d,300)}else if(C>1e-4)return this._averageElevation.jumpTo(x),o(x)}return!!this._averageElevation.isEasing(d)&&o(this._averageElevation.getValue(d))}_authenticate(){i.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(d=>{if(d&&(d.message===i.AUTH_ERR_MSG||d.status===401)){const n=this.painter.context.gl;i.storeAuthState(n,!1),this._logoControl instanceof kl&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),i.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const o=this.painter.context.gl,f=o.createFramebuffer();function x(b){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,b,0);const C=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,C),C}return o.bindFramebuffer(o.FRAMEBUFFER,f),this._canvasPixelComparison(x(d),n.canvasCopies.map(x),n.timeStamps)}_canvasPixelComparison(d,n,o){let f=o[1]-o[0];const x=d.length/4;for(let b=0;b<n.length;b++){const C=n[b];let M=0;for(let j=0;j<C.length;j+=4)C[j]===d[j]&&C[j+1]===d[j+1]&&C[j+2]===d[j+2]&&C[j+3]===d[j+3]&&(M+=1);f+=(o[b+2]-o[b+1])*(1-M/x)}return f}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),i.window!==void 0&&(i.window.removeEventListener("resize",this._onWindowResize,!1),i.window.removeEventListener("orientationchange",this._onWindowResize,!1),i.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),i.window.removeEventListener("online",this._onWindowOnline,!1),i.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),i.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new i.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=i.exported.frame((n=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(n)})))}_preloadTiles(d){const n=this.style?Object.values(this.style._sourceCaches):[];return i.asyncAll(n,((o,f)=>o._preloadTiles(d,f)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){i.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,n){i.setCacheLimits(d,n)}get version(){return i.version}},NavigationControl:class{constructor(d){this.options=i.extend({},Do,d),this._container=he("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this.options.showZoom&&(i.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(n=>{this._map&&this._map.zoomIn({},{originalEvent:n})})),he("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(n=>{this._map&&this._map.zoomOut({},{originalEvent:n})})),he("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(n=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:n}):o.resetNorth({},{originalEvent:n}))})),this._compassIcon=he("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const n=d.getZoom(),o=n===d.getMaxZoom(),f=n===d.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=n)}))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ma(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,n){const o=he("button",d,this._container);return o.type="button",o.addEventListener("click",n),o}_setButtonTitle(d,n){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${n}`);d.setAttribute("aria-label",o),d.firstElementChild&&d.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends i.Evented{constructor(d){super(),this.options=i.extend({geolocation:i.window.navigator.geolocation},Vs,d),i.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=an(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=he("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const n=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,d(o)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):i.window.navigator.permissions!==void 0?i.window.navigator.permissions.query({name:"geolocation"}).then((o=>n(o.state!=="denied"))).catch((()=>n())):n()}_isOutOfMapMaxBounds(d){const n=this._map.getMaxBounds(),o=d.coords;return!!n&&(o.longitude<n.getWest()||o.longitude>n.getEast()||o.latitude<n.getSouth()||o.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new i.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new i.Event("geolocate",d)),this._finish()}}_updateCamera(d){const n=new i.LngLat(d.coords.longitude,d.coords.latitude),o=d.coords.accuracy,f=this._map.getBearing(),x=i.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(o),x,{geolocateSource:!0})}_updateMarker(d){if(d){const n=new i.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,n=i.mercatorZfromAltitude(1,d._center.lat)*d.worldSize,o=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new i.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this._geolocateButton=he("button","mapboxgl-ctrl-geolocate",this._container),he("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){i.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=he("div","mapboxgl-user-location"),this._dotElement.appendChild(he("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(he("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Nt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=he("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Nt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.Event("trackuserlocationend")))}))}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{i.window.addEventListener("ondeviceorientationabsolute"in i.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};i.window.DeviceMotionEvent!==void 0&&typeof i.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((n=>{n==="granted"&&d()})).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),i.window.removeEventListener("deviceorientation",this._onDeviceOrientation),i.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Rt,ScaleControl:class{constructor(d){this.options=i.extend({},Aa,d),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),i.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,n=this._map,o=n._containerHeight/2,f=n._containerWidth/2-d/2,x=n.unproject([f,o]),b=n.unproject([f+d,o]),C=x.distanceTo(b);if(this.options.unit==="imperial"){const M=3.2808*C;M>5280?this._setScale(d,M/5280,"mile"):this._setScale(d,M,"foot")}else this.options.unit==="nautical"?this._setScale(d,C/1852,"nautical-mile"):C>=1e3?this._setScale(d,C/1e3,"kilometer"):this._setScale(d,C,"meter")}_setScale(d,n,o){this._map._requestDomTask((()=>{const f=(function(b){const C=Math.pow(10,`${Math.floor(b)}`.length-1);let M=b/C;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:(function(j){const F=Math.pow(10,Math.ceil(-Math.log(j)/Math.LN10));return Math.round(j*F)/F})(M),C*M})(n),x=f/n;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(f):`${f}&nbsp;${pu[o]}`,this._container.style.width=d*x+"px"}))}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=he("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof i.window.HTMLElement?this._container=d.container:i.warnOnce("Full screen control 'container' must be a DOM element.")),i.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in i.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in i.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=he("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,i.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!i.window.document.fullscreenEnabled&&!i.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=he("button","mapboxgl-ctrl-fullscreen",this._controlContainer);he("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),i.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(i.window.document.fullscreenElement||i.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?i.window.document.exitFullscreen?i.window.document.exitFullscreen():i.window.document.webkitCancelFullScreen&&i.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.Evented{constructor(d){super(),this.options=i.extend(Object.create(eo),d),i.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new i.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new i.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=i.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(i.window.document.createTextNode(d))}setHTML(d){const n=i.window.document.createDocumentFragment(),o=i.window.document.createElement("body");let f;for(o.innerHTML=d;f=o.firstChild,f;)n.appendChild(f);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=he("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(d),this.options.closeButton){const o=this._closeButton=he("button","mapboxgl-popup-close-button",n);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let n;return this._classList.delete(d)?n=!1:(this._classList.add(d),n=!0),this._updateClassList(),n}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const n=this._map,o=this._container,f=this._pos;if(!n||!o||!f)return"bottom";const x=o.offsetWidth,b=o.offsetHeight,C=f.x<x/2,M=f.x>n.transform.width-x/2;if(f.y+d<b)return C?"top-left":M?"top-right":"top";if(f.y>n.transform.height-b){if(C)return"bottom-left";if(M)return"bottom-right"}return C?"left":M?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),d.className=n.join(" ")}_update(d){const n=this._map,o=this._content;if(!n||!this._lngLat&&!this._trackPointer||!o)return;let f=this._container;if(f||(f=this._container=he("div","mapboxgl-popup",n.getContainer()),this._tip=he("div","mapboxgl-popup-tip",f),f.appendChild(o)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=jo(this._lngLat,this._pos,n.transform)),!this._trackPointer||d){const x=this._pos=this._trackPointer&&d?d:n.project(this._lngLat),b=vc(this.options.offset),C=this._anchor=this._getAnchor(b.y),M=vc(this.options.offset,C),j=x.add(M).round();n._requestDomTask((()=>{this._container&&C&&(this._container.style.transform=`${No[C]} translate(${j.x}px,${j.y}px)`)}))}if(!this._marker&&n._showingGlobe()){const x=i.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Sl);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Nt,Style:ws,LngLat:i.LngLat,LngLatBounds:i.LngLatBounds,Point:i.Point,MercatorCoordinate:i.MercatorCoordinate,FreeCameraOptions:Ta,Evented:i.Evented,config:i.config,prewarm:function(){yo().acquire(Rs)},clearPrewarmedResources:function(){const d=Di;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(Rs),Di=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return i.config.ACCESS_TOKEN},set accessToken(d){i.config.ACCESS_TOKEN=d},get baseApiUrl(){return i.config.API_URL},set baseApiUrl(d){i.config.API_URL=d},get workerCount(){return ri.workerCount},set workerCount(d){ri.workerCount=d},get maxParallelImageRequests(){return i.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){i.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){i.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:i.exported.setNow,restoreNow:i.exported.restoreNow};return to}));var B=A;return B}))})(Wm)),Wm.exports}var nE=rE();const iE=Yy(nE);function Or(u,h,y){return h in u?Object.defineProperty(u,h,{value:y,enumerable:!0,configurable:!0,writable:!0}):u[h]=y,u}const Ys=H.createContext(null);var sE=typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||!(typeof process>"u"||typeof process.versions!="object"||!process.versions.electron)||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0;const qo=!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||sE?iE:null;var z_=["resize","remove","mousedown","mouseup","mouseover","mousemove","click","dblclick","mouseenter","mouseleave","mouseout","contextmenu","touchstart","touchend","touchmove","touchcancel","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoom","zoomend","rotatestart","rotate","rotateend","pitchstart","pitch","pitchend","boxzoomstart","boxzoomend","boxzoomcancel","webglcontextlost","webglcontextrestored","load","error","data","styledata","sourcedata","dataloading","styledataloading","sourcedataloading"],B_=function(u){return u.charAt(0).toUpperCase()+u.slice(1)};const c0=(u=[],h=[])=>{if(u.length!==h.length)return!1;for(let y=0;y<u.length;y+=1)if(u[y]!==h[y])return!1;return!0},F_=(u={},h={})=>[...new Set([...Object.keys(u),...Object.keys(h)])].reduce(((y,w)=>{const k=u[w];return k!==h[w]&&y.push([w,k]),y}),[]),Tf=(u,h,y,w)=>{const k={layers:[h]};if(w){const A=[[y[0]-w,y[1]-w],[y[0]+w,y[1]+w]];return u.queryRenderedFeatures(A,k)}return u.queryRenderedFeatures(y,k)},ay=[["onClick","click"],["onHover","mousemove"],["onEnter","mouseenter"],["onLeave","mouseleave"],["onContextMenu","contextmenu"]];class Fc extends H.PureComponent{constructor(h){super(h),Or(this,"_addLayer",(y=>{const w=this._map,{before:k,radius:A,onClick:I,onHover:B,onEnter:i,onLeave:R,onContextMenu:$,...K}=y;k&&w.getLayer(k)?w.addLayer(K,k):w.addLayer(K),this._addEventListeners(y)})),Or(this,"_addEventListeners",(y=>{ay.forEach((([w,k])=>{const A=`_${w}`;y[w]&&this._map.on(k,this._id,this[A])}))})),Or(this,"_updateEventListeners",((y,w)=>{ay.forEach((([k,A])=>{const I=`_${k}`;!w[k]&&y[k]&&this._map.off(A,this._id,this[I]),w[k]&&!y[k]&&this._map.on(A,this._id,this[I])}))})),Or(this,"_removeEventListeners",(y=>{ay.forEach((([w,k])=>{const A=`_${w}`;y[w]&&this._map.off(k,this._id,this[A])}))})),Or(this,"_onClick",(y=>{const w=[y.point.x,y.point.y],k=Tf(this._map,this._id,w,this.props.radius);this.props.onClick({...y,features:k})})),Or(this,"_onHover",(y=>{const w=[y.point.x,y.point.y],k=Tf(this._map,this._id,w,this.props.radius);this.props.onHover({...y,features:k})})),Or(this,"_onEnter",(y=>{const w=[y.point.x,y.point.y],k=Tf(this._map,this._id,w,this.props.radius);this.props.onEnter({...y,features:k})})),Or(this,"_onLeave",(y=>{const w=[y.point.x,y.point.y],k=Tf(this._map,this._id,w,this.props.radius);this.props.onLeave({...y,features:k})})),Or(this,"_onContextMenu",(y=>{const w=[y.point.x,y.point.y],k=Tf(this._map,this._id,w,this.props.radius);this.props.onContextMenu({...y,features:k})})),this._id=h.id}componentDidMount(){this._addLayer(this.props)}componentDidUpdate(h){const y=this._map,{id:w,before:k,onClick:A,...I}=this.props;if(w!==h.id||this.props.type!==h.type||h.type!=="background"&&(this.props.source!==h.source||this.props["source-layer"]!==h["source-layer"]))return this._id=w,this._map.removeLayer(h.id),void this._addLayer(this.props);k!==h.before&&k&&y.getLayer(k)&&y.moveLayer(this._id,k),I.paint!==h.paint&&F_(I.paint,h.paint).forEach((([B,i])=>{y.setPaintProperty(this._id,B,i)})),I.layout!==h.layout&&F_(I.layout,h.layout).forEach((([B,i])=>{y.setLayoutProperty(this._id,B,i)})),I.filter!==h.filter&&(I.filter?y.setFilter(this._id,I.filter):y.setFilter(this._id,void 0)),this._updateEventListeners(h,this.props)}componentWillUnmount(){this._map&&this._map.getStyle()&&(this._removeEventListeners(this.props),this._map.getLayer(this._id)&&this._map.removeLayer(this._id))}render(){return H.createElement(Ys.Consumer,{},(h=>(h&&(this._map=h),null)))}}Or(Fc,"displayName","Layer"),Or(Fc,"defaultProps",{radius:0});class L1 extends H.PureComponent{componentDidMount(){const{layer:h,before:y}=this.props;y&&this._map.getLayer(y)?this._map.addLayer(h,y):this._map.addLayer(h),this._id=h.id}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.getLayer(this._id)&&this._map.removeLayer(this._id)}render(){return H.createElement(Ys.Consumer,{},(h=>(h&&(this._map=h),null)))}}Or(L1,"displayName","CustomLayer");const aE=[Fc,L1],R1=u=>aE.includes(u.type),z1=(u,h)=>{H.Children.forEach(h,(y=>{y&&(R1(y)&&u(y),y.props&&y.props.children&&z1(u,y.props.children))}))},oE=u=>{const h=(w=>{const k=[];return z1((A=>{A.props.before||k.push((I=>I.props.id||I.props.layer.id)(A))}),w),k})(u);h.shift();const y=w=>typeof w=="function"?w:H.Children.map(w,(k=>{if(!k)return k;if(R1(k)){const A=k.props.before||h.shift();return H.cloneElement(k,{before:A})}return k.props&&k.props.children?H.cloneElement(k,{children:y(k.props.children)}):k}));return y(u)};class Nf extends H.PureComponent{constructor(h){super(h),Or(this,"state",{loaded:!1}),Or(this,"_onViewportChange",(y=>{if(!y.originalEvent)return;const w=this._map,{lng:k,lat:A}=w.getCenter(),I={latitude:A,longitude:k,zoom:w.getZoom(),pitch:w.getPitch(),bearing:w.getBearing()};this.props.onViewportChange(I)})),qo&&(qo.accessToken=h.accessToken),this._container=H.createRef()}componentDidMount(){if(!qo)return;const h=this._container.current,y=new qo.Map({container:h,style:this.props.mapStyle,interactive:!!this.props.onViewportChange,center:[this.props.longitude,this.props.latitude],zoom:this.props.zoom,pitch:this.props.pitch,bearing:this.props.bearing,minZoom:this.props.minZoom,maxZoom:this.props.maxZoom,hash:this.props.hash,bearingSnap:this.props.bearingSnap,pitchWithRotate:this.props.pitchWithRotate,attributionControl:this.props.attributionControl,logoPosition:this.props.logoPosition,failIfMajorPerformanceCaveat:this.props.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.props.preserveDrawingBuffer,antialias:this.props.antialias,refreshExpiredTiles:this.props.refreshExpiredTiles,maxBounds:this.props.maxBounds,bounds:this.props.bounds,scrollZoom:this.props.scrollZoom,boxZoom:this.props.boxZoom,dragRotate:this.props.dragRotate,dragPan:this.props.dragPan,keyboard:this.props.keyboard,doubleClickZoom:this.props.doubleClickZoom,trackResize:this.props.trackResize,renderWorldCopies:this.props.renderWorldCopies,maxTileCacheSize:this.props.maxTileCacheSize,localIdeographFontFamily:this.props.localIdeographFontFamily,transformRequest:this.props.transformRequest,collectResourceTiming:this.props.collectResourceTiming,fadeDuration:this.props.fadeDuration,crossSourceCollisions:this.props.crossSourceCollisions,locale:this.props.locale});this._map=y,y.once("load",(()=>{this.setState({loaded:!0},this.props.onLoad)})),this.props.onViewportChange&&(y.on("dragend",this._onViewportChange),y.on("zoomend",this._onViewportChange),y.on("rotateend",this._onViewportChange),y.on("pitchend",this._onViewportChange),y.on("boxzoomend",this._onViewportChange)),z_.forEach((w=>{const k=`on${B_(w)}`,A=this.props[k];A&&(Array.isArray(A)?y.on(w,...A):y.on(w,A))})),this.props.cursorStyle&&(y.getCanvas().style.cursor=this.props.cursorStyle),this.props.showTileBoundaries&&(this._map.showTileBoundaries=this.props.showTileBoundaries)}componentDidUpdate(h){this._updateMapViewport(h,this.props),this._updateMapStyle(h,this.props),this._updateMapSize(h,this.props),this._updateMapEventListeners(h,this.props),!h.cursorStyle!==this.props.cursorStyle&&(this._map.getCanvas().style.cursor=this.props.cursorStyle),h.showTileBoundaries!==this.props.showTileBoundaries&&(this._map.showTileBoundaries=!!this.props.showTileBoundaries)}componentWillUnmount(){this._map&&this._map.remove()}getMap(){return this._map}_updateMapEventListeners(h,y){z_.forEach((w=>{const k=`on${B_(w)}`,A=h[k],I=y[k];Array.isArray(A)&&Array.isArray(I)&&c0(A,I)||A===I||(A&&(Array.isArray(A)?this._map.off(w,...A):this._map.off(w,A)),I&&(Array.isArray(I)?this._map.on(w,...I):this._map.on(w,I)))}))}_updateMapStyle(h,y){const w=y.mapStyle,k=h.mapStyle;w!==k&&this.setState({loaded:!1},(()=>{this._map.setStyle(w),this._map.once("style.load",(()=>this.setState({loaded:!0})))}))}_updateMapViewport(h,y){const w=this._map,k=w.getCenter();if(!(y.latitude!==h.latitude&&y.latitude!==k.lat||y.longitude!==h.longitude&&y.longitude!==k.lng||y.zoom!==h.zoom&&y.zoom!==w.getZoom()||y.pitch!==h.pitch&&y.pitch!==w.getPitch()||y.bearing!==h.bearing&&y.bearing!==w.getBearing()))return;const A={center:[y.longitude,y.latitude],zoom:y.zoom,pitch:y.pitch,bearing:y.bearing},{viewportChangeMethod:I,viewportChangeOptions:B}=this.props,i={...B,...A};switch(I){case"flyTo":w.flyTo(i);break;case"jumpTo":w.jumpTo(i);break;case"easeTo":w.easeTo(i);break;default:throw new Error("Unknown viewport change method")}}_updateMapSize(h,y){((h.style&&h.style.height)!==(y.style&&y.style.height)||(h.style&&h.style.width)!==(y.style&&y.style.width))&&this._map.resize()}render(){const{loaded:h}=this.state,{className:y,style:w}=this.props,k=this.props.children?oE(this.props.children):null;return H.createElement(Ys.Provider,{value:this._map},H.createElement("div",{ref:this._container,style:w,className:y},h&&k))}}Or(Nf,"displayName","MapGL"),Or(Nf,"defaultProps",{children:null,className:null,style:null,mapStyle:"mapbox://styles/mapbox/light-v8",accessToken:null,bearing:0,pitch:0,minZoom:0,maxZoom:22,maxBounds:null,bounds:null,hash:!1,bearingSnap:7,pitchWithRotate:!0,attributionControl:!0,logoPosition:"bottom-left",failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,antialias:!1,refreshExpiredTiles:!0,boxZoom:!0,scrollZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,trackResize:!0,renderWorldCopies:!0,maxTileCacheSize:null,onViewportChange:null,onLoad:null,localIdeographFontFamily:null,transformRequest:null,collectResourceTiming:!1,fadeDuration:300,crossSourceCollisions:!0,locale:null,cursorStyle:null,viewportChangeMethod:"jumpTo",viewportChangeOptions:null});var oy=u=>{switch(u.type){case"vector":return{type:"vector",...u};case"raster":return{type:"raster",...u};case"raster-dem":return{type:"raster-dem",...u};case"geojson":return{type:"geojson",...u};case"video":return{type:"video",...u};case"image":return{type:"image",...u};default:throw new Error(`Unknown type for '${u.id}' Source`)}};class Jh extends H.PureComponent{constructor(...h){super(...h),Or(this,"state",{loaded:!1}),Or(this,"_onSourceData",(()=>{this._map.isSourceLoaded(this.props.id)&&(this._map.off("sourcedata",this._onSourceData),this.setState({loaded:!0}))})),Or(this,"_updateGeoJSONSource",((y,w,k)=>{if(k.data!==w.data){const A=this._map.getSource(y);A!==void 0&&A.setData(k.data)}})),Or(this,"_updateImageSource",((y,w,k)=>{if(k.url!==w.url||k.coordinates!==w.coordinates){const A=this._map.getSource(y);A!==void 0&&A.updateImage(k)}})),Or(this,"_updateTileSource",((y,w,k)=>{if(k.url===w.url&&c0(k.tiles,w.tiles))return;const A=this._map.getSource(y);A._tileJSONRequest&&A._tileJSONRequest.cancel(),A.url=k.url,A.scheme=k.scheme,A._options={...A._options,...k};const I=this._map.style.sourceCaches[y];I&&I.clearTiles(),A.load()})),Or(this,"_removeSource",(()=>{const{id:y}=this.props;if(this._map.getSource(y)){const{layers:w}=this._map.getStyle();w&&w.forEach((k=>{k.source===y&&this._map.removeLayer(k.id)})),this._map.removeSource(y)}}))}componentDidMount(){const{id:h,children:y,...w}=this.props,k=oy(w);this._map.addSource(h,k),this._map.on("sourcedata",this._onSourceData)}componentDidUpdate(h){const{id:y,children:w,...k}=h,A=oy(k),{id:I,children:B,...i}=this.props,R=oy(i);if(I!==y||R.type!==A.type)return this._map.removeSource(y),void this._map.addSource(I,R);R.type!=="geojson"||A.type!=="geojson"?R.type!=="image"||A.type!=="image"?R.type!=="vector"||A.type!=="vector"?R.type==="raster"&&A.type==="raster"&&this._updateTileSource(I,A,R):this._updateTileSource(I,A,R):this._updateImageSource(I,A,R):this._updateGeoJSONSource(I,A,R)}componentWillUnmount(){this._map&&this._map.getStyle()&&this._removeSource()}render(){const{loaded:h}=this.state,{children:y}=this.props;return H.createElement(Ys.Consumer,{},(w=>(w&&(this._map=w),h&&y)))}}Or(Jh,"displayName","Source");class O_ extends H.PureComponent{constructor(h){super(h),this._el=document.createElement("div")}componentDidMount(){const{longitude:h,latitude:y,offset:w,closeButton:k,closeOnClick:A,onClose:I,anchor:B,className:i,maxWidth:R}=this.props;this._popup=new qo.Popup({offset:w,closeButton:k,closeOnClick:A,anchor:B,className:i,maxWidth:R}),this._popup.setDOMContent(this._el),this._popup.setLngLat([h,y]).addTo(this._map),I&&this._popup.on("close",I)}componentDidUpdate(h){(h.latitude!==this.props.latitude||h.longitude!==this.props.longitude)&&this._popup.setLngLat([this.props.longitude,this.props.latitude])}componentWillUnmount(){this._map&&this._map.getStyle()&&this._popup.remove()}getPopup(){return this._popup}render(){return H.createElement(Ys.Consumer,{},(h=>(h&&(this._map=h),T1.createPortal(this.props.children,this._el))))}}Or(O_,"displayName","Popup"),Or(O_,"defaultProps",{closeButton:!0,closeOnClick:!0,onClose:void 0,anchor:void 0,offset:void 0,className:void 0,maxWidth:"240px"});class Zo extends H.PureComponent{constructor(h){super(h),Or(this,"_onDragEnd",(()=>{this.props.onDragEnd(this._marker.getLngLat())})),Or(this,"_onDragStart",(()=>{this.props.onDragStart(this._marker.getLngLat())})),Or(this,"_onDrag",(()=>{this.props.onDrag(this._marker.getLngLat())})),this._el=document.createElement("div")}componentDidMount(){const{longitude:h,latitude:y,onClick:w,onDragEnd:k,onDragStart:A,onDrag:I}=this.props;this._marker=new qo.Marker({element:this._el,anchor:this.props.anchor,draggable:this.props.draggable,offset:this.props.offset,rotation:this.props.rotation,pitchAlignment:this.props.pitchAlignment,rotationAlignment:this.props.rotationAlignment}),this._marker.setLngLat([h,y]).addTo(this._map),w&&this._el.addEventListener("click",w),k&&this._marker.on("dragend",this._onDragEnd),A&&this._marker.on("dragstart",this._onDragStart),I&&this._marker.on("drag",this._onDrag)}componentDidUpdate(h){(h.latitude!==this.props.latitude||h.longitude!==this.props.longitude)&&this._marker.setLngLat([this.props.longitude,this.props.latitude])}componentWillUnmount(){this._map&&this._map.getStyle()&&(this.props.onClick&&this._el.removeEventListener("click",this.props.onClick),this._marker.remove())}getMarker(){return this._marker}render(){return H.createElement(Ys.Consumer,{},(h=>(h&&(this._map=h),T1.createPortal(this.props.children,this._el))))}}Or(Zo,"displayName","Marker"),Or(Zo,"defaultProps",{anchor:"center",offset:null,draggable:!1,rotation:0,pitchAlignment:"auto",rotationAlignment:"auto"});class lE extends H.PureComponent{constructor(h){super(h),Or(this,"_loadImage",((y,w)=>{typeof y!="string"?w(y):this._map.loadImage(y,((k,A)=>{if(k)throw k;w(A)}))})),this._id=h.id}componentDidMount(){const{image:h,pixelRatio:y,sdf:w}=this.props;this._loadImage(h,(k=>this._map.addImage(this._id,k,{pixelRatio:y,sdf:w})))}componentDidUpdate(h){const{id:y,image:w,pixelRatio:k,sdf:A}=this.props;if(y!==h.id||A!==h.sdf||k!==h.pixelRatio)return this._id=y,this._map.removeImage(h.id),void this._loadImage(w,(I=>this._map.addImage(this._id,I,{pixelRatio:k,sdf:A})));w!==h.image&&this._loadImage(w,(I=>this._map.updateImage(this._id,I)))}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.hasImage(this._id)&&this._map.removeImage(this._id)}render(){return H.createElement(Ys.Consumer,{},(h=>(h&&(this._map=h),null)))}}Or(lE,"defaultProps",{pixelRatio:1,sdf:!1});class cE extends H.PureComponent{componentDidMount(){const h=this._map,{compact:y,customAttribution:w,position:k}=this.props,A=new qo.AttributionControl({compact:y,customAttribution:w});h.addControl(A,k),this._control=A}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.removeControl(this._control)}getControl(){return this._control}render(){return H.createElement(Ys.Consumer,{},(h=>(h&&(this._map=h),null)))}}Or(cE,"defaultProps",{position:"bottom-right"});class uE extends H.PureComponent{componentDidMount(){const h=this._map,{container:y,position:w}=this.props,k=new qo.FullscreenControl({container:y});h.addControl(k,w),this._control=k}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.removeControl(this._control)}getControl(){return this._control}render(){return H.createElement(Ys.Consumer,{},(h=>(h&&(this._map=h),null)))}}Or(uE,"defaultProps",{position:"top-right"});class hE extends H.PureComponent{componentDidMount(){const h=this._map,{positionOptions:y,fitBoundsOptions:w,trackUserLocation:k,showUserLocation:A,position:I,onTrackUserLocationEnd:B,onTrackUserLocationStart:i,onError:R,onGeolocate:$}=this.props,K=new qo.GeolocateControl({positionOptions:y,fitBoundsOptions:w,trackUserLocation:k,showUserLocation:A});B&&K.on("trackuserlocationend",B),i&&K.on("trackuserlocationstart",i),R&&K.on("error",R),$&&K.on("geolocate",$),h.addControl(K,I),this._control=K}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.removeControl(this._control)}getControl(){return this._control}render(){return H.createElement(Ys.Consumer,{},(h=>(h&&(this._map=h),null)))}}Or(hE,"defaultProps",{positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0});class dE extends H.PureComponent{componentDidMount(){const h=this._map,{showCompass:y,showZoom:w,visualizePitch:k,position:A}=this.props,I=new qo.NavigationControl({showCompass:y,showZoom:w,visualizePitch:k});h.addControl(I,A),this._control=I}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.removeControl(this._control)}getControl(){return this._control}render(){return H.createElement(Ys.Consumer,{},(h=>(h&&(this._map=h),null)))}}Or(dE,"defaultProps",{showCompass:!0,showZoom:!0,visualizePitch:!1,position:"top-right"});class pE extends H.PureComponent{componentDidMount(){const h=this._map,{maxWidth:y,unit:w,position:k}=this.props,A=new qo.ScaleControl({maxWidth:y,unit:w});h.addControl(A,k),this._control=A}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.removeControl(this._control)}getControl(){return this._control}render(){return H.createElement(Ys.Consumer,{},(h=>(h&&(this._map=h),null)))}}Or(pE,"defaultProps",{position:"bottom-right",unit:"metric"});var B1={exports:{}};(function(u){function h(w){if(w=Object.assign({},w),!(this instanceof h))throw new Error("MapboxLanguage needs to be called with the new keyword");this.setLanguage=this.setLanguage.bind(this),this._initialStyleUpdate=this._initialStyleUpdate.bind(this),this._defaultLanguage=w.defaultLanguage,this._isLanguageField=w.languageField||/^\{name/,this._getLanguageField=w.getLanguageField||function(k){return k==="mul"?"{name}":"{name_"+k+"}"},this._languageSource=w.languageSource||null,this._languageTransform=w.languageTransform||function(k,A){return A==="ar"?(function(I){var B=I.layers.map((function(i){if(!(i.layout||{})["text-field"])return i;var R=0;return Object.assign({},i,{layout:Object.assign({},i.layout,{"text-letter-spacing":R})})}));return Object.assign({},I,{layers:B})})(k):(function(I){var B=I.layers.map((function(i){if(!(i.layout||{})["text-field"])return i;var R=0;return i["source-layer"]==="state_label"&&(R=.15),i["source-layer"]==="marine_label"&&(/-lg/.test(i.id)&&(R=.25),/-md/.test(i.id)&&(R=.15),/-sm/.test(i.id)&&(R=.1)),i["source-layer"]==="place_label"&&(/-suburb/.test(i.id)&&(R=.15),/-neighbour/.test(i.id)&&(R=.1),/-islet/.test(i.id)&&(R=.01)),i["source-layer"]==="airport_label"&&(R=.01),i["source-layer"]==="rail_station_label"&&(R=.01),i["source-layer"]==="poi_label"&&/-scalerank/.test(i.id)&&(R=.01),i["source-layer"]==="road_label"&&(/-label-/.test(i.id)&&(R=.01),/-shields/.test(i.id)&&(R=.05)),Object.assign({},i,{layout:Object.assign({},i.layout,{"text-letter-spacing":R})})}));return Object.assign({},I,{layers:B})})(k)},this._excludedLayerIds=w.excludedLayerIds||[],this.supportedLanguages=w.supportedLanguages||["ar","en","es","fr","de","ja","ko","mul","pt","ru","zh"]}function y(w,k,A){if((function(B,i){return typeof i=="string"&&B.test(i)})(w,k))return A;if((function(B,i){return i.stops&&i.stops.filter((function(R){return B.test(R[1])})).length>0})(w,k)){var I=k.stops.map((function(B){return w.test(B[1])?[B[0],A]:B}));return Object.assign({},k,{stops:I})}return k}h.prototype.setLanguage=function(w,k){if(this.supportedLanguages.indexOf(k)<0)throw new Error("Language "+k+" is not supported");var A=this._languageSource||(function(K){return Object.keys(K.sources).filter((function(Z){var he=K.sources[Z];return/mapbox-streets-v\d/.test(he.url)}))[0]})(w);if(!A)return w;var I=this._getLanguageField(k),B=this._isLanguageField,i=this._excludedLayerIds,R=w.layers.map((function(K){return K.source===A?(function(Z,he,Te,ye){return he.layout&&he.layout["text-field"]&&ye.indexOf(he.id)===-1?Object.assign({},he,{layout:Object.assign({},he.layout,{"text-field":y(Z,he.layout["text-field"],Te)})}):he})(B,K,I,i):K})),$=Object.assign({},w,{layers:R});return this._languageTransform($,k)},h.prototype._initialStyleUpdate=function(){var w=this._map.getStyle(),k=this._defaultLanguage||(function(A){var I=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,B=I.split("-"),i=I;return B.length>1&&(i=B[0]),A.indexOf(i)>-1?i:null})(this.supportedLanguages);this._map.off("styledata",this._initialStyleUpdate),this._map.setStyle(this.setLanguage(w,k))},h.prototype.onAdd=function(w){return this._map=w,this._map.on("styledata",this._initialStyleUpdate),this._container=document.createElement("div"),this._container},h.prototype.onRemove=function(){this._map.off("styledata",this._initialStyleUpdate),this._map=void 0},u.exports=h})(B1);var fE=B1.exports;class mE extends H.PureComponent{constructor(...h){super(...h),Or(this,"_setLanguage",(()=>{const{language:y}=this.props,w=this._map,k=this._control;y&&w.setStyle(k.setLanguage(w.getStyle(),y))}))}componentDidMount(){const h=this._map,{supportedLanguages:y,languageTransform:w,languageField:k,getLanguageField:A,languageSource:I,defaultLanguage:B}=this.props,i=new fE({supportedLanguages:y,languageTransform:w,languageField:k,getLanguageField:A,languageSource:I,defaultLanguage:B});h.addControl(i),this._control=i}componentDidUpdate(h){h.language!==this.props.language&&this._setLanguage()}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.removeControl(this._control)}getControl(){return this._control}render(){return H.createElement(Ys.Consumer,{},(h=>(h&&(this._map=h),null)))}}Or(mE,"defaultProps",{});var F1={exports:{}};(function(u){var h=[{id:"traffic-street-link-bg",type:"line",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},source:"mapbox://mapbox.mapbox-traffic-v1","source-layer":"traffic",minzoom:15,filter:["all",["==","$type","LineString"],["all",["has","congestion"],["in","class","link","motorway_link","service","street"]]],layout:{visibility:"visible","line-join":"round","line-cap":"round"},paint:{"line-width":{base:1.5,stops:[[14,2.5],[20,15.5]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(145, 95%, 30%)"],["moderate","hsl(30, 100%, 42%)"],["heavy","hsl(355, 100%, 37%)"],["severe","hsl(355, 70%, 22%)"]]},"line-offset":{base:1.5,stops:[[14,2],[20,18]]},"line-opacity":{base:1,stops:[[15,0],[16,1]]}}},{id:"traffic-secondary-tertiary-bg",type:"line",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},source:"mapbox://mapbox.mapbox-traffic-v1","source-layer":"traffic",minzoom:6,filter:["all",["==","$type","LineString"],["all",["has","congestion"],["in","class","secondary","tertiary"]]],layout:{visibility:"visible","line-join":"round","line-cap":"round"},paint:{"line-width":{base:1.5,stops:[[9,1.5],[18,11],[20,16.5]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(145, 95%, 30%)"],["moderate","hsl(30, 100%, 42%)"],["heavy","hsl(355, 100%, 37%)"],["severe","hsl(355, 70%, 22%)"]]},"line-offset":{base:1.5,stops:[[10,.5],[15,5],[18,11],[20,14.5]]},"line-opacity":{base:1,stops:[[13,0],[14,1]]}}},{id:"traffic-primary-bg",type:"line",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},source:"mapbox://mapbox.mapbox-traffic-v1","source-layer":"traffic",minzoom:6,filter:["all",["==","$type","LineString"],["all",["==","class","primary"],["has","congestion"]]],layout:{visibility:"visible","line-join":"round","line-cap":"round"},paint:{"line-width":{base:1.5,stops:[[10,.75],[15,6],[20,18]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(145, 95%, 30%)"],["moderate","hsl(30, 100%, 42%)"],["heavy","hsl(355, 100%, 37%)"],["severe","hsl(355, 70%, 22%)"]]},"line-offset":{base:1.2,stops:[[10,0],[12,1.5],[18,13],[20,16]]},"line-opacity":{base:1,stops:[[11,0],[12,1]]}}},{id:"traffic-trunk-bg",type:"line",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},source:"mapbox://mapbox.mapbox-traffic-v1","source-layer":"traffic",minzoom:6,filter:["all",["==","$type","LineString"],["all",["==","class","trunk"],["has","congestion"]]],layout:{visibility:"visible","line-join":"round","line-cap":"round"},paint:{"line-width":{base:1.5,stops:[[8,.5],[9,2.25],[18,13],[20,17.5]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(145, 95%, 30%)"],["moderate","hsl(30, 100%, 42%)"],["heavy","hsl(355, 100%, 37%)"],["severe","hsl(355, 70%, 22%)"]]},"line-offset":{base:1.5,stops:[[7,0],[9,1],[18,13],[20,18]]},"line-opacity":1}},{id:"traffic-motorway-bg",type:"line",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},source:"mapbox://mapbox.mapbox-traffic-v1","source-layer":"traffic",minzoom:6,filter:["all",["==","$type","LineString"],["all",["==","class","motorway"],["has","congestion"]]],layout:{visibility:"visible","line-join":"round","line-cap":"round"},paint:{"line-width":{base:1.5,stops:[[6,.5],[9,3],[18,16],[20,20]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(145, 95%, 30%)"],["moderate","hsl(30, 100%, 42%)"],["heavy","hsl(355, 100%, 37%)"],["severe","hsl(355, 70%, 22%)"]]},"line-opacity":1,"line-offset":{base:1.5,stops:[[7,0],[9,1.2],[11,1.2],[18,10],[20,15.5]]}}},{id:"traffic-primary",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},ref:"traffic-primary-bg",paint:{"line-width":{base:1.5,stops:[[10,1],[15,4],[20,16]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(142, 55%, 50%)"],["moderate","hsl(30, 100%, 55%)"],["heavy","hsl(355, 100%, 50%)"],["severe","hsl(355, 70%, 35%)"]]},"line-offset":{base:1.2,stops:[[10,0],[12,1.5],[18,13],[20,16]]},"line-opacity":1}},{id:"traffic-secondary-tertiary",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},ref:"traffic-secondary-tertiary-bg",paint:{"line-width":{base:1.5,stops:[[9,.5],[18,9],[20,14]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(142, 55%, 50%)"],["moderate","hsl(30, 100%, 55%)"],["heavy","hsl(355, 100%, 50%)"],["severe","hsl(355, 70%, 35%)"]]},"line-offset":{base:1.5,stops:[[10,.5],[15,5],[18,11],[20,14.5]]},"line-opacity":1}},{id:"traffic-street-link",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},ref:"traffic-street-link-bg",paint:{"line-width":{base:1.5,stops:[[14,1.5],[20,13.5]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(142, 55%, 50%)"],["moderate","hsl(30, 100%, 55%)"],["heavy","hsl(355, 100%, 50%)"],["severe","hsl(355, 70%, 35%)"]]},"line-offset":{base:1.5,stops:[[14,2],[20,18]]},"line-opacity":1}},{id:"traffic-trunk",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},ref:"traffic-trunk-bg",paint:{"line-width":{base:1.5,stops:[[8,.75],[18,11],[20,15]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(142, 55%, 50%)"],["moderate","hsl(30, 100%, 55%)"],["heavy","hsl(355, 100%, 50%)"],["severe","hsl(355, 70%, 35%)"]]},"line-offset":{base:1.5,stops:[[7,0],[9,1],[18,13],[20,18]]},"line-opacity":1}},{id:"traffic-motorway",metadata:{"mapbox:group":"4053de47c16e55481b10fd748eaa994c"},ref:"traffic-motorway-bg",paint:{"line-width":{base:1.5,stops:[[6,.5],[9,1.5],[18,14],[20,18]]},"line-color":{base:1,type:"categorical",property:"congestion",stops:[["low","hsl(142, 55%, 50%)"],["moderate","hsl(30, 100%, 55%)"],["heavy","hsl(355, 100%, 50%)"],["severe","hsl(355, 70%, 35%)"]]},"line-opacity":1,"line-offset":{base:1.5,stops:[[7,0],[9,1.2],[11,1.2],[18,10],[20,15.5]]}}}];function y(k){if(!(this instanceof y))throw new Error("MapboxTraffic needs to be called with the new keyword");this.options=Object.assign({showTraffic:!1,showTrafficButton:!0,trafficSource:/mapbox-traffic-v\d/},k),this.render=this.render.bind(this),this.toggleTraffic=this.toggleTraffic.bind(this),this._hideTraffic=this._hideTraffic.bind(this),this._showTraffic=this._showTraffic.bind(this),this._hasTraffic=this._hasTraffic.bind(this),this._toggle=new w({show:this.options.showTrafficButton,onToggle:this.toggleTraffic.bind(this)})}function w(k){var A;k=Object.assign({show:!0,onToggle:function(){}},k),this._btn=((A=document.createElement("button")).className="mapboxgl-ctrl-icon mapboxgl-ctrl-traffic",A.type="button",A["aria-label"]="Inspect",A),this._btn.onclick=k.onToggle,this.elem=(function(I,B){var i=document.createElement("div");return i.className="mapboxgl-ctrl mapboxgl-ctrl-group",i.appendChild(I),B||(i.style.display="none"),i})(this._btn,k.show)}y.prototype._hasTraffic=function(){var k=this._map.getStyle(),A=this.options.trafficSource;return Object.keys(k.sources).filter((function(I){return A.test(I)})).length>0},y.prototype.toggleTraffic=function(){this.options.showTraffic=!this.options.showTraffic,this.render()},y.prototype.render=function(){if(!this._hasTraffic()){this._map.addSource("mapbox://mapbox.mapbox-traffic-v1",{type:"vector",url:"mapbox://mapbox.mapbox-traffic-v1"});var k=this._map.getStyle().layers.filter((function(B){return B["source-layer"]==="road"})),A=k[k.length-1].id,I=(function(B,i,R){for(var $=0;$<B.layers.length;$++)if(R===B.layers[$].id){var K=B.layers.slice(0,$).concat(i).concat(B.layers.slice($));return Object.assign({},B,{layers:K})}return B})(this._map.getStyle(),h,A);this._map.setStyle(I)}this.options.showTraffic?(this._showTraffic(),this._toggle.setMapIcon()):(this._hideTraffic(),this._toggle.setTrafficIcon())},y.prototype._hideTraffic=function(){var k=this._map.getStyle(),A=this.options.trafficSource;k.layers.forEach((function(I){A.test(I.source)&&(I.layout=I.layout||{},I.layout.visibility="none")})),this._map.setStyle(k)},y.prototype._showTraffic=function(){var k=this._map.getStyle(),A=this.options.trafficSource;k.layers.forEach((function(I){A.test(I.source)&&(I.layout=I.layout||{},I.layout.visibility="visible")})),this._map.setStyle(k)},y.prototype.onAdd=function(k){return this._map=k,k.on("load",this.render),this._toggle.elem},y.prototype.onRemove=function(){this._map.off("load",this.render);var k=this._toggle.elem;k.parentNode.removeChild(k),this._map=void 0},w.prototype.setTrafficIcon=function(){this._btn.className="mapboxgl-ctrl-icon mapboxgl-ctrl-traffic"},w.prototype.setMapIcon=function(){this._btn.className="mapboxgl-ctrl-icon mapboxgl-ctrl-map"},u.exports=y})(F1);var gE=F1.exports;class yE extends H.PureComponent{constructor(...h){super(...h),Or(this,"_addControl",(()=>{const{showTraffic:y,showTrafficButton:w,trafficSource:k}=this.props,A=new gE({showTraffic:y,showTrafficButton:w,trafficSource:k});this._map.addControl(A),this._control=A}))}componentDidMount(){this._addControl()}componentDidUpdate(h){h.showTraffic!==this.props.showTraffic&&this._control.toggleTraffic(),(h.showTrafficButton!==this.props.showTrafficButton||h.trafficSource!==this.props.trafficSource)&&(this._map.removeControl(this._control),this._addControl())}componentWillUnmount(){this._map&&this._map.getStyle()&&this._map.removeControl(this._control)}getControl(){return this._control}render(){return H.createElement(Ys.Consumer,{},(h=>(h&&(this._map=h),null)))}}Or(yE,"defaultProps",{showTraffic:!1,showTrafficButton:!0,trafficSource:/mapbox-traffic-v\d/});class xE extends H.PureComponent{componentDidMount(){this._setFilter()}componentDidUpdate(h){const y=h.filter,w=h.validate,{filter:k,validate:A}=this.props;(!c0(y,k)||w!==A)&&this._setFilter()}componentWillUnmount(){if(!this._map||!this._map.getStyle())return;const{layerId:h}=this.props;this._map.getLayer(h)!==void 0&&this._map.setFilter(h,void 0)}_setFilter(){const{layerId:h,filter:y,validate:w}=this.props;this._map.getLayer(h)!==void 0&&(Array.isArray(y)?this._map.setFilter(h,y,{validate:w}):this._map.setFilter(h,void 0))}render(){return H.createElement(Ys.Consumer,{},(h=>(h&&(this._map=h),null)))}}Or(xE,"defaultProps",{validate:!0});const u0=H.createContext({});function h0(u){const h=H.useRef(null);return h.current===null&&(h.current=u()),h.current}const d0=typeof window<"u",O1=d0?H.useLayoutEffect:H.useEffect,og=H.createContext(null);function p0(u,h){u.indexOf(h)===-1&&u.push(h)}function f0(u,h){const y=u.indexOf(h);y>-1&&u.splice(y,1)}const Vc=(u,h,y)=>y>h?h:y<u?u:y;let m0=()=>{};const $c={},U1=u=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(u);function V1(u){return typeof u=="object"&&u!==null}const $1=u=>/^0[^.\s]+$/u.test(u);function g0(u){let h;return()=>(h===void 0&&(h=u()),h)}const mo=u=>u,_E=(u,h)=>y=>h(u(y)),$f=(...u)=>u.reduce(_E),Df=(u,h,y)=>{const w=h-u;return w===0?1:(y-u)/w};class y0{constructor(){this.subscriptions=[]}add(h){return p0(this.subscriptions,h),()=>f0(this.subscriptions,h)}notify(h,y,w){const k=this.subscriptions.length;if(k)if(k===1)this.subscriptions[0](h,y,w);else for(let A=0;A<k;A++){const I=this.subscriptions[A];I&&I(h,y,w)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const $l=u=>u*1e3,Gl=u=>u/1e3;function G1(u,h){return h?u*(1e3/h):0}const W1=(u,h,y)=>(((1-3*y+3*h)*u+(3*y-6*h))*u+3*h)*u,vE=1e-7,bE=12;function wE(u,h,y,w,k){let A,I,B=0;do I=h+(y-h)/2,A=W1(I,w,k)-u,A>0?y=I:h=I;while(Math.abs(A)>vE&&++B<bE);return I}function Gf(u,h,y,w){if(u===h&&y===w)return mo;const k=A=>wE(A,0,1,u,y);return A=>A===0||A===1?A:W1(k(A),h,w)}const q1=u=>h=>h<=.5?u(2*h)/2:(2-u(2*(1-h)))/2,Z1=u=>h=>1-u(1-h),H1=Gf(.33,1.53,.69,.99),x0=Z1(H1),X1=q1(x0),K1=u=>(u*=2)<1?.5*x0(u):.5*(2-Math.pow(2,-10*(u-1))),_0=u=>1-Math.sin(Math.acos(u)),Y1=Z1(_0),J1=q1(_0),TE=Gf(.42,0,1,1),kE=Gf(0,0,.58,1),Q1=Gf(.42,0,.58,1),SE=u=>Array.isArray(u)&&typeof u[0]!="number",eb=u=>Array.isArray(u)&&typeof u[0]=="number",EE={linear:mo,easeIn:TE,easeInOut:Q1,easeOut:kE,circIn:_0,circInOut:J1,circOut:Y1,backIn:x0,backInOut:X1,backOut:H1,anticipate:K1},CE=u=>typeof u=="string",U_=u=>{if(eb(u)){m0(u.length===4);const[h,y,w,k]=u;return Gf(h,y,w,k)}else if(CE(u))return EE[u];return u},zm=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function ME(u,h){let y=new Set,w=new Set,k=!1,A=!1;const I=new WeakSet;let B={delta:0,timestamp:0,isProcessing:!1};function i($){I.has($)&&(R.schedule($),u()),$(B)}const R={schedule:($,K=!1,Z=!1)=>{const Te=Z&&k?y:w;return K&&I.add($),Te.has($)||Te.add($),$},cancel:$=>{w.delete($),I.delete($)},process:$=>{if(B=$,k){A=!0;return}k=!0,[y,w]=[w,y],y.forEach(i),y.clear(),k=!1,A&&(A=!1,R.process($))}};return R}const AE=40;function tb(u,h){let y=!1,w=!0;const k={delta:0,timestamp:0,isProcessing:!1},A=()=>y=!0,I=zm.reduce((Qe,dt)=>(Qe[dt]=ME(A),Qe),{}),{setup:B,read:i,resolveKeyframes:R,preUpdate:$,update:K,preRender:Z,render:he,postRender:Te}=I,ye=()=>{const Qe=$c.useManualTiming?k.timestamp:performance.now();y=!1,$c.useManualTiming||(k.delta=w?1e3/60:Math.max(Math.min(Qe-k.timestamp,AE),1)),k.timestamp=Qe,k.isProcessing=!0,B.process(k),i.process(k),R.process(k),$.process(k),K.process(k),Z.process(k),he.process(k),Te.process(k),k.isProcessing=!1,y&&h&&(w=!1,u(ye))},Me=()=>{y=!0,w=!0,k.isProcessing||u(ye)};return{schedule:zm.reduce((Qe,dt)=>{const St=I[dt];return Qe[dt]=(ce,$e=!1,Ge=!1)=>(y||Me(),St.schedule(ce,$e,Ge)),Qe},{}),cancel:Qe=>{for(let dt=0;dt<zm.length;dt++)I[zm[dt]].cancel(Qe)},state:k,steps:I}}const{schedule:Qn,cancel:Bu,state:ms,steps:ly}=tb(typeof requestAnimationFrame<"u"?requestAnimationFrame:mo,!0);let qm;function PE(){qm=void 0}const ga={now:()=>(qm===void 0&&ga.set(ms.isProcessing||$c.useManualTiming?ms.timestamp:performance.now()),qm),set:u=>{qm=u,queueMicrotask(PE)}},rb=u=>h=>typeof h=="string"&&h.startsWith(u),v0=rb("--"),IE=rb("var(--"),b0=u=>IE(u)?jE.test(u.split("/*")[0].trim()):!1,jE=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,vp={test:u=>typeof u=="number",parse:parseFloat,transform:u=>u},Lf={...vp,transform:u=>Vc(0,1,u)},Bm={...vp,default:1},Ef=u=>Math.round(u*1e5)/1e5,w0=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function NE(u){return u==null}const DE=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,T0=(u,h)=>y=>!!(typeof y=="string"&&DE.test(y)&&y.startsWith(u)||h&&!NE(y)&&Object.prototype.hasOwnProperty.call(y,h)),nb=(u,h,y)=>w=>{if(typeof w!="string")return w;const[k,A,I,B]=w.match(w0);return{[u]:parseFloat(k),[h]:parseFloat(A),[y]:parseFloat(I),alpha:B!==void 0?parseFloat(B):1}},LE=u=>Vc(0,255,u),cy={...vp,transform:u=>Math.round(LE(u))},Xh={test:T0("rgb","red"),parse:nb("red","green","blue"),transform:({red:u,green:h,blue:y,alpha:w=1})=>"rgba("+cy.transform(u)+", "+cy.transform(h)+", "+cy.transform(y)+", "+Ef(Lf.transform(w))+")"};function RE(u){let h="",y="",w="",k="";return u.length>5?(h=u.substring(1,3),y=u.substring(3,5),w=u.substring(5,7),k=u.substring(7,9)):(h=u.substring(1,2),y=u.substring(2,3),w=u.substring(3,4),k=u.substring(4,5),h+=h,y+=y,w+=w,k+=k),{red:parseInt(h,16),green:parseInt(y,16),blue:parseInt(w,16),alpha:k?parseInt(k,16)/255:1}}const Ay={test:T0("#"),parse:RE,transform:Xh.transform},Wf=u=>({test:h=>typeof h=="string"&&h.endsWith(u)&&h.split(" ").length===1,parse:parseFloat,transform:h=>`${h}${u}`}),zu=Wf("deg"),Wl=Wf("%"),jr=Wf("px"),zE=Wf("vh"),BE=Wf("vw"),V_={...Wl,parse:u=>Wl.parse(u)/100,transform:u=>Wl.transform(u*100)},np={test:T0("hsl","hue"),parse:nb("hue","saturation","lightness"),transform:({hue:u,saturation:h,lightness:y,alpha:w=1})=>"hsla("+Math.round(u)+", "+Wl.transform(Ef(h))+", "+Wl.transform(Ef(y))+", "+Ef(Lf.transform(w))+")"},Ni={test:u=>Xh.test(u)||Ay.test(u)||np.test(u),parse:u=>Xh.test(u)?Xh.parse(u):np.test(u)?np.parse(u):Ay.parse(u),transform:u=>typeof u=="string"?u:u.hasOwnProperty("red")?Xh.transform(u):np.transform(u),getAnimatableNone:u=>{const h=Ni.parse(u);return h.alpha=0,Ni.transform(h)}},FE=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function OE(u){return isNaN(u)&&typeof u=="string"&&(u.match(w0)?.length||0)+(u.match(FE)?.length||0)>0}const ib="number",sb="color",UE="var",VE="var(",$_="${}",$E=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Rf(u){const h=u.toString(),y=[],w={color:[],number:[],var:[]},k=[];let A=0;const B=h.replace($E,i=>(Ni.test(i)?(w.color.push(A),k.push(sb),y.push(Ni.parse(i))):i.startsWith(VE)?(w.var.push(A),k.push(UE),y.push(i)):(w.number.push(A),k.push(ib),y.push(parseFloat(i))),++A,$_)).split($_);return{values:y,split:B,indexes:w,types:k}}function ab(u){return Rf(u).values}function ob(u){const{split:h,types:y}=Rf(u),w=h.length;return k=>{let A="";for(let I=0;I<w;I++)if(A+=h[I],k[I]!==void 0){const B=y[I];B===ib?A+=Ef(k[I]):B===sb?A+=Ni.transform(k[I]):A+=k[I]}return A}}const GE=u=>typeof u=="number"?0:Ni.test(u)?Ni.getAnimatableNone(u):u;function WE(u){const h=ab(u);return ob(u)(h.map(GE))}const Fu={test:OE,parse:ab,createTransformer:ob,getAnimatableNone:WE};function uy(u,h,y){return y<0&&(y+=1),y>1&&(y-=1),y<1/6?u+(h-u)*6*y:y<1/2?h:y<2/3?u+(h-u)*(2/3-y)*6:u}function qE({hue:u,saturation:h,lightness:y,alpha:w}){u/=360,h/=100,y/=100;let k=0,A=0,I=0;if(!h)k=A=I=y;else{const B=y<.5?y*(1+h):y+h-y*h,i=2*y-B;k=uy(i,B,u+1/3),A=uy(i,B,u),I=uy(i,B,u-1/3)}return{red:Math.round(k*255),green:Math.round(A*255),blue:Math.round(I*255),alpha:w}}function Qm(u,h){return y=>y>0?h:u}const li=(u,h,y)=>u+(h-u)*y,hy=(u,h,y)=>{const w=u*u,k=y*(h*h-w)+w;return k<0?0:Math.sqrt(k)},ZE=[Ay,Xh,np],HE=u=>ZE.find(h=>h.test(u));function G_(u){const h=HE(u);if(!h)return!1;let y=h.parse(u);return h===np&&(y=qE(y)),y}const W_=(u,h)=>{const y=G_(u),w=G_(h);if(!y||!w)return Qm(u,h);const k={...y};return A=>(k.red=hy(y.red,w.red,A),k.green=hy(y.green,w.green,A),k.blue=hy(y.blue,w.blue,A),k.alpha=li(y.alpha,w.alpha,A),Xh.transform(k))},Py=new Set(["none","hidden"]);function XE(u,h){return Py.has(u)?y=>y<=0?u:h:y=>y>=1?h:u}function KE(u,h){return y=>li(u,h,y)}function k0(u){return typeof u=="number"?KE:typeof u=="string"?b0(u)?Qm:Ni.test(u)?W_:QE:Array.isArray(u)?lb:typeof u=="object"?Ni.test(u)?W_:YE:Qm}function lb(u,h){const y=[...u],w=y.length,k=u.map((A,I)=>k0(A)(A,h[I]));return A=>{for(let I=0;I<w;I++)y[I]=k[I](A);return y}}function YE(u,h){const y={...u,...h},w={};for(const k in y)u[k]!==void 0&&h[k]!==void 0&&(w[k]=k0(u[k])(u[k],h[k]));return k=>{for(const A in w)y[A]=w[A](k);return y}}function JE(u,h){const y=[],w={color:0,var:0,number:0};for(let k=0;k<h.values.length;k++){const A=h.types[k],I=u.indexes[A][w[A]],B=u.values[I]??0;y[k]=B,w[A]++}return y}const QE=(u,h)=>{const y=Fu.createTransformer(h),w=Rf(u),k=Rf(h);return w.indexes.var.length===k.indexes.var.length&&w.indexes.color.length===k.indexes.color.length&&w.indexes.number.length>=k.indexes.number.length?Py.has(u)&&!k.values.length||Py.has(h)&&!w.values.length?XE(u,h):$f(lb(JE(w,k),k.values),y):Qm(u,h)};function cb(u,h,y){return typeof u=="number"&&typeof h=="number"&&typeof y=="number"?li(u,h,y):k0(u)(u,h)}const eC=u=>{const h=({timestamp:y})=>u(y);return{start:(y=!0)=>Qn.update(h,y),stop:()=>Bu(h),now:()=>ms.isProcessing?ms.timestamp:ga.now()}},ub=(u,h,y=10)=>{let w="";const k=Math.max(Math.round(h/y),2);for(let A=0;A<k;A++)w+=Math.round(u(A/(k-1))*1e4)/1e4+", ";return`linear(${w.substring(0,w.length-2)})`},eg=2e4;function S0(u){let h=0;const y=50;let w=u.next(h);for(;!w.done&&h<eg;)h+=y,w=u.next(h);return h>=eg?1/0:h}function tC(u,h=100,y){const w=y({...u,keyframes:[0,h]}),k=Math.min(S0(w),eg);return{type:"keyframes",ease:A=>w.next(k*A).value/h,duration:Gl(k)}}const rC=5;function hb(u,h,y){const w=Math.max(h-rC,0);return G1(y-u(w),h-w)}const vi={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},dy=.001;function nC({duration:u=vi.duration,bounce:h=vi.bounce,velocity:y=vi.velocity,mass:w=vi.mass}){let k,A,I=1-h;I=Vc(vi.minDamping,vi.maxDamping,I),u=Vc(vi.minDuration,vi.maxDuration,Gl(u)),I<1?(k=R=>{const $=R*I,K=$*u,Z=$-y,he=Iy(R,I),Te=Math.exp(-K);return dy-Z/he*Te},A=R=>{const K=R*I*u,Z=K*y+y,he=Math.pow(I,2)*Math.pow(R,2)*u,Te=Math.exp(-K),ye=Iy(Math.pow(R,2),I);return(-k(R)+dy>0?-1:1)*((Z-he)*Te)/ye}):(k=R=>{const $=Math.exp(-R*u),K=(R-y)*u+1;return-dy+$*K},A=R=>{const $=Math.exp(-R*u),K=(y-R)*(u*u);return $*K});const B=5/u,i=sC(k,A,B);if(u=$l(u),isNaN(i))return{stiffness:vi.stiffness,damping:vi.damping,duration:u};{const R=Math.pow(i,2)*w;return{stiffness:R,damping:I*2*Math.sqrt(w*R),duration:u}}}const iC=12;function sC(u,h,y){let w=y;for(let k=1;k<iC;k++)w=w-u(w)/h(w);return w}function Iy(u,h){return u*Math.sqrt(1-h*h)}const aC=["duration","bounce"],oC=["stiffness","damping","mass"];function q_(u,h){return h.some(y=>u[y]!==void 0)}function lC(u){let h={velocity:vi.velocity,stiffness:vi.stiffness,damping:vi.damping,mass:vi.mass,isResolvedFromDuration:!1,...u};if(!q_(u,oC)&&q_(u,aC))if(u.visualDuration){const y=u.visualDuration,w=2*Math.PI/(y*1.2),k=w*w,A=2*Vc(.05,1,1-(u.bounce||0))*Math.sqrt(k);h={...h,mass:vi.mass,stiffness:k,damping:A}}else{const y=nC(u);h={...h,...y,mass:vi.mass},h.isResolvedFromDuration=!0}return h}function tg(u=vi.visualDuration,h=vi.bounce){const y=typeof u!="object"?{visualDuration:u,keyframes:[0,1],bounce:h}:u;let{restSpeed:w,restDelta:k}=y;const A=y.keyframes[0],I=y.keyframes[y.keyframes.length-1],B={done:!1,value:A},{stiffness:i,damping:R,mass:$,duration:K,velocity:Z,isResolvedFromDuration:he}=lC({...y,velocity:-Gl(y.velocity||0)}),Te=Z||0,ye=R/(2*Math.sqrt(i*$)),Me=I-A,Le=Gl(Math.sqrt(i/$)),De=Math.abs(Me)<5;w||(w=De?vi.restSpeed.granular:vi.restSpeed.default),k||(k=De?vi.restDelta.granular:vi.restDelta.default);let Qe;if(ye<1){const St=Iy(Le,ye);Qe=ce=>{const $e=Math.exp(-ye*Le*ce);return I-$e*((Te+ye*Le*Me)/St*Math.sin(St*ce)+Me*Math.cos(St*ce))}}else if(ye===1)Qe=St=>I-Math.exp(-Le*St)*(Me+(Te+Le*Me)*St);else{const St=Le*Math.sqrt(ye*ye-1);Qe=ce=>{const $e=Math.exp(-ye*Le*ce),Ge=Math.min(St*ce,300);return I-$e*((Te+ye*Le*Me)*Math.sinh(Ge)+St*Me*Math.cosh(Ge))/St}}const dt={calculatedDuration:he&&K||null,next:St=>{const ce=Qe(St);if(he)B.done=St>=K;else{let $e=St===0?Te:0;ye<1&&($e=St===0?$l(Te):hb(Qe,St,ce));const Ge=Math.abs($e)<=w,Ye=Math.abs(I-ce)<=k;B.done=Ge&&Ye}return B.value=B.done?I:ce,B},toString:()=>{const St=Math.min(S0(dt),eg),ce=ub($e=>dt.next(St*$e).value,St,30);return St+"ms "+ce},toTransition:()=>{}};return dt}tg.applyToOptions=u=>{const h=tC(u,100,tg);return u.ease=h.ease,u.duration=$l(h.duration),u.type="keyframes",u};function jy({keyframes:u,velocity:h=0,power:y=.8,timeConstant:w=325,bounceDamping:k=10,bounceStiffness:A=500,modifyTarget:I,min:B,max:i,restDelta:R=.5,restSpeed:$}){const K=u[0],Z={done:!1,value:K},he=Ge=>B!==void 0&&Ge<B||i!==void 0&&Ge>i,Te=Ge=>B===void 0?i:i===void 0||Math.abs(B-Ge)<Math.abs(i-Ge)?B:i;let ye=y*h;const Me=K+ye,Le=I===void 0?Me:I(Me);Le!==Me&&(ye=Le-K);const De=Ge=>-ye*Math.exp(-Ge/w),Qe=Ge=>Le+De(Ge),dt=Ge=>{const Ye=De(Ge),ge=Qe(Ge);Z.done=Math.abs(Ye)<=R,Z.value=Z.done?Le:ge};let St,ce;const $e=Ge=>{he(Z.value)&&(St=Ge,ce=tg({keyframes:[Z.value,Te(Z.value)],velocity:hb(Qe,Ge,Z.value),damping:k,stiffness:A,restDelta:R,restSpeed:$}))};return $e(0),{calculatedDuration:null,next:Ge=>{let Ye=!1;return!ce&&St===void 0&&(Ye=!0,dt(Ge),$e(Ge)),St!==void 0&&Ge>=St?ce.next(Ge-St):(!Ye&&dt(Ge),Z)}}}function cC(u,h,y){const w=[],k=y||$c.mix||cb,A=u.length-1;for(let I=0;I<A;I++){let B=k(u[I],u[I+1]);if(h){const i=Array.isArray(h)?h[I]||mo:h;B=$f(i,B)}w.push(B)}return w}function uC(u,h,{clamp:y=!0,ease:w,mixer:k}={}){const A=u.length;if(m0(A===h.length),A===1)return()=>h[0];if(A===2&&h[0]===h[1])return()=>h[1];const I=u[0]===u[1];u[0]>u[A-1]&&(u=[...u].reverse(),h=[...h].reverse());const B=cC(h,w,k),i=B.length,R=$=>{if(I&&$<u[0])return h[0];let K=0;if(i>1)for(;K<u.length-2&&!($<u[K+1]);K++);const Z=Df(u[K],u[K+1],$);return B[K](Z)};return y?$=>R(Vc(u[0],u[A-1],$)):R}function hC(u,h){const y=u[u.length-1];for(let w=1;w<=h;w++){const k=Df(0,h,w);u.push(li(y,1,k))}}function dC(u){const h=[0];return hC(h,u.length-1),h}function pC(u,h){return u.map(y=>y*h)}function fC(u,h){return u.map(()=>h||Q1).splice(0,u.length-1)}function Cf({duration:u=300,keyframes:h,times:y,ease:w="easeInOut"}){const k=SE(w)?w.map(U_):U_(w),A={done:!1,value:h[0]},I=pC(y&&y.length===h.length?y:dC(h),u),B=uC(I,h,{ease:Array.isArray(k)?k:fC(h,k)});return{calculatedDuration:u,next:i=>(A.value=B(i),A.done=i>=u,A)}}const mC=u=>u!==null;function E0(u,{repeat:h,repeatType:y="loop"},w,k=1){const A=u.filter(mC),B=k<0||h&&y!=="loop"&&h%2===1?0:A.length-1;return!B||w===void 0?A[B]:w}const gC={decay:jy,inertia:jy,tween:Cf,keyframes:Cf,spring:tg};function db(u){typeof u.type=="string"&&(u.type=gC[u.type])}class C0{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(h=>{this.resolve=h})}notifyFinished(){this.resolve()}then(h,y){return this.finished.then(h,y)}}const yC=u=>u/100;class M0 extends C0{constructor(h){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:y}=this.options;y&&y.updatedAt!==ga.now()&&this.tick(ga.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=h,this.initAnimation(),this.play(),h.autoplay===!1&&this.pause()}initAnimation(){const{options:h}=this;db(h);const{type:y=Cf,repeat:w=0,repeatDelay:k=0,repeatType:A,velocity:I=0}=h;let{keyframes:B}=h;const i=y||Cf;i!==Cf&&typeof B[0]!="number"&&(this.mixKeyframes=$f(yC,cb(B[0],B[1])),B=[0,100]);const R=i({...h,keyframes:B});A==="mirror"&&(this.mirroredGenerator=i({...h,keyframes:[...B].reverse(),velocity:-I})),R.calculatedDuration===null&&(R.calculatedDuration=S0(R));const{calculatedDuration:$}=R;this.calculatedDuration=$,this.resolvedDuration=$+k,this.totalDuration=this.resolvedDuration*(w+1)-k,this.generator=R}updateTime(h){const y=Math.round(h-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=y}tick(h,y=!1){const{generator:w,totalDuration:k,mixKeyframes:A,mirroredGenerator:I,resolvedDuration:B,calculatedDuration:i}=this;if(this.startTime===null)return w.next(0);const{delay:R=0,keyframes:$,repeat:K,repeatType:Z,repeatDelay:he,type:Te,onUpdate:ye,finalKeyframe:Me}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,h):this.speed<0&&(this.startTime=Math.min(h-k/this.speed,this.startTime)),y?this.currentTime=h:this.updateTime(h);const Le=this.currentTime-R*(this.playbackSpeed>=0?1:-1),De=this.playbackSpeed>=0?Le<0:Le>k;this.currentTime=Math.max(Le,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=k);let Qe=this.currentTime,dt=w;if(K){const Ge=Math.min(this.currentTime,k)/B;let Ye=Math.floor(Ge),ge=Ge%1;!ge&&Ge>=1&&(ge=1),ge===1&&Ye--,Ye=Math.min(Ye,K+1),!!(Ye%2)&&(Z==="reverse"?(ge=1-ge,he&&(ge-=he/B)):Z==="mirror"&&(dt=I)),Qe=Vc(0,1,ge)*B}const St=De?{done:!1,value:$[0]}:dt.next(Qe);A&&(St.value=A(St.value));let{done:ce}=St;!De&&i!==null&&(ce=this.playbackSpeed>=0?this.currentTime>=k:this.currentTime<=0);const $e=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ce);return $e&&Te!==jy&&(St.value=E0($,this.options,Me,this.speed)),ye&&ye(St.value),$e&&this.finish(),St}then(h,y){return this.finished.then(h,y)}get duration(){return Gl(this.calculatedDuration)}get time(){return Gl(this.currentTime)}set time(h){h=$l(h),this.currentTime=h,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=h:this.driver&&(this.startTime=this.driver.now()-h/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(h){this.updateTime(ga.now());const y=this.playbackSpeed!==h;this.playbackSpeed=h,y&&(this.time=Gl(this.currentTime))}play(){if(this.isStopped)return;const{driver:h=eC,startTime:y}=this.options;this.driver||(this.driver=h(k=>this.tick(k))),this.options.onPlay?.();const w=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=w):this.holdTime!==null?this.startTime=w-this.holdTime:this.startTime||(this.startTime=y??w),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(ga.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(h){return this.startTime=0,this.tick(h,!0)}attachTimeline(h){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),h.observe(this)}}function xC(u){for(let h=1;h<u.length;h++)u[h]??(u[h]=u[h-1])}const Kh=u=>u*180/Math.PI,Ny=u=>{const h=Kh(Math.atan2(u[1],u[0]));return Dy(h)},_C={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:u=>(Math.abs(u[0])+Math.abs(u[3]))/2,rotate:Ny,rotateZ:Ny,skewX:u=>Kh(Math.atan(u[1])),skewY:u=>Kh(Math.atan(u[2])),skew:u=>(Math.abs(u[1])+Math.abs(u[2]))/2},Dy=u=>(u=u%360,u<0&&(u+=360),u),Z_=Ny,H_=u=>Math.sqrt(u[0]*u[0]+u[1]*u[1]),X_=u=>Math.sqrt(u[4]*u[4]+u[5]*u[5]),vC={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:H_,scaleY:X_,scale:u=>(H_(u)+X_(u))/2,rotateX:u=>Dy(Kh(Math.atan2(u[6],u[5]))),rotateY:u=>Dy(Kh(Math.atan2(-u[2],u[0]))),rotateZ:Z_,rotate:Z_,skewX:u=>Kh(Math.atan(u[4])),skewY:u=>Kh(Math.atan(u[1])),skew:u=>(Math.abs(u[1])+Math.abs(u[4]))/2};function Ly(u){return u.includes("scale")?1:0}function Ry(u,h){if(!u||u==="none")return Ly(h);const y=u.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let w,k;if(y)w=vC,k=y;else{const B=u.match(/^matrix\(([-\d.e\s,]+)\)$/u);w=_C,k=B}if(!k)return Ly(h);const A=w[h],I=k[1].split(",").map(wC);return typeof A=="function"?A(I):I[A]}const bC=(u,h)=>{const{transform:y="none"}=getComputedStyle(u);return Ry(y,h)};function wC(u){return parseFloat(u.trim())}const bp=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],wp=new Set(bp),K_=u=>u===vp||u===jr,TC=new Set(["x","y","z"]),kC=bp.filter(u=>!TC.has(u));function SC(u){const h=[];return kC.forEach(y=>{const w=u.getValue(y);w!==void 0&&(h.push([y,w.get()]),w.set(y.startsWith("scale")?1:0))}),h}const Qh={width:({x:u},{paddingLeft:h="0",paddingRight:y="0"})=>u.max-u.min-parseFloat(h)-parseFloat(y),height:({y:u},{paddingTop:h="0",paddingBottom:y="0"})=>u.max-u.min-parseFloat(h)-parseFloat(y),top:(u,{top:h})=>parseFloat(h),left:(u,{left:h})=>parseFloat(h),bottom:({y:u},{top:h})=>parseFloat(h)+(u.max-u.min),right:({x:u},{left:h})=>parseFloat(h)+(u.max-u.min),x:(u,{transform:h})=>Ry(h,"x"),y:(u,{transform:h})=>Ry(h,"y")};Qh.translateX=Qh.x;Qh.translateY=Qh.y;const ed=new Set;let zy=!1,By=!1,Fy=!1;function pb(){if(By){const u=Array.from(ed).filter(w=>w.needsMeasurement),h=new Set(u.map(w=>w.element)),y=new Map;h.forEach(w=>{const k=SC(w);k.length&&(y.set(w,k),w.render())}),u.forEach(w=>w.measureInitialState()),h.forEach(w=>{w.render();const k=y.get(w);k&&k.forEach(([A,I])=>{w.getValue(A)?.set(I)})}),u.forEach(w=>w.measureEndState()),u.forEach(w=>{w.suspendedScrollY!==void 0&&window.scrollTo(0,w.suspendedScrollY)})}By=!1,zy=!1,ed.forEach(u=>u.complete(Fy)),ed.clear()}function fb(){ed.forEach(u=>{u.readKeyframes(),u.needsMeasurement&&(By=!0)})}function EC(){Fy=!0,fb(),pb(),Fy=!1}class A0{constructor(h,y,w,k,A,I=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...h],this.onComplete=y,this.name=w,this.motionValue=k,this.element=A,this.isAsync=I}scheduleResolve(){this.state="scheduled",this.isAsync?(ed.add(this),zy||(zy=!0,Qn.read(fb),Qn.resolveKeyframes(pb))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:h,name:y,element:w,motionValue:k}=this;if(h[0]===null){const A=k?.get(),I=h[h.length-1];if(A!==void 0)h[0]=A;else if(w&&y){const B=w.readValue(y,I);B!=null&&(h[0]=B)}h[0]===void 0&&(h[0]=I),k&&A===void 0&&k.set(h[0])}xC(h)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(h=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,h),ed.delete(this)}cancel(){this.state==="scheduled"&&(ed.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const CC=u=>u.startsWith("--");function MC(u,h,y){CC(h)?u.style.setProperty(h,y):u.style[h]=y}const AC=g0(()=>window.ScrollTimeline!==void 0),PC={};function IC(u,h){const y=g0(u);return()=>PC[h]??y()}const mb=IC(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Sf=([u,h,y,w])=>`cubic-bezier(${u}, ${h}, ${y}, ${w})`,Y_={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Sf([0,.65,.55,1]),circOut:Sf([.55,0,1,.45]),backIn:Sf([.31,.01,.66,-.59]),backOut:Sf([.33,1.53,.69,.99])};function gb(u,h){if(u)return typeof u=="function"?mb()?ub(u,h):"ease-out":eb(u)?Sf(u):Array.isArray(u)?u.map(y=>gb(y,h)||Y_.easeOut):Y_[u]}function jC(u,h,y,{delay:w=0,duration:k=300,repeat:A=0,repeatType:I="loop",ease:B="easeOut",times:i}={},R=void 0){const $={[h]:y};i&&($.offset=i);const K=gb(B,k);Array.isArray(K)&&($.easing=K);const Z={delay:w,duration:k,easing:Array.isArray(K)?"linear":K,fill:"both",iterations:A+1,direction:I==="reverse"?"alternate":"normal"};return R&&(Z.pseudoElement=R),u.animate($,Z)}function yb(u){return typeof u=="function"&&"applyToOptions"in u}function NC({type:u,...h}){return yb(u)&&mb()?u.applyToOptions(h):(h.duration??(h.duration=300),h.ease??(h.ease="easeOut"),h)}class DC extends C0{constructor(h){if(super(),this.finishedTime=null,this.isStopped=!1,!h)return;const{element:y,name:w,keyframes:k,pseudoElement:A,allowFlatten:I=!1,finalKeyframe:B,onComplete:i}=h;this.isPseudoElement=!!A,this.allowFlatten=I,this.options=h,m0(typeof h.type!="string");const R=NC(h);this.animation=jC(y,w,k,R,A),R.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!A){const $=E0(k,this.options,B,this.speed);this.updateMotionValue?this.updateMotionValue($):MC(y,w,$),this.animation.cancel()}i?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:h}=this;h==="idle"||h==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const h=this.animation.effect?.getComputedTiming?.().duration||0;return Gl(Number(h))}get time(){return Gl(Number(this.animation.currentTime)||0)}set time(h){this.finishedTime=null,this.animation.currentTime=$l(h)}get speed(){return this.animation.playbackRate}set speed(h){h<0&&(this.finishedTime=null),this.animation.playbackRate=h}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(h){this.animation.startTime=h}attachTimeline({timeline:h,observe:y}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,h&&AC()?(this.animation.timeline=h,mo):y(this)}}const xb={anticipate:K1,backInOut:X1,circInOut:J1};function LC(u){return u in xb}function RC(u){typeof u.ease=="string"&&LC(u.ease)&&(u.ease=xb[u.ease])}const J_=10;class zC extends DC{constructor(h){RC(h),db(h),super(h),h.startTime&&(this.startTime=h.startTime),this.options=h}updateMotionValue(h){const{motionValue:y,onUpdate:w,onComplete:k,element:A,...I}=this.options;if(!y)return;if(h!==void 0){y.set(h);return}const B=new M0({...I,autoplay:!1}),i=$l(this.finishedTime??this.time);y.setWithVelocity(B.sample(i-J_).value,B.sample(i).value,J_),B.stop()}}const Q_=(u,h)=>h==="zIndex"?!1:!!(typeof u=="number"||Array.isArray(u)||typeof u=="string"&&(Fu.test(u)||u==="0")&&!u.startsWith("url("));function BC(u){const h=u[0];if(u.length===1)return!0;for(let y=0;y<u.length;y++)if(u[y]!==h)return!0}function FC(u,h,y,w){const k=u[0];if(k===null)return!1;if(h==="display"||h==="visibility")return!0;const A=u[u.length-1],I=Q_(k,h),B=Q_(A,h);return!I||!B?!1:BC(u)||(y==="spring"||yb(y))&&w}function Oy(u){u.duration=0,u.type}const OC=new Set(["opacity","clipPath","filter","transform"]),UC=g0(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function VC(u){const{motionValue:h,name:y,repeatDelay:w,repeatType:k,damping:A,type:I}=u;if(!(h?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:i,transformTemplate:R}=h.owner.getProps();return UC()&&y&&OC.has(y)&&(y!=="transform"||!R)&&!i&&!w&&k!=="mirror"&&A!==0&&I!=="inertia"}const $C=40;class GC extends C0{constructor({autoplay:h=!0,delay:y=0,type:w="keyframes",repeat:k=0,repeatDelay:A=0,repeatType:I="loop",keyframes:B,name:i,motionValue:R,element:$,...K}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=ga.now();const Z={autoplay:h,delay:y,type:w,repeat:k,repeatDelay:A,repeatType:I,name:i,motionValue:R,element:$,...K},he=$?.KeyframeResolver||A0;this.keyframeResolver=new he(B,(Te,ye,Me)=>this.onKeyframesResolved(Te,ye,Z,!Me),i,R,$),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(h,y,w,k){this.keyframeResolver=void 0;const{name:A,type:I,velocity:B,delay:i,isHandoff:R,onUpdate:$}=w;this.resolvedAt=ga.now(),FC(h,A,I,B)||(($c.instantAnimations||!i)&&$?.(E0(h,w,y)),h[0]=h[h.length-1],Oy(w),w.repeat=0);const Z={startTime:k?this.resolvedAt?this.resolvedAt-this.createdAt>$C?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:y,...w,keyframes:h},he=!R&&VC(Z)?new zC({...Z,element:Z.motionValue.owner.current}):new M0(Z);he.finished.then(()=>this.notifyFinished()).catch(mo),this.pendingTimeline&&(this.stopTimeline=he.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=he}get finished(){return this._animation?this.animation.finished:this._finished}then(h,y){return this.finished.finally(h).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),EC()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(h){this.animation.time=h}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(h){this.animation.speed=h}get startTime(){return this.animation.startTime}attachTimeline(h){return this._animation?this.stopTimeline=this.animation.attachTimeline(h):this.pendingTimeline=h,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const WC=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function qC(u){const h=WC.exec(u);if(!h)return[,];const[,y,w,k]=h;return[`--${y??w}`,k]}function _b(u,h,y=1){const[w,k]=qC(u);if(!w)return;const A=window.getComputedStyle(h).getPropertyValue(w);if(A){const I=A.trim();return U1(I)?parseFloat(I):I}return b0(k)?_b(k,h,y+1):k}function P0(u,h){return u?.[h]??u?.default??u}const vb=new Set(["width","height","top","left","right","bottom",...bp]),ZC={test:u=>u==="auto",parse:u=>u},bb=u=>h=>h.test(u),wb=[vp,jr,Wl,zu,BE,zE,ZC],ev=u=>wb.find(bb(u));function HC(u){return typeof u=="number"?u===0:u!==null?u==="none"||u==="0"||$1(u):!0}const XC=new Set(["brightness","contrast","saturate","opacity"]);function KC(u){const[h,y]=u.slice(0,-1).split("(");if(h==="drop-shadow")return u;const[w]=y.match(w0)||[];if(!w)return u;const k=y.replace(w,"");let A=XC.has(h)?1:0;return w!==y&&(A*=100),h+"("+A+k+")"}const YC=/\b([a-z-]*)\(.*?\)/gu,Uy={...Fu,getAnimatableNone:u=>{const h=u.match(YC);return h?h.map(KC).join(" "):u}},tv={...vp,transform:Math.round},JC={rotate:zu,rotateX:zu,rotateY:zu,rotateZ:zu,scale:Bm,scaleX:Bm,scaleY:Bm,scaleZ:Bm,skew:zu,skewX:zu,skewY:zu,distance:jr,translateX:jr,translateY:jr,translateZ:jr,x:jr,y:jr,z:jr,perspective:jr,transformPerspective:jr,opacity:Lf,originX:V_,originY:V_,originZ:jr},I0={borderWidth:jr,borderTopWidth:jr,borderRightWidth:jr,borderBottomWidth:jr,borderLeftWidth:jr,borderRadius:jr,radius:jr,borderTopLeftRadius:jr,borderTopRightRadius:jr,borderBottomRightRadius:jr,borderBottomLeftRadius:jr,width:jr,maxWidth:jr,height:jr,maxHeight:jr,top:jr,right:jr,bottom:jr,left:jr,padding:jr,paddingTop:jr,paddingRight:jr,paddingBottom:jr,paddingLeft:jr,margin:jr,marginTop:jr,marginRight:jr,marginBottom:jr,marginLeft:jr,backgroundPositionX:jr,backgroundPositionY:jr,...JC,zIndex:tv,fillOpacity:Lf,strokeOpacity:Lf,numOctaves:tv},QC={...I0,color:Ni,backgroundColor:Ni,outlineColor:Ni,fill:Ni,stroke:Ni,borderColor:Ni,borderTopColor:Ni,borderRightColor:Ni,borderBottomColor:Ni,borderLeftColor:Ni,filter:Uy,WebkitFilter:Uy},Tb=u=>QC[u];function kb(u,h){let y=Tb(u);return y!==Uy&&(y=Fu),y.getAnimatableNone?y.getAnimatableNone(h):void 0}const e3=new Set(["auto","none","0"]);function t3(u,h,y){let w=0,k;for(;w<u.length&&!k;){const A=u[w];typeof A=="string"&&!e3.has(A)&&Rf(A).values.length&&(k=u[w]),w++}if(k&&y)for(const A of h)u[A]=kb(y,k)}class r3 extends A0{constructor(h,y,w,k,A){super(h,y,w,k,A,!0)}readKeyframes(){const{unresolvedKeyframes:h,element:y,name:w}=this;if(!y||!y.current)return;super.readKeyframes();for(let i=0;i<h.length;i++){let R=h[i];if(typeof R=="string"&&(R=R.trim(),b0(R))){const $=_b(R,y.current);$!==void 0&&(h[i]=$),i===h.length-1&&(this.finalKeyframe=R)}}if(this.resolveNoneKeyframes(),!vb.has(w)||h.length!==2)return;const[k,A]=h,I=ev(k),B=ev(A);if(I!==B)if(K_(I)&&K_(B))for(let i=0;i<h.length;i++){const R=h[i];typeof R=="string"&&(h[i]=parseFloat(R))}else Qh[w]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:h,name:y}=this,w=[];for(let k=0;k<h.length;k++)(h[k]===null||HC(h[k]))&&w.push(k);w.length&&t3(h,w,y)}measureInitialState(){const{element:h,unresolvedKeyframes:y,name:w}=this;if(!h||!h.current)return;w==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Qh[w](h.measureViewportBox(),window.getComputedStyle(h.current)),y[0]=this.measuredOrigin;const k=y[y.length-1];k!==void 0&&h.getValue(w,k).jump(k,!1)}measureEndState(){const{element:h,name:y,unresolvedKeyframes:w}=this;if(!h||!h.current)return;const k=h.getValue(y);k&&k.jump(this.measuredOrigin,!1);const A=w.length-1,I=w[A];w[A]=Qh[y](h.measureViewportBox(),window.getComputedStyle(h.current)),I!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=I),this.removedTransforms?.length&&this.removedTransforms.forEach(([B,i])=>{h.getValue(B).set(i)}),this.resolveNoneKeyframes()}}function n3(u,h,y){if(u instanceof EventTarget)return[u];if(typeof u=="string"){let w=document;const k=y?.[u]??w.querySelectorAll(u);return k?Array.from(k):[]}return Array.from(u)}const Sb=(u,h)=>h&&typeof u=="number"?h.transform(u):u;function Eb(u){return V1(u)&&"offsetHeight"in u}const rv=30,i3=u=>!isNaN(parseFloat(u));class s3{constructor(h,y={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=w=>{const k=ga.now();if(this.updatedAt!==k&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(w),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const A of this.dependents)A.dirty()},this.hasAnimated=!1,this.setCurrent(h),this.owner=y.owner}setCurrent(h){this.current=h,this.updatedAt=ga.now(),this.canTrackVelocity===null&&h!==void 0&&(this.canTrackVelocity=i3(this.current))}setPrevFrameValue(h=this.current){this.prevFrameValue=h,this.prevUpdatedAt=this.updatedAt}onChange(h){return this.on("change",h)}on(h,y){this.events[h]||(this.events[h]=new y0);const w=this.events[h].add(y);return h==="change"?()=>{w(),Qn.read(()=>{this.events.change.getSize()||this.stop()})}:w}clearListeners(){for(const h in this.events)this.events[h].clear()}attach(h,y){this.passiveEffect=h,this.stopPassiveEffect=y}set(h){this.passiveEffect?this.passiveEffect(h,this.updateAndNotify):this.updateAndNotify(h)}setWithVelocity(h,y,w){this.set(y),this.prev=void 0,this.prevFrameValue=h,this.prevUpdatedAt=this.updatedAt-w}jump(h,y=!0){this.updateAndNotify(h),this.prev=h,this.prevUpdatedAt=this.prevFrameValue=void 0,y&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(h){this.dependents||(this.dependents=new Set),this.dependents.add(h)}removeDependent(h){this.dependents&&this.dependents.delete(h)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const h=ga.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||h-this.updatedAt>rv)return 0;const y=Math.min(this.updatedAt-this.prevUpdatedAt,rv);return G1(parseFloat(this.current)-parseFloat(this.prevFrameValue),y)}start(h){return this.stop(),new Promise(y=>{this.hasAnimated=!0,this.animation=h(y),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function pp(u,h){return new s3(u,h)}const{schedule:j0}=tb(queueMicrotask,!1),Wo={x:!1,y:!1};function Cb(){return Wo.x||Wo.y}function a3(u){return u==="x"||u==="y"?Wo[u]?null:(Wo[u]=!0,()=>{Wo[u]=!1}):Wo.x||Wo.y?null:(Wo.x=Wo.y=!0,()=>{Wo.x=Wo.y=!1})}function Mb(u,h){const y=n3(u),w=new AbortController,k={passive:!0,...h,signal:w.signal};return[y,k,()=>w.abort()]}function nv(u){return!(u.pointerType==="touch"||Cb())}function o3(u,h,y={}){const[w,k,A]=Mb(u,y),I=B=>{if(!nv(B))return;const{target:i}=B,R=h(i,B);if(typeof R!="function"||!i)return;const $=K=>{nv(K)&&(R(K),i.removeEventListener("pointerleave",$))};i.addEventListener("pointerleave",$,k)};return w.forEach(B=>{B.addEventListener("pointerenter",I,k)}),A}const Ab=(u,h)=>h?u===h?!0:Ab(u,h.parentElement):!1,N0=u=>u.pointerType==="mouse"?typeof u.button!="number"||u.button<=0:u.isPrimary!==!1,l3=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function c3(u){return l3.has(u.tagName)||u.tabIndex!==-1}const Zm=new WeakSet;function iv(u){return h=>{h.key==="Enter"&&u(h)}}function py(u,h){u.dispatchEvent(new PointerEvent("pointer"+h,{isPrimary:!0,bubbles:!0}))}const u3=(u,h)=>{const y=u.currentTarget;if(!y)return;const w=iv(()=>{if(Zm.has(y))return;py(y,"down");const k=iv(()=>{py(y,"up")}),A=()=>py(y,"cancel");y.addEventListener("keyup",k,h),y.addEventListener("blur",A,h)});y.addEventListener("keydown",w,h),y.addEventListener("blur",()=>y.removeEventListener("keydown",w),h)};function sv(u){return N0(u)&&!Cb()}function h3(u,h,y={}){const[w,k,A]=Mb(u,y),I=B=>{const i=B.currentTarget;if(!sv(B))return;Zm.add(i);const R=h(i,B),$=(he,Te)=>{window.removeEventListener("pointerup",K),window.removeEventListener("pointercancel",Z),Zm.has(i)&&Zm.delete(i),sv(he)&&typeof R=="function"&&R(he,{success:Te})},K=he=>{$(he,i===window||i===document||y.useGlobalTarget||Ab(i,he.target))},Z=he=>{$(he,!1)};window.addEventListener("pointerup",K,k),window.addEventListener("pointercancel",Z,k)};return w.forEach(B=>{(y.useGlobalTarget?window:B).addEventListener("pointerdown",I,k),Eb(B)&&(B.addEventListener("focus",R=>u3(R,k)),!c3(B)&&!B.hasAttribute("tabindex")&&(B.tabIndex=0))}),A}function Pb(u){return V1(u)&&"ownerSVGElement"in u}function d3(u){return Pb(u)&&u.tagName==="svg"}const Ls=u=>!!(u&&u.getVelocity),p3=[...wb,Ni,Fu],f3=u=>p3.find(bb(u)),D0=H.createContext({transformPagePoint:u=>u,isStatic:!1,reducedMotion:"never"});class m3 extends H.Component{getSnapshotBeforeUpdate(h){const y=this.props.childRef.current;if(y&&h.isPresent&&!this.props.isPresent){const w=y.offsetParent,k=Eb(w)&&w.offsetWidth||0,A=this.props.sizeRef.current;A.height=y.offsetHeight||0,A.width=y.offsetWidth||0,A.top=y.offsetTop,A.left=y.offsetLeft,A.right=k-A.width-A.left}return null}componentDidUpdate(){}render(){return this.props.children}}function g3({children:u,isPresent:h,anchorX:y,root:w}){const k=H.useId(),A=H.useRef(null),I=H.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:B}=H.useContext(D0);return H.useInsertionEffect(()=>{const{width:i,height:R,top:$,left:K,right:Z}=I.current;if(h||!A.current||!i||!R)return;const he=y==="left"?`left: ${K}`:`right: ${Z}`;A.current.dataset.motionPopId=k;const Te=document.createElement("style");B&&(Te.nonce=B);const ye=w??document.head;return ye.appendChild(Te),Te.sheet&&Te.sheet.insertRule(`
          [data-motion-pop-id="${k}"] {
            position: absolute !important;
            width: ${i}px !important;
            height: ${R}px !important;
            ${he}px !important;
            top: ${$}px !important;
          }
        `),()=>{ye.contains(Te)&&ye.removeChild(Te)}},[h]),m.jsx(m3,{isPresent:h,childRef:A,sizeRef:I,children:H.cloneElement(u,{ref:A})})}const y3=({children:u,initial:h,isPresent:y,onExitComplete:w,custom:k,presenceAffectsLayout:A,mode:I,anchorX:B,root:i})=>{const R=h0(x3),$=H.useId();let K=!0,Z=H.useMemo(()=>(K=!1,{id:$,initial:h,isPresent:y,custom:k,onExitComplete:he=>{R.set(he,!0);for(const Te of R.values())if(!Te)return;w&&w()},register:he=>(R.set(he,!1),()=>R.delete(he))}),[y,R,w]);return A&&K&&(Z={...Z}),H.useMemo(()=>{R.forEach((he,Te)=>R.set(Te,!1))},[y]),H.useEffect(()=>{!y&&!R.size&&w&&w()},[y]),I==="popLayout"&&(u=m.jsx(g3,{isPresent:y,anchorX:B,root:i,children:u})),m.jsx(og.Provider,{value:Z,children:u})};function x3(){return new Map}function Ib(u=!0){const h=H.useContext(og);if(h===null)return[!0,null];const{isPresent:y,onExitComplete:w,register:k}=h,A=H.useId();H.useEffect(()=>{if(u)return k(A)},[u]);const I=H.useCallback(()=>u&&w&&w(A),[A,w,u]);return!y&&w?[!1,I]:[!0]}const Fm=u=>u.key||"";function av(u){const h=[];return H.Children.forEach(u,y=>{H.isValidElement(y)&&h.push(y)}),h}const Ln=({children:u,custom:h,initial:y=!0,onExitComplete:w,presenceAffectsLayout:k=!0,mode:A="sync",propagate:I=!1,anchorX:B="left",root:i})=>{const[R,$]=Ib(I),K=H.useMemo(()=>av(u),[u]),Z=I&&!R?[]:K.map(Fm),he=H.useRef(!0),Te=H.useRef(K),ye=h0(()=>new Map),[Me,Le]=H.useState(K),[De,Qe]=H.useState(K);O1(()=>{he.current=!1,Te.current=K;for(let ce=0;ce<De.length;ce++){const $e=Fm(De[ce]);Z.includes($e)?ye.delete($e):ye.get($e)!==!0&&ye.set($e,!1)}},[De,Z.length,Z.join("-")]);const dt=[];if(K!==Me){let ce=[...K];for(let $e=0;$e<De.length;$e++){const Ge=De[$e],Ye=Fm(Ge);Z.includes(Ye)||(ce.splice($e,0,Ge),dt.push(Ge))}return A==="wait"&&dt.length&&(ce=dt),Qe(av(ce)),Le(K),null}const{forceRender:St}=H.useContext(u0);return m.jsx(m.Fragment,{children:De.map(ce=>{const $e=Fm(ce),Ge=I&&!R?!1:K===De||Z.includes($e),Ye=()=>{if(ye.has($e))ye.set($e,!0);else return;let ge=!0;ye.forEach(Pt=>{Pt||(ge=!1)}),ge&&(St?.(),Qe(Te.current),I&&$?.(),w&&w())};return m.jsx(y3,{isPresent:Ge,initial:!he.current||y?void 0:!1,custom:h,presenceAffectsLayout:k,mode:A,root:i,onExitComplete:Ge?void 0:Ye,anchorX:B,children:ce},$e)})})},jb=H.createContext({strict:!1}),ov={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},fp={};for(const u in ov)fp[u]={isEnabled:h=>ov[u].some(y=>!!h[y])};function _3(u){for(const h in u)fp[h]={...fp[h],...u[h]}}const v3=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function rg(u){return u.startsWith("while")||u.startsWith("drag")&&u!=="draggable"||u.startsWith("layout")||u.startsWith("onTap")||u.startsWith("onPan")||u.startsWith("onLayout")||v3.has(u)}let Nb=u=>!rg(u);function b3(u){typeof u=="function"&&(Nb=h=>h.startsWith("on")?!rg(h):u(h))}try{b3(require("@emotion/is-prop-valid").default)}catch{}function w3(u,h,y){const w={};for(const k in u)k==="values"&&typeof u.values=="object"||(Nb(k)||y===!0&&rg(k)||!h&&!rg(k)||u.draggable&&k.startsWith("onDrag"))&&(w[k]=u[k]);return w}const lg=H.createContext({});function cg(u){return u!==null&&typeof u=="object"&&typeof u.start=="function"}function zf(u){return typeof u=="string"||Array.isArray(u)}const L0=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],R0=["initial",...L0];function ug(u){return cg(u.animate)||R0.some(h=>zf(u[h]))}function Db(u){return!!(ug(u)||u.variants)}function T3(u,h){if(ug(u)){const{initial:y,animate:w}=u;return{initial:y===!1||zf(y)?y:void 0,animate:zf(w)?w:void 0}}return u.inherit!==!1?h:{}}function k3(u){const{initial:h,animate:y}=T3(u,H.useContext(lg));return H.useMemo(()=>({initial:h,animate:y}),[lv(h),lv(y)])}function lv(u){return Array.isArray(u)?u.join(" "):u}const Bf={};function S3(u){for(const h in u)Bf[h]=u[h],v0(h)&&(Bf[h].isCSSVariable=!0)}function Lb(u,{layout:h,layoutId:y}){return wp.has(u)||u.startsWith("origin")||(h||y!==void 0)&&(!!Bf[u]||u==="opacity")}const E3={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},C3=bp.length;function M3(u,h,y){let w="",k=!0;for(let A=0;A<C3;A++){const I=bp[A],B=u[I];if(B===void 0)continue;let i=!0;if(typeof B=="number"?i=B===(I.startsWith("scale")?1:0):i=parseFloat(B)===0,!i||y){const R=Sb(B,I0[I]);if(!i){k=!1;const $=E3[I]||I;w+=`${$}(${R}) `}y&&(h[I]=R)}}return w=w.trim(),y?w=y(h,k?"":w):k&&(w="none"),w}function z0(u,h,y){const{style:w,vars:k,transformOrigin:A}=u;let I=!1,B=!1;for(const i in h){const R=h[i];if(wp.has(i)){I=!0;continue}else if(v0(i)){k[i]=R;continue}else{const $=Sb(R,I0[i]);i.startsWith("origin")?(B=!0,A[i]=$):w[i]=$}}if(h.transform||(I||y?w.transform=M3(h,u.transform,y):w.transform&&(w.transform="none")),B){const{originX:i="50%",originY:R="50%",originZ:$=0}=A;w.transformOrigin=`${i} ${R} ${$}`}}const B0=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Rb(u,h,y){for(const w in h)!Ls(h[w])&&!Lb(w,y)&&(u[w]=h[w])}function A3({transformTemplate:u},h){return H.useMemo(()=>{const y=B0();return z0(y,h,u),Object.assign({},y.vars,y.style)},[h])}function P3(u,h){const y=u.style||{},w={};return Rb(w,y,u),Object.assign(w,A3(u,h)),w}function I3(u,h){const y={},w=P3(u,h);return u.drag&&u.dragListener!==!1&&(y.draggable=!1,w.userSelect=w.WebkitUserSelect=w.WebkitTouchCallout="none",w.touchAction=u.drag===!0?"none":`pan-${u.drag==="x"?"y":"x"}`),u.tabIndex===void 0&&(u.onTap||u.onTapStart||u.whileTap)&&(y.tabIndex=0),y.style=w,y}const j3={offset:"stroke-dashoffset",array:"stroke-dasharray"},N3={offset:"strokeDashoffset",array:"strokeDasharray"};function D3(u,h,y=1,w=0,k=!0){u.pathLength=1;const A=k?j3:N3;u[A.offset]=jr.transform(-w);const I=jr.transform(h),B=jr.transform(y);u[A.array]=`${I} ${B}`}function zb(u,{attrX:h,attrY:y,attrScale:w,pathLength:k,pathSpacing:A=1,pathOffset:I=0,...B},i,R,$){if(z0(u,B,R),i){u.style.viewBox&&(u.attrs.viewBox=u.style.viewBox);return}u.attrs=u.style,u.style={};const{attrs:K,style:Z}=u;K.transform&&(Z.transform=K.transform,delete K.transform),(Z.transform||K.transformOrigin)&&(Z.transformOrigin=K.transformOrigin??"50% 50%",delete K.transformOrigin),Z.transform&&(Z.transformBox=$?.transformBox??"fill-box",delete K.transformBox),h!==void 0&&(K.x=h),y!==void 0&&(K.y=y),w!==void 0&&(K.scale=w),k!==void 0&&D3(K,k,A,I,!1)}const Bb=()=>({...B0(),attrs:{}}),Fb=u=>typeof u=="string"&&u.toLowerCase()==="svg";function L3(u,h,y,w){const k=H.useMemo(()=>{const A=Bb();return zb(A,h,Fb(w),u.transformTemplate,u.style),{...A.attrs,style:{...A.style}}},[h]);if(u.style){const A={};Rb(A,u.style,u),k.style={...A,...k.style}}return k}const R3=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function F0(u){return typeof u!="string"||u.includes("-")?!1:!!(R3.indexOf(u)>-1||/[A-Z]/u.test(u))}function z3(u,h,y,{latestValues:w},k,A=!1){const B=(F0(u)?L3:I3)(h,w,k,u),i=w3(h,typeof u=="string",A),R=u!==H.Fragment?{...i,...B,ref:y}:{},{children:$}=h,K=H.useMemo(()=>Ls($)?$.get():$,[$]);return H.createElement(u,{...R,children:K})}function cv(u){const h=[{},{}];return u?.values.forEach((y,w)=>{h[0][w]=y.get(),h[1][w]=y.getVelocity()}),h}function O0(u,h,y,w){if(typeof h=="function"){const[k,A]=cv(w);h=h(y!==void 0?y:u.custom,k,A)}if(typeof h=="string"&&(h=u.variants&&u.variants[h]),typeof h=="function"){const[k,A]=cv(w);h=h(y!==void 0?y:u.custom,k,A)}return h}function Hm(u){return Ls(u)?u.get():u}function B3({scrapeMotionValuesFromProps:u,createRenderState:h},y,w,k){return{latestValues:F3(y,w,k,u),renderState:h()}}function F3(u,h,y,w){const k={},A=w(u,{});for(const Z in A)k[Z]=Hm(A[Z]);let{initial:I,animate:B}=u;const i=ug(u),R=Db(u);h&&R&&!i&&u.inherit!==!1&&(I===void 0&&(I=h.initial),B===void 0&&(B=h.animate));let $=y?y.initial===!1:!1;$=$||I===!1;const K=$?B:I;if(K&&typeof K!="boolean"&&!cg(K)){const Z=Array.isArray(K)?K:[K];for(let he=0;he<Z.length;he++){const Te=O0(u,Z[he]);if(Te){const{transitionEnd:ye,transition:Me,...Le}=Te;for(const De in Le){let Qe=Le[De];if(Array.isArray(Qe)){const dt=$?Qe.length-1:0;Qe=Qe[dt]}Qe!==null&&(k[De]=Qe)}for(const De in ye)k[De]=ye[De]}}}return k}const Ob=u=>(h,y)=>{const w=H.useContext(lg),k=H.useContext(og),A=()=>B3(u,h,w,k);return y?A():h0(A)};function U0(u,h,y){const{style:w}=u,k={};for(const A in w)(Ls(w[A])||h.style&&Ls(h.style[A])||Lb(A,u)||y?.getValue(A)?.liveStyle!==void 0)&&(k[A]=w[A]);return k}const O3=Ob({scrapeMotionValuesFromProps:U0,createRenderState:B0});function Ub(u,h,y){const w=U0(u,h,y);for(const k in u)if(Ls(u[k])||Ls(h[k])){const A=bp.indexOf(k)!==-1?"attr"+k.charAt(0).toUpperCase()+k.substring(1):k;w[A]=u[k]}return w}const U3=Ob({scrapeMotionValuesFromProps:Ub,createRenderState:Bb}),V3=Symbol.for("motionComponentSymbol");function ip(u){return u&&typeof u=="object"&&Object.prototype.hasOwnProperty.call(u,"current")}function $3(u,h,y){return H.useCallback(w=>{w&&u.onMount&&u.onMount(w),h&&(w?h.mount(w):h.unmount()),y&&(typeof y=="function"?y(w):ip(y)&&(y.current=w))},[h])}const V0=u=>u.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),G3="framerAppearId",Vb="data-"+V0(G3),$b=H.createContext({});function W3(u,h,y,w,k){const{visualElement:A}=H.useContext(lg),I=H.useContext(jb),B=H.useContext(og),i=H.useContext(D0).reducedMotion,R=H.useRef(null);w=w||I.renderer,!R.current&&w&&(R.current=w(u,{visualState:h,parent:A,props:y,presenceContext:B,blockInitialAnimation:B?B.initial===!1:!1,reducedMotionConfig:i}));const $=R.current,K=H.useContext($b);$&&!$.projection&&k&&($.type==="html"||$.type==="svg")&&q3(R.current,y,k,K);const Z=H.useRef(!1);H.useInsertionEffect(()=>{$&&Z.current&&$.update(y,B)});const he=y[Vb],Te=H.useRef(!!he&&!window.MotionHandoffIsComplete?.(he)&&window.MotionHasOptimisedAnimation?.(he));return O1(()=>{$&&(Z.current=!0,window.MotionIsMounted=!0,$.updateFeatures(),$.scheduleRenderMicrotask(),Te.current&&$.animationState&&$.animationState.animateChanges())}),H.useEffect(()=>{$&&(!Te.current&&$.animationState&&$.animationState.animateChanges(),Te.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(he)}),Te.current=!1),$.enteringChildren=void 0)}),$}function q3(u,h,y,w){const{layoutId:k,layout:A,drag:I,dragConstraints:B,layoutScroll:i,layoutRoot:R,layoutCrossfade:$}=h;u.projection=new y(u.latestValues,h["data-framer-portal-id"]?void 0:Gb(u.parent)),u.projection.setOptions({layoutId:k,layout:A,alwaysMeasureLayout:!!I||B&&ip(B),visualElement:u,animationType:typeof A=="string"?A:"both",initialPromotionConfig:w,crossfade:$,layoutScroll:i,layoutRoot:R})}function Gb(u){if(u)return u.options.allowProjection!==!1?u.projection:Gb(u.parent)}function fy(u,{forwardMotionProps:h=!1}={},y,w){y&&_3(y);const k=F0(u)?U3:O3;function A(B,i){let R;const $={...H.useContext(D0),...B,layoutId:Z3(B)},{isStatic:K}=$,Z=k3(B),he=k(B,K);if(!K&&d0){H3();const Te=X3($);R=Te.MeasureLayout,Z.visualElement=W3(u,he,$,w,Te.ProjectionNode)}return m.jsxs(lg.Provider,{value:Z,children:[R&&Z.visualElement?m.jsx(R,{visualElement:Z.visualElement,...$}):null,z3(u,B,$3(he,Z.visualElement,i),he,K,h)]})}A.displayName=`motion.${typeof u=="string"?u:`create(${u.displayName??u.name??""})`}`;const I=H.forwardRef(A);return I[V3]=u,I}function Z3({layoutId:u}){const h=H.useContext(u0).id;return h&&u!==void 0?h+"-"+u:u}function H3(u,h){H.useContext(jb).strict}function X3(u){const{drag:h,layout:y}=fp;if(!h&&!y)return{};const w={...h,...y};return{MeasureLayout:h?.isEnabled(u)||y?.isEnabled(u)?w.MeasureLayout:void 0,ProjectionNode:w.ProjectionNode}}function K3(u,h){if(typeof Proxy>"u")return fy;const y=new Map,w=(A,I)=>fy(A,I,u,h),k=(A,I)=>w(A,I);return new Proxy(k,{get:(A,I)=>I==="create"?w:(y.has(I)||y.set(I,fy(I,void 0,u,h)),y.get(I))})}function Wb({top:u,left:h,right:y,bottom:w}){return{x:{min:h,max:y},y:{min:u,max:w}}}function Y3({x:u,y:h}){return{top:h.min,right:u.max,bottom:h.max,left:u.min}}function J3(u,h){if(!h)return u;const y=h({x:u.left,y:u.top}),w=h({x:u.right,y:u.bottom});return{top:y.y,left:y.x,bottom:w.y,right:w.x}}function my(u){return u===void 0||u===1}function Vy({scale:u,scaleX:h,scaleY:y}){return!my(u)||!my(h)||!my(y)}function Hh(u){return Vy(u)||qb(u)||u.z||u.rotate||u.rotateX||u.rotateY||u.skewX||u.skewY}function qb(u){return uv(u.x)||uv(u.y)}function uv(u){return u&&u!=="0%"}function ng(u,h,y){const w=u-y,k=h*w;return y+k}function hv(u,h,y,w,k){return k!==void 0&&(u=ng(u,k,w)),ng(u,y,w)+h}function $y(u,h=0,y=1,w,k){u.min=hv(u.min,h,y,w,k),u.max=hv(u.max,h,y,w,k)}function Zb(u,{x:h,y}){$y(u.x,h.translate,h.scale,h.originPoint),$y(u.y,y.translate,y.scale,y.originPoint)}const dv=.999999999999,pv=1.0000000000001;function Q3(u,h,y,w=!1){const k=y.length;if(!k)return;h.x=h.y=1;let A,I;for(let B=0;B<k;B++){A=y[B],I=A.projectionDelta;const{visualElement:i}=A.options;i&&i.props.style&&i.props.style.display==="contents"||(w&&A.options.layoutScroll&&A.scroll&&A!==A.root&&ap(u,{x:-A.scroll.offset.x,y:-A.scroll.offset.y}),I&&(h.x*=I.x.scale,h.y*=I.y.scale,Zb(u,I)),w&&Hh(A.latestValues)&&ap(u,A.latestValues))}h.x<pv&&h.x>dv&&(h.x=1),h.y<pv&&h.y>dv&&(h.y=1)}function sp(u,h){u.min=u.min+h,u.max=u.max+h}function fv(u,h,y,w,k=.5){const A=li(u.min,u.max,k);$y(u,h,y,A,w)}function ap(u,h){fv(u.x,h.x,h.scaleX,h.scale,h.originX),fv(u.y,h.y,h.scaleY,h.scale,h.originY)}function Hb(u,h){return Wb(J3(u.getBoundingClientRect(),h))}function eM(u,h,y){const w=Hb(u,y),{scroll:k}=h;return k&&(sp(w.x,k.offset.x),sp(w.y,k.offset.y)),w}const mv=()=>({translate:0,scale:1,origin:0,originPoint:0}),op=()=>({x:mv(),y:mv()}),gv=()=>({min:0,max:0}),ki=()=>({x:gv(),y:gv()}),Gy={current:null},Xb={current:!1};function tM(){if(Xb.current=!0,!!d0)if(window.matchMedia){const u=window.matchMedia("(prefers-reduced-motion)"),h=()=>Gy.current=u.matches;u.addEventListener("change",h),h()}else Gy.current=!1}const rM=new WeakMap;function nM(u,h,y){for(const w in h){const k=h[w],A=y[w];if(Ls(k))u.addValue(w,k);else if(Ls(A))u.addValue(w,pp(k,{owner:u}));else if(A!==k)if(u.hasValue(w)){const I=u.getValue(w);I.liveStyle===!0?I.jump(k):I.hasAnimated||I.set(k)}else{const I=u.getStaticValue(w);u.addValue(w,pp(I!==void 0?I:k,{owner:u}))}}for(const w in y)h[w]===void 0&&u.removeValue(w);return h}const yv=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class iM{scrapeMotionValuesFromProps(h,y,w){return{}}constructor({parent:h,props:y,presenceContext:w,reducedMotionConfig:k,blockInitialAnimation:A,visualState:I},B={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=A0,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const Z=ga.now();this.renderScheduledAt<Z&&(this.renderScheduledAt=Z,Qn.render(this.render,!1,!0))};const{latestValues:i,renderState:R}=I;this.latestValues=i,this.baseTarget={...i},this.initialValues=y.initial?{...i}:{},this.renderState=R,this.parent=h,this.props=y,this.presenceContext=w,this.depth=h?h.depth+1:0,this.reducedMotionConfig=k,this.options=B,this.blockInitialAnimation=!!A,this.isControllingVariants=ug(y),this.isVariantNode=Db(y),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(h&&h.current);const{willChange:$,...K}=this.scrapeMotionValuesFromProps(y,{},this);for(const Z in K){const he=K[Z];i[Z]!==void 0&&Ls(he)&&he.set(i[Z])}}mount(h){this.current=h,rM.set(h,this),this.projection&&!this.projection.instance&&this.projection.mount(h),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((y,w)=>this.bindToMotionValue(w,y)),Xb.current||tM(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Gy.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Bu(this.notifyUpdate),Bu(this.render),this.valueSubscriptions.forEach(h=>h()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const h in this.events)this.events[h].clear();for(const h in this.features){const y=this.features[h];y&&(y.unmount(),y.isMounted=!1)}this.current=null}addChild(h){this.children.add(h),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(h)}removeChild(h){this.children.delete(h),this.enteringChildren&&this.enteringChildren.delete(h)}bindToMotionValue(h,y){this.valueSubscriptions.has(h)&&this.valueSubscriptions.get(h)();const w=wp.has(h);w&&this.onBindTransform&&this.onBindTransform();const k=y.on("change",I=>{this.latestValues[h]=I,this.props.onUpdate&&Qn.preRender(this.notifyUpdate),w&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let A;window.MotionCheckAppearSync&&(A=window.MotionCheckAppearSync(this,h,y)),this.valueSubscriptions.set(h,()=>{k(),A&&A(),y.owner&&y.stop()})}sortNodePosition(h){return!this.current||!this.sortInstanceNodePosition||this.type!==h.type?0:this.sortInstanceNodePosition(this.current,h.current)}updateFeatures(){let h="animation";for(h in fp){const y=fp[h];if(!y)continue;const{isEnabled:w,Feature:k}=y;if(!this.features[h]&&k&&w(this.props)&&(this.features[h]=new k(this)),this.features[h]){const A=this.features[h];A.isMounted?A.update():(A.mount(),A.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ki()}getStaticValue(h){return this.latestValues[h]}setStaticValue(h,y){this.latestValues[h]=y}update(h,y){(h.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=h,this.prevPresenceContext=this.presenceContext,this.presenceContext=y;for(let w=0;w<yv.length;w++){const k=yv[w];this.propEventSubscriptions[k]&&(this.propEventSubscriptions[k](),delete this.propEventSubscriptions[k]);const A="on"+k,I=h[A];I&&(this.propEventSubscriptions[k]=this.on(k,I))}this.prevMotionValues=nM(this,this.scrapeMotionValuesFromProps(h,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(h){return this.props.variants?this.props.variants[h]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(h){const y=this.getClosestVariantNode();if(y)return y.variantChildren&&y.variantChildren.add(h),()=>y.variantChildren.delete(h)}addValue(h,y){const w=this.values.get(h);y!==w&&(w&&this.removeValue(h),this.bindToMotionValue(h,y),this.values.set(h,y),this.latestValues[h]=y.get())}removeValue(h){this.values.delete(h);const y=this.valueSubscriptions.get(h);y&&(y(),this.valueSubscriptions.delete(h)),delete this.latestValues[h],this.removeValueFromRenderState(h,this.renderState)}hasValue(h){return this.values.has(h)}getValue(h,y){if(this.props.values&&this.props.values[h])return this.props.values[h];let w=this.values.get(h);return w===void 0&&y!==void 0&&(w=pp(y===null?void 0:y,{owner:this}),this.addValue(h,w)),w}readValue(h,y){let w=this.latestValues[h]!==void 0||!this.current?this.latestValues[h]:this.getBaseTargetFromProps(this.props,h)??this.readValueFromInstance(this.current,h,this.options);return w!=null&&(typeof w=="string"&&(U1(w)||$1(w))?w=parseFloat(w):!f3(w)&&Fu.test(y)&&(w=kb(h,y)),this.setBaseTarget(h,Ls(w)?w.get():w)),Ls(w)?w.get():w}setBaseTarget(h,y){this.baseTarget[h]=y}getBaseTarget(h){const{initial:y}=this.props;let w;if(typeof y=="string"||typeof y=="object"){const A=O0(this.props,y,this.presenceContext?.custom);A&&(w=A[h])}if(y&&w!==void 0)return w;const k=this.getBaseTargetFromProps(this.props,h);return k!==void 0&&!Ls(k)?k:this.initialValues[h]!==void 0&&w===void 0?void 0:this.baseTarget[h]}on(h,y){return this.events[h]||(this.events[h]=new y0),this.events[h].add(y)}notify(h,...y){this.events[h]&&this.events[h].notify(...y)}scheduleRenderMicrotask(){j0.render(this.render)}}class Kb extends iM{constructor(){super(...arguments),this.KeyframeResolver=r3}sortInstanceNodePosition(h,y){return h.compareDocumentPosition(y)&2?1:-1}getBaseTargetFromProps(h,y){return h.style?h.style[y]:void 0}removeValueFromRenderState(h,{vars:y,style:w}){delete y[h],delete w[h]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:h}=this.props;Ls(h)&&(this.childSubscription=h.on("change",y=>{this.current&&(this.current.textContent=`${y}`)}))}}function Yb(u,{style:h,vars:y},w,k){const A=u.style;let I;for(I in h)A[I]=h[I];k?.applyProjectionStyles(A,w);for(I in y)A.setProperty(I,y[I])}function sM(u){return window.getComputedStyle(u)}class aM extends Kb{constructor(){super(...arguments),this.type="html",this.renderInstance=Yb}readValueFromInstance(h,y){if(wp.has(y))return this.projection?.isProjecting?Ly(y):bC(h,y);{const w=sM(h),k=(v0(y)?w.getPropertyValue(y):w[y])||0;return typeof k=="string"?k.trim():k}}measureInstanceViewportBox(h,{transformPagePoint:y}){return Hb(h,y)}build(h,y,w){z0(h,y,w.transformTemplate)}scrapeMotionValuesFromProps(h,y,w){return U0(h,y,w)}}const Jb=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function oM(u,h,y,w){Yb(u,h,void 0,w);for(const k in h.attrs)u.setAttribute(Jb.has(k)?k:V0(k),h.attrs[k])}class lM extends Kb{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ki}getBaseTargetFromProps(h,y){return h[y]}readValueFromInstance(h,y){if(wp.has(y)){const w=Tb(y);return w&&w.default||0}return y=Jb.has(y)?y:V0(y),h.getAttribute(y)}scrapeMotionValuesFromProps(h,y,w){return Ub(h,y,w)}build(h,y,w){zb(h,y,this.isSVGTag,w.transformTemplate,w.style)}renderInstance(h,y,w,k){oM(h,y,w,k)}mount(h){this.isSVGTag=Fb(h.tagName),super.mount(h)}}const cM=(u,h)=>F0(u)?new lM(h):new aM(h,{allowProjection:u!==H.Fragment});function lp(u,h,y){const w=u.getProps();return O0(w,h,y!==void 0?y:w.custom,u)}const Wy=u=>Array.isArray(u);function uM(u,h,y){u.hasValue(h)?u.getValue(h).set(y):u.addValue(h,pp(y))}function hM(u){return Wy(u)?u[u.length-1]||0:u}function dM(u,h){const y=lp(u,h);let{transitionEnd:w={},transition:k={},...A}=y||{};A={...A,...w};for(const I in A){const B=hM(A[I]);uM(u,I,B)}}function pM(u){return!!(Ls(u)&&u.add)}function qy(u,h){const y=u.getValue("willChange");if(pM(y))return y.add(h);if(!y&&$c.WillChange){const w=new $c.WillChange("auto");u.addValue("willChange",w),w.add(h)}}function Qb(u){return u.props[Vb]}const fM=u=>u!==null;function mM(u,{repeat:h,repeatType:y="loop"},w){const k=u.filter(fM),A=h&&y!=="loop"&&h%2===1?0:k.length-1;return k[A]}const gM={type:"spring",stiffness:500,damping:25,restSpeed:10},yM=u=>({type:"spring",stiffness:550,damping:u===0?2*Math.sqrt(550):30,restSpeed:10}),xM={type:"keyframes",duration:.8},_M={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},vM=(u,{keyframes:h})=>h.length>2?xM:wp.has(u)?u.startsWith("scale")?yM(h[1]):gM:_M;function bM({when:u,delay:h,delayChildren:y,staggerChildren:w,staggerDirection:k,repeat:A,repeatType:I,repeatDelay:B,from:i,elapsed:R,...$}){return!!Object.keys($).length}const $0=(u,h,y,w={},k,A)=>I=>{const B=P0(w,u)||{},i=B.delay||w.delay||0;let{elapsed:R=0}=w;R=R-$l(i);const $={keyframes:Array.isArray(y)?y:[null,y],ease:"easeOut",velocity:h.getVelocity(),...B,delay:-R,onUpdate:Z=>{h.set(Z),B.onUpdate&&B.onUpdate(Z)},onComplete:()=>{I(),B.onComplete&&B.onComplete()},name:u,motionValue:h,element:A?void 0:k};bM(B)||Object.assign($,vM(u,$)),$.duration&&($.duration=$l($.duration)),$.repeatDelay&&($.repeatDelay=$l($.repeatDelay)),$.from!==void 0&&($.keyframes[0]=$.from);let K=!1;if(($.type===!1||$.duration===0&&!$.repeatDelay)&&(Oy($),$.delay===0&&(K=!0)),($c.instantAnimations||$c.skipAnimations)&&(K=!0,Oy($),$.delay=0),$.allowFlatten=!B.type&&!B.ease,K&&!A&&h.get()!==void 0){const Z=mM($.keyframes,B);if(Z!==void 0){Qn.update(()=>{$.onUpdate(Z),$.onComplete()});return}}return B.isSync?new M0($):new GC($)};function wM({protectedKeys:u,needsAnimating:h},y){const w=u.hasOwnProperty(y)&&h[y]!==!0;return h[y]=!1,w}function ew(u,h,{delay:y=0,transitionOverride:w,type:k}={}){let{transition:A=u.getDefaultTransition(),transitionEnd:I,...B}=h;w&&(A=w);const i=[],R=k&&u.animationState&&u.animationState.getState()[k];for(const $ in B){const K=u.getValue($,u.latestValues[$]??null),Z=B[$];if(Z===void 0||R&&wM(R,$))continue;const he={delay:y,...P0(A||{},$)},Te=K.get();if(Te!==void 0&&!K.isAnimating&&!Array.isArray(Z)&&Z===Te&&!he.velocity)continue;let ye=!1;if(window.MotionHandoffAnimation){const Le=Qb(u);if(Le){const De=window.MotionHandoffAnimation(Le,$,Qn);De!==null&&(he.startTime=De,ye=!0)}}qy(u,$),K.start($0($,K,Z,u.shouldReduceMotion&&vb.has($)?{type:!1}:he,u,ye));const Me=K.animation;Me&&i.push(Me)}return I&&Promise.all(i).then(()=>{Qn.update(()=>{I&&dM(u,I)})}),i}function tw(u,h,y,w=0,k=1){const A=Array.from(u).sort((R,$)=>R.sortNodePosition($)).indexOf(h),I=u.size,B=(I-1)*w;return typeof y=="function"?y(A,I):k===1?A*w:B-A*w}function Zy(u,h,y={}){const w=lp(u,h,y.type==="exit"?u.presenceContext?.custom:void 0);let{transition:k=u.getDefaultTransition()||{}}=w||{};y.transitionOverride&&(k=y.transitionOverride);const A=w?()=>Promise.all(ew(u,w,y)):()=>Promise.resolve(),I=u.variantChildren&&u.variantChildren.size?(i=0)=>{const{delayChildren:R=0,staggerChildren:$,staggerDirection:K}=k;return TM(u,h,i,R,$,K,y)}:()=>Promise.resolve(),{when:B}=k;if(B){const[i,R]=B==="beforeChildren"?[A,I]:[I,A];return i().then(()=>R())}else return Promise.all([A(),I(y.delay)])}function TM(u,h,y=0,w=0,k=0,A=1,I){const B=[];for(const i of u.variantChildren)i.notify("AnimationStart",h),B.push(Zy(i,h,{...I,delay:y+(typeof w=="function"?0:w)+tw(u.variantChildren,i,w,k,A)}).then(()=>i.notify("AnimationComplete",h)));return Promise.all(B)}function kM(u,h,y={}){u.notify("AnimationStart",h);let w;if(Array.isArray(h)){const k=h.map(A=>Zy(u,A,y));w=Promise.all(k)}else if(typeof h=="string")w=Zy(u,h,y);else{const k=typeof h=="function"?lp(u,h,y.custom):h;w=Promise.all(ew(u,k,y))}return w.then(()=>{u.notify("AnimationComplete",h)})}function rw(u,h){if(!Array.isArray(h))return!1;const y=h.length;if(y!==u.length)return!1;for(let w=0;w<y;w++)if(h[w]!==u[w])return!1;return!0}const SM=R0.length;function nw(u){if(!u)return;if(!u.isControllingVariants){const y=u.parent?nw(u.parent)||{}:{};return u.props.initial!==void 0&&(y.initial=u.props.initial),y}const h={};for(let y=0;y<SM;y++){const w=R0[y],k=u.props[w];(zf(k)||k===!1)&&(h[w]=k)}return h}const EM=[...L0].reverse(),CM=L0.length;function MM(u){return h=>Promise.all(h.map(({animation:y,options:w})=>kM(u,y,w)))}function AM(u){let h=MM(u),y=xv(),w=!0;const k=i=>(R,$)=>{const K=lp(u,$,i==="exit"?u.presenceContext?.custom:void 0);if(K){const{transition:Z,transitionEnd:he,...Te}=K;R={...R,...Te,...he}}return R};function A(i){h=i(u)}function I(i){const{props:R}=u,$=nw(u.parent)||{},K=[],Z=new Set;let he={},Te=1/0;for(let Me=0;Me<CM;Me++){const Le=EM[Me],De=y[Le],Qe=R[Le]!==void 0?R[Le]:$[Le],dt=zf(Qe),St=Le===i?De.isActive:null;St===!1&&(Te=Me);let ce=Qe===$[Le]&&Qe!==R[Le]&&dt;if(ce&&w&&u.manuallyAnimateOnMount&&(ce=!1),De.protectedKeys={...he},!De.isActive&&St===null||!Qe&&!De.prevProp||cg(Qe)||typeof Qe=="boolean")continue;const $e=PM(De.prevProp,Qe);let Ge=$e||Le===i&&De.isActive&&!ce&&dt||Me>Te&&dt,Ye=!1;const ge=Array.isArray(Qe)?Qe:[Qe];let Pt=ge.reduce(k(Le),{});St===!1&&(Pt={});const{prevResolvedValues:tt={}}=De,ct={...tt,...Pt},Kt=Ht=>{Ge=!0,Z.has(Ht)&&(Ye=!0,Z.delete(Ht)),De.needsAnimating[Ht]=!0;const Tt=u.getValue(Ht);Tt&&(Tt.liveStyle=!1)};for(const Ht in ct){const Tt=Pt[Ht],Be=tt[Ht];if(he.hasOwnProperty(Ht))continue;let Je=!1;Wy(Tt)&&Wy(Be)?Je=!rw(Tt,Be):Je=Tt!==Be,Je?Tt!=null?Kt(Ht):Z.add(Ht):Tt!==void 0&&Z.has(Ht)?Kt(Ht):De.protectedKeys[Ht]=!0}De.prevProp=Qe,De.prevResolvedValues=Pt,De.isActive&&(he={...he,...Pt}),w&&u.blockInitialAnimation&&(Ge=!1);const Mr=ce&&$e;Ge&&(!Mr||Ye)&&K.push(...ge.map(Ht=>{const Tt={type:Le};if(typeof Ht=="string"&&w&&!Mr&&u.manuallyAnimateOnMount&&u.parent){const{parent:Be}=u,Je=lp(Be,Ht);if(Be.enteringChildren&&Je){const{delayChildren:ve}=Je.transition||{};Tt.delay=tw(Be.enteringChildren,u,ve)}}return{animation:Ht,options:Tt}}))}if(Z.size){const Me={};if(typeof R.initial!="boolean"){const Le=lp(u,Array.isArray(R.initial)?R.initial[0]:R.initial);Le&&Le.transition&&(Me.transition=Le.transition)}Z.forEach(Le=>{const De=u.getBaseTarget(Le),Qe=u.getValue(Le);Qe&&(Qe.liveStyle=!0),Me[Le]=De??null}),K.push({animation:Me})}let ye=!!K.length;return w&&(R.initial===!1||R.initial===R.animate)&&!u.manuallyAnimateOnMount&&(ye=!1),w=!1,ye?h(K):Promise.resolve()}function B(i,R){if(y[i].isActive===R)return Promise.resolve();u.variantChildren?.forEach(K=>K.animationState?.setActive(i,R)),y[i].isActive=R;const $=I(i);for(const K in y)y[K].protectedKeys={};return $}return{animateChanges:I,setActive:B,setAnimateFunction:A,getState:()=>y,reset:()=>{y=xv(),w=!0}}}function PM(u,h){return typeof h=="string"?h!==u:Array.isArray(h)?!rw(h,u):!1}function Zh(u=!1){return{isActive:u,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function xv(){return{animate:Zh(!0),whileInView:Zh(),whileHover:Zh(),whileTap:Zh(),whileDrag:Zh(),whileFocus:Zh(),exit:Zh()}}class Uu{constructor(h){this.isMounted=!1,this.node=h}update(){}}class IM extends Uu{constructor(h){super(h),h.animationState||(h.animationState=AM(h))}updateAnimationControlsSubscription(){const{animate:h}=this.node.getProps();cg(h)&&(this.unmountControls=h.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:h}=this.node.getProps(),{animate:y}=this.node.prevProps||{};h!==y&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let jM=0;class NM extends Uu{constructor(){super(...arguments),this.id=jM++}update(){if(!this.node.presenceContext)return;const{isPresent:h,onExitComplete:y}=this.node.presenceContext,{isPresent:w}=this.node.prevPresenceContext||{};if(!this.node.animationState||h===w)return;const k=this.node.animationState.setActive("exit",!h);y&&!h&&k.then(()=>{y(this.id)})}mount(){const{register:h,onExitComplete:y}=this.node.presenceContext||{};y&&y(this.id),h&&(this.unmount=h(this.id))}unmount(){}}const DM={animation:{Feature:IM},exit:{Feature:NM}};function Ff(u,h,y,w={passive:!0}){return u.addEventListener(h,y,w),()=>u.removeEventListener(h,y)}function qf(u){return{point:{x:u.pageX,y:u.pageY}}}const LM=u=>h=>N0(h)&&u(h,qf(h));function Mf(u,h,y,w){return Ff(u,h,LM(y),w)}const iw=1e-4,RM=1-iw,zM=1+iw,sw=.01,BM=0-sw,FM=0+sw;function Ks(u){return u.max-u.min}function OM(u,h,y){return Math.abs(u-h)<=y}function _v(u,h,y,w=.5){u.origin=w,u.originPoint=li(h.min,h.max,u.origin),u.scale=Ks(y)/Ks(h),u.translate=li(y.min,y.max,u.origin)-u.originPoint,(u.scale>=RM&&u.scale<=zM||isNaN(u.scale))&&(u.scale=1),(u.translate>=BM&&u.translate<=FM||isNaN(u.translate))&&(u.translate=0)}function Af(u,h,y,w){_v(u.x,h.x,y.x,w?w.originX:void 0),_v(u.y,h.y,y.y,w?w.originY:void 0)}function vv(u,h,y){u.min=y.min+h.min,u.max=u.min+Ks(h)}function UM(u,h,y){vv(u.x,h.x,y.x),vv(u.y,h.y,y.y)}function bv(u,h,y){u.min=h.min-y.min,u.max=u.min+Ks(h)}function Pf(u,h,y){bv(u.x,h.x,y.x),bv(u.y,h.y,y.y)}function fo(u){return[u("x"),u("y")]}const aw=({current:u})=>u?u.ownerDocument.defaultView:null,wv=(u,h)=>Math.abs(u-h);function VM(u,h){const y=wv(u.x,h.x),w=wv(u.y,h.y);return Math.sqrt(y**2+w**2)}class ow{constructor(h,y,{transformPagePoint:w,contextWindow:k=window,dragSnapToOrigin:A=!1,distanceThreshold:I=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Z=yy(this.lastMoveEventInfo,this.history),he=this.startEvent!==null,Te=VM(Z.offset,{x:0,y:0})>=this.distanceThreshold;if(!he&&!Te)return;const{point:ye}=Z,{timestamp:Me}=ms;this.history.push({...ye,timestamp:Me});const{onStart:Le,onMove:De}=this.handlers;he||(Le&&Le(this.lastMoveEvent,Z),this.startEvent=this.lastMoveEvent),De&&De(this.lastMoveEvent,Z)},this.handlePointerMove=(Z,he)=>{this.lastMoveEvent=Z,this.lastMoveEventInfo=gy(he,this.transformPagePoint),Qn.update(this.updatePoint,!0)},this.handlePointerUp=(Z,he)=>{this.end();const{onEnd:Te,onSessionEnd:ye,resumeAnimation:Me}=this.handlers;if(this.dragSnapToOrigin&&Me&&Me(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Le=yy(Z.type==="pointercancel"?this.lastMoveEventInfo:gy(he,this.transformPagePoint),this.history);this.startEvent&&Te&&Te(Z,Le),ye&&ye(Z,Le)},!N0(h))return;this.dragSnapToOrigin=A,this.handlers=y,this.transformPagePoint=w,this.distanceThreshold=I,this.contextWindow=k||window;const B=qf(h),i=gy(B,this.transformPagePoint),{point:R}=i,{timestamp:$}=ms;this.history=[{...R,timestamp:$}];const{onSessionStart:K}=y;K&&K(h,yy(i,this.history)),this.removeListeners=$f(Mf(this.contextWindow,"pointermove",this.handlePointerMove),Mf(this.contextWindow,"pointerup",this.handlePointerUp),Mf(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(h){this.handlers=h}end(){this.removeListeners&&this.removeListeners(),Bu(this.updatePoint)}}function gy(u,h){return h?{point:h(u.point)}:u}function Tv(u,h){return{x:u.x-h.x,y:u.y-h.y}}function yy({point:u},h){return{point:u,delta:Tv(u,lw(h)),offset:Tv(u,$M(h)),velocity:GM(h,.1)}}function $M(u){return u[0]}function lw(u){return u[u.length-1]}function GM(u,h){if(u.length<2)return{x:0,y:0};let y=u.length-1,w=null;const k=lw(u);for(;y>=0&&(w=u[y],!(k.timestamp-w.timestamp>$l(h)));)y--;if(!w)return{x:0,y:0};const A=Gl(k.timestamp-w.timestamp);if(A===0)return{x:0,y:0};const I={x:(k.x-w.x)/A,y:(k.y-w.y)/A};return I.x===1/0&&(I.x=0),I.y===1/0&&(I.y=0),I}function WM(u,{min:h,max:y},w){return h!==void 0&&u<h?u=w?li(h,u,w.min):Math.max(u,h):y!==void 0&&u>y&&(u=w?li(y,u,w.max):Math.min(u,y)),u}function kv(u,h,y){return{min:h!==void 0?u.min+h:void 0,max:y!==void 0?u.max+y-(u.max-u.min):void 0}}function qM(u,{top:h,left:y,bottom:w,right:k}){return{x:kv(u.x,y,k),y:kv(u.y,h,w)}}function Sv(u,h){let y=h.min-u.min,w=h.max-u.max;return h.max-h.min<u.max-u.min&&([y,w]=[w,y]),{min:y,max:w}}function ZM(u,h){return{x:Sv(u.x,h.x),y:Sv(u.y,h.y)}}function HM(u,h){let y=.5;const w=Ks(u),k=Ks(h);return k>w?y=Df(h.min,h.max-w,u.min):w>k&&(y=Df(u.min,u.max-k,h.min)),Vc(0,1,y)}function XM(u,h){const y={};return h.min!==void 0&&(y.min=h.min-u.min),h.max!==void 0&&(y.max=h.max-u.min),y}const Hy=.35;function KM(u=Hy){return u===!1?u=0:u===!0&&(u=Hy),{x:Ev(u,"left","right"),y:Ev(u,"top","bottom")}}function Ev(u,h,y){return{min:Cv(u,h),max:Cv(u,y)}}function Cv(u,h){return typeof u=="number"?u:u[h]||0}const YM=new WeakMap;class JM{constructor(h){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ki(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=h}start(h,{snapToCursor:y=!1,distanceThreshold:w}={}){const{presenceContext:k}=this.visualElement;if(k&&k.isPresent===!1)return;const A=K=>{const{dragSnapToOrigin:Z}=this.getProps();Z?this.pauseAnimation():this.stopAnimation(),y&&this.snapToCursor(qf(K).point)},I=(K,Z)=>{const{drag:he,dragPropagation:Te,onDragStart:ye}=this.getProps();if(he&&!Te&&(this.openDragLock&&this.openDragLock(),this.openDragLock=a3(he),!this.openDragLock))return;this.latestPointerEvent=K,this.latestPanInfo=Z,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),fo(Le=>{let De=this.getAxisMotionValue(Le).get()||0;if(Wl.test(De)){const{projection:Qe}=this.visualElement;if(Qe&&Qe.layout){const dt=Qe.layout.layoutBox[Le];dt&&(De=Ks(dt)*(parseFloat(De)/100))}}this.originPoint[Le]=De}),ye&&Qn.postRender(()=>ye(K,Z)),qy(this.visualElement,"transform");const{animationState:Me}=this.visualElement;Me&&Me.setActive("whileDrag",!0)},B=(K,Z)=>{this.latestPointerEvent=K,this.latestPanInfo=Z;const{dragPropagation:he,dragDirectionLock:Te,onDirectionLock:ye,onDrag:Me}=this.getProps();if(!he&&!this.openDragLock)return;const{offset:Le}=Z;if(Te&&this.currentDirection===null){this.currentDirection=QM(Le),this.currentDirection!==null&&ye&&ye(this.currentDirection);return}this.updateAxis("x",Z.point,Le),this.updateAxis("y",Z.point,Le),this.visualElement.render(),Me&&Me(K,Z)},i=(K,Z)=>{this.latestPointerEvent=K,this.latestPanInfo=Z,this.stop(K,Z),this.latestPointerEvent=null,this.latestPanInfo=null},R=()=>fo(K=>this.getAnimationState(K)==="paused"&&this.getAxisMotionValue(K).animation?.play()),{dragSnapToOrigin:$}=this.getProps();this.panSession=new ow(h,{onSessionStart:A,onStart:I,onMove:B,onSessionEnd:i,resumeAnimation:R},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:$,distanceThreshold:w,contextWindow:aw(this.visualElement)})}stop(h,y){const w=h||this.latestPointerEvent,k=y||this.latestPanInfo,A=this.isDragging;if(this.cancel(),!A||!k||!w)return;const{velocity:I}=k;this.startAnimation(I);const{onDragEnd:B}=this.getProps();B&&Qn.postRender(()=>B(w,k))}cancel(){this.isDragging=!1;const{projection:h,animationState:y}=this.visualElement;h&&(h.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:w}=this.getProps();!w&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),y&&y.setActive("whileDrag",!1)}updateAxis(h,y,w){const{drag:k}=this.getProps();if(!w||!Om(h,k,this.currentDirection))return;const A=this.getAxisMotionValue(h);let I=this.originPoint[h]+w[h];this.constraints&&this.constraints[h]&&(I=WM(I,this.constraints[h],this.elastic[h])),A.set(I)}resolveConstraints(){const{dragConstraints:h,dragElastic:y}=this.getProps(),w=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,k=this.constraints;h&&ip(h)?this.constraints||(this.constraints=this.resolveRefConstraints()):h&&w?this.constraints=qM(w.layoutBox,h):this.constraints=!1,this.elastic=KM(y),k!==this.constraints&&w&&this.constraints&&!this.hasMutatedConstraints&&fo(A=>{this.constraints!==!1&&this.getAxisMotionValue(A)&&(this.constraints[A]=XM(w.layoutBox[A],this.constraints[A]))})}resolveRefConstraints(){const{dragConstraints:h,onMeasureDragConstraints:y}=this.getProps();if(!h||!ip(h))return!1;const w=h.current,{projection:k}=this.visualElement;if(!k||!k.layout)return!1;const A=eM(w,k.root,this.visualElement.getTransformPagePoint());let I=ZM(k.layout.layoutBox,A);if(y){const B=y(Y3(I));this.hasMutatedConstraints=!!B,B&&(I=Wb(B))}return I}startAnimation(h){const{drag:y,dragMomentum:w,dragElastic:k,dragTransition:A,dragSnapToOrigin:I,onDragTransitionEnd:B}=this.getProps(),i=this.constraints||{},R=fo($=>{if(!Om($,y,this.currentDirection))return;let K=i&&i[$]||{};I&&(K={min:0,max:0});const Z=k?200:1e6,he=k?40:1e7,Te={type:"inertia",velocity:w?h[$]:0,bounceStiffness:Z,bounceDamping:he,timeConstant:750,restDelta:1,restSpeed:10,...A,...K};return this.startAxisValueAnimation($,Te)});return Promise.all(R).then(B)}startAxisValueAnimation(h,y){const w=this.getAxisMotionValue(h);return qy(this.visualElement,h),w.start($0(h,w,0,y,this.visualElement,!1))}stopAnimation(){fo(h=>this.getAxisMotionValue(h).stop())}pauseAnimation(){fo(h=>this.getAxisMotionValue(h).animation?.pause())}getAnimationState(h){return this.getAxisMotionValue(h).animation?.state}getAxisMotionValue(h){const y=`_drag${h.toUpperCase()}`,w=this.visualElement.getProps(),k=w[y];return k||this.visualElement.getValue(h,(w.initial?w.initial[h]:void 0)||0)}snapToCursor(h){fo(y=>{const{drag:w}=this.getProps();if(!Om(y,w,this.currentDirection))return;const{projection:k}=this.visualElement,A=this.getAxisMotionValue(y);if(k&&k.layout){const{min:I,max:B}=k.layout.layoutBox[y];A.set(h[y]-li(I,B,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:h,dragConstraints:y}=this.getProps(),{projection:w}=this.visualElement;if(!ip(y)||!w||!this.constraints)return;this.stopAnimation();const k={x:0,y:0};fo(I=>{const B=this.getAxisMotionValue(I);if(B&&this.constraints!==!1){const i=B.get();k[I]=HM({min:i,max:i},this.constraints[I])}});const{transformTemplate:A}=this.visualElement.getProps();this.visualElement.current.style.transform=A?A({},""):"none",w.root&&w.root.updateScroll(),w.updateLayout(),this.resolveConstraints(),fo(I=>{if(!Om(I,h,null))return;const B=this.getAxisMotionValue(I),{min:i,max:R}=this.constraints[I];B.set(li(i,R,k[I]))})}addListeners(){if(!this.visualElement.current)return;YM.set(this.visualElement,this);const h=this.visualElement.current,y=Mf(h,"pointerdown",i=>{const{drag:R,dragListener:$=!0}=this.getProps();R&&$&&this.start(i)}),w=()=>{const{dragConstraints:i}=this.getProps();ip(i)&&i.current&&(this.constraints=this.resolveRefConstraints())},{projection:k}=this.visualElement,A=k.addEventListener("measure",w);k&&!k.layout&&(k.root&&k.root.updateScroll(),k.updateLayout()),Qn.read(w);const I=Ff(window,"resize",()=>this.scalePositionWithinConstraints()),B=k.addEventListener("didUpdate",(({delta:i,hasLayoutChanged:R})=>{this.isDragging&&R&&(fo($=>{const K=this.getAxisMotionValue($);K&&(this.originPoint[$]+=i[$].translate,K.set(K.get()+i[$].translate))}),this.visualElement.render())}));return()=>{I(),y(),A(),B&&B()}}getProps(){const h=this.visualElement.getProps(),{drag:y=!1,dragDirectionLock:w=!1,dragPropagation:k=!1,dragConstraints:A=!1,dragElastic:I=Hy,dragMomentum:B=!0}=h;return{...h,drag:y,dragDirectionLock:w,dragPropagation:k,dragConstraints:A,dragElastic:I,dragMomentum:B}}}function Om(u,h,y){return(h===!0||h===u)&&(y===null||y===u)}function QM(u,h=10){let y=null;return Math.abs(u.y)>h?y="y":Math.abs(u.x)>h&&(y="x"),y}class eA extends Uu{constructor(h){super(h),this.removeGroupControls=mo,this.removeListeners=mo,this.controls=new JM(h)}mount(){const{dragControls:h}=this.node.getProps();h&&(this.removeGroupControls=h.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||mo}unmount(){this.removeGroupControls(),this.removeListeners()}}const Mv=u=>(h,y)=>{u&&Qn.postRender(()=>u(h,y))};class tA extends Uu{constructor(){super(...arguments),this.removePointerDownListener=mo}onPointerDown(h){this.session=new ow(h,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:aw(this.node)})}createPanHandlers(){const{onPanSessionStart:h,onPanStart:y,onPan:w,onPanEnd:k}=this.node.getProps();return{onSessionStart:Mv(h),onStart:Mv(y),onMove:w,onEnd:(A,I)=>{delete this.session,k&&Qn.postRender(()=>k(A,I))}}}mount(){this.removePointerDownListener=Mf(this.node.current,"pointerdown",h=>this.onPointerDown(h))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Xm={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Av(u,h){return h.max===h.min?0:u/(h.max-h.min)*100}const kf={correct:(u,h)=>{if(!h.target)return u;if(typeof u=="string")if(jr.test(u))u=parseFloat(u);else return u;const y=Av(u,h.target.x),w=Av(u,h.target.y);return`${y}% ${w}%`}},rA={correct:(u,{treeScale:h,projectionDelta:y})=>{const w=u,k=Fu.parse(u);if(k.length>5)return w;const A=Fu.createTransformer(u),I=typeof k[0]!="number"?1:0,B=y.x.scale*h.x,i=y.y.scale*h.y;k[0+I]/=B,k[1+I]/=i;const R=li(B,i,.5);return typeof k[2+I]=="number"&&(k[2+I]/=R),typeof k[3+I]=="number"&&(k[3+I]/=R),A(k)}};let xy=!1;class nA extends H.Component{componentDidMount(){const{visualElement:h,layoutGroup:y,switchLayoutGroup:w,layoutId:k}=this.props,{projection:A}=h;S3(iA),A&&(y.group&&y.group.add(A),w&&w.register&&k&&w.register(A),xy&&A.root.didUpdate(),A.addEventListener("animationComplete",()=>{this.safeToRemove()}),A.setOptions({...A.options,onExitComplete:()=>this.safeToRemove()})),Xm.hasEverUpdated=!0}getSnapshotBeforeUpdate(h){const{layoutDependency:y,visualElement:w,drag:k,isPresent:A}=this.props,{projection:I}=w;return I&&(I.isPresent=A,xy=!0,k||h.layoutDependency!==y||y===void 0||h.isPresent!==A?I.willUpdate():this.safeToRemove(),h.isPresent!==A&&(A?I.promote():I.relegate()||Qn.postRender(()=>{const B=I.getStack();(!B||!B.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:h}=this.props.visualElement;h&&(h.root.didUpdate(),j0.postRender(()=>{!h.currentAnimation&&h.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:h,layoutGroup:y,switchLayoutGroup:w}=this.props,{projection:k}=h;xy=!0,k&&(k.scheduleCheckAfterUnmount(),y&&y.group&&y.group.remove(k),w&&w.deregister&&w.deregister(k))}safeToRemove(){const{safeToRemove:h}=this.props;h&&h()}render(){return null}}function cw(u){const[h,y]=Ib(),w=H.useContext(u0);return m.jsx(nA,{...u,layoutGroup:w,switchLayoutGroup:H.useContext($b),isPresent:h,safeToRemove:y})}const iA={borderRadius:{...kf,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:kf,borderTopRightRadius:kf,borderBottomLeftRadius:kf,borderBottomRightRadius:kf,boxShadow:rA};function sA(u,h,y){const w=Ls(u)?u:pp(u);return w.start($0("",w,h,y)),w.animation}const aA=(u,h)=>u.depth-h.depth;class oA{constructor(){this.children=[],this.isDirty=!1}add(h){p0(this.children,h),this.isDirty=!0}remove(h){f0(this.children,h),this.isDirty=!0}forEach(h){this.isDirty&&this.children.sort(aA),this.isDirty=!1,this.children.forEach(h)}}function lA(u,h){const y=ga.now(),w=({timestamp:k})=>{const A=k-y;A>=h&&(Bu(w),u(A-h))};return Qn.setup(w,!0),()=>Bu(w)}const uw=["TopLeft","TopRight","BottomLeft","BottomRight"],cA=uw.length,Pv=u=>typeof u=="string"?parseFloat(u):u,Iv=u=>typeof u=="number"||jr.test(u);function uA(u,h,y,w,k,A){k?(u.opacity=li(0,y.opacity??1,hA(w)),u.opacityExit=li(h.opacity??1,0,dA(w))):A&&(u.opacity=li(h.opacity??1,y.opacity??1,w));for(let I=0;I<cA;I++){const B=`border${uw[I]}Radius`;let i=jv(h,B),R=jv(y,B);if(i===void 0&&R===void 0)continue;i||(i=0),R||(R=0),i===0||R===0||Iv(i)===Iv(R)?(u[B]=Math.max(li(Pv(i),Pv(R),w),0),(Wl.test(R)||Wl.test(i))&&(u[B]+="%")):u[B]=R}(h.rotate||y.rotate)&&(u.rotate=li(h.rotate||0,y.rotate||0,w))}function jv(u,h){return u[h]!==void 0?u[h]:u.borderRadius}const hA=hw(0,.5,Y1),dA=hw(.5,.95,mo);function hw(u,h,y){return w=>w<u?0:w>h?1:y(Df(u,h,w))}function Nv(u,h){u.min=h.min,u.max=h.max}function po(u,h){Nv(u.x,h.x),Nv(u.y,h.y)}function Dv(u,h){u.translate=h.translate,u.scale=h.scale,u.originPoint=h.originPoint,u.origin=h.origin}function Lv(u,h,y,w,k){return u-=h,u=ng(u,1/y,w),k!==void 0&&(u=ng(u,1/k,w)),u}function pA(u,h=0,y=1,w=.5,k,A=u,I=u){if(Wl.test(h)&&(h=parseFloat(h),h=li(I.min,I.max,h/100)-I.min),typeof h!="number")return;let B=li(A.min,A.max,w);u===A&&(B-=h),u.min=Lv(u.min,h,y,B,k),u.max=Lv(u.max,h,y,B,k)}function Rv(u,h,[y,w,k],A,I){pA(u,h[y],h[w],h[k],h.scale,A,I)}const fA=["x","scaleX","originX"],mA=["y","scaleY","originY"];function zv(u,h,y,w){Rv(u.x,h,fA,y?y.x:void 0,w?w.x:void 0),Rv(u.y,h,mA,y?y.y:void 0,w?w.y:void 0)}function Bv(u){return u.translate===0&&u.scale===1}function dw(u){return Bv(u.x)&&Bv(u.y)}function Fv(u,h){return u.min===h.min&&u.max===h.max}function gA(u,h){return Fv(u.x,h.x)&&Fv(u.y,h.y)}function Ov(u,h){return Math.round(u.min)===Math.round(h.min)&&Math.round(u.max)===Math.round(h.max)}function pw(u,h){return Ov(u.x,h.x)&&Ov(u.y,h.y)}function Uv(u){return Ks(u.x)/Ks(u.y)}function Vv(u,h){return u.translate===h.translate&&u.scale===h.scale&&u.originPoint===h.originPoint}class yA{constructor(){this.members=[]}add(h){p0(this.members,h),h.scheduleRender()}remove(h){if(f0(this.members,h),h===this.prevLead&&(this.prevLead=void 0),h===this.lead){const y=this.members[this.members.length-1];y&&this.promote(y)}}relegate(h){const y=this.members.findIndex(k=>h===k);if(y===0)return!1;let w;for(let k=y;k>=0;k--){const A=this.members[k];if(A.isPresent!==!1){w=A;break}}return w?(this.promote(w),!0):!1}promote(h,y){const w=this.lead;if(h!==w&&(this.prevLead=w,this.lead=h,h.show(),w)){w.instance&&w.scheduleRender(),h.scheduleRender(),h.resumeFrom=w,y&&(h.resumeFrom.preserveOpacity=!0),w.snapshot&&(h.snapshot=w.snapshot,h.snapshot.latestValues=w.animationValues||w.latestValues),h.root&&h.root.isUpdating&&(h.isLayoutDirty=!0);const{crossfade:k}=h.options;k===!1&&w.hide()}}exitAnimationComplete(){this.members.forEach(h=>{const{options:y,resumingFrom:w}=h;y.onExitComplete&&y.onExitComplete(),w&&w.options.onExitComplete&&w.options.onExitComplete()})}scheduleRender(){this.members.forEach(h=>{h.instance&&h.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function xA(u,h,y){let w="";const k=u.x.translate/h.x,A=u.y.translate/h.y,I=y?.z||0;if((k||A||I)&&(w=`translate3d(${k}px, ${A}px, ${I}px) `),(h.x!==1||h.y!==1)&&(w+=`scale(${1/h.x}, ${1/h.y}) `),y){const{transformPerspective:R,rotate:$,rotateX:K,rotateY:Z,skewX:he,skewY:Te}=y;R&&(w=`perspective(${R}px) ${w}`),$&&(w+=`rotate(${$}deg) `),K&&(w+=`rotateX(${K}deg) `),Z&&(w+=`rotateY(${Z}deg) `),he&&(w+=`skewX(${he}deg) `),Te&&(w+=`skewY(${Te}deg) `)}const B=u.x.scale*h.x,i=u.y.scale*h.y;return(B!==1||i!==1)&&(w+=`scale(${B}, ${i})`),w||"none"}const _y=["","X","Y","Z"],_A=1e3;let vA=0;function vy(u,h,y,w){const{latestValues:k}=h;k[u]&&(y[u]=k[u],h.setStaticValue(u,0),w&&(w[u]=0))}function fw(u){if(u.hasCheckedOptimisedAppear=!0,u.root===u)return;const{visualElement:h}=u.options;if(!h)return;const y=Qb(h);if(window.MotionHasOptimisedAnimation(y,"transform")){const{layout:k,layoutId:A}=u.options;window.MotionCancelOptimisedAnimation(y,"transform",Qn,!(k||A))}const{parent:w}=u;w&&!w.hasCheckedOptimisedAppear&&fw(w)}function mw({attachResizeListener:u,defaultParent:h,measureScroll:y,checkIsScrollRoot:w,resetTransform:k}){return class{constructor(I={},B=h?.()){this.id=vA++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(TA),this.nodes.forEach(CA),this.nodes.forEach(MA),this.nodes.forEach(kA)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=I,this.root=B?B.root||B:this,this.path=B?[...B.path,B]:[],this.parent=B,this.depth=B?B.depth+1:0;for(let i=0;i<this.path.length;i++)this.path[i].shouldResetTransform=!0;this.root===this&&(this.nodes=new oA)}addEventListener(I,B){return this.eventHandlers.has(I)||this.eventHandlers.set(I,new y0),this.eventHandlers.get(I).add(B)}notifyListeners(I,...B){const i=this.eventHandlers.get(I);i&&i.notify(...B)}hasListeners(I){return this.eventHandlers.has(I)}mount(I){if(this.instance)return;this.isSVG=Pb(I)&&!d3(I),this.instance=I;const{layoutId:B,layout:i,visualElement:R}=this.options;if(R&&!R.current&&R.mount(I),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(i||B)&&(this.isLayoutDirty=!0),u){let $,K=0;const Z=()=>this.root.updateBlockedByResize=!1;Qn.read(()=>{K=window.innerWidth}),u(I,()=>{const he=window.innerWidth;he!==K&&(K=he,this.root.updateBlockedByResize=!0,$&&$(),$=lA(Z,250),Xm.hasAnimatedSinceResize&&(Xm.hasAnimatedSinceResize=!1,this.nodes.forEach(Wv)))})}B&&this.root.registerSharedNode(B,this),this.options.animate!==!1&&R&&(B||i)&&this.addEventListener("didUpdate",({delta:$,hasLayoutChanged:K,hasRelativeLayoutChanged:Z,layout:he})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const Te=this.options.transition||R.getDefaultTransition()||NA,{onLayoutAnimationStart:ye,onLayoutAnimationComplete:Me}=R.getProps(),Le=!this.targetLayout||!pw(this.targetLayout,he),De=!K&&Z;if(this.options.layoutRoot||this.resumeFrom||De||K&&(Le||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const Qe={...P0(Te,"layout"),onPlay:ye,onComplete:Me};(R.shouldReduceMotion||this.options.layoutRoot)&&(Qe.delay=0,Qe.type=!1),this.startAnimation(Qe),this.setAnimationOrigin($,De)}else K||Wv(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=he})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const I=this.getStack();I&&I.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Bu(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(AA),this.animationId++)}getTransformTemplate(){const{visualElement:I}=this.options;return I&&I.getProps().transformTemplate}willUpdate(I=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&fw(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let $=0;$<this.path.length;$++){const K=this.path[$];K.shouldResetTransform=!0,K.updateScroll("snapshot"),K.options.layoutRoot&&K.willUpdate(!1)}const{layoutId:B,layout:i}=this.options;if(B===void 0&&!i)return;const R=this.getTransformTemplate();this.prevTransformTemplateValue=R?R(this.latestValues,""):void 0,this.updateSnapshot(),I&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach($v);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Gv);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(EA),this.nodes.forEach(bA),this.nodes.forEach(wA)):this.nodes.forEach(Gv),this.clearAllSnapshots();const B=ga.now();ms.delta=Vc(0,1e3/60,B-ms.timestamp),ms.timestamp=B,ms.isProcessing=!0,ly.update.process(ms),ly.preRender.process(ms),ly.render.process(ms),ms.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,j0.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(SA),this.sharedNodes.forEach(PA)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Qn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Qn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Ks(this.snapshot.measuredBox.x)&&!Ks(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let i=0;i<this.path.length;i++)this.path[i].updateScroll();const I=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ki(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:B}=this.options;B&&B.notify("LayoutMeasure",this.layout.layoutBox,I?I.layoutBox:void 0)}updateScroll(I="measure"){let B=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===I&&(B=!1),B&&this.instance){const i=w(this.instance);this.scroll={animationId:this.root.animationId,phase:I,isRoot:i,offset:y(this.instance),wasRoot:this.scroll?this.scroll.isRoot:i}}}resetTransform(){if(!k)return;const I=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,B=this.projectionDelta&&!dw(this.projectionDelta),i=this.getTransformTemplate(),R=i?i(this.latestValues,""):void 0,$=R!==this.prevTransformTemplateValue;I&&this.instance&&(B||Hh(this.latestValues)||$)&&(k(this.instance,R),this.shouldResetTransform=!1,this.scheduleRender())}measure(I=!0){const B=this.measurePageBox();let i=this.removeElementScroll(B);return I&&(i=this.removeTransform(i)),DA(i),{animationId:this.root.animationId,measuredBox:B,layoutBox:i,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:I}=this.options;if(!I)return ki();const B=I.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(LA))){const{scroll:R}=this.root;R&&(sp(B.x,R.offset.x),sp(B.y,R.offset.y))}return B}removeElementScroll(I){const B=ki();if(po(B,I),this.scroll?.wasRoot)return B;for(let i=0;i<this.path.length;i++){const R=this.path[i],{scroll:$,options:K}=R;R!==this.root&&$&&K.layoutScroll&&($.wasRoot&&po(B,I),sp(B.x,$.offset.x),sp(B.y,$.offset.y))}return B}applyTransform(I,B=!1){const i=ki();po(i,I);for(let R=0;R<this.path.length;R++){const $=this.path[R];!B&&$.options.layoutScroll&&$.scroll&&$!==$.root&&ap(i,{x:-$.scroll.offset.x,y:-$.scroll.offset.y}),Hh($.latestValues)&&ap(i,$.latestValues)}return Hh(this.latestValues)&&ap(i,this.latestValues),i}removeTransform(I){const B=ki();po(B,I);for(let i=0;i<this.path.length;i++){const R=this.path[i];if(!R.instance||!Hh(R.latestValues))continue;Vy(R.latestValues)&&R.updateSnapshot();const $=ki(),K=R.measurePageBox();po($,K),zv(B,R.latestValues,R.snapshot?R.snapshot.layoutBox:void 0,$)}return Hh(this.latestValues)&&zv(B,this.latestValues),B}setTargetDelta(I){this.targetDelta=I,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(I){this.options={...this.options,...I,crossfade:I.crossfade!==void 0?I.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ms.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(I=!1){const B=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=B.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=B.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=B.isSharedProjectionDirty);const i=!!this.resumingFrom||this!==B;if(!(I||i&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:$,layoutId:K}=this.options;if(!(!this.layout||!($||K))){if(this.resolvedRelativeTargetAt=ms.timestamp,!this.targetDelta&&!this.relativeTarget){const Z=this.getClosestProjectingParent();Z&&Z.layout&&this.animationProgress!==1?(this.relativeParent=Z,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ki(),this.relativeTargetOrigin=ki(),Pf(this.relativeTargetOrigin,this.layout.layoutBox,Z.layout.layoutBox),po(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ki(),this.targetWithTransforms=ki()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),UM(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):po(this.target,this.layout.layoutBox),Zb(this.target,this.targetDelta)):po(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const Z=this.getClosestProjectingParent();Z&&!!Z.resumingFrom==!!this.resumingFrom&&!Z.options.layoutScroll&&Z.target&&this.animationProgress!==1?(this.relativeParent=Z,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ki(),this.relativeTargetOrigin=ki(),Pf(this.relativeTargetOrigin,this.target,Z.target),po(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||Vy(this.parent.latestValues)||qb(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const I=this.getLead(),B=!!this.resumingFrom||this!==I;let i=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(i=!1),B&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(i=!1),this.resolvedRelativeTargetAt===ms.timestamp&&(i=!1),i)return;const{layout:R,layoutId:$}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(R||$))return;po(this.layoutCorrected,this.layout.layoutBox);const K=this.treeScale.x,Z=this.treeScale.y;Q3(this.layoutCorrected,this.treeScale,this.path,B),I.layout&&!I.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(I.target=I.layout.layoutBox,I.targetWithTransforms=ki());const{target:he}=I;if(!he){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Dv(this.prevProjectionDelta.x,this.projectionDelta.x),Dv(this.prevProjectionDelta.y,this.projectionDelta.y)),Af(this.projectionDelta,this.layoutCorrected,he,this.latestValues),(this.treeScale.x!==K||this.treeScale.y!==Z||!Vv(this.projectionDelta.x,this.prevProjectionDelta.x)||!Vv(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",he))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(I=!0){if(this.options.visualElement?.scheduleRender(),I){const B=this.getStack();B&&B.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=op(),this.projectionDelta=op(),this.projectionDeltaWithTransform=op()}setAnimationOrigin(I,B=!1){const i=this.snapshot,R=i?i.latestValues:{},$={...this.latestValues},K=op();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!B;const Z=ki(),he=i?i.source:void 0,Te=this.layout?this.layout.source:void 0,ye=he!==Te,Me=this.getStack(),Le=!Me||Me.members.length<=1,De=!!(ye&&!Le&&this.options.crossfade===!0&&!this.path.some(jA));this.animationProgress=0;let Qe;this.mixTargetDelta=dt=>{const St=dt/1e3;qv(K.x,I.x,St),qv(K.y,I.y,St),this.setTargetDelta(K),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Pf(Z,this.layout.layoutBox,this.relativeParent.layout.layoutBox),IA(this.relativeTarget,this.relativeTargetOrigin,Z,St),Qe&&gA(this.relativeTarget,Qe)&&(this.isProjectionDirty=!1),Qe||(Qe=ki()),po(Qe,this.relativeTarget)),ye&&(this.animationValues=$,uA($,R,this.latestValues,St,De,Le)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=St},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(I){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Bu(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Qn.update(()=>{Xm.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=pp(0)),this.currentAnimation=sA(this.motionValue,[0,1e3],{...I,velocity:0,isSync:!0,onUpdate:B=>{this.mixTargetDelta(B),I.onUpdate&&I.onUpdate(B)},onStop:()=>{},onComplete:()=>{I.onComplete&&I.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const I=this.getStack();I&&I.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(_A),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const I=this.getLead();let{targetWithTransforms:B,target:i,layout:R,latestValues:$}=I;if(!(!B||!i||!R)){if(this!==I&&this.layout&&R&&gw(this.options.animationType,this.layout.layoutBox,R.layoutBox)){i=this.target||ki();const K=Ks(this.layout.layoutBox.x);i.x.min=I.target.x.min,i.x.max=i.x.min+K;const Z=Ks(this.layout.layoutBox.y);i.y.min=I.target.y.min,i.y.max=i.y.min+Z}po(B,i),ap(B,$),Af(this.projectionDeltaWithTransform,this.layoutCorrected,B,$)}}registerSharedNode(I,B){this.sharedNodes.has(I)||this.sharedNodes.set(I,new yA),this.sharedNodes.get(I).add(B);const R=B.options.initialPromotionConfig;B.promote({transition:R?R.transition:void 0,preserveFollowOpacity:R&&R.shouldPreserveFollowOpacity?R.shouldPreserveFollowOpacity(B):void 0})}isLead(){const I=this.getStack();return I?I.lead===this:!0}getLead(){const{layoutId:I}=this.options;return I?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:I}=this.options;return I?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:I}=this.options;if(I)return this.root.sharedNodes.get(I)}promote({needsReset:I,transition:B,preserveFollowOpacity:i}={}){const R=this.getStack();R&&R.promote(this,i),I&&(this.projectionDelta=void 0,this.needsReset=!0),B&&this.setOptions({transition:B})}relegate(){const I=this.getStack();return I?I.relegate(this):!1}resetSkewAndRotation(){const{visualElement:I}=this.options;if(!I)return;let B=!1;const{latestValues:i}=I;if((i.z||i.rotate||i.rotateX||i.rotateY||i.rotateZ||i.skewX||i.skewY)&&(B=!0),!B)return;const R={};i.z&&vy("z",I,R,this.animationValues);for(let $=0;$<_y.length;$++)vy(`rotate${_y[$]}`,I,R,this.animationValues),vy(`skew${_y[$]}`,I,R,this.animationValues);I.render();for(const $ in R)I.setStaticValue($,R[$]),this.animationValues&&(this.animationValues[$]=R[$]);I.scheduleRender()}applyProjectionStyles(I,B){if(!this.instance||this.isSVG)return;if(!this.isVisible){I.visibility="hidden";return}const i=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,I.visibility="",I.opacity="",I.pointerEvents=Hm(B?.pointerEvents)||"",I.transform=i?i(this.latestValues,""):"none";return}const R=this.getLead();if(!this.projectionDelta||!this.layout||!R.target){this.options.layoutId&&(I.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,I.pointerEvents=Hm(B?.pointerEvents)||""),this.hasProjected&&!Hh(this.latestValues)&&(I.transform=i?i({},""):"none",this.hasProjected=!1);return}I.visibility="";const $=R.animationValues||R.latestValues;this.applyTransformsToTarget();let K=xA(this.projectionDeltaWithTransform,this.treeScale,$);i&&(K=i($,K)),I.transform=K;const{x:Z,y:he}=this.projectionDelta;I.transformOrigin=`${Z.origin*100}% ${he.origin*100}% 0`,R.animationValues?I.opacity=R===this?$.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:$.opacityExit:I.opacity=R===this?$.opacity!==void 0?$.opacity:"":$.opacityExit!==void 0?$.opacityExit:0;for(const Te in Bf){if($[Te]===void 0)continue;const{correct:ye,applyTo:Me,isCSSVariable:Le}=Bf[Te],De=K==="none"?$[Te]:ye($[Te],R);if(Me){const Qe=Me.length;for(let dt=0;dt<Qe;dt++)I[Me[dt]]=De}else Le?this.options.visualElement.renderState.vars[Te]=De:I[Te]=De}this.options.layoutId&&(I.pointerEvents=R===this?Hm(B?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(I=>I.currentAnimation?.stop()),this.root.nodes.forEach($v),this.root.sharedNodes.clear()}}}function bA(u){u.updateLayout()}function wA(u){const h=u.resumeFrom?.snapshot||u.snapshot;if(u.isLead()&&u.layout&&h&&u.hasListeners("didUpdate")){const{layoutBox:y,measuredBox:w}=u.layout,{animationType:k}=u.options,A=h.source!==u.layout.source;k==="size"?fo($=>{const K=A?h.measuredBox[$]:h.layoutBox[$],Z=Ks(K);K.min=y[$].min,K.max=K.min+Z}):gw(k,h.layoutBox,y)&&fo($=>{const K=A?h.measuredBox[$]:h.layoutBox[$],Z=Ks(y[$]);K.max=K.min+Z,u.relativeTarget&&!u.currentAnimation&&(u.isProjectionDirty=!0,u.relativeTarget[$].max=u.relativeTarget[$].min+Z)});const I=op();Af(I,y,h.layoutBox);const B=op();A?Af(B,u.applyTransform(w,!0),h.measuredBox):Af(B,y,h.layoutBox);const i=!dw(I);let R=!1;if(!u.resumeFrom){const $=u.getClosestProjectingParent();if($&&!$.resumeFrom){const{snapshot:K,layout:Z}=$;if(K&&Z){const he=ki();Pf(he,h.layoutBox,K.layoutBox);const Te=ki();Pf(Te,y,Z.layoutBox),pw(he,Te)||(R=!0),$.options.layoutRoot&&(u.relativeTarget=Te,u.relativeTargetOrigin=he,u.relativeParent=$)}}}u.notifyListeners("didUpdate",{layout:y,snapshot:h,delta:B,layoutDelta:I,hasLayoutChanged:i,hasRelativeLayoutChanged:R})}else if(u.isLead()){const{onExitComplete:y}=u.options;y&&y()}u.options.transition=void 0}function TA(u){u.parent&&(u.isProjecting()||(u.isProjectionDirty=u.parent.isProjectionDirty),u.isSharedProjectionDirty||(u.isSharedProjectionDirty=!!(u.isProjectionDirty||u.parent.isProjectionDirty||u.parent.isSharedProjectionDirty)),u.isTransformDirty||(u.isTransformDirty=u.parent.isTransformDirty))}function kA(u){u.isProjectionDirty=u.isSharedProjectionDirty=u.isTransformDirty=!1}function SA(u){u.clearSnapshot()}function $v(u){u.clearMeasurements()}function Gv(u){u.isLayoutDirty=!1}function EA(u){const{visualElement:h}=u.options;h&&h.getProps().onBeforeLayoutMeasure&&h.notify("BeforeLayoutMeasure"),u.resetTransform()}function Wv(u){u.finishAnimation(),u.targetDelta=u.relativeTarget=u.target=void 0,u.isProjectionDirty=!0}function CA(u){u.resolveTargetDelta()}function MA(u){u.calcProjection()}function AA(u){u.resetSkewAndRotation()}function PA(u){u.removeLeadSnapshot()}function qv(u,h,y){u.translate=li(h.translate,0,y),u.scale=li(h.scale,1,y),u.origin=h.origin,u.originPoint=h.originPoint}function Zv(u,h,y,w){u.min=li(h.min,y.min,w),u.max=li(h.max,y.max,w)}function IA(u,h,y,w){Zv(u.x,h.x,y.x,w),Zv(u.y,h.y,y.y,w)}function jA(u){return u.animationValues&&u.animationValues.opacityExit!==void 0}const NA={duration:.45,ease:[.4,0,.1,1]},Hv=u=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(u),Xv=Hv("applewebkit/")&&!Hv("chrome/")?Math.round:mo;function Kv(u){u.min=Xv(u.min),u.max=Xv(u.max)}function DA(u){Kv(u.x),Kv(u.y)}function gw(u,h,y){return u==="position"||u==="preserve-aspect"&&!OM(Uv(h),Uv(y),.2)}function LA(u){return u!==u.root&&u.scroll?.wasRoot}const RA=mw({attachResizeListener:(u,h)=>Ff(u,"resize",h),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),by={current:void 0},yw=mw({measureScroll:u=>({x:u.scrollLeft,y:u.scrollTop}),defaultParent:()=>{if(!by.current){const u=new RA({});u.mount(window),u.setOptions({layoutScroll:!0}),by.current=u}return by.current},resetTransform:(u,h)=>{u.style.transform=h!==void 0?h:"none"},checkIsScrollRoot:u=>window.getComputedStyle(u).position==="fixed"}),zA={pan:{Feature:tA},drag:{Feature:eA,ProjectionNode:yw,MeasureLayout:cw}};function Yv(u,h,y){const{props:w}=u;u.animationState&&w.whileHover&&u.animationState.setActive("whileHover",y==="Start");const k="onHover"+y,A=w[k];A&&Qn.postRender(()=>A(h,qf(h)))}class BA extends Uu{mount(){const{current:h}=this.node;h&&(this.unmount=o3(h,(y,w)=>(Yv(this.node,w,"Start"),k=>Yv(this.node,k,"End"))))}unmount(){}}class FA extends Uu{constructor(){super(...arguments),this.isActive=!1}onFocus(){let h=!1;try{h=this.node.current.matches(":focus-visible")}catch{h=!0}!h||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=$f(Ff(this.node.current,"focus",()=>this.onFocus()),Ff(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Jv(u,h,y){const{props:w}=u;if(u.current instanceof HTMLButtonElement&&u.current.disabled)return;u.animationState&&w.whileTap&&u.animationState.setActive("whileTap",y==="Start");const k="onTap"+(y==="End"?"":y),A=w[k];A&&Qn.postRender(()=>A(h,qf(h)))}class OA extends Uu{mount(){const{current:h}=this.node;h&&(this.unmount=h3(h,(y,w)=>(Jv(this.node,w,"Start"),(k,{success:A})=>Jv(this.node,k,A?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Xy=new WeakMap,wy=new WeakMap,UA=u=>{const h=Xy.get(u.target);h&&h(u)},VA=u=>{u.forEach(UA)};function $A({root:u,...h}){const y=u||document;wy.has(y)||wy.set(y,{});const w=wy.get(y),k=JSON.stringify(h);return w[k]||(w[k]=new IntersectionObserver(VA,{root:u,...h})),w[k]}function GA(u,h,y){const w=$A(h);return Xy.set(u,y),w.observe(u),()=>{Xy.delete(u),w.unobserve(u)}}const WA={some:0,all:1};class qA extends Uu{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:h={}}=this.node.getProps(),{root:y,margin:w,amount:k="some",once:A}=h,I={root:y?y.current:void 0,rootMargin:w,threshold:typeof k=="number"?k:WA[k]},B=i=>{const{isIntersecting:R}=i;if(this.isInView===R||(this.isInView=R,A&&!R&&this.hasEnteredView))return;R&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",R);const{onViewportEnter:$,onViewportLeave:K}=this.node.getProps(),Z=R?$:K;Z&&Z(i)};return GA(this.node.current,I,B)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:h,prevProps:y}=this.node;["amount","margin","root"].some(ZA(h,y))&&this.startObserver()}unmount(){}}function ZA({viewport:u={}},{viewport:h={}}={}){return y=>u[y]!==h[y]}const HA={inView:{Feature:qA},tap:{Feature:OA},focus:{Feature:FA},hover:{Feature:BA}},XA={layout:{ProjectionNode:yw,MeasureLayout:cw}},KA={...DM,...HA,...zA,...XA},wt=K3(KA,cM),xw=({bus:u,route:h,onClick:y,isSelected:w,isMobile:k=!1})=>m.jsx(Zo,{longitude:u.lng,latitude:u.lat,children:m.jsxs(wt.div,{className:"relative cursor-pointer group",initial:{scale:0,rotate:-180},animate:{scale:w?1.2:1,rotate:0},whileHover:{scale:w?1.3:1.1},whileTap:{scale:.95},transition:{type:"spring",stiffness:300,damping:20,scale:{duration:.3}},layout:!0,onClick:y,title:`Click to view details for ${h?.shortName||"Bus"} ${u.vehicle_number||u.id}`,children:[m.jsxs(wt.div,{className:`${k?"w-9 h-9":"w-12 h-12"} rounded-xl shadow-xl border-2 border-white flex items-center justify-center relative transition-all duration-200 ${w?"ring-2 ring-white ring-opacity-50":""} group-hover:shadow-2xl group-hover:scale-105`,style:{backgroundColor:h?.color||"#0ea5e9"},animate:{boxShadow:w?"0 8px 25px rgba(0, 0, 0, 0.3)":"0 4px 15px rgba(0, 0, 0, 0.2)"},children:[m.jsxs(wt.svg,{width:k?"16":"20",height:k?"16":"20",viewBox:"0 0 24 24",fill:"none",className:"text-white",animate:{scale:u.speed>0?[1,1.1,1]:1},transition:{duration:1,repeat:u.speed>0?Number.POSITIVE_INFINITY:0},children:[m.jsx("path",{d:"M4 16c0 .88.39 1.67 1 2.22V20a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1v-1h8v1a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1v-1.78c.61-.55 1-1.34 1-2.22V6c0-3.5-3.58-4-8-4s-8 .5-8 4v10Z",fill:"currentColor"}),m.jsx("circle",{cx:"6.5",cy:"15.5",r:"1.5",fill:"white"}),m.jsx("circle",{cx:"17.5",cy:"15.5",r:"1.5",fill:"white"}),m.jsx("path",{d:"M4 7h16v5H4V7Z",fill:"white",fillOpacity:"0.3"})]}),m.jsx(wt.div,{className:"absolute -top-1 -right-1 w-3.5 h-3.5 bg-white rounded-full border border-gray-300 flex items-center justify-center",animate:{rotate:u.heading},transition:{duration:.5,ease:"easeInOut"},style:{transformOrigin:"center"},children:m.jsx("div",{className:"w-1.5 h-1.5 bg-gray-700 rounded-full"})}),u.speed>5&&m.jsx(wt.div,{className:"absolute -top-2 -left-2 w-2 h-2 bg-green-400 rounded-full",animate:{scale:[1,1.3,1],opacity:[1,.7,1]},transition:{duration:1,repeat:Number.POSITIVE_INFINITY,ease:"easeInOut"}})]}),m.jsx(Ln,{children:m.jsx(wt.div,{className:"absolute -bottom-6 left-1/2 transform -translate-x-1/2 bg-white dark:bg-gray-800 px-2 py-1 rounded text-[10px] md:text-xs font-medium shadow-md border border-gray-200 dark:border-gray-700 whitespace-nowrap",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:.2},children:m.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:h?.shortName||"BUS"})})}),u.speed>0&&m.jsx(wt.div,{className:"absolute inset-0 rounded-lg border-2",style:{borderColor:h?.color||"#0ea5e9"},animate:{scale:[1,1.8,1],opacity:[.7,0,.7]},transition:{duration:2.5,repeat:Number.POSITIVE_INFINITY,ease:"easeInOut"}}),w&&m.jsx(wt.div,{className:"absolute inset-0 rounded-lg border-2 border-white",initial:{scale:1.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},transition:{duration:.3}})]})});class YA{constructor(){this.buses=new Map,this.routes=[],this.isRunning=!1,this.intervalId=null,this.updateInterval=5e3}async initialize(){if(!this.isRunning)try{this.routes=[{id:"route-38",name:"Meskel Square to Piazza",shortName:"38",color:"#1e40af",type:"bus",description:"Addis Ababa City Bus",stops:[{id:"stop-1",name:"Meskel Square",lat:9.0054,lng:38.7636},{id:"stop-2",name:"Piazza",lat:9.0154,lng:38.7736},{id:"stop-3",name:"CMC Terminal",lat:9.0254,lng:38.7836}]},{id:"route-91",name:"Bole to Kazanchis",shortName:"91",color:"#f59e0b",type:"bus",description:"Addis Ababa City Bus",stops:[{id:"stop-4",name:"Bole Airport",lat:8.9954,lng:38.7536},{id:"stop-5",name:"Kazanchis",lat:9.0054,lng:38.7436}]},{id:"route-12",name:"Merkato to Arat Kilo",shortName:"12",color:"#16a34a",type:"bus",description:"Addis Ababa City Bus",stops:[{id:"stop-6",name:"Merkato",lat:8.9854,lng:38.7236},{id:"stop-7",name:"Arat Kilo",lat:9.0154,lng:38.7536}]},{id:"route-23",name:"Current Location",shortName:"23",color:"#dc2626",type:"bus",description:"Addis Ababa City Bus",stops:[{id:"stop-8",name:"Current Location",lat:9.0054,lng:38.7636},{id:"stop-9",name:"National Theatre",lat:9.0054,lng:38.7436}]},{id:"route-07",name:"CMC to Bole",shortName:"07",color:"#8b5cf6",type:"bus",description:"Addis Ababa City Bus",stops:[{id:"stop-10",name:"CMC",lat:9.03,lng:38.8},{id:"stop-11",name:"Bole",lat:8.999,lng:38.78}]},{id:"route-35",name:"Piazza to Mexico",shortName:"35",color:"#0ea5e9",type:"bus",description:"Addis Ababa City Bus",stops:[{id:"stop-12",name:"Piazza",lat:9.0154,lng:38.7736},{id:"stop-13",name:"Mexico Square",lat:9.0085,lng:38.746}]}],this.createBuses(),this.start()}catch(h){console.error("Failed to initialize bus simulation:",h)}}createBuses(){this.routes.forEach(h=>{if(h.stops&&h.stops.length>=2){const y=Math.floor(Math.random()*2)+2;for(let w=1;w<=y;w++){const k=`bus-${h.shortName}-${w}`,A=this.createBus(k,h,w);this.buses.set(k,A)}}})}createBus(h,y,w){const k=y.stops,A=Math.floor(Math.random()*k.length),I=k[A];return{id:h,routeId:y.id,vehicleNumber:`${y.shortName}${w.toString().padStart(2,"0")}`,driver:this.getRandomDriver(),operator:this.getRandomOperator(),busType:this.getRandomBusType(),mengedCompatible:Math.random()>.3,lat:I.lat,lng:I.lng,heading:0,speed:0,capacity:40,occupancy:Math.floor(Math.random()*40),currentStopIndex:A,nextStopIndex:(A+1)%k.length,nextStop:k[(A+1)%k.length].name,eta:this.calculateETA(k[A],k[(A+1)%k.length]),lastUpdated:new Date,isMoving:!1,progress:0,route:y}}getRandomDriver(){const h=["Alemayehu","Meron","Tigist","Yonas","Eleni","Dawit","Kebede","Selam","Abebe","Mulu","Tewodros","Hirut"],y=["Tesfaye","Kebede","Assefa","Mengistu","Tadesse","Girma","Hailu","Worku","Getachew","Bekele"],w=h[Math.floor(Math.random()*h.length)],k=y[Math.floor(Math.random()*y.length)];return`${w} ${k}`}getRandomOperator(){const h=["Anbessa","Sheger","Velocity"];return h[Math.floor(Math.random()*h.length)]}getRandomBusType(){const h=["Standard","Articulated","Mini"];return h[Math.floor(Math.random()*h.length)]}calculateETA(h,y){const w=this.calculateDistance(h.lat,h.lng,y.lat,y.lng),k=15+Math.random()*10;return`${Math.round(w/k*60)} min`}calculateDistance(h,y,w,k){const I=(w-h)*Math.PI/180,B=(k-y)*Math.PI/180,i=Math.sin(I/2)*Math.sin(I/2)+Math.cos(h*Math.PI/180)*Math.cos(w*Math.PI/180)*Math.sin(B/2)*Math.sin(B/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}start(){this.isRunning||(this.isRunning=!0,this.intervalId=setInterval(()=>{this.updateBuses()},this.updateInterval),console.log("Bus simulation started"))}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.isRunning=!1,console.log("Bus simulation stopped")}updateBuses(){this.buses.forEach(h=>{this.updateBus(h)})}updateBus(h){const w=h.route.stops;if(w.length<2)return;w[h.currentStopIndex];const k=w[h.nextStopIndex];this.calculateDistance(h.lat,h.lng,k.lat,k.lng)<.01?this.arriveAtStop(h):this.moveTowardsStop(h,k),h.lastUpdated=new Date}moveTowardsStop(h,y){const w=35e-5+Math.random()*45e-5,k=y.lat-h.lat,A=y.lng-h.lng,I=Math.sqrt(k*k+A*A);if(I>0){h.lat+=k/I*w,h.lng+=A/I*w,h.heading=Math.atan2(A,k)*180/Math.PI,h.speed=Math.max(10,Math.round(w*111e3)),h.isMoving=!0;const B=h.route.stops[h.currentStopIndex],i=this.calculateDistance(B.lat,B.lng,y.lat,y.lng),R=this.calculateDistance(h.lat,h.lng,y.lat,y.lng);h.progress=i>0?Math.min(1,(i-R)/i):0}}arriveAtStop(h){const w=h.route.stops;h.currentStopIndex=h.nextStopIndex,h.nextStopIndex=(h.nextStopIndex+1)%w.length;const k=w[h.currentStopIndex];h.lat=k.lat,h.lng=k.lng;const A=w[h.nextStopIndex];h.nextStop=A.name,h.eta=this.calculateETA(k,A),h.progress=0,h.speed=0,h.isMoving=!1,h.occupancy=Math.floor(Math.random()*h.capacity),console.log(`Bus ${h.vehicleNumber} arrived at ${k.name}, next: ${A.name}`)}getBuses(){return Array.from(this.buses.values())}getBusesForRoute(h){return this.getBuses().filter(y=>y.routeId===h)}getBus(h){return this.buses.get(h)}addBus(h){const y=this.routes.find(I=>I.id===h);if(!y)return null;const w=this.getBusesForRoute(h).length+1,k=`bus-${y.shortName}-${w}`,A=this.createBus(k,y,w);return this.buses.set(k,A),A}removeBus(h){return this.buses.delete(h)}getStatus(){return{isRunning:this.isRunning,busCount:this.buses.size,routes:this.routes.length,lastUpdate:new Date}}}const cp=new YA,_w="https://calculator-php-transition-paint.trycloudflare.com";console.log("API URL:",_w);const es=async(u,h={},y=5)=>{const w=_w;let k;try{k=new URL(w).origin}catch{k=String(w).replace(/\/$/,"")}console.log(`API call: ${k}${u}`);for(let A=0;A<y;A++)try{const I=new Headers(h.headers||{});try{const K=localStorage.getItem("admin_token");K&&!I.has("Authorization")&&I.set("Authorization",`Bearer ${K}`)}catch{}I.has("Accept")||I.set("Accept","application/json");let B=new URL(u,k.endsWith("/")?k:k+"/").toString();const i=await fetch(B,{...h,headers:I});if(!i.ok){let K=`HTTP ${i.status}`;try{const he=await i.json();he&&(he.error||he.message)&&(K=`${K}: ${he.error||he.message}`)}catch{}const Z=new Error(K);throw i.status>=400&&i.status<500,Z}const R=i.headers.get("content-type")||"";if(!R.includes("application/json")){const K=await i.text();throw new Error(`Invalid content-type: ${R} body: ${K.slice(0,120)}`)}const $=await i.json();return console.log(`API response for ${u}:`,$),$}catch(I){console.log(`API call failed (attempt ${A+1}/${y}):`,I.message);const B=/^HTTP\s+(\d{3})$/.exec(String(I.message||""));if(B){const R=Number(B[1]);if(R>=400&&R<500)throw I}if(A===y-1)throw console.error(`All ${y} attempts failed for ${u}`),I;const i=Math.min(1e3*Math.pow(2,A)+Math.random()*1e3,1e4);console.log(`Retrying in ${i}ms...`),await new Promise(R=>setTimeout(R,i))}},hg=()=>es("/routes"),JA=u=>es(`/routes/${u}`),G0=()=>es("/alerts"),vw=u=>es("/trip/plan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),bw=u=>es("/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),mp=(u,h,y=1e3)=>es(`/stops/nearby?lat=${u}&lng=${h}&radius=${y}`),ww=async()=>(cp.isRunning||await cp.initialize(),cp.getBuses()),QA=async u=>(cp.isRunning||await cp.initialize(),cp.addBus(u)),Zf=async()=>{const u=await hg(),h=[];for(const y of u)try{const w=await JA(y.id);h.push({...w,shortName:w.short_name||w.shortName,routeNumber:w.route_number||w.routeNumber})}catch{h.push({...y,shortName:y.short_name||y.shortName,routeNumber:y.route_number||y.routeNumber,stops:[]})}return h},eP=u=>es("/auth/send-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone_number:u})}),tP=(u,h)=>es("/auth/verify-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone_number:u,otp_code:h})}),rP=u=>es("/auth/resend-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone_number:u})}),nP=async(u,h)=>es("/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:u,password:h})}),Tw=(u=200)=>es(`/feedbacks?limit=${u}`),kw=async(u,h="driving")=>{try{const y=u.map(I=>`${I[0]},${I[1]}`).join(";"),w=`https://router.project-osrm.org/route/v1/${h}/${y}?geometries=geojson&overview=full`;console.log("Fetching snapped route from OSRM:",w);const k=await fetch(w);if(!k.ok)throw new Error(`OSRM API error: ${k.status}`);const A=await k.json();if(A.routes&&A.routes.length>0)return{type:"Feature",geometry:A.routes[0].geometry,properties:{distance:A.routes[0].distance,duration:A.routes[0].duration}};throw new Error("No routes returned from OSRM")}catch(y){return console.error("Error fetching snapped route from OSRM:",y),{type:"Feature",geometry:{type:"LineString",coordinates:u}}}},ql=(u=null,h=null)=>{const y=new URLSearchParams;u&&y.append("routeId",u),h&&y.append("plateNumber",h);const w=y.toString();return es(`/buses/status${w?"?"+w:""}`)},iP=u=>es("/buses/add-ticket",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plateNumber:u})}),sP=u=>es("/buses/reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plateNumber:u})}),aP=(u,h,y="High passenger demand detected",w="medium")=>es("/fleet/reroute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bus_id:u,destination:h,reason:y,priority:w})}),oP=(u,h,y="Move bus to congested route",w="medium",k=null,A=null,I=null)=>es("/fleet/reroute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bus_id:u,plate_number:k,target_route_id:h,target_route_short_name:A,target_route_name:I,reason:y,priority:w})}),lP=()=>es("/fleet/congestion"),cP=()=>es("/fleet/congestion/routes"),uP="pk.eyJ1Ijoic2FuaWRhZ290IiwiYSI6ImNtZjg3NHZxdzA0YXgycHNkNTl3dTQxbXoifQ.TlRvzYLTNSJsm_CVBmDAGQ",Sw=({selectedRoute:u,onRouteSelect:h,plannerFrom:y,plannerTo:w,onMapClick:k,selectedBus:A,onBusSelect:I})=>{const B=H.useRef(),[i,R]=H.useState({longitude:38.7636,latitude:9.0054,zoom:13}),[$,K]=H.useState([]),[Z,he]=H.useState([]),[Te,ye]=H.useState([]),[Me,Le]=H.useState("mapbox://styles/mapbox/light-v11"),[De,Qe]=H.useState(!0),[dt,St]=H.useState(!1),[ce,$e]=H.useState(new Date),[Ge,Ye]=H.useState(!0),[ge,Pt]=H.useState(!1),[tt,ct]=H.useState(null),[Kt,Mr]=H.useState(!1),[Jt,Ht]=H.useState(null),[Tt,Be]=H.useState(!1),[Je,ve]=H.useState(null),[et,Ut]=H.useState(!1),[Ot,pr]=H.useState([]),[lr,zr]=H.useState(1e4),[lt,hr]=H.useState([]),[ir,Vn]=H.useState(!1),[Yt,ei]=H.useState(null);H.useEffect(()=>{const _t=document.documentElement.classList.contains("dark");Le(_t?"mapbox://styles/mapbox/dark-v10":"mapbox://styles/mapbox/light-v10")},[]),H.useEffect(()=>{try{const _t=navigator.userAgent.toLowerCase(),dr=/android|iphone|ipad|ipod/.test(_t);Vn(dr)}catch{}},[]),H.useEffect(()=>{const _t=new MutationObserver(()=>{const dr=document.documentElement.classList.contains("dark");Le(dr?"mapbox://styles/mapbox/dark-v10":"mapbox://styles/mapbox/light-v10")});return _t.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>_t.disconnect()},[]);const Rn=_t=>{if(!_t||!lt.length)return console.log("No alerts available:",{bus:!!_t,alertsLength:lt.length}),[];const dr=_t.route_id||_t.routeId,qt=Z.find(Wr=>Wr.id===dr)?.route_number;console.log("Checking alerts for bus:",{routeId:dr,routeNumber:qt,totalAlerts:lt.length,alerts:lt.map(Wr=>({id:Wr.id,affected_routes:Wr.affected_routes,is_active:Wr.is_active}))});const An=lt.filter(Wr=>{const ui=Wr.affected_routes&&(Wr.affected_routes.includes(String(qt))||Wr.affected_routes.includes(qt)),En=Wr.is_active!==!1;return console.log("Alert check:",{alertId:Wr.id,affectsRoute:ui,isActive:En,affected_routes:Wr.affected_routes,routeId:dr,routeNumber:qt}),ui&&En});return console.log("Filtered alerts for bus:",An),An},nn=async(_t,dr=!0)=>{const Br=[];console.log(`Processing ${_t.length} routes for road snapping...`),console.log("Route data sample:",_t.slice(0,2));for(const qt of _t)if(console.log(`Processing route ${qt.id}:`,{hasStops:!!qt.stops,stopsLength:qt.stops?.length,hasId:!!qt.id,hasShortName:!!qt.short_name,hasName:!!qt.name,hasColor:!!qt.color,color:qt.color}),qt.stops&&qt.stops.length>=2&&qt.id){const An=qt.id&&qt.short_name&&qt.name&&qt.color,Wr=["#FF0000","#00BFFF","#0000FF","#00FF00","#FFD700"],ui=Wr.includes(qt.color);if(An&&ui)if(dr)try{const En=qt.stops.filter(xn=>xn.lat&&xn.lng).map(xn=>[parseFloat(xn.lng),parseFloat(xn.lat)]);if(En.length>=2){const xn=await kw(En,"driving");Br.push({route_id:qt.id,geometry:xn.geometry,color:qt.color,properties:xn.properties}),console.log(`Road-snapped database route ${qt.id} (${qt.short_name}) with ${En.length} stops`)}else console.warn(`Route ${qt.id} has insufficient valid coordinates for snapping`),Br.push({route_id:qt.id,geometry:{type:"LineString",coordinates:qt.stops.map(xn=>[parseFloat(xn.lng),parseFloat(xn.lat)])},color:qt.color})}catch(En){console.warn(`Failed to snap database route ${qt.id}, using straight line:`,En),Br.push({route_id:qt.id,geometry:{type:"LineString",coordinates:qt.stops.map(xn=>[parseFloat(xn.lng),parseFloat(xn.lat)])},color:qt.color})}else Br.push({route_id:qt.id,geometry:{type:"LineString",coordinates:qt.stops.map(En=>[parseFloat(En.lng),parseFloat(En.lat)])},color:qt.color});else console.warn(An&&!ui?`Skipping route ${qt.id} - invalid color: ${qt.color}. Expected one of: ${Wr.join(", ")}`:`Skipping non-database route: ${qt.id} - missing required database fields`)}else console.warn(`Skipping route ${qt.id} - insufficient stops data`);return console.log(`Processed ${Br.length} database routes for road snapping`),Br};H.useEffect(()=>{(async()=>{try{const[dr,Br,qt]=await Promise.all([Zf(),ql(),G0()]);he(dr),K(Br),hr(qt||[]),console.log("Loaded data:",{routes:dr.length,buses:Br.length,alerts:(qt||[]).length,alertsData:qt}),qt&&qt.length>0?console.log("Alerts loaded successfully:",qt):console.warn("No alerts loaded or alerts is empty"),console.log(`Creating ${Ge?"road-snapped":"straight-line"} geometries for database routes...`);const An=await nn(dr,Ge);ye(An),Qe(!1)}catch(dr){console.error("Failed to load map data:",dr),he([]),K([]),ye([]),hr([]),Qe(!1)}})()},[Ge]),H.useEffect(()=>{if(!et)return;const dr=setTimeout(()=>{if(!navigator.geolocation){console.warn("Geolocation is not supported by this browser"),ve("Geolocation is not supported by this browser");return}Be(!0),ve(null),navigator.geolocation.getCurrentPosition(Br=>{const{latitude:qt,longitude:An}=Br.coords,Wr={lat:qt,lng:An};Ht(Wr),Be(!1),console.log("User location detected automatically:",Wr),console.log("Centering map on:",An,qt),R(ui=>{const En={...ui,longitude:An,latitude:qt,zoom:15};return console.log("New viewState:",En),En}),za(qt,An,lr),setTimeout(()=>{B.current&&B.current.getMap&&(console.log("Using mapRef to center on location"),B.current.getMap().flyTo({center:[An,qt],zoom:15,duration:2e3,essential:!0}))},500)},Br=>{console.warn("Could not get user location automatically:",Br),ve("Location access denied. Using default view."),Be(!1)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5})},1e3);return()=>clearTimeout(dr)},[et]),H.useEffect(()=>{const _t=setInterval(async()=>{try{const dr=await ql();K(dr),$e(new Date)}catch(dr){console.error("Failed to fetch buses:",dr)}},1e4);return()=>clearInterval(_t)},[]);const Gr=H.useCallback(()=>{B.current&&B.current.getMap&&!dt&&(St(!0),B.current.getMap().flyTo({center:[38.7636,9.0054],zoom:13,duration:1200,essential:!0}),setTimeout(()=>{St(!1)},1200))},[dt]),sn=H.useCallback(()=>{if(!navigator.geolocation){ve("Geolocation is not supported by this browser");return}Be(!0),ve(null),navigator.geolocation.getCurrentPosition(_t=>{const{latitude:dr,longitude:Br}=_t.coords,qt={lat:dr,lng:Br};Ht(qt),Be(!1),B.current&&B.current.getMap&&B.current.getMap().flyTo({center:[Br,dr],zoom:15,duration:1500,essential:!0}),console.log("User location detected:",qt)},_t=>{console.error("Error getting location:",_t),ve("Unable to get your location. Please check permissions."),Be(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},[]),za=H.useCallback(async(_t,dr,Br=lr)=>{try{console.log(`Fetching nearby stops within ${Br}m of ${_t}, ${dr}`);const qt=await mp(_t,dr,Br);pr(qt),console.log(`Found ${qt.length} nearby stops`)}catch(qt){console.error("Failed to fetch nearby stops:",qt),pr([])}},[lr]),ts=H.useCallback(()=>{Jt?R(_t=>({..._t,longitude:Jt.lng,latitude:Jt.lat,zoom:15})):sn()},[Jt,sn]),ti=H.useCallback(async()=>{if(!ge){Pt(!0);try{console.log("Refreshing database bus data...");const _t=await ql();K(_t),$e(new Date),console.log(`Updated ${_t.length} buses`)}catch(_t){console.error("Failed to refresh buses:",_t)}finally{Pt(!1)}}},[ge]);H.useEffect(()=>{const _t=()=>{Gr()};return window.addEventListener("recenterMap",_t),()=>window.removeEventListener("recenterMap",_t)},[Gr]);const gs=H.useCallback(_t=>{I&&I(_t),ir&&ei(_t);const dr=Z.find(Br=>Br.id===_t.route_id);dr&&h&&h(dr),B.current&&B.current.getMap&&B.current.getMap().flyTo({center:[_t.lng,_t.lat],zoom:Math.max(i.zoom,15),duration:800})},[I,h,i.zoom,Z,ir]),Js=u?$.filter(_t=>String(_t.route_id)===String(u.id)):$;return m.jsxs("div",{className:"relative h-full w-full",children:[m.jsx(Ln,{children:(De||Tt)&&m.jsx(wt.div,{initial:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-gray-50 dark:bg-gray-900 flex items-center justify-center z-50",children:m.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[m.jsx(sy,{className:"w-8 h-8 text-primary-600 animate-spin"}),m.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:Tt?"Getting your location...":"Loading transit data..."})]})})}),m.jsxs(Nf,{ref:B,...i,style:{width:"100%",height:"100%"},mapStyle:Me,accessToken:uP,onViewportChange:R,onClick:_t=>{k&&_t&&_t.lngLat&&k({lng:_t.lngLat.lng,lat:_t.lngLat.lat})},onLoad:()=>{Qe(!1),Ut(!0)},children:[Te.map(_t=>!Z.find(Br=>Br.id===_t.route_id)||!_t.geometry?null:m.jsx(Jh,{id:`route-line-${_t.route_id}`,type:"geojson",data:{type:"Feature",geometry:_t.geometry},children:m.jsx(Fc,{id:`route-line-layer-${_t.route_id}`,type:"line",source:`route-line-${_t.route_id}`,paint:{"line-color":_t.color,"line-width":u?.id===_t.route_id?6:4,"line-opacity":u?.id===_t.route_id?1:.6}})},`route-${_t.route_id}`)),m.jsx(Ln,{children:Js.map(_t=>m.jsx(xw,{bus:{..._t,id:_t.bus_id,lat:_t.last_lat,lng:_t.last_lng,vehicle_number:_t.plate_number,speed:0,heading:0,passengers:_t.passengers,max_capacity:_t.max_capacity},route:Z.find(dr=>String(dr.id)===String(_t.route_id)),onClick:()=>gs({..._t,id:_t.bus_id,lat:_t.last_lat,lng:_t.last_lng,vehicle_number:_t.plate_number,speed:0,heading:0,passengers:_t.passengers,max_capacity:_t.max_capacity}),isSelected:A?.id===_t.bus_id,isMobile:ir},_t.bus_id))}),Jt&&m.jsxs(m.Fragment,{children:[m.jsx(Jh,{id:`user-location-circle-${Jt.lng}-${Jt.lat}`,type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[Jt.lng,Jt.lat]},properties:{radius:lr}},children:m.jsx(Fc,{id:`user-location-circle-layer-${Jt.lng}-${Jt.lat}`,type:"circle",source:`user-location-circle-${Jt.lng}-${Jt.lat}`,paint:{"circle-radius":{stops:[[0,0],[20,lr]],base:2},"circle-color":"#fbbf24","circle-opacity":.3,"circle-stroke-color":"#f59e0b","circle-stroke-width":4,"circle-stroke-opacity":.8}},`user-circle-layer-${Date.now()}`)},`user-circle-source-${Date.now()}`),m.jsx(Zo,{longitude:Jt.lng,latitude:Jt.lat,anchor:"center",children:m.jsxs(wt.div,{className:"relative",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:300,damping:20},children:[m.jsx(wt.div,{className:"absolute inset-0 w-8 h-8 rounded-full border-2 border-blue-500",animate:{scale:[1,1.5,1],opacity:[.7,0,.7]},transition:{duration:2,repeat:Number.POSITIVE_INFINITY,ease:"easeInOut"}}),m.jsx(wt.div,{className:"absolute inset-0 w-6 h-6 rounded-full border-2 border-blue-400",animate:{scale:[1,1.3,1],opacity:[.5,0,.5]},transition:{duration:1.5,repeat:Number.POSITIVE_INFINITY,ease:"easeInOut",delay:.5}}),m.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:m.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]})})]}),Ot.map(_t=>m.jsx(Zo,{longitude:_t.lng,latitude:_t.lat,anchor:"bottom",children:m.jsxs(wt.div,{className:"relative cursor-pointer",initial:{scale:0,y:10},animate:{scale:1,y:0},transition:{type:"spring",stiffness:300,damping:20},whileHover:{scale:1.1},title:`${_t.name} - ${_t.route_short_name||_t.route_name}`,children:[m.jsx("div",{className:"w-6 h-6 bg-white dark:bg-gray-800 rounded-full border-2 border-green-500 shadow-lg flex items-center justify-center",children:m.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"})}),m.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full border-2 border-white dark:border-gray-800 shadow-sm",style:{backgroundColor:_t.route_color||"#3b82f6"}})]})},_t.id)),y&&m.jsx(Zo,{longitude:y.lng,latitude:y.lat,anchor:"bottom",children:m.jsx("div",{className:"w-3 h-3 rounded-full ring-2 ring-white dark:ring-gray-900",style:{backgroundColor:"#16a34a"}})}),w&&m.jsx(Zo,{longitude:w.lng,latitude:w.lat,anchor:"bottom",children:m.jsx("div",{className:"w-3 h-3 rounded-full ring-2 ring-white dark:ring-gray-900",style:{backgroundColor:"#ef4444"}})})]}),m.jsx(Ln,{children:ir&&Yt&&m.jsxs(wt.div,{className:"absolute left-0 right-0 bottom-0 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 rounded-t-2xl shadow-2xl p-4 z-20",initial:{y:200,opacity:0},animate:{y:0,opacity:1},exit:{y:200,opacity:0},transition:{type:"spring",stiffness:260,damping:25},children:[(()=>{const _t=Number(Yt.passengers||0),dr=Number(Yt.max_capacity||50),Br=Math.min(Math.round(_t/dr*100),100),qt=Br<50?"green":Br<80?"yellow":"red",An=qt==="green"?"bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300":qt==="yellow"?"bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300":"bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300";return m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"flex items-start justify-between gap-3",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:[Z.find(Wr=>String(Wr.id)===String(Yt.route_id))?.short_name||"Route"," • ",Yt.plate_number||Yt.vehicle_number||Yt.id]}),m.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["Passengers: ",_t," / ",dr]})]}),m.jsxs("div",{className:`px-2 py-1 rounded-full text-[11px] font-medium ${An}`,children:[Br,"% full"]}),m.jsx("button",{onClick:()=>ei(null),className:"ml-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Close bus details",children:"×"})]}),m.jsx("div",{className:"mt-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:m.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${qt==="green"?"bg-green-500":qt==="yellow"?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Br}%`}})})]})})(),m.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2",children:[m.jsxs("div",{className:"px-3 py-2 rounded-xl bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"ETA"}),m.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:typeof Yt.eta_minutes=="number"?`${Yt.eta_minutes} min`:"—"})]}),m.jsxs("div",{className:"px-3 py-2 rounded-xl bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 col-span-1",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"Next Stop"}),m.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",title:Yt.next_stop||"",children:Yt.next_stop||"—"})]}),m.jsxs("div",{className:"px-3 py-2 rounded-xl bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"Buses"}),m.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:$.filter(_t=>String(_t.route_id)===String(Yt.route_id)).length})]})]}),(()=>{const _t=Rn({route_id:Yt.route_id});return _t.length?m.jsx("div",{className:"mt-3 space-y-1",children:_t.map(dr=>m.jsx("div",{className:"text-xs px-2 py-1 rounded border border-yellow-300 bg-yellow-50 text-yellow-800 dark:border-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300",children:dr.title||"Service alert"},dr.id))}):null})(),m.jsxs("div",{className:"mt-3 text-[11px] text-gray-500 dark:text-gray-400",children:["Updated ",new Date(ce).toLocaleTimeString()]})]})}),m.jsx(wt.button,{onClick:ts,disabled:Tt,className:"absolute bottom-4 right-4 sm:bottom-6 sm:right-6 w-12 h-12 bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300 rounded-full shadow-lg border border-blue-600 flex items-center justify-center transition-colors z-10 disabled:opacity-50",whileHover:{scale:1.05},whileTap:{scale:.95},animate:Tt?{rotate:360}:{rotate:0},transition:{duration:Tt?1:.2},"aria-label":"Refresh my location",title:"Refresh and center on your location",children:Tt?m.jsx(sy,{className:"w-5 h-5 text-white animate-spin"}):m.jsxs("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),m.jsx(wt.button,{onClick:Gr,disabled:dt,className:"absolute bottom-4 right-20 sm:bottom-6 sm:right-20 w-12 h-12 bg-white dark:bg-gray-800 rounded-full shadow-lg border border-gray-200 dark:border-gray-700 flex items-center justify-center hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors z-10 disabled:opacity-50",whileHover:{scale:1.05},whileTap:{scale:.95},animate:dt?{rotate:360}:{rotate:0},transition:{duration:dt?1.2:.2},"aria-label":"Recenter to Addis Ababa",title:"Center on Addis Ababa",children:dt?m.jsx(sy,{className:"w-5 h-5 text-gray-600 dark:text-gray-400 animate-spin"}):m.jsx(P1,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),m.jsx(wt.button,{onClick:()=>Ye(!Ge),className:`absolute bottom-4 right-32 sm:bottom-6 sm:right-32 w-12 h-12 rounded-full shadow-lg border flex items-center justify-center transition-colors z-10 ${Ge?"bg-green-500 hover:bg-green-600 border-green-600 text-white":"bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400"}`,whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":Ge?"Disable road snapping":"Enable road snapping",title:Ge?"Road snapping enabled - database routes follow roads":"Road snapping disabled - straight lines between database stops",children:Ge?m.jsx(Bc,{className:"w-5 h-5"}):m.jsx(N1,{className:"w-5 h-5"})}),m.jsx(wt.button,{onClick:ti,disabled:ge,className:"absolute bottom-4 right-44 sm:bottom-6 sm:right-44 w-12 h-12 bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300 rounded-full shadow-lg border border-blue-600 flex items-center justify-center transition-colors z-10 disabled:opacity-50",whileHover:{scale:1.05},whileTap:{scale:.95},animate:ge?{rotate:360}:{rotate:0},transition:{duration:ge?1:.2},"aria-label":"Refresh bus locations",title:"Refresh database bus locations",children:m.jsx(td,{className:"w-5 h-5 text-white"})}),m.jsx(wt.button,{onClick:()=>Mr(!Kt),className:"absolute bottom-4 right-56 sm:bottom-6 sm:right-56 w-12 h-12 bg-gray-600 hover:bg-gray-700 rounded-full shadow-lg border border-gray-500 flex items-center justify-center transition-colors z-10",whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":"Simulation controls",title:"Bus simulation controls",children:m.jsx(XS,{className:"w-5 h-5 text-white"})}),m.jsx(Ln,{children:Kt&&m.jsxs(wt.div,{className:"absolute bottom-20 right-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-4 z-20 min-w-64",initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.95},transition:{duration:.2},children:[m.jsxs("div",{className:"flex items-center justify-between mb-3",children:[m.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Bus Simulation"}),m.jsx("button",{onClick:()=>Mr(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"×"})]}),tt&&m.jsxs("div",{className:"space-y-2 text-xs text-gray-600 dark:text-gray-400",children:[m.jsxs("div",{children:["Status: ",m.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Running"})]}),m.jsxs("div",{children:["Buses: ",tt.busCount]}),m.jsxs("div",{children:["Routes: ",tt.routes]}),m.jsxs("div",{children:["Last Update: ",tt.lastUpdate?.toLocaleTimeString()]})]}),m.jsxs("div",{className:"mt-3 space-y-2",children:[m.jsx("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:"Add Bus to Route:"}),m.jsx("div",{className:"flex flex-wrap gap-1",children:Z.map(_t=>m.jsxs("button",{onClick:async()=>{try{await QA(_t.id);const dr=await ww();K(dr)}catch(dr){console.error("Failed to add bus:",dr)}},className:"px-2 py-1 text-xs rounded",style:{backgroundColor:_t.color+"20",color:_t.color,border:`1px solid ${_t.color}`},children:["+",_t.shortName]},_t.id))})]})]})}),m.jsxs(wt.div,{className:"absolute top-4 left-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 px-3 py-2 z-10",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.5},children:[m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx(wt.div,{className:"w-2 h-2 bg-green-500 rounded-full",animate:{opacity:[1,.3,1]},transition:{duration:2,repeat:Number.POSITIVE_INFINITY}}),m.jsx("span",{className:"text-xs font-medium text-gray-900 dark:text-gray-100",children:"Database"}),m.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[$.length," buses | ",Math.floor((new Date-ce)/1e3),"s ago"]})]}),m.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Real-time bus tracking"}),Jt&&m.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:[Ot.length," stops within ",(lr/1e3).toFixed(1),"km"]})]}),Jt&&m.jsxs(wt.div,{className:"absolute top-4 right-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 px-4 py-3 z-10 min-w-48",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.7},children:[m.jsx("div",{className:"text-xs font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Search Radius"}),m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx("input",{type:"range",min:"1000",max:"5000",step:"250",value:lr,onChange:_t=>{const dr=parseInt(_t.target.value);zr(dr),za(Jt.lat,Jt.lng,dr)},className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer"}),m.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-400 min-w-12",children:[(lr/1e3).toFixed(1),"km"]})]}),m.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[Ot.length," stops found"]})]}),m.jsx(Ln,{children:Je&&m.jsx(wt.div,{className:"absolute top-4 right-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg shadow-lg px-3 py-2 z-20 max-w-xs",initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("div",{className:"w-4 h-4 text-yellow-500 flex-shrink-0",children:m.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),m.jsx("div",{className:"flex-1",children:m.jsx("div",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:Je})}),m.jsx("button",{onClick:()=>ve(null),className:"text-yellow-400 hover:text-yellow-600 dark:hover:text-yellow-300",children:m.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})})})]})},hP=({route:u,busData:h,busStatusData:y=[],onClick:w})=>m.jsx(wt.div,{className:"bg-white dark:bg-gray-800 rounded-2xl p-3 cursor-pointer hover:shadow-lg transition-all duration-200 border border-gray-100 dark:border-gray-700",onClick:w,whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:m.jsxs("div",{className:"flex items-start justify-between",children:[m.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[m.jsx("div",{className:"w-14 h-14 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-sm flex-shrink-0",style:{backgroundColor:u.color},children:u.shortName}),m.jsxs("div",{className:"flex-1 min-w-0 pt-1",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:u.name}),u.type==="express"&&m.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300 rounded-full",children:"Express"})]}),m.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:u.description}),m.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400",children:[m.jsxs("div",{className:"flex items-center space-x-1",children:[m.jsx(go,{className:"w-4 h-4"}),m.jsx("span",{children:h.nextArrival})]}),m.jsxs("div",{className:"flex items-center space-x-1",children:[m.jsx(jf,{className:"w-4 h-4"}),m.jsxs("span",{children:[h.activeBuses," buses"]})]})]}),y.length>0&&m.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[y.slice(0,2).map((k,A)=>m.jsxs("div",{className:"flex items-center space-x-1 text-xs bg-gray-50 dark:bg-gray-700 px-2 py-1 rounded",children:[m.jsx("span",{className:"text-sm",children:k.status_emoji}),m.jsxs("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:[k.passengers,"/",k.max_capacity]})]},k.bus_id||A)),y.length>2&&m.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-500 bg-gray-50 dark:bg-gray-700 px-2 py-1 rounded",children:["+",y.length-2]})]})]})]}),m.jsxs("div",{className:"flex flex-col items-end space-y-2 flex-shrink-0 ml-2",children:[m.jsxs("div",{className:"text-right",children:[m.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:h.nextArrival.replace(" min","")}),m.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:"minutes"})]}),m.jsx(jS,{className:"w-5 h-5 text-gray-400"})]})]})}),dP=({isOpen:u,onToggle:h,selectedRoute:y,onRouteSelect:w,selectedBus:k,onBusSelect:A})=>{const I=_p(),[B,i]=H.useState("Current location"),[R,$]=H.useState(""),[K,Z]=H.useState(null),[he,Te]=H.useState([]),[ye]=H.useState(["Great Theatre","Athens Chapel","Puck's Pharmacy","Shakespeare Ave"]),Me=[{name:"Meskel Square",lat:9.0054,lng:38.7636,type:"landmark"},{name:"Piazza",lat:9.0154,lng:38.7736,type:"landmark"},{name:"CMC Terminal",lat:9.0254,lng:38.7836,type:"terminal"},{name:"Bole Airport",lat:8.9954,lng:38.7536,type:"airport"},{name:"Kazanchis",lat:9.0054,lng:38.7436,type:"area"},{name:"Merkato",lat:8.9854,lng:38.7236,type:"market"},{name:"Arat Kilo",lat:9.0154,lng:38.7536,type:"area"},{name:"National Theatre",lat:9.0054,lng:38.7436,type:"landmark"},{name:"Addis Ababa University",lat:9.0054,lng:38.7636,type:"university"},{name:"Ethiopian Airlines",lat:8.9954,lng:38.7536,type:"office"},{name:"Sheraton Addis",lat:9.0054,lng:38.7636,type:"hotel"},{name:"Unity Park",lat:9.0054,lng:38.7636,type:"park"},{name:"Entoto Park",lat:9.0254,lng:38.7836,type:"park"},{name:"Lion of Judah",lat:9.0054,lng:38.7636,type:"monument"},{name:"Red Terror Martyrs Memorial",lat:9.0054,lng:38.7636,type:"memorial"}],Le=(tt,ct)=>{if(!tt||tt.length<1)return[];const Kt=tt.toLowerCase();return Me.filter(Mr=>Mr.name.toLowerCase().includes(Kt)).slice(0,5).map(Mr=>Mr.name)},[De,Qe]=H.useState({}),[dt,St]=H.useState([]),[ce,$e]=H.useState([]),Ge=tt=>De[tt]||{activeBuses:0,nextArrival:"--"},Ye=tt=>dt.filter(ct=>ct.route_id===tt),ge=()=>{const tt=B;i(R),$(tt)},Pt=()=>{const tt=Me.find(Kt=>Kt.name.toLowerCase().includes(B.toLowerCase())),ct=Me.find(Kt=>Kt.name.toLowerCase().includes(R.toLowerCase()));I("/trip-planner",{state:{from:tt||{name:B,lat:9.0054,lng:38.7636},to:ct||{name:R,lat:9.0154,lng:38.7736}}})};return H.useEffect(()=>{Zf().then(Te).catch(()=>Te([]));const tt=async()=>{try{const Jt=await G0();$e(Jt||[])}catch(Jt){console.error("Failed to fetch alerts:",Jt)}},ct=async()=>{try{const Jt=await ql();St(Jt)}catch(Jt){console.error("Failed to fetch bus status:",Jt)}};tt(),ct();const Kt=setInterval(ct,3e4),Mr=setInterval(async()=>{try{const Ht=(await ww()).reduce((Be,Je)=>(Be[Je.routeId]=Be[Je.routeId]||[],Be[Je.routeId].push(Je),Be),{}),Tt=Object.fromEntries(Object.entries(Ht).map(([Be,Je])=>[Be,{activeBuses:Je.length,nextArrival:`${Math.max(1,2+Math.floor(Math.random()*6))} min`}]));Qe(Tt)}catch{}},5e3);return()=>{clearInterval(Mr),clearInterval(Kt)}},[]),m.jsxs(m.Fragment,{children:[m.jsx(wt.div,{className:"fixed left-0 top-0 h-full bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-700 z-40 flex flex-col w-full max-w-full lg:max-w-[400px]",initial:!1,animate:{width:u?typeof window<"u"&&window.innerWidth<640?"100%":400:0,opacity:u?1:0},transition:{duration:.25,ease:"easeInOut",opacity:{duration:u?.3:.1}},style:{overflow:"auto"},children:m.jsxs("div",{className:"w-full h-full flex flex-col",children:[m.jsxs("div",{className:"flex items-center justify-between px-4 py-4 sm:py-6 border-b border-gray-200 dark:border-gray-700",children:[m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center shadow-lg",children:m.jsx(Uc,{className:"w-7 h-7 text-white"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"Transit"}),m.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Real-time tracking"})]})]}),m.jsx("button",{onClick:h,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:m.jsx(j1,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]}),m.jsxs("div",{className:"px-4 py-4 sm:py-6 border-b border-gray-200 dark:border-gray-700",children:[m.jsx("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Plan Your Trip"}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("div",{className:"relative",children:m.jsxs("div",{className:`flex items-center px-4 py-3 bg-gray-50 dark:bg-gray-800 rounded-xl border transition-colors ${K==="from"?"border-primary-500 bg-white dark:bg-gray-700":"border-gray-200 dark:border-gray-600"}`,children:[m.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500 mr-3 flex-shrink-0"}),m.jsx("input",{type:"text",placeholder:"From",value:B,onChange:tt=>i(tt.target.value),onFocus:()=>Z("from"),onBlur:()=>Z(null),className:"flex-1 bg-transparent border-none outline-none text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"}),m.jsx(C1,{className:"w-4 h-4 text-green-500 ml-2 flex-shrink-0"})]})}),m.jsx("div",{className:"flex justify-center",children:m.jsx("button",{onClick:ge,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:m.jsx(ES,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})})}),m.jsx("div",{className:"relative",children:m.jsxs("div",{className:`flex items-center px-4 py-3 bg-gray-50 dark:bg-gray-800 rounded-xl border transition-colors ${K==="to"?"border-primary-500 bg-white dark:bg-gray-700":"border-gray-200 dark:border-gray-600"}`,children:[m.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500 mr-3 flex-shrink-0"}),m.jsx("input",{type:"text",placeholder:"To",value:R,onChange:tt=>$(tt.target.value),onFocus:()=>Z("to"),onBlur:()=>Z(null),className:"flex-1 bg-transparent border-none outline-none text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"}),m.jsx(hp,{className:"w-4 h-4 text-gray-400 ml-2 flex-shrink-0"})]})}),B&&R&&m.jsx(wt.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},onClick:Pt,className:"w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-2xl transition-colors text-lg",children:"GO"}),m.jsx(Ln,{children:K&&(B||R)&&m.jsx(wt.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-lg overflow-hidden",children:m.jsx("div",{className:"p-2",children:K==="from"&&B&&B!=="Current location"||K==="to"&&R?Le(K==="from"?B:R).map((tt,ct)=>{const Kt=Me.find(Mr=>Mr.name===tt);return m.jsxs("button",{onClick:()=>{K==="from"?i(tt):$(tt),Z(null)},className:"w-full flex items-center px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors text-left",children:[m.jsx(hp,{className:"w-4 h-4 text-gray-400 mr-3 flex-shrink-0"}),m.jsxs("div",{className:"flex-1",children:[m.jsx("span",{className:"text-sm text-gray-900 dark:text-gray-100",children:tt}),m.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2 capitalize",children:Kt?.type})]})]},ct)}):ye.slice(0,3).map((tt,ct)=>m.jsxs("button",{onClick:()=>{K==="from"?i(tt):$(tt),Z(null)},className:"w-full flex items-center px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors text-left",children:[m.jsx(OS,{className:"w-4 h-4 text-gray-400 mr-3 flex-shrink-0"}),m.jsx("span",{className:"text-sm text-gray-900 dark:text-gray-100",children:tt})]},ct))})})})]})]}),m.jsx("div",{className:"flex-1 overflow-y-auto",children:k?m.jsxs("div",{className:"px-4 py-6",children:[m.jsx("div",{className:"flex items-center justify-between mb-4",children:m.jsx("button",{onClick:()=>A(null),className:"text-sm text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 transition-colors",children:"← Back to routes"})}),m.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[m.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center text-white font-bold text-xl shadow-sm",style:{backgroundColor:y?.color||"#3b82f6"},children:y?.shortName||"BUS"}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:y?.name||"Bus Details"}),m.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:y?.description||`Route #${k.route_id||k.routeId}`})]})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[m.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-5",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[m.jsx(go,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),m.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Next Arrival"})]}),m.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:typeof k.eta_minutes=="number"?k.eta_minutes:"Unknown"}),m.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"minutes"})]}),m.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-5",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[m.jsx(jf,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),m.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Active Buses"})]}),m.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:Ge(y?.id||k.route_id).activeBuses}),m.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"buses"})]})]}),m.jsxs("div",{className:"mb-6",children:[m.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"Bus Details"}),m.jsx("div",{className:"space-y-2",children:m.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("span",{className:"text-lg",children:"🚌"}),m.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:k.plate_number||k.vehicle_number||"N/A"})]}),m.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${(k.passengers||0)/(k.max_capacity||50)<.5?"bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300":(k.passengers||0)/(k.max_capacity||50)<.8?"bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300":"bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300"}`,children:[Math.round((k.passengers||0)/(k.max_capacity||50)*100),"% full"]})]}),m.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[m.jsxs("span",{children:["Passengers: ",k.passengers||0,"/",k.max_capacity||50]}),m.jsxs("span",{children:["Bus #",k.bus_number||k.id||"N/A"]})]}),k.next_stop&&m.jsxs("div",{className:"mt-2 text-sm text-gray-700 dark:text-gray-300",children:["Next stop: ",m.jsx("span",{className:"font-medium",children:k.next_stop})]}),m.jsx("div",{className:"mt-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:m.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${(k.passengers||0)/(k.max_capacity||50)<.5?"bg-green-500":(k.passengers||0)/(k.max_capacity||50)<.8?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min((k.passengers||0)/(k.max_capacity||50)*100,100)}%`}})})]})})]}),(()=>{const tt=[{id:"route-alert-1",title:"Heavy Traffic on Route",description:"Heavy traffic reported on this route. Expect delays of 10-15 minutes.",severity:"medium",type:"delay"},{id:"route-alert-2",title:"Construction Zone",description:"Road construction near Meskel Square may cause minor delays.",severity:"low",type:"disruption"}];return m.jsxs("div",{className:"mb-6",children:[m.jsxs("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:["⚠️ Route Alerts (",tt.length,")"]}),m.jsx("div",{className:"space-y-2",children:tt.map((ct,Kt)=>m.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-3 border border-amber-200 dark:border-amber-800",children:m.jsx("div",{className:"flex items-start justify-between",children:m.jsxs("div",{className:"flex-1",children:[m.jsx("div",{className:"text-sm font-medium text-amber-900 dark:text-amber-100 mb-1",children:ct.title}),m.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300 mb-2",children:ct.description}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${ct.severity==="high"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300":ct.severity==="medium"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"}`,children:ct.severity?.toUpperCase()}),m.jsx("span",{className:"text-xs text-amber-600 dark:text-amber-400",children:ct.type?.replace("_"," ").toUpperCase()})]})]})})},ct.id||Kt))})]})})(),y?.stops&&y.stops.length>0&&m.jsxs("div",{children:[m.jsxs("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:["Route Stops (",y.stops.length,")"]}),m.jsx("div",{className:"space-y-3",children:y.stops.map((tt,ct)=>m.jsxs("div",{className:"flex items-start space-x-3",children:[m.jsxs("div",{className:"relative mt-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:y.color}}),ct<y.stops.length-1&&m.jsx("div",{className:"absolute top-3 left-1/2 w-0.5 h-8 -translate-x-1/2",style:{backgroundColor:y.color,opacity:.3}})]}),m.jsxs("div",{className:"flex-1 pb-4",children:[m.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-1",children:tt.name}),m.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Stop #",tt.sequence," • ",Number(tt.lat)?.toFixed(4),", ",Number(tt.lng)?.toFixed(4)]}),m.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[m.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300",children:[Math.max(1,2+Math.floor(Math.random()*6))," min"]}),m.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400",children:[Math.max(8,10+Math.floor(Math.random()*8))," min"]})]})]})]},tt.id))})]})]}):y?m.jsxs("div",{className:"px-4 py-6",children:[m.jsx("div",{className:"flex items-center justify-between mb-4",children:m.jsx("button",{onClick:()=>w(null),className:"text-sm text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 transition-colors",children:"← Back to routes"})}),m.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[m.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center text-white font-bold text-xl shadow-sm",style:{backgroundColor:y.color},children:y.shortName}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:y.name}),m.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:y.description})]})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[m.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-5",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[m.jsx(go,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),m.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Next Arrival"})]}),m.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:Ge(y.id).nextArrival.replace(" min","")}),m.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"minutes"})]}),m.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-5",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[m.jsx(jf,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),m.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Active Buses"})]}),m.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:Ge(y.id).activeBuses}),m.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"buses"})]})]}),Ye(y.id).length>0&&m.jsxs("div",{className:"mb-6",children:[m.jsxs("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:["Bus Status (",Ye(y.id).length,")"]}),m.jsx("div",{className:"space-y-2",children:Ye(y.id).map(tt=>m.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("span",{className:"text-lg",children:tt.status_emoji}),m.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:tt.plate_number})]}),m.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${tt.status==="green"?"bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300":tt.status==="yellow"?"bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300":"bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300"}`,children:tt.status})]}),m.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[m.jsxs("span",{children:["Passengers: ",tt.passengers,"/",tt.max_capacity]}),m.jsxs("span",{children:[tt.fullness_percentage,"% full"]})]}),m.jsx("div",{className:"mt-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:m.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${tt.status==="green"?"bg-green-500":tt.status==="yellow"?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(tt.fullness_percentage,100)}%`}})})]},tt.bus_id))})]}),(()=>{const tt=ce.filter(ct=>{const Kt=y?.route_number,Mr=ct.affected_routes&&(ct.affected_routes.includes(String(Kt))||ct.affected_routes.includes(Kt)),Jt=ct.is_active!==!1;return Mr&&Jt});return tt.length===0?null:m.jsxs("div",{className:"mb-6",children:[m.jsxs("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:["⚠️ Active Alerts (",tt.length,")"]}),m.jsx("div",{className:"space-y-2",children:tt.map((ct,Kt)=>m.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-3 border border-amber-200 dark:border-amber-800",children:m.jsx("div",{className:"flex items-start justify-between",children:m.jsxs("div",{className:"flex-1",children:[m.jsx("div",{className:"text-sm font-medium text-amber-900 dark:text-amber-100 mb-1",children:ct.title}),m.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300 mb-2",children:ct.description}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${ct.severity==="high"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300":ct.severity==="medium"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"}`,children:ct.severity?.toUpperCase()}),m.jsx("span",{className:"text-xs text-amber-600 dark:text-amber-400",children:ct.type?.replace("_"," ").toUpperCase()})]})]})})},ct.id||Kt))})]})})(),m.jsxs("div",{children:[m.jsxs("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:["Route Stops (",y.stops?.length||0,")"]}),m.jsxs("div",{className:"space-y-3",children:[(y.stops||[]).map((tt,ct)=>m.jsxs("div",{className:"flex items-start space-x-3",children:[m.jsxs("div",{className:"relative mt-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:y.color}}),ct<(y.stops?.length||0)-1&&m.jsx("div",{className:"absolute top-3 left-1/2 w-0.5 h-8 -translate-x-1/2",style:{backgroundColor:y.color,opacity:.3}})]}),m.jsxs("div",{className:"flex-1 pb-4",children:[m.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-1",children:tt.name}),m.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Stop #",tt.sequence," • ",Number(tt.lat)?.toFixed(4),", ",Number(tt.lng)?.toFixed(4)]}),m.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[m.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300",children:[Math.max(1,2+Math.floor(Math.random()*6))," min"]}),m.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400",children:[Math.max(8,10+Math.floor(Math.random()*8))," min"]})]})]})]},tt.id)),(!y.stops||y.stops.length===0)&&m.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[m.jsx("div",{className:"text-sm",children:"No stops data available"}),m.jsx("div",{className:"text-xs mt-1",children:"Check your backend API"})]})]})]})]}):m.jsxs("div",{className:"px-4 py-6",children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Nearby Routes"}),m.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[he.length," routes"]})]}),m.jsx("div",{className:"space-y-3",children:(he||[]).map(tt=>m.jsx("div",{className:"transform scale-95",children:m.jsx(hP,{route:tt,busData:Ge(String(tt.id)),busStatusData:Ye(String(tt.id)),onClick:()=>w(tt)})},tt.id))})]})})]})}),m.jsx(Ln,{children:!u&&m.jsx(wt.button,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},onClick:h,className:"fixed top-20 right-4 z-50 w-12 h-12 bg-white dark:bg-gray-800 rounded-full shadow-lg border border-gray-200 dark:border-gray-700 flex items-center justify-center hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors lg:flex","aria-label":"Open sidebar",children:m.jsx(WS,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})}),m.jsx(Ln,{children:u&&m.jsx(wt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-25 z-30 lg:hidden",onClick:h})})]})},Ho=({offsetLeft:u=0,leftAddon:h=null,containerStyle:y,containerClassName:w=""})=>{const k=[{path:"/",label:"Home"},{path:"/map",label:"Map",openSidebarOnMap:!0},{path:"/trip-planner",label:"Trip Planner"},{path:"/nearby",label:"Nearby"},{path:"/favorites",label:"Favorites"},{path:"/alerts",label:"Alerts"},{path:"/feedback",label:"Feedback"}],A=_p(),I=(()=>{try{return!!localStorage.getItem("admin_token")}catch{return!1}})();return m.jsx("div",{className:`sticky top-0 z-30 border-b border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-900/90 backdrop-blur supports-[backdrop-filter]:bg-white/70 supports-[backdrop-filter]:dark:bg-gray-900/70 ${w}`,style:{paddingLeft:u,...y||{}},children:m.jsx("div",{className:"px-3 py-2 sm:p-4",children:m.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto hide-scrollbar max-w-full",children:[h,k.map(B=>m.jsx(b1,{to:B.path,onClick:()=>{if(B.openSidebarOnMap)try{localStorage.setItem("openSidebarOnMap","1")}catch{}},className:({isActive:i})=>`inline-flex items-center gap-2 px-3 py-2 rounded-xl text-sm transition-colors border shadow-sm whitespace-nowrap ${i?"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white border-gray-200 dark:border-gray-700":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800/50 border-transparent"}`,children:m.jsx("span",{className:"font-medium",children:B.label})},`topbar-${B.path}`)),m.jsx("div",{className:"ml-auto"}),m.jsx("button",{onClick:()=>A(I?"/admin/dashboard":"/admin/login"),className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl text-sm transition-colors border shadow-sm bg-emerald-600 text-white hover:bg-emerald-700 whitespace-nowrap",children:I?"Dashboard":"Admin Login"})]})})})},Tp=({darkMode:u,onToggle:h})=>m.jsx(wt.button,{onClick:h,className:"w-12 h-12 glass-effect rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":u?"Switch to light mode":"Switch to dark mode",children:m.jsx(wt.div,{initial:!1,animate:{rotate:u?180:0},transition:{duration:.3,ease:"easeInOut"},children:u?m.jsx(YS,{className:"w-5 h-5 text-yellow-500"}):m.jsx(ZS,{className:"w-5 h-5 text-gray-600"})})}),pP=({darkMode:u,setDarkMode:h})=>{const[y,w]=H.useState(!1),[k,A]=H.useState(null),[I,B]=H.useState(null);return H.useEffect(()=>{try{localStorage.getItem("openSidebarOnMap")==="1"&&(w(!0),localStorage.removeItem("openSidebarOnMap"))}catch{}},[]),m.jsxs("div",{className:"h-full w-full relative",children:[y&&m.jsx("div",{className:"absolute left-0 lg:left-[400px] right-0 top-0 z-20",children:m.jsx(Ho,{offsetLeft:0,leftAddon:null,containerClassName:""})}),!y&&m.jsx(Ho,{offsetLeft:0,leftAddon:m.jsxs("button",{onClick:()=>w(!0),className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl text-sm transition-colors border text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800/50 border-transparent shadow-sm","aria-label":"Open sidebar",children:[m.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[m.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),m.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),m.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]}),m.jsx("span",{className:"font-medium",children:"Open"})]})}),m.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-full lg:w-[400px] z-10",children:m.jsx(dP,{isOpen:y,onToggle:()=>w(!y),selectedRoute:k,onRouteSelect:A,selectedBus:I,onBusSelect:B})}),m.jsxs("div",{className:`h-full transition-all duration-300 ${y?"lg:ml-[400px] ml-0":"ml-0"}`,children:[m.jsx(Sw,{selectedRoute:k,onRouteSelect:A,selectedBus:I,onBusSelect:B}),m.jsx("div",{className:"absolute top-4 right-4 z-10",children:m.jsx(Tp,{darkMode:u,onToggle:()=>h(!u)})})]})]})},fP={en:{langName:"English",heroTitle:"AddisTransit – Real-time public transit for Addis Ababa",heroSubtitle:"A simple, fast, and multilingual app to find buses, plan trips, and navigate Addis Ababa with confidence.",ctaMap:"Open Map",ctaPlanner:"Plan a Trip",sectionAboutTitle:"What problem we solve",sectionAboutBody:"Finding reliable public transit information in Addis Ababa is hard. AddisTransit aggregates routes, stops, and simulated live bus positions to help riders discover nearby routes, check arrivals, and plan efficient trips — even on low connectivity devices.",featuresTitle:"Highlights",features:["Real-time bus tracking to reduce wait times","Smart trip scheduling with suggested departure windows","Live service alerts for delays, diversions, and closures","Offline-ready PWA for low connectivity conditions","Crowding-aware demand predictions (AI-assisted)"],faqTitle:"Frequently asked questions",faqs:[{q:"Is the data real-time?",a:"The demo uses a realistic simulation. It can connect to live feeds when available."},{q:"Does it work offline?",a:"Yes, it is a PWA and caches key assets."},{q:"Which areas are covered?",a:"Addis Ababa routes are included first; we plan to expand coverage."},{q:"How can I contribute?",a:"Share feedback, routes, and stops data or help translate the interface."}],teamTitle:"Team",team:[{name:"Deresani Yetnayet",role:"Fullstack Developer"},{name:"Naol Kebede",role:"Fullstack Developer"},{name:"Achenef Tarekegn",role:"Marketing"},{name:"Demewez Demeke",role:"AI Modelist"},{name:"Mulu Berhan",role:"Sales Manager"}]},am:{langName:"አማርኛ",heroTitle:"AddisTransit – የአዲስ አበባ የህዝብ ትራንዚት መረጃ",heroSubtitle:"አብራሪ ፈጣን እና ቀላል መተግበሪያ ለአዲስ አበባ ባስ መፈለግ፣ ጉዞ መከተት እና መቃኘት.",ctaMap:"ካርታ ክፈት",ctaPlanner:"ጉዞ አዘጋጅ",sectionAboutTitle:"የምንፈታው ችግኝ",sectionAboutBody:"በአዲስ አበባ የህዝብ ትራንዚት መረጃ ማግኘት አስቸጋሪ ነው። AddisTransit መንገዶችን፣ ማቆሚያዎችን እና እውነተኛን የመሳሰሉ ህይወት ባስ እንቅስቃሴ ይያዛል እና ተጓዦች መንገዶችን እንዲያገኙ እና ጊዜያትን እንዲመርምሩ ይረዳቸዋል.",featuresTitle:"ልዩ ባህሪዎች",features:["የባስ እንቅስቃሴን በእውነተኛ ጊዜ መመልከት","አስተካክሎ የጊዜ ሰሌዳ ጥቆማ እና ምክር","ስለ መዘግየት፣ መሻር እና መዘግየት ማስታወቂያዎች","በዝቅተኛ ኢንተርኔት ሁኔታ የሚሰራ የPWA ዝግጁነት","በአብዛኛው ጊዜ ተጭነት በመመከት የAI ትንታኔ"],faqTitle:"ተደጋጋሚ ጥያቄዎች",faqs:[{q:"መረጃው በእውነተኛ ጊዜ ነው?",a:"አሁን ለማሳየት ልምድ ስርዓት እንጠቀማለን። እውነተኛ ምንጮች ሲኖሩ ሊገናኙ ይችላሉ።"},{q:"ከመስመር ውጭ ይሰራል?",a:"አዎን፣ PWA ነው እና ዋና ንብረቶችን ይከማቻል።"},{q:"የተሸፈነው አካባቢ?",a:"በመጀመሪያ አዲስ አበባ መንገዶች ናቸው፣ መስፋፋት እንደሚኖር እቅድ አለ።"},{q:"እንዴት ልረዳ?",a:"አስተያየት ያካፍሉ፣ መንገዶችን እና ማቆሚያዎችን ያካትቱ ወይም ትርጉም ይሁኑ።"}],teamTitle:"ቡድን",team:[{name:"Deresani Yetnayet",role:"Fullstack Developer"},{name:"Naol Kebede",role:"Fullstack Developer"},{name:"Achenef Tarekegn",role:"Marketing"},{name:"Demewez Demeke",role:"AI Modelist"},{name:"Mulu Berhan",role:"Marketing"}]},om:{langName:"Afaan Oromoo",heroTitle:"AddisTransit – Tajaajila ittiin imaltuu uummataa Addis Ababa",heroSubtitle:"App salphaa fi saffisaa, bitaa fi mirga imala kee qindeesu, bussiwwan argachuuf, akkasumas karaa keessa of qajeelchuuf.",ctaMap:"Kaartaa Bani",ctaPlanner:"Imala Qindeessi",sectionAboutTitle:"Rakkoo inni hiiku",sectionAboutBody:"Odeeffannoo imalaa uummataa argachuun garaagara. AddisTransit karaa, iddoo dhaabbataa fi odeeffannoo bussiwwan akkuma yeroo dhugaa fakkaatu walitti qaba; imaltoonni karaa naannoo argachuu fi imala gaarii qindeessu ni danda'u.",featuresTitle:"Amaloota",features:["Bussiwwan yeroo dhugaa hordofuu (yeroo eeggannoo xiqqeessuuf)","Tartiiba imalaa ogummaa qabu fi yaadannoo yeroo deemsisa","Oduu tajaajila (tuffii, jijjiirraa, cufamuu) yeroo dhugaa","PWA sirrii sababa qunnamtii gadi-aanaa irrattis ni hojjetti","Tuma’ina baay’ina imaltootaa (AI tajaajilaan)"],faqTitle:"Gaaffilee yeroo baay'ee gaafataman",faqs:[{q:"Odeeffannoon yeroo dhugaati?",a:"Fakkeenya tajaajila tajaajilaa fayyadamna; yeroo jiraatuu waliin walitti ni hidhama."},{q:"Offline ni hojjetaa?",a:"Eeyyee, PWA dha; qabeenya ijoo ni kuufa."},{q:"Eessa qofa tajaajiluu?",a:"Addis Ababa jalqabaa; bal'inaan tajaajiluu ni karoorfanna."},{q:"Akkaataa gargaarsa?",a:"Yaada kennaa, odeeffannoo karaa fi dhaabbataa qoodaa yookaan hiika dabalataa godhaa."}],teamTitle:"Hojii geggeessitoota",team:[{name:"Deresani Yetnayet",role:"Fullstack Developer"},{name:"Naol Kebede",role:"Fullstack Developer"},{name:"Achenef Tarekegn",role:"Marketing"},{name:"Demewez Demeke",role:"AI Modelist"},{name:"Mulu Berhan",role:"Marketing"}]},ti:{langName:"ትግርኛ",heroTitle:"AddisTransit – ሕቡራት መጓዓዝ ንኣዲስ ኣበባ",heroSubtitle:"መተግበሪ ቀሊል እና ብጣዕሚ ብፍጥነት ንኣስራሕ መንገዲ ፍልስልሲ እና መብት ምዕጋዝ.",ctaMap:"ካርታ ክፈት",ctaPlanner:"መጓዓዝ ኣዘጋጅ",sectionAboutTitle:"ጸገም እንታይ ክፈትና እዩ",sectionAboutBody:"ናይ ሕቡራት መጓዓዝ መረጃ ብኣዲስ ኣበባ ምርካብ ኣስቸጋሪ እዩ። AddisTransit መንገዶችን፣ ማቆሚያዎችን እና ዝመስል እውነት ዝረኣየ ንቡስ እንቅስቃሴ ይኣክል እና ጓዕዞታት ናይ ኣብ ቀረባ መንገዶች ምርካብ እና ግዜ ምርመራ ይሕግዝ።",featuresTitle:"ምርጥ ባህሪታት",features:["ናይ ንቡስ እንቅስቃሴ እቲ ኣብ ሕጂ ግዜ ምርካብ","ግዜ ሰሌዳ ብምትካከል ኣብ ምድላው ምክር","ንመዘግየት/ምሻር/ምዝጋብ ሓበሬታታት ኣብ ሕጂ ግዜ","PWA ምዕባለ እና ናይ ብቕልጡፍ መስመር ስርሕ ዝሓለፈ","ብAI ትንተና ናይ ተመራማሪ ዝርከብ ብዝሒ ተጓዥቲ"],faqTitle:"ብዝሒ ዝሓለፉ ሕቶታት",faqs:[{q:"መረጃ እውነት እዩ?",a:"ምርካብ ሞዴል ንምርካብ እንጠቕመር። እውነት ምንጪ ኣብ ምኻን ክትዕር ይኽእል።"},{q:"ካብ መስመር ውጽኣት ይሰርሕ?",a:"እወ፣ PWA እዩ እና ኣብ ዋና ንብረታት ይከማቻ።"},{q:"ናበይ ይሸፍን?",a:"ኣዲስ ኣበባ ብጀማምረ; ምስፋፋሕ ንምእካይ እትኽእል።"},{q:"ከመይ ክትሓግዙ?",a:"ምኽሪ ኣቕርቡ፣ መንገዶችን እና ማቆሚያዎችን ኣካፍሉ ወይ ትርጓሜ ሓግዙ።"}],teamTitle:"ቡድን",team:[{name:"Deresani Yetnayet",role:"Fullstack Developer"},{name:"Naol Kebede",role:"Fullstack Developer"},{name:"Achenef Tarekegn",role:"Marketing"},{name:"Demewez Demeke",role:"AI Modelist"},{name:"Mulu Berhan",role:"Marketing"}]}};function mP(){const[u,h]=H.useState("en"),y=H.useMemo(()=>fP[u],[u]);return m.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 text-gray-900 dark:text-gray-100",children:[m.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[m.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),m.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),m.jsx(Ho,{containerClassName:"border-0 bg-transparent"}),m.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[m.jsx("div",{className:"flex justify-end pt-6",children:m.jsxs("select",{"aria-label":"Language",value:u,onChange:w=>h(w.target.value),className:"bg-white/90 backdrop-blur dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2 text-sm shadow-sm",children:[m.jsx("option",{value:"en",children:"English"}),m.jsx("option",{value:"am",children:"አማርኛ"}),m.jsx("option",{value:"om",children:"Afaan Oromoo"}),m.jsx("option",{value:"ti",children:"ትግርኛ"})]})}),m.jsx("section",{className:"py-12 md:py-20",children:m.jsxs("div",{className:"grid md:grid-cols-2 gap-8 items-center",children:[m.jsxs("div",{children:[m.jsxs("span",{className:"inline-flex items-center gap-2 text-xs uppercase tracking-wider text-emerald-700 bg-emerald-100 dark:text-emerald-300 dark:bg-emerald-900/40 px-3 py-1 rounded-full",children:[m.jsx(o0,{className:"h-3.5 w-3.5"})," AddisTransit"]}),m.jsxs("div",{className:"flex items-center gap-3 mt-3 mb-4",children:[m.jsx("img",{src:"/transitlogo.png",alt:"AddisTransit logo",className:"h-36 w-36 rounded-lg shadow-sm"}),m.jsx("h1",{className:"text-3xl md:text-5xl font-extrabold tracking-tight m-0",children:y.heroTitle})]}),m.jsx("p",{className:"text-lg md:text-xl text-gray-600 dark:text-gray-300 max-w-3xl",children:y.heroSubtitle}),m.jsxs("div",{className:"mt-8 flex flex-wrap gap-3",children:[m.jsx("a",{href:"/map",className:"px-5 py-3 rounded-xl bg-green-600 hover:bg-green-700 text-white font-medium shadow",children:y.ctaMap}),m.jsx("a",{href:"/trip-planner",className:"px-5 py-3 rounded-xl border border-gray-300 dark:border-gray-700 bg-white/80 dark:bg-gray-900/60 hover:bg-white text-gray-900 dark:text-gray-100 font-medium shadow-sm",children:y.ctaPlanner}),m.jsx("a",{href:"/about",className:"px-5 py-3 rounded-xl border border-gray-300 dark:border-gray-700 bg-white/80 dark:bg-gray-900/60 hover:bg-white text-gray-900 dark:text-gray-100 font-medium shadow-sm",children:"Learn More"})]})]}),m.jsxs("div",{className:"relative hidden md:block",children:[m.jsx("div",{className:"absolute -inset-6 rounded-3xl bg-gradient-to-tr from-green-500/20 to-emerald-500/20 blur-2xl"}),m.jsx("div",{className:"relative rounded-3xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-6 shadow-xl",children:m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx(Um,{icon:m.jsx(Bc,{className:"h-5 w-5"}),title:"Real-time Tracking",children:"Live bus locations to reduce wait times"}),m.jsx(Um,{icon:m.jsx(I1,{className:"h-5 w-5"}),title:"Smart Scheduling",children:"Suggested departure windows based on demand"}),m.jsx(Um,{icon:m.jsx(Cy,{className:"h-5 w-5"}),title:"Service Alerts",children:"Delays, diversions, and closures in real time"}),m.jsx(Um,{icon:m.jsx(VS,{className:"h-5 w-5"}),title:"Offline-ready PWA",children:"Works great on low connectivity and installs to home screen"})]})})]})]})}),m.jsx("section",{className:"py-12 border-t border-gray-200 dark:border-gray-800",children:m.jsxs("div",{className:"md:flex md:items-start md:gap-8",children:[m.jsx("div",{className:"md:w-1/3 mb-4 md:mb-0",children:m.jsx("h2",{className:"text-2xl font-bold",children:y.sectionAboutTitle})}),m.jsx("div",{className:"md:flex-1",children:m.jsx("p",{className:"text-gray-700 dark:text-gray-300 max-w-4xl leading-relaxed",children:y.sectionAboutBody})})]})}),m.jsxs("section",{className:"py-12 border-t border-gray-200 dark:border-gray-800",children:[m.jsx("h3",{className:"text-xl font-semibold mb-6",children:y.featuresTitle}),m.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:y.features.map((w,k)=>m.jsx("div",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/70 dark:bg-gray-900/60 p-5 shadow-sm",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx("span",{className:"mt-1 inline-block h-2.5 w-2.5 rounded-full bg-emerald-500"}),m.jsx("div",{className:"text-gray-700 dark:text-gray-300",children:w})]})},k))})]}),m.jsxs("section",{className:"py-12 border-t border-gray-200 dark:border-gray-800",children:[m.jsx("h3",{className:"text-xl font-semibold mb-6",children:y.faqTitle}),m.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:y.faqs.map((w,k)=>m.jsx("div",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 p-5 bg-white/70 dark:bg-gray-900/60 shadow-sm",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(Cy,{className:"h-5 w-5 text-emerald-600 dark:text-emerald-400 mt-0.5"}),m.jsxs("div",{children:[m.jsx("div",{className:"font-semibold mb-1",children:w.q}),m.jsx("div",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:w.a})]})]})},k))})]}),m.jsxs("section",{className:"py-12 border-t border-gray-200 dark:border-gray-800",children:[m.jsx("h3",{className:"text-xl font-semibold mb-6",children:y.teamTitle}),m.jsx("div",{className:"grid sm:grid-cols-2 md:grid-cols-3 gap-4",children:y.team.map(w=>m.jsx("div",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 p-5 bg-white/70 dark:bg-gray-900/60 shadow-sm",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"h-12 w-12 rounded-full bg-emerald-600 text-white flex items-center justify-center font-bold shadow",children:gP(w.name)}),m.jsxs("div",{children:[m.jsxs("div",{className:"text-base font-semibold flex items-center gap-2",children:[w.name,m.jsx(jf,{className:"h-4 w-4 text-emerald-600 dark:text-emerald-400"})]}),m.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:w.role})]})]})},w.name))})]})]}),m.jsxs("footer",{className:"py-8 border-t border-gray-200 dark:border-gray-800 text-center text-sm text-gray-600 dark:text-gray-400",children:["© ",new Date().getFullYear()," AddisTransit"]})]})}function Um({icon:u,title:h,children:y}){return m.jsx("div",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/70 dark:bg-gray-900/60 p-4 shadow-sm",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx("div",{className:"h-9 w-9 rounded-lg bg-emerald-600/10 text-emerald-700 dark:text-emerald-300 flex items-center justify-center",children:u}),m.jsxs("div",{children:[m.jsx("div",{className:"font-semibold mb-0.5",children:h}),m.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:y})]})]})})}function gP(u){return u.split(" ").map(h=>h[0]).slice(0,2).join("").toUpperCase()}function yP(){const[u,h]=H.useState(""),[y,w]=H.useState(!1),[k,A]=H.useState(""),[I,B]=H.useState({route:"",busNumber:"",plateNumber:"",feedback:""});H.useEffect(()=>{let $=!1;return(async()=>{try{const he=await(await fetch("https://api.ipify.org?format=json")).json();$||h(he?.ip||"")}catch{try{const Te=await(await fetch("https://ipapi.co/json/")).json();$||h(Te?.ip||"")}catch{$||h("")}}})(),()=>{$=!0}},[]);const i=H.useMemo(()=>I.route.trim().length>0&&I.busNumber.trim().length>0&&I.plateNumber.trim().length>0&&I.feedback.trim().length>3,[I]),R=async $=>{if($.preventDefault(),!!i){w(!0),A("");try{await bw({route:I.route,busNumber:I.busNumber,plateNumber:I.plateNumber,feedback:I.feedback,ip:u,userAgent:navigator.userAgent,locale:navigator.language}),B({route:"",busNumber:"",plateNumber:"",feedback:""}),A("Feedback submitted. Thank you!")}finally{w(!1)}}};return m.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 text-gray-900 dark:text-gray-100",children:[m.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[m.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),m.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),m.jsx(Ho,{containerClassName:"border-0 bg-transparent"}),m.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-10",children:[m.jsxs("div",{className:"mb-8",children:[m.jsxs("span",{className:"inline-flex items-center gap-2 text-xs uppercase tracking-wider text-emerald-700 bg-emerald-100 dark:text-emerald-300 dark:bg-emerald-900/40 px-3 py-1 rounded-full",children:[m.jsx(Ym,{className:"h-3.5 w-3.5"})," Feedback"]}),m.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold tracking-tight mt-3 mb-2",children:"Share your bus experience"}),m.jsx("p",{className:"text-gray-700 dark:text-gray-300 max-w-3xl",children:"Help improve public transit in Addis Ababa. Tell us about your ride by filling in the details below."})]}),m.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:m.jsx("div",{className:"md:col-span-2",children:m.jsxs("form",{onSubmit:R,className:"rounded-3xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-6 shadow-xl",children:[m.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[m.jsx(Ty,{label:"Route",placeholder:"e.g. Arat Kilo - Bole",icon:m.jsx(o0,{className:"h-4 w-4"}),value:I.route,onChange:$=>B(K=>({...K,route:$}))}),m.jsx(Ty,{label:"Bus Number",placeholder:"e.g. 12",icon:m.jsx(FS,{className:"h-4 w-4"}),value:I.busNumber,onChange:$=>B(K=>({...K,busNumber:$}))}),m.jsx(Ty,{label:"Plate Number",placeholder:"e.g. A12345",icon:m.jsx(IS,{className:"h-4 w-4"}),value:I.plateNumber,onChange:$=>B(K=>({...K,plateNumber:$}))}),m.jsxs("div",{className:"flex flex-col gap-2",children:[m.jsx("label",{className:"text-sm font-medium",children:"Your Feedback"}),m.jsxs("div",{className:"relative",children:[m.jsx("textarea",{rows:6,className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-800/60 px-3 py-2 pr-10 outline-none focus:ring-2 focus:ring-emerald-500/50",placeholder:"Describe your experience...",value:I.feedback,onChange:$=>B(K=>({...K,feedback:$.target.value})),required:!0}),m.jsx(Ym,{className:"absolute right-3 top-3 h-5 w-5 text-gray-400"})]})]})]}),m.jsxs("div",{className:"mt-6 flex items-center gap-3",children:[m.jsxs("button",{type:"submit",disabled:!i||y,className:"inline-flex items-center gap-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 disabled:opacity-60 text-white px-5 py-2.5 font-semibold shadow",children:[m.jsx(Jm,{className:"h-4 w-4"})," ",y?"Submitting...":"Submit Feedback"]}),k&&m.jsx("span",{className:"text-sm text-emerald-700 dark:text-emerald-400",children:k})]})]})})})]}),m.jsxs("footer",{className:"py-8 border-t border-gray-200 dark:border-gray-800 text-center text-sm text-gray-600 dark:text-gray-400",children:["© ",new Date().getFullYear()," AddisTransit"]})]})}function Ty({label:u,placeholder:h,icon:y,value:w,onChange:k}){return m.jsxs("div",{className:"flex flex-col gap-2",children:[m.jsx("label",{className:"text-sm font-medium",children:u}),m.jsxs("div",{className:"relative",children:[m.jsx("input",{className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-800/60 px-3 py-2 pr-10 outline-none focus:ring-2 focus:ring-emerald-500/50",placeholder:h,value:w,onChange:A=>k(A.target.value),required:!0}),m.jsx("span",{className:"absolute right-3 top-2.5 text-gray-400",children:y})]})]})}function xP(){const u=_p(),[h,y]=H.useState(""),[w,k]=H.useState(""),[A,I]=H.useState(!1),[B,i]=H.useState("");H.useEffect(()=>{try{localStorage.getItem("admin_token")&&u("/admin/dashboard")}catch{}},[u]);const R=async $=>{$.preventDefault(),i(""),I(!0);try{if(!h.trim()||!w.trim()){i("Enter email and password");return}try{const K=await nP(h,w);localStorage.setItem("admin_token",K.token),u("/admin/dashboard")}catch{i("Invalid credentials")}}finally{I(!1)}};return m.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 text-gray-900 dark:text-gray-100",children:[m.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[m.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),m.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),m.jsx(Ho,{}),m.jsx("div",{className:"max-w-md mx-auto px-4 py-12",children:m.jsxs("div",{className:"rounded-3xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-6 shadow-xl",children:[m.jsxs("div",{className:"mb-6",children:[m.jsxs("span",{className:"inline-flex items-center gap-2 text-xs uppercase tracking-wider text-emerald-700 bg-emerald-100 dark:text-emerald-300 dark:bg-emerald-900/40 px-3 py-1 rounded-full",children:[m.jsx(D_,{className:"h-3.5 w-3.5"})," Admin"]}),m.jsx("h1",{className:"mt-3 text-2xl font-extrabold tracking-tight",children:"Admin Login"}),m.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:"Restricted access. Authorized personnel only."})]}),m.jsxs("form",{onSubmit:R,className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium",children:"Email"}),m.jsxs("div",{className:"relative mt-1",children:[m.jsx("input",{type:"email",className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-800/60 px-3 py-2 pr-10 outline-none focus:ring-2 focus:ring-emerald-500/50",placeholder:"admin@example.com",value:h,onChange:$=>y($.target.value)}),m.jsx(GS,{className:"absolute right-3 top-2.5 h-5 w-5 text-gray-400"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium",children:"Password"}),m.jsxs("div",{className:"relative mt-1",children:[m.jsx("input",{type:"password",className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-800/60 px-3 py-2 pr-10 outline-none focus:ring-2 focus:ring-emerald-500/50",placeholder:"••••••••",value:w,onChange:$=>k($.target.value)}),m.jsx(D_,{className:"absolute right-3 top-2.5 h-5 w-5 text-gray-400"})]})]}),B&&m.jsx("div",{className:"text-sm text-red-600",children:B}),m.jsxs("button",{type:"submit",disabled:A,className:"w-full inline-flex items-center justify-center gap-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 disabled:opacity-60 text-white px-5 py-2.5 font-semibold shadow",children:[m.jsx($S,{className:"h-4 w-4"})," ",A?"Signing in...":"Sign In"]})]})]})})]})}const _P=({congestionData:u,onLocationClick:h,selectedLocation:y})=>{const[w,k]=H.useState(!1),[A,I]=H.useState({longitude:38.7756,latitude:9.0192,zoom:11}),B=u&&u.length>0?u:[{lng:38.7756,lat:9.0192,intensity:.9,area:"Meskel Square"},{lng:38.76,lat:9.01,intensity:.7,area:"CMC"},{lng:38.79,lat:9.03,intensity:.8,area:"Bole"},{lng:38.75,lat:9,intensity:.6,area:"Piazza"},{lng:38.78,lat:9.04,intensity:.5,area:"Kazanchis"},{lng:38.74,lat:8.99,intensity:.4,area:"Merkato"},{lng:38.8,lat:9.05,intensity:.3,area:"Airport"},{lng:38.72,lat:8.98,intensity:.2,area:"Arat Kilo"}],i={type:"FeatureCollection",features:B.map(($,K)=>({type:"Feature",properties:{intensity:$.intensity,area:$.area,id:K},geometry:{type:"Point",coordinates:[$.lng,$.lat]}}))},R=$=>{const{lngLat:K}=$;K.lng,K.lat;let Z=null,he=1/0;B.forEach(Te=>{const ye=Math.sqrt(Math.pow(Te.lng-K.lng,2)+Math.pow(Te.lat-K.lat,2));ye<he&&(he=ye,Z=Te)}),Z&&h&&h(Z)};return m.jsxs("div",{className:"w-full h-96 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:[m.jsxs(Nf,{style:{width:"100%",height:"100%"},mapStyle:"mapbox://styles/mapbox/streets-v12",accessToken:"pk.eyJ1Ijoic2FuaWRhZ290IiwiYSI6ImNtZjg3NHZxdzA0YXgycHNkNTl3dTQxbXoifQ.TlRvzYLTNSJsm_CVBmDAGQ",longitude:A.longitude,latitude:A.latitude,zoom:A.zoom,onMove:$=>I($.viewState),onClick:R,onLoad:()=>k(!0),children:[m.jsx(Jh,{id:"congestion-heatmap",type:"geojson",data:i,children:m.jsx(Fc,{id:"congestion-heatmap-layer",type:"heatmap",source:"congestion-heatmap",paint:{"heatmap-weight":{property:"intensity",type:"exponential",stops:[[0,0],[1,1]]},"heatmap-intensity":{stops:[[0,0],[1,1]]},"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 255, 0, 0)",.1,"rgba(0, 255, 0, 0.5)",.3,"rgba(255, 255, 0, 0.5)",.5,"rgba(255, 165, 0, 0.5)",.7,"rgba(255, 0, 0, 0.5)",1,"rgba(255, 0, 0, 0.8)"],"heatmap-radius":{stops:[[0,2],[1,20]]},"heatmap-opacity":.6}})}),m.jsx(Jh,{id:"congestion-points",type:"geojson",data:i,children:m.jsx(Fc,{id:"congestion-points-layer",type:"circle",source:"congestion-points",paint:{"circle-radius":{property:"intensity",stops:[[0,4],[1,12]]},"circle-color":{property:"intensity",stops:[[0,"#00ff00"],[.2,"#88ff00"],[.4,"#ffaa00"],[.6,"#ff8800"],[.8,"#ff0000"]]},"circle-stroke-width":2,"circle-stroke-color":"#ffffff","circle-opacity":.8}})}),y&&m.jsx(Jh,{id:"selected-location",type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[y.lng,y.lat]}},children:m.jsx(Fc,{id:"selected-location-layer",type:"circle",source:"selected-location",paint:{"circle-radius":15,"circle-color":"#0066ff","circle-stroke-width":3,"circle-stroke-color":"#ffffff","circle-opacity":.8}})})]}),m.jsxs("div",{className:"absolute bottom-4 left-4 bg-white dark:bg-gray-800 rounded-lg p-3 shadow-lg border border-gray-200 dark:border-gray-700",children:[m.jsx("div",{className:"text-sm font-semibold mb-2",children:"Congestion Level"}),m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500"}),m.jsx("span",{className:"text-xs",children:"High (80%+)"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500"}),m.jsx("span",{className:"text-xs",children:"Medium-High (60-80%)"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded-full bg-yellow-500"}),m.jsx("span",{className:"text-xs",children:"Medium (40-60%)"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500"}),m.jsx("span",{className:"text-xs",children:"Low (0-40%)"})]})]})]})]})},vP=()=>{const[u,h]=H.useState(null),[y,w]=H.useState([]),[k,A]=H.useState(null),[I,B]=H.useState(!1),[i,R]=H.useState(""),[$,K]=H.useState([]),[Z,he]=H.useState([]),[Te,ye]=H.useState(null),Me=async()=>{try{const ce=await cP();ce.success&&he(ce.routes)}catch(ce){console.error("Failed to load route congestion",ce)}};H.useEffect(()=>{Le(),De(),Me()},[]);const Le=async()=>{try{const $e=(await ql()).filter(Ge=>Ge.status!=="red"&&Ge.passengers/Ge.max_capacity<.8);w($e)}catch(ce){console.error("Failed to load bus status:",ce)}},De=async()=>{try{const ce=await lP();ce.success&&K(ce.data)}catch(ce){console.error("Failed to load congestion data:",ce),Qe()}},Qe=()=>{K([{area:"Meskel Square",lng:38.7756,lat:9.0192,intensity:.9,passengers:150},{area:"CMC",lng:38.76,lat:9.01,intensity:.7,passengers:120},{area:"Bole",lng:38.79,lat:9.03,intensity:.8,passengers:140},{area:"Piazza",lng:38.75,lat:9,intensity:.6,passengers:100},{area:"Kazanchis",lng:38.78,lat:9.04,intensity:.5,passengers:80},{area:"Merkato",lng:38.74,lat:8.99,intensity:.4,passengers:60},{area:"Airport",lng:38.8,lat:9.05,intensity:.3,passengers:40},{area:"Arat Kilo",lng:38.72,lat:8.98,intensity:.2,passengers:30}])},dt=ce=>{h(ce),R("")},St=async()=>{if(!k){R("Please select a bus");return}B(!0);try{let ce;if(Te)ce=await oP(k.bus_id,Te.route_id,`Move to congested route ${Te.short_name}`,"high",k.plate_number,Te.short_name,Te.name);else if(u)ce=await aP(k.bus_id,{name:u.area,lng:u.lng,lat:u.lat},`High passenger demand detected at ${u.area}`,u.intensity>.7?"high":"medium");else{R("Select a target route or a location"),B(!1);return}ce.success?(R(`✅ Bus ${k.plate_number} has been reassigned`),A(null),h(null),ye(null),await Le(),await Me()):R(`❌ Error: ${ce.error||"Failed to send reroute command"}`)}catch(ce){R(`❌ Error: ${ce.message}`)}finally{B(!1)}};return m.jsxs("div",{className:"space-y-6 bg-green-50/40 dark:bg-gray-900/60 rounded-3xl p-4",children:[m.jsxs("div",{className:"rounded-3xl border border-green-200 dark:border-green-900/40 bg-white/90 dark:bg-gray-900/70 shadow-xl p-5",children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsxs("div",{children:[m.jsx("h2",{className:"text-2xl md:text-3xl font-extrabold tracking-tight",children:"Fleet Management"}),m.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Congestion overview and bus rerouting tools"})]}),m.jsxs("button",{onClick:Le,className:"inline-flex items-center gap-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 font-semibold shadow",children:[m.jsx(td,{className:"h-4 w-4"})," Refresh"]})]}),m.jsxs("div",{className:"mb-6 rounded-2xl overflow-hidden border border-green-100 dark:border-green-900/40",children:[m.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[m.jsx(ag,{className:"h-5 w-5 text-orange-500"}),"Congestion Predictions"]}),m.jsx(_P,{congestionData:$,onLocationClick:dt,selectedLocation:u})]}),m.jsxs("div",{className:"mb-6",children:[m.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Congested Routes (from DB)"}),m.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:Z.map((ce,$e)=>m.jsxs(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:$e*.05},className:`rounded-2xl border p-4 cursor-pointer transition-all ${Te?.route_id===ce.route_id?"ring-2 ring-emerald-500 bg-emerald-50 dark:bg-emerald-900/20":"hover:shadow-md border-green-200/60 dark:border-green-900/40"}`,onClick:()=>{ye(ce),h(null),R("")},children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("h4",{className:"font-semibold text-sm",children:[ce.short_name," — ",ce.name]}),m.jsxs("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700",children:[ce.load_percentage,"%"]})]}),m.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:[m.jsxs("div",{children:["Buses: ",ce.buses]}),m.jsxs("div",{children:["Passengers: ",ce.passengers,"/",ce.capacity]})]})]},ce.route_id))})]})]}),m.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[m.jsxs("div",{className:"rounded-3xl border border-green-200 dark:border-green-900/40 bg-white/90 dark:bg-gray-900/70 shadow-xl p-5",children:[m.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[m.jsx(up,{className:"h-5 w-5 text-blue-500"}),"Available Buses (",y.length,")"]}),m.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:y.map(ce=>m.jsxs(wt.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:`rounded-lg border p-3 cursor-pointer transition-all ${k?.bus_id===ce.bus_id?"ring-2 ring-emerald-500 bg-emerald-50 dark:bg-emerald-900/20":"hover:shadow-md border-gray-200 dark:border-gray-700"}`,onClick:()=>A(ce),children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-lg",children:ce.status_emoji}),m.jsx("span",{className:"font-semibold",children:ce.plate_number})]}),m.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ce.status==="green"?"bg-green-100 text-green-700":ce.status==="yellow"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:ce.status})]}),m.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[m.jsxs("div",{children:["Route: ",ce.route_short_name," - ",ce.route_name]}),m.jsxs("div",{children:["Passengers: ",ce.passengers,"/",ce.max_capacity," (",ce.fullness_percentage,"%)"]})]})]},ce.bus_id))})]}),m.jsxs("div",{className:"rounded-3xl border border-green-200 dark:border-green-900/40 bg-white/90 dark:bg-gray-900/70 shadow-xl p-5",children:[m.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[m.jsx(Jm,{className:"h-5 w-5 text-purple-500"}),"Send Bus (to route or location)"]}),u&&!Te&&m.jsxs("div",{className:"mb-4 p-4 rounded-xl bg-green-50 border border-green-200 dark:bg-green-900/20 dark:border-green-800",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsx(Qi,{className:"h-4 w-4 text-blue-600"}),m.jsxs("span",{className:"font-semibold text-blue-900 dark:text-blue-100",children:["Selected: ",u.area]})]}),m.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[m.jsxs("div",{children:["Congestion: ",Math.round(u.intensity*100),"%"]}),m.jsxs("div",{children:["Expected Passengers: ",u.passengers]})]})]}),Te&&m.jsxs("div",{className:"mb-4 p-4 rounded-xl bg-green-50 border border-green-200 dark:bg-green-900/20 dark:border-green-800",children:[m.jsxs("div",{className:"font-semibold",children:["Target Route: ",Te.short_name," — ",Te.name]}),m.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Load: ",Te.load_percentage,"%"]})]}),k&&m.jsxs("div",{className:"mb-4 p-4 rounded-xl bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsx(up,{className:"h-4 w-4 text-emerald-600"}),m.jsxs("span",{className:"font-semibold text-emerald-900 dark:text-emerald-100",children:["Selected: ",k.plate_number]})]}),m.jsxs("div",{className:"text-sm text-emerald-700 dark:text-emerald-300",children:[m.jsxs("div",{children:["Route: ",k.route_short_name]}),m.jsxs("div",{children:["Capacity: ",k.passengers,"/",k.max_capacity]})]})]}),m.jsx("button",{onClick:St,disabled:!k||!Te&&!u||I,className:"w-full bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:I?m.jsxs(m.Fragment,{children:[m.jsx(td,{className:"h-4 w-4 animate-spin"}),"Sending..."]}):m.jsxs(m.Fragment,{children:[m.jsx(Jm,{className:"h-4 w-4"}),"Send Bus to Location"]})}),i&&m.jsx(wt.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-4 p-3 rounded-lg bg-gray-100 dark:bg-gray-800 text-sm",children:i})]})]})]})};function bP(){const u=_p(),[h,y]=H.useState("feedbacks"),[w,k]=H.useState([]),[A,I]=H.useState(!1);H.useEffect(()=>{try{localStorage.getItem("admin_token")||u("/admin/login")}catch{}},[u]),H.useEffect(()=>{(async()=>{if(h==="feedbacks"){I(!0);try{const R=await Tw(200);k(R)}catch{k([])}finally{I(!1)}}})()},[h]);const B=()=>{localStorage.removeItem("admin_token"),u("/admin/login")};return m.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 text-gray-900 dark:text-gray-100",children:[m.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[m.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),m.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),m.jsx(Ho,{}),m.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-10",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-extrabold tracking-tight",children:"Admin Dashboard"}),m.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Overview of city data and system activity"})]}),m.jsxs("button",{onClick:B,className:"inline-flex items-center gap-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 font-semibold shadow",children:[m.jsx(a0,{className:"h-4 w-4"})," Logout"]})]}),m.jsxs("div",{className:"flex gap-6",children:[m.jsxs("aside",{className:"w-56 shrink-0 rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-3 h-fit -ml-4 md:-ml-6 lg:-ml-8",children:[m.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400 px-2 mb-2",children:"Menu"}),m.jsxs("nav",{className:"space-y-1",children:[m.jsx("button",{onClick:()=>y("feedbacks"),className:`w-full text-left px-3 py-2 rounded-xl transition-colors ${h==="feedbacks"?"bg-emerald-600 text-white":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-200"}`,children:"User Feedbacks"}),m.jsx("button",{onClick:()=>y("fleet"),className:`w-full text-left px-3 py-2 rounded-xl transition-colors ${h==="fleet"?"bg-emerald-600 text-white":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-200"}`,children:"Fleet Management"})]})]}),m.jsxs("main",{className:"flex-1",children:[h==="feedbacks"&&m.jsxs("div",{className:"rounded-3xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 shadow-xl overflow-hidden",children:[m.jsxs("div",{className:"px-5 py-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[m.jsx("h2",{className:"text-lg font-semibold",children:"Recent User Feedbacks"}),m.jsx("span",{className:"text-sm text-gray-500",children:"Latest"})]}),m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"min-w-full text-sm",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"text-left border-b border-gray-200 dark:border-gray-800",children:[m.jsx(rp,{children:"Time"}),m.jsx(rp,{children:"IP"}),m.jsx(rp,{children:"Route"}),m.jsx(rp,{children:"Bus No."}),m.jsx(rp,{children:"Plate"}),m.jsx(rp,{children:"Feedback"})]})}),m.jsxs("tbody",{children:[A&&m.jsx("tr",{children:m.jsx(Ru,{colSpan:6,children:"Loading..."})}),!A&&w.length===0&&m.jsx("tr",{children:m.jsx(Ru,{colSpan:6,children:"No feedbacks found."})}),!A&&w.map(i=>m.jsxs("tr",{className:"border-t border-gray-100 dark:border-gray-800 align-top",children:[m.jsx(Ru,{children:new Date(i.created_at).toLocaleString()}),m.jsx(Ru,{children:i.submitter_ip||""}),m.jsx(Ru,{children:i.route}),m.jsx(Ru,{children:i.bus_number}),m.jsx(Ru,{children:i.plate_number}),m.jsx(Ru,{children:m.jsx("div",{className:"max-w-xl whitespace-pre-wrap leading-relaxed",children:i.feedback})})]},i.id))]})]})})]}),h==="fleet"&&m.jsx(vP,{})]})]})]})]})}function rp({children:u}){return m.jsx("th",{className:"p-3 text-xs font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300",children:u})}function Ru({children:u}){return m.jsx("td",{className:"p-3 text-gray-800 dark:text-gray-200",children:u})}const wP=({darkMode:u,setDarkMode:h})=>{const y=Ou(),[w,k]=H.useState(""),[A,I]=H.useState(""),[B,i]=H.useState("now"),[R,$]=H.useState(""),[K,Z]=H.useState(""),[he,Te]=H.useState("fastest"),[ye,Me]=H.useState(null),[Le,De]=H.useState(null),[Qe,dt]=H.useState([]),[St,ce]=H.useState(!1),[$e,Ge]=H.useState({from:!1,to:!1}),[Ye,ge]=H.useState([]),Pt=[{name:"Meskel Square",lat:9.0054,lng:38.7636,type:"landmark"},{name:"Piazza",lat:9.0154,lng:38.7736,type:"landmark"},{name:"CMC Terminal",lat:9.0254,lng:38.7836,type:"terminal"},{name:"Bole Airport",lat:8.9954,lng:38.7536,type:"airport"},{name:"Kazanchis",lat:9.0054,lng:38.7436,type:"area"},{name:"Merkato",lat:8.9854,lng:38.7236,type:"market"},{name:"Arat Kilo",lat:9.0154,lng:38.7536,type:"area"},{name:"National Theatre",lat:9.0054,lng:38.7436,type:"landmark"},{name:"Addis Ababa University",lat:9.0054,lng:38.7636,type:"university"},{name:"Ethiopian Airlines",lat:8.9954,lng:38.7536,type:"office"},{name:"Sheraton Addis",lat:9.0054,lng:38.7636,type:"hotel"},{name:"Unity Park",lat:9.0054,lng:38.7636,type:"park"},{name:"Entoto Park",lat:9.0254,lng:38.7836,type:"park"},{name:"Lion of Judah",lat:9.0054,lng:38.7636,type:"monument"},{name:"Red Terror Martyrs Memorial",lat:9.0054,lng:38.7636,type:"memorial"}];H.useEffect(()=>{(async()=>{try{const Je=await hg();ge(Je||[])}catch{ge([])}})()},[]),H.useEffect(()=>{if(y.state){const{from:Be,to:Je}=y.state;Be&&(k(Be.name),Me(Be)),Je&&(I(Je.name),De(Je))}},[y.state]);const tt=Pt.map(Be=>Be.name),ct=[{id:"fastest",label:"Fastest",icon:N1,description:"Minimize travel time"},{id:"least-walking",label:"Least Walking",icon:s0,description:"Minimize walking distance"},{id:"cheapest",label:"Cheapest",icon:zS,description:"Lowest fare options"}];H.useEffect(()=>{w&&A&&w!==A&&Kt()},[w,A,B,he]);const Kt=async()=>{if(!(!w&&!ye)&&!(!A&&!Le)){ce(!0);try{const Be=ye||Pt.find(Ot=>Ot.name.toLowerCase().includes(w.toLowerCase())),Je=Le||Pt.find(Ot=>Ot.name.toLowerCase().includes(A.toLowerCase())),Ut=(await vw({from:Be||{name:w,lat:9.0054,lng:38.7636},to:Je||{name:A,lat:9.0154,lng:38.7736},departureTime:B,preference:he}))?.options||[];Ut.length?dt(Ut.map((Ot,pr)=>({id:`api-${pr}`,departureTime:"Now",arrivalTime:"Soon",duration:Ot.duration||"--",walkingTime:Ot.walkingTime||"--",transfers:Ot.transfers||0,routes:Ye.slice(0,Math.max(1,(Ot.routes||[]).length||1)).map(lr=>({shortName:lr.short_name||lr.shortName||"38",color:lr.color||"#1e40af",name:lr.name||"Route 38"})),fare:Ot.fare||"$2.50",co2Saved:"1.2 kg",preference:he}))):dt(Mr(w||"From",A||"To"))}catch{dt(Mr())}ce(!1)}},Mr=(Be,Je)=>{const ve=new Date,et=[];for(let Ut=0;Ut<3;Ut++){const Ot=new Date(ve.getTime()+(Ut*5+2)*6e4),pr=new Date(Ot.getTime()+(25+Ut*5)*6e4),lr=3+Ut*2;et.push({id:`trip-${Ut}`,departureTime:Ot.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),arrivalTime:pr.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),duration:`${25+Ut*5} min`,walkingTime:`${lr} min walk`,transfers:Ut===0?0:Ut,routes:Ut===0?[Ye[0]||{shortName:"38",color:"#1e40af",name:"Route 38"}]:[Ye[Ut%Ye.length]||{shortName:"38",color:"#1e40af",name:"Route 38"},Ye[(Ut+1)%Ye.length]||{shortName:"91",color:"#f59e0b",name:"Route 91"}],fare:`${(20+Ut*5).toFixed(0)} ETB`,co2Saved:`${(1.2+Ut*.3).toFixed(1)} kg`,preference:Ut===0?"fastest":Ut===1?"least-walking":"cheapest"})}return et},Jt=(Be,Je)=>Be?tt.filter(ve=>ve.toLowerCase().includes(Be.toLowerCase())&&ve!==(Je==="from"?A:w)).slice(0,5):[],Ht=()=>{const Be=w;k(A),I(Be);const Je=ye;Me(Le),De(Je)},Tt=Be=>{ye?Le?(Me(Be),De(null)):De(Be):Me(Be)};return m.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 flex flex-col",children:[m.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[m.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),m.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),m.jsx(Ho,{}),m.jsx("div",{className:"bg-white/70 dark:bg-gray-900/70 border-b border-gray-200 dark:border-gray-700 px-4 py-4 backdrop-blur rounded-b-2xl",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Trip Planner"}),m.jsx(Tp,{darkMode:u,onToggle:()=>h(!u)})]})}),m.jsxs("div",{className:"flex-1 overflow-auto grid lg:grid-cols-2 gap-0",children:[m.jsx("div",{className:"p-4 order-2 lg:order-1",children:m.jsxs("div",{className:"max-w-2xl mx-auto space-y-4 bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-700 p-4 shadow-sm",children:[m.jsx("div",{className:"relative",children:m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[m.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),m.jsx("div",{className:"w-0.5 h-8 bg-gray-300 dark:bg-gray-600"}),m.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"})]}),m.jsxs("div",{className:"flex-1 space-y-3",children:[m.jsxs("div",{className:"relative",children:[m.jsx("input",{type:"text",placeholder:"From",value:w,onChange:Be=>{k(Be.target.value),Ge({...$e,from:!0})},onFocus:()=>Ge({...$e,from:!0}),className:"w-full px-4 py-3 bg-white/80 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent"}),m.jsx(Ln,{children:$e.from&&w&&m.jsx(wt.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 right-0 z-20 bg-white/95 dark:bg-gray-800/95 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg mt-1",children:Jt(w,"from").map((Be,Je)=>{const ve=Pt.find(et=>et.name===Be);return m.jsxs("button",{onClick:()=>{k(Be),Me(ve),Ge({...$e,from:!1})},className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center space-x-3 first:rounded-t-lg last:rounded-b-lg",children:[m.jsx(Qi,{className:"w-4 h-4 text-gray-400"}),m.jsxs("div",{children:[m.jsx("span",{className:"text-gray-900 dark:text-white",children:Be}),m.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2 capitalize",children:ve?.type})]})]},Je)})})})]}),m.jsxs("div",{className:"relative",children:[m.jsx("input",{type:"text",placeholder:"To",value:A,onChange:Be=>{I(Be.target.value),Ge({...$e,to:!0})},onFocus:()=>Ge({...$e,to:!0}),className:"w-full px-4 py-3 bg-white/80 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent"}),m.jsx(Ln,{children:$e.to&&A&&m.jsx(wt.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 right-0 z-20 bg-white/95 dark:bg-gray-800/95 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg mt-1",children:Jt(A,"to").map((Be,Je)=>{const ve=Pt.find(et=>et.name===Be);return m.jsxs("button",{onClick:()=>{I(Be),De(ve),Ge({...$e,to:!1})},className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center space-x-3 first:rounded-t-lg last:rounded-b-lg",children:[m.jsx(Qi,{className:"w-4 h-4 text-gray-400"}),m.jsxs("div",{children:[m.jsx("span",{className:"text-gray-900 dark:text-white",children:Be}),m.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2 capitalize",children:ve?.type})]})]},Je)})})})]})]}),m.jsx("button",{onClick:Ht,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",disabled:!w||!A,children:m.jsx(Uc,{className:"w-5 h-5 text-gray-400 transform rotate-90"})})]})}),m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsx(go,{className:"w-5 h-5 text-gray-400"}),m.jsxs("select",{value:B,onChange:Be=>i(Be.target.value),className:"px-3 py-2 bg-white/80 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500",children:[m.jsx("option",{value:"now",children:"Leave now"}),m.jsx("option",{value:"depart",children:"Depart at"}),m.jsx("option",{value:"arrive",children:"Arrive by"})]}),B!=="now"&&m.jsxs("div",{className:"flex space-x-2",children:[m.jsx("input",{type:"time",value:R,onChange:Be=>$(Be.target.value),className:"px-3 py-2 bg-white/80 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500"}),m.jsx("input",{type:"date",value:K,onChange:Be=>Z(Be.target.value),className:"px-3 py-2 bg-white/80 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500"})]})]}),m.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:ct.map(Be=>{const Je=Be.icon;return m.jsxs("button",{onClick:()=>Te(Be.id),className:`flex items-center space-x-2 px-4 py-2 rounded-xl whitespace-nowrap transition-all ${he===Be.id?"bg-emerald-600 text-white":"bg-white/70 dark:bg-gray-800/60 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[m.jsx(Je,{className:"w-4 h-4"}),m.jsx("span",{className:"text-sm font-medium",children:Be.label})]},Be.id)})})]})}),m.jsx("div",{className:"h-[50vh] lg:h-[calc(100vh-160px)] order-1 lg:order-2",children:m.jsx(Sw,{plannerFrom:ye,plannerTo:Le,onMapClick:Tt})}),m.jsx("div",{className:"flex-1 p-4 lg:col-span-2",children:m.jsx("div",{className:"max-w-2xl mx-auto",children:St?m.jsxs("div",{className:"flex items-center justify-center py-12",children:[m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"}),m.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Finding best routes..."})]}):Qe.length>0?m.jsxs("div",{className:"space-y-4",children:[m.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Trip Options (",Qe.length,")"]}),Qe.map((Be,Je)=>m.jsxs(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Je*.1},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-shadow cursor-pointer",children:[m.jsxs("div",{className:"flex items-center justify-between mb-3",children:[m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:Be.departureTime}),m.jsx("div",{className:"text-sm text-gray-500",children:"Depart"})]}),m.jsx("div",{className:"flex items-center space-x-2 flex-1",children:m.jsxs("div",{className:"flex-1 h-0.5 bg-gray-300 dark:bg-gray-600 relative",children:[m.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 w-2 h-2 bg-green-500 rounded-full"}),m.jsx("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 w-2 h-2 bg-red-500 rounded-full"})]})}),m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:Be.arrivalTime}),m.jsx("div",{className:"text-sm text-gray-500",children:"Arrive"})]})]}),m.jsxs("div",{className:"text-right",children:[m.jsxs("div",{className:"inline-flex items-center bg-black text-white text-[11px] px-2 py-1 rounded mb-1",children:[m.jsx("span",{className:"mr-1",children:"Menged ✔"}),m.jsx("span",{children:"• Anbessa"})]}),m.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:Be.duration}),m.jsx("div",{className:"text-sm text-gray-500",children:Be.fare})]})]}),m.jsxs("div",{className:"flex items-center justify-between text-sm",children:[m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsx("div",{className:"flex items-center space-x-1",children:Be.routes.map((ve,et)=>m.jsxs("div",{className:"flex items-center space-x-1",children:[m.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:ve.color},children:ve.shortName}),et<Be.routes.length-1&&m.jsx(SS,{className:"w-3 h-3 text-gray-400"})]},et))}),m.jsx("span",{className:"text-gray-500",children:Be.walkingTime}),Be.transfers>0&&m.jsxs("span",{className:"text-gray-500",children:[Be.transfers," transfer",Be.transfers>1?"s":""]})]}),m.jsxs("div",{className:"flex items-center space-x-3 text-gray-500",children:[m.jsxs("span",{children:["🌱 ",Be.co2Saved," CO₂ saved"]}),m.jsxs("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded",children:["ETA ",Be.arrivalTime]})]})]})]},Be.id))]}):w&&A?m.jsxs("div",{className:"text-center py-12",children:[m.jsx(hp,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No routes found between these locations."})]}):m.jsxs("div",{className:"text-center py-12",children:[m.jsx(Qi,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Enter your starting point and destination to plan your trip."})]})})})]})]})},TP=({darkMode:u,setDarkMode:h})=>{const[y,w]=H.useState([]),[k,A]=H.useState(!0),[I,B]=H.useState(new Date),[i,R]=H.useState("all"),[$,K]=H.useState("distance"),[Z,he]=H.useState(!1),[Te,ye]=H.useState({lat:9.0054,lng:38.7636}),Me=[{id:"stop-1",name:"Meskel Square",lat:9.0054,lng:38.7636,routeId:"route-38",routeName:"Route 38",routeShortName:"38",routeColor:"#1e40af",nextArrivals:["2 min","12 min","22 min"],distance:.1,walkingTime:1},{id:"stop-2",name:"Piazza",lat:9.0154,lng:38.7736,routeId:"route-38",routeName:"Route 38",routeShortName:"38",routeColor:"#1e40af",nextArrivals:["5 min","15 min","25 min"],distance:.3,walkingTime:4},{id:"stop-3",name:"CMC Terminal",lat:9.0254,lng:38.7836,routeId:"route-38",routeName:"Route 38",routeShortName:"38",routeColor:"#1e40af",nextArrivals:["8 min","18 min","28 min"],distance:.5,walkingTime:6},{id:"stop-4",name:"Bole Airport",lat:8.9954,lng:38.7536,routeId:"route-91",routeName:"Route 91",routeShortName:"91",routeColor:"#f59e0b",nextArrivals:["3 min","13 min","23 min"],distance:.2,walkingTime:2},{id:"stop-5",name:"Kazanchis",lat:9.0054,lng:38.7436,routeId:"route-91",routeName:"Route 91",routeShortName:"91",routeColor:"#f59e0b",nextArrivals:["6 min","16 min","26 min"],distance:.4,walkingTime:5},{id:"stop-6",name:"Merkato",lat:8.9854,lng:38.7236,routeId:"route-12",routeName:"Route 12",routeShortName:"12",routeColor:"#16a34a",nextArrivals:["1 min","11 min","21 min"],distance:.6,walkingTime:7},{id:"stop-7",name:"Arat Kilo",lat:9.0154,lng:38.7536,routeId:"route-12",routeName:"Route 12",routeShortName:"12",routeColor:"#16a34a",nextArrivals:["4 min","14 min","24 min"],distance:.3,walkingTime:4},{id:"stop-8",name:"National Theatre",lat:9.0054,lng:38.7436,routeId:"route-23",routeName:"Route 23",routeShortName:"23",routeColor:"#dc2626",nextArrivals:["7 min","17 min","27 min"],distance:.2,walkingTime:2},{id:"stop-9",name:"Addis Ababa University",lat:9.0054,lng:38.7636,routeId:"route-38",routeName:"Route 38",routeShortName:"38",routeColor:"#1e40af",nextArrivals:["9 min","19 min","29 min"],distance:.1,walkingTime:1},{id:"stop-10",name:"Sheraton Addis",lat:9.0054,lng:38.7636,routeId:"route-91",routeName:"Route 91",routeShortName:"91",routeColor:"#f59e0b",nextArrivals:["2 min","12 min","22 min"],distance:.2,walkingTime:2}];H.useEffect(()=>{Le();const ce=setInterval(Le,3e4);return()=>clearInterval(ce)},[]);const Le=async()=>{A(!0);try{const $e=(await mp(Te.lat,Te.lng,1200)||[]).map(Ge=>({id:Ge.id,name:Ge.name,lat:Ge.lat,lng:Ge.lng,routeId:Ge.route_id,routeName:Ge.route_name,routeShortName:Ge.route_short_name,routeColor:Ge.route_color,nextArrivals:Ge.next_arrivals||["3 min","13 min","23 min"],distance:(Ge.meters||0)/1e3,walkingTime:Math.ceil((Ge.meters||0)/1e3*12)}));w($e)}catch{w(Me)}B(new Date),A(!1)},De=y.filter(ce=>i==="all"||ce.routeId===i).sort((ce,$e)=>{switch($){case"distance":return ce.distance-$e.distance;case"time":return Number.parseInt(ce.nextArrivals[0])-Number.parseInt($e.nextArrivals[0]);case"name":return ce.name.localeCompare($e.name);default:return 0}}),Qe=[...new Set(y.map(ce=>ce.routeId))],dt=()=>{Le()},St=ce=>{console.log("Adding stop to favorites:",ce)};return m.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 flex flex-col",children:[m.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[m.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),m.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),m.jsx(Ho,{}),m.jsxs("div",{className:"bg-white/70 dark:bg-gray-900/70 border-b border-gray-200 dark:border-gray-700 px-4 py-4 backdrop-blur rounded-b-2xl",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Nearby Stops"}),m.jsx("button",{onClick:dt,disabled:k,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors disabled:opacity-50",children:m.jsx(td,{className:`w-5 h-5 text-gray-600 dark:text-gray-400 ${k?"animate-spin":""}`})})]}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("button",{onClick:()=>he(!Z),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:m.jsx(E1,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),m.jsx(Tp,{darkMode:u,onToggle:()=>h(!u)})]})]}),m.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[m.jsx(go,{className:"w-4 h-4 text-gray-400"}),m.jsxs("span",{className:"text-sm text-gray-500",children:["Last updated: ",I.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}),m.jsx(Ln,{children:Z&&m.jsx(wt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"bg-white/80 dark:bg-gray-900/60 border-b border-gray-200 dark:border-gray-700 overflow-hidden rounded-b-2xl backdrop-blur",children:m.jsx("div",{className:"p-4 space-y-4",children:m.jsxs("div",{className:"flex flex-wrap gap-4",children:[m.jsxs("div",{className:"flex-1 min-w-48",children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Filter by Route"}),m.jsxs("select",{value:i,onChange:ce=>R(ce.target.value),className:"w-full px-3 py-2 bg-white/80 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500",children:[m.jsx("option",{value:"all",children:"All Routes"}),Qe.map(ce=>{const $e=routesData.find(Ge=>Ge.id===ce);return m.jsxs("option",{value:ce,children:[$e?.shortName," - ",$e?.name]},ce)})]})]}),m.jsxs("div",{className:"flex-1 min-w-48",children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort by"}),m.jsxs("select",{value:$,onChange:ce=>K(ce.target.value),className:"w-full px-3 py-2 bg-white/80 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500",children:[m.jsx("option",{value:"distance",children:"Distance"}),m.jsx("option",{value:"time",children:"Next Arrival"}),m.jsx("option",{value:"name",children:"Stop Name"})]})]})]})})})}),m.jsx("div",{className:"flex-1 overflow-auto p-4",children:k?m.jsxs("div",{className:"flex items-center justify-center py-12",children:[m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),m.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading nearby stops..."})]}):De.length>0?m.jsx("div",{className:"space-y-3 max-w-4xl mx-auto",children:De.map((ce,$e)=>m.jsx(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:$e*.05},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-shadow",children:m.jsxs("div",{className:"flex items-start justify-between",children:[m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[m.jsx("div",{className:"w-8 h-8 rounded flex items-center justify-center text-white text-sm font-bold",style:{backgroundColor:ce.routeColor},children:ce.routeShortName}),m.jsxs("div",{className:"flex-1",children:[m.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:ce.name}),m.jsx("p",{className:"text-sm text-gray-500",children:ce.routeName})]}),m.jsx("button",{onClick:()=>St(ce.id),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:m.jsx(dp,{className:"w-4 h-4 text-gray-400 hover:text-yellow-500"})})]}),m.jsxs("div",{className:"flex items-center space-x-4 mb-3 text-sm text-gray-500",children:[m.jsxs("div",{className:"flex items-center space-x-1",children:[m.jsx(Qi,{className:"w-4 h-4"}),m.jsxs("span",{children:[ce.distance.toFixed(1)," km away"]})]}),m.jsxs("div",{className:"flex items-center space-x-1",children:[m.jsx(s0,{className:"w-4 h-4"}),m.jsxs("span",{children:[ce.walkingTime," min walk"]})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Next Arrivals"}),m.jsx("div",{className:"flex space-x-3",children:ce.nextArrivals.slice(0,3).map((Ge,Ye)=>m.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${Ye===0?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:Ge},Ye))})]})]}),m.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors ml-4",children:m.jsx(Uc,{className:"w-5 h-5 text-gray-400"})})]})},`${ce.id}-${ce.routeId}`))}):m.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[m.jsx(Qi,{className:"w-12 h-12 text-gray-400 mb-4"}),m.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No stops found"}),m.jsx("p",{className:"text-gray-500 text-center",children:i!=="all"?"Try changing your route filter":"No nearby stops available"})]})})]})},kP=({darkMode:u,setDarkMode:h})=>{const[y,w]=H.useState("stops"),[k,A]=H.useState([]),[I,B]=H.useState([]),[i,R]=H.useState([]),[$,K]=H.useState([]),[Z,he]=H.useState(null),[Te,ye]=H.useState(!1),Me=[{id:"fav-1",name:"Meskel Square",routeId:"route-38",routeName:"Route 38",routeColor:"#1e40af",nextArrivals:["2 min","12 min"],distance:.1,category:"home"},{id:"fav-2",name:"Bole Airport",routeId:"route-91",routeName:"Route 91",routeColor:"#f59e0b",nextArrivals:["5 min","15 min"],distance:.3,category:"work"},{id:"fav-3",name:"Merkato",routeId:"route-12",routeName:"Route 12",routeColor:"#16a34a",nextArrivals:["1 min","11 min"],distance:.2,category:"shopping"},{id:"fav-4",name:"National Theatre",routeId:"route-23",routeName:"Route 23",routeColor:"#dc2626",nextArrivals:["7 min","17 min"],distance:.4,category:"entertainment"}],Le=[{id:"trip-1",from:"Meskel Square",to:"Bole Airport",duration:"25 min",routes:["Route 38","Route 91"],timestamp:"2 hours ago"},{id:"trip-2",from:"Piazza",to:"Merkato",duration:"18 min",routes:["Route 38","Route 12"],timestamp:"Yesterday"},{id:"trip-3",from:"CMC Terminal",to:"National Theatre",duration:"22 min",routes:["Route 38","Route 23"],timestamp:"2 days ago"}];H.useEffect(()=>{(async()=>{try{const ge=await hg();R(ge||[])}catch{R([])}})(),A(Me),K(Le)},[]);const De=[{id:"stops",label:"Stops",icon:Qi},{id:"routes",label:"Routes",icon:Bc},{id:"trips",label:"Recent",icon:go}],Qe={home:C1,work:MS,coffee:LS,star:dp};H.useEffect(()=>{dt()},[]);const dt=()=>{const Ye=JSON.parse(localStorage.getItem("transit-favorite-stops")||"[]"),ge=JSON.parse(localStorage.getItem("transit-saved-routes")||"[]"),Pt=JSON.parse(localStorage.getItem("transit-recent-trips")||"[]");if(Ye.length===0){const tt=[{id:"fav-1",name:"School St / Queen St",nickname:"Home Stop",icon:"home",routeShortName:"38",routeColor:"#1e40af",nextArrivals:["3 min","13 min","23 min"],lastUpdated:new Date},{id:"fav-2",name:"Athens Chapel",nickname:"Work",icon:"work",routeShortName:"12",routeColor:"#16a34a",nextArrivals:["7 min","17 min","27 min"],lastUpdated:new Date},{id:"fav-3",name:"Puck's Pharmacy",nickname:"Coffee Shop",icon:"coffee",routeShortName:"91",routeColor:"#f59e0b",nextArrivals:["12 min","22 min","32 min"],lastUpdated:new Date}];A(tt),localStorage.setItem("transit-favorite-stops",JSON.stringify(tt))}else A(Ye);if(ge.length===0){const tt=[{id:"saved-route-1",name:"Home to Work",from:"School St / Queen St",to:"Athens Chapel",routes:[i[0],i[2]],duration:"25 min",lastUsed:new Date},{id:"saved-route-2",name:"Weekend Shopping",from:"Current Location",to:"Glade Terminal",routes:[i[0]],duration:"18 min",lastUsed:new Date(Date.now()-864e5)}];B(tt),localStorage.setItem("transit-saved-routes",JSON.stringify(tt))}else B(ge);if(Pt.length===0){const tt=[{id:"trip-1",from:"School St / Queen St",to:"Great Theatre",date:new Date,duration:"22 min",routes:[i[3]]},{id:"trip-2",from:"Athens Chapel",to:"Puck's Pharmacy",date:new Date(Date.now()-36e5),duration:"15 min",routes:[i[1]]},{id:"trip-3",from:"Current Location",to:"Shakespeare Ave",date:new Date(Date.now()-72e5),duration:"28 min",routes:[i[1]]}];K(tt),localStorage.setItem("transit-recent-trips",JSON.stringify(tt))}else K(Pt)},St=Ye=>{const ge=k.filter(Pt=>Pt.id!==Ye);A(ge),localStorage.setItem("transit-favorite-stops",JSON.stringify(ge))},ce=Ye=>{const ge=I.filter(Pt=>Pt.id!==Ye);B(ge),localStorage.setItem("transit-saved-routes",JSON.stringify(ge))},$e=(Ye,ge)=>{const Pt=k.map(tt=>tt.id===Ye?{...tt,nickname:ge}:tt);A(Pt),localStorage.setItem("transit-favorite-stops",JSON.stringify(Pt)),he(null)},Ge=Ye=>{const Pt=new Date-new Date(Ye),tt=Math.floor(Pt/6e4),ct=Math.floor(Pt/36e5),Kt=Math.floor(Pt/864e5);return tt<60?`${tt}m ago`:ct<24?`${ct}h ago`:`${Kt}d ago`};return m.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 flex flex-col",children:[m.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[m.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),m.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),m.jsx(Ho,{}),m.jsxs("div",{className:"bg-white/70 dark:bg-gray-900/70 border-b border-gray-200 dark:border-gray-700 px-4 py-4 backdrop-blur rounded-b-2xl",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Favorites"}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("button",{onClick:()=>ye(!0),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:m.jsx(l0,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),m.jsx(Tp,{darkMode:u,onToggle:()=>h(!u)})]})]}),m.jsx("div",{className:"flex space-x-1 mt-4 bg-white/70 dark:bg-gray-800/60 rounded-xl p-1 border border-gray-200 dark:border-gray-700",children:De.map(Ye=>{const ge=Ye.icon;return m.jsxs("button",{onClick:()=>w(Ye.id),className:`flex items-center space-x-2 px-4 py-2 rounded-xl transition-all relative ${y===Ye.id?"bg-emerald-600 text-white shadow-sm":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[m.jsx(ge,{className:"w-4 h-4"}),m.jsx("span",{className:"font-medium",children:Ye.label})]},Ye.id)})})]}),m.jsx("div",{className:"flex-1 overflow-auto p-4",children:m.jsxs(Ln,{mode:"wait",children:[y==="stops"&&m.jsx(wt.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"p-0 max-w-4xl mx-auto",children:k.length>0?m.jsx("div",{className:"space-y-3",children:k.map((Ye,ge)=>{const Pt=Qe[Ye.icon]||dp;return m.jsx(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:ge*.1},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-4",children:m.jsxs("div",{className:"flex items-start justify-between",children:[m.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[m.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-700 rounded-lg",children:m.jsx(Pt,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),m.jsxs("div",{className:"flex-1",children:[Z===Ye.id?m.jsx("input",{type:"text",defaultValue:Ye.nickname,onBlur:tt=>$e(Ye.id,tt.target.value),onKeyDown:tt=>{tt.key==="Enter"&&$e(Ye.id,tt.target.value)},className:"text-lg font-semibold bg-transparent border-b border-blue-500 focus:outline-none text-gray-900 dark:text-white",autoFocus:!0}):m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:Ye.nickname}),m.jsx("p",{className:"text-sm text-gray-500 mb-2",children:Ye.name}),m.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[m.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:Ye.routeColor},children:Ye.routeShortName}),m.jsx("span",{className:"text-sm text-gray-500",children:"Next arrivals"})]}),m.jsx("div",{className:"flex space-x-2",children:Ye.nextArrivals.map((tt,ct)=>m.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${ct===0?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:tt},ct))})]})]}),m.jsxs("div",{className:"flex items-center space-x-1",children:[m.jsx("button",{onClick:()=>he(Ye.id),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:m.jsx(A1,{className:"w-4 h-4 text-gray-400"})}),m.jsx("button",{onClick:()=>St(Ye.id),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:m.jsx(L_,{className:"w-4 h-4 text-red-400"})})]})]})},Ye.id)})}):m.jsxs("div",{className:"text-center py-12",children:[m.jsx(Gm,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),m.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No favorite stops yet"}),m.jsx("p",{className:"text-gray-500",children:"Add stops to your favorites for quick access to arrival times."})]})},"stops"),y==="routes"&&m.jsx(wt.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"p-0 max-w-4xl mx-auto",children:I.length>0?m.jsx("div",{className:"space-y-3",children:I.map((Ye,ge)=>m.jsx(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:ge*.1},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-4",children:m.jsxs("div",{className:"flex items-start justify-between",children:[m.jsxs("div",{className:"flex-1",children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:Ye.name}),m.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[m.jsx(Qi,{className:"w-4 h-4 text-green-500"}),m.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:Ye.from}),m.jsx("span",{className:"text-gray-400",children:"→"}),m.jsx(Qi,{className:"w-4 h-4 text-red-500"}),m.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:Ye.to})]}),m.jsxs("div",{className:"flex items-center space-x-4 mb-3",children:[m.jsx("div",{className:"flex items-center space-x-1",children:Ye.routes.map((Pt,tt)=>m.jsxs("div",{className:"flex items-center space-x-1",children:[m.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:Pt.color},children:Pt.shortName}),tt<Ye.routes.length-1&&m.jsx("span",{className:"text-gray-400 text-sm",children:"→"})]},tt))}),m.jsx("span",{className:"text-sm text-gray-500",children:Ye.duration})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("span",{className:"text-xs text-gray-400",children:["Last used: ",Ge(Ye.lastUsed)]}),m.jsx("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium",children:"Go Now"})]})]}),m.jsx("button",{onClick:()=>ce(Ye.id),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors ml-4",children:m.jsx(L_,{className:"w-4 h-4 text-red-400"})})]})},Ye.id))}):m.jsxs("div",{className:"text-center py-12",children:[m.jsx(Bc,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),m.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No saved routes yet"}),m.jsx("p",{className:"text-gray-500",children:"Save your frequent trips for quick access."})]})},"routes"),y==="trips"&&m.jsx(wt.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"p-0 max-w-4xl mx-auto",children:$.length>0?m.jsx("div",{className:"space-y-3",children:$.map((Ye,ge)=>m.jsx(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:ge*.1},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-4",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[m.jsx(Qi,{className:"w-4 h-4 text-green-500"}),m.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:Ye.from}),m.jsx("span",{className:"text-gray-400",children:"→"}),m.jsx(Qi,{className:"w-4 h-4 text-red-500"}),m.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:Ye.to})]}),m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsx("div",{className:"flex items-center space-x-1",children:Ye.routes.map((Pt,tt)=>m.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:Pt.color},children:Pt.shortName},tt))}),m.jsx("span",{className:"text-sm text-gray-500",children:Ye.duration}),m.jsx("span",{className:"text-xs text-gray-400",children:Ge(Ye.date)})]})]}),m.jsx("button",{className:"px-3 py-1 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors text-sm font-medium",children:"Repeat"})]})},Ye.id))}):m.jsxs("div",{className:"text-center py-12",children:[m.jsx(go,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),m.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No recent trips"}),m.jsx("p",{className:"text-gray-500",children:"Your recent trip searches will appear here."})]})},"trips")]})})]})},SP=({darkMode:u,setDarkMode:h})=>{const[y,w]=H.useState([]),[k,A]=H.useState([]),[I,B]=H.useState([]),[i,R]=H.useState("all"),[$,K]=H.useState(!1),[Z,he]=H.useState(!0),[Te,ye]=H.useState({disruptions:!0,delays:!0,maintenance:!1,weather:!0}),Me={disruption:{label:"Service Disruption",icon:NS,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",borderColor:"border-red-200 dark:border-red-800"},delay:{label:"Delay",icon:go,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",borderColor:"border-yellow-200 dark:border-yellow-800"},maintenance:{label:"Planned Maintenance",icon:RS,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800"},weather:{label:"Weather Alert",icon:DS,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",borderColor:"border-purple-200 dark:border-purple-800"},info:{label:"Information",icon:M1,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-800",borderColor:"border-gray-200 dark:border-gray-700"}},Le={high:{label:"High",color:"text-red-600",bgColor:"bg-red-100 dark:bg-red-900"},medium:{label:"Medium",color:"text-yellow-600",bgColor:"bg-yellow-100 dark:bg-yellow-900"},low:{label:"Low",color:"text-blue-600",bgColor:"bg-blue-100 dark:bg-blue-900"}};H.useEffect(()=>{De();const $e=setInterval(De,6e4);return()=>clearInterval($e)},[]),H.useEffect(()=>{Qe()},[y,i]);const De=async()=>{he(!0);try{const[$e,Ge]=await Promise.all([G0(),hg()]),Ye=($e||[]).map(ge=>({...ge,startTime:ge.start_time?new Date(ge.start_time):new Date,endTime:ge.end_time?new Date(ge.end_time):null,lastUpdated:ge.updated_at?new Date(ge.updated_at):new Date}));w(Ye),A(Ge||[])}catch{w([]),A([])}he(!1)},Qe=()=>{let $e=y;i!=="all"&&($e=y.filter(Ge=>Ge.type===i)),$e.sort((Ge,Ye)=>{const ge={high:3,medium:2,low:1};return ge[Ge.severity]!==ge[Ye.severity]?ge[Ye.severity]-ge[Ge.severity]:new Date(Ye.lastUpdated)-new Date(Ge.lastUpdated)}),B($e)},dt=($e,Ge)=>{const Ye=new Date($e),ge=new Date;if(Ye>ge)return`Starts in ${Math.ceil((Ye-ge)/36e5)}h`;if(!Ge)return"Ongoing";const Pt=new Date(Ge);return Pt<ge?"Resolved":`${Math.ceil((Pt-ge)/(1e3*60*60))}h remaining`},St=$e=>k.find(Ge=>Ge.short_name===$e),ce=$e=>{ye(Ge=>({...Ge,[$e]:!Ge[$e]}))};return m.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 flex flex-col",children:[m.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[m.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),m.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),m.jsx(Ho,{}),m.jsxs("div",{className:"bg-white/70 dark:bg-gray-900/70 border-b border-gray-200 dark:border-gray-700 px-4 py-4 backdrop-blur rounded-b-2xl",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Service Alerts"}),I.filter($e=>$e.isActive&&$e.severity==="high").length>0&&m.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 bg-red-100 dark:bg-red-900 rounded-full",children:[m.jsx(ag,{className:"w-4 h-4 text-red-600"}),m.jsxs("span",{className:"text-xs font-medium text-red-600",children:[I.filter($e=>$e.isActive&&$e.severity==="high").length," Active"]})]})]}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("button",{onClick:()=>K(!$),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:m.jsx(E1,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),m.jsx(Tp,{darkMode:u,onToggle:()=>h(!u)})]})]}),m.jsx("div",{className:"flex space-x-1 mt-4 overflow-x-auto pb-2",children:[{id:"all",label:"All Alerts"},{id:"disruption",label:"Disruptions"},{id:"delay",label:"Delays"},{id:"maintenance",label:"Maintenance"},{id:"weather",label:"Weather"},{id:"info",label:"Info"}].map($e=>m.jsx("button",{onClick:()=>R($e.id),className:`px-4 py-2 rounded-xl whitespace-nowrap transition-all ${i===$e.id?"bg-emerald-600 text-white":"bg-white/70 dark:bg-gray-800/60 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:$e.label},$e.id))})]}),m.jsx(Ln,{children:$&&m.jsx(wt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"bg-white/80 dark:bg-gray-900/60 border-b border-gray-200 dark:border-gray-700 overflow-hidden rounded-b-2xl backdrop-blur",children:m.jsxs("div",{className:"p-4",children:[m.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Notification Settings"}),m.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(Te).map(([$e,Ge])=>m.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[m.jsx("input",{type:"checkbox",checked:Ge,onChange:()=>ce($e),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),m.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 capitalize",children:$e})]},$e))})]})})}),m.jsx("div",{className:"flex-1 overflow-auto p-4",children:Z?m.jsxs("div",{className:"flex items-center justify-center py-12",children:[m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"}),m.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading alerts..."})]}):I.length>0?m.jsx("div",{className:"space-y-4 max-w-4xl mx-auto",children:I.map(($e,Ge)=>{const Ye=Me[$e.type],ge=Le[$e.severity],Pt=Ye.icon;return m.jsx(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Ge*.1},className:`rounded-2xl border p-4 ${Ye.bgColor} ${Ye.borderColor} shadow-sm`,children:m.jsxs("div",{className:"flex items-start space-x-3",children:[m.jsx("div",{className:`p-2 rounded-lg ${ge.bgColor}`,children:m.jsx(Pt,{className:`w-5 h-5 ${Ye.color}`})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[m.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:$e.title}),m.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ge.color} ${ge.bgColor}`,children:ge.label}),$e.isActive&&m.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900 text-green-600",children:"Active"})]}),m.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-3",children:$e.description}),$e.affectedRoutes&&$e.affectedRoutes.length>0&&m.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[m.jsx("span",{className:"text-sm text-gray-500",children:"Affected routes:"}),m.jsx("div",{className:"flex space-x-1",children:$e.affectedRoutes.map(tt=>{const ct=St(tt);return m.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:ct?.color||"#6b7280"},children:tt},tt)})})]}),$e.affectedStops&&$e.affectedStops.length>0&&m.jsxs("div",{className:"flex items-start space-x-2 mb-2",children:[m.jsx(Qi,{className:"w-4 h-4 text-gray-400 mt-0.5"}),m.jsx("div",{className:"flex flex-wrap gap-1",children:$e.affectedStops.map((tt,ct)=>m.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[tt,ct<$e.affectedStops.length-1&&","]},ct))})]}),m.jsxs("div",{className:"flex items-center justify-between text-sm",children:[m.jsx("span",{className:"text-gray-500",children:dt($e.startTime,$e.endTime)}),m.jsxs("span",{className:"text-gray-400",children:["Updated: ",$e.lastUpdated.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]})]})},$e.id)})}):m.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[m.jsx(Yh,{className:"w-12 h-12 text-green-500 mb-4"}),m.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"All Clear!"}),m.jsx("p",{className:"text-gray-500 text-center",children:i==="all"?"No service alerts at this time.":`No ${i} alerts currently.`})]})})]})},EP=({darkMode:u,setDarkMode:h})=>{const[y,w]=H.useState({name:"Alemayehu Tesfaye",email:"alemayehu.tesfaye@email.com",avatar:null,joinDate:"March 2024"}),[k,A]=H.useState({notifications:{pushNotifications:!0,serviceAlerts:!0,arrivalReminders:!0,weeklyDigest:!1},preferences:{language:"en",units:"metric",walkingSpeed:"normal",accessibilityMode:!1,showCrowding:!0,autoRefresh:!0},privacy:{locationTracking:!0,analyticsSharing:!1,crashReporting:!0},offline:{downloadMaps:!1,offlineSchedules:!0,dataUsage:"wifi-only"}}),[I,B]=H.useState(!1),[i,R]=H.useState(y.name);H.useEffect(()=>{const ye=localStorage.getItem("transit-settings");ye&&A(JSON.parse(ye))},[]);const $=(ye,Me,Le)=>{const De={...k,[ye]:{...k[ye],[Me]:Le}};A(De),localStorage.setItem("transit-settings",JSON.stringify(De))},K=()=>{w({...y,name:i}),B(!1)},Z=({label:ye,description:Me,checked:Le,onChange:De})=>m.jsxs("div",{className:"flex items-center justify-between py-3",children:[m.jsxs("div",{className:"flex-1",children:[m.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:ye}),Me&&m.jsx("p",{className:"text-sm text-gray-500 mt-1",children:Me})]}),m.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[m.jsx("input",{type:"checkbox",className:"sr-only peer",checked:Le,onChange:Qe=>De(Qe.target.checked)}),m.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),he=({label:ye,description:Me,value:Le,options:De,onChange:Qe})=>m.jsxs("div",{className:"flex items-center justify-between py-3",children:[m.jsxs("div",{className:"flex-1",children:[m.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:ye}),Me&&m.jsx("p",{className:"text-sm text-gray-500 mt-1",children:Me})]}),m.jsx("select",{value:Le,onChange:dt=>Qe(dt.target.value),className:"px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:De.map(dt=>m.jsx("option",{value:dt.value,children:dt.label},dt.value))})]}),Te=({label:ye,description:Me,icon:Le,onClick:De,rightText:Qe,danger:dt=!1})=>m.jsxs("button",{onClick:De,className:`w-full flex items-center justify-between py-3 px-4 rounded-lg transition-colors ${dt?"hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 dark:text-red-400":"hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx(Le,{className:`w-5 h-5 ${dt?"text-red-500":"text-gray-400"}`}),m.jsxs("div",{className:"text-left",children:[m.jsx("h4",{className:`font-medium ${dt?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-white"}`,children:ye}),Me&&m.jsx("p",{className:"text-sm text-gray-500 mt-1",children:Me})]})]}),Qe&&m.jsx("span",{className:"text-sm text-gray-500",children:Qe})]});return m.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 flex flex-col",children:[m.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[m.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),m.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),m.jsx("div",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 py-4",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Settings"}),m.jsx(Tp,{darkMode:u,onToggle:()=>h(!u)})]})}),m.jsxs("div",{className:"flex-1 overflow-auto",children:[m.jsx("div",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 p-4",children:m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center",children:y.avatar?m.jsx("img",{src:y.avatar||"/placeholder.svg",alt:"Profile",className:"w-16 h-16 rounded-full object-cover"}):m.jsx(JS,{className:"w-8 h-8 text-white"})}),m.jsx("button",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:m.jsx(PS,{className:"w-3 h-3 text-white"})})]}),m.jsx("div",{className:"flex-1",children:I?m.jsxs("div",{className:"space-y-2",children:[m.jsx("input",{type:"text",value:i,onChange:ye=>R(ye.target.value),className:"text-lg font-semibold bg-transparent border-b border-blue-500 focus:outline-none text-gray-900 dark:text-white",autoFocus:!0}),m.jsxs("div",{className:"flex space-x-2",children:[m.jsx("button",{onClick:K,className:"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600",children:"Save"}),m.jsx("button",{onClick:()=>{B(!1),R(y.name)},className:"px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded text-sm hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"})]})]}):m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:y.name}),m.jsx("button",{onClick:()=>B(!0),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded",children:m.jsx(A1,{className:"w-4 h-4 text-gray-400"})})]}),m.jsx("p",{className:"text-sm text-gray-500",children:y.email}),m.jsxs("p",{className:"text-xs text-gray-400",children:["Member since ",y.joinDate]})]})})]})}),m.jsxs("div",{className:"space-y-6 p-4",children:[m.jsxs(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[m.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[m.jsx(CS,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Notifications"})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx(Z,{label:"Push Notifications",description:"Receive notifications on your device",checked:k.notifications.pushNotifications,onChange:ye=>$("notifications","pushNotifications",ye)}),m.jsx(Z,{label:"Service Alerts",description:"Get notified about service disruptions",checked:k.notifications.serviceAlerts,onChange:ye=>$("notifications","serviceAlerts",ye)}),m.jsx(Z,{label:"Arrival Reminders",description:"Reminders before your bus arrives",checked:k.notifications.arrivalReminders,onChange:ye=>$("notifications","arrivalReminders",ye)}),m.jsx(Z,{label:"Weekly Digest",description:"Summary of your transit usage",checked:k.notifications.weeklyDigest,onChange:ye=>$("notifications","weeklyDigest",ye)})]})]}),m.jsxs(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[m.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[m.jsx(BS,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Preferences"})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx(he,{label:"Language",value:k.preferences.language,options:[{value:"en",label:"English"},{value:"am",label:"አማርኛ (Amharic)"},{value:"or",label:"Afaan Oromoo"},{value:"ti",label:"ትግርኛ (Tigrinya)"}],onChange:ye=>$("preferences","language",ye)}),m.jsx(he,{label:"Units",value:k.preferences.units,options:[{value:"metric",label:"Metric (km)"},{value:"imperial",label:"Imperial (mi)"}],onChange:ye=>$("preferences","units",ye)}),m.jsx(he,{label:"Walking Speed",description:"Used for trip planning calculations",value:k.preferences.walkingSpeed,options:[{value:"slow",label:"Slow (3 km/h)"},{value:"normal",label:"Normal (5 km/h)"},{value:"fast",label:"Fast (6 km/h)"}],onChange:ye=>$("preferences","walkingSpeed",ye)}),m.jsx(Z,{label:"Accessibility Mode",description:"Prioritize accessible routes and stops",checked:k.preferences.accessibilityMode,onChange:ye=>$("preferences","accessibilityMode",ye)}),m.jsx(Z,{label:"Show Crowding Info",description:"Display real-time crowding levels",checked:k.preferences.showCrowding,onChange:ye=>$("preferences","showCrowding",ye)}),m.jsx(Z,{label:"Auto Refresh",description:"Automatically update arrival times",checked:k.preferences.autoRefresh,onChange:ye=>$("preferences","autoRefresh",ye)})]})]}),m.jsxs(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[m.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[m.jsx(KS,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Privacy & Data"})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx(Z,{label:"Location Tracking",description:"Allow app to access your location",checked:k.privacy.locationTracking,onChange:ye=>$("privacy","locationTracking",ye)}),m.jsx(Z,{label:"Analytics Sharing",description:"Help improve the app with usage data",checked:k.privacy.analyticsSharing,onChange:ye=>$("privacy","analyticsSharing",ye)}),m.jsx(Z,{label:"Crash Reporting",description:"Automatically send crash reports",checked:k.privacy.crashReporting,onChange:ye=>$("privacy","crashReporting",ye)})]})]}),m.jsxs(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[m.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[m.jsx(QS,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Offline & Data Usage"})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx(Z,{label:"Download Maps",description:"Save maps for offline use (500MB)",checked:k.offline.downloadMaps,onChange:ye=>$("offline","downloadMaps",ye)}),m.jsx(Z,{label:"Offline Schedules",description:"Cache schedules for offline viewing",checked:k.offline.offlineSchedules,onChange:ye=>$("offline","offlineSchedules",ye)}),m.jsx(he,{label:"Data Usage",description:"Control when to use mobile data",value:k.offline.dataUsage,options:[{value:"always",label:"Always"},{value:"wifi-only",label:"Wi-Fi Only"},{value:"never",label:"Never"}],onChange:ye=>$("offline","dataUsage",ye)})]})]}),m.jsx(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:m.jsxs("div",{className:"space-y-1",children:[m.jsx(Te,{label:"Help & Support",description:"Get help and contact support",icon:Cy,onClick:()=>console.log("Open help")}),m.jsx(Te,{label:"About Transit",description:"App version and legal information",icon:M1,onClick:()=>console.log("Open about"),rightText:"v6.0.1"}),m.jsx(Te,{label:"Sign Out",description:"Sign out of your account",icon:a0,onClick:()=>console.log("Sign out"),danger:!0})]})})]})]})]})};function CP(){return m.jsxs("div",{className:"min-h-screen relative overflow-x-hidden bg-gradient-to-b from-green-50 via-white to-white dark:from-gray-900 dark:via-gray-900 dark:to-gray-950 text-gray-900 dark:text-gray-100",children:[m.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[m.jsx("div",{className:"absolute right-[-10%] top-[-10%] h-72 w-72 rounded-full bg-green-200/40 blur-3xl dark:bg-green-900/30"}),m.jsx("div",{className:"absolute left-[-10%] bottom-[-10%] h-72 w-72 rounded-full bg-emerald-200/40 blur-3xl dark:bg-emerald-900/30"})]}),m.jsx(Ho,{containerClassName:"border-0 bg-transparent"}),m.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-12",children:[m.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold tracking-tight mb-3",children:"About AddisTransit"}),m.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-8",children:"A practical, lightweight transit companion for Addis Ababa that helps riders reduce uncertainty, plan smarter trips, and stay informed in real time."}),m.jsxs("div",{className:"space-y-6",children:[m.jsxs("section",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-5 shadow",children:[m.jsx("h2",{className:"text-xl font-semibold mb-2",children:"The Challenge"}),m.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:"Riders in Addis Ababa struggle with uncertain wait times, unclear routes, and scarce service alerts. Traditional schedules rarely reflect real conditions, and information is fragmented across sources."}),m.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed mt-3",children:"Operators also need better tools to anticipate demand, allocate vehicles, and communicate disruptions quickly—especially under variable traffic and network conditions."})]}),m.jsxs("section",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-5 shadow",children:[m.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Our Solution"}),m.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-gray-700 dark:text-gray-300",children:[m.jsx("li",{children:"Real-time style bus tracking and a clean map experience"}),m.jsx("li",{children:"Trip planning with suggested departure windows"}),m.jsx("li",{children:"Live service alerts for delays, diversions, and closures"}),m.jsx("li",{children:"Offline-ready PWA for low connectivity conditions"}),m.jsx("li",{children:"AI-assisted demand forecasts to reduce crowding"})]}),m.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[m.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-4",children:[m.jsx("div",{className:"font-semibold mb-1",children:"Who it’s for"}),m.jsx("div",{className:"text-gray-700 dark:text-gray-300 text-sm",children:"Daily riders, visitors, and operators who need fast, reliable guidance without heavy data usage."})]}),m.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 p-4",children:[m.jsx("div",{className:"font-semibold mb-1",children:"Design principles"}),m.jsx("div",{className:"text-gray-700 dark:text-gray-300 text-sm",children:"Fast, clear, mobile-first, and resilient to patchy networks with graceful fallbacks."})]})]})]}),m.jsxs("section",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-5 shadow",children:[m.jsx("h2",{className:"text-xl font-semibold mb-2",children:"How the AI Forecasts Help"}),m.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:"The system aggregates historical patterns (by date, route, and time slot) to estimate likely passenger demand. We present ranges (lower–upper bounds) to reflect uncertainty and avoid overconfidence. Forecasts inform riders when to depart and help operators decide where extra capacity is useful."}),m.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed mt-3",children:"These forecasts are indicative, not guarantees. As live data becomes available, predictions are recalibrated to improve accuracy."})]}),m.jsxs("section",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-5 shadow",children:[m.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Data, Privacy, and Reliability"}),m.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-gray-700 dark:text-gray-300",children:[m.jsx("li",{children:"We minimize data collection and only store feedback that users explicitly submit."}),m.jsx("li",{children:"All metrics are aggregated; no personal identities are displayed."}),m.jsx("li",{children:"Where live feeds are unavailable, simulated data and forecasts are clearly labeled."})]})]}),m.jsxs("section",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-5 shadow",children:[m.jsx("h2",{className:"text-xl font-semibold mb-2",children:"What’s Next"}),m.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:"We’re working on integrating live feeds, richer route coverage, and more accurate AI forecasts, while keeping the app lightweight and accessible on all devices."}),m.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-gray-700 dark:text-gray-300 mt-3",children:[m.jsx("li",{children:"Real-time GTFS and AVL integrations"}),m.jsx("li",{children:"Operator dashboards for load balancing and incident response"}),m.jsx("li",{children:"Multimodal options (walking transfers and future rail integrations)"})]})]}),m.jsxs("section",{className:"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-5 shadow",children:[m.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Get Involved"}),m.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:"Share feedback, contribute route data, or help with translations. Your input directly improves transit for everyone in Addis Ababa."})]})]})]})]})}const MP=()=>{const[u,h]=H.useState([]),[y,w]=H.useState(""),[k,A]=H.useState(!1),[I,B]=H.useState("");H.useEffect(()=>{i();const Z=setInterval(i,3e4);return()=>clearInterval(Z)},[]);const i=async()=>{try{const Z=await ql();h(Z)}catch(Z){console.error("Failed to load bus status:",Z)}},R=async()=>{if(!y){B("Please select a bus plate number");return}A(!0);try{const Z=await iP(y);Z.success?(B(`✅ Ticket added! ${Z.status_emoji} ${Z.current_passengers}/${Z.max_capacity} passengers`),await i()):B(`❌ Error: ${Z.error}`)}catch(Z){B(`❌ Error: ${Z.message}`)}finally{A(!1)}},$=async()=>{if(!y){B("Please select a bus plate number");return}A(!0);try{const Z=await sP(y);Z.success?(B(`🔄 Bus reset! Previous count: ${Z.previous_count}`),await i()):B(`❌ Error: ${Z.error}`)}catch(Z){B(`❌ Error: ${Z.message}`)}finally{A(!1)}},K=Z=>{switch(Z){case"green":return"text-green-600 bg-green-100";case"yellow":return"text-yellow-600 bg-yellow-100";case"red":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}};return m.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:m.jsxs("div",{className:"max-w-7xl mx-auto",children:[m.jsxs("div",{className:"mb-6",children:[m.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Bus Coordinator Interface"}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Track passenger counts and manage bus capacity"})]}),m.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6",children:[m.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Quick Actions"}),m.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[m.jsxs("div",{className:"flex-1 min-w-64",children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Bus Plate Number"}),m.jsxs("select",{value:y,onChange:Z=>w(Z.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[m.jsx("option",{value:"",children:"Choose a bus..."}),u.map(Z=>m.jsxs("option",{value:Z.plate_number,children:[Z.plate_number," - Route ",Z.route_number," (",Z.route_short_name,")"]},Z.bus_id))]})]}),m.jsxs("button",{onClick:R,disabled:k||!y,className:"flex items-center gap-2 px-6 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300 text-white rounded-lg transition-colors font-medium",children:[m.jsx(l0,{className:"w-4 h-4"}),"Print Ticket (+1)"]}),m.jsxs("button",{onClick:$,disabled:k||!y,className:"flex items-center gap-2 px-6 py-2 bg-orange-500 hover:bg-orange-600 disabled:bg-orange-300 text-white rounded-lg transition-colors font-medium",children:[m.jsx(P1,{className:"w-4 h-4"}),"Reset Bus"]})]}),I&&m.jsx(wt.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-lg",children:I})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:u.map(Z=>m.jsxs(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 border-l-4",style:{borderLeftColor:Z.route_color},children:[m.jsxs("div",{className:"flex items-center justify-between mb-3",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(up,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),m.jsxs("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:["Route ",Z.route_number]})]}),m.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${K(Z.status)}`,children:[Z.status_emoji," ",Z.status]})]}),m.jsxs("div",{className:"space-y-2 text-sm",children:[m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Plate:"}),m.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:Z.plate_number})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Passengers:"}),m.jsxs("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:[Z.passengers,"/",Z.max_capacity]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Fullness:"}),m.jsxs("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:[Z.fullness_percentage,"%"]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Tickets Sold:"}),m.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:Z.ticket_count||0})]}),m.jsxs("div",{className:"mt-3",children:[m.jsxs("div",{className:"flex justify-between text-xs text-gray-600 dark:text-gray-400 mb-1",children:[m.jsx("span",{children:"Capacity"}),m.jsxs("span",{children:[Z.fullness_percentage,"%"]})]}),m.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:m.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${Z.status==="green"?"bg-green-500":Z.status==="yellow"?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(Z.fullness_percentage,100)}%`}})})]})]})]},Z.bus_id))}),u.length===0&&m.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[m.jsx(up,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),m.jsx("p",{children:"No bus data available"})]})]})})},AP=()=>{const[u,h]=H.useState(null),[y,w]=H.useState(null),[k,A]=H.useState(!1),[I,B]=H.useState(""),[i,R]=H.useState(!1);H.useEffect(()=>{h({bus_id:"bus-12-1",plate_number:"AA-1234-5678",route_id:"route-12",route_short_name:"12",route_name:"Route 12 - Bole to Piazza",passengers:25,max_capacity:50,status:"yellow",status_emoji:"🟡",fullness_percentage:50,last_lat:38.7756,last_lng:9.0192}),$()},[]);const $=()=>{setTimeout(()=>{const Te={id:"reroute-001",timestamp:new Date().toISOString(),from:"Admin Fleet Management",destination:{name:"Meskel Square",lng:38.7756,lat:9.0192,reason:"High passenger demand detected",expectedPassengers:45},priority:"high",estimatedArrival:"15 minutes"};w(Te),R(!0)},5e3)},K=()=>{A(!0),B(""),setTimeout(()=>{B("✅ Reroute accepted! Navigating to new destination."),R(!1),A(!1),setTimeout(()=>{w(null),B("")},3e3)},1e3)},Z=()=>{B("❌ Reroute declined. Continuing on current route."),R(!1),w(null),setTimeout(()=>{B("")},3e3)},he=Te=>{switch(Te){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}};return u?m.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:m.jsxs("div",{className:"max-w-4xl mx-auto",children:[m.jsxs("div",{className:"mb-6",children:[m.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Driver Dashboard"}),m.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Bus ",u.plate_number," - Route ",u.route_short_name]})]}),m.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[m.jsx(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"h-10 w-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center",children:m.jsx(up,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),m.jsxs("div",{children:[m.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Bus Status"}),m.jsxs("div",{className:"text-lg font-semibold",children:[u.status_emoji," ",u.status]})]})]})}),m.jsxs(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"h-10 w-10 rounded-lg bg-green-100 dark:bg-green-900/30 flex items-center justify-center",children:m.jsx(jf,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),m.jsxs("div",{children:[m.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Passengers"}),m.jsxs("div",{className:"text-lg font-semibold",children:[u.passengers,"/",u.max_capacity]})]})]}),m.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:m.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${u.status==="green"?"bg-green-500":u.status==="yellow"?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(u.fullness_percentage,100)}%`}})})]}),m.jsx(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"h-10 w-10 rounded-lg bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center",children:m.jsx(Bc,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"})}),m.jsxs("div",{children:[m.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Current Route"}),m.jsx("div",{className:"text-lg font-semibold",children:u.route_short_name})]})]})}),m.jsx(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"h-10 w-10 rounded-lg bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center",children:m.jsx(go,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),m.jsxs("div",{children:[m.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Next Stop"}),m.jsx("div",{className:"text-lg font-semibold",children:"5 min"})]})]})})]}),I&&m.jsx(wt.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6 p-4 rounded-lg bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Yh,{className:"h-5 w-5 text-green-600"}),m.jsx("span",{className:"text-sm font-medium",children:I})]})}),m.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6",children:[m.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[m.jsx(Uc,{className:"h-5 w-5 text-blue-600"}),"Current Route: ",u.route_name]}),m.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Route ID"}),m.jsx("div",{className:"font-semibold",children:u.route_id})]}),m.jsxs("div",{children:[m.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Plate Number"}),m.jsx("div",{className:"font-semibold",children:u.plate_number})]}),m.jsxs("div",{children:[m.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Current Location"}),m.jsxs("div",{className:"font-semibold",children:["Lat: ",u.last_lat?.toFixed(4),", Lng: ",u.last_lng?.toFixed(4)]})]}),m.jsxs("div",{children:[m.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Capacity"}),m.jsxs("div",{className:"font-semibold",children:[u.fullness_percentage,"% full"]})]})]})]}),m.jsx(Ln,{children:i&&y&&m.jsx(wt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:m.jsxs(wt.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:"h-10 w-10 rounded-lg bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center",children:m.jsx(ag,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-semibold",children:"New Reroute Command"}),m.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["From: ",y.from]})]})]}),m.jsxs("div",{className:"space-y-4 mb-6",children:[m.jsxs("div",{className:"p-4 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsx(Qi,{className:"h-4 w-4 text-blue-600"}),m.jsxs("span",{className:"font-semibold text-blue-900 dark:text-blue-100",children:["Destination: ",y.destination.name]})]}),m.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[m.jsxs("div",{children:["Reason: ",y.destination.reason]}),m.jsxs("div",{children:["Expected Passengers: ",y.destination.expectedPassengers]}),m.jsxs("div",{children:["ETA: ",y.estimatedArrival]})]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${he(y.priority)}`,children:[y.priority.toUpperCase()," PRIORITY"]}),m.jsx("span",{className:"text-xs text-gray-500",children:new Date(y.timestamp).toLocaleTimeString()})]})]}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{onClick:K,disabled:k,className:"flex-1 bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-400 text-white font-semibold py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:k?m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Accepting..."]}):m.jsxs(m.Fragment,{children:[m.jsx(Yh,{className:"h-4 w-4"}),"Accept Reroute"]})}),m.jsx("button",{onClick:Z,disabled:k,className:"flex-1 bg-gray-500 hover:bg-gray-600 disabled:bg-gray-400 text-white font-semibold py-2 px-4 rounded-lg transition-colors",children:"Decline"})]})]})})})]})}):m.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600 mx-auto mb-4"}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading driver dashboard..."})]})})},PP="pk.eyJ1Ijoic2FuaWRhZ290IiwiYSI6ImNtZjg3NHZxdzA0YXgycHNkNTl3dTQxbXoifQ.TlRvzYLTNSJsm_CVBmDAGQ";function IP({darkMode:u,setDarkMode:h}){const[y,w]=H.useState({lat:9.0054,lng:38.7636}),[k,A]=H.useState([]),[I,B]=H.useState([]),[i,R]=H.useState([]),[$,K]=H.useState([]),[Z,he]=H.useState(!0),[Te,ye]=H.useState(!1),[Me,Le]=H.useState(""),[De,Qe]=H.useState([]),[dt,St]=H.useState(!1),[ce,$e]=H.useState(null),[Ge,Ye]=H.useState(null),[ge,Pt]=H.useState(null),[tt,ct]=H.useState([]),[Kt,Mr]=H.useState([]),[Jt,Ht]=H.useState(!1),[Tt,Be]=H.useState(null),Je=H.useRef(),[ve,et]=H.useState({longitude:38.7636,latitude:9.0054,zoom:13}),Ut=u?"mapbox://styles/mapbox/dark-v10":"mapbox://styles/mapbox/light-v10";H.useEffect(()=>{(async()=>{he(!0);try{const[ir,Vn,Yt]=await Promise.all([mp(y.lat,y.lng,1200),Zf(),ql()]),ei=(ir||[]).map((nn,Gr)=>({id:nn.id||`route-${Gr}`,shortName:nn.route_short_name||nn.routeShortName||"38",destination:nn.route_name||nn.routeName||"Meskel Square",stopInfo:nn.name||"Next stop in 350 m",color:nn.route_color||"#3B82F6",eta:nn.next_arrivals&&nn.next_arrivals[0]||"3 min",lat:nn.lat||9.0054,lng:nn.lng||38.7636}));A(ei.slice(0,8)),R(Vn||[]);const Rn=[];for(const nn of Vn||[])if(nn.stops&&nn.stops.length>=2)try{const Gr=nn.stops.filter(sn=>sn.lat&&sn.lng).map(sn=>[parseFloat(sn.lng),parseFloat(sn.lat)]);if(Gr.length>=2){const sn=await kw(Gr,"driving");Rn.push({route_id:nn.id,geometry:sn.geometry,color:nn.color})}else Rn.push({route_id:nn.id,geometry:{type:"LineString",coordinates:nn.stops.map(sn=>[parseFloat(sn.lng),parseFloat(sn.lat)])},color:nn.color})}catch{Rn.push({route_id:nn.id,geometry:{type:"LineString",coordinates:nn.stops.map(sn=>[parseFloat(sn.lng),parseFloat(sn.lat)])},color:nn.color})}K(Rn),Mr(Vn||[]),B(Yt||[])}catch{A([{id:"1",shortName:"38",destination:"Meskel Square",stopInfo:"Next stop in 350 m",color:"#3B82F6",eta:"3 min",lat:9.0054,lng:38.7636},{id:"2",shortName:"91",destination:"Bole Airport",stopInfo:"Next stop in 200 m",color:"#F59E0B",eta:"5 min",lat:9.0054,lng:38.7636},{id:"3",shortName:"12",destination:"Merkato",stopInfo:"Next stop in 500 m",color:"#FDE047",eta:"7 min",lat:9.0054,lng:38.7636},{id:"4",shortName:"23",destination:"Piazza",stopInfo:"Next stop in 300 m",color:"#22C55E",eta:"11 min",lat:9.0054,lng:38.7636}]),R([]),K([]),B([])}he(!1)})();const hr=setInterval(async()=>{try{const ir=await ql();B(ir||[])}catch{}},1e4);return()=>clearInterval(hr)},[y]);const Ot=H.useCallback(()=>{if(!navigator.geolocation){Be("Geolocation not supported");return}Ht(!0),Be(null),navigator.geolocation.getCurrentPosition(lt=>{const{latitude:hr,longitude:ir}=lt.coords;w({lat:hr,lng:ir}),Ht(!1),Je.current&&Je.current.getMap&&Je.current.getMap().flyTo({center:[ir,hr],zoom:15,duration:1500,essential:!0}),et(Yt=>({...Yt,longitude:ir,latitude:hr,zoom:15}))},lt=>{console.error("Error getting location:",lt),Be("Unable to get location"),Ht(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},[]);H.useEffect(()=>{Ot()},[Ot]);const pr=H.useCallback(async lt=>{if(!lt.trim()){Qe([]);return}try{const hr=[];i.forEach(ir=>{(ir.name?.toLowerCase().includes(lt.toLowerCase())||ir.short_name?.toLowerCase().includes(lt.toLowerCase()))&&hr.push({id:`route-${ir.id}`,type:"route",name:ir.name,shortName:ir.short_name,color:ir.color,lat:ir.stops?.[0]?.lat,lng:ir.stops?.[0]?.lng})}),k.forEach(ir=>{(ir.destination?.toLowerCase().includes(lt.toLowerCase())||ir.stopInfo?.toLowerCase().includes(lt.toLowerCase()))&&hr.push({id:`stop-${ir.id}`,type:"stop",name:ir.destination,shortName:ir.shortName,color:ir.color,lat:ir.lat,lng:ir.lng})}),Qe(hr.slice(0,5))}catch{Qe([])}},[i,k]),lr=H.useCallback(async(lt,hr)=>{if(!(!lt||!hr))try{const ir=await vw(lt.lat,lt.lng,hr.lat,hr.lng);ct(ir||[])}catch{ct([])}},[]),zr=H.useCallback(lt=>{$e(lt),ye(!0),Je.current&&Je.current.getMap&&Je.current.getMap().flyTo({center:[lt.last_lng||lt.lng,lt.last_lat||lt.lat],zoom:Math.max(ve.zoom,15),duration:800})},[ve.zoom]);return m.jsxs("div",{className:"h-full w-full relative bg-white dark:bg-gray-900",children:[m.jsxs(Nf,{ref:Je,...ve,style:{width:"100%",height:"100%"},mapStyle:Ut,accessToken:PP,onViewportChange:et,onLoad:()=>he(!1),onClick:lt=>{if(lt&&lt.lngLat){const hr={lat:lt.lngLat.lat,lng:lt.lngLat.lng};Ge?ge||(Pt(hr),lr(Ge,hr)):Ye(hr)}},children:[$.map(lt=>m.jsx(Jh,{id:`route-line-${lt.route_id}`,type:"geojson",data:{type:"Feature",geometry:lt.geometry},children:m.jsx(Fc,{id:`route-line-layer-${lt.route_id}`,type:"line",source:`route-line-${lt.route_id}`,paint:{"line-color":lt.color,"line-width":4,"line-opacity":.7}})},`route-${lt.route_id}`)),m.jsx(Zo,{longitude:y.lng,latitude:y.lat,anchor:"center",children:m.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full border-2 border-white shadow-lg"})}),I.map(lt=>m.jsx(xw,{bus:{...lt,id:lt.bus_id,lat:lt.last_lat,lng:lt.last_lng,vehicle_number:lt.plate_number,speed:0,heading:0,passengers:lt.passengers,max_capacity:lt.max_capacity},route:i.find(hr=>String(hr.id)===String(lt.route_id)),onClick:()=>zr({...lt,id:lt.bus_id,lat:lt.last_lat,lng:lt.last_lng,vehicle_number:lt.plate_number,speed:0,heading:0,passengers:lt.passengers,max_capacity:lt.max_capacity}),isSelected:ce?.bus_id===lt.bus_id,isMobile:!0},lt.bus_id)),k.map(lt=>m.jsx(Zo,{longitude:lt.lng,latitude:lt.lat,anchor:"bottom",children:m.jsx("div",{className:"w-6 h-6 bg-white rounded-full border-2 shadow-lg flex items-center justify-center",style:{borderColor:lt.color},children:m.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:lt.color}})})},lt.id)),Ge&&m.jsx(Zo,{longitude:Ge.lng,latitude:Ge.lat,anchor:"bottom",children:m.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full border-2 border-white shadow-lg"})}),ge&&m.jsx(Zo,{longitude:ge.lng,latitude:ge.lat,anchor:"bottom",children:m.jsx("div",{className:"w-4 h-4 bg-red-500 rounded-full border-2 border-white shadow-lg"})})]}),m.jsx("div",{className:"absolute top-4 left-4 right-4 z-20",children:m.jsxs("div",{className:"relative",children:[m.jsxs(wt.div,{className:"h-12 rounded-2xl flex items-center justify-between px-4 shadow-lg",style:{backgroundColor:"#2ECC71"},animate:{scale:dt?1.02:1},transition:{duration:.2},children:[m.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[m.jsx(wt.div,{animate:{rotate:dt?45:0},transition:{duration:.2},children:m.jsx(hp,{className:"w-4 h-4",style:{color:"#05361B"}})}),m.jsx("input",{type:"text",placeholder:"Where to?",value:Me,onChange:lt=>{Le(lt.target.value),pr(lt.target.value),St(lt.target.value.length>0)},className:"flex-1 bg-transparent border-none outline-none font-medium placeholder-gray-600",style:{color:"#05361B",fontSize:16}})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(wt.button,{onClick:Ot,disabled:Jt,className:"w-5 h-5 flex items-center justify-center",whileTap:{scale:.9},animate:Jt?{rotate:360}:{rotate:0},transition:{duration:Jt?1:.2},children:m.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{color:"#05361B"},children:[m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),m.jsx("span",{className:"font-bold",style:{color:"#05361B",fontSize:16},children:"32 min"})]})]}),m.jsx(Ln,{children:dt&&m.jsx(wt.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.2},className:"absolute top-14 left-0 right-0 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden z-30 max-h-64 overflow-y-auto",children:De.length>0?De.map((lt,hr)=>m.jsxs(wt.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:hr*.05},onClick:()=>{Le(lt.name),St(!1),Qe([]),Je.current&&Je.current.getMap&&Je.current.getMap().flyTo({center:[lt.lng,lt.lat],zoom:15,duration:800})},className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-3 transition-colors",children:[m.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-white text-sm font-bold shadow-sm",style:{backgroundColor:lt.color},children:lt.shortName}),m.jsxs("div",{className:"flex-1",children:[m.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:lt.name}),m.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize",children:lt.type})]}),m.jsx("div",{className:"text-xs text-gray-400",children:m.jsx(Uc,{className:"w-3 h-3"})})]},lt.id)):Me.length>0?m.jsxs("div",{className:"px-4 py-6 text-center text-gray-500 dark:text-gray-400",children:[m.jsx(hp,{className:"w-6 h-6 mx-auto mb-2 opacity-50"}),m.jsxs("div",{className:"text-sm",children:['No results found for "',Me,'"']})]}):null})})]})}),m.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-20",children:m.jsxs("div",{className:"mx-2 mb-2 rounded-t-2xl overflow-hidden shadow-2xl border border-gray-200 dark:border-gray-800 bg-white/95 dark:bg-gray-900/95 backdrop-blur",children:[m.jsx("button",{onClick:()=>ye(!Te),className:"w-full flex items-center justify-center py-2",children:m.jsx("div",{className:"w-10 h-1.5 rounded-full",style:{backgroundColor:"#2ECC71"}})}),m.jsx("div",{className:`overflow-hidden transition-all duration-300 ${Te?"h-80":"h-32"}`,children:m.jsx("div",{className:"p-4 space-y-3 max-h-72 overflow-y-auto",children:ce?m.jsx(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm",children:m.jsxs("div",{className:"p-4",children:[m.jsxs("div",{className:"flex items-start justify-between mb-3",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx(up,{className:"w-5 h-5 text-blue-500"}),m.jsxs("span",{className:"font-bold text-gray-900 dark:text-gray-100",children:[i.find(lt=>String(lt.id)===String(ce.route_id))?.short_name||"Route"," • ",ce.plate_number||ce.vehicle_number||ce.id]})]}),m.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Passengers: ",ce.passengers||0," / ",ce.max_capacity||50]})]}),m.jsx("button",{onClick:()=>$e(null),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:m.jsx(j1,{className:"w-5 h-5"})})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[m.jsxs("div",{className:"px-3 py-2 rounded-xl bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600",children:[m.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"ETA"}),m.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:ce.eta_minutes?`${ce.eta_minutes} min`:"—"})]}),m.jsxs("div",{className:"px-3 py-2 rounded-xl bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600",children:[m.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"Next Stop"}),m.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",children:ce.next_stop||"—"})]}),m.jsxs("div",{className:"px-3 py-2 rounded-xl bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600",children:[m.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"Capacity"}),m.jsxs("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:[Math.round((ce.passengers||0)/(ce.max_capacity||50)*100),"%"]})]})]}),m.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2",children:m.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${(ce.passengers||0)/(ce.max_capacity||50)<.5?"bg-green-500":(ce.passengers||0)/(ce.max_capacity||50)<.8?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min((ce.passengers||0)/(ce.max_capacity||50)*100,100)}%`}})})]})}):Z?m.jsx("div",{className:"flex items-center justify-center py-8",children:m.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})}):Kt.map((lt,hr)=>m.jsxs(wt.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:hr*.05},onClick:()=>{if(Je.current&&Je.current.getMap&&lt.stops&&lt.stops.length>0){const ir=Je.current.getMap(),Vn=lt.stops.reduce((Yt,ei)=>({north:Math.max(Yt.north,ei.lat),south:Math.min(Yt.south,ei.lat),east:Math.max(Yt.east,ei.lng),west:Math.min(Yt.west,ei.lng)}),{north:lt.stops[0].lat,south:lt.stops[0].lat,east:lt.stops[0].lng,west:lt.stops[0].lng});ir.fitBounds([[Vn.west,Vn.south],[Vn.east,Vn.north]],{padding:50,duration:1e3})}},className:"w-full relative bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm hover:shadow-md transition-shadow",whileTap:{scale:.98},children:[m.jsx("div",{className:"absolute inset-y-0 left-0 w-1.5",style:{backgroundColor:lt.color}}),m.jsxs("div",{className:"flex items-center gap-4 pl-5 pr-4 py-4",children:[m.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-sm",style:{backgroundColor:lt.color},children:lt.short_name||lt.shortName||"?"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("div",{className:"font-bold text-gray-900 dark:text-gray-100 text-lg truncate",children:lt.name||lt.destination}),m.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:[lt.stops?.length||0," stops • ",lt.stops?.[0]?.name||"Route"]})]}),m.jsxs("div",{className:"text-right",children:[m.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:I.filter(ir=>String(ir.route_id)===String(lt.id)).length}),m.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"buses"})]})]})]},lt.id))})})]})})]})}function jP({darkMode:u,setDarkMode:h}){const[y,w]=H.useState(""),[k,A]=H.useState(""),[I,B]=H.useState([]),[i,R]=H.useState(!1),[$,K]=H.useState(!1),[Z,he]=H.useState([]),[Te,ye]=H.useState([]),[Me,Le]=H.useState(!1),[De,Qe]=H.useState(!1),dt=[{name:"Bole Medhanealem",lat:8.9806,lng:38.7578,type:"landmark"},{name:"Meskel Square",lat:9.0054,lng:38.7636,type:"landmark"},{name:"Mexico Square",lat:9.0136,lng:38.75,type:"landmark"},{name:"Piazza",lat:9.0333,lng:38.75,type:"landmark"},{name:"CMC",lat:9.0167,lng:38.7333,type:"hospital"},{name:"Arat Kilo",lat:9.0333,lng:38.75,type:"landmark"},{name:"Kazanchis",lat:9.0167,lng:38.75,type:"business"},{name:"Merkato",lat:9.0167,lng:38.7333,type:"market"},{name:"Addis Ababa Airport",lat:8.9779,lng:38.7993,type:"airport"},{name:"Megenagna",lat:9.0054,lng:38.7892,type:"business"},{name:"Kara",lat:9.0356,lng:38.7528,type:"business"}],St=ge=>{if(w(ge),ge.length>0){const Pt=dt.filter(tt=>tt.name.toLowerCase().includes(ge.toLowerCase()));he(Pt),Le(!0)}else Le(!1)},ce=ge=>{if(A(ge),ge.length>0){const Pt=dt.filter(tt=>tt.name.toLowerCase().includes(ge.toLowerCase()));ye(Pt),Qe(!0)}else Qe(!1)},$e=(ge,Pt)=>{Pt==="from"?(w(ge.name),Le(!1)):(A(ge.name),Qe(!1))},Ge=async()=>{if(!(!y.trim()||!k.trim())){R(!0);try{const ge=dt.find(Je=>Je.name===y),Pt=dt.find(Je=>Je.name===k);if(!ge||!Pt)throw new Error("Location not found");const tt=await mp(ge.lat,ge.lng,1e3),ct=await mp(Pt.lat,Pt.lng,1e3),Kt=await Zf(),Mr=await ql(),Jt=Ye(ge.lat,ge.lng,Pt.lat,Pt.lng),Ht=Math.ceil(Jt*12),Tt=[],Be=Kt.filter(Je=>{if(!Je.stops||Je.stops.length===0)return!1;const ve=Je.stops.some(Ut=>Ye(Ut.lat,Ut.lng,ge.lat,ge.lng)<1),et=Je.stops.some(Ut=>Ye(Ut.lat,Ut.lng,Pt.lat,Pt.lng)<1);return ve&&et});if(console.log("Found connecting routes:",Be.length),Be.length===0){const Je=Kt.filter(ve=>!ve.stops||ve.stops.length===0?!1:ve.stops.some(et=>et.name.toLowerCase().includes("mexico")||et.name.toLowerCase().includes("meskel")));console.log("Found hub routes:",Je.length);for(const ve of Je.slice(0,2)){const et=Mr.filter(lt=>String(lt.route_id)===String(ve.id)),Ut=et[0]?.bus_type||"City Bus",Ot=et[0]?.menged_compatible||!1,pr=Math.ceil(Jt*2.5),zr=Ht+pr+5;Tt.push({id:ve.id,route:ve.short_name||ve.shortName,color:ve.color||"#3B82F6",duration:`${zr} min`,busDuration:`${pr} min`,walkingTime:`${Ht} min`,transfers:1,cost:"Free",busType:Ut,mengedCompatible:Ot,operator:et[0]?.operator||"Sheger",steps:[`Walk ${Ht} min to ${tt[0]?.name||"nearest stop"}`,`Take ${ve.short_name||ve.shortName} (${Ut}) to Mexico Square`,"Transfer to another route (5 min wait)",`Walk 2 min to ${Pt.name}`],fromStop:tt[0]?.name||"Nearest Stop",toStop:"Mexico Square",busCount:et.length,nextBus:et[0]?.eta_minutes?`${et[0].eta_minutes} min`:"N/A"})}}else for(const Je of Be.slice(0,3)){const ve=Mr.filter(lr=>String(lr.route_id)===String(Je.id)),et=ve[0]?.bus_type||"City Bus",Ut=ve[0]?.menged_compatible||!1,Ot=Math.ceil(Jt*2.5),pr=Ht+Ot;Tt.push({id:Je.id,route:Je.short_name||Je.shortName,color:Je.color||"#3B82F6",duration:`${pr} min`,busDuration:`${Ot} min`,walkingTime:`${Ht} min`,transfers:0,cost:"Free",busType:et,mengedCompatible:Ut,operator:ve[0]?.operator||"Sheger",steps:[`Walk ${Ht} min to ${tt[0]?.name||"nearest stop"}`,`Take ${Je.short_name||Je.shortName} (${et}) to ${ct[0]?.name||"destination"}`,`Walk 2 min to ${Pt.name}`],fromStop:tt[0]?.name||"Nearest Stop",toStop:ct[0]?.name||"Destination Stop",busCount:ve.length,nextBus:ve[0]?.eta_minutes?`${ve[0].eta_minutes} min`:"N/A"})}if(Tt.length===0){const Je=Kt[0];Je&&Tt.push({id:Je.id,route:Je.short_name||Je.shortName||"1",color:Je.color||"#1e40af",duration:`${Ht+25} min`,busDuration:"25 min",walkingTime:`${Ht} min`,transfers:0,cost:"Free",busType:"City Bus",mengedCompatible:!0,operator:"Sheger",steps:[`Walk ${Ht} min to ${tt[0]?.name||"nearest stop"}`,`Take Route ${Je.short_name||Je.shortName} (City Bus) to ${ct[0]?.name||"destination"}`,`Walk 2 min to ${Pt.name}`],fromStop:tt[0]?.name||"Nearest Stop",toStop:ct[0]?.name||"Destination Stop",busCount:Mr.filter(ve=>String(ve.route_id)===String(Je.id)).length,nextBus:"5 min"})}console.log("Trip results generated:",Tt),B(Tt),K(!0)}catch(ge){console.error("Trip planning error:",ge),B([]),K(!0)}R(!1)}},Ye=(ge,Pt,tt,ct)=>{const Mr=(tt-ge)*Math.PI/180,Jt=(ct-Pt)*Math.PI/180,Ht=Math.sin(Mr/2)*Math.sin(Mr/2)+Math.cos(ge*Math.PI/180)*Math.cos(tt*Math.PI/180)*Math.sin(Jt/2)*Math.sin(Jt/2);return 6371*(2*Math.atan2(Math.sqrt(Ht),Math.sqrt(1-Ht)))};return m.jsxs("div",{className:"h-full w-full bg-white dark:bg-gray-900",children:[m.jsxs("div",{className:"safe-screen px-4 pt-4 pb-2",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500 text-white flex items-center justify-center",children:m.jsx(Bc,{className:"w-5 h-5"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Trip Planner"}),m.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Plan your journey"})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:m.jsx(Qi,{className:"w-4 h-4 text-gray-400"})}),m.jsx("input",{type:"text",placeholder:"From (e.g., Meskel Square, Bole Airport)",value:y,onChange:ge=>St(ge.target.value),className:"w-full pl-10 pr-4 py-3 rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),m.jsx(Ln,{children:Me&&Z.length>0&&m.jsx(wt.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 z-50 max-h-48 overflow-y-auto",children:Z.map((ge,Pt)=>m.jsxs(wt.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:Pt*.05},onClick:()=>$e(ge,"from"),className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-3",children:[m.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-white text-sm font-bold bg-blue-500",children:ge.type==="airport"?"✈️":ge.type==="hospital"?"🏥":ge.type==="market"?"🏪":ge.type==="business"?"🏢":ge.type==="residential"?"🏠":"📍"}),m.jsxs("div",{children:[m.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:ge.name}),m.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize",children:ge.type})]})]},ge.name))})})]}),m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:m.jsx(Uc,{className:"w-4 h-4 text-gray-400"})}),m.jsx("input",{type:"text",placeholder:"To (e.g., Piazza, Merkato)",value:k,onChange:ge=>ce(ge.target.value),className:"w-full pl-10 pr-4 py-3 rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),m.jsx(Ln,{children:De&&Te.length>0&&m.jsx(wt.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 z-50 max-h-48 overflow-y-auto",children:Te.map((ge,Pt)=>m.jsxs(wt.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:Pt*.05},onClick:()=>$e(ge,"to"),className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-3",children:[m.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-white text-sm font-bold bg-green-500",children:ge.type==="airport"?"✈️":ge.type==="hospital"?"🏥":ge.type==="market"?"🏪":ge.type==="business"?"🏢":ge.type==="residential"?"🏠":"📍"}),m.jsxs("div",{children:[m.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:ge.name}),m.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize",children:ge.type})]})]},ge.name))})})]}),m.jsx(wt.button,{onClick:Ge,disabled:i||!y.trim()||!k.trim(),className:"w-full py-3 rounded-2xl font-semibold text-white shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"#2ECC71"},whileTap:{scale:.98},whileHover:{scale:1.02},children:i?m.jsxs("div",{className:"flex items-center justify-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Planning your trip..."]}):m.jsxs("div",{className:"flex items-center justify-center gap-2",children:[m.jsx(hp,{className:"w-4 h-4"}),y&&k?"Plan Trip":"Select locations first"]})})]})]}),m.jsx(Ln,{children:$&&m.jsxs(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"flex-1 overflow-auto px-4 pb-4",children:[m.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-1",children:["Trip Options from ",y," to ",k]}),m.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[I.length," route",I.length!==1?"s":""," found"]})]}),m.jsx(wt.button,{onClick:()=>K(!1),className:"px-3 py-1 text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",whileTap:{scale:.95},children:"Clear"})]}),m.jsx("div",{className:"space-y-3",children:I.length>0?I.map((ge,Pt)=>m.jsxs(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Pt*.1},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-4 shadow-sm",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-white text-lg font-bold shadow-sm",style:{backgroundColor:ge.color||"#3B82F6"},children:ge.route||"?"}),m.jsxs("div",{className:"flex-1",children:[m.jsx("div",{className:"font-bold text-gray-900 dark:text-gray-100 text-lg",children:ge.duration}),m.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[ge.transfers," transfers • ",ge.cost]})]}),m.jsxs("div",{className:"text-right",children:[m.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"Next bus"}),m.jsx("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:ge.nextBus})]})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[m.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx(go,{className:"w-4 h-4 text-blue-500"}),m.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Walking Time"})]}),m.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:ge.walkingTime})]}),m.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx(Bc,{className:"w-4 h-4 text-green-500"}),m.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Bus Duration"})]}),m.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:ge.busDuration})]})]}),m.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900 rounded-lg p-3 mb-4",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("div",{className:"font-medium text-blue-900 dark:text-blue-100",children:ge.busType}),m.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:["Operator: ",ge.operator]})]}),m.jsxs("div",{className:"text-right",children:[m.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Menged Compatible"}),m.jsx("div",{className:`text-lg font-bold ${ge.mengedCompatible?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:ge.mengedCompatible?"✓ Yes":"✗ No"})]})]}),m.jsxs("div",{className:"mt-2 text-sm text-blue-700 dark:text-blue-300",children:[ge.busCount," buses available"]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Route Details"}),ge.steps?.map((tt,ct)=>m.jsxs("div",{className:"flex items-start gap-3 text-sm",children:[m.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500 mt-2 flex-shrink-0"}),m.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:tt})]},ct))]})]},Pt)):m.jsxs(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[m.jsx(Bc,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),m.jsx("div",{className:"font-medium mb-2",children:"No routes found"}),m.jsx("div",{className:"text-sm mb-4",children:"We couldn't find any routes between these locations"}),m.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:"Try selecting different locations from the suggestions above"})]})})]})})]})}function NP({darkMode:u,setDarkMode:h,user:y}){const[w,k]=H.useState([]),[A,I]=H.useState(!0),[B,i]=H.useState({lat:9.0054,lng:38.7636}),[R,$]=H.useState(new Date),[K,Z]=H.useState(""),he=()=>{if(!navigator.geolocation){Z("Geolocation is not supported by this browser");return}I(!0),Z(""),navigator.geolocation.getCurrentPosition(ye=>{const Me={lat:ye.coords.latitude,lng:ye.coords.longitude};i(Me),Te(Me)},ye=>{console.error("Error getting location:",ye),Z("Unable to get your location. Using default location."),Te()},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},Te=async(ye=B)=>{I(!0);try{const Le=(await mp(ye.lat,ye.lng,1200)||[]).map(De=>({id:De.id,name:De.name,lat:De.lat,lng:De.lng,routeId:De.route_id,routeName:De.route_name,routeShortName:De.route_short_name,routeColor:De.route_color,nextArrivals:["3 min","13 min","23 min"],distance:(De.meters||0)/1e3,walkingTime:Math.ceil((De.meters||0)/1e3*12)}));k(Le)}catch(Me){console.error("Error loading nearby stops:",Me),k([])}$(new Date),I(!1)};return H.useEffect(()=>{he();const ye=setInterval(()=>{Te()},3e4);return()=>clearInterval(ye)},[]),m.jsxs("div",{className:"h-full w-full bg-white dark:bg-gray-900",children:[m.jsxs("div",{className:"safe-screen px-4 pt-4 pb-2",children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-500 text-white flex items-center justify-center",children:m.jsx(Qi,{className:"w-5 h-5"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Nearby Stops"}),m.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:K?"Using default location":"Stops around you"})]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(wt.button,{onClick:he,disabled:A,className:"p-2 rounded-xl bg-blue-100 dark:bg-blue-900/20 hover:bg-blue-200 dark:hover:bg-blue-900/40 transition-colors",whileTap:{scale:.95},children:m.jsx(Uc,{className:`w-5 h-5 text-blue-600 dark:text-blue-400 ${A?"animate-spin":""}`})}),m.jsx(wt.button,{onClick:()=>Te(),disabled:A,className:"p-2 rounded-xl bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",whileTap:{scale:.95},children:m.jsx(td,{className:`w-5 h-5 text-gray-600 dark:text-gray-400 ${A?"animate-spin":""}`})})]})]}),m.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[m.jsx(go,{className:"w-4 h-4 text-gray-400"}),m.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Last updated: ",R.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}),m.jsx("div",{className:"flex-1 overflow-auto px-4 pb-4",children:A?m.jsxs("div",{className:"flex items-center justify-center py-12",children:[m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"}),m.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading nearby stops..."})]}):w.length>0?m.jsx("div",{className:"space-y-3",children:w.map((ye,Me)=>m.jsx(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Me*.05},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-4 shadow-sm hover:shadow-md transition-shadow",children:m.jsxs("div",{className:"flex items-start justify-between",children:[m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[m.jsx("div",{className:"w-8 h-8 rounded flex items-center justify-center text-white text-sm font-bold",style:{backgroundColor:ye.routeColor},children:ye.routeShortName}),m.jsxs("div",{className:"flex-1",children:[m.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:ye.name}),m.jsx("p",{className:"text-sm text-gray-500",children:ye.routeName})]})]}),m.jsxs("div",{className:"flex items-center space-x-4 mb-3 text-sm text-gray-500",children:[m.jsxs("div",{className:"flex items-center space-x-1",children:[m.jsx(Qi,{className:"w-4 h-4"}),m.jsxs("span",{children:[ye.distance.toFixed(1)," km away"]})]}),m.jsxs("div",{className:"flex items-center space-x-1",children:[m.jsx(s0,{className:"w-4 h-4"}),m.jsxs("span",{children:[ye.walkingTime," min walk"]})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Next Arrivals"}),m.jsx("div",{className:"flex space-x-3",children:ye.nextArrivals.slice(0,3).map((Le,De)=>m.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${De===0?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:Le},De))})]})]}),m.jsx(wt.button,{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors ml-4",whileTap:{scale:.95},children:m.jsx(Uc,{className:"w-5 h-5 text-gray-400"})})]})},`${ye.id}-${ye.routeId}`))}):m.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[m.jsx(Qi,{className:"w-12 h-12 text-gray-400 mb-4"}),m.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No stops found"}),m.jsx("p",{className:"text-gray-500 text-center",children:"No nearby stops available"})]})})]})}function DP({darkMode:u,setDarkMode:h}){const[y,w]=H.useState([]),[k,A]=H.useState(!0),[I,B]=H.useState(!1);H.useEffect(()=>{i()},[]);const i=async()=>{A(!0);try{const R=await Zf(),$=await ql(),K=R.slice(0,5).map(Z=>{const he=$.filter(ye=>String(ye.route_id)===String(Z.id)),Te=he[0];return{id:Z.id,type:"route",name:Z.name||Z.short_name,description:Z.stops?.[0]?.name?`From ${Z.stops[0].name}`:"Route",color:Z.color||"#3B82F6",shortName:Z.short_name||Z.shortName||"?",eta:Te?.eta_minutes?`${Te.eta_minutes} min`:"N/A",nextArrival:Te?.eta_minutes?`${new Date(Date.now()+Te.eta_minutes*6e4).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:"N/A",busCount:he.length}});w(K)}catch(R){console.error("Error loading favorites:",R),w([])}A(!1)};return m.jsxs("div",{className:"h-full w-full bg-white dark:bg-gray-900",children:[m.jsx("div",{className:"safe-screen px-4 pt-4 pb-2",children:m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-500 text-white flex items-center justify-center",children:m.jsx(Gm,{className:"w-5 h-5"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Favorites"}),m.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Your saved routes & stops"})]})]}),m.jsx(wt.button,{onClick:()=>B(!0),className:"p-2 rounded-xl bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",whileTap:{scale:.95},children:m.jsx(l0,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]})}),m.jsx("div",{className:"flex-1 overflow-auto px-4 pb-4",children:k?m.jsxs("div",{className:"flex items-center justify-center py-12",children:[m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"}),m.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading favorites..."})]}):y.length>0?m.jsx("div",{className:"space-y-3",children:y.map((R,$)=>m.jsx(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:$*.05},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-4 shadow-sm hover:shadow-md transition-shadow",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[m.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-sm",style:{backgroundColor:R.color},children:R.shortName}),m.jsxs("div",{className:"flex-1",children:[m.jsx("h3",{className:"font-bold text-gray-900 dark:text-white text-lg",children:R.name}),m.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:R.description}),m.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[m.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[m.jsx(go,{className:"w-3 h-3"}),m.jsx("span",{children:R.eta})]}),m.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[m.jsx(dp,{className:"w-3 h-3"}),m.jsx("span",{children:R.nextArrival})]})]})]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(wt.button,{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",whileTap:{scale:.95},children:m.jsx(Uc,{className:"w-5 h-5 text-gray-400"})}),m.jsx(wt.button,{className:"p-2 hover:bg-red-100 dark:hover:bg-red-900 rounded-lg transition-colors",whileTap:{scale:.95},children:m.jsx(Gm,{className:"w-5 h-5 text-red-500 fill-current"})})]})]})},R.id))}):m.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[m.jsx(Gm,{className:"w-12 h-12 text-gray-400 mb-4"}),m.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No favorites yet"}),m.jsx("p",{className:"text-gray-500 text-center mb-4",children:"Save routes and stops you use frequently"}),m.jsx(wt.button,{onClick:()=>B(!0),className:"px-6 py-3 rounded-2xl font-semibold text-white shadow-lg",style:{backgroundColor:"#2ECC71"},whileTap:{scale:.98},whileHover:{scale:1.02},children:"Add Favorites"})]})}),m.jsx(Ln,{children:I&&m.jsx(wt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-end z-50",onClick:()=>B(!1),children:m.jsxs(wt.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"w-full bg-white dark:bg-gray-800 rounded-t-3xl p-6 max-h-96",onClick:R=>R.stopPropagation(),children:[m.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full mx-auto mb-6"}),m.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Add to Favorites"}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:m.jsx(Search,{className:"w-4 h-4 text-gray-400"})}),m.jsx("input",{type:"text",placeholder:"Search routes or stops...",className:"w-full pl-10 pr-4 py-3 rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),m.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Search for routes or stops to add to your favorites"})]})]})})})]})}function LP({darkMode:u,setDarkMode:h}){const[y,w]=H.useState(0),[k,A]=H.useState(""),[I,B]=H.useState(""),[i,R]=H.useState(!1),[$,K]=H.useState(!1),[Z,he]=H.useState([]),[Te,ye]=H.useState(!1),[Me,Le]=H.useState(!1),De=[{id:"route",label:"Route Information",icon:"🚌"},{id:"app",label:"App Experience",icon:"📱"},{id:"service",label:"Service Quality",icon:"⭐"},{id:"other",label:"Other",icon:"💬"}],Qe=async()=>{if(!(!y||!k.trim()||!I)){K(!0);try{await bw({route:I==="route"?"General Route Feedback":"General Feedback",busNumber:"N/A",plateNumber:"N/A",feedback:`Rating: ${y}/5 stars
Category: ${De.find(ce=>ce.id===I)?.label}

${k}`,ip:"",userAgent:navigator.userAgent,locale:navigator.language}),R(!0)}catch(ce){console.error("Feedback submission error:",ce),R(!0)}K(!1)}},dt=()=>{w(0),A(""),B(""),R(!1)},St=async()=>{Le(!0);try{const ce=await Tw(10);he(ce||[])}catch(ce){console.error("Error loading feedbacks:",ce),he([])}Le(!1)};return m.jsxs("div",{className:"h-full w-full bg-white dark:bg-gray-900",children:[m.jsx("div",{className:"safe-screen px-4 pt-4 pb-2",children:m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-10 h-10 rounded-xl bg-orange-500 text-white flex items-center justify-center",children:m.jsx(Ym,{className:"w-5 h-5"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Feedback"}),m.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Share your experience"})]})]}),m.jsx(wt.button,{onClick:()=>{ye(!Te),Te||St()},className:"p-2 rounded-xl bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",whileTap:{scale:.95},children:m.jsx(td,{className:`w-5 h-5 text-gray-600 dark:text-gray-400 ${Me?"animate-spin":""}`})})]})}),m.jsxs("div",{className:"flex-1 overflow-auto px-4 pb-4",children:[m.jsx(Ln,{children:Te&&m.jsx(wt.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-6",children:m.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-2xl p-4",children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Recent Feedback"}),Me?m.jsxs("div",{className:"flex items-center justify-center py-4",children:[m.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-orange-500"}),m.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading..."})]}):Z.length>0?m.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:Z.map((ce,$e)=>m.jsxs(wt.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:$e*.05},className:"bg-white dark:bg-gray-700 rounded-lg p-3 border border-gray-200 dark:border-gray-600",children:[m.jsxs("div",{className:"flex items-start justify-between mb-2",children:[m.jsxs("div",{className:"flex-1",children:[m.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:ce.route}),m.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Bus: ",ce.bus_number," • Plate: ",ce.plate_number]})]}),m.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:new Date(ce.created_at).toLocaleDateString()})]}),m.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-600 rounded p-2",children:ce.feedback})]},ce.id))}):m.jsxs("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400",children:[m.jsx(Ym,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),m.jsx("div",{children:"No recent feedback"})]})]})})}),i?m.jsxs(wt.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"flex flex-col items-center justify-center py-12",children:[m.jsx(wt.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"w-20 h-20 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center mb-6",children:m.jsx(Yh,{className:"w-10 h-10 text-green-600 dark:text-green-400"})}),m.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Thank You!"}),m.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center mb-6",children:"Your feedback has been submitted successfully. We appreciate your input!"}),m.jsx(wt.button,{onClick:dt,className:"px-6 py-3 rounded-2xl font-semibold text-white shadow-lg",style:{backgroundColor:"#2ECC71"},whileTap:{scale:.98},whileHover:{scale:1.02},children:"Submit Another"})]}):m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"How was your experience?"}),m.jsx("div",{className:"flex justify-center space-x-2",children:[1,2,3,4,5].map(ce=>m.jsx(wt.button,{onClick:()=>w(ce),className:"p-2",whileTap:{scale:.9},whileHover:{scale:1.1},children:m.jsx(dp,{className:`w-8 h-8 ${ce<=y?"text-yellow-400 fill-current":"text-gray-300 dark:text-gray-600"}`})},ce))})]}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Category"}),m.jsx("div",{className:"grid grid-cols-2 gap-3",children:De.map(ce=>m.jsxs(wt.button,{onClick:()=>B(ce.id),className:`p-4 rounded-2xl border-2 transition-all ${I===ce.id?"border-blue-500 bg-blue-50 dark:bg-blue-900":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"}`,whileTap:{scale:.98},children:[m.jsx("div",{className:"text-2xl mb-2",children:ce.icon}),m.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:ce.label})]},ce.id))})]}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Tell us more"}),m.jsx("textarea",{value:k,onChange:ce=>A(ce.target.value),placeholder:"Share your thoughts, suggestions, or report any issues...",className:"w-full h-32 p-4 rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),m.jsx(wt.button,{onClick:Qe,disabled:!y||!k.trim()||!I||$,className:"w-full py-4 rounded-2xl font-semibold text-white shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"#2ECC71"},whileTap:{scale:.98},whileHover:{scale:1.02},children:$?m.jsxs("div",{className:"flex items-center justify-center gap-2",children:[m.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Submitting..."]}):m.jsxs("div",{className:"flex items-center justify-center gap-2",children:[m.jsx(Jm,{className:"w-5 h-5"}),"Submit Feedback"]})}),m.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-50 dark:bg-blue-900 rounded-2xl",children:[m.jsx(i0,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),m.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[m.jsx("p",{className:"font-medium mb-1",children:"Your feedback helps us improve!"}),m.jsx("p",{children:"We read every submission and use your input to enhance the transit experience for everyone."})]})]})]})]})]})}function RP({darkMode:u,setDarkMode:h,user:y}){const[w,k]=H.useState("bank"),[A,I]=H.useState(""),[B,i]=H.useState(""),[R,$]=H.useState(""),[K,Z]=H.useState(""),[he,Te]=H.useState(!1),[ye,Me]=H.useState(!1),[Le,De]=H.useState(""),Qe=[25,50,100,200,500,1e3],dt=[{id:"bank",name:"Bank Transfer",icon:AS,description:"Transfer from your bank account to Menged card",color:"#2ECC71",logo:"🏦"},{id:"card",name:"Credit/Debit Card",icon:S1,description:"Pay with your bank card",color:"#007AFF",logo:"💳"},{id:"telebirr",name:"Telebirr",icon:I1,description:"Pay using Telebirr mobile payment",color:"#FF6B6B",logo:"📱"}],St=async()=>{if(!A||parseFloat(A)<=0){De("Please enter a valid amount");return}if(w==="card"&&(!B||!R||!K)){De("Please fill in all card details");return}Te(!0),De("");try{if(w==="bank"){window.open("about:blank","_blank"),Me(!0),setTimeout(()=>{Me(!1),I("")},3e3),Te(!1);return}if(w==="telebirr"){window.open("about:blank","_blank"),Me(!0),setTimeout(()=>{Me(!1),I("")},3e3),Te(!1);return}await new Promise(ce=>setTimeout(ce,2e3)),Me(!0),setTimeout(()=>{Me(!1),I(""),i(""),$(""),Z("")},3e3)}catch{De("Top-up failed. Please try again.")}Te(!1)};return m.jsxs("div",{className:"h-full w-full bg-white dark:bg-gray-900",children:[m.jsx("div",{className:"safe-screen px-4 pt-4 pb-2",children:m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-500 text-white flex items-center justify-center",children:m.jsx("div",{className:"font-bold text-lg",children:"M"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"AddisTransit Top-Up"}),m.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Add credit to your Menged card"}),y?.mengedId&&m.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 font-medium mt-1",children:["Card ID: ",y.mengedId]})]})]})}),m.jsxs("div",{className:"flex-1 overflow-auto px-4 pb-4",children:[m.jsxs("div",{className:"mb-6",children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"Top-Up Method"}),m.jsx("div",{className:"space-y-3",children:dt.map(ce=>(ce.icon,m.jsx(wt.button,{onClick:()=>k(ce.id),className:`w-full p-4 rounded-2xl border-2 transition-all ${w===ce.id?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"}`,whileTap:{scale:.98},children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-white",style:{backgroundColor:ce.color},children:m.jsx("div",{className:"text-2xl",children:ce.logo})}),m.jsxs("div",{className:"flex-1 text-left",children:[m.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:ce.name}),m.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:ce.description})]}),m.jsx("div",{className:`w-6 h-6 rounded-full border-2 ${w===ce.id?"border-green-500 bg-green-500":"border-gray-300 dark:border-gray-600"}`,children:w===ce.id&&m.jsx(Yh,{className:"w-4 h-4 text-white m-0.5"})})]})},ce.id)))})]}),m.jsxs("div",{className:"mb-6",children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"Amount"}),m.jsx("div",{className:"grid grid-cols-3 gap-3 mb-4",children:Qe.map(ce=>m.jsxs(wt.button,{onClick:()=>I(ce.toString()),className:`py-3 px-4 rounded-xl font-semibold transition-all ${A===ce.toString()?"bg-green-500 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300"}`,whileTap:{scale:.95},children:[ce," ETB"]},ce))}),m.jsxs("div",{className:"relative",children:[m.jsx("input",{type:"number",placeholder:"Enter custom amount",value:A,onChange:ce=>I(ce.target.value),className:"w-full py-3 px-4 rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-transparent"}),m.jsx("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400 font-medium",children:"ETB"})]})]}),m.jsx(Ln,{children:w==="card"&&m.jsxs(wt.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-6",children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"Card Details"}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Card Number"}),m.jsx("input",{type:"text",placeholder:"1234 5678 9012 3456",value:B,onChange:ce=>i(ce.target.value),className:"w-full py-3 px-4 rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Expiry Date"}),m.jsx("input",{type:"text",placeholder:"MM/YY",value:R,onChange:ce=>$(ce.target.value),className:"w-full py-3 px-4 rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"CVV"}),m.jsx("input",{type:"text",placeholder:"123",value:K,onChange:ce=>Z(ce.target.value),className:"w-full py-3 px-4 rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]})]})}),m.jsx(Ln,{children:Le&&m.jsx(wt.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mb-4 p-3 rounded-xl bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(i0,{className:"w-4 h-4 text-red-500"}),m.jsx("span",{className:"text-sm text-red-700 dark:text-red-300",children:Le})]})})}),m.jsx(Ln,{children:ye&&m.jsx(wt.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mb-4 p-3 rounded-xl bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Yh,{className:"w-4 h-4 text-green-500"}),m.jsx("span",{className:"text-sm text-green-700 dark:text-green-300",children:w==="bank"?"Redirected to bank transfer page":w==="telebirr"?"Redirected to Telebirr payment page":`Menged card topped up successfully! ${A} ETB added to your card.`})]})})}),m.jsx(wt.button,{onClick:St,disabled:he||!A||parseFloat(A)<=0,className:"w-full py-4 rounded-2xl font-semibold text-white shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"#2ECC71"},whileTap:{scale:.98},whileHover:{scale:1.02},children:he?m.jsxs("div",{className:"flex items-center justify-center gap-2",children:[m.jsx(My,{className:"w-5 h-5 animate-spin"}),w==="bank"?"Redirecting to bank...":w==="telebirr"?"Redirecting to Telebirr...":"Topping up Menged card..."]}):m.jsxs("div",{className:"flex items-center justify-center gap-2",children:[m.jsx("div",{className:"font-bold text-lg",children:"M"}),w==="bank"?"Continue to Bank Transfer":w==="telebirr"?"Continue to Telebirr":`Top Up Menged Card ${A?`${A} ETB`:""}`]})}),m.jsxs("div",{className:"mt-8",children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"Recent Menged Top-Ups"}),m.jsx("div",{className:"space-y-3",children:[{id:1,amount:100,method:"Bank Transfer",date:"2024-01-15",status:"Completed"},{id:2,amount:200,method:"Credit Card",date:"2024-01-10",status:"Completed"},{id:3,amount:50,method:"Telebirr",date:"2024-01-05",status:"Completed"}].map(ce=>m.jsx(wt.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-500 text-white flex items-center justify-center",children:m.jsx("div",{className:"font-bold text-sm",children:"M"})}),m.jsxs("div",{children:[m.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[ce.amount," ETB"]}),m.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[ce.method," • ",ce.date]})]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Yh,{className:"w-4 h-4 text-green-500"}),m.jsx("span",{className:"text-sm text-green-600 dark:text-green-400 font-medium",children:ce.status})]})]})},ce.id))})]})]})]})}function zP({onLogin:u}){const[h,y]=H.useState("phone"),[w,k]=H.useState(""),[A,I]=H.useState(""),[B,i]=H.useState(!1),[R,$]=H.useState(!1),[K,Z]=H.useState(""),[he,Te]=H.useState(!1),[ye,Me]=H.useState(0);H.useEffect(()=>{let ce=null;return ye>0?ce=setInterval(()=>{Me($e=>$e-1)},1e3):ye===0&&Te(!1),()=>clearInterval(ce)},[ye]);const Le=ce=>{const $e=ce.replace(/\s/g,""),Ge=/^\+[1-9]\d{7,14}$/,Ye=/^(\+251|0)?[79]\d{8}$/;return Ge.test($e)||Ye.test($e)},De=ce=>{const $e=ce.replace(/\s/g,"");if(/^\+[1-9]\d{7,14}$/.test($e))return $e;const Ge=$e.replace(/\D/g,"");return Ge.startsWith("251")?`+${Ge.slice(0,3)} ${Ge.slice(3,6)} ${Ge.slice(6,8)} ${Ge.slice(8)}`:Ge.startsWith("0")?`+251 ${Ge.slice(1,4)} ${Ge.slice(4,6)} ${Ge.slice(6,8)} ${Ge.slice(8)}`:ce},Qe=async()=>{if(!Le(w)){Z("Please enter a valid Ethiopian phone number");return}$(!0),Z("");try{const ce=await eP(w);ce&&ce.success?(Te(!0),Me(ce.expires_in||300),y("otp")):Z(ce&&ce.error||"Failed to send OTP. Please try again.")}catch(ce){console.error("OTP send error:",ce),Z("Network error. Please check your connection and try again.")}$(!1)},dt=async()=>{if(A.length!==6){Z("Please enter the 6-digit OTP");return}$(!0),Z("");try{const ce=await tP(w,A);if(ce&&ce.success){if(B){const $e={phoneNumber:w,mengedId:ce.menged_id,loginTime:Date.now(),expiresAt:Date.now()+2592e6};localStorage.setItem("addistransit_session",JSON.stringify($e))}u({phoneNumber:w,mengedId:ce.menged_id,rememberMe:B})}else Z(ce&&ce.error||"Invalid OTP. Please try again.")}catch(ce){console.error("OTP verification error:",ce),Z("OTP verification failed. Please try again.")}$(!1)},St=async()=>{$(!0),Z("");try{const ce=await rP(w);ce&&ce.success?(Me(ce.expires_in||300),Te(!0)):Z(ce&&ce.error||"Failed to resend OTP. Please try again.")}catch{Z("Failed to resend OTP. Please try again.")}$(!1)};return m.jsx("div",{className:"h-full w-full bg-gradient-to-br from-green-50 to-blue-50 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4",children:m.jsxs(wt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-sm",children:[m.jsxs("div",{className:"text-center mb-8",children:[m.jsx(wt.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2},className:"w-16 h-16 bg-green-500 rounded-2xl flex items-center justify-center mx-auto mb-4",children:m.jsx("div",{className:"font-bold text-2xl text-white",children:"AT"})}),m.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Welcome to AddisTransit"}),m.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[h==="phone"&&"Enter your phone number to continue",h==="otp"&&"Enter the OTP sent to your phone"]})]}),m.jsx("div",{className:"flex items-center justify-center mb-8",children:m.jsx("div",{className:"flex items-center space-x-2",children:["phone","otp"].map((ce,$e)=>m.jsxs("div",{className:"flex items-center",children:[m.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold ${h===ce?"bg-green-500 text-white":["phone","otp"].indexOf(h)>$e?"bg-green-200 text-green-700":"bg-gray-200 text-gray-500"}`,children:$e+1}),$e<1&&m.jsx("div",{className:`w-8 h-0.5 ${["phone","otp"].indexOf(h)>$e?"bg-green-500":"bg-gray-200"}`})]},ce))})}),m.jsxs("div",{className:"space-y-4",children:[m.jsx(Ln,{children:h==="phone"&&m.jsxs(wt.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-4",children:[m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:m.jsx(HS,{className:"w-5 h-5 text-gray-400"})}),m.jsx("input",{type:"tel",placeholder:"+251 9X XXX XXXX",value:w,onChange:ce=>k(ce.target.value),className:"w-full pl-12 pr-4 py-4 rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-transparent text-lg"})]}),m.jsx(wt.button,{onClick:Qe,disabled:R||!Le(w),className:"w-full py-4 rounded-2xl font-semibold text-white shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"#2ECC71"},whileTap:{scale:.98},whileHover:{scale:1.02},children:R?m.jsxs("div",{className:"flex items-center justify-center gap-2",children:[m.jsx(My,{className:"w-5 h-5 animate-spin"}),"Sending OTP..."]}):"Send OTP"})]})}),m.jsx(Ln,{children:h==="otp"&&m.jsxs(wt.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-4",children:[m.jsxs("div",{className:"text-center mb-4",children:[m.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["OTP sent to ",De(w)]}),ye>0&&m.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Resend OTP in ",ye,"s"]})]}),m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:m.jsx(US,{className:"w-5 h-5 text-gray-400"})}),m.jsx("input",{type:"text",placeholder:"Enter 6-digit OTP",value:A,onChange:ce=>I(ce.target.value.replace(/\D/g,"").slice(0,6)),className:"w-full pl-12 pr-4 py-4 rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-transparent text-lg text-center tracking-widest"})]}),m.jsx("div",{className:"flex items-center justify-between",children:m.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[m.jsx("input",{type:"checkbox",checked:B,onChange:ce=>i(ce.target.checked),className:"w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 focus:ring-2"}),m.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Remember me for 30 days"})]})}),m.jsx(wt.button,{onClick:dt,disabled:R||A.length!==6,className:"w-full py-4 rounded-2xl font-semibold text-white shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"#2ECC71"},whileTap:{scale:.98},whileHover:{scale:1.02},children:R?m.jsxs("div",{className:"flex items-center justify-center gap-2",children:[m.jsx(My,{className:"w-5 h-5 animate-spin"}),"Logging in..."]}):"Login"}),ye===0&&m.jsx(wt.button,{onClick:St,disabled:R,className:"w-full py-2 text-green-600 dark:text-green-400 font-medium",whileTap:{scale:.98},children:"Resend OTP"})]})})]}),m.jsx(Ln,{children:K&&m.jsx(wt.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mt-4 p-3 rounded-xl bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(i0,{className:"w-4 h-4 text-red-500"}),m.jsx("span",{className:"text-sm text-red-700 dark:text-red-300",children:K})]})})})]})})}function BP(){const[u,h]=H.useState("map"),[y,w]=H.useState(!1),[k,A]=H.useState(!1),[I,B]=H.useState(null),[i,R]=H.useState(!1);_p(),H.useEffect(()=>{(()=>{try{const ye=localStorage.getItem("addistransit_session");if(ye){const Me=JSON.parse(ye);Me.expiresAt>Date.now()?(A(!0),B({phoneNumber:Me.phoneNumber,mengedId:Me.mengedId,rememberMe:!0})):localStorage.removeItem("addistransit_session")}}catch(ye){console.error("Error checking session:",ye),localStorage.removeItem("addistransit_session")}})()},[]);const $=Te=>{B(Te),A(!0),R(!1)},K=()=>{localStorage.removeItem("addistransit_session"),B(null),A(!1),R(!0)},he=["map","planner","nearby","favorites","topup","feedback"].indexOf(u);return!k||i?m.jsx(zP,{onLogin:$}):m.jsxs("div",{className:"mobile-shell h-screen w-screen overflow-hidden bg-white dark:bg-gray-900",children:[m.jsxs("div",{className:"safe-screen h-16 glass-effect border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-4 mobile-slide-down",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center mobile-shadow",children:m.jsx("div",{className:"font-bold text-white text-sm",children:"AT"})}),m.jsxs("div",{children:[m.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:I?.mengedId||"AddisTransit User"}),m.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:I?.phoneNumber||"+251 XXX XXX XXX"})]})]}),m.jsx("button",{onClick:K,className:"mobile-button p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:m.jsx(a0,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]}),m.jsx("div",{className:"relative h-[calc(100%-64px-64px)] overflow-hidden",children:m.jsxs("div",{className:"absolute inset-0 mobile-scroll",children:[u==="map"&&m.jsx(IP,{darkMode:y,setDarkMode:w,user:I}),u==="planner"&&m.jsx(jP,{darkMode:y,setDarkMode:w,user:I}),u==="nearby"&&m.jsx(NP,{darkMode:y,setDarkMode:w,user:I}),u==="favorites"&&m.jsx(DP,{darkMode:y,setDarkMode:w,user:I}),u==="topup"&&m.jsx(RP,{darkMode:y,setDarkMode:w,user:I}),u==="feedback"&&m.jsx(LP,{user:I})]})}),m.jsxs("nav",{className:"safe-screen h-16 glass-effect px-2 flex items-center justify-between relative mobile-slide-up",children:[m.jsx("div",{className:"absolute left-2 right-2 top-2 bottom-2 pointer-events-none",children:m.jsx("div",{className:"h-12 rounded-2xl bg-gray-100/80 dark:bg-gray-800/80 mobile-transition mobile-shadow",style:{transform:`translateX(${he*(100/6)}%)`,width:`${100/6}%`}})}),m.jsxs("button",{onClick:()=>h("map"),className:`mobile-button relative z-10 flex-1 flex flex-col items-center justify-center text-[10px] ${u==="map"?"text-emerald-600":"text-gray-500 dark:text-gray-400"}`,children:[m.jsx(o0,{className:"w-4 h-4 mb-0.5"}),"Map"]}),m.jsxs("button",{onClick:()=>h("planner"),className:`mobile-button relative z-10 flex-1 flex flex-col items-center justify-center text-[10px] ${u==="planner"?"text-emerald-600":"text-gray-500 dark:text-gray-400"}`,children:[m.jsx(Bc,{className:"w-4 h-4 mb-0.5"}),"Planner"]}),m.jsxs("button",{onClick:()=>h("nearby"),className:`mobile-button relative z-10 flex-1 flex flex-col items-center justify-center text-[10px] ${u==="nearby"?"text-emerald-600":"text-gray-500 dark:text-gray-400"}`,children:[m.jsx(Qi,{className:"w-4 h-4 mb-0.5"}),"Nearby"]}),m.jsxs("button",{onClick:()=>h("favorites"),className:`mobile-button relative z-10 flex-1 flex flex-col items-center justify-center text-[10px] ${u==="favorites"?"text-emerald-600":"text-gray-500 dark:text-gray-400"}`,children:[m.jsx(dp,{className:"w-4 h-4 mb-0.5"}),"Favorites"]}),m.jsxs("button",{onClick:()=>h("topup"),className:`mobile-button relative z-10 flex-1 flex flex-col items-center justify-center text-[10px] ${u==="topup"?"text-emerald-600":"text-gray-500 dark:text-gray-400"}`,children:[m.jsx(S1,{className:"w-4 h-4 mb-0.5"}),"TopUp"]}),m.jsxs("button",{onClick:()=>h("feedback"),className:`mobile-button relative z-10 flex-1 flex flex-col items-center justify-center text-[10px] ${u==="feedback"?"text-emerald-600":"text-gray-500 dark:text-gray-400"}`,children:[m.jsx(qS,{className:"w-4 h-4 mb-0.5"}),"Feedback"]})]})]})}function FP(){H.useEffect(()=>{try{const y=navigator.userAgent.toLowerCase();/android|iphone|ipad|ipod/.test(y)&&!window.location.pathname.startsWith("/m")&&window.location.replace("/m")}catch{}},[]);const[u,h]=H.useState(()=>{const y=localStorage.getItem("transit-dark-mode");return y!==null?JSON.parse(y):window.matchMedia("(prefers-color-scheme: dark)").matches});return H.useEffect(()=>{u?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("transit-dark-mode",JSON.stringify(u))},[u]),H.useEffect(()=>{const y=window.matchMedia("(prefers-color-scheme: dark)"),w=k=>{localStorage.getItem("transit-dark-mode")===null&&h(k.matches)};return y.addEventListener("change",w),()=>y.removeEventListener("change",w)},[]),m.jsx(eE,{children:m.jsx(pS,{children:m.jsx("div",{className:"h-screen w-screen overflow-hidden bg-gray-50 dark:bg-gray-900 flex",children:m.jsx("div",{className:"flex-1 flex flex-col",children:m.jsxs(Gk,{children:[m.jsx(Xs,{path:"/",element:m.jsx(mP,{})}),m.jsx(Xs,{path:"/m",element:m.jsx(BP,{})}),m.jsx(Xs,{path:"/map",element:m.jsx(pP,{darkMode:u,setDarkMode:h})}),m.jsx(Xs,{path:"/feedback",element:m.jsx(yP,{})}),m.jsx(Xs,{path:"/admin/login",element:m.jsx(xP,{})}),m.jsx(Xs,{path:"/admin/dashboard",element:m.jsx(bP,{})}),m.jsx(Xs,{path:"/coordinator",element:m.jsx(MP,{})}),m.jsx(Xs,{path:"/driver",element:m.jsx(AP,{})}),m.jsx(Xs,{path:"/about",element:m.jsx(CP,{})}),m.jsx(Xs,{path:"/trip-planner",element:m.jsx(wP,{darkMode:u,setDarkMode:h})}),m.jsx(Xs,{path:"/nearby",element:m.jsx(TP,{darkMode:u,setDarkMode:h})}),m.jsx(Xs,{path:"/favorites",element:m.jsx(kP,{darkMode:u,setDarkMode:h})}),m.jsx(Xs,{path:"/alerts",element:m.jsx(SP,{darkMode:u,setDarkMode:h})}),m.jsx(Xs,{path:"/settings",element:m.jsx(EP,{darkMode:u,setDarkMode:h})})]})})})})})}const OP="modulepreload",UP=function(u){return"/"+u},Qv={},VP=function(h,y,w){let k=Promise.resolve();if(y&&y.length>0){let i=function(R){return Promise.all(R.map($=>Promise.resolve($).then(K=>({status:"fulfilled",value:K}),K=>({status:"rejected",reason:K}))))};document.getElementsByTagName("link");const I=document.querySelector("meta[property=csp-nonce]"),B=I?.nonce||I?.getAttribute("nonce");k=i(y.map(R=>{if(R=UP(R),R in Qv)return;Qv[R]=!0;const $=R.endsWith(".css"),K=$?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${R}"]${K}`))return;const Z=document.createElement("link");if(Z.rel=$?"stylesheet":OP,$||(Z.as="script"),Z.crossOrigin="",Z.href=R,B&&Z.setAttribute("nonce",B),document.head.appendChild(Z),$)return new Promise((he,Te)=>{Z.addEventListener("load",he),Z.addEventListener("error",()=>Te(new Error(`Unable to preload CSS for ${R}`)))})}))}function A(I){const B=new Event("vite:preloadError",{cancelable:!0});if(B.payload=I,window.dispatchEvent(B),!B.defaultPrevented)throw I}return k.then(I=>{for(const B of I||[])B.status==="rejected"&&A(B.reason);return h().catch(A)})};/*! Capacitor: https://capacitorjs.com/ - MIT License */var gp;(function(u){u.Unimplemented="UNIMPLEMENTED",u.Unavailable="UNAVAILABLE"})(gp||(gp={}));class ky extends Error{constructor(h,y,w){super(h),this.message=h,this.code=y,this.data=w}}const $P=u=>{var h,y;return u?.androidBridge?"android":!((y=(h=u?.webkit)===null||h===void 0?void 0:h.messageHandlers)===null||y===void 0)&&y.bridge?"ios":"web"},GP=u=>{const h=u.CapacitorCustomPlatform||null,y=u.Capacitor||{},w=y.Plugins=y.Plugins||{},k=()=>h!==null?h.name:$P(u),A=()=>k()!=="web",I=K=>{const Z=R.get(K);return!!(Z?.platforms.has(k())||B(K))},B=K=>{var Z;return(Z=y.PluginHeaders)===null||Z===void 0?void 0:Z.find(he=>he.name===K)},i=K=>u.console.error(K),R=new Map,$=(K,Z={})=>{const he=R.get(K);if(he)return console.warn(`Capacitor plugin "${K}" already registered. Cannot register plugins twice.`),he.proxy;const Te=k(),ye=B(K);let Me;const Le=async()=>(!Me&&Te in Z?Me=typeof Z[Te]=="function"?Me=await Z[Te]():Me=Z[Te]:h!==null&&!Me&&"web"in Z&&(Me=typeof Z.web=="function"?Me=await Z.web():Me=Z.web),Me),De=(Ge,Ye)=>{var ge,Pt;if(ye){const tt=ye?.methods.find(ct=>Ye===ct.name);if(tt)return tt.rtype==="promise"?ct=>y.nativePromise(K,Ye.toString(),ct):(ct,Kt)=>y.nativeCallback(K,Ye.toString(),ct,Kt);if(Ge)return(ge=Ge[Ye])===null||ge===void 0?void 0:ge.bind(Ge)}else{if(Ge)return(Pt=Ge[Ye])===null||Pt===void 0?void 0:Pt.bind(Ge);throw new ky(`"${K}" plugin is not implemented on ${Te}`,gp.Unimplemented)}},Qe=Ge=>{let Ye;const ge=(...Pt)=>{const tt=Le().then(ct=>{const Kt=De(ct,Ge);if(Kt){const Mr=Kt(...Pt);return Ye=Mr?.remove,Mr}else throw new ky(`"${K}.${Ge}()" is not implemented on ${Te}`,gp.Unimplemented)});return Ge==="addListener"&&(tt.remove=async()=>Ye()),tt};return ge.toString=()=>`${Ge.toString()}() { [capacitor code] }`,Object.defineProperty(ge,"name",{value:Ge,writable:!1,configurable:!1}),ge},dt=Qe("addListener"),St=Qe("removeListener"),ce=(Ge,Ye)=>{const ge=dt({eventName:Ge},Ye),Pt=async()=>{const ct=await ge;St({eventName:Ge,callbackId:ct},Ye)},tt=new Promise(ct=>ge.then(()=>ct({remove:Pt})));return tt.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await Pt()},tt},$e=new Proxy({},{get(Ge,Ye){switch(Ye){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return ye?ce:dt;case"removeListener":return St;default:return Qe(Ye)}}});return w[K]=$e,R.set(K,{name:K,proxy:$e,platforms:new Set([...Object.keys(Z),...ye?[Te]:[]])}),$e};return y.convertFileSrc||(y.convertFileSrc=K=>K),y.getPlatform=k,y.handleError=i,y.isNativePlatform=A,y.isPluginAvailable=I,y.registerPlugin=$,y.Exception=ky,y.DEBUG=!!y.DEBUG,y.isLoggingEnabled=!!y.isLoggingEnabled,y},WP=u=>u.Capacitor=GP(u),Ky=WP(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),W0=Ky.registerPlugin;class Ew{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(h,y){let w=!1;this.listeners[h]||(this.listeners[h]=[],w=!0),this.listeners[h].push(y);const A=this.windowListeners[h];A&&!A.registered&&this.addWindowListener(A),w&&this.sendRetainedArgumentsForEvent(h);const I=async()=>this.removeListener(h,y);return Promise.resolve({remove:I})}async removeAllListeners(){this.listeners={};for(const h in this.windowListeners)this.removeWindowListener(this.windowListeners[h]);this.windowListeners={}}notifyListeners(h,y,w){const k=this.listeners[h];if(!k){if(w){let A=this.retainedEventArguments[h];A||(A=[]),A.push(y),this.retainedEventArguments[h]=A}return}k.forEach(A=>A(y))}hasListeners(h){var y;return!!(!((y=this.listeners[h])===null||y===void 0)&&y.length)}registerWindowListener(h,y){this.windowListeners[y]={registered:!1,windowEventName:h,pluginEventName:y,handler:w=>{this.notifyListeners(y,w)}}}unimplemented(h="not implemented"){return new Ky.Exception(h,gp.Unimplemented)}unavailable(h="not available"){return new Ky.Exception(h,gp.Unavailable)}async removeListener(h,y){const w=this.listeners[h];if(!w)return;const k=w.indexOf(y);this.listeners[h].splice(k,1),this.listeners[h].length||this.removeWindowListener(this.windowListeners[h])}addWindowListener(h){window.addEventListener(h.windowEventName,h.handler),h.registered=!0}removeWindowListener(h){h&&(window.removeEventListener(h.windowEventName,h.handler),h.registered=!1)}sendRetainedArgumentsForEvent(h){const y=this.retainedEventArguments[h];y&&(delete this.retainedEventArguments[h],y.forEach(w=>{this.notifyListeners(h,w)}))}}const e1=u=>encodeURIComponent(u).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),t1=u=>u.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class qP extends Ew{async getCookies(){const h=document.cookie,y={};return h.split(";").forEach(w=>{if(w.length<=0)return;let[k,A]=w.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");k=t1(k).trim(),A=t1(A).trim(),y[k]=A}),y}async setCookie(h){try{const y=e1(h.key),w=e1(h.value),k=`; expires=${(h.expires||"").replace("expires=","")}`,A=(h.path||"/").replace("path=",""),I=h.url!=null&&h.url.length>0?`domain=${h.url}`:"";document.cookie=`${y}=${w||""}${k}; path=${A}; ${I};`}catch(y){return Promise.reject(y)}}async deleteCookie(h){try{document.cookie=`${h.key}=; Max-Age=0`}catch(y){return Promise.reject(y)}}async clearCookies(){try{const h=document.cookie.split(";")||[];for(const y of h)document.cookie=y.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(h){return Promise.reject(h)}}async clearAllCookies(){try{await this.clearCookies()}catch(h){return Promise.reject(h)}}}W0("CapacitorCookies",{web:()=>new qP});const ZP=async u=>new Promise((h,y)=>{const w=new FileReader;w.onload=()=>{const k=w.result;h(k.indexOf(",")>=0?k.split(",")[1]:k)},w.onerror=k=>y(k),w.readAsDataURL(u)}),HP=(u={})=>{const h=Object.keys(u);return Object.keys(u).map(k=>k.toLocaleLowerCase()).reduce((k,A,I)=>(k[A]=u[h[I]],k),{})},XP=(u,h=!0)=>u?Object.entries(u).reduce((w,k)=>{const[A,I]=k;let B,i;return Array.isArray(I)?(i="",I.forEach(R=>{B=h?encodeURIComponent(R):R,i+=`${A}=${B}&`}),i.slice(0,-1)):(B=h?encodeURIComponent(I):I,i=`${A}=${B}`),`${w}&${i}`},"").substr(1):null,KP=(u,h={})=>{const y=Object.assign({method:u.method||"GET",headers:u.headers},h),k=HP(u.headers)["content-type"]||"";if(typeof u.data=="string")y.body=u.data;else if(k.includes("application/x-www-form-urlencoded")){const A=new URLSearchParams;for(const[I,B]of Object.entries(u.data||{}))A.set(I,B);y.body=A.toString()}else if(k.includes("multipart/form-data")||u.data instanceof FormData){const A=new FormData;if(u.data instanceof FormData)u.data.forEach((B,i)=>{A.append(i,B)});else for(const B of Object.keys(u.data))A.append(B,u.data[B]);y.body=A;const I=new Headers(y.headers);I.delete("content-type"),y.headers=I}else(k.includes("application/json")||typeof u.data=="object")&&(y.body=JSON.stringify(u.data));return y};class YP extends Ew{async request(h){const y=KP(h,h.webFetchExtra),w=XP(h.params,h.shouldEncodeUrlParams),k=w?`${h.url}?${w}`:h.url,A=await fetch(k,y),I=A.headers.get("content-type")||"";let{responseType:B="text"}=A.ok?h:{};I.includes("application/json")&&(B="json");let i,R;switch(B){case"arraybuffer":case"blob":R=await A.blob(),i=await ZP(R);break;case"json":i=await A.json();break;case"document":case"text":default:i=await A.text()}const $={};return A.headers.forEach((K,Z)=>{$[Z]=K}),{data:i,headers:$,status:A.status,url:A.url}}async get(h){return this.request(Object.assign(Object.assign({},h),{method:"GET"}))}async post(h){return this.request(Object.assign(Object.assign({},h),{method:"POST"}))}async put(h){return this.request(Object.assign(Object.assign({},h),{method:"PUT"}))}async patch(h){return this.request(Object.assign(Object.assign({},h),{method:"PATCH"}))}async delete(h){return this.request(Object.assign(Object.assign({},h),{method:"DELETE"}))}}W0("CapacitorHttp",{web:()=>new YP});const r1=W0("App",{web:()=>VP(()=>import("./web-CKGLdq90.js"),[]).then(u=>new u.AppWeb)});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(u=>{console.log("SW registered: ",u)}).catch(u=>{console.log("SW registration failed: ",u)})});r1.addListener("backButton",({canGoBack:u})=>{u?window.history.back():r1.exitApp()});try{ek.createRoot(document.getElementById("root")).render(m.jsx(n1.StrictMode,{children:m.jsx(FP,{})}))}catch(u){console.error("Failed to render Transit app:",u),document.getElementById("root").innerHTML=`
    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; font-family: system-ui;">
      <div style="text-align: center; padding: 2rem;">
        <h1 style="color: #ef4444; margin-bottom: 1rem;">Transit App Error</h1>
        <p style="color: #6b7280; margin-bottom: 2rem;">Failed to load the application. Please refresh the page.</p>
        <button onclick="window.location.reload()" style="background: #3b82f6; color: white; padding: 0.5rem 1rem; border: none; border-radius: 0.5rem; cursor: pointer;">
          Refresh Page
        </button>
      </div>
    </div>
  `}export{Ew as W};
